<?xml version="1.0" encoding="UTF-8"?>
<xwikidoc>
<web>WiperDog</web>
<name>WebHome</name>
<language></language>
<defaultLanguage>en</defaultLanguage>
<translation>0</translation>
<parent></parent>
<creator>XWiki.Admin</creator>
<author>XWiki.Admin</author>
<customClass></customClass>
<contentAuthor>XWiki.Admin</contentAuthor>
<creationDate>1376364375000</creationDate>
<date>1376623938000</date>
<contentUpdateDate>1376623938000</contentUpdateDate>
<version>61.62</version>
<title>WiperDog</title>
<defaultTemplate></defaultTemplate>
<validationScript></validationScript>
<comment></comment>
<minorEdit>true</minorEdit>
<syntaxId>xwiki/2.1</syntaxId>
<hidden>false</hidden>
<object>
<class>
<name>XWiki.JavaScriptExtension</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<cache>
<cache>0</cache>
<disabled>0</disabled>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>cache</name>
<number>5</number>
<prettyName>Caching policy</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>long|short|default|forbid</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</cache>
<code>
<disabled>0</disabled>
<name>code</name>
<number>2</number>
<prettyName>Code</prettyName>
<rows>20</rows>
<size>50</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</code>
<name>
<disabled>0</disabled>
<name>name</name>
<number>1</number>
<prettyName>Name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
<parse>
<disabled>0</disabled>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>parse</name>
<number>4</number>
<prettyName>Parse content</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</parse>
<use>
<cache>0</cache>
<disabled>0</disabled>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>use</name>
<number>3</number>
<prettyName>Use this extension</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>currentPage=Always on this page|onDemand=On demand|always=Always on this wiki</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</use>
</class>
<name>WiperDog.WebHome</name>
<number>3</number>
<className>XWiki.JavaScriptExtension</className>
<guid>047293a8-524d-45e4-af52-cd944523d5d0</guid>
<property>
<cache>default</cache>
</property>
<property>
<code>require(['jquery'],function($){
/*
 * jQuery timepicker addon
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 1.3.1
 * Last Modified: 07/07/2013
 *
 * Copyright 2013 Trent Richardson
 * You may use this project under MIT or GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 */

/*jslint evil: true, white: false, undef: false, nomen: false */

(function($) {

	/*
	* Lets not redefine timepicker, Prevent "Uncaught RangeError: Maximum call stack size exceeded"
	*/
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return;
	}

	/*
	* Extend jQueryUI, get it started with our version number
	*/
	$.extend($.ui, {
		timepicker: {
			version: "1.3.1"
		}
	});

	/* 
	* Timepicker manager.
	* Use the singleton instance of this class, $.timepicker, to interact with the time picker.
	* Settings for (groups of) time pickers are maintained in an instance object,
	* allowing multiple different settings on the same page.
	*/
	var Timepicker = function() {
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[''] = { // Default regional settings
			currentText: 'Now',
			closeText: 'Done',
			amNames: ['AM', 'A'],
			pmNames: ['PM', 'P'],
			timeFormat: 'HH:mm',
			timeSuffix: '',
			timeOnlyTitle: 'Choose Time',
			timeText: 'Time',
			hourText: 'Hour',
			minuteText: 'Minute',
			secondText: 'Second',
			millisecText: 'Millisecond',
			microsecText: 'Microsecond',
			timezoneText: 'Time Zone',
			isRTL: false
		};
		this._defaults = { // Global defaults for all the datetime picker instances
			showButtonPanel: true,
			timeOnly: false,
			showHour: null,
			showMinute: null,
			showSecond: null,
			showMillisec: null,
			showMicrosec: null,
			showTimezone: null,
			showTime: true,
			stepHour: 1,
			stepMinute: 1,
			stepSecond: 1,
			stepMillisec: 1,
			stepMicrosec: 1,
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null,
			hourMin: 0,
			minuteMin: 0,
			secondMin: 0,
			millisecMin: 0,
			microsecMin: 0,
			hourMax: 23,
			minuteMax: 59,
			secondMax: 59,
			millisecMax: 999,
			microsecMax: 999,
			minDateTime: null,
			maxDateTime: null,
			onSelect: null,
			hourGrid: 0,
			minuteGrid: 0,
			secondGrid: 0,
			millisecGrid: 0,
			microsecGrid: 0,
			alwaysSetTime: true,
			separator: ' ',
			altFieldTimeOnly: true,
			altTimeFormat: null,
			altSeparator: null,
			altTimeSuffix: null,
			pickerTimeFormat: null,
			pickerTimeSuffix: null,
			showTimepicker: true,
			timezoneList: null,
			addSliderAccess: false,
			sliderAccessArgs: null,
			controlType: 'slider',
			defaultValue: null,
			parse: 'strict'
		};
		$.extend(this._defaults, this.regional['']);
	};

	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: '',
		formattedDate: '',
		formattedTime: '',
		formattedDateTime: '',
		timezoneList: null,
		units: ['hour','minute','second','millisec', 'microsec'],
		support: {},
		control: null,

		/* 
		* Override the default settings for all instances of the time picker.
		* @param  settings  object - the new settings to use as defaults (anonymous object)
		* @return the manager object
		*/
		setDefaults: function(settings) {
			extendRemove(this._defaults, settings || {});
			return this;
		},

		/*
		* Create a new Timepicker instance
		*/
		_newInst: function($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
            	fns = {},
		    	overrides, i;

			for (var attrName in this._defaults) {
				if(this._defaults.hasOwnProperty(attrName)){
					var attrValue = $input.attr('time:' + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue);
						} catch (err) {
							inlineSettings[attrName] = attrValue;
						}
					}
				}
			}

		    overrides = {
		        beforeShow: function (input, dp_inst) {
		            if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
		                return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst);
		            }
		        },
		        onChangeMonthYear: function (year, month, dp_inst) {
		            // Update the time as well : this prevents the time from disappearing from the $input field.
		            tp_inst._updateDateTime(dp_inst);
		            if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
		                tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst);
		            }
		        },
		        onClose: function (dateText, dp_inst) {
		            if (tp_inst.timeDefined === true &amp;&amp; $input.val() !== '') {
		                tp_inst._updateDateTime(dp_inst);
		            }
		            if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
		                tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst);
		            }
		        }
		    };
		    for (i in overrides) {
		        if (overrides.hasOwnProperty(i)) {
		            fns[i] = opts[i] || null;
		        }
		    }

		    tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
		        evnts:fns,
		        timepicker: tp_inst // add timepicker as a property of datepicker: $.datepicker._get(dp_inst, 'timepicker');
		    });
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function(val) {
				return val.toUpperCase();
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function(val) {
				return val.toUpperCase();
			});

			// detect which units are supported
			tp_inst.support = detectSupport(
					tp_inst._defaults.timeFormat + 
					(tp_inst._defaults.pickerTimeFormat? tp_inst._defaults.pickerTimeFormat:'') + 
					(tp_inst._defaults.altTimeFormat? tp_inst._defaults.altTimeFormat:''));

			// controlType is string - key to our this._controls
			if(typeof(tp_inst._defaults.controlType) === 'string'){
				if(tp_inst._defaults.controlType == 'slider' &amp;&amp; typeof(jQuery.ui.slider) === 'undefined'){
					tp_inst._defaults.controlType = 'select';
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType];
			}
			// controlType is an object and must implement create, options, value methods
			else{ 
				tp_inst.control = tp_inst._defaults.controlType;
			}

			// prep the timezone options
			var timezoneList = [-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,
					0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList;
			}
			var tzl=timezoneList.length,tzi=0,tzv=null;
			if (tzl &gt; 0 &amp;&amp; typeof timezoneList[0] !== 'object') {
				for(; tzi&lt;tzl; tzi++){
					tzv = timezoneList[tzi];
					timezoneList[tzi] = { value: tzv, label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601) };
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;

			// set the default units
			tp_inst.timezone = tp_inst._defaults.timezone !== null? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) : 
							((new Date()).getTimezoneOffset()*-1);
			tp_inst.hour = tp_inst._defaults.hour &lt; tp_inst._defaults.hourMin? tp_inst._defaults.hourMin : 
							tp_inst._defaults.hour &gt; tp_inst._defaults.hourMax? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute &lt; tp_inst._defaults.minuteMin? tp_inst._defaults.minuteMin : 
							tp_inst._defaults.minute &gt; tp_inst._defaults.minuteMax? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second &lt; tp_inst._defaults.secondMin? tp_inst._defaults.secondMin : 
							tp_inst._defaults.second &gt; tp_inst._defaults.secondMax? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec &lt; tp_inst._defaults.millisecMin? tp_inst._defaults.millisecMin : 
							tp_inst._defaults.millisec &gt; tp_inst._defaults.millisecMax? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec &lt; tp_inst._defaults.microsecMin? tp_inst._defaults.microsecMin : 
							tp_inst._defaults.microsec &gt; tp_inst._defaults.microsecMax? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = '';
			tp_inst.$input = $input;

			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField).css({
					cursor: 'pointer'
				}).focus(function() {
					$input.trigger("focus");
				});
			}

			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date();
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date();
			}

			// datepicker needs minDate/maxDate, timepicker needs minDateTime/maxDateTime..
			if (tp_inst._defaults.minDate !== undefined &amp;&amp; tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime());
			}
			if (tp_inst._defaults.minDateTime !== undefined &amp;&amp; tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime());
			}
			if (tp_inst._defaults.maxDate !== undefined &amp;&amp; tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime());
			}
			if (tp_inst._defaults.maxDateTime !== undefined &amp;&amp; tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime());
			}
			tp_inst.$input.bind('focus', function() {
				tp_inst._onFocus();
			});

			return tp_inst;
		},

		/*
		* add our sliders to the calendar
		*/
		_addTimePicker: function(dp_inst) {
			var currDT = (this.$altInput &amp;&amp; this._defaults.altFieldTimeOnly) ? this.$input.val() + ' ' + this.$altInput.val() : this.$input.val();

			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
		},

		/*
		* parse the time string from input value or _setTime
		*/
		_parseTime: function(timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0]);
			}

			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, 'dateFormat');
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false;
					}
					$.extend(this, parseRes.timeObj);
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err +
									"\ndate/time string = " + timeString +
									"\ntimeFormat = " + this._defaults.timeFormat +
									"\ndateFormat = " + dp_dateFormat);
					return false;
				}
				return true;
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false;
				}
				$.extend(this, timeObj);
				return true;
			}
		},

		/*
		* generate and inject html for timepicker into ui datepicker
		*/
		_injectTimePicker: function() {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = '',
				uitem = '',
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i=0,
				l=0;

			// Prevent displaying twice
			if ($dp.find("div.ui-timepicker-div").length === 0 &amp;&amp; o.showTimepicker) {
				var noDisplay = ' style="display:none;"',
					html = '&lt;div class="ui-timepicker-div'+ (o.isRTL? ' ui-timepicker-rtl' : '') +'"&gt;&lt;dl&gt;' + '&lt;dt class="ui_tpicker_time_label"' + ((o.showTime) ? '' : noDisplay) + '&gt;' + o.timeText + '&lt;/dt&gt;' + 
								'&lt;dd class="ui_tpicker_time"' + ((o.showTime) ? '' : noDisplay) + '&gt;&lt;/dd&gt;';

				// Create the markup
				for(i=0,l=this.units.length; i&lt;l; i++){
					litem = this.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// Added by Peter Medeiros:
					// - Figure out what the hour/minute/second max should be based on the step values.
					// - Example: if stepMinute is 15, then minMax is 45.
					max[litem] = parseInt((o[litem+'Max'] - ((o[litem+'Max'] - o[litem+'Min']) % o['step'+uitem])), 10);
					gridSize[litem] = 0;

					html += '&lt;dt class="ui_tpicker_'+ litem +'_label"' + (show ? '' : noDisplay) + '&gt;' + o[litem +'Text'] + '&lt;/dt&gt;' + 
								'&lt;dd class="ui_tpicker_'+ litem +'"&gt;&lt;div class="ui_tpicker_'+ litem +'_slider"' + (show ? '' : noDisplay) + '&gt;&lt;/div&gt;';

					if (show &amp;&amp; o[litem+'Grid'] &gt; 0) {
						html += '&lt;div style="padding-left: 1px"&gt;&lt;table class="ui-tpicker-grid-label"&gt;&lt;tr&gt;';

						if(litem == 'hour'){
							for (var h = o[litem+'Min']; h &lt;= max[litem]; h += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm? 'hht':'HH', {hour:h}, o);									
								html += '&lt;td data-for="'+litem+'"&gt;' + tmph + '&lt;/td&gt;';
							}
						}
						else{
							for (var m = o[litem+'Min']; m &lt;= max[litem]; m += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								html += '&lt;td data-for="'+litem+'"&gt;' + ((m &lt; 10) ? '0' : '') + m + '&lt;/td&gt;';
							}
						}

						html += '&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;';
					}
					html += '&lt;/dd&gt;';
				}
				
				// Timezone
				var showTz = o.showTimezone !== null? o.showTimezone : this.support.timezone;
				html += '&lt;dt class="ui_tpicker_timezone_label"' + (showTz ? '' : noDisplay) + '&gt;' + o.timezoneText + '&lt;/dt&gt;';
				html += '&lt;dd class="ui_tpicker_timezone" ' + (showTz ? '' : noDisplay) + '&gt;&lt;/dd&gt;';

				// Create the elements from string
				html += '&lt;/dl&gt;&lt;/div&gt;';
				var $tp = $(html);

				// if we only want time picker...
				if (o.timeOnly === true) {
					$tp.prepend('&lt;div class="ui-widget-header ui-helper-clearfix ui-corner-all"&gt;' + '&lt;div class="ui-datepicker-title"&gt;' + o.timeOnlyTitle + '&lt;/div&gt;' + '&lt;/div&gt;');
					$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();
				}
				
				// add sliders, adjust grids, add events
				for(i=0,l=tp_inst.units.length; i&lt;l; i++){
					litem = tp_inst.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// add the slider
					tp_inst[litem+'_slider'] = tp_inst.control.create(tp_inst, $tp.find('.ui_tpicker_'+litem+'_slider'), litem, tp_inst[litem], o[litem+'Min'], max[litem], o['step'+uitem]);

					// adjust the grid and add click event
					if (show &amp;&amp; o[litem+'Grid'] &gt; 0) {
						size = 100 * gridSize[litem] * o[litem+'Grid'] / (max[litem] - o[litem+'Min']);
						$tp.find('.ui_tpicker_'+litem+' table').css({
							width: size + "%",
							marginLeft: o.isRTL? '0' : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL? ((size / (-2 * gridSize[litem])) + "%") : '0',
							borderCollapse: 'collapse'
						}).find("td").click(function(e){
								var $t = $(this),
									h = $t.html(),
									n = parseInt(h.replace(/[^0-9]/g),10),
									ap = h.replace(/[^apm]/ig),
									f = $t.data('for'); // loses scope, so we use data-for

								if(f == 'hour'){
									if(ap.indexOf('p') !== -1 &amp;&amp; n &lt; 12){
										n += 12;
									}
									else{
										if(ap.indexOf('a') !== -1 &amp;&amp; n === 12){
											n = 0;
										}
									}
								}
								
								tp_inst.control.value(tp_inst, tp_inst[f+'_slider'], litem, n);

								tp_inst._onTimeChange();
								tp_inst._onSelectHandler();
							}).css({
								cursor: 'pointer',
								width: (100 / gridSize[litem]) + '%',
								textAlign: 'center',
								overflow: 'hidden'
							});
					} // end if grid &gt; 0
				} // end for loop

				// Add timezone options
				this.timezone_select = $tp.find('.ui_tpicker_timezone').append('&lt;select&gt;&lt;/select&gt;').find("select");
				$.fn.append.apply(this.timezone_select,
				$.map(o.timezoneList, function(val, idx) {
					return $("&lt;option /&gt;").val(typeof val == "object" ? val.value : val).text(typeof val == "object" ? val.label : val);
				}));
				if (typeof(this.timezone) != "undefined" &amp;&amp; this.timezone !== null &amp;&amp; this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset()*-1;
					if (local_timezone == this.timezone) {
						selectLocalTimezone(tp_inst);
					} else {
						this.timezone_select.val(this.timezone);
					}
				} else {
					if (typeof(this.hour) != "undefined" &amp;&amp; this.hour !== null &amp;&amp; this.hour !== "") {
						this.timezone_select.val(o.timezone);
					} else {
						selectLocalTimezone(tp_inst);
					}
				}
				this.timezone_select.change(function() {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
				});
				// End timezone options
				
				// inject timepicker into datepicker
				var $buttonPanel = $dp.find('.ui-datepicker-buttonpane');
				if ($buttonPanel.length) {
					$buttonPanel.before($tp);
				} else {
					$dp.append($tp);
				}

				this.$timeObj = $tp.find('.ui_tpicker_time');

				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined;
				}

				// slideAccess integration: http://trentrichardson.com/2011/11/11/jquery-ui-sliders-and-touch-accessibility/
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
						
					setTimeout(function() { // fix for inline mode
						if ($tp.find('.ui-slider-access').length === 0) {
							$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);

							// fix any grids since sliders are shorter
							var sliderAccessWidth = $tp.find('.ui-slider-access:eq(0)').outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find('table:visible').each(function() {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl? 'marginRight':'marginLeft').toString().replace('%', ''),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + '%',
										css = { width: newWidth, marginRight: 0, marginLeft: 0 };
									css[rtl? 'marginRight':'marginLeft'] = newMarginLeft;
									$g.css(css);
								});
							}
						}
					}, 10);
				}
				// end slideAccess integration

				tp_inst._limitMinMaxDateTime(this.inst, true);
			}
		},

		/*
		* This function tries to limit the ability to go outside the
		* min/max date range
		*/
		_limitMinMaxDateTime: function(dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);

			if (!this._defaults.showTimepicker) {
				return;
			} // No time so nothing to check here

			if ($.datepicker._get(dp_inst, 'minDateTime') !== null &amp;&amp; $.datepicker._get(dp_inst, 'minDateTime') !== undefined &amp;&amp; dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, 'minDateTime'),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin;
				}

				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour &lt;= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute &lt;= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second &lt;= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if(this.millisec &lt;= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds();
								} else {
									if (this.microsec &lt; this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin;
									}
									this._defaults.microsecMin = this.microsecMinOriginal;
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal;
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal;
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal;
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal;
				}
			}

			if ($.datepicker._get(dp_inst, 'maxDateTime') !== null &amp;&amp; $.datepicker._get(dp_inst, 'maxDateTime') !== undefined &amp;&amp; dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, 'maxDateTime'),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax;
				}

				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour &gt;= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute &gt;= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second &gt;= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec &gt;= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds();
								} else {
									if (this.microsec &gt; this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax;
									}
									this._defaults.microsecMax = this.microsecMaxOriginal;
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal;
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal;
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal;
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal;
				}
			}

			if (adjustSliders !== undefined &amp;&amp; adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10);
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);

				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, 'hour', { min: this._defaults.hourMin, max: hourMax });
					this.control.value(this, this.hour_slider, 'hour', this.hour - (this.hour % this._defaults.stepHour));
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, 'minute', { min: this._defaults.minuteMin, max: minMax });
					this.control.value(this, this.minute_slider, 'minute', this.minute - (this.minute % this._defaults.stepMinute));
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, 'second', { min: this._defaults.secondMin, max: secMax });
					this.control.value(this, this.second_slider, 'second', this.second - (this.second % this._defaults.stepSecond));
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, 'millisec', { min: this._defaults.millisecMin, max: millisecMax });
					this.control.value(this, this.millisec_slider, 'millisec', this.millisec - (this.millisec % this._defaults.stepMillisec));
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, 'microsec', { min: this._defaults.microsecMin, max: microsecMax });
					this.control.value(this, this.microsec_slider, 'microsec', this.microsec - (this.microsec % this._defaults.stepMicrosec));
				}
			}

		},

		/*
		* when a slider moves, set the internal time...
		* on time change is also called when the time is updated in the text field
		*/
		_onTimeChange: function() {
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, 'hour') : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, 'minute') : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, 'second') : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, 'millisec') : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, 'microsec') : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;

			if (typeof(hour) == 'object') {
				hour = false;
			}
			if (typeof(minute) == 'object') {
				minute = false;
			}
			if (typeof(second) == 'object') {
				second = false;
			}
			if (typeof(millisec) == 'object') {
				millisec = false;
			}
			if (typeof(microsec) == 'object') {
				microsec = false;
			}
			if (typeof(timezone) == 'object') {
				timezone = false;
			}

			if (hour !== false) {
				hour = parseInt(hour, 10);
			}
			if (minute !== false) {
				minute = parseInt(minute, 10);
			}
			if (second !== false) {
				second = parseInt(second, 10);
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10);
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10);
			}

			var ampm = o[hour &lt; 12 ? 'amNames' : 'pmNames'][0];

			// If the update was done in the input field, the input field should not be updated.
			// If the update was done using the sliders, update the input field.
			var hasChanged = (hour != this.hour || minute != this.minute || second != this.second || millisec != this.millisec || microsec != this.microsec 
								|| (this.ampm.length &gt; 0 &amp;&amp; (hour &lt; 12) != ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) 
								|| (this.timezone !== null &amp;&amp; timezone != this.timezone));

			if (hasChanged) {

				if (hour !== false) {
					this.hour = hour;
				}
				if (minute !== false) {
					this.minute = minute;
				}
				if (second !== false) {
					this.second = second;
				}
				if (millisec !== false) {
					this.millisec = millisec;
				}
				if (microsec !== false) {
					this.microsec = microsec;
				}
				if (timezone !== false) {
					this.timezone = timezone;
				}

				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0]);
				}

				this._limitMinMaxDateTime(this.inst, true);
			}
			if (this.support.ampm) {
				this.ampm = ampm;
			}

			// Updates the time within the timepicker
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if(pickerTimeFormat === o.timeFormat){
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix);
				}
				else{
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix);
				}
			}

			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime();
			}
		},

		/*
		* call custom onSelect.
		* bind to sliders slidestop, and grid click.
		*/
		_onSelectHandler: function() {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect &amp;&amp; inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this]);
			}
		},

		/*
		* update our input with the new date time..
		*/
		_updateDateTime: function(dp_inst) {
			dp_inst = this.inst || dp_inst;
			//var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
			var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay)),
				dateFmt = $.datepicker._get(dp_inst, 'dateFormat'),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null &amp;&amp; this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			
			// if a slider was changed but datepicker doesn't have a value yet, set it
			if(dp_inst.lastVal===""){
                dp_inst.currentYear=dp_inst.selectedYear;
                dp_inst.currentMonth=dp_inst.selectedMonth;
                dp_inst.currentDay=dp_inst.selectedDay;
            }

			/*
			* remove following lines to force every changes in date picker to change the input value
			* Bug descriptions: when an input field has a default value, and click on the field to pop up the date picker. 
			* If the user manually empty the value in the input field, the date picker will never change selected value.
			*/
			//if (dp_inst.lastVal !== undefined &amp;&amp; (dp_inst.lastVal.length &gt; 0 &amp;&amp; this.$input.val().length === 0)) {
			//	return;
			//}

			if (this._defaults.timeOnly === true) {
				formattedDateTime = this.formattedTime;
			} else if (this._defaults.timeOnly !== true &amp;&amp; (this._defaults.alwaysSetTime || timeAvailable)) {
				formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix;
			}

			this.formattedDateTime = formattedDateTime;

			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate);
			} else if (this.$altInput &amp;&amp; this._defaults.timeOnly === false &amp;&amp; this._defaults.altFieldTimeOnly === true) {
				this.$altInput.val(this.formattedTime);
				this.$input.val(this.formattedDate);
			} else if (this.$altInput) {
				this.$input.val(formattedDateTime);
				var altFormattedDateTime = '',
					altSeparator = this._defaults.altSeparator ? this._defaults.altSeparator : this._defaults.separator,
					altTimeSuffix = this._defaults.altTimeSuffix ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
				
				if(!this._defaults.timeOnly){
					if (this._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg);
					}
					else{
						altFormattedDateTime = this.formattedDate;
					}

					if (altFormattedDateTime){
						altFormattedDateTime += altSeparator;
					}
				}

				if(this._defaults.altTimeFormat){
					altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix;
				}
				else{
					altFormattedDateTime += this.formattedTime + altTimeSuffix;
				}
				this.$altInput.val(altFormattedDateTime);
			} else {
				this.$input.val(formattedDateTime);
			}

			this.$input.trigger("change");
		},

		_onFocus: function() {
			if (!this.$input.val() &amp;&amp; this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, 'timepicker');
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly &amp;&amp; (inst.input.val() != inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst);
						} catch (err) {
							$.timepicker.log(err);
						}
					}
				}
			}
		},

		/*
		* Small abstraction to control types
		* We can add more, just be sure to follow the pattern: create, options, value
		*/
		_controls: {
			// slider methods
			slider: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var rtl = tp_inst._defaults.isRTL; // if rtl go -60-&gt;0 instead of 0-&gt;60
					return obj.prop('slide', null).slider({
						orientation: "horizontal",
						value: rtl? val*-1 : val,
						min: rtl? max*-1 : min,
						max: rtl? min*-1 : max,
						step: step,
						slide: function(event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl? ui.value*-1:ui.value);
							tp_inst._onTimeChange();
						},
						stop: function(event, ui) {
							tp_inst._onSelectHandler();
						}
					});	
				},
				options: function(tp_inst, obj, unit, opts, val){
					if(tp_inst._defaults.isRTL){
						if(typeof(opts) == 'string'){
							if(opts == 'min' || opts == 'max'){
								if(val !== undefined){
									return obj.slider(opts, val*-1);
								}
								return Math.abs(obj.slider(opts));
							}
							return obj.slider(opts);
						}
						var min = opts.min, 
							max = opts.max;
						opts.min = opts.max = null;
						if(min !== undefined){
							opts.max = min * -1;
						}
						if(max !== undefined){
							opts.min = max * -1;
						}
						return obj.slider(opts);
					}
					if(typeof(opts) == 'string' &amp;&amp; val !== undefined){
							return obj.slider(opts, val);
					}
					return obj.slider(opts);
				},
				value: function(tp_inst, obj, unit, val){
					if(tp_inst._defaults.isRTL){
						if(val !== undefined){
							return obj.slider('value', val*-1);
						}
						return Math.abs(obj.slider('value'));
					}
					if(val !== undefined){
						return obj.slider('value', val);
					}
					return obj.slider('value');
				}
			},
			// select methods
			select: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var sel = '&lt;select class="ui-timepicker-select" data-unit="'+ unit +'" data-min="'+ min +'" data-max="'+ max +'" data-step="'+ step +'"&gt;',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;

					for(var i=min; i&lt;=max; i+=step){						
						sel += '&lt;option value="'+ i +'"'+ (i==val? ' selected':'') +'&gt;';
						if(unit == 'hour'){
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig,'')), {hour:i}, tp_inst._defaults);
						}
						else if(unit == 'millisec' || unit == 'microsec' || i &gt;= 10){ sel += i; }
						else {sel += '0'+ i.toString(); }
						sel += '&lt;/option&gt;';
					}
					sel += '&lt;/select&gt;';

					obj.children('select').remove();

					$(sel).appendTo(obj).change(function(e){
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
					});

					return obj;
				},
				options: function(tp_inst, obj, unit, opts, val){
					var o = {},
						$t = obj.children('select');
					if(typeof(opts) == 'string'){
						if(val === undefined){
							return $t.data(opts);
						}
						o[opts] = val;	
					}
					else{ o = opts; }
					return tp_inst.control.create(tp_inst, obj, $t.data('unit'), $t.val(), o.min || $t.data('min'), o.max || $t.data('max'), o.step || $t.data('step'));
				},
				value: function(tp_inst, obj, unit, val){
					var $t = obj.children('select');
					if(val !== undefined){
						return $t.val(val);
					}
					return $t.val();
				}
			}
		} // end _controls

	});

	$.fn.extend({
		/*
		* shorthand just to use timepicker..
		*/
		timepicker: function(o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);

			if (typeof o == 'object') {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				});
			}

			return $(this).each(function() {
				$.fn.datetimepicker.apply($(this), tmp_args);
			});
		},

		/*
		* extend timepicker to datepicker
		*/
		datetimepicker: function(o) {
			o = o || {};
			var tmp_args = arguments;

			if (typeof(o) == 'string') {
				if (o == 'getDate') {
					return $.fn.datepicker.apply($(this[0]), tmp_args);
				} else {
					return this.each(function() {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args);
					});
				}
			} else {
				return this.each(function() {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults);
				});
			}
		}
	});

	/*
	* Public Utility to parse date and time
	*/
	$.datepicker.parseDateTime = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec);
		}

		return parseRes.date;
	};

	/*
	* Public utility to parse time
	*/
	$.datepicker.parseTime = function(timeFormat, timeString, options) {		
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g,'').indexOf('Z') !== -1);

		// Strict parse requires the timeString to match the timeFormat exactly
		var strictParse = function(f, s, o){

			// pattern for standard and localized AM/PM markers
			var getPatternAmpm = function(amNames, pmNames) {
				var markers = [];
				if (amNames) {
					$.merge(markers, amNames);
				}
				if (pmNames) {
					$.merge(markers, pmNames);
				}
				markers = $.map(markers, function(val) {
					return val.replace(/[.*+?|()\[\]{}\\]/g, '\\$&amp;');
				});
				return '(' + markers.join('|') + ')?';
			};

			// figure out position of time elements.. cause js cant do named captures
			var getFormatPositions = function(timeFormat) {
				var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
					orders = {
						h: -1,
						m: -1,
						s: -1,
						l: -1,
						c: -1,
						t: -1,
						z: -1
					};

				if (finds) {
					for (var i = 0; i &lt; finds.length; i++) {
						if (orders[finds[i].toString().charAt(0)] == -1) {
							orders[finds[i].toString().charAt(0)] = i + 1;
						}
					}
				}
				return orders;
			};

			var regstr = '^' + f.toString()
					.replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
							var ml = match.length;
							switch (match.charAt(0).toLowerCase()) {
								case 'h': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'm': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 's': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'l': return '(\\d?\\d?\\d)';
								case 'c': return '(\\d?\\d?\\d)';
								case 'z': return '(z|[-+]\\d\\d:?\\d\\d|\\S+)?';
								case 't': return getPatternAmpm(o.amNames, o.pmNames);
								default:    // literal escaped in quotes
									return '(' + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function (m) { return "\\" + m; }) + ')?';
							}
						})
					.replace(/\s/g, '\\s?') +
					o.timeSuffix + '$',
				order = getFormatPositions(f),
				ampm = '',
				treg;

			treg = s.match(new RegExp(regstr, 'i'));

			var resTime = {
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0
			};

			if (treg) {
				if (order.t !== -1) {
					if (treg[order.t] === undefined || treg[order.t].length === 0) {
						ampm = '';
						resTime.ampm = '';
					} else {
						ampm = $.inArray(treg[order.t].toUpperCase(), o.amNames) !== -1 ? 'AM' : 'PM';
						resTime.ampm = o[ampm == 'AM' ? 'amNames' : 'pmNames'][0];
					}
				}

				if (order.h !== -1) {
					if (ampm == 'AM' &amp;&amp; treg[order.h] == '12') {
						resTime.hour = 0; // 12am = 0 hour
					} else {
						if (ampm == 'PM' &amp;&amp; treg[order.h] != '12') {
							resTime.hour = parseInt(treg[order.h], 10) + 12; // 12pm = 12 hour, any other pm = hour + 12
						} else {
							resTime.hour = Number(treg[order.h]);
						}
					}
				}

				if (order.m !== -1) {
					resTime.minute = Number(treg[order.m]);
				}
				if (order.s !== -1) {
					resTime.second = Number(treg[order.s]);
				}
				if (order.l !== -1) {
					resTime.millisec = Number(treg[order.l]);
				}
				if (order.c !== -1) {
					resTime.microsec = Number(treg[order.c]);
				}
				if (order.z !== -1 &amp;&amp; treg[order.z] !== undefined) {
					resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z]);
				}


				return resTime;
			}
			return false;
		};// end strictParse

		// First try JS Date, if that fails, use strictParse
		var looseParse = function(f,s,o){
			try{
				var d = new Date('2012-01-01 '+ s);
				if(isNaN(d.getTime())){
					d = new Date('2012-01-01T'+ s);
					if(isNaN(d.getTime())){
						d = new Date('01/01/2012 '+ s);
						if(isNaN(d.getTime())){
							throw "Unable to parse time with native Date: "+ s;
						}
					}
				}

				return {
					hour: d.getHours(),
					minute: d.getMinutes(),
					second: d.getSeconds(),
					millisec: d.getMilliseconds(),
					microsec: d.getMicroseconds(),
					timezone: d.getTimezoneOffset()*-1
				};
			}
			catch(err){
				try{
					return strictParse(f,s,o);
				}
				catch(err2){
					$.timepicker.log("Unable to parse \ntimeString: "+ s +"\ntimeFormat: "+ f);
				}				
			}
			return false;
		}; // end looseParse
		
		if(typeof o.parse === "function"){
			return o.parse(timeFormat, timeString, o);
		}
		if(o.parse === 'loose'){
			return looseParse(timeFormat, timeString, o);
		}
		return strictParse(timeFormat, timeString, o);
	};

	/*
	* Public utility to format the time
	* format = string format of the time
	* time = a {}, not a Date() for timezones
	* options = essentially the regional[].. amNames, pmNames, ampm
	*/
	$.datepicker.formatTime = function(format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			timezone: 0
		}, time);

		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);

		if (hour &gt; 11) {
			ampmName = options.pmNames[0];
		}

		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|('.*?'|".*?"))/g, function(match) {
		switch (match) {
			case 'HH':
				return ('0' + hour).slice(-2);
			case 'H':
				return hour;
			case 'hh':
				return ('0' + convert24to12(hour)).slice(-2);
			case 'h':
				return convert24to12(hour);
			case 'mm':
				return ('0' + time.minute).slice(-2);
			case 'm':
				return time.minute;
			case 'ss':
				return ('0' + time.second).slice(-2);
			case 's':
				return time.second;
			case 'l':
				return ('00' + time.millisec).slice(-3);
			case 'c':
				return ('00' + time.microsec).slice(-3);
			case 'z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, false);
			case 'Z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, true);
			case 'T': 
				return ampmName.charAt(0).toUpperCase();
			case 'TT': 
				return ampmName.toUpperCase();
			case 't':
				return ampmName.charAt(0).toLowerCase();
			case 'tt':
				return ampmName.toLowerCase();
			default:
				return match.replace(/\'/g, "") || "'";
			}
		});

		tmptime = $.trim(tmptime);
		return tmptime;
	};

	/*
	* the bad hack :/ override datepicker so it doesnt close on select
	// inspired: http://stackoverflow.com/questions/1252512/jquery-datepicker-prevent-closing-picker-when-clicking-a-date/1762378#1762378
	*/
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function(id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			tp_inst._limitMinMaxDateTime(inst, true);
			inst.inline = inst.stay_open = true;
			//This way the onSelect handler called from calendarpicker get the full dateTime
			this._base_selectDate(id, dateStr);
			inst.inline = inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst);
		} else {
			this._base_selectDate(id, dateStr);
		}
	};

	/*
	* second bad hack :/ override datepicker so it triggers an event when changing the input field
	* and does not redraw the datepicker on every selectDate event
	*/
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function(inst) {

		// don't popup the datepicker if there is another instance already opened
		var input = inst.input[0];
		if ($.datepicker._curInst &amp;&amp; $.datepicker._curInst != inst &amp;&amp; $.datepicker._datepickerShowing &amp;&amp; $.datepicker._lastInput != input) {
			return;
		}

		if (typeof(inst.stay_open) !== 'boolean' || inst.stay_open === false) {

			this._base_updateDatepicker(inst);

			// Reload the time control when changing something in the input text field.
			var tp_inst = this._get(inst, 'timepicker');
			if (tp_inst) {
				tp_inst._addTimePicker(inst);
			}
		}
	};

	/*
	* third bad hack :/ override datepicker so it allows spaces and colon in the input field
	*/
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if ($.datepicker._get(inst, 'constrainInput')) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null? tp_inst._defaults.showTimezone : tp_inst.support.timezone,					
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat')),
					datetimeChars = tp_inst._defaults.timeFormat.toString()
											.replace(/[hms]/g, '')
											.replace(/TT/g, ampm ? 'APM' : '')
											.replace(/Tt/g, ampm ? 'AaPpMm' : '')
											.replace(/tT/g, ampm ? 'AaPpMm' : '')
											.replace(/T/g, ampm ? 'AP' : '')
											.replace(/tt/g, ampm ? 'apm' : '')
											.replace(/t/g, ampm ? 'ap' : '') + 
											" " + tp_inst._defaults.separator + 
											tp_inst._defaults.timeSuffix + 
											(tz ? tp_inst._defaults.timezoneList.join('') : '') + 
											(tp_inst._defaults.amNames.join('')) + (tp_inst._defaults.pmNames.join('')) + 
											dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr &lt; ' ' || !dateChars || datetimeChars.indexOf(chr) &gt; -1);
			}
		}

		return $.datepicker._base_doKeyPress(event);
	};

	/*
	* Fourth bad hack :/ override _updateAlternate function used in inline mode to init altField
	*/
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	/* Update any alternate field to synchronise with the main field. */
	$.datepicker._updateAlternate = function(inst) {
		var tp_inst = this._get(inst, 'timepicker');
		if(tp_inst){
			var altField = tp_inst._defaults.altField;
			if (altField) { // update alternate field too
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = '', 
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator, 
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if(!tp_inst._defaults.timeOnly &amp;&amp; !tp_inst._defaults.altFieldTimeOnly &amp;&amp; date !== null){
					if(tp_inst._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime;
					}
					else{
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime;
					}
				}
				$(altField).val(altFormattedDateTime);
			}
		}
		else{
			$.datepicker._base_updateAlternate(inst);
		}
	};

	/*
	* Override key up event to sync manual input changes.
	*/
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if (tp_inst._defaults.timeOnly &amp;&amp; (inst.input.val() != inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst);
				} catch (err) {
					$.timepicker.log(err);
				}
			}
		}

		return $.datepicker._base_doKeyUp(event);
	};

	/*
	* override "Today" button to also grab the time.
	*/
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function(id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		this._base_gotoToday(id);
		var tp_inst = this._get(inst, 'timepicker');
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		$('.ui-datepicker-today', $dp).click();
	};

	/*
	* Disable &amp; enable the Time in the datetimepicker
	*/
	$.datepicker._disableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst);
		}
	};

	$.datepicker._enableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst); // Could be disabled on page load
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create our own set time function
	*/
	$.datepicker._setTime = function(inst, date) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var defaults = tp_inst._defaults;

			// calling _setTime with no date sets time to defaults
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;

			//check if within min/max times.. 
			tp_inst._limitMinMaxDateTime(inst, true);

			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create new public method to set only time, callable as $().datepicker('setTime', date)
	*/
	$.datepicker._setTimeDatepicker = function(target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date == "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec);
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds());
				}
				if (tp_date.toString() == 'Invalid Date') {
					tp_date = undefined;
				}
				this._setTime(inst, tp_date);
			}
		}

	};

	/*
	* override setDate() to allow setting time too within Date object
	*/
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function(target, date) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		if(typeof(date) === 'string'){
			date = new Date(date);
			if(!date.getTime()){
				$.timepicker.log("Error creating Date object from string.");
			}
		}

		var tp_inst = this._get(inst, 'timepicker');
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds());
		} else {
			tp_date = date;
		}
		
		// This is important if you are using the timezone option, javascript's Date 
		// object will only return the timezone offset for the current locale, so we 
		// adjust it accordingly.  If not using timezone option this won't matter..
		// If a timezone is different in tp, keep the timezone as is
		if(tp_inst){
			// look out for DST if tz wasn't specified
			if(!tp_inst.support.timezone &amp;&amp; tp_inst._defaults.timezone === null){
				tp_inst.timezone = tp_date.getTimezoneOffset()*-1;
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone);
		}

		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true);
	};

	/*
	* override getDate() to allow getting time too within Date object
	*/
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function(target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			// if it hasn't yet been defined, grab from field
			if(inst.lastVal === undefined){
				this._setDateFromField(inst, noDefault);
			}

			var date = this._getDate(inst);
			if (date &amp;&amp; tp_inst._parseTime($(target).val(), tp_inst.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);

				// This is important if you are using the timezone option, javascript's Date 
				// object will only return the timezone offset for the current locale, so we 
				// adjust it accordingly.  If not using timezone option this won't matter..
				if(tp_inst.timezone != null){
					// look out for DST if tz wasn't specified
					if(!tp_inst.support.timezone &amp;&amp; tp_inst._defaults.timezone === null){
						tp_inst.timezone = date.getTimezoneOffset()*-1;
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
				}
			}
			return date;
		}
		return this._base_getDateDatepicker(target, noDefault);
	};

	/*
	* override parseDate() because UI 1.8.14 throws an error about "Extra characters"
	* An option in datapicker to ignore extra format characters would be nicer.
	*/
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function(format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings);
		} catch (err) {
			// Hack!  The error message ends with a colon, a space, and
			// the "extra" characters.  We rely on that instead of
			// attempting to perfectly reproduce the parsing algorithm.
			if (err.indexOf(":") &gt;= 0) {
				date = this._base_parseDate(format, value.substring(0,value.length-(err.length-err.indexOf(':')-2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format);
			} else {
				throw err;
			}
		}
		return date;
	};

	/*
	* override formatDate to set date with time to the input
	*/
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function(inst, day, month, year) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val();
		}
		return this._base_formatDate(inst);
	};

	/*
	* override options setter to add time to maxDate(Time) and minDate(Time). MaxDate
	*/
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function(target, name, value) {
		var inst = this._getInst(target),
	        name_clone;
		if (!inst) {
			return null;
		}

		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop;
		    if (typeof name == 'string') { // if min/max was set with the string
		        if (name === 'minDate' || name === 'minDateTime') {
		            min = value;
		        } else if (name === 'maxDate' || name === 'maxDateTime') {
		            max = value;
		        } else if (name === 'onSelect') {
		            onselect = value;
		        } else if (overrides.hasOwnProperty(name)) {
		            if (typeof (value) === 'undefined') {
		                return overrides[name];
		            }
		            fns[name] = value;
		            name_clone = {}; //empty results in exiting function after overrides updated
		        }
		    } else if (typeof name == 'object') { //if min/max was set with the JSON
		        if (name.minDate) {
		            min = name.minDate;
		        } else if (name.minDateTime) {
		            min = name.minDateTime;
		        } else if (name.maxDate) {
		            max = name.maxDate;
		        } else if (name.maxDateTime) {
		            max = name.maxDateTime;
		        }
		        for (prop in overrides) {
		            if (overrides.hasOwnProperty(prop) &amp;&amp; name[prop]) {
		                fns[prop] = name[prop];
		            }
		        }
		    }
		    for (prop in fns) {
		        if (fns.hasOwnProperty(prop)) {
		            overrides[prop] = fns[prop];
		            if (!name_clone) { name_clone = $.extend({}, name);}
		            delete name_clone[prop];
		        }
		    }
		    if (name_clone &amp;&amp; isEmptyObject(name_clone)) { return; }
		    if (min) { //if min was set
		        if (min === 0) {
		            min = new Date();
		        } else {
		            min = new Date(min);
		        }
		        tp_inst._defaults.minDate = min;
		        tp_inst._defaults.minDateTime = min;
		    } else if (max) { //if max was set
		        if (max === 0) {
		            max = new Date();
		        } else {
		            max = new Date(max);
		        }
		        tp_inst._defaults.maxDate = max;
		        tp_inst._defaults.maxDateTime = max;
		    } else if (onselect) {
		        tp_inst._defaults.onSelect = onselect;
		    }
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name);
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
	};
	
	/*
	* jQuery isEmptyObject does not check hasOwnProperty - if someone has added to the object prototype,
	* it will return false for all objects
	*/
	var isEmptyObject = function(obj) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(obj)) {
				return false;
			}
		}
		return true;
	};

	/*
	* jQuery extend now ignores nulls!
	*/
	var extendRemove = function(target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] === null || props[name] === undefined) {
				target[name] = props[name];
			}
		}
		return target;
	};

	/*
	* Determine by the time format which units are supported
	* Returns an object of booleans for each unit
	*/
	var detectSupport = function(timeFormat){
		var tf = timeFormat.replace(/\'.*?\'/g,'').toLowerCase(), // removes literals
			isIn = function(f, t){ // does the format contain the token?
					return f.indexOf(t) !== -1? true:false; 
				};
		return {
				hour: isIn(tf,'h'),
				minute: isIn(tf,'m'),
				second: isIn(tf,'s'),
				millisec: isIn(tf,'l'),
				microsec: isIn(tf,'c'),
				timezone: isIn(tf,'z'),
				ampm: isIn(tf,'t') &amp;&amp; isIn(timeFormat,'h'),
				iso8601: isIn(timeFormat, 'Z')
			};
	};

	/*
	* Converts 24 hour format into 12 hour
	* Returns 12 hour without leading 0
	*/
	var convert24to12 = function(hour) {
		if (hour &gt; 12) {
			hour = hour - 12;
		}

		if (hour === 0) {
			hour = 12;
		}

		return String(hour);
	};

	/*
	* Splits datetime string into date ans time substrings.
	* Throws exception when date can't be parsed
	* Returns [dateString, timeString]
	*/
	var splitDateTime = function(dateFormat, dateTimeString, dateSettings, timeSettings) {
		try {
			// The idea is to get the number separator occurances in datetime and the time format requested (since time has 
			// fewer unknowns, mostly numbers and am/pm). We will use the time pattern to split.
			var separator = timeSettings &amp;&amp; timeSettings.separator ? timeSettings.separator : $.timepicker._defaults.separator,
				format = timeSettings &amp;&amp; timeSettings.timeFormat ? timeSettings.timeFormat : $.timepicker._defaults.timeFormat,
				timeParts = format.split(separator), // how many occurances of separator may be in our format?
				timePartsLen = timeParts.length,
				allParts = dateTimeString.split(separator),
				allPartsLen = allParts.length;

			if (allPartsLen &gt; 1) {
				return [
						allParts.splice(0,allPartsLen-timePartsLen).join(separator),
						allParts.splice(0,timePartsLen).join(separator)
					];
			}

		} catch (err) {
			$.timepicker.log('Could not split the date from the time. Please check the following datetimepicker options' +
					"\nthrown error: " + err +
					"\ndateTimeString" + dateTimeString +
					"\ndateFormat = " + dateFormat +
					"\nseparator = " + timeSettings.separator +
					"\ntimeFormat = " + timeSettings.timeFormat);

			if (err.indexOf(":") &gt;= 0) {
				// Hack!  The error message ends with a colon, a space, and
				// the "extra" characters.  We rely on that instead of
				// attempting to perfectly reproduce the parsing algorithm.
				var dateStringLength = dateTimeString.length - (err.length - err.indexOf(':') - 2),
					timeString = dateTimeString.substring(dateStringLength);

				return [$.trim(dateTimeString.substring(0, dateStringLength)), $.trim(dateTimeString.substring(dateStringLength))];

			} else {
				throw err;
			}
		}
		return [dateTimeString, ''];
	};

	/*
	* Internal function to parse datetime interval
	* Returns: {date: Date, timeObj: Object}, where
	*   date - parsed date without time (type Date)
	*   timeObj = {hour: , minute: , second: , millisec: , microsec: } - parsed time. Optional
	*/
	var parseDateTimeInternal = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var date;
		var splitRes = splitDateTime(dateFormat, dateTimeString, dateSettings, timeSettings);
		date = $.datepicker._base_parseDate(dateFormat, splitRes[0], dateSettings);
		if (splitRes[1] !== '') {
			var timeString = splitRes[1],
				parsedTime = $.datepicker.parseTime(timeFormat, timeString, timeSettings);

			if (parsedTime === null) {
				throw 'Wrong time format';
			}
			return {
				date: date,
				timeObj: parsedTime
			};
		} else {
			return {
				date: date
			};
		}
	};

	/*
	* Internal function to set timezone_select to the local timezone
	*/
	var selectLocalTimezone = function(tp_inst, date) {
		if (tp_inst &amp;&amp; tp_inst.timezone_select) {
			var now = typeof date !== 'undefined' ? date : new Date();
			tp_inst.timezone_select.val(now.getTimezoneOffset()*-1);
		}
	};

	/*
	* Create a Singleton Insance
	*/
	$.timepicker = new Timepicker();

	/**
	 * Get the timezone offset as string from a date object (eg '+0530' for UTC+5.5)
	 * @param  number if not a number this value is returned
	 * @param boolean if true formats in accordance to iso8601 "+12:45"
	 * @return string
	 */
	$.timepicker.timezoneOffsetString = function(tzMinutes, iso8601) {
		if(isNaN(tzMinutes) || tzMinutes &gt; 840){
			return tzMinutes;
		}

		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601? ':':'',
			tz = (off &gt;= 0 ? '+' : '-') + ('0' + (hours * 101).toString()).slice(-2) + iso + ('0' + (minutes * 101).toString()).slice(-2);
		
		if(tz == '+00:00'){
			return 'Z';
		}
		return tz;
	};

	/**
	 * Get the number in minutes that represents a timezone string
	 * @param  string formated like "+0500", "-1245"
	 * @return number
	 */
	$.timepicker.timezoneOffsetNumber = function(tzString) {
		tzString = tzString.toString().replace(':',''); // excuse any iso8601, end up with "+1245"

		if(tzString.toUpperCase() === 'Z'){ // if iso8601 with Z, its 0 minute offset
			return 0;
		}

		if(!/^(\-|\+)\d{4}$/.test(tzString)){ // possibly a user defined tz, so just give it back
			return tzString;
		}

		return ((tzString.substr(0,1) =='-'? -1 : 1) * // plus or minus
					((parseInt(tzString.substr(1,2),10)*60) + // hours (converted to minutes)
					parseInt(tzString.substr(3,2),10))); // minutes
	};

	/**
	 * No way to set timezone in js Date, so we must adjust the minutes to compensate. (think setDate, getDate)
	 * @param  date
	 * @param  string formated like "+0500", "-1245"
	 * @return date
	 */
	$.timepicker.timezoneAdjust = function(date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if(!isNaN(toTz)){
			date.setMinutes(date.getMinutes()*1 + (date.getTimezoneOffset()*-1 - toTz*1) );
		}
		return date;
	};

	/**
	 * Calls `timepicker()` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * n.b. The input value must be correctly formatted (reformatting is not supported)
	 * @param  Element startTime
	 * @param  Element endTime
	 * @param  obj options Options for the timepicker() call
	 * @return jQuery
	 */
	$.timepicker.timeRange = function(startTime, endTime, options) {
		return $.timepicker.handleRange('timepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datetimepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @param  Element startTime
	 * @param  Element endTime
	 * @param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @param  string method Can be used to specify the type of picker to be added
	 * @return jQuery
	 */
	$.timepicker.datetimeRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datetimepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @param  Element startTime
	 * @param  Element endTime
	 * @param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @return jQuery
	 */
	$.timepicker.dateRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @param  string method Can be used to specify the type of picker to be added
	 * @param  Element startTime
	 * @param  Element endTime
	 * @param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @return jQuery
	 */
	$.timepicker.handleRange = function(method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0, // min allowed interval in milliseconds
			maxInterval: 0, // max allowed interval in milliseconds
			start: {},      // options for start picker
			end: {}         // options for end picker
		}, options);

		$.fn[method].call(startTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), endTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), endTime, 'minDate');
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), startTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), startTime, 'maxDate');
			}
		}, options, options.end));

		checkDates(startTime, endTime);
		selected(startTime, endTime, 'minDate');
		selected(endTime, startTime, 'maxDate');

		function checkDates(changed, other) {
			var startdt = startTime[method]('getDate'),
				enddt = endTime[method]('getDate'),
				changeddt = changed[method]('getDate');

			if(startdt !== null){
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());

				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);

				if(options.minInterval &gt; 0 &amp;&amp; minDate &gt; enddt){ // minInterval check
					endTime[method]('setDate',minDate);
				}
				else if(options.maxInterval &gt; 0 &amp;&amp; maxDate &lt; enddt){ // max interval check
					endTime[method]('setDate',maxDate);
				}
				else if (startdt &gt; enddt) {
					other[method]('setDate',changeddt);
				}
			}
		}

		function selected(changed, other, option) {
			if (!changed.val()) {
				return;
			}
			var date = changed[method].call(changed, 'getDate');
			if(date !== null &amp;&amp; options.minInterval &gt; 0){
				if(option == 'minDate'){
					date.setMilliseconds(date.getMilliseconds() + options.minInterval); 
				}
				if(option == 'maxDate'){
					date.setMilliseconds(date.getMilliseconds() - options.minInterval);
				}
			}
			if (date.getTime) {
				other[method].call(other, 'option', option, date);
			}
		}
		return $([startTime.get(0), endTime.get(0)]);
	};

	/**
	 * Log error or data to the console during error or debugging
	 * @param  Object err pass any type object to log to the console during error or debugging
	 * @return void
	 */
	$.timepicker.log = function(err){
		if(window.console){
			console.log(err);
		}
	};

	/*
	* Microsecond support
	*/
	if(!Date.prototype.getMicroseconds){
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function(){ return this.microseconds; };
		Date.prototype.setMicroseconds = function(m){ 
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m/1000));
			this.microseconds = m%1000;
			return this;
		};
	}

	/*
	* Keep up with the version
	*/
	$.timepicker.version = "1.3.1";

})(jQuery);
jQuery.noConflict();
});</code>
</property>
<property>
<name>datetimepicker-js</name>
</property>
<property>
<parse>0</parse>
</property>
<property>
<use>currentPage</use>
</property>
</object>
<object>
<class>
<name>XWiki.JavaScriptExtension</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<cache>
<cache>0</cache>
<disabled>0</disabled>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>cache</name>
<number>5</number>
<prettyName>Caching policy</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>long|short|default|forbid</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</cache>
<code>
<disabled>0</disabled>
<name>code</name>
<number>2</number>
<prettyName>Code</prettyName>
<rows>20</rows>
<size>50</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</code>
<name>
<disabled>0</disabled>
<name>name</name>
<number>1</number>
<prettyName>Name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
<parse>
<disabled>0</disabled>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>parse</name>
<number>4</number>
<prettyName>Parse content</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</parse>
<use>
<cache>0</cache>
<disabled>0</disabled>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>use</name>
<number>3</number>
<prettyName>Use this extension</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>currentPage=Always on this page|onDemand=On demand|always=Always on this wiki</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</use>
</class>
<name>WiperDog.WebHome</name>
<number>4</number>
<className>XWiki.JavaScriptExtension</className>
<guid>e73a652e-09fc-4c71-8e7a-e2525a2d2a99</guid>
<property>
<cache>default</cache>
</property>
<property>
<code>require(['jquery'],function($){
function replaceAllString(oriStr, strTarget, strSubString ){
   var strText = oriStr;
   var intIndexOfMatch = strText.indexOf( strTarget );
   while (intIndexOfMatch != -1){
      strText = strText.replace( strTarget, strSubString )
      intIndexOfMatch = strText.indexOf( strTarget );
   }
   return( strText );
}
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&amp;]" + name + "=([^&amp;#]*)"),
    results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
};


   var jobName= getParameterByName('job')
   var fromDate= getParameterByName('fromDate')
   var toDate= getParameterByName('toDate')
   var limit= getParameterByName('limit')
   var selectedIstIid = getParameterByName('IstIid')

  $("#jobname").ready(function(){
   $("#jobname").text(jobName)
   var convertedJobName = replaceAllString(jobName, ".", "_")
   $("#IstIid" + convertedJobName).ready(function(){
     $("#IstIid" + convertedJobName).css("display","block")
     $("#select_" + convertedJobName).ready(function(){
        $("#select_" + convertedJobName).val(selectedIstIid)
     });
   });
 });

  $("#fromDate").ready(function(){
   $("#from-date").val(fromDate)
 });

  $("#toDate").ready(function(){
   $("#to-date").val(toDate)
 });

  $("#limit").ready(function(){
   if(limit!=""){
    $("#limit").val(limit)
   }
 });
 // Get data with ajax
 function ajax_getData(jobName,fromDate,toDate,limit ){
       var convertedJobName = replaceAllString(jobName, ".", "_")
       var istIid = $("#select_" + convertedJobName).val()
       window.location="/xwiki/bin/view/WiperDog/WebHome?job="+jobName+"&amp;limit="+limit+"&amp;fromDate="+fromDate+"&amp;toDate="+toDate+"&amp;IstIid="+istIid;
 			/*$.ajax({
			 type: "GET",
			 url:"/xwiki/bin/get/Sandbox/DescriptionForJob?outputSyntax=plain&amp;job="+jobName+"&amp;limit="+limit+"&amp;fromDate="+fromDate+"&amp;toDate="+toDate+"&amp;IstIid"+selectedIstIid,
			 success : function(result){
				$("#jobname").html(jobName)
				$("#display").text('[[]]' + result)
			 }
		   });*/
 }
	$("#treemenu2 a").click(function(){
		 var limit = 10
		 var fromDate=""
		 var toDate = ""
		 jobName= $(this).text()
                 $("#jobname").html(jobName)
                 var convertedJobName = replaceAllString(jobName, ".", "_")
                 $("#listIstIid &gt; div").css("display","none")
                 $("#IstIid" + convertedJobName).css("display","block")
		 //ajax_getData(jobName,fromDate,toDate,limit )

	});

	$("#from-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
		dateFormat: 'yy-mm-dd',
	});
	$("#to-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
			dateFormat: 'yy-mm-dd',

	});
	 $("#get-data").on("click",function(){
		var fromDate = $("#from-date").val()
		var toDate =  $("#to-date").val()
		 if( toDate!= "" ){
			  if(fromDate != ""){
				  if($("#from-date").datepicker( "getDate" ) &gt; $("#to-date").datepicker( "getDate" )){
				  alert("'From date' cannot start later than 'To date'")
				  return false
				  }
			  }
		 }
		 limit = $("#limit").val()
		 ajax_getData(jobName,fromDate,toDate,limit )
	});
$(document).ready(function(){
  var keys = $("#lstkey").text()
  //console.log('key == ' + keys);
  //console.log('livetableJson ==' + $("#livetableJson").text());
  
  var jsonObj = $.parseJSON($("#livetableJson").text()); 
  if(keys &amp;&amp; keys != '[ ]'){
    /** Subtyped **/    
    var newKeys = keys.replace('[',"");
    keys = newKeys.replace(']',"");
    var keyArr = (keys.indexOf(',') != -1)? keys.split(','):new Array(keys);
    //console.log('Key after replace: '+keys)       
    for(var i=0;i&lt;keyArr.length;i++){
        var keyName = keyArr[i].trim().replace('',"").replace("\"","").replace('\"','');
        var subTypeJsonObjStr = jsonObj[keyName].replace('#livetablePager','#livetablePager_'+keyName)
        var subTypeJsonObj = $.parseJSON(subTypeJsonObjStr);
        $("#livetableList_"+keyName).jqGrid(subTypeJsonObj);
        $("#livetableList_"+keyName).jqGrid('navGrid', "#livetablePager_"+keyName, {
           edit : false,
           add : false,
           del : false,
           search:false
         });
    }
    
  }else{ /** Store**/        
      $("#livetableList").jqGrid(jsonObj);
      $("#livetableList").jqGrid('navGrid', "#livetablePager", {
           edit : false,
           add : false,
           del : false,
           search:false
           
       });
   }
});
        
jQuery.noConflict()
});</code>
</property>
<property>
<name>process</name>
</property>
<property>
<parse>0</parse>
</property>
<property>
<use>currentPage</use>
</property>
</object>
<object>
<class>
<name>XWiki.JavaScriptExtension</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<cache>
<cache>0</cache>
<disabled>0</disabled>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>cache</name>
<number>5</number>
<prettyName>Caching policy</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>long|short|default|forbid</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</cache>
<code>
<disabled>0</disabled>
<name>code</name>
<number>2</number>
<prettyName>Code</prettyName>
<rows>20</rows>
<size>50</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</code>
<name>
<disabled>0</disabled>
<name>name</name>
<number>1</number>
<prettyName>Name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
<parse>
<disabled>0</disabled>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>parse</name>
<number>4</number>
<prettyName>Parse content</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</parse>
<use>
<cache>0</cache>
<disabled>0</disabled>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>use</name>
<number>3</number>
<prettyName>Use this extension</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>currentPage=Always on this page|onDemand=On demand|always=Always on this wiki</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</use>
</class>
<name>WiperDog.WebHome</name>
<number>5</number>
<className>XWiki.JavaScriptExtension</className>
<guid>881686cc-1bfc-456e-b8ab-71334c4a45e5</guid>
<property>
<cache>default</cache>
</property>
<property>
<code>require(['jquery'],function($){

	$(function () {
		function drawLineChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerline' + container).highcharts({

				chart: {
					type:'line'
				},
				title: {
					text: chart_name
				},
				tooltip :{
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&lt;p&gt;" + k + " : " + detail_data[j][k] + "&lt;/p&gt;&lt;br&gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				xAxis: dataXAxis ,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				series: dataSeries
			});
		};

		function drawBarChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerbar' + container).highcharts({
				chart: {
					type: 'column'
				},
				title: {
					text: chart_name
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&lt;p&gt;" + k + " : " + detail_data[j][k] + "&lt;/p&gt;&lt;br&gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {

					column: {
						pointPadding: 0.2,
						borderWidth: 0
					}
				},
				series: dataSeries
			});
		}

		function drawAreaChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail
			$('#containerarea' + container).highcharts({
				chart: {
					type: 'area'
				},
				title: {
					text: chart_name
				},
				subtitle: {
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					},
					labels: {
						formatter: function() {
							return this.value / 1000;
						}
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&lt;p&gt;" + k + " : " + detail_data[j][k] + "&lt;/p&gt;&lt;br&gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {
					area: {
						stacking: 'normal',
						lineColor: '#666666',
						lineWidth: 1,
						marker: {
							lineWidth: 1,
							lineColor: '#666666'
						}
					}
				},
				series: dataSeries
			});
		};

		function drawPieChart(data, container, chartName){
			var dataPie = data
			$(document).ready(function () {
				// Build the chart
				$('#container' + container).highcharts({
					chart: {
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: chartName
					},
					tooltip: {
						pointFormat: '{series.name}: &lt;b&gt;{point.percentage:.1f}%&lt;/b&gt;'
					},
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							dataLabels: {
								enabled: true,
                                                                color: '#000000',
                                                                connectorColor: '#000000',
                                                                format: '&lt;b&gt;{point.name}&lt;/b&gt;: {point.percentage:.1f} %'
							},
							showInLegend: true
						}
					},
					series: dataPie
				});
			});
		}

		// LINE
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
			if(lstKey.length &gt; 0) {
				for(var eKey=0;eKey&lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                     if(($("#jsons&gt;#jsonline_" + finalKey)).length &gt; 0) {
					var arrayAll = jQuery.parseJSON($("#jsons&gt;#jsonline_" + finalKey).val());
					var arrayContainerAll = jQuery.parseJSON($("#jsons&gt;.lstcontainerline_" + finalKey).val());
				        var lstContainer = [];
  				        var data_all = [];
                                        var chartSize = arrayAll.length

                                        for(var i=0;i&lt;chartSize ;i++){
                                           data_all = arrayAll[i]
                                           lstContainer = arrayContainerAll[i]
				           if(data_all.length &gt;0 &amp;&amp; lstContainer.length &gt;0){
					        // data to display on tooltip
					        var data_detail = data_all[0]
					        // draw Line chart
				        	for(var j=0;j&lt;data_all.length;j++){
				        		if(data_all[j].series[0].name == null){
				        			data_all[j].series[0].name = lstContainer[j]
					        	}
                                                        chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					        	drawLineChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					        }
				         }
                                      }
                                  }
				}
			} else {
				var arrayAll = jQuery.parseJSON($("#jsons&gt;.jsonline").val());
				var arrayContainerAll = jQuery.parseJSON($("#jsons&gt;.lstcontainerline").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length

                                for(var i=0;i&lt;chartSize ;i++){
                                   data_all = arrayAll[i]
                                   lstContainer = arrayContainerAll[i]
				   if(data_all.length &gt;0 &amp;&amp; lstContainer.length &gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Line chart
					for(var j=0;j&lt;data_all.length;j++){
						if(data_all[j].series[0].name == null){
							data_all[j].series[0].name = lstContainer[j]
						}
                                                chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
						drawLineChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
				   }
                                }
			}
		});

		// BAR
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
			if(lstKey.length &gt; 0) {
				for(var eKey=0;eKey&lt;lstKey.length;eKey++){
			             var finalKey = lstKey[eKey]
                                     if(($("#jsons&gt;#jsonbar_" + finalKey)).length &gt; 0) {
					var arrayAll = jQuery.parseJSON($("#jsons&gt;#jsonbar_" + finalKey).val());
					var arrayContainerAll = jQuery.parseJSON($("#jsons&gt;.lstcontainerbar_" + finalKey).val());
					var lstContainer = [];
					var data_all = [];
                                        var chartSize = arrayAll.length
					for(var i=0;i&lt;chartSize ;i++){
					    data_all = arrayAll[i]
					    lstContainer = arrayContainerAll[i]
					    if(data_all.length &gt;0 &amp;&amp; lstContainer.length &gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw bar chart
						for(var j=0;j&lt;data_all.length;j++){
							if(data_all[j].series[0].name == null){
								data_all[j].series[0].name = lstContainer[j]
							}
                                                        chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
							drawBarChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
						}
                                            }
					}
                                    }
				}
			} else {
                                var arrayAll = jQuery.parseJSON($("#jsons&gt;.jsonbar").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&gt;.lstcontainerbar").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
				    if(data_all.length &gt;0 &amp;&amp; lstContainer.length &gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Bar chart
					for(var j=0;j&lt;data_all.length;j++){
                                            if(data_all[j].series[0].name == null){
						data_all[j].series[0].name = lstContainer[j]
					    }
                                            chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					    drawBarChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
                                    }
				}
			}
		});

		// AREA
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
                        var arrayAll
                        var arrayContainerAll
			if(lstKey.length &gt; 0) {
				for(var eKey=0;eKey&lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                        if(($("#jsons&gt;#jsonarea_" + finalKey)).length &gt; 0) {
                                           arrayAll = jQuery.parseJSON($("#jsons&gt;#jsonarea_" + finalKey).val());
                                           arrayContainerAll = jQuery.parseJSON($("#jsons&gt;.lstcontainerarea_" + finalKey).val());
					   var lstContainer = [];
					   var data_all = [];
                                           var chartSize = arrayAll.length
					   for(var i=0;i&lt;chartSize ;i++){
					       data_all = arrayAll[i]
					       lstContainer = arrayContainerAll[i]
					       if(data_all.length &gt;0 &amp;&amp; lstContainer.length &gt;0){
						   // data to display on tooltip
						   var data_detail = data_all[0]
						   // draw Line chart
						   for(var j=0;j&lt;data_all.length;j++){
						      if(data_all[j].series[0].name == null){
						         data_all[j].series[0].name = lstContainer[j]
						       }
                                                       chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
						       drawAreaChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
						   }
					      }
				           }
                                        }
			          }
                        } else {
                                var arrayAll = jQuery.parseJSON($("#jsons&gt;.jsonarea").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&gt;.lstcontainerarea").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
				    if(data_all.length &gt;0 &amp;&amp; lstContainer.length &gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw area chart
					for(var j=0;j&lt;data_all.length;j++){
                                            if(data_all[j].series[0].name == null){
						data_all[j].series[0].name = lstContainer[j]
					    }
                                            chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					    drawAreaChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
                                    }
				}
			}
		});

		// PIE
		$(document ).ready(function(){
                        var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
                        var arrayAll
                        var arrayContainerAll
			if(lstKey.length &gt; 0) {
				for(var eKey=0;eKey&lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                        if(($("#jsons&gt;#jsonpie_" + finalKey)).length &gt; 0) {
                                           arrayAll = jQuery.parseJSON($("#jsons&gt;#jsonpie_" + finalKey).val());
                                           arrayContainerAll = jQuery.parseJSON($("#jsons&gt;.lstcontainerpie_" + finalKey).val());
					   var lstContainer = [];
					   var data_all = [];
                                           var chartSize = arrayAll.length
					  for(var i=0;i&lt;chartSize ;i++){
					       data_all = arrayAll[i]
					       lstContainer = arrayContainerAll[i]
					       if(data_all.length &gt;0 &amp;&amp; lstContainer.length &gt;0){
						   // draw Pie chart
						   for(var j=0;j&lt;data_all.length;j++){
                                                       chartName  = data_all[j].chart_name + "( " + data_all[j].name + " )"
						       drawPieChart([data_all[j]], finalKey + "_" + lstContainer[j], chartName)
						   }
					      }
				           }
                                        }
			          }
			} else {
                                var arrayAll = jQuery.parseJSON($("#jsons&gt;.jsonpie").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&gt;.lstcontainerpie").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
                                var chartNum = 0
				for(var i=0;i&lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
                                    if(data_all.length &gt;0 &amp;&amp; lstContainer.length &gt;0){
                                                   for(var j=0;j&lt;data_all.length;j++){
                                                       if (data_all[j].name != data_all[j].chart_name) {
                                                           chartName  = data_all[j].chart_name + "( " + data_all[j].name + " )"
                                                       } else {
                                                           chartName  = data_all[j].chart_name
                                                       }
						       drawPieChart([data_all[j]], chartNum + "_pie", chartName)
                                                       chartNum++
						   }

                                    }
                                }
			}
		});
	});
	jQuery.noConflict()
});</code>
</property>
<property>
<name>drawChart-js</name>
</property>
<property>
<parse>0</parse>
</property>
<property>
<use>currentPage</use>
</property>
</object>
<object>
<class>
<name>XWiki.StyleSheetExtension</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<cache>
<cache>0</cache>
<disabled>0</disabled>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>cache</name>
<number>5</number>
<prettyName>Caching policy</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>long|short|default|forbid</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</cache>
<code>
<disabled>0</disabled>
<name>code</name>
<number>2</number>
<prettyName>Code</prettyName>
<rows>20</rows>
<size>50</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</code>
<name>
<disabled>0</disabled>
<name>name</name>
<number>1</number>
<prettyName>Name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
<parse>
<disabled>0</disabled>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>parse</name>
<number>4</number>
<prettyName>Parse content</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</parse>
<use>
<cache>0</cache>
<disabled>0</disabled>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>use</name>
<number>3</number>
<prettyName>Use this extension</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>currentPage=Always on this page|onDemand=On demand|always=Always on this wiki</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</use>
</class>
<name>WiperDog.WebHome</name>
<number>1</number>
<className>XWiki.StyleSheetExtension</className>
<guid>d5873d92-b78b-42fc-9407-46d166204b88</guid>
<property>
<cache>default</cache>
</property>
<property>
<code>/* css for timepicker */
.ui-timepicker-div .ui-widget-header { 
margin-bottom: 8px;
 }

.ui-timepicker-div dl { text-align: left; }
.ui-timepicker-div dl dt { height: 25px; margin-bottom: -25px; }
.ui-timepicker-div dl dd { margin: 0 10px 10px 65px; }
.ui-timepicker-div td { font-size: 90%; }
.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }

.ui-timepicker-rtl{ direction: rtl; }
.ui-timepicker-rtl dl { text-align: right; }
.ui-timepicker-rtl dl dd { margin: 0 65px 10px 10px; }
#ui-datepicker-div{
 position:relative;
 width:auto;
 height:auto
}
</code></property><property><name>datetimepicker -css</name>
</property>
<property>
<parse>0</parse>
</property>
<property>
<use>currentPage</use>
</property>
</object>
<object>
<class>
<name>XWiki.StyleSheetExtension</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<cache>
<cache>0</cache>
<disabled>0</disabled>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>cache</name>
<number>5</number>
<prettyName>Caching policy</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>long|short|default|forbid</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</cache>
<code>
<disabled>0</disabled>
<name>code</name>
<number>2</number>
<prettyName>Code</prettyName>
<rows>20</rows>
<size>50</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</code>
<name>
<disabled>0</disabled>
<name>name</name>
<number>1</number>
<prettyName>Name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
<parse>
<disabled>0</disabled>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>parse</name>
<number>4</number>
<prettyName>Parse content</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</parse>
<use>
<cache>0</cache>
<disabled>0</disabled>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>use</name>
<number>3</number>
<prettyName>Use this extension</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>currentPage=Always on this page|onDemand=On demand|always=Always on this wiki</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</use>
</class>
<name>WiperDog.WebHome</name>
<number>2</number>
<className>XWiki.StyleSheetExtension</className>
<guid>1201fb1a-e9c1-4731-8c74-2ea8c0071959</guid>
<property>
<cache>default</cache>
</property>
<property>
<code>.displayblock {
  border:2px solid;
  -webkit-border-radius:6px;
  background:gray;
  float: left;
  width:100%;
}

.displaypie {
  border:1px solid;
  -webkit-border-radius:6px;
  background:gray;
  width: 48%;
  float: left; 
  height: 300px;
}

.subtype {
  margin-top: 50px;
  font-size: 2em;
  color: red;
}</code>
</property>
<property>
<name>drawChart-css</name>
</property>
<property>
<parse>0</parse>
</property>
<property>
<use>currentPage</use>
</property>
</object>
<content>{{include document="Lib.DataToDrawChart"/}}
{{include document="Lib.MongoDBConnection"/}}
{{velocity}}
$xwiki.jsx.use('Lib.JQueryUILib')
$xwiki.ssx.use('Lib.MenuGenerator')
$xwiki.jsx.use('Lib.MenuGenerator')
$xwiki.ssx.use('Lib.JQueryUILib')
$xwiki.jsx.use('Lib.JqGridLib')
$xwiki.ssx.use('Lib.JqGridLib') 
{{/velocity}}
{{include document="Lib.MenuGenerator"/}}
{{html wiki="true" clean="false"}}
&lt;div id="viewer"&gt;
&lt;table style="text-align:left"  &gt;
 &lt;tr&gt;
  &lt;th &gt;Job name&lt;/th&gt;
  &lt;td colspan=3&gt;&lt;div id="jobname"&gt;&lt;/div&gt;&lt;/td&gt;
 &lt;/tr&gt;
{{groovy}}
import org.xwiki.context.*

def ec = services.component.getInstance(Execution.class).getContext()
def mapJobIstIid = ec.getProperty("mapJobIstIid")

println '{{html clean="false" wiki="false"}}'
println '&lt;tr&gt;'
println '&lt;th&gt;IstIid&lt;/th&gt;'
println '&lt;td colspan=3&gt;'
mapJobIstIid.each{jobEntry-&gt;
  def convertedJobKey = jobEntry.key.replaceAll("\\.","_")
  println "&lt;div id='listIstIid'&gt;"
  println "&lt;div id=IstIid${convertedJobKey} style='display:none'&gt;"
  println "&lt;select id=select_${convertedJobKey}&gt;"
  jobEntry.value.each{
     println "&lt;option value=\"$it\"&gt;$it&lt;/option&gt;"
  }
  println "&lt;/select&gt;"
  println "&lt;/div&gt;"
  println "&lt;/div&gt;"
}
println '&lt;/td&gt;'
println '&lt;/tr&gt;'
println '{{/html}}'
{{/groovy}}
 &lt;tr&gt;
  &lt;th&gt;Data monitor from&lt;/th&gt;
  &lt;td&gt;&lt;input type="text" name="from-date" id="from-date"/&gt;&lt;/td&gt;
  &lt;th&gt;Data monitor to&lt;/th&gt;
  &lt;td&gt;&lt;input type="text" name="to-date" id="to-date"/&gt;&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
  &lt;th&gt;Data records limit &lt;/th&gt;
  &lt;td &gt;
     &lt;select id="limit"&gt;
       &lt;option value=5&gt;5&lt;/option&gt;
       &lt;option value=10&gt;10&lt;/option&gt;
       &lt;option value=15&gt;15&lt;/option&gt;
       &lt;option value=20&gt;20&lt;/option&gt;
     &lt;/select&gt;
  &lt;/td&gt;
  &lt;td colspan=3 &gt;&lt;input type="button" value="View Data" id="get-data" class="button"/&gt;&lt;/td&gt;
 &lt;/tr&gt;
 
 &lt;tr style="display:none"&gt;&lt;td colspan=3&gt;&lt;div id="display"&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;

&lt;/div&gt; 
   
 &lt;/body&gt;

{{/html}}
{{groovy}}
import groovy.json.*
xwiki.jsx.use("Lib.Highcharts")

if(request.xpage == "plain") {
	response.setContentType('text/plain')
}

def listData = []
def job = request.get("job")
def fromDate = request.get("fromDate")
def toDate = request.get("toDate")
def limit= (request.get("limit")!=null)?request.get("limit").toInteger():10
def istIid = request.get("IstIid")

def str= "No data to retrieved !"
def result = null
if(job != "" &amp;&amp; job != null &amp;&amp; istIid != null &amp;&amp; istIid != ""){
	MongoDBConnection.getConnection()
	if(fromDate != "" || toDate != ""){
		result = MongoDBConnection.getDataInPeriod(job,fromDate,toDate,limit,istIid)
	} else {
		result = MongoDBConnection.getDataAllFields(job,limit,istIid)
        }
MongoDBConnection.closeConnection()
} else {
   println "{{warning}}There are no selected job or IstIid{{/warning}}"
}
def listKey = []
if( (result != null) &amp;&amp; (result.size() &gt; 0) &amp;&amp; (result[0].KEYEXPR != null)&amp;&amp;!(result[0].KEYEXPR instanceof List )){

//Format data fetchAt
result.each {item -&gt;
    def newdate = new Date().parse("yyyyMMddHHmmssz", item['fetchAt'])
    item['fetchAt'] = newdate.format('yyyy/MM/dd HH:mm:ss z')
}

//Draw chart
if(result[0].type == "Subtyped") {
    println '{{html clean="false" wiki="true"}}'
    //println '&lt;body&gt;'
    def dataSubtype = DataToDrawChart.getDataToDrawSubtype(result)
    dataSubtype.each {key,value -&gt;
        listKey.add(key)
    }
    def jsonkey = com.mongodb.util.JSON.serialize(listKey)
    println "&lt;textarea style=\"display:none\" id='lstkey' &gt;$jsonkey&lt;/textarea&gt;"

    dataSubtype.each {key,value -&gt;
            def dataLine = []
            def dataBar = []
            def dataPie = []
            def dataArea = []
            if(DataToDrawChart.getDataToDrawLine(value) != []) {
                dataLine = DataToDrawChart.getDataToDrawLine(value)
            }
            if(DataToDrawChart.getDataToDrawBar(value) != []) {
                dataBar = DataToDrawChart.getDataToDrawBar(value)
            }
            if(DataToDrawChart.getDataToDrawPie(value) != []) {
                dataPie = DataToDrawChart.getDataToDrawPie(value)
            }
            if(DataToDrawChart.getDataToDrawArea(value) != []) {
                dataArea = DataToDrawChart.getDataToDrawArea(value)
            }

		def chartColumnsLine = []
		def chartColumnsBar = []
		def chartColumnsArea = []
		def lstName

                dataLine.each {itemDataLine -&gt;
                    if(itemDataLine.size() &gt; 0 ){
		        chartColumnsLine.add(itemDataLine[0].chart_columns)
	            }
                }
                dataBar.each {itemDataBar -&gt;
                    if(itemDataBar.size() &gt; 0 ){
		        chartColumnsBar.add(itemDataBar[0].chart_columns)
	            }
                }
                dataArea.each {itemDataArea -&gt;
                    if(itemDataArea.size() &gt; 0 ){
		        chartColumnsArea.add(itemDataArea[0].chart_columns)
	            }
                }

		if(dataPie.size() &gt; 0 ){
			lstName = dataPie['name']
		}
		def tmpListNameContainer = []
                
		if(lstName != null) {
                        def chartNumPie = 0
                        def tmpLst
                        for(def nameContainer in lstName){
                           tmpLst = []
			   for(def nameContainerItem in nameContainer ){
				nameContainerItem = chartNumPie + "_" + nameContainerItem.replaceAll("\\.", "_")
				tmpLst.add(nameContainerItem )
		            }
                            tmpListNameContainer.add(tmpLst)
                            chartNumPie++
                         }
		}
		def jsonPie
		def jsonLine
		def jsonBar
		def jsonArea
		if(dataPie != []) {
		    jsonPie = com.mongodb.util.JSON.serialize(dataPie)
		}
		if(dataLine != []) {
		    jsonLine = com.mongodb.util.JSON.serialize(dataLine)
		}
		if(dataBar != []) {
		    jsonBar = com.mongodb.util.JSON.serialize(dataBar)
		}
		if(dataArea != []) {
		    jsonArea = com.mongodb.util.JSON.serialize(dataArea)
		}
		def jsonContainerPie
		if(tmpListNameContainer != []) {
			jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
		}
		def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
		def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
		def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

		println "&lt;div id='jsons' style = \"display:none\"&gt;"
		if(jsonLine != null) {
			println "&lt;textarea id=\"jsonline_$key\" &gt;$jsonLine &lt;/textarea&gt;"
			println "&lt;textarea class=\"lstcontainerline_$key\" &gt;$jsonContainerLine &lt;/textarea&gt;"
		}
		if(jsonBar != null) {
			println "&lt;textarea id=\"jsonbar_$key\"&gt;$jsonBar &lt;/textarea&gt;"
			println "&lt;textarea class='lstcontainerbar_$key' &gt;$jsonContainerBar &lt;/textarea&gt;"
		}
		if(jsonPie != null &amp;&amp; jsonContainerPie != null) {
			println "&lt;textarea id=\"jsonpie_$key\" &gt;$jsonPie &lt;/textarea&gt;"
			println "&lt;textarea class='lstcontainerpie_$key' &gt;$jsonContainerPie &lt;/textarea&gt;"
		}
		if(jsonArea != null) {
			println "&lt;textarea id=\"jsonarea_$key\" &gt;$jsonArea &lt;/textarea&gt;"
			println "&lt;textarea class='lstcontainerarea_$key' &gt;$jsonContainerArea &lt;/textarea&gt;"
		}

        println "&lt;/div&gt;"
        def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
        def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
          
        println "&lt;div style='clear:both'&gt;"
            def description = value.KEYEXPR._description[0][key]
            if(description != null) {
                println '&lt;div class=\"subtype\"&gt;Chart Of '+ key +': ' + description +'&lt;/div&gt;'
            } else {
                println '&lt;div class=\"subtype\"&gt;Chart Of '+ key +'&lt;/div&gt;'
            }
            println "-----"
            if(jsonPie != null) {
          println "&lt;div id=\"wrapperPieChart\" style=\"clear:both\"&gt;&lt;h1&gt;This chart is lastest monitoring data&lt;/h1&gt;"
	  chartNumPie = 0
          lstName.each{chartPieLst -&gt;
		chartPieLst.each {
	            def tmp = chartNumPie + "_" + it.replaceAll("\\.", "_")
		    println " &lt;div class=\"displaypie\" id=\"container${key}_${tmp}\" &gt;&lt;/div&gt;"
          	}
		chartNumPie++
	  }	
          println "&lt;/div&gt;"
            }
            if(jsonLine != null) {
          	def chartLineComment = false
		def chartNumLine = 0
          	chartColumnsLine.each{chartColumnsLineItem -&gt;
            		if(!chartLineComment){
               			println "&lt;div id=\"wrapperLineChart\" style=\" clear:both\"&gt;&amp;nbsp;&lt;h1&gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&lt;/h1&gt;"
               			chartLineComment = true  
            		}
		chartColumnsLineItem.each{
              		println " &lt;div class=\"displayblock\" id=\"containerline${key}_${chartNumLine}_${it}\"&gt;&lt;/div&gt;"
          	}
		chartNumLine ++
	    }
          println "&lt;/div&gt;"
            }
            println "&amp;nbsp;"

            if(jsonBar != null) {
          	def chartBarComment = false
  		def chartNumBar = 0
          	chartColumnsBar.each{chartColumnsBarItem -&gt;
             		if(!chartBarComment){
                		println "&lt;div id=\"wrapperBarChart\" style=\"clear:both\"&gt;&lt;h1&gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&lt;/h1&gt;"
                		chartBarComment = true
              		}  
			chartColumnsBarItem.each{
             			println " &lt;div class=\"displayblock\" id=\"containerbar${key}_${chartNumBar}_${it}\"&gt;&lt;/div&gt;"
          		}
			chartNumBar++
		}
          	println "&lt;/div&gt;"
            }
            println "&amp;nbsp;"

            if(jsonArea != null) {
          	def chartAreaComment = false
		def chartNumArea = 0
          	chartColumnsArea.each{chartColumnsAreaItem -&gt;
          		if(!chartAreaComment){
            			println "&lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&gt;&lt;h1&gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&lt;/h1&gt;"
            			chartAreaComment = true
          		}
			chartColumnsAreaItem.each{
            			println " &lt;div class=\"displayblock\" id=\"containerarea${key}_${chartNumArea}_${it}\"&gt;&lt;/div&gt;"
          		}
          		chartNumArea++
            	}
        	println "&lt;/div&gt;"
	    }
        /** Statistic data table **/
        println "&lt;center&gt;"        
        println "&lt;div id='livetblContent_"+key+"' style='width:100%;clear:both;align:middle;margin-top:10px'&gt;"   
        println "Statistics data for "+key
        println "&lt;table id='livetableList_"+key+"' style='width:100%;align:center'&gt;&lt;/table&gt;"
        println "&lt;div id='livetablePager_"+key+"' style='position:relative;width:100%'&gt;&lt;/div&gt;"
        println "&lt;/div&gt;"
        println "&lt;/center&gt;"
        println "&lt;script language='javascript'&gt;console.log('Create live table for "+key+"');&lt;/script&gt;"
    }
    //println '&lt;/body&gt;'
    println '{{/html}}'
} else if(result[0].type == "Store") {
	// data store
	def dataLine = DataToDrawChart.getDataToDrawLine(result)
	def dataBar = DataToDrawChart.getDataToDrawBar(result)
	def dataPie = DataToDrawChart.getDataToDrawPie(result)
	def dataArea = DataToDrawChart.getDataToDrawArea(result)
	def chartColumnsLine = []
	def chartColumnsBar = []
	def chartColumnsArea = []
	def lstName

        dataLine.each {itemDataLine -&gt;
            if(itemDataLine.size() &gt; 0 ){
		chartColumnsLine.add(itemDataLine[0].chart_columns)
	    }
        }

        dataBar.each {itemDataBar -&gt;
            if(itemDataBar.size() &gt; 0 ){
		chartColumnsBar.add(itemDataBar[0].chart_columns)
	    }
        }

        dataArea.each {itemDataArea -&gt;
            if(itemDataArea.size() &gt; 0 ){
		chartColumnsArea.add(itemDataArea[0].chart_columns)
	    }
        }

	if(dataPie.size() &gt; 0 ){
		lstName = dataPie['name']
	}

    println '{{html clean="false" wiki="true"}}'
    println '&lt;body&gt;'
  
    def tmpListNameContainer = []
    def chartNumPie = 0
    for(def nameContainer in lstName){
       for(def nameContainerItem in nameContainer ){
           nameContainerItem = chartNumPie + "_" + nameContainerItem.replaceAll("\\.", "_")
           tmpListNameContainer .add(nameContainerItem )
       }
    }
    
    def jsonPie = com.mongodb.util.JSON.serialize(dataPie)
    def jsonLine = com.mongodb.util.JSON.serialize(dataLine)
    def jsonBar = com.mongodb.util.JSON.serialize(dataBar)
    def jsonArea = com.mongodb.util.JSON.serialize(dataArea)

    def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
    def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
    def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
    def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

    def listEmpty = com.mongodb.util.JSON.serialize([])
    println "&lt;textarea style=\"display:none\" id='lstkey' &gt;$listEmpty&lt;/textarea&gt;" 

    println "&lt;div id='jsons' style = \"display:none\"&gt;"
    println "&lt;textarea class='jsonline' &gt;$jsonLine &lt;/textarea&gt;"
    println "&lt;textarea class='jsonbar' &gt;$jsonBar &lt;/textarea&gt;"
    println "&lt;textarea class='jsonpie' &gt;$jsonPie &lt;/textarea&gt;"
    println "&lt;textarea class='jsonarea' &gt;$jsonArea &lt;/textarea&gt;"

    println "&lt;textarea class='lstcontainerpie' &gt;$jsonContainerPie &lt;/textarea&gt;"
    println "&lt;textarea class='lstcontainerline' &gt;$jsonContainerLine &lt;/textarea&gt;"
    println "&lt;textarea class='lstcontainerbar' &gt;$jsonContainerBar &lt;/textarea&gt;"
    println "&lt;textarea class='lstcontainerarea' &gt;$jsonContainerArea &lt;/textarea&gt;"
    println "&lt;/div&gt;"

    def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
    def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
  
    println "&lt;div style='clear:both'&gt;"
  
    def chartPieComment = false
    chartNumPie = 0
    lstName.each{chartPieLst-&gt;
        if(!chartPieComment) {
            println "&lt;div id=\"wrapperPieChart\" style=\"clear:both\"&gt;&lt;h1&gt;This chart is lastest monitoring data&lt;/h1&gt;"
            chartPieComment = true
        }
        chartPieLst.each {
            def tmp = chartNumPie + "_pie"
            println " &lt;div class=\"displaypie\" id=\"container$tmp\" &gt;&lt;/div&gt;"
            chartNumPie++
        }
    }
    println "&lt;/div&gt;"
    	def chartLineComment = false
	def chartNum = 0
    	chartColumnsLine.each{chartColumnsLineItem -&gt;
	    	if(!chartLineComment){
	        	println "&lt;div id=\"wrapperLineChart\" style=\" clear:both\"&gt;&amp;nbsp;&lt;h1&gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&lt;/h1&gt;"
	        	chartLineComment = true  
	    	}
		chartColumnsLineItem.each{
	    		println " &lt;div class=\"displayblock\" id=\"containerline${chartNum}_${it}\"&gt;&lt;/div&gt;"
	    	}
		chartNum++
	}	
    	println "&lt;/div&gt;"
    	println "&amp;nbsp;"
    	def chartBarComment = false
	chartNum = 0
    	chartColumnsBar.each{chartColumnsBarItem -&gt;
	        if(!chartBarComment){
	            println "&lt;div id=\"wrapperBarChart\" style=\"clear:both\"&gt;&lt;h1&gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&lt;/h1&gt;"
	            chartBarComment = true
	        }  
		chartColumnsBarItem.each{
	    		println " &lt;div class=\"displayblock\" id=\"containerbar${chartNum}_${it}\"&gt;&lt;/div&gt;"
	  	}
		chartNum++
	}
  println "&lt;/div&gt;"
  println "&amp;nbsp;"
  	def chartAreaComment = false
	chartNum = 0
  	chartColumnsArea.each{chartColumnsAreaItem -&gt;
	  	if(!chartAreaComment){
	    		println "&lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&gt;&lt;h1&gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&lt;/h1&gt;"
	    		chartAreaComment = true
	  	}
		chartColumnsAreaItem.each{
    			println " &lt;div class=\"displayblock\" id=\"containerarea${chartNum}_${it}\"&gt;&lt;/div&gt;"
		}
		chartNum++
  	}
  println "&lt;/div&gt;"
println "&lt;/div&gt;"

//println '&lt;/body&gt;'
println '{{/html}}'
}
}else{
    println 'There is no data for this job with criterias'
}
//--=============== Start build for livetable
def subTypeURLMap = [:]
def dataModel = []
def dataUrl = ""
result.find{rec-&gt;				
    def subtractData = []
    
    //-- Parsing data and assign data to subtract list
    if(rec.type == "Store"){ //-- Store data type
        subtractData = rec['data']        
        subtractData.each{r2-&gt;					
            if(dataModel != null &amp;&amp; dataModel.size() &lt;=0){ 
                dataModel.add("Fetch At")
                dataModel.addAll(r2.keySet());					
            } 
        }        
        dataUrl = "/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;job="+job +"&amp;limit="+limit+"&amp;fromDate="+fromDate + "&amp;toDate=" + toDate + "&amp;istIid="+istIid        
        //-- Building data model				
        def model = []
        def colSpec
        dataModel.each{name-&gt;
            colSpec = [:]
            colSpec['name'] = name
            colSpec['index'] = name
            colSpec['width'] = "100"
            model.add(colSpec)
        }
        def dataModelStr = (new JsonBuilder(dataModel)).toPrettyString()
        def modelStr = (new JsonBuilder(model)).toPrettyString() 
        str = 
        "{\"url\":\""+dataUrl+"\",\"datatype\":\"json\","+
            "\"colNames\":"+ dataModelStr +
            ",\"colModel\":"+ modelStr +" ,\"rowList\":[10,20,30],"+
            "\"pager\":\"#livetablePager\", \"viewrecords\": true, \"sortname\": \"RECORD_SEQ\","+
            "\"sortorder\": \"asc\", \"caption\":\""+job+"\"}"
        println "{{html clean=\"false\" wiki=\"true\"}}"
        println "&lt;div id='livetableJson' style = \"display:none\"&gt;"
        //println "&lt;div id='livetableJson'&gt;"
        println str;
        println "&lt;/div&gt;"
        println "{{/html}}"
    }else{ //-- Subtype			
        def subData = rec['data']
        subData.each{key,value-&gt;
            dataUrl = "/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;job="+job +"&amp;limit="+limit+"&amp;fromDate="+fromDate + "&amp;toDate=" + toDate + "&amp;istIid="+istIid+"&amp;subType="+key
            subtractData = value
            subtractData.each{r2-&gt;					
                if(dataModel != null &amp;&amp; dataModel.size() &lt;=0){ 
                    dataModel.add("Fetch At")
                    dataModel.addAll(r2.keySet());					
                } 			
            }
            //-- Building data model				
            def model = []
            def colSpec
            dataModel.each{name-&gt;
                colSpec = [:]
                colSpec['name'] = name
                colSpec['index'] = name
                colSpec['width'] = "100"
                model.add(colSpec)
            }
            def dataModelStr = (new JsonBuilder(dataModel)).toPrettyString()
            def modelStr = (new JsonBuilder(model)).toPrettyString() 
            str = 
            "{\"url\":\""+dataUrl+"\",\"datatype\":\"json\","+
                "\"colNames\":"+ dataModelStr +
                ",\"colModel\":"+ modelStr +" ,\"rowList\":[10,20,30],"+
                "\"pager\":\"#livetablePager\", \"viewrecords\": true, \"sortname\": \"RECORD_SEQ\","+
                "\"sortorder\": \"asc\", \"caption\":\""+job+"\"}"
            subTypeURLMap[key] = str
        }
        def finalStr = (new JsonBuilder(subTypeURLMap)).toPrettyString()
        println "{{html clean=\"false\" wiki=\"true\"}}"
        println "&lt;div id='livetableJson' style = \"display:none\"&gt;"
        //println "&lt;div id='livetableJson'&gt;"
        println finalStr;
        println "&lt;/div&gt;"
        println "{{/html}}"
    }
    return true
}
 //--=============== END

if(listKey.size() &lt;= 0){   
    println "{{html clean=\"false\" wiki=\"true\"}}"
    println "&lt;center&gt;"
    println "&lt;div id=\"livetblContent\" style=\"width:100%;clear:both;align:middle;margin-top:10px\"&gt;"   
    println "Statistics Data"
    println "&lt;table id=\"livetableList\" style=\"width:100%;align:center\"&gt;&lt;/table&gt;"    
    println "&lt;div id=\"livetablePager\"&gt;&lt;/div&gt;"
    println "&lt;/div&gt;"
    println "&lt;/center&gt;"
    
    println "&lt;div id=\"testDiv\"&gt;&amp;nbsp;&lt;/div&gt;"
    println "{{/html}}"
}
{{/groovy}}</content>
<versions>head	61.62;
access;
symbols;
locks; strict;
comment	@# @;


61.62
date	2013.08.16.12.32.18;	author XWiki_2EAdmin;	state full;
branches;
next	61.61;

61.61
date	2013.08.16.12.31.20;	author XWiki_2EAdmin;	state diff;
branches;
next	61.60;

61.60
date	2013.08.16.12.30.33;	author XWiki_2EAdmin;	state diff;
branches;
next	61.59;

61.59
date	2013.08.16.12.28.41;	author XWiki_2EAdmin;	state diff;
branches;
next	61.58;

61.58
date	2013.08.16.11.27.56;	author XWiki_2EAdmin;	state full;
branches;
next	61.57;

61.57
date	2013.08.16.11.25.18;	author XWiki_2EAdmin;	state diff;
branches;
next	61.56;

61.56
date	2013.08.16.11.21.05;	author XWiki_2EAdmin;	state diff;
branches;
next	61.55;

61.55
date	2013.08.16.11.16.41;	author XWiki_2EAdmin;	state diff;
branches;
next	61.54;

61.54
date	2013.08.16.11.15.40;	author XWiki_2EAdmin;	state diff;
branches;
next	61.53;

61.53
date	2013.08.16.11.15.05;	author XWiki_2EAdmin;	state full;
branches;
next	61.52;

61.52
date	2013.08.15.21.06.15;	author XWiki_2EAdmin;	state diff;
branches;
next	61.51;

61.51
date	2013.08.15.21.05.37;	author XWiki_2EAdmin;	state diff;
branches;
next	61.50;

61.50
date	2013.08.15.21.04.36;	author XWiki_2EAdmin;	state diff;
branches;
next	61.49;

61.49
date	2013.08.15.21.04.15;	author XWiki_2EAdmin;	state diff;
branches;
next	61.48;

61.48
date	2013.08.15.21.02.55;	author XWiki_2EAdmin;	state full;
branches;
next	61.47;

61.47
date	2013.08.15.21.02.38;	author XWiki_2EAdmin;	state diff;
branches;
next	61.46;

61.46
date	2013.08.15.21.00.51;	author XWiki_2EAdmin;	state diff;
branches;
next	61.45;

61.45
date	2013.08.15.20.56.41;	author XWiki_2EAdmin;	state diff;
branches;
next	61.44;

61.44
date	2013.08.15.19.18.15;	author XWiki_2EAdmin;	state diff;
branches;
next	61.43;

61.43
date	2013.08.15.19.16.13;	author XWiki_2EAdmin;	state full;
branches;
next	61.42;

61.42
date	2013.08.15.19.09.29;	author XWiki_2EAdmin;	state diff;
branches;
next	61.41;

61.41
date	2013.08.15.19.07.56;	author XWiki_2EAdmin;	state diff;
branches;
next	61.40;

61.40
date	2013.08.15.19.03.31;	author XWiki_2EAdmin;	state diff;
branches;
next	61.39;

61.39
date	2013.08.15.19.02.02;	author XWiki_2EAdmin;	state diff;
branches;
next	61.38;

61.38
date	2013.08.15.19.01.25;	author XWiki_2EAdmin;	state full;
branches;
next	61.37;

61.37
date	2013.08.15.18.58.43;	author XWiki_2EAdmin;	state diff;
branches;
next	61.36;

61.36
date	2013.08.15.18.57.22;	author XWiki_2EAdmin;	state diff;
branches;
next	61.35;

61.35
date	2013.08.15.18.26.01;	author XWiki_2EAdmin;	state diff;
branches;
next	61.34;

61.34
date	2013.08.15.18.24.49;	author XWiki_2EAdmin;	state diff;
branches;
next	61.33;

61.33
date	2013.08.15.18.24.40;	author XWiki_2EAdmin;	state full;
branches;
next	61.32;

61.32
date	2013.08.15.18.23.55;	author XWiki_2EAdmin;	state diff;
branches;
next	61.31;

61.31
date	2013.08.15.18.23.13;	author XWiki_2EAdmin;	state diff;
branches;
next	61.30;

61.30
date	2013.08.15.18.21.59;	author XWiki_2EAdmin;	state diff;
branches;
next	61.29;

61.29
date	2013.08.15.18.21.45;	author XWiki_2EAdmin;	state diff;
branches;
next	61.28;

61.28
date	2013.08.15.18.21.24;	author XWiki_2EAdmin;	state full;
branches;
next	61.27;

61.27
date	2013.08.15.18.20.42;	author XWiki_2EAdmin;	state diff;
branches;
next	61.26;

61.26
date	2013.08.15.18.20.16;	author XWiki_2EAdmin;	state diff;
branches;
next	61.25;

61.25
date	2013.08.15.18.19.25;	author XWiki_2EAdmin;	state diff;
branches;
next	61.24;

61.24
date	2013.08.15.18.18.23;	author XWiki_2EAdmin;	state diff;
branches;
next	61.23;

61.23
date	2013.08.15.18.14.52;	author XWiki_2EAdmin;	state full;
branches;
next	61.22;

61.22
date	2013.08.15.18.11.04;	author XWiki_2EAdmin;	state diff;
branches;
next	61.21;

61.21
date	2013.08.15.18.09.52;	author XWiki_2EAdmin;	state diff;
branches;
next	61.20;

61.20
date	2013.08.15.18.07.45;	author XWiki_2EAdmin;	state diff;
branches;
next	61.19;

61.19
date	2013.08.15.18.03.12;	author XWiki_2EAdmin;	state diff;
branches;
next	61.18;

61.18
date	2013.08.15.17.59.52;	author XWiki_2EAdmin;	state full;
branches;
next	61.17;

61.17
date	2013.08.15.17.58.35;	author XWiki_2EAdmin;	state diff;
branches;
next	61.16;

61.16
date	2013.08.15.17.57.43;	author XWiki_2EAdmin;	state diff;
branches;
next	61.15;

61.15
date	2013.08.15.17.56.14;	author XWiki_2EAdmin;	state diff;
branches;
next	61.14;

61.14
date	2013.08.15.16.49.01;	author XWiki_2EAdmin;	state diff;
branches;
next	61.13;

61.13
date	2013.08.15.16.46.05;	author XWiki_2EAdmin;	state full;
branches;
next	61.12;

61.12
date	2013.08.15.16.45.05;	author XWiki_2EAdmin;	state diff;
branches;
next	61.11;

61.11
date	2013.08.15.16.44.41;	author XWiki_2EAdmin;	state diff;
branches;
next	61.10;

61.10
date	2013.08.15.16.43.21;	author XWiki_2EAdmin;	state diff;
branches;
next	61.9;

61.9
date	2013.08.15.16.42.30;	author XWiki_2EAdmin;	state diff;
branches;
next	61.8;

61.8
date	2013.08.15.16.34.36;	author XWiki_2EAdmin;	state full;
branches;
next	61.7;

61.7
date	2013.08.15.16.33.48;	author XWiki_2EAdmin;	state diff;
branches;
next	61.6;

61.6
date	2013.08.15.16.31.06;	author XWiki_2EAdmin;	state diff;
branches;
next	61.5;

61.5
date	2013.08.15.16.27.28;	author XWiki_2EAdmin;	state diff;
branches;
next	61.4;

61.4
date	2013.08.15.16.20.24;	author XWiki_2EAdmin;	state diff;
branches;
next	61.3;

61.3
date	2013.08.15.16.11.02;	author XWiki_2EAdmin;	state full;
branches;
next	61.2;

61.2
date	2013.08.15.16.10.40;	author XWiki_2EAdmin;	state diff;
branches;
next	61.1;

61.1
date	2013.08.14.19.19.05;	author XWiki_2EAdmin;	state diff;
branches;
next	60.1;

60.1
date	2013.08.14.19.15.33;	author XWiki_2EAdmin;	state diff;
branches;
next	59.1;

59.1
date	2013.08.14.19.07.44;	author XWiki_2EAdmin;	state diff;
branches;
next	58.1;

58.1
date	2013.08.14.19.07.14;	author XWiki_2EAdmin;	state full;
branches;
next	57.1;

57.1
date	2013.08.14.19.06.20;	author XWiki_2EAdmin;	state diff;
branches;
next	56.1;

56.1
date	2013.08.14.19.06.19;	author XWiki_2EAdmin;	state diff;
branches;
next	55.1;

55.1
date	2013.08.14.19.05.45;	author XWiki_2EAdmin;	state diff;
branches;
next	54.12;

54.12
date	2013.08.13.20.42.17;	author XWiki_2EAdmin;	state diff;
branches;
next	54.11;

54.11
date	2013.08.13.20.41.11;	author XWiki_2EAdmin;	state full;
branches;
next	54.10;

54.10
date	2013.08.13.20.40.53;	author XWiki_2EAdmin;	state diff;
branches;
next	54.9;

54.9
date	2013.08.13.20.40.36;	author XWiki_2EAdmin;	state diff;
branches;
next	54.8;

54.8
date	2013.08.13.20.39.14;	author XWiki_2EAdmin;	state diff;
branches;
next	54.7;

54.7
date	2013.08.13.20.38.48;	author XWiki_2EAdmin;	state diff;
branches;
next	54.6;

54.6
date	2013.08.13.20.37.37;	author XWiki_2EAdmin;	state full;
branches;
next	54.5;

54.5
date	2013.08.13.20.36.45;	author XWiki_2EAdmin;	state diff;
branches;
next	54.4;

54.4
date	2013.08.13.20.36.00;	author XWiki_2EAdmin;	state diff;
branches;
next	54.3;

54.3
date	2013.08.13.20.35.28;	author XWiki_2EAdmin;	state diff;
branches;
next	54.2;

54.2
date	2013.08.13.20.35.08;	author XWiki_2EAdmin;	state diff;
branches;
next	54.1;

54.1
date	2013.08.13.20.33.10;	author XWiki_2EAdmin;	state full;
branches;
next	53.2;

53.2
date	2013.08.13.20.33.04;	author XWiki_2EAdmin;	state diff;
branches;
next	53.1;

53.1
date	2013.08.13.20.21.51;	author XWiki_2EAdmin;	state diff;
branches;
next	52.1;

52.1
date	2013.08.13.20.20.12;	author XWiki_2EAdmin;	state diff;
branches;
next	51.1;

51.1
date	2013.08.13.20.17.49;	author XWiki_2EAdmin;	state diff;
branches;
next	50.3;

50.3
date	2013.08.13.20.16.38;	author XWiki_2EAdmin;	state full;
branches;
next	50.2;

50.2
date	2013.08.13.20.16.06;	author XWiki_2EAdmin;	state diff;
branches;
next	50.1;

50.1
date	2013.08.13.20.13.56;	author XWiki_2EAdmin;	state diff;
branches;
next	49.1;

49.1
date	2013.08.13.20.08.11;	author XWiki_2EAdmin;	state diff;
branches;
next	48.1;

48.1
date	2013.08.13.20.02.22;	author XWiki_2EAdmin;	state diff;
branches;
next	47.1;

47.1
date	2013.08.13.20.01.24;	author XWiki_2EAdmin;	state full;
branches;
next	46.1;

46.1
date	2013.08.13.20.00.32;	author XWiki_2EAdmin;	state diff;
branches;
next	45.1;

45.1
date	2013.08.13.19.58.46;	author XWiki_2EAdmin;	state diff;
branches;
next	44.1;

44.1
date	2013.08.13.19.57.59;	author XWiki_2EAdmin;	state diff;
branches;
next	43.1;

43.1
date	2013.08.13.17.20.48;	author XWiki_2EAdmin;	state diff;
branches;
next	42.5;

42.5
date	2013.08.13.17.02.29;	author XWiki_2EAdmin;	state full;
branches;
next	42.4;

42.4
date	2013.08.13.17.01.58;	author XWiki_2EAdmin;	state diff;
branches;
next	42.3;

42.3
date	2013.08.13.17.01.42;	author XWiki_2EAdmin;	state diff;
branches;
next	42.2;

42.2
date	2013.08.13.17.00.11;	author XWiki_2EAdmin;	state diff;
branches;
next	42.1;

42.1
date	2013.08.13.15.55.55;	author XWiki_2EAdmin;	state diff;
branches;
next	41.2;

41.2
date	2013.08.13.15.55.48;	author XWiki_2EAdmin;	state full;
branches;
next	41.1;

41.1
date	2013.08.13.15.54.32;	author XWiki_2EAdmin;	state diff;
branches;
next	40.3;

40.3
date	2013.08.13.15.54.18;	author XWiki_2EAdmin;	state diff;
branches;
next	40.2;

40.2
date	2013.08.13.15.52.56;	author XWiki_2EAdmin;	state diff;
branches;
next	40.1;

40.1
date	2013.08.13.15.48.57;	author XWiki_2EAdmin;	state diff;
branches;
next	39.1;

39.1
date	2013.08.13.15.48.04;	author XWiki_2EAdmin;	state full;
branches;
next	38.2;

38.2
date	2013.08.13.15.46.58;	author XWiki_2EAdmin;	state diff;
branches;
next	38.1;

38.1
date	2013.08.13.15.45.58;	author XWiki_2EAdmin;	state diff;
branches;
next	37.2;

37.2
date	2013.08.13.15.44.40;	author XWiki_2EAdmin;	state diff;
branches;
next	37.1;

37.1
date	2013.08.13.15.37.33;	author XWiki_2EAdmin;	state diff;
branches;
next	36.3;

36.3
date	2013.08.13.15.37.15;	author XWiki_2EAdmin;	state full;
branches;
next	36.2;

36.2
date	2013.08.13.15.35.48;	author XWiki_2EAdmin;	state diff;
branches;
next	36.1;

36.1
date	2013.08.13.15.33.48;	author XWiki_2EAdmin;	state diff;
branches;
next	35.2;

35.2
date	2013.08.13.15.33.32;	author XWiki_2EAdmin;	state diff;
branches;
next	35.1;

35.1
date	2013.08.13.15.32.15;	author XWiki_2EAdmin;	state diff;
branches;
next	34.5;

34.5
date	2013.08.13.15.31.58;	author XWiki_2EAdmin;	state full;
branches;
next	34.4;

34.4
date	2013.08.13.15.31.20;	author XWiki_2EAdmin;	state diff;
branches;
next	34.3;

34.3
date	2013.08.13.15.29.45;	author XWiki_2EAdmin;	state diff;
branches;
next	34.2;

34.2
date	2013.08.13.15.23.50;	author XWiki_2EAdmin;	state diff;
branches;
next	34.1;

34.1
date	2013.08.13.15.22.45;	author XWiki_2EAdmin;	state diff;
branches;
next	33.5;

33.5
date	2013.08.13.15.22.39;	author XWiki_2EAdmin;	state full;
branches;
next	33.4;

33.4
date	2013.08.13.15.21.19;	author XWiki_2EAdmin;	state diff;
branches;
next	33.3;

33.3
date	2013.08.13.15.15.49;	author XWiki_2EAdmin;	state diff;
branches;
next	33.2;

33.2
date	2013.08.13.15.14.27;	author XWiki_2EAdmin;	state diff;
branches;
next	33.1;

33.1
date	2013.08.13.14.15.04;	author XWiki_2EAdmin;	state diff;
branches;
next	32.1;

32.1
date	2013.08.13.14.13.26;	author XWiki_2EAdmin;	state full;
branches;
next	31.3;

31.3
date	2013.08.13.14.13.21;	author XWiki_2EAdmin;	state diff;
branches;
next	31.2;

31.2
date	2013.08.13.14.11.51;	author XWiki_2EAdmin;	state diff;
branches;
next	31.1;

31.1
date	2013.08.13.14.01.25;	author XWiki_2EAdmin;	state diff;
branches;
next	30.19;

30.19
date	2013.08.13.14.01.04;	author XWiki_2EAdmin;	state diff;
branches;
next	30.18;

30.18
date	2013.08.13.13.58.53;	author XWiki_2EAdmin;	state full;
branches;
next	30.17;

30.17
date	2013.08.13.13.54.41;	author XWiki_2EAdmin;	state diff;
branches;
next	30.16;

30.16
date	2013.08.13.13.37.00;	author XWiki_2EAdmin;	state diff;
branches;
next	30.15;

30.15
date	2013.08.13.13.35.23;	author XWiki_2EAdmin;	state diff;
branches;
next	30.14;

30.14
date	2013.08.13.13.34.23;	author XWiki_2EAdmin;	state diff;
branches;
next	30.13;

30.13
date	2013.08.13.13.32.31;	author XWiki_2EAdmin;	state full;
branches;
next	30.12;

30.12
date	2013.08.13.13.30.56;	author XWiki_2EAdmin;	state diff;
branches;
next	30.11;

30.11
date	2013.08.13.13.13.13;	author XWiki_2EAdmin;	state diff;
branches;
next	30.10;

30.10
date	2013.08.13.13.10.59;	author XWiki_2EAdmin;	state diff;
branches;
next	30.9;

30.9
date	2013.08.13.12.26.15;	author XWiki_2EAdmin;	state diff;
branches;
next	;


desc
@@


61.62
log
@@
text
@&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xwikidoc&gt;
&lt;web&gt;WiperDog&lt;/web&gt;
&lt;name&gt;WebHome&lt;/name&gt;
&lt;language&gt;&lt;/language&gt;
&lt;defaultLanguage&gt;en&lt;/defaultLanguage&gt;
&lt;translation&gt;0&lt;/translation&gt;
&lt;parent&gt;&lt;/parent&gt;
&lt;creator&gt;XWiki.Admin&lt;/creator&gt;
&lt;author&gt;XWiki.Admin&lt;/author&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;contentAuthor&gt;XWiki.Admin&lt;/contentAuthor&gt;
&lt;creationDate&gt;1376364375000&lt;/creationDate&gt;
&lt;date&gt;1376623938000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376623938000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.62&lt;/version&gt;
&lt;title&gt;WiperDog&lt;/title&gt;
&lt;defaultTemplate&gt;&lt;/defaultTemplate&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;comment&gt;&lt;/comment&gt;
&lt;minorEdit&gt;true&lt;/minorEdit&gt;
&lt;syntaxId&gt;xwiki/2.1&lt;/syntaxId&gt;
&lt;hidden&gt;false&lt;/hidden&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;047293a8-524d-45e4-af52-cd944523d5d0&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
/*
 * jQuery timepicker addon
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 1.3.1
 * Last Modified: 07/07/2013
 *
 * Copyright 2013 Trent Richardson
 * You may use this project under MIT or GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 */

/*jslint evil: true, white: false, undef: false, nomen: false */

(function($) {

	/*
	* Lets not redefine timepicker, Prevent "Uncaught RangeError: Maximum call stack size exceeded"
	*/
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return;
	}

	/*
	* Extend jQueryUI, get it started with our version number
	*/
	$.extend($.ui, {
		timepicker: {
			version: "1.3.1"
		}
	});

	/* 
	* Timepicker manager.
	* Use the singleton instance of this class, $.timepicker, to interact with the time picker.
	* Settings for (groups of) time pickers are maintained in an instance object,
	* allowing multiple different settings on the same page.
	*/
	var Timepicker = function() {
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[''] = { // Default regional settings
			currentText: 'Now',
			closeText: 'Done',
			amNames: ['AM', 'A'],
			pmNames: ['PM', 'P'],
			timeFormat: 'HH:mm',
			timeSuffix: '',
			timeOnlyTitle: 'Choose Time',
			timeText: 'Time',
			hourText: 'Hour',
			minuteText: 'Minute',
			secondText: 'Second',
			millisecText: 'Millisecond',
			microsecText: 'Microsecond',
			timezoneText: 'Time Zone',
			isRTL: false
		};
		this._defaults = { // Global defaults for all the datetime picker instances
			showButtonPanel: true,
			timeOnly: false,
			showHour: null,
			showMinute: null,
			showSecond: null,
			showMillisec: null,
			showMicrosec: null,
			showTimezone: null,
			showTime: true,
			stepHour: 1,
			stepMinute: 1,
			stepSecond: 1,
			stepMillisec: 1,
			stepMicrosec: 1,
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null,
			hourMin: 0,
			minuteMin: 0,
			secondMin: 0,
			millisecMin: 0,
			microsecMin: 0,
			hourMax: 23,
			minuteMax: 59,
			secondMax: 59,
			millisecMax: 999,
			microsecMax: 999,
			minDateTime: null,
			maxDateTime: null,
			onSelect: null,
			hourGrid: 0,
			minuteGrid: 0,
			secondGrid: 0,
			millisecGrid: 0,
			microsecGrid: 0,
			alwaysSetTime: true,
			separator: ' ',
			altFieldTimeOnly: true,
			altTimeFormat: null,
			altSeparator: null,
			altTimeSuffix: null,
			pickerTimeFormat: null,
			pickerTimeSuffix: null,
			showTimepicker: true,
			timezoneList: null,
			addSliderAccess: false,
			sliderAccessArgs: null,
			controlType: 'slider',
			defaultValue: null,
			parse: 'strict'
		};
		$.extend(this._defaults, this.regional['']);
	};

	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: '',
		formattedDate: '',
		formattedTime: '',
		formattedDateTime: '',
		timezoneList: null,
		units: ['hour','minute','second','millisec', 'microsec'],
		support: {},
		control: null,

		/* 
		* Override the default settings for all instances of the time picker.
		* @@param  settings  object - the new settings to use as defaults (anonymous object)
		* @@return the manager object
		*/
		setDefaults: function(settings) {
			extendRemove(this._defaults, settings || {});
			return this;
		},

		/*
		* Create a new Timepicker instance
		*/
		_newInst: function($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
            	fns = {},
		    	overrides, i;

			for (var attrName in this._defaults) {
				if(this._defaults.hasOwnProperty(attrName)){
					var attrValue = $input.attr('time:' + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue);
						} catch (err) {
							inlineSettings[attrName] = attrValue;
						}
					}
				}
			}

		    overrides = {
		        beforeShow: function (input, dp_inst) {
		            if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
		                return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst);
		            }
		        },
		        onChangeMonthYear: function (year, month, dp_inst) {
		            // Update the time as well : this prevents the time from disappearing from the $input field.
		            tp_inst._updateDateTime(dp_inst);
		            if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
		                tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst);
		            }
		        },
		        onClose: function (dateText, dp_inst) {
		            if (tp_inst.timeDefined === true &amp;amp;&amp;amp; $input.val() !== '') {
		                tp_inst._updateDateTime(dp_inst);
		            }
		            if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
		                tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst);
		            }
		        }
		    };
		    for (i in overrides) {
		        if (overrides.hasOwnProperty(i)) {
		            fns[i] = opts[i] || null;
		        }
		    }

		    tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
		        evnts:fns,
		        timepicker: tp_inst // add timepicker as a property of datepicker: $.datepicker._get(dp_inst, 'timepicker');
		    });
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function(val) {
				return val.toUpperCase();
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function(val) {
				return val.toUpperCase();
			});

			// detect which units are supported
			tp_inst.support = detectSupport(
					tp_inst._defaults.timeFormat + 
					(tp_inst._defaults.pickerTimeFormat? tp_inst._defaults.pickerTimeFormat:'') + 
					(tp_inst._defaults.altTimeFormat? tp_inst._defaults.altTimeFormat:''));

			// controlType is string - key to our this._controls
			if(typeof(tp_inst._defaults.controlType) === 'string'){
				if(tp_inst._defaults.controlType == 'slider' &amp;amp;&amp;amp; typeof(jQuery.ui.slider) === 'undefined'){
					tp_inst._defaults.controlType = 'select';
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType];
			}
			// controlType is an object and must implement create, options, value methods
			else{ 
				tp_inst.control = tp_inst._defaults.controlType;
			}

			// prep the timezone options
			var timezoneList = [-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,
					0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList;
			}
			var tzl=timezoneList.length,tzi=0,tzv=null;
			if (tzl &amp;gt; 0 &amp;amp;&amp;amp; typeof timezoneList[0] !== 'object') {
				for(; tzi&amp;lt;tzl; tzi++){
					tzv = timezoneList[tzi];
					timezoneList[tzi] = { value: tzv, label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601) };
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;

			// set the default units
			tp_inst.timezone = tp_inst._defaults.timezone !== null? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) : 
							((new Date()).getTimezoneOffset()*-1);
			tp_inst.hour = tp_inst._defaults.hour &amp;lt; tp_inst._defaults.hourMin? tp_inst._defaults.hourMin : 
							tp_inst._defaults.hour &amp;gt; tp_inst._defaults.hourMax? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute &amp;lt; tp_inst._defaults.minuteMin? tp_inst._defaults.minuteMin : 
							tp_inst._defaults.minute &amp;gt; tp_inst._defaults.minuteMax? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second &amp;lt; tp_inst._defaults.secondMin? tp_inst._defaults.secondMin : 
							tp_inst._defaults.second &amp;gt; tp_inst._defaults.secondMax? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec &amp;lt; tp_inst._defaults.millisecMin? tp_inst._defaults.millisecMin : 
							tp_inst._defaults.millisec &amp;gt; tp_inst._defaults.millisecMax? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec &amp;lt; tp_inst._defaults.microsecMin? tp_inst._defaults.microsecMin : 
							tp_inst._defaults.microsec &amp;gt; tp_inst._defaults.microsecMax? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = '';
			tp_inst.$input = $input;

			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField).css({
					cursor: 'pointer'
				}).focus(function() {
					$input.trigger("focus");
				});
			}

			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date();
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date();
			}

			// datepicker needs minDate/maxDate, timepicker needs minDateTime/maxDateTime..
			if (tp_inst._defaults.minDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime());
			}
			if (tp_inst._defaults.minDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime());
			}
			if (tp_inst._defaults.maxDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime());
			}
			if (tp_inst._defaults.maxDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime());
			}
			tp_inst.$input.bind('focus', function() {
				tp_inst._onFocus();
			});

			return tp_inst;
		},

		/*
		* add our sliders to the calendar
		*/
		_addTimePicker: function(dp_inst) {
			var currDT = (this.$altInput &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly) ? this.$input.val() + ' ' + this.$altInput.val() : this.$input.val();

			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
		},

		/*
		* parse the time string from input value or _setTime
		*/
		_parseTime: function(timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0]);
			}

			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, 'dateFormat');
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false;
					}
					$.extend(this, parseRes.timeObj);
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err +
									"\ndate/time string = " + timeString +
									"\ntimeFormat = " + this._defaults.timeFormat +
									"\ndateFormat = " + dp_dateFormat);
					return false;
				}
				return true;
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false;
				}
				$.extend(this, timeObj);
				return true;
			}
		},

		/*
		* generate and inject html for timepicker into ui datepicker
		*/
		_injectTimePicker: function() {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = '',
				uitem = '',
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i=0,
				l=0;

			// Prevent displaying twice
			if ($dp.find("div.ui-timepicker-div").length === 0 &amp;amp;&amp;amp; o.showTimepicker) {
				var noDisplay = ' style="display:none;"',
					html = '&amp;lt;div class="ui-timepicker-div'+ (o.isRTL? ' ui-timepicker-rtl' : '') +'"&amp;gt;&amp;lt;dl&amp;gt;' + '&amp;lt;dt class="ui_tpicker_time_label"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;' + o.timeText + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_time"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the markup
				for(i=0,l=this.units.length; i&amp;lt;l; i++){
					litem = this.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// Added by Peter Medeiros:
					// - Figure out what the hour/minute/second max should be based on the step values.
					// - Example: if stepMinute is 15, then minMax is 45.
					max[litem] = parseInt((o[litem+'Max'] - ((o[litem+'Max'] - o[litem+'Min']) % o['step'+uitem])), 10);
					gridSize[litem] = 0;

					html += '&amp;lt;dt class="ui_tpicker_'+ litem +'_label"' + (show ? '' : noDisplay) + '&amp;gt;' + o[litem +'Text'] + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_'+ litem +'"&amp;gt;&amp;lt;div class="ui_tpicker_'+ litem +'_slider"' + (show ? '' : noDisplay) + '&amp;gt;&amp;lt;/div&amp;gt;';

					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						html += '&amp;lt;div style="padding-left: 1px"&amp;gt;&amp;lt;table class="ui-tpicker-grid-label"&amp;gt;&amp;lt;tr&amp;gt;';

						if(litem == 'hour'){
							for (var h = o[litem+'Min']; h &amp;lt;= max[litem]; h += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm? 'hht':'HH', {hour:h}, o);									
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + tmph + '&amp;lt;/td&amp;gt;';
							}
						}
						else{
							for (var m = o[litem+'Min']; m &amp;lt;= max[litem]; m += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + ((m &amp;lt; 10) ? '0' : '') + m + '&amp;lt;/td&amp;gt;';
							}
						}

						html += '&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;&amp;lt;/div&amp;gt;';
					}
					html += '&amp;lt;/dd&amp;gt;';
				}
				
				// Timezone
				var showTz = o.showTimezone !== null? o.showTimezone : this.support.timezone;
				html += '&amp;lt;dt class="ui_tpicker_timezone_label"' + (showTz ? '' : noDisplay) + '&amp;gt;' + o.timezoneText + '&amp;lt;/dt&amp;gt;';
				html += '&amp;lt;dd class="ui_tpicker_timezone" ' + (showTz ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the elements from string
				html += '&amp;lt;/dl&amp;gt;&amp;lt;/div&amp;gt;';
				var $tp = $(html);

				// if we only want time picker...
				if (o.timeOnly === true) {
					$tp.prepend('&amp;lt;div class="ui-widget-header ui-helper-clearfix ui-corner-all"&amp;gt;' + '&amp;lt;div class="ui-datepicker-title"&amp;gt;' + o.timeOnlyTitle + '&amp;lt;/div&amp;gt;' + '&amp;lt;/div&amp;gt;');
					$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();
				}
				
				// add sliders, adjust grids, add events
				for(i=0,l=tp_inst.units.length; i&amp;lt;l; i++){
					litem = tp_inst.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// add the slider
					tp_inst[litem+'_slider'] = tp_inst.control.create(tp_inst, $tp.find('.ui_tpicker_'+litem+'_slider'), litem, tp_inst[litem], o[litem+'Min'], max[litem], o['step'+uitem]);

					// adjust the grid and add click event
					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						size = 100 * gridSize[litem] * o[litem+'Grid'] / (max[litem] - o[litem+'Min']);
						$tp.find('.ui_tpicker_'+litem+' table').css({
							width: size + "%",
							marginLeft: o.isRTL? '0' : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL? ((size / (-2 * gridSize[litem])) + "%") : '0',
							borderCollapse: 'collapse'
						}).find("td").click(function(e){
								var $t = $(this),
									h = $t.html(),
									n = parseInt(h.replace(/[^0-9]/g),10),
									ap = h.replace(/[^apm]/ig),
									f = $t.data('for'); // loses scope, so we use data-for

								if(f == 'hour'){
									if(ap.indexOf('p') !== -1 &amp;amp;&amp;amp; n &amp;lt; 12){
										n += 12;
									}
									else{
										if(ap.indexOf('a') !== -1 &amp;amp;&amp;amp; n === 12){
											n = 0;
										}
									}
								}
								
								tp_inst.control.value(tp_inst, tp_inst[f+'_slider'], litem, n);

								tp_inst._onTimeChange();
								tp_inst._onSelectHandler();
							}).css({
								cursor: 'pointer',
								width: (100 / gridSize[litem]) + '%',
								textAlign: 'center',
								overflow: 'hidden'
							});
					} // end if grid &amp;gt; 0
				} // end for loop

				// Add timezone options
				this.timezone_select = $tp.find('.ui_tpicker_timezone').append('&amp;lt;select&amp;gt;&amp;lt;/select&amp;gt;').find("select");
				$.fn.append.apply(this.timezone_select,
				$.map(o.timezoneList, function(val, idx) {
					return $("&amp;lt;option /&amp;gt;").val(typeof val == "object" ? val.value : val).text(typeof val == "object" ? val.label : val);
				}));
				if (typeof(this.timezone) != "undefined" &amp;amp;&amp;amp; this.timezone !== null &amp;amp;&amp;amp; this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset()*-1;
					if (local_timezone == this.timezone) {
						selectLocalTimezone(tp_inst);
					} else {
						this.timezone_select.val(this.timezone);
					}
				} else {
					if (typeof(this.hour) != "undefined" &amp;amp;&amp;amp; this.hour !== null &amp;amp;&amp;amp; this.hour !== "") {
						this.timezone_select.val(o.timezone);
					} else {
						selectLocalTimezone(tp_inst);
					}
				}
				this.timezone_select.change(function() {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
				});
				// End timezone options
				
				// inject timepicker into datepicker
				var $buttonPanel = $dp.find('.ui-datepicker-buttonpane');
				if ($buttonPanel.length) {
					$buttonPanel.before($tp);
				} else {
					$dp.append($tp);
				}

				this.$timeObj = $tp.find('.ui_tpicker_time');

				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined;
				}

				// slideAccess integration: http://trentrichardson.com/2011/11/11/jquery-ui-sliders-and-touch-accessibility/
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
						
					setTimeout(function() { // fix for inline mode
						if ($tp.find('.ui-slider-access').length === 0) {
							$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);

							// fix any grids since sliders are shorter
							var sliderAccessWidth = $tp.find('.ui-slider-access:eq(0)').outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find('table:visible').each(function() {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl? 'marginRight':'marginLeft').toString().replace('%', ''),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + '%',
										css = { width: newWidth, marginRight: 0, marginLeft: 0 };
									css[rtl? 'marginRight':'marginLeft'] = newMarginLeft;
									$g.css(css);
								});
							}
						}
					}, 10);
				}
				// end slideAccess integration

				tp_inst._limitMinMaxDateTime(this.inst, true);
			}
		},

		/*
		* This function tries to limit the ability to go outside the
		* min/max date range
		*/
		_limitMinMaxDateTime: function(dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);

			if (!this._defaults.showTimepicker) {
				return;
			} // No time so nothing to check here

			if ($.datepicker._get(dp_inst, 'minDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'minDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, 'minDateTime'),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin;
				}

				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour &amp;lt;= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute &amp;lt;= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second &amp;lt;= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if(this.millisec &amp;lt;= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;lt; this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin;
									}
									this._defaults.microsecMin = this.microsecMinOriginal;
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal;
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal;
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal;
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal;
				}
			}

			if ($.datepicker._get(dp_inst, 'maxDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'maxDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, 'maxDateTime'),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax;
				}

				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour &amp;gt;= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute &amp;gt;= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second &amp;gt;= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec &amp;gt;= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;gt; this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax;
									}
									this._defaults.microsecMax = this.microsecMaxOriginal;
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal;
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal;
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal;
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal;
				}
			}

			if (adjustSliders !== undefined &amp;amp;&amp;amp; adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10);
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);

				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, 'hour', { min: this._defaults.hourMin, max: hourMax });
					this.control.value(this, this.hour_slider, 'hour', this.hour - (this.hour % this._defaults.stepHour));
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, 'minute', { min: this._defaults.minuteMin, max: minMax });
					this.control.value(this, this.minute_slider, 'minute', this.minute - (this.minute % this._defaults.stepMinute));
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, 'second', { min: this._defaults.secondMin, max: secMax });
					this.control.value(this, this.second_slider, 'second', this.second - (this.second % this._defaults.stepSecond));
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, 'millisec', { min: this._defaults.millisecMin, max: millisecMax });
					this.control.value(this, this.millisec_slider, 'millisec', this.millisec - (this.millisec % this._defaults.stepMillisec));
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, 'microsec', { min: this._defaults.microsecMin, max: microsecMax });
					this.control.value(this, this.microsec_slider, 'microsec', this.microsec - (this.microsec % this._defaults.stepMicrosec));
				}
			}

		},

		/*
		* when a slider moves, set the internal time...
		* on time change is also called when the time is updated in the text field
		*/
		_onTimeChange: function() {
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, 'hour') : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, 'minute') : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, 'second') : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, 'millisec') : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, 'microsec') : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;

			if (typeof(hour) == 'object') {
				hour = false;
			}
			if (typeof(minute) == 'object') {
				minute = false;
			}
			if (typeof(second) == 'object') {
				second = false;
			}
			if (typeof(millisec) == 'object') {
				millisec = false;
			}
			if (typeof(microsec) == 'object') {
				microsec = false;
			}
			if (typeof(timezone) == 'object') {
				timezone = false;
			}

			if (hour !== false) {
				hour = parseInt(hour, 10);
			}
			if (minute !== false) {
				minute = parseInt(minute, 10);
			}
			if (second !== false) {
				second = parseInt(second, 10);
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10);
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10);
			}

			var ampm = o[hour &amp;lt; 12 ? 'amNames' : 'pmNames'][0];

			// If the update was done in the input field, the input field should not be updated.
			// If the update was done using the sliders, update the input field.
			var hasChanged = (hour != this.hour || minute != this.minute || second != this.second || millisec != this.millisec || microsec != this.microsec 
								|| (this.ampm.length &amp;gt; 0 &amp;amp;&amp;amp; (hour &amp;lt; 12) != ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) 
								|| (this.timezone !== null &amp;amp;&amp;amp; timezone != this.timezone));

			if (hasChanged) {

				if (hour !== false) {
					this.hour = hour;
				}
				if (minute !== false) {
					this.minute = minute;
				}
				if (second !== false) {
					this.second = second;
				}
				if (millisec !== false) {
					this.millisec = millisec;
				}
				if (microsec !== false) {
					this.microsec = microsec;
				}
				if (timezone !== false) {
					this.timezone = timezone;
				}

				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0]);
				}

				this._limitMinMaxDateTime(this.inst, true);
			}
			if (this.support.ampm) {
				this.ampm = ampm;
			}

			// Updates the time within the timepicker
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if(pickerTimeFormat === o.timeFormat){
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix);
				}
				else{
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix);
				}
			}

			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime();
			}
		},

		/*
		* call custom onSelect.
		* bind to sliders slidestop, and grid click.
		*/
		_onSelectHandler: function() {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect &amp;amp;&amp;amp; inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this]);
			}
		},

		/*
		* update our input with the new date time..
		*/
		_updateDateTime: function(dp_inst) {
			dp_inst = this.inst || dp_inst;
			//var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
			var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay)),
				dateFmt = $.datepicker._get(dp_inst, 'dateFormat'),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null &amp;amp;&amp;amp; this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			
			// if a slider was changed but datepicker doesn't have a value yet, set it
			if(dp_inst.lastVal===""){
                dp_inst.currentYear=dp_inst.selectedYear;
                dp_inst.currentMonth=dp_inst.selectedMonth;
                dp_inst.currentDay=dp_inst.selectedDay;
            }

			/*
			* remove following lines to force every changes in date picker to change the input value
			* Bug descriptions: when an input field has a default value, and click on the field to pop up the date picker. 
			* If the user manually empty the value in the input field, the date picker will never change selected value.
			*/
			//if (dp_inst.lastVal !== undefined &amp;amp;&amp;amp; (dp_inst.lastVal.length &amp;gt; 0 &amp;amp;&amp;amp; this.$input.val().length === 0)) {
			//	return;
			//}

			if (this._defaults.timeOnly === true) {
				formattedDateTime = this.formattedTime;
			} else if (this._defaults.timeOnly !== true &amp;amp;&amp;amp; (this._defaults.alwaysSetTime || timeAvailable)) {
				formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix;
			}

			this.formattedDateTime = formattedDateTime;

			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate);
			} else if (this.$altInput &amp;amp;&amp;amp; this._defaults.timeOnly === false &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly === true) {
				this.$altInput.val(this.formattedTime);
				this.$input.val(this.formattedDate);
			} else if (this.$altInput) {
				this.$input.val(formattedDateTime);
				var altFormattedDateTime = '',
					altSeparator = this._defaults.altSeparator ? this._defaults.altSeparator : this._defaults.separator,
					altTimeSuffix = this._defaults.altTimeSuffix ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
				
				if(!this._defaults.timeOnly){
					if (this._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg);
					}
					else{
						altFormattedDateTime = this.formattedDate;
					}

					if (altFormattedDateTime){
						altFormattedDateTime += altSeparator;
					}
				}

				if(this._defaults.altTimeFormat){
					altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix;
				}
				else{
					altFormattedDateTime += this.formattedTime + altTimeSuffix;
				}
				this.$altInput.val(altFormattedDateTime);
			} else {
				this.$input.val(formattedDateTime);
			}

			this.$input.trigger("change");
		},

		_onFocus: function() {
			if (!this.$input.val() &amp;amp;&amp;amp; this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, 'timepicker');
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst);
						} catch (err) {
							$.timepicker.log(err);
						}
					}
				}
			}
		},

		/*
		* Small abstraction to control types
		* We can add more, just be sure to follow the pattern: create, options, value
		*/
		_controls: {
			// slider methods
			slider: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var rtl = tp_inst._defaults.isRTL; // if rtl go -60-&amp;gt;0 instead of 0-&amp;gt;60
					return obj.prop('slide', null).slider({
						orientation: "horizontal",
						value: rtl? val*-1 : val,
						min: rtl? max*-1 : min,
						max: rtl? min*-1 : max,
						step: step,
						slide: function(event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl? ui.value*-1:ui.value);
							tp_inst._onTimeChange();
						},
						stop: function(event, ui) {
							tp_inst._onSelectHandler();
						}
					});	
				},
				options: function(tp_inst, obj, unit, opts, val){
					if(tp_inst._defaults.isRTL){
						if(typeof(opts) == 'string'){
							if(opts == 'min' || opts == 'max'){
								if(val !== undefined){
									return obj.slider(opts, val*-1);
								}
								return Math.abs(obj.slider(opts));
							}
							return obj.slider(opts);
						}
						var min = opts.min, 
							max = opts.max;
						opts.min = opts.max = null;
						if(min !== undefined){
							opts.max = min * -1;
						}
						if(max !== undefined){
							opts.min = max * -1;
						}
						return obj.slider(opts);
					}
					if(typeof(opts) == 'string' &amp;amp;&amp;amp; val !== undefined){
							return obj.slider(opts, val);
					}
					return obj.slider(opts);
				},
				value: function(tp_inst, obj, unit, val){
					if(tp_inst._defaults.isRTL){
						if(val !== undefined){
							return obj.slider('value', val*-1);
						}
						return Math.abs(obj.slider('value'));
					}
					if(val !== undefined){
						return obj.slider('value', val);
					}
					return obj.slider('value');
				}
			},
			// select methods
			select: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var sel = '&amp;lt;select class="ui-timepicker-select" data-unit="'+ unit +'" data-min="'+ min +'" data-max="'+ max +'" data-step="'+ step +'"&amp;gt;',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;

					for(var i=min; i&amp;lt;=max; i+=step){						
						sel += '&amp;lt;option value="'+ i +'"'+ (i==val? ' selected':'') +'&amp;gt;';
						if(unit == 'hour'){
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig,'')), {hour:i}, tp_inst._defaults);
						}
						else if(unit == 'millisec' || unit == 'microsec' || i &amp;gt;= 10){ sel += i; }
						else {sel += '0'+ i.toString(); }
						sel += '&amp;lt;/option&amp;gt;';
					}
					sel += '&amp;lt;/select&amp;gt;';

					obj.children('select').remove();

					$(sel).appendTo(obj).change(function(e){
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
					});

					return obj;
				},
				options: function(tp_inst, obj, unit, opts, val){
					var o = {},
						$t = obj.children('select');
					if(typeof(opts) == 'string'){
						if(val === undefined){
							return $t.data(opts);
						}
						o[opts] = val;	
					}
					else{ o = opts; }
					return tp_inst.control.create(tp_inst, obj, $t.data('unit'), $t.val(), o.min || $t.data('min'), o.max || $t.data('max'), o.step || $t.data('step'));
				},
				value: function(tp_inst, obj, unit, val){
					var $t = obj.children('select');
					if(val !== undefined){
						return $t.val(val);
					}
					return $t.val();
				}
			}
		} // end _controls

	});

	$.fn.extend({
		/*
		* shorthand just to use timepicker..
		*/
		timepicker: function(o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);

			if (typeof o == 'object') {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				});
			}

			return $(this).each(function() {
				$.fn.datetimepicker.apply($(this), tmp_args);
			});
		},

		/*
		* extend timepicker to datepicker
		*/
		datetimepicker: function(o) {
			o = o || {};
			var tmp_args = arguments;

			if (typeof(o) == 'string') {
				if (o == 'getDate') {
					return $.fn.datepicker.apply($(this[0]), tmp_args);
				} else {
					return this.each(function() {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args);
					});
				}
			} else {
				return this.each(function() {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults);
				});
			}
		}
	});

	/*
	* Public Utility to parse date and time
	*/
	$.datepicker.parseDateTime = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec);
		}

		return parseRes.date;
	};

	/*
	* Public utility to parse time
	*/
	$.datepicker.parseTime = function(timeFormat, timeString, options) {		
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g,'').indexOf('Z') !== -1);

		// Strict parse requires the timeString to match the timeFormat exactly
		var strictParse = function(f, s, o){

			// pattern for standard and localized AM/PM markers
			var getPatternAmpm = function(amNames, pmNames) {
				var markers = [];
				if (amNames) {
					$.merge(markers, amNames);
				}
				if (pmNames) {
					$.merge(markers, pmNames);
				}
				markers = $.map(markers, function(val) {
					return val.replace(/[.*+?|()\[\]{}\\]/g, '\\$&amp;amp;');
				});
				return '(' + markers.join('|') + ')?';
			};

			// figure out position of time elements.. cause js cant do named captures
			var getFormatPositions = function(timeFormat) {
				var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
					orders = {
						h: -1,
						m: -1,
						s: -1,
						l: -1,
						c: -1,
						t: -1,
						z: -1
					};

				if (finds) {
					for (var i = 0; i &amp;lt; finds.length; i++) {
						if (orders[finds[i].toString().charAt(0)] == -1) {
							orders[finds[i].toString().charAt(0)] = i + 1;
						}
					}
				}
				return orders;
			};

			var regstr = '^' + f.toString()
					.replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
							var ml = match.length;
							switch (match.charAt(0).toLowerCase()) {
								case 'h': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'm': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 's': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'l': return '(\\d?\\d?\\d)';
								case 'c': return '(\\d?\\d?\\d)';
								case 'z': return '(z|[-+]\\d\\d:?\\d\\d|\\S+)?';
								case 't': return getPatternAmpm(o.amNames, o.pmNames);
								default:    // literal escaped in quotes
									return '(' + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function (m) { return "\\" + m; }) + ')?';
							}
						})
					.replace(/\s/g, '\\s?') +
					o.timeSuffix + '$',
				order = getFormatPositions(f),
				ampm = '',
				treg;

			treg = s.match(new RegExp(regstr, 'i'));

			var resTime = {
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0
			};

			if (treg) {
				if (order.t !== -1) {
					if (treg[order.t] === undefined || treg[order.t].length === 0) {
						ampm = '';
						resTime.ampm = '';
					} else {
						ampm = $.inArray(treg[order.t].toUpperCase(), o.amNames) !== -1 ? 'AM' : 'PM';
						resTime.ampm = o[ampm == 'AM' ? 'amNames' : 'pmNames'][0];
					}
				}

				if (order.h !== -1) {
					if (ampm == 'AM' &amp;amp;&amp;amp; treg[order.h] == '12') {
						resTime.hour = 0; // 12am = 0 hour
					} else {
						if (ampm == 'PM' &amp;amp;&amp;amp; treg[order.h] != '12') {
							resTime.hour = parseInt(treg[order.h], 10) + 12; // 12pm = 12 hour, any other pm = hour + 12
						} else {
							resTime.hour = Number(treg[order.h]);
						}
					}
				}

				if (order.m !== -1) {
					resTime.minute = Number(treg[order.m]);
				}
				if (order.s !== -1) {
					resTime.second = Number(treg[order.s]);
				}
				if (order.l !== -1) {
					resTime.millisec = Number(treg[order.l]);
				}
				if (order.c !== -1) {
					resTime.microsec = Number(treg[order.c]);
				}
				if (order.z !== -1 &amp;amp;&amp;amp; treg[order.z] !== undefined) {
					resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z]);
				}


				return resTime;
			}
			return false;
		};// end strictParse

		// First try JS Date, if that fails, use strictParse
		var looseParse = function(f,s,o){
			try{
				var d = new Date('2012-01-01 '+ s);
				if(isNaN(d.getTime())){
					d = new Date('2012-01-01T'+ s);
					if(isNaN(d.getTime())){
						d = new Date('01/01/2012 '+ s);
						if(isNaN(d.getTime())){
							throw "Unable to parse time with native Date: "+ s;
						}
					}
				}

				return {
					hour: d.getHours(),
					minute: d.getMinutes(),
					second: d.getSeconds(),
					millisec: d.getMilliseconds(),
					microsec: d.getMicroseconds(),
					timezone: d.getTimezoneOffset()*-1
				};
			}
			catch(err){
				try{
					return strictParse(f,s,o);
				}
				catch(err2){
					$.timepicker.log("Unable to parse \ntimeString: "+ s +"\ntimeFormat: "+ f);
				}				
			}
			return false;
		}; // end looseParse
		
		if(typeof o.parse === "function"){
			return o.parse(timeFormat, timeString, o);
		}
		if(o.parse === 'loose'){
			return looseParse(timeFormat, timeString, o);
		}
		return strictParse(timeFormat, timeString, o);
	};

	/*
	* Public utility to format the time
	* format = string format of the time
	* time = a {}, not a Date() for timezones
	* options = essentially the regional[].. amNames, pmNames, ampm
	*/
	$.datepicker.formatTime = function(format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			timezone: 0
		}, time);

		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);

		if (hour &amp;gt; 11) {
			ampmName = options.pmNames[0];
		}

		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|('.*?'|".*?"))/g, function(match) {
		switch (match) {
			case 'HH':
				return ('0' + hour).slice(-2);
			case 'H':
				return hour;
			case 'hh':
				return ('0' + convert24to12(hour)).slice(-2);
			case 'h':
				return convert24to12(hour);
			case 'mm':
				return ('0' + time.minute).slice(-2);
			case 'm':
				return time.minute;
			case 'ss':
				return ('0' + time.second).slice(-2);
			case 's':
				return time.second;
			case 'l':
				return ('00' + time.millisec).slice(-3);
			case 'c':
				return ('00' + time.microsec).slice(-3);
			case 'z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, false);
			case 'Z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, true);
			case 'T': 
				return ampmName.charAt(0).toUpperCase();
			case 'TT': 
				return ampmName.toUpperCase();
			case 't':
				return ampmName.charAt(0).toLowerCase();
			case 'tt':
				return ampmName.toLowerCase();
			default:
				return match.replace(/\'/g, "") || "'";
			}
		});

		tmptime = $.trim(tmptime);
		return tmptime;
	};

	/*
	* the bad hack :/ override datepicker so it doesnt close on select
	// inspired: http://stackoverflow.com/questions/1252512/jquery-datepicker-prevent-closing-picker-when-clicking-a-date/1762378#1762378
	*/
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function(id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			tp_inst._limitMinMaxDateTime(inst, true);
			inst.inline = inst.stay_open = true;
			//This way the onSelect handler called from calendarpicker get the full dateTime
			this._base_selectDate(id, dateStr);
			inst.inline = inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst);
		} else {
			this._base_selectDate(id, dateStr);
		}
	};

	/*
	* second bad hack :/ override datepicker so it triggers an event when changing the input field
	* and does not redraw the datepicker on every selectDate event
	*/
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function(inst) {

		// don't popup the datepicker if there is another instance already opened
		var input = inst.input[0];
		if ($.datepicker._curInst &amp;amp;&amp;amp; $.datepicker._curInst != inst &amp;amp;&amp;amp; $.datepicker._datepickerShowing &amp;amp;&amp;amp; $.datepicker._lastInput != input) {
			return;
		}

		if (typeof(inst.stay_open) !== 'boolean' || inst.stay_open === false) {

			this._base_updateDatepicker(inst);

			// Reload the time control when changing something in the input text field.
			var tp_inst = this._get(inst, 'timepicker');
			if (tp_inst) {
				tp_inst._addTimePicker(inst);
			}
		}
	};

	/*
	* third bad hack :/ override datepicker so it allows spaces and colon in the input field
	*/
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if ($.datepicker._get(inst, 'constrainInput')) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null? tp_inst._defaults.showTimezone : tp_inst.support.timezone,					
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat')),
					datetimeChars = tp_inst._defaults.timeFormat.toString()
											.replace(/[hms]/g, '')
											.replace(/TT/g, ampm ? 'APM' : '')
											.replace(/Tt/g, ampm ? 'AaPpMm' : '')
											.replace(/tT/g, ampm ? 'AaPpMm' : '')
											.replace(/T/g, ampm ? 'AP' : '')
											.replace(/tt/g, ampm ? 'apm' : '')
											.replace(/t/g, ampm ? 'ap' : '') + 
											" " + tp_inst._defaults.separator + 
											tp_inst._defaults.timeSuffix + 
											(tz ? tp_inst._defaults.timezoneList.join('') : '') + 
											(tp_inst._defaults.amNames.join('')) + (tp_inst._defaults.pmNames.join('')) + 
											dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr &amp;lt; ' ' || !dateChars || datetimeChars.indexOf(chr) &amp;gt; -1);
			}
		}

		return $.datepicker._base_doKeyPress(event);
	};

	/*
	* Fourth bad hack :/ override _updateAlternate function used in inline mode to init altField
	*/
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	/* Update any alternate field to synchronise with the main field. */
	$.datepicker._updateAlternate = function(inst) {
		var tp_inst = this._get(inst, 'timepicker');
		if(tp_inst){
			var altField = tp_inst._defaults.altField;
			if (altField) { // update alternate field too
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = '', 
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator, 
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if(!tp_inst._defaults.timeOnly &amp;amp;&amp;amp; !tp_inst._defaults.altFieldTimeOnly &amp;amp;&amp;amp; date !== null){
					if(tp_inst._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime;
					}
					else{
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime;
					}
				}
				$(altField).val(altFormattedDateTime);
			}
		}
		else{
			$.datepicker._base_updateAlternate(inst);
		}
	};

	/*
	* Override key up event to sync manual input changes.
	*/
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst);
				} catch (err) {
					$.timepicker.log(err);
				}
			}
		}

		return $.datepicker._base_doKeyUp(event);
	};

	/*
	* override "Today" button to also grab the time.
	*/
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function(id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		this._base_gotoToday(id);
		var tp_inst = this._get(inst, 'timepicker');
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		$('.ui-datepicker-today', $dp).click();
	};

	/*
	* Disable &amp;amp; enable the Time in the datetimepicker
	*/
	$.datepicker._disableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst);
		}
	};

	$.datepicker._enableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst); // Could be disabled on page load
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create our own set time function
	*/
	$.datepicker._setTime = function(inst, date) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var defaults = tp_inst._defaults;

			// calling _setTime with no date sets time to defaults
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;

			//check if within min/max times.. 
			tp_inst._limitMinMaxDateTime(inst, true);

			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create new public method to set only time, callable as $().datepicker('setTime', date)
	*/
	$.datepicker._setTimeDatepicker = function(target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date == "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec);
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds());
				}
				if (tp_date.toString() == 'Invalid Date') {
					tp_date = undefined;
				}
				this._setTime(inst, tp_date);
			}
		}

	};

	/*
	* override setDate() to allow setting time too within Date object
	*/
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function(target, date) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		if(typeof(date) === 'string'){
			date = new Date(date);
			if(!date.getTime()){
				$.timepicker.log("Error creating Date object from string.");
			}
		}

		var tp_inst = this._get(inst, 'timepicker');
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds());
		} else {
			tp_date = date;
		}
		
		// This is important if you are using the timezone option, javascript's Date 
		// object will only return the timezone offset for the current locale, so we 
		// adjust it accordingly.  If not using timezone option this won't matter..
		// If a timezone is different in tp, keep the timezone as is
		if(tp_inst){
			// look out for DST if tz wasn't specified
			if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
				tp_inst.timezone = tp_date.getTimezoneOffset()*-1;
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone);
		}

		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true);
	};

	/*
	* override getDate() to allow getting time too within Date object
	*/
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function(target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			// if it hasn't yet been defined, grab from field
			if(inst.lastVal === undefined){
				this._setDateFromField(inst, noDefault);
			}

			var date = this._getDate(inst);
			if (date &amp;amp;&amp;amp; tp_inst._parseTime($(target).val(), tp_inst.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);

				// This is important if you are using the timezone option, javascript's Date 
				// object will only return the timezone offset for the current locale, so we 
				// adjust it accordingly.  If not using timezone option this won't matter..
				if(tp_inst.timezone != null){
					// look out for DST if tz wasn't specified
					if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
						tp_inst.timezone = date.getTimezoneOffset()*-1;
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
				}
			}
			return date;
		}
		return this._base_getDateDatepicker(target, noDefault);
	};

	/*
	* override parseDate() because UI 1.8.14 throws an error about "Extra characters"
	* An option in datapicker to ignore extra format characters would be nicer.
	*/
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function(format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings);
		} catch (err) {
			// Hack!  The error message ends with a colon, a space, and
			// the "extra" characters.  We rely on that instead of
			// attempting to perfectly reproduce the parsing algorithm.
			if (err.indexOf(":") &amp;gt;= 0) {
				date = this._base_parseDate(format, value.substring(0,value.length-(err.length-err.indexOf(':')-2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format);
			} else {
				throw err;
			}
		}
		return date;
	};

	/*
	* override formatDate to set date with time to the input
	*/
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function(inst, day, month, year) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val();
		}
		return this._base_formatDate(inst);
	};

	/*
	* override options setter to add time to maxDate(Time) and minDate(Time). MaxDate
	*/
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function(target, name, value) {
		var inst = this._getInst(target),
	        name_clone;
		if (!inst) {
			return null;
		}

		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop;
		    if (typeof name == 'string') { // if min/max was set with the string
		        if (name === 'minDate' || name === 'minDateTime') {
		            min = value;
		        } else if (name === 'maxDate' || name === 'maxDateTime') {
		            max = value;
		        } else if (name === 'onSelect') {
		            onselect = value;
		        } else if (overrides.hasOwnProperty(name)) {
		            if (typeof (value) === 'undefined') {
		                return overrides[name];
		            }
		            fns[name] = value;
		            name_clone = {}; //empty results in exiting function after overrides updated
		        }
		    } else if (typeof name == 'object') { //if min/max was set with the JSON
		        if (name.minDate) {
		            min = name.minDate;
		        } else if (name.minDateTime) {
		            min = name.minDateTime;
		        } else if (name.maxDate) {
		            max = name.maxDate;
		        } else if (name.maxDateTime) {
		            max = name.maxDateTime;
		        }
		        for (prop in overrides) {
		            if (overrides.hasOwnProperty(prop) &amp;amp;&amp;amp; name[prop]) {
		                fns[prop] = name[prop];
		            }
		        }
		    }
		    for (prop in fns) {
		        if (fns.hasOwnProperty(prop)) {
		            overrides[prop] = fns[prop];
		            if (!name_clone) { name_clone = $.extend({}, name);}
		            delete name_clone[prop];
		        }
		    }
		    if (name_clone &amp;amp;&amp;amp; isEmptyObject(name_clone)) { return; }
		    if (min) { //if min was set
		        if (min === 0) {
		            min = new Date();
		        } else {
		            min = new Date(min);
		        }
		        tp_inst._defaults.minDate = min;
		        tp_inst._defaults.minDateTime = min;
		    } else if (max) { //if max was set
		        if (max === 0) {
		            max = new Date();
		        } else {
		            max = new Date(max);
		        }
		        tp_inst._defaults.maxDate = max;
		        tp_inst._defaults.maxDateTime = max;
		    } else if (onselect) {
		        tp_inst._defaults.onSelect = onselect;
		    }
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name);
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
	};
	
	/*
	* jQuery isEmptyObject does not check hasOwnProperty - if someone has added to the object prototype,
	* it will return false for all objects
	*/
	var isEmptyObject = function(obj) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(obj)) {
				return false;
			}
		}
		return true;
	};

	/*
	* jQuery extend now ignores nulls!
	*/
	var extendRemove = function(target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] === null || props[name] === undefined) {
				target[name] = props[name];
			}
		}
		return target;
	};

	/*
	* Determine by the time format which units are supported
	* Returns an object of booleans for each unit
	*/
	var detectSupport = function(timeFormat){
		var tf = timeFormat.replace(/\'.*?\'/g,'').toLowerCase(), // removes literals
			isIn = function(f, t){ // does the format contain the token?
					return f.indexOf(t) !== -1? true:false; 
				};
		return {
				hour: isIn(tf,'h'),
				minute: isIn(tf,'m'),
				second: isIn(tf,'s'),
				millisec: isIn(tf,'l'),
				microsec: isIn(tf,'c'),
				timezone: isIn(tf,'z'),
				ampm: isIn(tf,'t') &amp;amp;&amp;amp; isIn(timeFormat,'h'),
				iso8601: isIn(timeFormat, 'Z')
			};
	};

	/*
	* Converts 24 hour format into 12 hour
	* Returns 12 hour without leading 0
	*/
	var convert24to12 = function(hour) {
		if (hour &amp;gt; 12) {
			hour = hour - 12;
		}

		if (hour === 0) {
			hour = 12;
		}

		return String(hour);
	};

	/*
	* Splits datetime string into date ans time substrings.
	* Throws exception when date can't be parsed
	* Returns [dateString, timeString]
	*/
	var splitDateTime = function(dateFormat, dateTimeString, dateSettings, timeSettings) {
		try {
			// The idea is to get the number separator occurances in datetime and the time format requested (since time has 
			// fewer unknowns, mostly numbers and am/pm). We will use the time pattern to split.
			var separator = timeSettings &amp;amp;&amp;amp; timeSettings.separator ? timeSettings.separator : $.timepicker._defaults.separator,
				format = timeSettings &amp;amp;&amp;amp; timeSettings.timeFormat ? timeSettings.timeFormat : $.timepicker._defaults.timeFormat,
				timeParts = format.split(separator), // how many occurances of separator may be in our format?
				timePartsLen = timeParts.length,
				allParts = dateTimeString.split(separator),
				allPartsLen = allParts.length;

			if (allPartsLen &amp;gt; 1) {
				return [
						allParts.splice(0,allPartsLen-timePartsLen).join(separator),
						allParts.splice(0,timePartsLen).join(separator)
					];
			}

		} catch (err) {
			$.timepicker.log('Could not split the date from the time. Please check the following datetimepicker options' +
					"\nthrown error: " + err +
					"\ndateTimeString" + dateTimeString +
					"\ndateFormat = " + dateFormat +
					"\nseparator = " + timeSettings.separator +
					"\ntimeFormat = " + timeSettings.timeFormat);

			if (err.indexOf(":") &amp;gt;= 0) {
				// Hack!  The error message ends with a colon, a space, and
				// the "extra" characters.  We rely on that instead of
				// attempting to perfectly reproduce the parsing algorithm.
				var dateStringLength = dateTimeString.length - (err.length - err.indexOf(':') - 2),
					timeString = dateTimeString.substring(dateStringLength);

				return [$.trim(dateTimeString.substring(0, dateStringLength)), $.trim(dateTimeString.substring(dateStringLength))];

			} else {
				throw err;
			}
		}
		return [dateTimeString, ''];
	};

	/*
	* Internal function to parse datetime interval
	* Returns: {date: Date, timeObj: Object}, where
	*   date - parsed date without time (type Date)
	*   timeObj = {hour: , minute: , second: , millisec: , microsec: } - parsed time. Optional
	*/
	var parseDateTimeInternal = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var date;
		var splitRes = splitDateTime(dateFormat, dateTimeString, dateSettings, timeSettings);
		date = $.datepicker._base_parseDate(dateFormat, splitRes[0], dateSettings);
		if (splitRes[1] !== '') {
			var timeString = splitRes[1],
				parsedTime = $.datepicker.parseTime(timeFormat, timeString, timeSettings);

			if (parsedTime === null) {
				throw 'Wrong time format';
			}
			return {
				date: date,
				timeObj: parsedTime
			};
		} else {
			return {
				date: date
			};
		}
	};

	/*
	* Internal function to set timezone_select to the local timezone
	*/
	var selectLocalTimezone = function(tp_inst, date) {
		if (tp_inst &amp;amp;&amp;amp; tp_inst.timezone_select) {
			var now = typeof date !== 'undefined' ? date : new Date();
			tp_inst.timezone_select.val(now.getTimezoneOffset()*-1);
		}
	};

	/*
	* Create a Singleton Insance
	*/
	$.timepicker = new Timepicker();

	/**
	 * Get the timezone offset as string from a date object (eg '+0530' for UTC+5.5)
	 * @@param  number if not a number this value is returned
	 * @@param boolean if true formats in accordance to iso8601 "+12:45"
	 * @@return string
	 */
	$.timepicker.timezoneOffsetString = function(tzMinutes, iso8601) {
		if(isNaN(tzMinutes) || tzMinutes &amp;gt; 840){
			return tzMinutes;
		}

		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601? ':':'',
			tz = (off &amp;gt;= 0 ? '+' : '-') + ('0' + (hours * 101).toString()).slice(-2) + iso + ('0' + (minutes * 101).toString()).slice(-2);
		
		if(tz == '+00:00'){
			return 'Z';
		}
		return tz;
	};

	/**
	 * Get the number in minutes that represents a timezone string
	 * @@param  string formated like "+0500", "-1245"
	 * @@return number
	 */
	$.timepicker.timezoneOffsetNumber = function(tzString) {
		tzString = tzString.toString().replace(':',''); // excuse any iso8601, end up with "+1245"

		if(tzString.toUpperCase() === 'Z'){ // if iso8601 with Z, its 0 minute offset
			return 0;
		}

		if(!/^(\-|\+)\d{4}$/.test(tzString)){ // possibly a user defined tz, so just give it back
			return tzString;
		}

		return ((tzString.substr(0,1) =='-'? -1 : 1) * // plus or minus
					((parseInt(tzString.substr(1,2),10)*60) + // hours (converted to minutes)
					parseInt(tzString.substr(3,2),10))); // minutes
	};

	/**
	 * No way to set timezone in js Date, so we must adjust the minutes to compensate. (think setDate, getDate)
	 * @@param  date
	 * @@param  string formated like "+0500", "-1245"
	 * @@return date
	 */
	$.timepicker.timezoneAdjust = function(date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if(!isNaN(toTz)){
			date.setMinutes(date.getMinutes()*1 + (date.getTimezoneOffset()*-1 - toTz*1) );
		}
		return date;
	};

	/**
	 * Calls `timepicker()` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * n.b. The input value must be correctly formatted (reformatting is not supported)
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the timepicker() call
	 * @@return jQuery
	 */
	$.timepicker.timeRange = function(startTime, endTime, options) {
		return $.timepicker.handleRange('timepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datetimepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@return jQuery
	 */
	$.timepicker.datetimeRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datetimepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.dateRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.handleRange = function(method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0, // min allowed interval in milliseconds
			maxInterval: 0, // max allowed interval in milliseconds
			start: {},      // options for start picker
			end: {}         // options for end picker
		}, options);

		$.fn[method].call(startTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), endTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), endTime, 'minDate');
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), startTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), startTime, 'maxDate');
			}
		}, options, options.end));

		checkDates(startTime, endTime);
		selected(startTime, endTime, 'minDate');
		selected(endTime, startTime, 'maxDate');

		function checkDates(changed, other) {
			var startdt = startTime[method]('getDate'),
				enddt = endTime[method]('getDate'),
				changeddt = changed[method]('getDate');

			if(startdt !== null){
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());

				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);

				if(options.minInterval &amp;gt; 0 &amp;amp;&amp;amp; minDate &amp;gt; enddt){ // minInterval check
					endTime[method]('setDate',minDate);
				}
				else if(options.maxInterval &amp;gt; 0 &amp;amp;&amp;amp; maxDate &amp;lt; enddt){ // max interval check
					endTime[method]('setDate',maxDate);
				}
				else if (startdt &amp;gt; enddt) {
					other[method]('setDate',changeddt);
				}
			}
		}

		function selected(changed, other, option) {
			if (!changed.val()) {
				return;
			}
			var date = changed[method].call(changed, 'getDate');
			if(date !== null &amp;amp;&amp;amp; options.minInterval &amp;gt; 0){
				if(option == 'minDate'){
					date.setMilliseconds(date.getMilliseconds() + options.minInterval); 
				}
				if(option == 'maxDate'){
					date.setMilliseconds(date.getMilliseconds() - options.minInterval);
				}
			}
			if (date.getTime) {
				other[method].call(other, 'option', option, date);
			}
		}
		return $([startTime.get(0), endTime.get(0)]);
	};

	/**
	 * Log error or data to the console during error or debugging
	 * @@param  Object err pass any type object to log to the console during error or debugging
	 * @@return void
	 */
	$.timepicker.log = function(err){
		if(window.console){
			console.log(err);
		}
	};

	/*
	* Microsecond support
	*/
	if(!Date.prototype.getMicroseconds){
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function(){ return this.microseconds; };
		Date.prototype.setMicroseconds = function(m){ 
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m/1000));
			this.microseconds = m%1000;
			return this;
		};
	}

	/*
	* Keep up with the version
	*/
	$.timepicker.version = "1.3.1";

})(jQuery);
jQuery.noConflict();
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;datetimepicker-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;e73a652e-09fc-4c71-8e7a-e2525a2d2a99&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
function replaceAllString(oriStr, strTarget, strSubString ){
   var strText = oriStr;
   var intIndexOfMatch = strText.indexOf( strTarget );
   while (intIndexOfMatch != -1){
      strText = strText.replace( strTarget, strSubString )
      intIndexOfMatch = strText.indexOf( strTarget );
   }
   return( strText );
}
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&amp;amp;]" + name + "=([^&amp;amp;#]*)"),
    results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
};


   var jobName= getParameterByName('job')
   var fromDate= getParameterByName('fromDate')
   var toDate= getParameterByName('toDate')
   var limit= getParameterByName('limit')
   var selectedIstIid = getParameterByName('IstIid')

  $("#jobname").ready(function(){
   $("#jobname").text(jobName)
   var convertedJobName = replaceAllString(jobName, ".", "_")
   $("#IstIid" + convertedJobName).ready(function(){
     $("#IstIid" + convertedJobName).css("display","block")
     $("#select_" + convertedJobName).ready(function(){
        $("#select_" + convertedJobName).val(selectedIstIid)
     });
   });
 });

  $("#fromDate").ready(function(){
   $("#from-date").val(fromDate)
 });

  $("#toDate").ready(function(){
   $("#to-date").val(toDate)
 });

  $("#limit").ready(function(){
   if(limit!=""){
    $("#limit").val(limit)
   }
 });
 // Get data with ajax
 function ajax_getData(jobName,fromDate,toDate,limit ){
       var convertedJobName = replaceAllString(jobName, ".", "_")
       var istIid = $("#select_" + convertedJobName).val()
       window.location="/xwiki/bin/view/WiperDog/WebHome?job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid="+istIid;
 			/*$.ajax({
			 type: "GET",
			 url:"/xwiki/bin/get/Sandbox/DescriptionForJob?outputSyntax=plain&amp;amp;job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid"+selectedIstIid,
			 success : function(result){
				$("#jobname").html(jobName)
				$("#display").text('[[]]' + result)
			 }
		   });*/
 }
	$("#treemenu2 a").click(function(){
		 var limit = 10
		 var fromDate=""
		 var toDate = ""
		 jobName= $(this).text()
                 $("#jobname").html(jobName)
                 var convertedJobName = replaceAllString(jobName, ".", "_")
                 $("#listIstIid &amp;gt; div").css("display","none")
                 $("#IstIid" + convertedJobName).css("display","block")
		 //ajax_getData(jobName,fromDate,toDate,limit )

	});

	$("#from-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
		dateFormat: 'yy-mm-dd',
	});
	$("#to-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
			dateFormat: 'yy-mm-dd',

	});
	 $("#get-data").on("click",function(){
		var fromDate = $("#from-date").val()
		var toDate =  $("#to-date").val()
		 if( toDate!= "" ){
			  if(fromDate != ""){
				  if($("#from-date").datepicker( "getDate" ) &amp;gt; $("#to-date").datepicker( "getDate" )){
				  alert("'From date' cannot start later than 'To date'")
				  return false
				  }
			  }
		 }
		 limit = $("#limit").val()
		 ajax_getData(jobName,fromDate,toDate,limit )
	});
$(document).ready(function(){
  var keys = $("#lstkey").text()
  //console.log('key == ' + keys);
  //console.log('livetableJson ==' + $("#livetableJson").text());
  
  var jsonObj = $.parseJSON($("#livetableJson").text()); 
  if(keys &amp;amp;&amp;amp; keys != '[ ]'){
    /** Subtyped **/    
    var newKeys = keys.replace('[',"");
    keys = newKeys.replace(']',"");
    var keyArr = (keys.indexOf(',') != -1)? keys.split(','):new Array(keys);
    //console.log('Key after replace: '+keys)       
    for(var i=0;i&amp;lt;keyArr.length;i++){
        var keyName = keyArr[i].trim().replace('',"").replace("\"","").replace('\"','');
        var subTypeJsonObjStr = jsonObj[keyName].replace('#livetablePager','#livetablePager_'+keyName)
        var subTypeJsonObj = $.parseJSON(subTypeJsonObjStr);
        $("#livetableList_"+keyName).jqGrid(subTypeJsonObj);
        $("#livetableList_"+keyName).jqGrid('navGrid', "#livetablePager_"+keyName, {
           edit : false,
           add : false,
           del : false,
           search:false
         });
    }
    
  }else{ /** Store**/        
      $("#livetableList").jqGrid(jsonObj);
      $("#livetableList").jqGrid('navGrid', "#livetablePager", {
           edit : false,
           add : false,
           del : false,
           search:false
           
       });
   }
});
        
jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;process&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;881686cc-1bfc-456e-b8ab-71334c4a45e5&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){

	$(function () {
		function drawLineChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerline' + container).highcharts({

				chart: {
					type:'line'
				},
				title: {
					text: chart_name
				},
				tooltip :{
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				xAxis: dataXAxis ,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				series: dataSeries
			});
		};

		function drawBarChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerbar' + container).highcharts({
				chart: {
					type: 'column'
				},
				title: {
					text: chart_name
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {

					column: {
						pointPadding: 0.2,
						borderWidth: 0
					}
				},
				series: dataSeries
			});
		}

		function drawAreaChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail
			$('#containerarea' + container).highcharts({
				chart: {
					type: 'area'
				},
				title: {
					text: chart_name
				},
				subtitle: {
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					},
					labels: {
						formatter: function() {
							return this.value / 1000;
						}
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {
					area: {
						stacking: 'normal',
						lineColor: '#666666',
						lineWidth: 1,
						marker: {
							lineWidth: 1,
							lineColor: '#666666'
						}
					}
				},
				series: dataSeries
			});
		};

		function drawPieChart(data, container, chartName){
			var dataPie = data
			$(document).ready(function () {
				// Build the chart
				$('#container' + container).highcharts({
					chart: {
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: chartName
					},
					tooltip: {
						pointFormat: '{series.name}: &amp;lt;b&amp;gt;{point.percentage:.1f}%&amp;lt;/b&amp;gt;'
					},
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							dataLabels: {
								enabled: true,
                                                                color: '#000000',
                                                                connectorColor: '#000000',
                                                                format: '&amp;lt;b&amp;gt;{point.name}&amp;lt;/b&amp;gt;: {point.percentage:.1f} %'
							},
							showInLegend: true
						}
					},
					series: dataPie
				});
			});
		}

		// LINE
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                     if(($("#jsons&amp;gt;#jsonline_" + finalKey)).length &amp;gt; 0) {
					var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonline_" + finalKey).val());
					var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerline_" + finalKey).val());
				        var lstContainer = [];
  				        var data_all = [];
                                        var chartSize = arrayAll.length

                                        for(var i=0;i&amp;lt;chartSize ;i++){
                                           data_all = arrayAll[i]
                                           lstContainer = arrayContainerAll[i]
				           if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					        // data to display on tooltip
					        var data_detail = data_all[0]
					        // draw Line chart
				        	for(var j=0;j&amp;lt;data_all.length;j++){
				        		if(data_all[j].series[0].name == null){
				        			data_all[j].series[0].name = lstContainer[j]
					        	}
                                                        chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					        	drawLineChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					        }
				         }
                                      }
                                  }
				}
			} else {
				var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonline").val());
				var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerline").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length

                                for(var i=0;i&amp;lt;chartSize ;i++){
                                   data_all = arrayAll[i]
                                   lstContainer = arrayContainerAll[i]
				   if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Line chart
					for(var j=0;j&amp;lt;data_all.length;j++){
						if(data_all[j].series[0].name == null){
							data_all[j].series[0].name = lstContainer[j]
						}
                                                chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
						drawLineChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
				   }
                                }
			}
		});

		// BAR
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
			             var finalKey = lstKey[eKey]
                                     if(($("#jsons&amp;gt;#jsonbar_" + finalKey)).length &amp;gt; 0) {
					var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonbar_" + finalKey).val());
					var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerbar_" + finalKey).val());
					var lstContainer = [];
					var data_all = [];
                                        var chartSize = arrayAll.length
					for(var i=0;i&amp;lt;chartSize ;i++){
					    data_all = arrayAll[i]
					    lstContainer = arrayContainerAll[i]
					    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw bar chart
						for(var j=0;j&amp;lt;data_all.length;j++){
							if(data_all[j].series[0].name == null){
								data_all[j].series[0].name = lstContainer[j]
							}
                                                        chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
							drawBarChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
						}
                                            }
					}
                                    }
				}
			} else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonbar").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerbar").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
				    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Bar chart
					for(var j=0;j&amp;lt;data_all.length;j++){
                                            if(data_all[j].series[0].name == null){
						data_all[j].series[0].name = lstContainer[j]
					    }
                                            chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					    drawBarChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
                                    }
				}
			}
		});

		// AREA
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
                        var arrayAll
                        var arrayContainerAll
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                        if(($("#jsons&amp;gt;#jsonarea_" + finalKey)).length &amp;gt; 0) {
                                           arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonarea_" + finalKey).val());
                                           arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerarea_" + finalKey).val());
					   var lstContainer = [];
					   var data_all = [];
                                           var chartSize = arrayAll.length
					   for(var i=0;i&amp;lt;chartSize ;i++){
					       data_all = arrayAll[i]
					       lstContainer = arrayContainerAll[i]
					       if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						   // data to display on tooltip
						   var data_detail = data_all[0]
						   // draw Line chart
						   for(var j=0;j&amp;lt;data_all.length;j++){
						      if(data_all[j].series[0].name == null){
						         data_all[j].series[0].name = lstContainer[j]
						       }
                                                       chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
						       drawAreaChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
						   }
					      }
				           }
                                        }
			          }
                        } else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonarea").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerarea").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
				    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw area chart
					for(var j=0;j&amp;lt;data_all.length;j++){
                                            if(data_all[j].series[0].name == null){
						data_all[j].series[0].name = lstContainer[j]
					    }
                                            chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					    drawAreaChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
                                    }
				}
			}
		});

		// PIE
		$(document ).ready(function(){
                        var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
                        var arrayAll
                        var arrayContainerAll
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                        if(($("#jsons&amp;gt;#jsonpie_" + finalKey)).length &amp;gt; 0) {
                                           arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonpie_" + finalKey).val());
                                           arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerpie_" + finalKey).val());
					   var lstContainer = [];
					   var data_all = [];
                                           var chartSize = arrayAll.length
					  for(var i=0;i&amp;lt;chartSize ;i++){
					       data_all = arrayAll[i]
					       lstContainer = arrayContainerAll[i]
					       if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						   // draw Pie chart
						   for(var j=0;j&amp;lt;data_all.length;j++){
                                                       chartName  = data_all[j].chart_name + "( " + data_all[j].name + " )"
						       drawPieChart([data_all[j]], finalKey + "_" + lstContainer[j], chartName)
						   }
					      }
				           }
                                        }
			          }
			} else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonpie").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerpie").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
                                var chartNum = 0
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
                                    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
                                                   for(var j=0;j&amp;lt;data_all.length;j++){
                                                       if (data_all[j].name != data_all[j].chart_name) {
                                                           chartName  = data_all[j].chart_name + "( " + data_all[j].name + " )"
                                                       } else {
                                                           chartName  = data_all[j].chart_name
                                                       }
						       drawPieChart([data_all[j]], chartNum + "_pie", chartName)
                                                       chartNum++
						   }

                                    }
                                }
			}
		});
	});
	jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;d5873d92-b78b-42fc-9407-46d166204b88&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;/* css for timepicker */
.ui-timepicker-div .ui-widget-header { 
margin-bottom: 8px;
 }

.ui-timepicker-div dl { text-align: left; }
.ui-timepicker-div dl dt { height: 25px; margin-bottom: -25px; }
.ui-timepicker-div dl dd { margin: 0 10px 10px 65px; }
.ui-timepicker-div td { font-size: 90%; }
.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }

.ui-timepicker-rtl{ direction: rtl; }
.ui-timepicker-rtl dl { text-align: right; }
.ui-timepicker-rtl dl dd { margin: 0 65px 10px 10px; }
#ui-datepicker-div{
 position:relative;
 width:auto;
 height:auto
}
&lt;/code&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;datetimepicker -css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;1201fb1a-e9c1-4731-8c74-2ea8c0071959&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;.displayblock {
  border:2px solid;
  -webkit-border-radius:6px;
  background:gray;
  float: left;
  width:100%;
}

.displaypie {
  border:1px solid;
  -webkit-border-radius:6px;
  background:gray;
  width: 48%;
  float: left; 
  height: 300px;
}

.subtype {
  margin-top: 50px;
  font-size: 2em;
  color: red;
}&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;content&gt;{{include document="Lib.DataToDrawChart"/}}
{{include document="Lib.MongoDBConnection"/}}
{{velocity}}
$xwiki.jsx.use('Lib.JQueryUILib')
$xwiki.ssx.use('Lib.MenuGenerator')
$xwiki.jsx.use('Lib.MenuGenerator')
$xwiki.ssx.use('Lib.JQueryUILib')
$xwiki.jsx.use('Lib.JqGridLib')
$xwiki.ssx.use('Lib.JqGridLib') 
{{/velocity}}
{{include document="Lib.MenuGenerator"/}}
{{html wiki="true" clean="false"}}
&amp;lt;div id="viewer"&amp;gt;
&amp;lt;table style="text-align:left"  &amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th &amp;gt;Job name&amp;lt;/th&amp;gt;
  &amp;lt;td colspan=3&amp;gt;&amp;lt;div id="jobname"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
{{groovy}}
import org.xwiki.context.*

def ec = services.component.getInstance(Execution.class).getContext()
def mapJobIstIid = ec.getProperty("mapJobIstIid")

println '{{html clean="false" wiki="false"}}'
println '&amp;lt;tr&amp;gt;'
println '&amp;lt;th&amp;gt;IstIid&amp;lt;/th&amp;gt;'
println '&amp;lt;td colspan=3&amp;gt;'
mapJobIstIid.each{jobEntry-&amp;gt;
  def convertedJobKey = jobEntry.key.replaceAll("\\.","_")
  println "&amp;lt;div id='listIstIid'&amp;gt;"
  println "&amp;lt;div id=IstIid${convertedJobKey} style='display:none'&amp;gt;"
  println "&amp;lt;select id=select_${convertedJobKey}&amp;gt;"
  jobEntry.value.each{
     println "&amp;lt;option value=\"$it\"&amp;gt;$it&amp;lt;/option&amp;gt;"
  }
  println "&amp;lt;/select&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
}
println '&amp;lt;/td&amp;gt;'
println '&amp;lt;/tr&amp;gt;'
println '{{/html}}'
{{/groovy}}
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data monitor from&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="from-date" id="from-date"/&amp;gt;&amp;lt;/td&amp;gt;
  &amp;lt;th&amp;gt;Data monitor to&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="to-date" id="to-date"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data records limit &amp;lt;/th&amp;gt;
  &amp;lt;td &amp;gt;
     &amp;lt;select id="limit"&amp;gt;
       &amp;lt;option value=5&amp;gt;5&amp;lt;/option&amp;gt;
       &amp;lt;option value=10&amp;gt;10&amp;lt;/option&amp;gt;
       &amp;lt;option value=15&amp;gt;15&amp;lt;/option&amp;gt;
       &amp;lt;option value=20&amp;gt;20&amp;lt;/option&amp;gt;
     &amp;lt;/select&amp;gt;
  &amp;lt;/td&amp;gt;
  &amp;lt;td colspan=3 &amp;gt;&amp;lt;input type="button" value="View Data" id="get-data" class="button"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;&amp;lt;div id="display"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
  &amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
&amp;lt;/table&amp;gt;

&amp;lt;/div&amp;gt; 
   
 &amp;lt;/body&amp;gt;

{{/html}}
{{groovy}}
import groovy.json.*
xwiki.jsx.use("Lib.Highcharts")

if(request.xpage == "plain") {
	response.setContentType('text/plain')
}

def listData = []
def job = request.get("job")
def fromDate = request.get("fromDate")
def toDate = request.get("toDate")
def limit= (request.get("limit")!=null)?request.get("limit").toInteger():10
def istIid = request.get("IstIid")

def str= "No data to retrieved !"
def result = null
if(job != "" &amp;amp;&amp;amp; job != null &amp;amp;&amp;amp; istIid != null &amp;amp;&amp;amp; istIid != ""){
	MongoDBConnection.getConnection()
	if(fromDate != "" || toDate != ""){
		result = MongoDBConnection.getDataInPeriod(job,fromDate,toDate,limit,istIid)
	} else {
		result = MongoDBConnection.getDataAllFields(job,limit,istIid)
        }
MongoDBConnection.closeConnection()
} else {
   println "{{warning}}There are no selected job or IstIid{{/warning}}"
}
def listKey = []
if( (result != null) &amp;amp;&amp;amp; (result.size() &amp;gt; 0) &amp;amp;&amp;amp; (result[0].KEYEXPR != null)&amp;amp;&amp;amp;!(result[0].KEYEXPR instanceof List )){

//Format data fetchAt
result.each {item -&amp;gt;
    def newdate = new Date().parse("yyyyMMddHHmmssz", item['fetchAt'])
    item['fetchAt'] = newdate.format('yyyy/MM/dd HH:mm:ss z')
}

//Draw chart
if(result[0].type == "Subtyped") {
    println '{{html clean="false" wiki="true"}}'
    //println '&amp;lt;body&amp;gt;'
    def dataSubtype = DataToDrawChart.getDataToDrawSubtype(result)
    dataSubtype.each {key,value -&amp;gt;
        listKey.add(key)
    }
    def jsonkey = com.mongodb.util.JSON.serialize(listKey)
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$jsonkey&amp;lt;/textarea&amp;gt;"

    dataSubtype.each {key,value -&amp;gt;
            def dataLine = []
            def dataBar = []
            def dataPie = []
            def dataArea = []
            if(DataToDrawChart.getDataToDrawLine(value) != []) {
                dataLine = DataToDrawChart.getDataToDrawLine(value)
            }
            if(DataToDrawChart.getDataToDrawBar(value) != []) {
                dataBar = DataToDrawChart.getDataToDrawBar(value)
            }
            if(DataToDrawChart.getDataToDrawPie(value) != []) {
                dataPie = DataToDrawChart.getDataToDrawPie(value)
            }
            if(DataToDrawChart.getDataToDrawArea(value) != []) {
                dataArea = DataToDrawChart.getDataToDrawArea(value)
            }

		def chartColumnsLine = []
		def chartColumnsBar = []
		def chartColumnsArea = []
		def lstName

                dataLine.each {itemDataLine -&amp;gt;
                    if(itemDataLine.size() &amp;gt; 0 ){
		        chartColumnsLine.add(itemDataLine[0].chart_columns)
	            }
                }
                dataBar.each {itemDataBar -&amp;gt;
                    if(itemDataBar.size() &amp;gt; 0 ){
		        chartColumnsBar.add(itemDataBar[0].chart_columns)
	            }
                }
                dataArea.each {itemDataArea -&amp;gt;
                    if(itemDataArea.size() &amp;gt; 0 ){
		        chartColumnsArea.add(itemDataArea[0].chart_columns)
	            }
                }

		if(dataPie.size() &amp;gt; 0 ){
			lstName = dataPie['name']
		}
		def tmpListNameContainer = []
                
		if(lstName != null) {
                        def chartNumPie = 0
                        def tmpLst
                        for(def nameContainer in lstName){
                           tmpLst = []
			   for(def nameContainerItem in nameContainer ){
				nameContainerItem = chartNumPie + "_" + nameContainerItem.replaceAll("\\.", "_")
				tmpLst.add(nameContainerItem )
		            }
                            tmpListNameContainer.add(tmpLst)
                            chartNumPie++
                         }
		}
		def jsonPie
		def jsonLine
		def jsonBar
		def jsonArea
		if(dataPie != []) {
		    jsonPie = com.mongodb.util.JSON.serialize(dataPie)
		}
		if(dataLine != []) {
		    jsonLine = com.mongodb.util.JSON.serialize(dataLine)
		}
		if(dataBar != []) {
		    jsonBar = com.mongodb.util.JSON.serialize(dataBar)
		}
		if(dataArea != []) {
		    jsonArea = com.mongodb.util.JSON.serialize(dataArea)
		}
		def jsonContainerPie
		if(tmpListNameContainer != []) {
			jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
		}
		def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
		def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
		def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

		println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
		if(jsonLine != null) {
			println "&amp;lt;textarea id=\"jsonline_$key\" &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class=\"lstcontainerline_$key\" &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
		}
		if(jsonBar != null) {
			println "&amp;lt;textarea id=\"jsonbar_$key\"&amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerbar_$key' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
		}
		if(jsonPie != null &amp;amp;&amp;amp; jsonContainerPie != null) {
			println "&amp;lt;textarea id=\"jsonpie_$key\" &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerpie_$key' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
		}
		if(jsonArea != null) {
			println "&amp;lt;textarea id=\"jsonarea_$key\" &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerarea_$key' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
		}

        println "&amp;lt;/div&amp;gt;"
        def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
        def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
          
        println "&amp;lt;div style='clear:both'&amp;gt;"
            def description = value.KEYEXPR._description[0][key]
            if(description != null) {
                println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +': ' + description +'&amp;lt;/div&amp;gt;'
            } else {
                println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +'&amp;lt;/div&amp;gt;'
            }
            println "-----"
            if(jsonPie != null) {
          println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
	  chartNumPie = 0
          lstName.each{chartPieLst -&amp;gt;
		chartPieLst.each {
	            def tmp = chartNumPie + "_" + it.replaceAll("\\.", "_")
		    println " &amp;lt;div class=\"displaypie\" id=\"container${key}_${tmp}\" &amp;gt;&amp;lt;/div&amp;gt;"
          	}
		chartNumPie++
	  }	
          println "&amp;lt;/div&amp;gt;"
            }
            if(jsonLine != null) {
          	def chartLineComment = false
		def chartNumLine = 0
          	chartColumnsLine.each{chartColumnsLineItem -&amp;gt;
            		if(!chartLineComment){
               			println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
               			chartLineComment = true  
            		}
		chartColumnsLineItem.each{
              		println " &amp;lt;div class=\"displayblock\" id=\"containerline${key}_${chartNumLine}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          	}
		chartNumLine ++
	    }
          println "&amp;lt;/div&amp;gt;"
            }
            println "&amp;amp;nbsp;"

            if(jsonBar != null) {
          	def chartBarComment = false
  		def chartNumBar = 0
          	chartColumnsBar.each{chartColumnsBarItem -&amp;gt;
             		if(!chartBarComment){
                		println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
                		chartBarComment = true
              		}  
			chartColumnsBarItem.each{
             			println " &amp;lt;div class=\"displayblock\" id=\"containerbar${key}_${chartNumBar}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          		}
			chartNumBar++
		}
          	println "&amp;lt;/div&amp;gt;"
            }
            println "&amp;amp;nbsp;"

            if(jsonArea != null) {
          	def chartAreaComment = false
		def chartNumArea = 0
          	chartColumnsArea.each{chartColumnsAreaItem -&amp;gt;
          		if(!chartAreaComment){
            			println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
            			chartAreaComment = true
          		}
			chartColumnsAreaItem.each{
            			println " &amp;lt;div class=\"displayblock\" id=\"containerarea${key}_${chartNumArea}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          		}
          		chartNumArea++
            	}
        	println "&amp;lt;/div&amp;gt;"
	    }
        /** Statistic data table **/
        println "&amp;lt;center&amp;gt;"        
        println "&amp;lt;div id='livetblContent_"+key+"' style='width:100%;clear:both;align:middle;margin-top:10px'&amp;gt;"   
        println "Statistics data for "+key
        println "&amp;lt;table id='livetableList_"+key+"' style='width:100%;align:center'&amp;gt;&amp;lt;/table&amp;gt;"
        println "&amp;lt;div id='livetablePager_"+key+"' style='position:relative;width:100%'&amp;gt;&amp;lt;/div&amp;gt;"
        println "&amp;lt;/div&amp;gt;"
        println "&amp;lt;/center&amp;gt;"
        println "&amp;lt;script language='javascript'&amp;gt;console.log('Create live table for "+key+"');&amp;lt;/script&amp;gt;"
    }
    //println '&amp;lt;/body&amp;gt;'
    println '{{/html}}'
} else if(result[0].type == "Store") {
	// data store
	def dataLine = DataToDrawChart.getDataToDrawLine(result)
	def dataBar = DataToDrawChart.getDataToDrawBar(result)
	def dataPie = DataToDrawChart.getDataToDrawPie(result)
	def dataArea = DataToDrawChart.getDataToDrawArea(result)
	def chartColumnsLine = []
	def chartColumnsBar = []
	def chartColumnsArea = []
	def lstName

        dataLine.each {itemDataLine -&amp;gt;
            if(itemDataLine.size() &amp;gt; 0 ){
		chartColumnsLine.add(itemDataLine[0].chart_columns)
	    }
        }

        dataBar.each {itemDataBar -&amp;gt;
            if(itemDataBar.size() &amp;gt; 0 ){
		chartColumnsBar.add(itemDataBar[0].chart_columns)
	    }
        }

        dataArea.each {itemDataArea -&amp;gt;
            if(itemDataArea.size() &amp;gt; 0 ){
		chartColumnsArea.add(itemDataArea[0].chart_columns)
	    }
        }

	if(dataPie.size() &amp;gt; 0 ){
		lstName = dataPie['name']
	}

    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
  
    def tmpListNameContainer = []
    def chartNumPie = 0
    for(def nameContainer in lstName){
       for(def nameContainerItem in nameContainer ){
           nameContainerItem = chartNumPie + "_" + nameContainerItem.replaceAll("\\.", "_")
           tmpListNameContainer .add(nameContainerItem )
       }
    }
    
    def jsonPie = com.mongodb.util.JSON.serialize(dataPie)
    def jsonLine = com.mongodb.util.JSON.serialize(dataLine)
    def jsonBar = com.mongodb.util.JSON.serialize(dataBar)
    def jsonArea = com.mongodb.util.JSON.serialize(dataArea)

    def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
    def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
    def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
    def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

    def listEmpty = com.mongodb.util.JSON.serialize([])
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$listEmpty&amp;lt;/textarea&amp;gt;" 

    println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
    println "&amp;lt;textarea class='jsonline' &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonbar' &amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonpie' &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonarea' &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"

    println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;/div&amp;gt;"

    def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
    def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
  
    println "&amp;lt;div style='clear:both'&amp;gt;"
  
    def chartPieComment = false
    chartNumPie = 0
    lstName.each{chartPieLst-&amp;gt;
        if(!chartPieComment) {
            println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
            chartPieComment = true
        }
        chartPieLst.each {
            def tmp = chartNumPie + "_pie"
            println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
            chartNumPie++
        }
    }
    println "&amp;lt;/div&amp;gt;"
    	def chartLineComment = false
	def chartNum = 0
    	chartColumnsLine.each{chartColumnsLineItem -&amp;gt;
	    	if(!chartLineComment){
	        	println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	        	chartLineComment = true  
	    	}
		chartColumnsLineItem.each{
	    		println " &amp;lt;div class=\"displayblock\" id=\"containerline${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	    	}
		chartNum++
	}	
    	println "&amp;lt;/div&amp;gt;"
    	println "&amp;amp;nbsp;"
    	def chartBarComment = false
	chartNum = 0
    	chartColumnsBar.each{chartColumnsBarItem -&amp;gt;
	        if(!chartBarComment){
	            println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	            chartBarComment = true
	        }  
		chartColumnsBarItem.each{
	    		println " &amp;lt;div class=\"displayblock\" id=\"containerbar${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  	}
		chartNum++
	}
  println "&amp;lt;/div&amp;gt;"
  println "&amp;amp;nbsp;"
  	def chartAreaComment = false
	chartNum = 0
  	chartColumnsArea.each{chartColumnsAreaItem -&amp;gt;
	  	if(!chartAreaComment){
	    		println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	    		chartAreaComment = true
	  	}
		chartColumnsAreaItem.each{
    			println " &amp;lt;div class=\"displayblock\" id=\"containerarea${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
		}
		chartNum++
  	}
  println "&amp;lt;/div&amp;gt;"
println "&amp;lt;/div&amp;gt;"

//println '&amp;lt;/body&amp;gt;'
println '{{/html}}'
}
}else{
    println 'There is no data for this job with criterias'
}
//--=============== Start build for livetable
def subTypeURLMap = [:]
def dataModel = []
def dataUrl = ""
result.find{rec-&amp;gt;				
    def subtractData = []
    
    //-- Parsing data and assign data to subtract list
    if(rec.type == "Store"){ //-- Store data type
        subtractData = rec['data']        
        subtractData.each{r2-&amp;gt;					
            if(dataModel != null &amp;amp;&amp;amp; dataModel.size() &amp;lt;=0){ 
                dataModel.add("Fetch At")
                dataModel.addAll(r2.keySet());					
            } 
        }        
        dataUrl = "/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job="+job +"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate + "&amp;amp;toDate=" + toDate + "&amp;amp;istIid="+istIid        
        //-- Building data model				
        def model = []
        def colSpec
        dataModel.each{name-&amp;gt;
            colSpec = [:]
            colSpec['name'] = name
            colSpec['index'] = name
            colSpec['width'] = "100"
            model.add(colSpec)
        }
        def dataModelStr = (new JsonBuilder(dataModel)).toPrettyString()
        def modelStr = (new JsonBuilder(model)).toPrettyString() 
        str = 
        "{\"url\":\""+dataUrl+"\",\"datatype\":\"json\","+
            "\"colNames\":"+ dataModelStr +
            ",\"colModel\":"+ modelStr +" ,\"rowList\":[10,20,30],"+
            "\"pager\":\"#livetablePager\", \"viewrecords\": true, \"sortname\": \"RECORD_SEQ\","+
            "\"sortorder\": \"asc\", \"caption\":\""+job+"\"}"
        println "{{html clean=\"false\" wiki=\"true\"}}"
        println "&amp;lt;div id='livetableJson' style = \"display:none\"&amp;gt;"
        //println "&amp;lt;div id='livetableJson'&amp;gt;"
        println str;
        println "&amp;lt;/div&amp;gt;"
        println "{{/html}}"
    }else{ //-- Subtype			
        def subData = rec['data']
        subData.each{key,value-&amp;gt;
            dataUrl = "/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job="+job +"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate + "&amp;amp;toDate=" + toDate + "&amp;amp;istIid="+istIid+"&amp;amp;subType="+key
            subtractData = value
            subtractData.each{r2-&amp;gt;					
                if(dataModel != null &amp;amp;&amp;amp; dataModel.size() &amp;lt;=0){ 
                    dataModel.add("Fetch At")
                    dataModel.addAll(r2.keySet());					
                } 			
            }
            //-- Building data model				
            def model = []
            def colSpec
            dataModel.each{name-&amp;gt;
                colSpec = [:]
                colSpec['name'] = name
                colSpec['index'] = name
                colSpec['width'] = "100"
                model.add(colSpec)
            }
            def dataModelStr = (new JsonBuilder(dataModel)).toPrettyString()
            def modelStr = (new JsonBuilder(model)).toPrettyString() 
            str = 
            "{\"url\":\""+dataUrl+"\",\"datatype\":\"json\","+
                "\"colNames\":"+ dataModelStr +
                ",\"colModel\":"+ modelStr +" ,\"rowList\":[10,20,30],"+
                "\"pager\":\"#livetablePager\", \"viewrecords\": true, \"sortname\": \"RECORD_SEQ\","+
                "\"sortorder\": \"asc\", \"caption\":\""+job+"\"}"
            subTypeURLMap[key] = str
        }
        def finalStr = (new JsonBuilder(subTypeURLMap)).toPrettyString()
        println "{{html clean=\"false\" wiki=\"true\"}}"
        println "&amp;lt;div id='livetableJson' style = \"display:none\"&amp;gt;"
        //println "&amp;lt;div id='livetableJson'&amp;gt;"
        println finalStr;
        println "&amp;lt;/div&amp;gt;"
        println "{{/html}}"
    }
    return true
}
 //--=============== END

if(listKey.size() &amp;lt;= 0){   
    println "{{html clean=\"false\" wiki=\"true\"}}"
    println "&amp;lt;center&amp;gt;"
    println "&amp;lt;div id=\"livetblContent\" style=\"width:100%;clear:both;align:middle;margin-top:10px\"&amp;gt;"   
    println "Statistics Data"
    println "&amp;lt;table id=\"livetableList\" style=\"width:100%;align:center\"&amp;gt;&amp;lt;/table&amp;gt;"    
    println "&amp;lt;div id=\"livetablePager\"&amp;gt;&amp;lt;/div&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
    println "&amp;lt;/center&amp;gt;"
    
    println "&amp;lt;div id=\"testDiv\"&amp;gt;&amp;amp;nbsp;&amp;lt;/div&amp;gt;"
    println "{{/html}}"
}
{{/groovy}}&lt;/content&gt;&lt;/xwikidoc&gt;
@


61.61
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376623880000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376623880000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.61&lt;/version&gt;
d3316 2
a3317 1
    println item.fetchAt
@


61.60
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376623833000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376623833000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.60&lt;/version&gt;
d3316 1
a3316 1
    println item.fetchedAt
@


61.59
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376623721000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376623721000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.59&lt;/version&gt;
d3313 7
a3319 1
println "result" + result
@


61.58
log
@@
text
@&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xwikidoc&gt;
&lt;web&gt;WiperDog&lt;/web&gt;
&lt;name&gt;WebHome&lt;/name&gt;
&lt;language&gt;&lt;/language&gt;
&lt;defaultLanguage&gt;en&lt;/defaultLanguage&gt;
&lt;translation&gt;0&lt;/translation&gt;
&lt;parent&gt;&lt;/parent&gt;
&lt;creator&gt;XWiki.Admin&lt;/creator&gt;
&lt;author&gt;XWiki.Admin&lt;/author&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;contentAuthor&gt;XWiki.Admin&lt;/contentAuthor&gt;
&lt;creationDate&gt;1376364375000&lt;/creationDate&gt;
&lt;date&gt;1376620076000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376568337000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.58&lt;/version&gt;
&lt;title&gt;WiperDog&lt;/title&gt;
&lt;defaultTemplate&gt;&lt;/defaultTemplate&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;comment&gt;&lt;/comment&gt;
&lt;minorEdit&gt;true&lt;/minorEdit&gt;
&lt;syntaxId&gt;xwiki/2.1&lt;/syntaxId&gt;
&lt;hidden&gt;false&lt;/hidden&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;047293a8-524d-45e4-af52-cd944523d5d0&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
/*
 * jQuery timepicker addon
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 1.3.1
 * Last Modified: 07/07/2013
 *
 * Copyright 2013 Trent Richardson
 * You may use this project under MIT or GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 */

/*jslint evil: true, white: false, undef: false, nomen: false */

(function($) {

	/*
	* Lets not redefine timepicker, Prevent "Uncaught RangeError: Maximum call stack size exceeded"
	*/
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return;
	}

	/*
	* Extend jQueryUI, get it started with our version number
	*/
	$.extend($.ui, {
		timepicker: {
			version: "1.3.1"
		}
	});

	/* 
	* Timepicker manager.
	* Use the singleton instance of this class, $.timepicker, to interact with the time picker.
	* Settings for (groups of) time pickers are maintained in an instance object,
	* allowing multiple different settings on the same page.
	*/
	var Timepicker = function() {
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[''] = { // Default regional settings
			currentText: 'Now',
			closeText: 'Done',
			amNames: ['AM', 'A'],
			pmNames: ['PM', 'P'],
			timeFormat: 'HH:mm',
			timeSuffix: '',
			timeOnlyTitle: 'Choose Time',
			timeText: 'Time',
			hourText: 'Hour',
			minuteText: 'Minute',
			secondText: 'Second',
			millisecText: 'Millisecond',
			microsecText: 'Microsecond',
			timezoneText: 'Time Zone',
			isRTL: false
		};
		this._defaults = { // Global defaults for all the datetime picker instances
			showButtonPanel: true,
			timeOnly: false,
			showHour: null,
			showMinute: null,
			showSecond: null,
			showMillisec: null,
			showMicrosec: null,
			showTimezone: null,
			showTime: true,
			stepHour: 1,
			stepMinute: 1,
			stepSecond: 1,
			stepMillisec: 1,
			stepMicrosec: 1,
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null,
			hourMin: 0,
			minuteMin: 0,
			secondMin: 0,
			millisecMin: 0,
			microsecMin: 0,
			hourMax: 23,
			minuteMax: 59,
			secondMax: 59,
			millisecMax: 999,
			microsecMax: 999,
			minDateTime: null,
			maxDateTime: null,
			onSelect: null,
			hourGrid: 0,
			minuteGrid: 0,
			secondGrid: 0,
			millisecGrid: 0,
			microsecGrid: 0,
			alwaysSetTime: true,
			separator: ' ',
			altFieldTimeOnly: true,
			altTimeFormat: null,
			altSeparator: null,
			altTimeSuffix: null,
			pickerTimeFormat: null,
			pickerTimeSuffix: null,
			showTimepicker: true,
			timezoneList: null,
			addSliderAccess: false,
			sliderAccessArgs: null,
			controlType: 'slider',
			defaultValue: null,
			parse: 'strict'
		};
		$.extend(this._defaults, this.regional['']);
	};

	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: '',
		formattedDate: '',
		formattedTime: '',
		formattedDateTime: '',
		timezoneList: null,
		units: ['hour','minute','second','millisec', 'microsec'],
		support: {},
		control: null,

		/* 
		* Override the default settings for all instances of the time picker.
		* @@param  settings  object - the new settings to use as defaults (anonymous object)
		* @@return the manager object
		*/
		setDefaults: function(settings) {
			extendRemove(this._defaults, settings || {});
			return this;
		},

		/*
		* Create a new Timepicker instance
		*/
		_newInst: function($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
            	fns = {},
		    	overrides, i;

			for (var attrName in this._defaults) {
				if(this._defaults.hasOwnProperty(attrName)){
					var attrValue = $input.attr('time:' + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue);
						} catch (err) {
							inlineSettings[attrName] = attrValue;
						}
					}
				}
			}

		    overrides = {
		        beforeShow: function (input, dp_inst) {
		            if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
		                return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst);
		            }
		        },
		        onChangeMonthYear: function (year, month, dp_inst) {
		            // Update the time as well : this prevents the time from disappearing from the $input field.
		            tp_inst._updateDateTime(dp_inst);
		            if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
		                tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst);
		            }
		        },
		        onClose: function (dateText, dp_inst) {
		            if (tp_inst.timeDefined === true &amp;amp;&amp;amp; $input.val() !== '') {
		                tp_inst._updateDateTime(dp_inst);
		            }
		            if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
		                tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst);
		            }
		        }
		    };
		    for (i in overrides) {
		        if (overrides.hasOwnProperty(i)) {
		            fns[i] = opts[i] || null;
		        }
		    }

		    tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
		        evnts:fns,
		        timepicker: tp_inst // add timepicker as a property of datepicker: $.datepicker._get(dp_inst, 'timepicker');
		    });
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function(val) {
				return val.toUpperCase();
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function(val) {
				return val.toUpperCase();
			});

			// detect which units are supported
			tp_inst.support = detectSupport(
					tp_inst._defaults.timeFormat + 
					(tp_inst._defaults.pickerTimeFormat? tp_inst._defaults.pickerTimeFormat:'') + 
					(tp_inst._defaults.altTimeFormat? tp_inst._defaults.altTimeFormat:''));

			// controlType is string - key to our this._controls
			if(typeof(tp_inst._defaults.controlType) === 'string'){
				if(tp_inst._defaults.controlType == 'slider' &amp;amp;&amp;amp; typeof(jQuery.ui.slider) === 'undefined'){
					tp_inst._defaults.controlType = 'select';
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType];
			}
			// controlType is an object and must implement create, options, value methods
			else{ 
				tp_inst.control = tp_inst._defaults.controlType;
			}

			// prep the timezone options
			var timezoneList = [-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,
					0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList;
			}
			var tzl=timezoneList.length,tzi=0,tzv=null;
			if (tzl &amp;gt; 0 &amp;amp;&amp;amp; typeof timezoneList[0] !== 'object') {
				for(; tzi&amp;lt;tzl; tzi++){
					tzv = timezoneList[tzi];
					timezoneList[tzi] = { value: tzv, label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601) };
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;

			// set the default units
			tp_inst.timezone = tp_inst._defaults.timezone !== null? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) : 
							((new Date()).getTimezoneOffset()*-1);
			tp_inst.hour = tp_inst._defaults.hour &amp;lt; tp_inst._defaults.hourMin? tp_inst._defaults.hourMin : 
							tp_inst._defaults.hour &amp;gt; tp_inst._defaults.hourMax? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute &amp;lt; tp_inst._defaults.minuteMin? tp_inst._defaults.minuteMin : 
							tp_inst._defaults.minute &amp;gt; tp_inst._defaults.minuteMax? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second &amp;lt; tp_inst._defaults.secondMin? tp_inst._defaults.secondMin : 
							tp_inst._defaults.second &amp;gt; tp_inst._defaults.secondMax? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec &amp;lt; tp_inst._defaults.millisecMin? tp_inst._defaults.millisecMin : 
							tp_inst._defaults.millisec &amp;gt; tp_inst._defaults.millisecMax? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec &amp;lt; tp_inst._defaults.microsecMin? tp_inst._defaults.microsecMin : 
							tp_inst._defaults.microsec &amp;gt; tp_inst._defaults.microsecMax? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = '';
			tp_inst.$input = $input;

			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField).css({
					cursor: 'pointer'
				}).focus(function() {
					$input.trigger("focus");
				});
			}

			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date();
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date();
			}

			// datepicker needs minDate/maxDate, timepicker needs minDateTime/maxDateTime..
			if (tp_inst._defaults.minDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime());
			}
			if (tp_inst._defaults.minDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime());
			}
			if (tp_inst._defaults.maxDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime());
			}
			if (tp_inst._defaults.maxDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime());
			}
			tp_inst.$input.bind('focus', function() {
				tp_inst._onFocus();
			});

			return tp_inst;
		},

		/*
		* add our sliders to the calendar
		*/
		_addTimePicker: function(dp_inst) {
			var currDT = (this.$altInput &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly) ? this.$input.val() + ' ' + this.$altInput.val() : this.$input.val();

			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
		},

		/*
		* parse the time string from input value or _setTime
		*/
		_parseTime: function(timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0]);
			}

			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, 'dateFormat');
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false;
					}
					$.extend(this, parseRes.timeObj);
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err +
									"\ndate/time string = " + timeString +
									"\ntimeFormat = " + this._defaults.timeFormat +
									"\ndateFormat = " + dp_dateFormat);
					return false;
				}
				return true;
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false;
				}
				$.extend(this, timeObj);
				return true;
			}
		},

		/*
		* generate and inject html for timepicker into ui datepicker
		*/
		_injectTimePicker: function() {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = '',
				uitem = '',
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i=0,
				l=0;

			// Prevent displaying twice
			if ($dp.find("div.ui-timepicker-div").length === 0 &amp;amp;&amp;amp; o.showTimepicker) {
				var noDisplay = ' style="display:none;"',
					html = '&amp;lt;div class="ui-timepicker-div'+ (o.isRTL? ' ui-timepicker-rtl' : '') +'"&amp;gt;&amp;lt;dl&amp;gt;' + '&amp;lt;dt class="ui_tpicker_time_label"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;' + o.timeText + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_time"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the markup
				for(i=0,l=this.units.length; i&amp;lt;l; i++){
					litem = this.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// Added by Peter Medeiros:
					// - Figure out what the hour/minute/second max should be based on the step values.
					// - Example: if stepMinute is 15, then minMax is 45.
					max[litem] = parseInt((o[litem+'Max'] - ((o[litem+'Max'] - o[litem+'Min']) % o['step'+uitem])), 10);
					gridSize[litem] = 0;

					html += '&amp;lt;dt class="ui_tpicker_'+ litem +'_label"' + (show ? '' : noDisplay) + '&amp;gt;' + o[litem +'Text'] + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_'+ litem +'"&amp;gt;&amp;lt;div class="ui_tpicker_'+ litem +'_slider"' + (show ? '' : noDisplay) + '&amp;gt;&amp;lt;/div&amp;gt;';

					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						html += '&amp;lt;div style="padding-left: 1px"&amp;gt;&amp;lt;table class="ui-tpicker-grid-label"&amp;gt;&amp;lt;tr&amp;gt;';

						if(litem == 'hour'){
							for (var h = o[litem+'Min']; h &amp;lt;= max[litem]; h += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm? 'hht':'HH', {hour:h}, o);									
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + tmph + '&amp;lt;/td&amp;gt;';
							}
						}
						else{
							for (var m = o[litem+'Min']; m &amp;lt;= max[litem]; m += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + ((m &amp;lt; 10) ? '0' : '') + m + '&amp;lt;/td&amp;gt;';
							}
						}

						html += '&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;&amp;lt;/div&amp;gt;';
					}
					html += '&amp;lt;/dd&amp;gt;';
				}
				
				// Timezone
				var showTz = o.showTimezone !== null? o.showTimezone : this.support.timezone;
				html += '&amp;lt;dt class="ui_tpicker_timezone_label"' + (showTz ? '' : noDisplay) + '&amp;gt;' + o.timezoneText + '&amp;lt;/dt&amp;gt;';
				html += '&amp;lt;dd class="ui_tpicker_timezone" ' + (showTz ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the elements from string
				html += '&amp;lt;/dl&amp;gt;&amp;lt;/div&amp;gt;';
				var $tp = $(html);

				// if we only want time picker...
				if (o.timeOnly === true) {
					$tp.prepend('&amp;lt;div class="ui-widget-header ui-helper-clearfix ui-corner-all"&amp;gt;' + '&amp;lt;div class="ui-datepicker-title"&amp;gt;' + o.timeOnlyTitle + '&amp;lt;/div&amp;gt;' + '&amp;lt;/div&amp;gt;');
					$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();
				}
				
				// add sliders, adjust grids, add events
				for(i=0,l=tp_inst.units.length; i&amp;lt;l; i++){
					litem = tp_inst.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// add the slider
					tp_inst[litem+'_slider'] = tp_inst.control.create(tp_inst, $tp.find('.ui_tpicker_'+litem+'_slider'), litem, tp_inst[litem], o[litem+'Min'], max[litem], o['step'+uitem]);

					// adjust the grid and add click event
					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						size = 100 * gridSize[litem] * o[litem+'Grid'] / (max[litem] - o[litem+'Min']);
						$tp.find('.ui_tpicker_'+litem+' table').css({
							width: size + "%",
							marginLeft: o.isRTL? '0' : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL? ((size / (-2 * gridSize[litem])) + "%") : '0',
							borderCollapse: 'collapse'
						}).find("td").click(function(e){
								var $t = $(this),
									h = $t.html(),
									n = parseInt(h.replace(/[^0-9]/g),10),
									ap = h.replace(/[^apm]/ig),
									f = $t.data('for'); // loses scope, so we use data-for

								if(f == 'hour'){
									if(ap.indexOf('p') !== -1 &amp;amp;&amp;amp; n &amp;lt; 12){
										n += 12;
									}
									else{
										if(ap.indexOf('a') !== -1 &amp;amp;&amp;amp; n === 12){
											n = 0;
										}
									}
								}
								
								tp_inst.control.value(tp_inst, tp_inst[f+'_slider'], litem, n);

								tp_inst._onTimeChange();
								tp_inst._onSelectHandler();
							}).css({
								cursor: 'pointer',
								width: (100 / gridSize[litem]) + '%',
								textAlign: 'center',
								overflow: 'hidden'
							});
					} // end if grid &amp;gt; 0
				} // end for loop

				// Add timezone options
				this.timezone_select = $tp.find('.ui_tpicker_timezone').append('&amp;lt;select&amp;gt;&amp;lt;/select&amp;gt;').find("select");
				$.fn.append.apply(this.timezone_select,
				$.map(o.timezoneList, function(val, idx) {
					return $("&amp;lt;option /&amp;gt;").val(typeof val == "object" ? val.value : val).text(typeof val == "object" ? val.label : val);
				}));
				if (typeof(this.timezone) != "undefined" &amp;amp;&amp;amp; this.timezone !== null &amp;amp;&amp;amp; this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset()*-1;
					if (local_timezone == this.timezone) {
						selectLocalTimezone(tp_inst);
					} else {
						this.timezone_select.val(this.timezone);
					}
				} else {
					if (typeof(this.hour) != "undefined" &amp;amp;&amp;amp; this.hour !== null &amp;amp;&amp;amp; this.hour !== "") {
						this.timezone_select.val(o.timezone);
					} else {
						selectLocalTimezone(tp_inst);
					}
				}
				this.timezone_select.change(function() {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
				});
				// End timezone options
				
				// inject timepicker into datepicker
				var $buttonPanel = $dp.find('.ui-datepicker-buttonpane');
				if ($buttonPanel.length) {
					$buttonPanel.before($tp);
				} else {
					$dp.append($tp);
				}

				this.$timeObj = $tp.find('.ui_tpicker_time');

				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined;
				}

				// slideAccess integration: http://trentrichardson.com/2011/11/11/jquery-ui-sliders-and-touch-accessibility/
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
						
					setTimeout(function() { // fix for inline mode
						if ($tp.find('.ui-slider-access').length === 0) {
							$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);

							// fix any grids since sliders are shorter
							var sliderAccessWidth = $tp.find('.ui-slider-access:eq(0)').outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find('table:visible').each(function() {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl? 'marginRight':'marginLeft').toString().replace('%', ''),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + '%',
										css = { width: newWidth, marginRight: 0, marginLeft: 0 };
									css[rtl? 'marginRight':'marginLeft'] = newMarginLeft;
									$g.css(css);
								});
							}
						}
					}, 10);
				}
				// end slideAccess integration

				tp_inst._limitMinMaxDateTime(this.inst, true);
			}
		},

		/*
		* This function tries to limit the ability to go outside the
		* min/max date range
		*/
		_limitMinMaxDateTime: function(dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);

			if (!this._defaults.showTimepicker) {
				return;
			} // No time so nothing to check here

			if ($.datepicker._get(dp_inst, 'minDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'minDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, 'minDateTime'),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin;
				}

				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour &amp;lt;= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute &amp;lt;= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second &amp;lt;= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if(this.millisec &amp;lt;= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;lt; this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin;
									}
									this._defaults.microsecMin = this.microsecMinOriginal;
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal;
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal;
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal;
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal;
				}
			}

			if ($.datepicker._get(dp_inst, 'maxDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'maxDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, 'maxDateTime'),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax;
				}

				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour &amp;gt;= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute &amp;gt;= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second &amp;gt;= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec &amp;gt;= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;gt; this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax;
									}
									this._defaults.microsecMax = this.microsecMaxOriginal;
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal;
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal;
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal;
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal;
				}
			}

			if (adjustSliders !== undefined &amp;amp;&amp;amp; adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10);
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);

				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, 'hour', { min: this._defaults.hourMin, max: hourMax });
					this.control.value(this, this.hour_slider, 'hour', this.hour - (this.hour % this._defaults.stepHour));
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, 'minute', { min: this._defaults.minuteMin, max: minMax });
					this.control.value(this, this.minute_slider, 'minute', this.minute - (this.minute % this._defaults.stepMinute));
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, 'second', { min: this._defaults.secondMin, max: secMax });
					this.control.value(this, this.second_slider, 'second', this.second - (this.second % this._defaults.stepSecond));
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, 'millisec', { min: this._defaults.millisecMin, max: millisecMax });
					this.control.value(this, this.millisec_slider, 'millisec', this.millisec - (this.millisec % this._defaults.stepMillisec));
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, 'microsec', { min: this._defaults.microsecMin, max: microsecMax });
					this.control.value(this, this.microsec_slider, 'microsec', this.microsec - (this.microsec % this._defaults.stepMicrosec));
				}
			}

		},

		/*
		* when a slider moves, set the internal time...
		* on time change is also called when the time is updated in the text field
		*/
		_onTimeChange: function() {
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, 'hour') : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, 'minute') : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, 'second') : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, 'millisec') : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, 'microsec') : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;

			if (typeof(hour) == 'object') {
				hour = false;
			}
			if (typeof(minute) == 'object') {
				minute = false;
			}
			if (typeof(second) == 'object') {
				second = false;
			}
			if (typeof(millisec) == 'object') {
				millisec = false;
			}
			if (typeof(microsec) == 'object') {
				microsec = false;
			}
			if (typeof(timezone) == 'object') {
				timezone = false;
			}

			if (hour !== false) {
				hour = parseInt(hour, 10);
			}
			if (minute !== false) {
				minute = parseInt(minute, 10);
			}
			if (second !== false) {
				second = parseInt(second, 10);
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10);
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10);
			}

			var ampm = o[hour &amp;lt; 12 ? 'amNames' : 'pmNames'][0];

			// If the update was done in the input field, the input field should not be updated.
			// If the update was done using the sliders, update the input field.
			var hasChanged = (hour != this.hour || minute != this.minute || second != this.second || millisec != this.millisec || microsec != this.microsec 
								|| (this.ampm.length &amp;gt; 0 &amp;amp;&amp;amp; (hour &amp;lt; 12) != ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) 
								|| (this.timezone !== null &amp;amp;&amp;amp; timezone != this.timezone));

			if (hasChanged) {

				if (hour !== false) {
					this.hour = hour;
				}
				if (minute !== false) {
					this.minute = minute;
				}
				if (second !== false) {
					this.second = second;
				}
				if (millisec !== false) {
					this.millisec = millisec;
				}
				if (microsec !== false) {
					this.microsec = microsec;
				}
				if (timezone !== false) {
					this.timezone = timezone;
				}

				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0]);
				}

				this._limitMinMaxDateTime(this.inst, true);
			}
			if (this.support.ampm) {
				this.ampm = ampm;
			}

			// Updates the time within the timepicker
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if(pickerTimeFormat === o.timeFormat){
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix);
				}
				else{
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix);
				}
			}

			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime();
			}
		},

		/*
		* call custom onSelect.
		* bind to sliders slidestop, and grid click.
		*/
		_onSelectHandler: function() {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect &amp;amp;&amp;amp; inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this]);
			}
		},

		/*
		* update our input with the new date time..
		*/
		_updateDateTime: function(dp_inst) {
			dp_inst = this.inst || dp_inst;
			//var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
			var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay)),
				dateFmt = $.datepicker._get(dp_inst, 'dateFormat'),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null &amp;amp;&amp;amp; this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			
			// if a slider was changed but datepicker doesn't have a value yet, set it
			if(dp_inst.lastVal===""){
                dp_inst.currentYear=dp_inst.selectedYear;
                dp_inst.currentMonth=dp_inst.selectedMonth;
                dp_inst.currentDay=dp_inst.selectedDay;
            }

			/*
			* remove following lines to force every changes in date picker to change the input value
			* Bug descriptions: when an input field has a default value, and click on the field to pop up the date picker. 
			* If the user manually empty the value in the input field, the date picker will never change selected value.
			*/
			//if (dp_inst.lastVal !== undefined &amp;amp;&amp;amp; (dp_inst.lastVal.length &amp;gt; 0 &amp;amp;&amp;amp; this.$input.val().length === 0)) {
			//	return;
			//}

			if (this._defaults.timeOnly === true) {
				formattedDateTime = this.formattedTime;
			} else if (this._defaults.timeOnly !== true &amp;amp;&amp;amp; (this._defaults.alwaysSetTime || timeAvailable)) {
				formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix;
			}

			this.formattedDateTime = formattedDateTime;

			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate);
			} else if (this.$altInput &amp;amp;&amp;amp; this._defaults.timeOnly === false &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly === true) {
				this.$altInput.val(this.formattedTime);
				this.$input.val(this.formattedDate);
			} else if (this.$altInput) {
				this.$input.val(formattedDateTime);
				var altFormattedDateTime = '',
					altSeparator = this._defaults.altSeparator ? this._defaults.altSeparator : this._defaults.separator,
					altTimeSuffix = this._defaults.altTimeSuffix ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
				
				if(!this._defaults.timeOnly){
					if (this._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg);
					}
					else{
						altFormattedDateTime = this.formattedDate;
					}

					if (altFormattedDateTime){
						altFormattedDateTime += altSeparator;
					}
				}

				if(this._defaults.altTimeFormat){
					altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix;
				}
				else{
					altFormattedDateTime += this.formattedTime + altTimeSuffix;
				}
				this.$altInput.val(altFormattedDateTime);
			} else {
				this.$input.val(formattedDateTime);
			}

			this.$input.trigger("change");
		},

		_onFocus: function() {
			if (!this.$input.val() &amp;amp;&amp;amp; this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, 'timepicker');
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst);
						} catch (err) {
							$.timepicker.log(err);
						}
					}
				}
			}
		},

		/*
		* Small abstraction to control types
		* We can add more, just be sure to follow the pattern: create, options, value
		*/
		_controls: {
			// slider methods
			slider: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var rtl = tp_inst._defaults.isRTL; // if rtl go -60-&amp;gt;0 instead of 0-&amp;gt;60
					return obj.prop('slide', null).slider({
						orientation: "horizontal",
						value: rtl? val*-1 : val,
						min: rtl? max*-1 : min,
						max: rtl? min*-1 : max,
						step: step,
						slide: function(event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl? ui.value*-1:ui.value);
							tp_inst._onTimeChange();
						},
						stop: function(event, ui) {
							tp_inst._onSelectHandler();
						}
					});	
				},
				options: function(tp_inst, obj, unit, opts, val){
					if(tp_inst._defaults.isRTL){
						if(typeof(opts) == 'string'){
							if(opts == 'min' || opts == 'max'){
								if(val !== undefined){
									return obj.slider(opts, val*-1);
								}
								return Math.abs(obj.slider(opts));
							}
							return obj.slider(opts);
						}
						var min = opts.min, 
							max = opts.max;
						opts.min = opts.max = null;
						if(min !== undefined){
							opts.max = min * -1;
						}
						if(max !== undefined){
							opts.min = max * -1;
						}
						return obj.slider(opts);
					}
					if(typeof(opts) == 'string' &amp;amp;&amp;amp; val !== undefined){
							return obj.slider(opts, val);
					}
					return obj.slider(opts);
				},
				value: function(tp_inst, obj, unit, val){
					if(tp_inst._defaults.isRTL){
						if(val !== undefined){
							return obj.slider('value', val*-1);
						}
						return Math.abs(obj.slider('value'));
					}
					if(val !== undefined){
						return obj.slider('value', val);
					}
					return obj.slider('value');
				}
			},
			// select methods
			select: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var sel = '&amp;lt;select class="ui-timepicker-select" data-unit="'+ unit +'" data-min="'+ min +'" data-max="'+ max +'" data-step="'+ step +'"&amp;gt;',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;

					for(var i=min; i&amp;lt;=max; i+=step){						
						sel += '&amp;lt;option value="'+ i +'"'+ (i==val? ' selected':'') +'&amp;gt;';
						if(unit == 'hour'){
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig,'')), {hour:i}, tp_inst._defaults);
						}
						else if(unit == 'millisec' || unit == 'microsec' || i &amp;gt;= 10){ sel += i; }
						else {sel += '0'+ i.toString(); }
						sel += '&amp;lt;/option&amp;gt;';
					}
					sel += '&amp;lt;/select&amp;gt;';

					obj.children('select').remove();

					$(sel).appendTo(obj).change(function(e){
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
					});

					return obj;
				},
				options: function(tp_inst, obj, unit, opts, val){
					var o = {},
						$t = obj.children('select');
					if(typeof(opts) == 'string'){
						if(val === undefined){
							return $t.data(opts);
						}
						o[opts] = val;	
					}
					else{ o = opts; }
					return tp_inst.control.create(tp_inst, obj, $t.data('unit'), $t.val(), o.min || $t.data('min'), o.max || $t.data('max'), o.step || $t.data('step'));
				},
				value: function(tp_inst, obj, unit, val){
					var $t = obj.children('select');
					if(val !== undefined){
						return $t.val(val);
					}
					return $t.val();
				}
			}
		} // end _controls

	});

	$.fn.extend({
		/*
		* shorthand just to use timepicker..
		*/
		timepicker: function(o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);

			if (typeof o == 'object') {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				});
			}

			return $(this).each(function() {
				$.fn.datetimepicker.apply($(this), tmp_args);
			});
		},

		/*
		* extend timepicker to datepicker
		*/
		datetimepicker: function(o) {
			o = o || {};
			var tmp_args = arguments;

			if (typeof(o) == 'string') {
				if (o == 'getDate') {
					return $.fn.datepicker.apply($(this[0]), tmp_args);
				} else {
					return this.each(function() {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args);
					});
				}
			} else {
				return this.each(function() {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults);
				});
			}
		}
	});

	/*
	* Public Utility to parse date and time
	*/
	$.datepicker.parseDateTime = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec);
		}

		return parseRes.date;
	};

	/*
	* Public utility to parse time
	*/
	$.datepicker.parseTime = function(timeFormat, timeString, options) {		
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g,'').indexOf('Z') !== -1);

		// Strict parse requires the timeString to match the timeFormat exactly
		var strictParse = function(f, s, o){

			// pattern for standard and localized AM/PM markers
			var getPatternAmpm = function(amNames, pmNames) {
				var markers = [];
				if (amNames) {
					$.merge(markers, amNames);
				}
				if (pmNames) {
					$.merge(markers, pmNames);
				}
				markers = $.map(markers, function(val) {
					return val.replace(/[.*+?|()\[\]{}\\]/g, '\\$&amp;amp;');
				});
				return '(' + markers.join('|') + ')?';
			};

			// figure out position of time elements.. cause js cant do named captures
			var getFormatPositions = function(timeFormat) {
				var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
					orders = {
						h: -1,
						m: -1,
						s: -1,
						l: -1,
						c: -1,
						t: -1,
						z: -1
					};

				if (finds) {
					for (var i = 0; i &amp;lt; finds.length; i++) {
						if (orders[finds[i].toString().charAt(0)] == -1) {
							orders[finds[i].toString().charAt(0)] = i + 1;
						}
					}
				}
				return orders;
			};

			var regstr = '^' + f.toString()
					.replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
							var ml = match.length;
							switch (match.charAt(0).toLowerCase()) {
								case 'h': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'm': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 's': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'l': return '(\\d?\\d?\\d)';
								case 'c': return '(\\d?\\d?\\d)';
								case 'z': return '(z|[-+]\\d\\d:?\\d\\d|\\S+)?';
								case 't': return getPatternAmpm(o.amNames, o.pmNames);
								default:    // literal escaped in quotes
									return '(' + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function (m) { return "\\" + m; }) + ')?';
							}
						})
					.replace(/\s/g, '\\s?') +
					o.timeSuffix + '$',
				order = getFormatPositions(f),
				ampm = '',
				treg;

			treg = s.match(new RegExp(regstr, 'i'));

			var resTime = {
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0
			};

			if (treg) {
				if (order.t !== -1) {
					if (treg[order.t] === undefined || treg[order.t].length === 0) {
						ampm = '';
						resTime.ampm = '';
					} else {
						ampm = $.inArray(treg[order.t].toUpperCase(), o.amNames) !== -1 ? 'AM' : 'PM';
						resTime.ampm = o[ampm == 'AM' ? 'amNames' : 'pmNames'][0];
					}
				}

				if (order.h !== -1) {
					if (ampm == 'AM' &amp;amp;&amp;amp; treg[order.h] == '12') {
						resTime.hour = 0; // 12am = 0 hour
					} else {
						if (ampm == 'PM' &amp;amp;&amp;amp; treg[order.h] != '12') {
							resTime.hour = parseInt(treg[order.h], 10) + 12; // 12pm = 12 hour, any other pm = hour + 12
						} else {
							resTime.hour = Number(treg[order.h]);
						}
					}
				}

				if (order.m !== -1) {
					resTime.minute = Number(treg[order.m]);
				}
				if (order.s !== -1) {
					resTime.second = Number(treg[order.s]);
				}
				if (order.l !== -1) {
					resTime.millisec = Number(treg[order.l]);
				}
				if (order.c !== -1) {
					resTime.microsec = Number(treg[order.c]);
				}
				if (order.z !== -1 &amp;amp;&amp;amp; treg[order.z] !== undefined) {
					resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z]);
				}


				return resTime;
			}
			return false;
		};// end strictParse

		// First try JS Date, if that fails, use strictParse
		var looseParse = function(f,s,o){
			try{
				var d = new Date('2012-01-01 '+ s);
				if(isNaN(d.getTime())){
					d = new Date('2012-01-01T'+ s);
					if(isNaN(d.getTime())){
						d = new Date('01/01/2012 '+ s);
						if(isNaN(d.getTime())){
							throw "Unable to parse time with native Date: "+ s;
						}
					}
				}

				return {
					hour: d.getHours(),
					minute: d.getMinutes(),
					second: d.getSeconds(),
					millisec: d.getMilliseconds(),
					microsec: d.getMicroseconds(),
					timezone: d.getTimezoneOffset()*-1
				};
			}
			catch(err){
				try{
					return strictParse(f,s,o);
				}
				catch(err2){
					$.timepicker.log("Unable to parse \ntimeString: "+ s +"\ntimeFormat: "+ f);
				}				
			}
			return false;
		}; // end looseParse
		
		if(typeof o.parse === "function"){
			return o.parse(timeFormat, timeString, o);
		}
		if(o.parse === 'loose'){
			return looseParse(timeFormat, timeString, o);
		}
		return strictParse(timeFormat, timeString, o);
	};

	/*
	* Public utility to format the time
	* format = string format of the time
	* time = a {}, not a Date() for timezones
	* options = essentially the regional[].. amNames, pmNames, ampm
	*/
	$.datepicker.formatTime = function(format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			timezone: 0
		}, time);

		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);

		if (hour &amp;gt; 11) {
			ampmName = options.pmNames[0];
		}

		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|('.*?'|".*?"))/g, function(match) {
		switch (match) {
			case 'HH':
				return ('0' + hour).slice(-2);
			case 'H':
				return hour;
			case 'hh':
				return ('0' + convert24to12(hour)).slice(-2);
			case 'h':
				return convert24to12(hour);
			case 'mm':
				return ('0' + time.minute).slice(-2);
			case 'm':
				return time.minute;
			case 'ss':
				return ('0' + time.second).slice(-2);
			case 's':
				return time.second;
			case 'l':
				return ('00' + time.millisec).slice(-3);
			case 'c':
				return ('00' + time.microsec).slice(-3);
			case 'z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, false);
			case 'Z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, true);
			case 'T': 
				return ampmName.charAt(0).toUpperCase();
			case 'TT': 
				return ampmName.toUpperCase();
			case 't':
				return ampmName.charAt(0).toLowerCase();
			case 'tt':
				return ampmName.toLowerCase();
			default:
				return match.replace(/\'/g, "") || "'";
			}
		});

		tmptime = $.trim(tmptime);
		return tmptime;
	};

	/*
	* the bad hack :/ override datepicker so it doesnt close on select
	// inspired: http://stackoverflow.com/questions/1252512/jquery-datepicker-prevent-closing-picker-when-clicking-a-date/1762378#1762378
	*/
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function(id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			tp_inst._limitMinMaxDateTime(inst, true);
			inst.inline = inst.stay_open = true;
			//This way the onSelect handler called from calendarpicker get the full dateTime
			this._base_selectDate(id, dateStr);
			inst.inline = inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst);
		} else {
			this._base_selectDate(id, dateStr);
		}
	};

	/*
	* second bad hack :/ override datepicker so it triggers an event when changing the input field
	* and does not redraw the datepicker on every selectDate event
	*/
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function(inst) {

		// don't popup the datepicker if there is another instance already opened
		var input = inst.input[0];
		if ($.datepicker._curInst &amp;amp;&amp;amp; $.datepicker._curInst != inst &amp;amp;&amp;amp; $.datepicker._datepickerShowing &amp;amp;&amp;amp; $.datepicker._lastInput != input) {
			return;
		}

		if (typeof(inst.stay_open) !== 'boolean' || inst.stay_open === false) {

			this._base_updateDatepicker(inst);

			// Reload the time control when changing something in the input text field.
			var tp_inst = this._get(inst, 'timepicker');
			if (tp_inst) {
				tp_inst._addTimePicker(inst);
			}
		}
	};

	/*
	* third bad hack :/ override datepicker so it allows spaces and colon in the input field
	*/
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if ($.datepicker._get(inst, 'constrainInput')) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null? tp_inst._defaults.showTimezone : tp_inst.support.timezone,					
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat')),
					datetimeChars = tp_inst._defaults.timeFormat.toString()
											.replace(/[hms]/g, '')
											.replace(/TT/g, ampm ? 'APM' : '')
											.replace(/Tt/g, ampm ? 'AaPpMm' : '')
											.replace(/tT/g, ampm ? 'AaPpMm' : '')
											.replace(/T/g, ampm ? 'AP' : '')
											.replace(/tt/g, ampm ? 'apm' : '')
											.replace(/t/g, ampm ? 'ap' : '') + 
											" " + tp_inst._defaults.separator + 
											tp_inst._defaults.timeSuffix + 
											(tz ? tp_inst._defaults.timezoneList.join('') : '') + 
											(tp_inst._defaults.amNames.join('')) + (tp_inst._defaults.pmNames.join('')) + 
											dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr &amp;lt; ' ' || !dateChars || datetimeChars.indexOf(chr) &amp;gt; -1);
			}
		}

		return $.datepicker._base_doKeyPress(event);
	};

	/*
	* Fourth bad hack :/ override _updateAlternate function used in inline mode to init altField
	*/
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	/* Update any alternate field to synchronise with the main field. */
	$.datepicker._updateAlternate = function(inst) {
		var tp_inst = this._get(inst, 'timepicker');
		if(tp_inst){
			var altField = tp_inst._defaults.altField;
			if (altField) { // update alternate field too
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = '', 
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator, 
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if(!tp_inst._defaults.timeOnly &amp;amp;&amp;amp; !tp_inst._defaults.altFieldTimeOnly &amp;amp;&amp;amp; date !== null){
					if(tp_inst._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime;
					}
					else{
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime;
					}
				}
				$(altField).val(altFormattedDateTime);
			}
		}
		else{
			$.datepicker._base_updateAlternate(inst);
		}
	};

	/*
	* Override key up event to sync manual input changes.
	*/
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst);
				} catch (err) {
					$.timepicker.log(err);
				}
			}
		}

		return $.datepicker._base_doKeyUp(event);
	};

	/*
	* override "Today" button to also grab the time.
	*/
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function(id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		this._base_gotoToday(id);
		var tp_inst = this._get(inst, 'timepicker');
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		$('.ui-datepicker-today', $dp).click();
	};

	/*
	* Disable &amp;amp; enable the Time in the datetimepicker
	*/
	$.datepicker._disableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst);
		}
	};

	$.datepicker._enableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst); // Could be disabled on page load
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create our own set time function
	*/
	$.datepicker._setTime = function(inst, date) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var defaults = tp_inst._defaults;

			// calling _setTime with no date sets time to defaults
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;

			//check if within min/max times.. 
			tp_inst._limitMinMaxDateTime(inst, true);

			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create new public method to set only time, callable as $().datepicker('setTime', date)
	*/
	$.datepicker._setTimeDatepicker = function(target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date == "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec);
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds());
				}
				if (tp_date.toString() == 'Invalid Date') {
					tp_date = undefined;
				}
				this._setTime(inst, tp_date);
			}
		}

	};

	/*
	* override setDate() to allow setting time too within Date object
	*/
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function(target, date) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		if(typeof(date) === 'string'){
			date = new Date(date);
			if(!date.getTime()){
				$.timepicker.log("Error creating Date object from string.");
			}
		}

		var tp_inst = this._get(inst, 'timepicker');
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds());
		} else {
			tp_date = date;
		}
		
		// This is important if you are using the timezone option, javascript's Date 
		// object will only return the timezone offset for the current locale, so we 
		// adjust it accordingly.  If not using timezone option this won't matter..
		// If a timezone is different in tp, keep the timezone as is
		if(tp_inst){
			// look out for DST if tz wasn't specified
			if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
				tp_inst.timezone = tp_date.getTimezoneOffset()*-1;
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone);
		}

		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true);
	};

	/*
	* override getDate() to allow getting time too within Date object
	*/
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function(target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			// if it hasn't yet been defined, grab from field
			if(inst.lastVal === undefined){
				this._setDateFromField(inst, noDefault);
			}

			var date = this._getDate(inst);
			if (date &amp;amp;&amp;amp; tp_inst._parseTime($(target).val(), tp_inst.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);

				// This is important if you are using the timezone option, javascript's Date 
				// object will only return the timezone offset for the current locale, so we 
				// adjust it accordingly.  If not using timezone option this won't matter..
				if(tp_inst.timezone != null){
					// look out for DST if tz wasn't specified
					if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
						tp_inst.timezone = date.getTimezoneOffset()*-1;
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
				}
			}
			return date;
		}
		return this._base_getDateDatepicker(target, noDefault);
	};

	/*
	* override parseDate() because UI 1.8.14 throws an error about "Extra characters"
	* An option in datapicker to ignore extra format characters would be nicer.
	*/
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function(format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings);
		} catch (err) {
			// Hack!  The error message ends with a colon, a space, and
			// the "extra" characters.  We rely on that instead of
			// attempting to perfectly reproduce the parsing algorithm.
			if (err.indexOf(":") &amp;gt;= 0) {
				date = this._base_parseDate(format, value.substring(0,value.length-(err.length-err.indexOf(':')-2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format);
			} else {
				throw err;
			}
		}
		return date;
	};

	/*
	* override formatDate to set date with time to the input
	*/
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function(inst, day, month, year) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val();
		}
		return this._base_formatDate(inst);
	};

	/*
	* override options setter to add time to maxDate(Time) and minDate(Time). MaxDate
	*/
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function(target, name, value) {
		var inst = this._getInst(target),
	        name_clone;
		if (!inst) {
			return null;
		}

		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop;
		    if (typeof name == 'string') { // if min/max was set with the string
		        if (name === 'minDate' || name === 'minDateTime') {
		            min = value;
		        } else if (name === 'maxDate' || name === 'maxDateTime') {
		            max = value;
		        } else if (name === 'onSelect') {
		            onselect = value;
		        } else if (overrides.hasOwnProperty(name)) {
		            if (typeof (value) === 'undefined') {
		                return overrides[name];
		            }
		            fns[name] = value;
		            name_clone = {}; //empty results in exiting function after overrides updated
		        }
		    } else if (typeof name == 'object') { //if min/max was set with the JSON
		        if (name.minDate) {
		            min = name.minDate;
		        } else if (name.minDateTime) {
		            min = name.minDateTime;
		        } else if (name.maxDate) {
		            max = name.maxDate;
		        } else if (name.maxDateTime) {
		            max = name.maxDateTime;
		        }
		        for (prop in overrides) {
		            if (overrides.hasOwnProperty(prop) &amp;amp;&amp;amp; name[prop]) {
		                fns[prop] = name[prop];
		            }
		        }
		    }
		    for (prop in fns) {
		        if (fns.hasOwnProperty(prop)) {
		            overrides[prop] = fns[prop];
		            if (!name_clone) { name_clone = $.extend({}, name);}
		            delete name_clone[prop];
		        }
		    }
		    if (name_clone &amp;amp;&amp;amp; isEmptyObject(name_clone)) { return; }
		    if (min) { //if min was set
		        if (min === 0) {
		            min = new Date();
		        } else {
		            min = new Date(min);
		        }
		        tp_inst._defaults.minDate = min;
		        tp_inst._defaults.minDateTime = min;
		    } else if (max) { //if max was set
		        if (max === 0) {
		            max = new Date();
		        } else {
		            max = new Date(max);
		        }
		        tp_inst._defaults.maxDate = max;
		        tp_inst._defaults.maxDateTime = max;
		    } else if (onselect) {
		        tp_inst._defaults.onSelect = onselect;
		    }
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name);
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
	};
	
	/*
	* jQuery isEmptyObject does not check hasOwnProperty - if someone has added to the object prototype,
	* it will return false for all objects
	*/
	var isEmptyObject = function(obj) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(obj)) {
				return false;
			}
		}
		return true;
	};

	/*
	* jQuery extend now ignores nulls!
	*/
	var extendRemove = function(target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] === null || props[name] === undefined) {
				target[name] = props[name];
			}
		}
		return target;
	};

	/*
	* Determine by the time format which units are supported
	* Returns an object of booleans for each unit
	*/
	var detectSupport = function(timeFormat){
		var tf = timeFormat.replace(/\'.*?\'/g,'').toLowerCase(), // removes literals
			isIn = function(f, t){ // does the format contain the token?
					return f.indexOf(t) !== -1? true:false; 
				};
		return {
				hour: isIn(tf,'h'),
				minute: isIn(tf,'m'),
				second: isIn(tf,'s'),
				millisec: isIn(tf,'l'),
				microsec: isIn(tf,'c'),
				timezone: isIn(tf,'z'),
				ampm: isIn(tf,'t') &amp;amp;&amp;amp; isIn(timeFormat,'h'),
				iso8601: isIn(timeFormat, 'Z')
			};
	};

	/*
	* Converts 24 hour format into 12 hour
	* Returns 12 hour without leading 0
	*/
	var convert24to12 = function(hour) {
		if (hour &amp;gt; 12) {
			hour = hour - 12;
		}

		if (hour === 0) {
			hour = 12;
		}

		return String(hour);
	};

	/*
	* Splits datetime string into date ans time substrings.
	* Throws exception when date can't be parsed
	* Returns [dateString, timeString]
	*/
	var splitDateTime = function(dateFormat, dateTimeString, dateSettings, timeSettings) {
		try {
			// The idea is to get the number separator occurances in datetime and the time format requested (since time has 
			// fewer unknowns, mostly numbers and am/pm). We will use the time pattern to split.
			var separator = timeSettings &amp;amp;&amp;amp; timeSettings.separator ? timeSettings.separator : $.timepicker._defaults.separator,
				format = timeSettings &amp;amp;&amp;amp; timeSettings.timeFormat ? timeSettings.timeFormat : $.timepicker._defaults.timeFormat,
				timeParts = format.split(separator), // how many occurances of separator may be in our format?
				timePartsLen = timeParts.length,
				allParts = dateTimeString.split(separator),
				allPartsLen = allParts.length;

			if (allPartsLen &amp;gt; 1) {
				return [
						allParts.splice(0,allPartsLen-timePartsLen).join(separator),
						allParts.splice(0,timePartsLen).join(separator)
					];
			}

		} catch (err) {
			$.timepicker.log('Could not split the date from the time. Please check the following datetimepicker options' +
					"\nthrown error: " + err +
					"\ndateTimeString" + dateTimeString +
					"\ndateFormat = " + dateFormat +
					"\nseparator = " + timeSettings.separator +
					"\ntimeFormat = " + timeSettings.timeFormat);

			if (err.indexOf(":") &amp;gt;= 0) {
				// Hack!  The error message ends with a colon, a space, and
				// the "extra" characters.  We rely on that instead of
				// attempting to perfectly reproduce the parsing algorithm.
				var dateStringLength = dateTimeString.length - (err.length - err.indexOf(':') - 2),
					timeString = dateTimeString.substring(dateStringLength);

				return [$.trim(dateTimeString.substring(0, dateStringLength)), $.trim(dateTimeString.substring(dateStringLength))];

			} else {
				throw err;
			}
		}
		return [dateTimeString, ''];
	};

	/*
	* Internal function to parse datetime interval
	* Returns: {date: Date, timeObj: Object}, where
	*   date - parsed date without time (type Date)
	*   timeObj = {hour: , minute: , second: , millisec: , microsec: } - parsed time. Optional
	*/
	var parseDateTimeInternal = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var date;
		var splitRes = splitDateTime(dateFormat, dateTimeString, dateSettings, timeSettings);
		date = $.datepicker._base_parseDate(dateFormat, splitRes[0], dateSettings);
		if (splitRes[1] !== '') {
			var timeString = splitRes[1],
				parsedTime = $.datepicker.parseTime(timeFormat, timeString, timeSettings);

			if (parsedTime === null) {
				throw 'Wrong time format';
			}
			return {
				date: date,
				timeObj: parsedTime
			};
		} else {
			return {
				date: date
			};
		}
	};

	/*
	* Internal function to set timezone_select to the local timezone
	*/
	var selectLocalTimezone = function(tp_inst, date) {
		if (tp_inst &amp;amp;&amp;amp; tp_inst.timezone_select) {
			var now = typeof date !== 'undefined' ? date : new Date();
			tp_inst.timezone_select.val(now.getTimezoneOffset()*-1);
		}
	};

	/*
	* Create a Singleton Insance
	*/
	$.timepicker = new Timepicker();

	/**
	 * Get the timezone offset as string from a date object (eg '+0530' for UTC+5.5)
	 * @@param  number if not a number this value is returned
	 * @@param boolean if true formats in accordance to iso8601 "+12:45"
	 * @@return string
	 */
	$.timepicker.timezoneOffsetString = function(tzMinutes, iso8601) {
		if(isNaN(tzMinutes) || tzMinutes &amp;gt; 840){
			return tzMinutes;
		}

		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601? ':':'',
			tz = (off &amp;gt;= 0 ? '+' : '-') + ('0' + (hours * 101).toString()).slice(-2) + iso + ('0' + (minutes * 101).toString()).slice(-2);
		
		if(tz == '+00:00'){
			return 'Z';
		}
		return tz;
	};

	/**
	 * Get the number in minutes that represents a timezone string
	 * @@param  string formated like "+0500", "-1245"
	 * @@return number
	 */
	$.timepicker.timezoneOffsetNumber = function(tzString) {
		tzString = tzString.toString().replace(':',''); // excuse any iso8601, end up with "+1245"

		if(tzString.toUpperCase() === 'Z'){ // if iso8601 with Z, its 0 minute offset
			return 0;
		}

		if(!/^(\-|\+)\d{4}$/.test(tzString)){ // possibly a user defined tz, so just give it back
			return tzString;
		}

		return ((tzString.substr(0,1) =='-'? -1 : 1) * // plus or minus
					((parseInt(tzString.substr(1,2),10)*60) + // hours (converted to minutes)
					parseInt(tzString.substr(3,2),10))); // minutes
	};

	/**
	 * No way to set timezone in js Date, so we must adjust the minutes to compensate. (think setDate, getDate)
	 * @@param  date
	 * @@param  string formated like "+0500", "-1245"
	 * @@return date
	 */
	$.timepicker.timezoneAdjust = function(date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if(!isNaN(toTz)){
			date.setMinutes(date.getMinutes()*1 + (date.getTimezoneOffset()*-1 - toTz*1) );
		}
		return date;
	};

	/**
	 * Calls `timepicker()` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * n.b. The input value must be correctly formatted (reformatting is not supported)
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the timepicker() call
	 * @@return jQuery
	 */
	$.timepicker.timeRange = function(startTime, endTime, options) {
		return $.timepicker.handleRange('timepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datetimepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@return jQuery
	 */
	$.timepicker.datetimeRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datetimepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.dateRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.handleRange = function(method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0, // min allowed interval in milliseconds
			maxInterval: 0, // max allowed interval in milliseconds
			start: {},      // options for start picker
			end: {}         // options for end picker
		}, options);

		$.fn[method].call(startTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), endTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), endTime, 'minDate');
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), startTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), startTime, 'maxDate');
			}
		}, options, options.end));

		checkDates(startTime, endTime);
		selected(startTime, endTime, 'minDate');
		selected(endTime, startTime, 'maxDate');

		function checkDates(changed, other) {
			var startdt = startTime[method]('getDate'),
				enddt = endTime[method]('getDate'),
				changeddt = changed[method]('getDate');

			if(startdt !== null){
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());

				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);

				if(options.minInterval &amp;gt; 0 &amp;amp;&amp;amp; minDate &amp;gt; enddt){ // minInterval check
					endTime[method]('setDate',minDate);
				}
				else if(options.maxInterval &amp;gt; 0 &amp;amp;&amp;amp; maxDate &amp;lt; enddt){ // max interval check
					endTime[method]('setDate',maxDate);
				}
				else if (startdt &amp;gt; enddt) {
					other[method]('setDate',changeddt);
				}
			}
		}

		function selected(changed, other, option) {
			if (!changed.val()) {
				return;
			}
			var date = changed[method].call(changed, 'getDate');
			if(date !== null &amp;amp;&amp;amp; options.minInterval &amp;gt; 0){
				if(option == 'minDate'){
					date.setMilliseconds(date.getMilliseconds() + options.minInterval); 
				}
				if(option == 'maxDate'){
					date.setMilliseconds(date.getMilliseconds() - options.minInterval);
				}
			}
			if (date.getTime) {
				other[method].call(other, 'option', option, date);
			}
		}
		return $([startTime.get(0), endTime.get(0)]);
	};

	/**
	 * Log error or data to the console during error or debugging
	 * @@param  Object err pass any type object to log to the console during error or debugging
	 * @@return void
	 */
	$.timepicker.log = function(err){
		if(window.console){
			console.log(err);
		}
	};

	/*
	* Microsecond support
	*/
	if(!Date.prototype.getMicroseconds){
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function(){ return this.microseconds; };
		Date.prototype.setMicroseconds = function(m){ 
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m/1000));
			this.microseconds = m%1000;
			return this;
		};
	}

	/*
	* Keep up with the version
	*/
	$.timepicker.version = "1.3.1";

})(jQuery);
jQuery.noConflict();
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;datetimepicker-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;e73a652e-09fc-4c71-8e7a-e2525a2d2a99&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
function replaceAllString(oriStr, strTarget, strSubString ){
   var strText = oriStr;
   var intIndexOfMatch = strText.indexOf( strTarget );
   while (intIndexOfMatch != -1){
      strText = strText.replace( strTarget, strSubString )
      intIndexOfMatch = strText.indexOf( strTarget );
   }
   return( strText );
}
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&amp;amp;]" + name + "=([^&amp;amp;#]*)"),
    results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
};


   var jobName= getParameterByName('job')
   var fromDate= getParameterByName('fromDate')
   var toDate= getParameterByName('toDate')
   var limit= getParameterByName('limit')
   var selectedIstIid = getParameterByName('IstIid')

  $("#jobname").ready(function(){
   $("#jobname").text(jobName)
   var convertedJobName = replaceAllString(jobName, ".", "_")
   $("#IstIid" + convertedJobName).ready(function(){
     $("#IstIid" + convertedJobName).css("display","block")
     $("#select_" + convertedJobName).ready(function(){
        $("#select_" + convertedJobName).val(selectedIstIid)
     });
   });
 });

  $("#fromDate").ready(function(){
   $("#from-date").val(fromDate)
 });

  $("#toDate").ready(function(){
   $("#to-date").val(toDate)
 });

  $("#limit").ready(function(){
   if(limit!=""){
    $("#limit").val(limit)
   }
 });
 // Get data with ajax
 function ajax_getData(jobName,fromDate,toDate,limit ){
       var convertedJobName = replaceAllString(jobName, ".", "_")
       var istIid = $("#select_" + convertedJobName).val()
       window.location="/xwiki/bin/view/WiperDog/WebHome?job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid="+istIid;
 			/*$.ajax({
			 type: "GET",
			 url:"/xwiki/bin/get/Sandbox/DescriptionForJob?outputSyntax=plain&amp;amp;job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid"+selectedIstIid,
			 success : function(result){
				$("#jobname").html(jobName)
				$("#display").text('[[]]' + result)
			 }
		   });*/
 }
	$("#treemenu2 a").click(function(){
		 var limit = 10
		 var fromDate=""
		 var toDate = ""
		 jobName= $(this).text()
                 $("#jobname").html(jobName)
                 var convertedJobName = replaceAllString(jobName, ".", "_")
                 $("#listIstIid &amp;gt; div").css("display","none")
                 $("#IstIid" + convertedJobName).css("display","block")
		 //ajax_getData(jobName,fromDate,toDate,limit )

	});

	$("#from-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
		dateFormat: 'yy-mm-dd',
	});
	$("#to-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
			dateFormat: 'yy-mm-dd',

	});
	 $("#get-data").on("click",function(){
		var fromDate = $("#from-date").val()
		var toDate =  $("#to-date").val()
		 if( toDate!= "" ){
			  if(fromDate != ""){
				  if($("#from-date").datepicker( "getDate" ) &amp;gt; $("#to-date").datepicker( "getDate" )){
				  alert("'From date' cannot start later than 'To date'")
				  return false
				  }
			  }
		 }
		 limit = $("#limit").val()
		 ajax_getData(jobName,fromDate,toDate,limit )
	});
$(document).ready(function(){
  var keys = $("#lstkey").text()
  //console.log('key == ' + keys);
  //console.log('livetableJson ==' + $("#livetableJson").text());
  
  var jsonObj = $.parseJSON($("#livetableJson").text()); 
  if(keys &amp;amp;&amp;amp; keys != '[ ]'){
    /** Subtyped **/    
    var newKeys = keys.replace('[',"");
    keys = newKeys.replace(']',"");
    var keyArr = (keys.indexOf(',') != -1)? keys.split(','):new Array(keys);
    //console.log('Key after replace: '+keys)       
    for(var i=0;i&amp;lt;keyArr.length;i++){
        var keyName = keyArr[i].trim().replace('',"").replace("\"","").replace('\"','');
        var subTypeJsonObjStr = jsonObj[keyName].replace('#livetablePager','#livetablePager_'+keyName)
        var subTypeJsonObj = $.parseJSON(subTypeJsonObjStr);
        $("#livetableList_"+keyName).jqGrid(subTypeJsonObj);
        $("#livetableList_"+keyName).jqGrid('navGrid', "#livetablePager_"+keyName, {
           edit : false,
           add : false,
           del : false,
           search:false
         });
    }
    
  }else{ /** Store**/        
      $("#livetableList").jqGrid(jsonObj);
      $("#livetableList").jqGrid('navGrid', "#livetablePager", {
           edit : false,
           add : false,
           del : false,
           search:false
           
       });
   }
});
        
jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;process&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;881686cc-1bfc-456e-b8ab-71334c4a45e5&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){

	$(function () {
		function drawLineChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerline' + container).highcharts({

				chart: {
					type:'line'
				},
				title: {
					text: chart_name
				},
				tooltip :{
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				xAxis: dataXAxis ,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				series: dataSeries
			});
		};

		function drawBarChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerbar' + container).highcharts({
				chart: {
					type: 'column'
				},
				title: {
					text: chart_name
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {

					column: {
						pointPadding: 0.2,
						borderWidth: 0
					}
				},
				series: dataSeries
			});
		}

		function drawAreaChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail
			$('#containerarea' + container).highcharts({
				chart: {
					type: 'area'
				},
				title: {
					text: chart_name
				},
				subtitle: {
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					},
					labels: {
						formatter: function() {
							return this.value / 1000;
						}
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {
					area: {
						stacking: 'normal',
						lineColor: '#666666',
						lineWidth: 1,
						marker: {
							lineWidth: 1,
							lineColor: '#666666'
						}
					}
				},
				series: dataSeries
			});
		};

		function drawPieChart(data, container, chartName){
			var dataPie = data
			$(document).ready(function () {
				// Build the chart
				$('#container' + container).highcharts({
					chart: {
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: chartName
					},
					tooltip: {
						pointFormat: '{series.name}: &amp;lt;b&amp;gt;{point.percentage:.1f}%&amp;lt;/b&amp;gt;'
					},
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							dataLabels: {
								enabled: true,
                                                                color: '#000000',
                                                                connectorColor: '#000000',
                                                                format: '&amp;lt;b&amp;gt;{point.name}&amp;lt;/b&amp;gt;: {point.percentage:.1f} %'
							},
							showInLegend: true
						}
					},
					series: dataPie
				});
			});
		}

		// LINE
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                     if(($("#jsons&amp;gt;#jsonline_" + finalKey)).length &amp;gt; 0) {
					var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonline_" + finalKey).val());
					var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerline_" + finalKey).val());
				        var lstContainer = [];
  				        var data_all = [];
                                        var chartSize = arrayAll.length

                                        for(var i=0;i&amp;lt;chartSize ;i++){
                                           data_all = arrayAll[i]
                                           lstContainer = arrayContainerAll[i]
				           if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					        // data to display on tooltip
					        var data_detail = data_all[0]
					        // draw Line chart
				        	for(var j=0;j&amp;lt;data_all.length;j++){
				        		if(data_all[j].series[0].name == null){
				        			data_all[j].series[0].name = lstContainer[j]
					        	}
                                                        chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					        	drawLineChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					        }
				         }
                                      }
                                  }
				}
			} else {
				var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonline").val());
				var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerline").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length

                                for(var i=0;i&amp;lt;chartSize ;i++){
                                   data_all = arrayAll[i]
                                   lstContainer = arrayContainerAll[i]
				   if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Line chart
					for(var j=0;j&amp;lt;data_all.length;j++){
						if(data_all[j].series[0].name == null){
							data_all[j].series[0].name = lstContainer[j]
						}
                                                chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
						drawLineChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
				   }
                                }
			}
		});

		// BAR
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
			             var finalKey = lstKey[eKey]
                                     if(($("#jsons&amp;gt;#jsonbar_" + finalKey)).length &amp;gt; 0) {
					var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonbar_" + finalKey).val());
					var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerbar_" + finalKey).val());
					var lstContainer = [];
					var data_all = [];
                                        var chartSize = arrayAll.length
					for(var i=0;i&amp;lt;chartSize ;i++){
					    data_all = arrayAll[i]
					    lstContainer = arrayContainerAll[i]
					    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw bar chart
						for(var j=0;j&amp;lt;data_all.length;j++){
							if(data_all[j].series[0].name == null){
								data_all[j].series[0].name = lstContainer[j]
							}
                                                        chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
							drawBarChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
						}
                                            }
					}
                                    }
				}
			} else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonbar").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerbar").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
				    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Bar chart
					for(var j=0;j&amp;lt;data_all.length;j++){
                                            if(data_all[j].series[0].name == null){
						data_all[j].series[0].name = lstContainer[j]
					    }
                                            chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					    drawBarChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
                                    }
				}
			}
		});

		// AREA
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
                        var arrayAll
                        var arrayContainerAll
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                        if(($("#jsons&amp;gt;#jsonarea_" + finalKey)).length &amp;gt; 0) {
                                           arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonarea_" + finalKey).val());
                                           arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerarea_" + finalKey).val());
					   var lstContainer = [];
					   var data_all = [];
                                           var chartSize = arrayAll.length
					   for(var i=0;i&amp;lt;chartSize ;i++){
					       data_all = arrayAll[i]
					       lstContainer = arrayContainerAll[i]
					       if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						   // data to display on tooltip
						   var data_detail = data_all[0]
						   // draw Line chart
						   for(var j=0;j&amp;lt;data_all.length;j++){
						      if(data_all[j].series[0].name == null){
						         data_all[j].series[0].name = lstContainer[j]
						       }
                                                       chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
						       drawAreaChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
						   }
					      }
				           }
                                        }
			          }
                        } else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonarea").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerarea").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
				    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw area chart
					for(var j=0;j&amp;lt;data_all.length;j++){
                                            if(data_all[j].series[0].name == null){
						data_all[j].series[0].name = lstContainer[j]
					    }
                                            chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					    drawAreaChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
                                    }
				}
			}
		});

		// PIE
		$(document ).ready(function(){
                        var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
                        var arrayAll
                        var arrayContainerAll
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                        if(($("#jsons&amp;gt;#jsonpie_" + finalKey)).length &amp;gt; 0) {
                                           arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonpie_" + finalKey).val());
                                           arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerpie_" + finalKey).val());
					   var lstContainer = [];
					   var data_all = [];
                                           var chartSize = arrayAll.length
					  for(var i=0;i&amp;lt;chartSize ;i++){
					       data_all = arrayAll[i]
					       lstContainer = arrayContainerAll[i]
					       if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						   // draw Pie chart
						   for(var j=0;j&amp;lt;data_all.length;j++){
                                                       chartName  = data_all[j].chart_name + "( " + data_all[j].name + " )"
						       drawPieChart([data_all[j]], finalKey + "_" + lstContainer[j], chartName)
						   }
					      }
				           }
                                        }
			          }
			} else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonpie").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerpie").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
                                var chartNum = 0
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
                                    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
                                                   for(var j=0;j&amp;lt;data_all.length;j++){
                                                       if (data_all[j].name != data_all[j].chart_name) {
                                                           chartName  = data_all[j].chart_name + "( " + data_all[j].name + " )"
                                                       } else {
                                                           chartName  = data_all[j].chart_name
                                                       }
						       drawPieChart([data_all[j]], chartNum + "_pie", chartName)
                                                       chartNum++
						   }

                                    }
                                }
			}
		});
	});
	jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;d5873d92-b78b-42fc-9407-46d166204b88&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;/* css for timepicker */
.ui-timepicker-div .ui-widget-header { 
margin-bottom: 8px;
 }

.ui-timepicker-div dl { text-align: left; }
.ui-timepicker-div dl dt { height: 25px; margin-bottom: -25px; }
.ui-timepicker-div dl dd { margin: 0 10px 10px 65px; }
.ui-timepicker-div td { font-size: 90%; }
.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }

.ui-timepicker-rtl{ direction: rtl; }
.ui-timepicker-rtl dl { text-align: right; }
.ui-timepicker-rtl dl dd { margin: 0 65px 10px 10px; }
#ui-datepicker-div{
 position:relative;
 width:auto;
 height:auto
}
&lt;/code&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;datetimepicker -css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;1201fb1a-e9c1-4731-8c74-2ea8c0071959&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;.displayblock {
  border:2px solid;
  -webkit-border-radius:6px;
  background:gray;
  float: left;
  width:100%;
}

.displaypie {
  border:1px solid;
  -webkit-border-radius:6px;
  background:gray;
  width: 48%;
  float: left; 
  height: 300px;
}

.subtype {
  margin-top: 50px;
  font-size: 2em;
  color: red;
}&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;content&gt;{{include document="Lib.DataToDrawChart"/}}
{{include document="Lib.MongoDBConnection"/}}
{{velocity}}
$xwiki.jsx.use('Lib.JQueryUILib')
$xwiki.ssx.use('Lib.MenuGenerator')
$xwiki.jsx.use('Lib.MenuGenerator')
$xwiki.ssx.use('Lib.JQueryUILib')
$xwiki.jsx.use('Lib.JqGridLib')
$xwiki.ssx.use('Lib.JqGridLib') 
{{/velocity}}
{{include document="Lib.MenuGenerator"/}}
{{html wiki="true" clean="false"}}
&amp;lt;div id="viewer"&amp;gt;
&amp;lt;table style="text-align:left"  &amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th &amp;gt;Job name&amp;lt;/th&amp;gt;
  &amp;lt;td colspan=3&amp;gt;&amp;lt;div id="jobname"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
{{groovy}}
import org.xwiki.context.*

def ec = services.component.getInstance(Execution.class).getContext()
def mapJobIstIid = ec.getProperty("mapJobIstIid")

println '{{html clean="false" wiki="false"}}'
println '&amp;lt;tr&amp;gt;'
println '&amp;lt;th&amp;gt;IstIid&amp;lt;/th&amp;gt;'
println '&amp;lt;td colspan=3&amp;gt;'
mapJobIstIid.each{jobEntry-&amp;gt;
  def convertedJobKey = jobEntry.key.replaceAll("\\.","_")
  println "&amp;lt;div id='listIstIid'&amp;gt;"
  println "&amp;lt;div id=IstIid${convertedJobKey} style='display:none'&amp;gt;"
  println "&amp;lt;select id=select_${convertedJobKey}&amp;gt;"
  jobEntry.value.each{
     println "&amp;lt;option value=\"$it\"&amp;gt;$it&amp;lt;/option&amp;gt;"
  }
  println "&amp;lt;/select&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
}
println '&amp;lt;/td&amp;gt;'
println '&amp;lt;/tr&amp;gt;'
println '{{/html}}'
{{/groovy}}
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data monitor from&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="from-date" id="from-date"/&amp;gt;&amp;lt;/td&amp;gt;
  &amp;lt;th&amp;gt;Data monitor to&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="to-date" id="to-date"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data records limit &amp;lt;/th&amp;gt;
  &amp;lt;td &amp;gt;
     &amp;lt;select id="limit"&amp;gt;
       &amp;lt;option value=5&amp;gt;5&amp;lt;/option&amp;gt;
       &amp;lt;option value=10&amp;gt;10&amp;lt;/option&amp;gt;
       &amp;lt;option value=15&amp;gt;15&amp;lt;/option&amp;gt;
       &amp;lt;option value=20&amp;gt;20&amp;lt;/option&amp;gt;
     &amp;lt;/select&amp;gt;
  &amp;lt;/td&amp;gt;
  &amp;lt;td colspan=3 &amp;gt;&amp;lt;input type="button" value="View Data" id="get-data" class="button"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;&amp;lt;div id="display"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
  &amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
&amp;lt;/table&amp;gt;

&amp;lt;/div&amp;gt; 
   
 &amp;lt;/body&amp;gt;

{{/html}}
{{groovy}}
import groovy.json.*
xwiki.jsx.use("Lib.Highcharts")

if(request.xpage == "plain") {
	response.setContentType('text/plain')
}

def listData = []
def job = request.get("job")
def fromDate = request.get("fromDate")
def toDate = request.get("toDate")
def limit= (request.get("limit")!=null)?request.get("limit").toInteger():10
def istIid = request.get("IstIid")

def str= "No data to retrieved !"
def result = null
if(job != "" &amp;amp;&amp;amp; job != null &amp;amp;&amp;amp; istIid != null &amp;amp;&amp;amp; istIid != ""){
	MongoDBConnection.getConnection()
	if(fromDate != "" || toDate != ""){
		result = MongoDBConnection.getDataInPeriod(job,fromDate,toDate,limit,istIid)
	} else {
		result = MongoDBConnection.getDataAllFields(job,limit,istIid)
        }
MongoDBConnection.closeConnection()
} else {
   println "{{warning}}There are no selected job or IstIid{{/warning}}"
}
def listKey = []
if( (result != null) &amp;amp;&amp;amp; (result.size() &amp;gt; 0) &amp;amp;&amp;amp; (result[0].KEYEXPR != null)&amp;amp;&amp;amp;!(result[0].KEYEXPR instanceof List )){

if(result[0].type == "Subtyped") {
    println '{{html clean="false" wiki="true"}}'
    //println '&amp;lt;body&amp;gt;'
    def dataSubtype = DataToDrawChart.getDataToDrawSubtype(result)
    dataSubtype.each {key,value -&amp;gt;
        listKey.add(key)
    }
    def jsonkey = com.mongodb.util.JSON.serialize(listKey)
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$jsonkey&amp;lt;/textarea&amp;gt;"

    dataSubtype.each {key,value -&amp;gt;
            def dataLine = []
            def dataBar = []
            def dataPie = []
            def dataArea = []
            if(DataToDrawChart.getDataToDrawLine(value) != []) {
                dataLine = DataToDrawChart.getDataToDrawLine(value)
            }
            if(DataToDrawChart.getDataToDrawBar(value) != []) {
                dataBar = DataToDrawChart.getDataToDrawBar(value)
            }
            if(DataToDrawChart.getDataToDrawPie(value) != []) {
                dataPie = DataToDrawChart.getDataToDrawPie(value)
            }
            if(DataToDrawChart.getDataToDrawArea(value) != []) {
                dataArea = DataToDrawChart.getDataToDrawArea(value)
            }

		def chartColumnsLine = []
		def chartColumnsBar = []
		def chartColumnsArea = []
		def lstName

                dataLine.each {itemDataLine -&amp;gt;
                    if(itemDataLine.size() &amp;gt; 0 ){
		        chartColumnsLine.add(itemDataLine[0].chart_columns)
	            }
                }
                dataBar.each {itemDataBar -&amp;gt;
                    if(itemDataBar.size() &amp;gt; 0 ){
		        chartColumnsBar.add(itemDataBar[0].chart_columns)
	            }
                }
                dataArea.each {itemDataArea -&amp;gt;
                    if(itemDataArea.size() &amp;gt; 0 ){
		        chartColumnsArea.add(itemDataArea[0].chart_columns)
	            }
                }

		if(dataPie.size() &amp;gt; 0 ){
			lstName = dataPie['name']
		}
		def tmpListNameContainer = []
                
		if(lstName != null) {
                        def chartNumPie = 0
                        def tmpLst
                        for(def nameContainer in lstName){
                           tmpLst = []
			   for(def nameContainerItem in nameContainer ){
				nameContainerItem = chartNumPie + "_" + nameContainerItem.replaceAll("\\.", "_")
				tmpLst.add(nameContainerItem )
		            }
                            tmpListNameContainer.add(tmpLst)
                            chartNumPie++
                         }
		}
		def jsonPie
		def jsonLine
		def jsonBar
		def jsonArea
		if(dataPie != []) {
		    jsonPie = com.mongodb.util.JSON.serialize(dataPie)
		}
		if(dataLine != []) {
		    jsonLine = com.mongodb.util.JSON.serialize(dataLine)
		}
		if(dataBar != []) {
		    jsonBar = com.mongodb.util.JSON.serialize(dataBar)
		}
		if(dataArea != []) {
		    jsonArea = com.mongodb.util.JSON.serialize(dataArea)
		}
		def jsonContainerPie
		if(tmpListNameContainer != []) {
			jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
		}
		def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
		def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
		def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

		println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
		if(jsonLine != null) {
			println "&amp;lt;textarea id=\"jsonline_$key\" &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class=\"lstcontainerline_$key\" &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
		}
		if(jsonBar != null) {
			println "&amp;lt;textarea id=\"jsonbar_$key\"&amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerbar_$key' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
		}
		if(jsonPie != null &amp;amp;&amp;amp; jsonContainerPie != null) {
			println "&amp;lt;textarea id=\"jsonpie_$key\" &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerpie_$key' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
		}
		if(jsonArea != null) {
			println "&amp;lt;textarea id=\"jsonarea_$key\" &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerarea_$key' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
		}

        println "&amp;lt;/div&amp;gt;"
        def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
        def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
          
        println "&amp;lt;div style='clear:both'&amp;gt;"
            def description = value.KEYEXPR._description[0][key]
            if(description != null) {
                println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +': ' + description +'&amp;lt;/div&amp;gt;'
            } else {
                println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +'&amp;lt;/div&amp;gt;'
            }
            println "-----"
            if(jsonPie != null) {
          println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
	  chartNumPie = 0
          lstName.each{chartPieLst -&amp;gt;
		chartPieLst.each {
	            def tmp = chartNumPie + "_" + it.replaceAll("\\.", "_")
		    println " &amp;lt;div class=\"displaypie\" id=\"container${key}_${tmp}\" &amp;gt;&amp;lt;/div&amp;gt;"
          	}
		chartNumPie++
	  }	
          println "&amp;lt;/div&amp;gt;"
            }
            if(jsonLine != null) {
          	def chartLineComment = false
		def chartNumLine = 0
          	chartColumnsLine.each{chartColumnsLineItem -&amp;gt;
            		if(!chartLineComment){
               			println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
               			chartLineComment = true  
            		}
		chartColumnsLineItem.each{
              		println " &amp;lt;div class=\"displayblock\" id=\"containerline${key}_${chartNumLine}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          	}
		chartNumLine ++
	    }
          println "&amp;lt;/div&amp;gt;"
            }
            println "&amp;amp;nbsp;"

            if(jsonBar != null) {
          	def chartBarComment = false
  		def chartNumBar = 0
          	chartColumnsBar.each{chartColumnsBarItem -&amp;gt;
             		if(!chartBarComment){
                		println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
                		chartBarComment = true
              		}  
			chartColumnsBarItem.each{
             			println " &amp;lt;div class=\"displayblock\" id=\"containerbar${key}_${chartNumBar}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          		}
			chartNumBar++
		}
          	println "&amp;lt;/div&amp;gt;"
            }
            println "&amp;amp;nbsp;"

            if(jsonArea != null) {
          	def chartAreaComment = false
		def chartNumArea = 0
          	chartColumnsArea.each{chartColumnsAreaItem -&amp;gt;
          		if(!chartAreaComment){
            			println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
            			chartAreaComment = true
          		}
			chartColumnsAreaItem.each{
            			println " &amp;lt;div class=\"displayblock\" id=\"containerarea${key}_${chartNumArea}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          		}
          		chartNumArea++
            	}
        	println "&amp;lt;/div&amp;gt;"
	    }
        /** Statistic data table **/
        println "&amp;lt;center&amp;gt;"        
        println "&amp;lt;div id='livetblContent_"+key+"' style='width:100%;clear:both;align:middle;margin-top:10px'&amp;gt;"   
        println "Statistics data for "+key
        println "&amp;lt;table id='livetableList_"+key+"' style='width:100%;align:center'&amp;gt;&amp;lt;/table&amp;gt;"
        println "&amp;lt;div id='livetablePager_"+key+"' style='position:relative;width:100%'&amp;gt;&amp;lt;/div&amp;gt;"
        println "&amp;lt;/div&amp;gt;"
        println "&amp;lt;/center&amp;gt;"
        println "&amp;lt;script language='javascript'&amp;gt;console.log('Create live table for "+key+"');&amp;lt;/script&amp;gt;"
    }
    //println '&amp;lt;/body&amp;gt;'
    println '{{/html}}'
} else if(result[0].type == "Store") {
	// data store
	def dataLine = DataToDrawChart.getDataToDrawLine(result)
	def dataBar = DataToDrawChart.getDataToDrawBar(result)
	def dataPie = DataToDrawChart.getDataToDrawPie(result)
	def dataArea = DataToDrawChart.getDataToDrawArea(result)
	def chartColumnsLine = []
	def chartColumnsBar = []
	def chartColumnsArea = []
	def lstName

        dataLine.each {itemDataLine -&amp;gt;
            if(itemDataLine.size() &amp;gt; 0 ){
		chartColumnsLine.add(itemDataLine[0].chart_columns)
	    }
        }

        dataBar.each {itemDataBar -&amp;gt;
            if(itemDataBar.size() &amp;gt; 0 ){
		chartColumnsBar.add(itemDataBar[0].chart_columns)
	    }
        }

        dataArea.each {itemDataArea -&amp;gt;
            if(itemDataArea.size() &amp;gt; 0 ){
		chartColumnsArea.add(itemDataArea[0].chart_columns)
	    }
        }

	if(dataPie.size() &amp;gt; 0 ){
		lstName = dataPie['name']
	}

    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
  
    def tmpListNameContainer = []
    def chartNumPie = 0
    for(def nameContainer in lstName){
       for(def nameContainerItem in nameContainer ){
           nameContainerItem = chartNumPie + "_" + nameContainerItem.replaceAll("\\.", "_")
           tmpListNameContainer .add(nameContainerItem )
       }
    }
    
    def jsonPie = com.mongodb.util.JSON.serialize(dataPie)
    def jsonLine = com.mongodb.util.JSON.serialize(dataLine)
    def jsonBar = com.mongodb.util.JSON.serialize(dataBar)
    def jsonArea = com.mongodb.util.JSON.serialize(dataArea)

    def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
    def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
    def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
    def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

    def listEmpty = com.mongodb.util.JSON.serialize([])
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$listEmpty&amp;lt;/textarea&amp;gt;" 

    println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
    println "&amp;lt;textarea class='jsonline' &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonbar' &amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonpie' &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonarea' &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"

    println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;/div&amp;gt;"

    def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
    def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
  
    println "&amp;lt;div style='clear:both'&amp;gt;"
  
    def chartPieComment = false
    chartNumPie = 0
    lstName.each{chartPieLst-&amp;gt;
        if(!chartPieComment) {
            println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
            chartPieComment = true
        }
        chartPieLst.each {
            def tmp = chartNumPie + "_pie"
            println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
            chartNumPie++
        }
    }
    println "&amp;lt;/div&amp;gt;"
    	def chartLineComment = false
	def chartNum = 0
    	chartColumnsLine.each{chartColumnsLineItem -&amp;gt;
	    	if(!chartLineComment){
	        	println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	        	chartLineComment = true  
	    	}
		chartColumnsLineItem.each{
	    		println " &amp;lt;div class=\"displayblock\" id=\"containerline${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	    	}
		chartNum++
	}	
    	println "&amp;lt;/div&amp;gt;"
    	println "&amp;amp;nbsp;"
    	def chartBarComment = false
	chartNum = 0
    	chartColumnsBar.each{chartColumnsBarItem -&amp;gt;
	        if(!chartBarComment){
	            println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	            chartBarComment = true
	        }  
		chartColumnsBarItem.each{
	    		println " &amp;lt;div class=\"displayblock\" id=\"containerbar${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  	}
		chartNum++
	}
  println "&amp;lt;/div&amp;gt;"
  println "&amp;amp;nbsp;"
  	def chartAreaComment = false
	chartNum = 0
  	chartColumnsArea.each{chartColumnsAreaItem -&amp;gt;
	  	if(!chartAreaComment){
	    		println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	    		chartAreaComment = true
	  	}
		chartColumnsAreaItem.each{
    			println " &amp;lt;div class=\"displayblock\" id=\"containerarea${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
		}
		chartNum++
  	}
  println "&amp;lt;/div&amp;gt;"
println "&amp;lt;/div&amp;gt;"

//println '&amp;lt;/body&amp;gt;'
println '{{/html}}'
}
}else{
    println 'There is no data for this job with criterias'
}
//--=============== Start build for livetable
def subTypeURLMap = [:]
def dataModel = []
def dataUrl = ""
result.find{rec-&amp;gt;				
    def subtractData = []
    
    //-- Parsing data and assign data to subtract list
    if(rec.type == "Store"){ //-- Store data type
        subtractData = rec['data']        
        subtractData.each{r2-&amp;gt;					
            if(dataModel != null &amp;amp;&amp;amp; dataModel.size() &amp;lt;=0){ 
                dataModel.add("Fetch At")
                dataModel.addAll(r2.keySet());					
            } 
        }        
        dataUrl = "/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job="+job +"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate + "&amp;amp;toDate=" + toDate + "&amp;amp;istIid="+istIid        
        //-- Building data model				
        def model = []
        def colSpec
        dataModel.each{name-&amp;gt;
            colSpec = [:]
            colSpec['name'] = name
            colSpec['index'] = name
            colSpec['width'] = "100"
            model.add(colSpec)
        }
        def dataModelStr = (new JsonBuilder(dataModel)).toPrettyString()
        def modelStr = (new JsonBuilder(model)).toPrettyString() 
        str = 
        "{\"url\":\""+dataUrl+"\",\"datatype\":\"json\","+
            "\"colNames\":"+ dataModelStr +
            ",\"colModel\":"+ modelStr +" ,\"rowList\":[10,20,30],"+
            "\"pager\":\"#livetablePager\", \"viewrecords\": true, \"sortname\": \"RECORD_SEQ\","+
            "\"sortorder\": \"asc\", \"caption\":\""+job+"\"}"
        println "{{html clean=\"false\" wiki=\"true\"}}"
        println "&amp;lt;div id='livetableJson' style = \"display:none\"&amp;gt;"
        //println "&amp;lt;div id='livetableJson'&amp;gt;"
        println str;
        println "&amp;lt;/div&amp;gt;"
        println "{{/html}}"
    }else{ //-- Subtype			
        def subData = rec['data']
        subData.each{key,value-&amp;gt;
            dataUrl = "/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job="+job +"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate + "&amp;amp;toDate=" + toDate + "&amp;amp;istIid="+istIid+"&amp;amp;subType="+key
            subtractData = value
            subtractData.each{r2-&amp;gt;					
                if(dataModel != null &amp;amp;&amp;amp; dataModel.size() &amp;lt;=0){ 
                    dataModel.add("Fetch At")
                    dataModel.addAll(r2.keySet());					
                } 			
            }
            //-- Building data model				
            def model = []
            def colSpec
            dataModel.each{name-&amp;gt;
                colSpec = [:]
                colSpec['name'] = name
                colSpec['index'] = name
                colSpec['width'] = "100"
                model.add(colSpec)
            }
            def dataModelStr = (new JsonBuilder(dataModel)).toPrettyString()
            def modelStr = (new JsonBuilder(model)).toPrettyString() 
            str = 
            "{\"url\":\""+dataUrl+"\",\"datatype\":\"json\","+
                "\"colNames\":"+ dataModelStr +
                ",\"colModel\":"+ modelStr +" ,\"rowList\":[10,20,30],"+
                "\"pager\":\"#livetablePager\", \"viewrecords\": true, \"sortname\": \"RECORD_SEQ\","+
                "\"sortorder\": \"asc\", \"caption\":\""+job+"\"}"
            subTypeURLMap[key] = str
        }
        def finalStr = (new JsonBuilder(subTypeURLMap)).toPrettyString()
        println "{{html clean=\"false\" wiki=\"true\"}}"
        println "&amp;lt;div id='livetableJson' style = \"display:none\"&amp;gt;"
        //println "&amp;lt;div id='livetableJson'&amp;gt;"
        println finalStr;
        println "&amp;lt;/div&amp;gt;"
        println "{{/html}}"
    }
    return true
}
 //--=============== END

if(listKey.size() &amp;lt;= 0){   
    println "{{html clean=\"false\" wiki=\"true\"}}"
    println "&amp;lt;center&amp;gt;"
    println "&amp;lt;div id=\"livetblContent\" style=\"width:100%;clear:both;align:middle;margin-top:10px\"&amp;gt;"   
    println "Statistics Data"
    println "&amp;lt;table id=\"livetableList\" style=\"width:100%;align:center\"&amp;gt;&amp;lt;/table&amp;gt;"    
    println "&amp;lt;div id=\"livetablePager\"&amp;gt;&amp;lt;/div&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
    println "&amp;lt;/center&amp;gt;"
    
    println "&amp;lt;div id=\"testDiv\"&amp;gt;&amp;amp;nbsp;&amp;lt;/div&amp;gt;"
    println "{{/html}}"
}
{{/groovy}}
&lt;/content&gt;&lt;/xwikidoc&gt;@


61.57
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376619918000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;61.57&lt;/version&gt;
d2963 5
a2967 1
                                                       chartName  = data_all[j].chart_name + "( " + data_all[j].name + " )"
@


61.56
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376619665000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;61.56&lt;/version&gt;
d2963 1
a2963 1
                                                       chartName  = data_all[j].name
@


61.55
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376619401000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;61.55&lt;/version&gt;
d2957 1
d2964 2
a2965 1
						       drawPieChart([data_all[j]], j + "_pie", chartName)
@


61.54
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376619340000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;61.54&lt;/version&gt;
a2962 1
console.log(j + "_pie")
@


61.53
log
@@
text
@&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xwikidoc&gt;
&lt;web&gt;WiperDog&lt;/web&gt;
&lt;name&gt;WebHome&lt;/name&gt;
&lt;language&gt;&lt;/language&gt;
&lt;defaultLanguage&gt;en&lt;/defaultLanguage&gt;
&lt;translation&gt;0&lt;/translation&gt;
&lt;parent&gt;&lt;/parent&gt;
&lt;creator&gt;XWiki.Admin&lt;/creator&gt;
&lt;author&gt;XWiki.Admin&lt;/author&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;contentAuthor&gt;XWiki.Admin&lt;/contentAuthor&gt;
&lt;creationDate&gt;1376364375000&lt;/creationDate&gt;
&lt;date&gt;1376619305000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376568337000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.53&lt;/version&gt;
&lt;title&gt;WiperDog&lt;/title&gt;
&lt;defaultTemplate&gt;&lt;/defaultTemplate&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;comment&gt;&lt;/comment&gt;
&lt;minorEdit&gt;true&lt;/minorEdit&gt;
&lt;syntaxId&gt;xwiki/2.1&lt;/syntaxId&gt;
&lt;hidden&gt;false&lt;/hidden&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;047293a8-524d-45e4-af52-cd944523d5d0&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
/*
 * jQuery timepicker addon
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 1.3.1
 * Last Modified: 07/07/2013
 *
 * Copyright 2013 Trent Richardson
 * You may use this project under MIT or GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 */

/*jslint evil: true, white: false, undef: false, nomen: false */

(function($) {

	/*
	* Lets not redefine timepicker, Prevent "Uncaught RangeError: Maximum call stack size exceeded"
	*/
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return;
	}

	/*
	* Extend jQueryUI, get it started with our version number
	*/
	$.extend($.ui, {
		timepicker: {
			version: "1.3.1"
		}
	});

	/* 
	* Timepicker manager.
	* Use the singleton instance of this class, $.timepicker, to interact with the time picker.
	* Settings for (groups of) time pickers are maintained in an instance object,
	* allowing multiple different settings on the same page.
	*/
	var Timepicker = function() {
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[''] = { // Default regional settings
			currentText: 'Now',
			closeText: 'Done',
			amNames: ['AM', 'A'],
			pmNames: ['PM', 'P'],
			timeFormat: 'HH:mm',
			timeSuffix: '',
			timeOnlyTitle: 'Choose Time',
			timeText: 'Time',
			hourText: 'Hour',
			minuteText: 'Minute',
			secondText: 'Second',
			millisecText: 'Millisecond',
			microsecText: 'Microsecond',
			timezoneText: 'Time Zone',
			isRTL: false
		};
		this._defaults = { // Global defaults for all the datetime picker instances
			showButtonPanel: true,
			timeOnly: false,
			showHour: null,
			showMinute: null,
			showSecond: null,
			showMillisec: null,
			showMicrosec: null,
			showTimezone: null,
			showTime: true,
			stepHour: 1,
			stepMinute: 1,
			stepSecond: 1,
			stepMillisec: 1,
			stepMicrosec: 1,
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null,
			hourMin: 0,
			minuteMin: 0,
			secondMin: 0,
			millisecMin: 0,
			microsecMin: 0,
			hourMax: 23,
			minuteMax: 59,
			secondMax: 59,
			millisecMax: 999,
			microsecMax: 999,
			minDateTime: null,
			maxDateTime: null,
			onSelect: null,
			hourGrid: 0,
			minuteGrid: 0,
			secondGrid: 0,
			millisecGrid: 0,
			microsecGrid: 0,
			alwaysSetTime: true,
			separator: ' ',
			altFieldTimeOnly: true,
			altTimeFormat: null,
			altSeparator: null,
			altTimeSuffix: null,
			pickerTimeFormat: null,
			pickerTimeSuffix: null,
			showTimepicker: true,
			timezoneList: null,
			addSliderAccess: false,
			sliderAccessArgs: null,
			controlType: 'slider',
			defaultValue: null,
			parse: 'strict'
		};
		$.extend(this._defaults, this.regional['']);
	};

	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: '',
		formattedDate: '',
		formattedTime: '',
		formattedDateTime: '',
		timezoneList: null,
		units: ['hour','minute','second','millisec', 'microsec'],
		support: {},
		control: null,

		/* 
		* Override the default settings for all instances of the time picker.
		* @@param  settings  object - the new settings to use as defaults (anonymous object)
		* @@return the manager object
		*/
		setDefaults: function(settings) {
			extendRemove(this._defaults, settings || {});
			return this;
		},

		/*
		* Create a new Timepicker instance
		*/
		_newInst: function($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
            	fns = {},
		    	overrides, i;

			for (var attrName in this._defaults) {
				if(this._defaults.hasOwnProperty(attrName)){
					var attrValue = $input.attr('time:' + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue);
						} catch (err) {
							inlineSettings[attrName] = attrValue;
						}
					}
				}
			}

		    overrides = {
		        beforeShow: function (input, dp_inst) {
		            if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
		                return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst);
		            }
		        },
		        onChangeMonthYear: function (year, month, dp_inst) {
		            // Update the time as well : this prevents the time from disappearing from the $input field.
		            tp_inst._updateDateTime(dp_inst);
		            if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
		                tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst);
		            }
		        },
		        onClose: function (dateText, dp_inst) {
		            if (tp_inst.timeDefined === true &amp;amp;&amp;amp; $input.val() !== '') {
		                tp_inst._updateDateTime(dp_inst);
		            }
		            if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
		                tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst);
		            }
		        }
		    };
		    for (i in overrides) {
		        if (overrides.hasOwnProperty(i)) {
		            fns[i] = opts[i] || null;
		        }
		    }

		    tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
		        evnts:fns,
		        timepicker: tp_inst // add timepicker as a property of datepicker: $.datepicker._get(dp_inst, 'timepicker');
		    });
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function(val) {
				return val.toUpperCase();
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function(val) {
				return val.toUpperCase();
			});

			// detect which units are supported
			tp_inst.support = detectSupport(
					tp_inst._defaults.timeFormat + 
					(tp_inst._defaults.pickerTimeFormat? tp_inst._defaults.pickerTimeFormat:'') + 
					(tp_inst._defaults.altTimeFormat? tp_inst._defaults.altTimeFormat:''));

			// controlType is string - key to our this._controls
			if(typeof(tp_inst._defaults.controlType) === 'string'){
				if(tp_inst._defaults.controlType == 'slider' &amp;amp;&amp;amp; typeof(jQuery.ui.slider) === 'undefined'){
					tp_inst._defaults.controlType = 'select';
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType];
			}
			// controlType is an object and must implement create, options, value methods
			else{ 
				tp_inst.control = tp_inst._defaults.controlType;
			}

			// prep the timezone options
			var timezoneList = [-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,
					0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList;
			}
			var tzl=timezoneList.length,tzi=0,tzv=null;
			if (tzl &amp;gt; 0 &amp;amp;&amp;amp; typeof timezoneList[0] !== 'object') {
				for(; tzi&amp;lt;tzl; tzi++){
					tzv = timezoneList[tzi];
					timezoneList[tzi] = { value: tzv, label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601) };
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;

			// set the default units
			tp_inst.timezone = tp_inst._defaults.timezone !== null? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) : 
							((new Date()).getTimezoneOffset()*-1);
			tp_inst.hour = tp_inst._defaults.hour &amp;lt; tp_inst._defaults.hourMin? tp_inst._defaults.hourMin : 
							tp_inst._defaults.hour &amp;gt; tp_inst._defaults.hourMax? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute &amp;lt; tp_inst._defaults.minuteMin? tp_inst._defaults.minuteMin : 
							tp_inst._defaults.minute &amp;gt; tp_inst._defaults.minuteMax? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second &amp;lt; tp_inst._defaults.secondMin? tp_inst._defaults.secondMin : 
							tp_inst._defaults.second &amp;gt; tp_inst._defaults.secondMax? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec &amp;lt; tp_inst._defaults.millisecMin? tp_inst._defaults.millisecMin : 
							tp_inst._defaults.millisec &amp;gt; tp_inst._defaults.millisecMax? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec &amp;lt; tp_inst._defaults.microsecMin? tp_inst._defaults.microsecMin : 
							tp_inst._defaults.microsec &amp;gt; tp_inst._defaults.microsecMax? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = '';
			tp_inst.$input = $input;

			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField).css({
					cursor: 'pointer'
				}).focus(function() {
					$input.trigger("focus");
				});
			}

			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date();
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date();
			}

			// datepicker needs minDate/maxDate, timepicker needs minDateTime/maxDateTime..
			if (tp_inst._defaults.minDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime());
			}
			if (tp_inst._defaults.minDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime());
			}
			if (tp_inst._defaults.maxDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime());
			}
			if (tp_inst._defaults.maxDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime());
			}
			tp_inst.$input.bind('focus', function() {
				tp_inst._onFocus();
			});

			return tp_inst;
		},

		/*
		* add our sliders to the calendar
		*/
		_addTimePicker: function(dp_inst) {
			var currDT = (this.$altInput &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly) ? this.$input.val() + ' ' + this.$altInput.val() : this.$input.val();

			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
		},

		/*
		* parse the time string from input value or _setTime
		*/
		_parseTime: function(timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0]);
			}

			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, 'dateFormat');
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false;
					}
					$.extend(this, parseRes.timeObj);
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err +
									"\ndate/time string = " + timeString +
									"\ntimeFormat = " + this._defaults.timeFormat +
									"\ndateFormat = " + dp_dateFormat);
					return false;
				}
				return true;
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false;
				}
				$.extend(this, timeObj);
				return true;
			}
		},

		/*
		* generate and inject html for timepicker into ui datepicker
		*/
		_injectTimePicker: function() {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = '',
				uitem = '',
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i=0,
				l=0;

			// Prevent displaying twice
			if ($dp.find("div.ui-timepicker-div").length === 0 &amp;amp;&amp;amp; o.showTimepicker) {
				var noDisplay = ' style="display:none;"',
					html = '&amp;lt;div class="ui-timepicker-div'+ (o.isRTL? ' ui-timepicker-rtl' : '') +'"&amp;gt;&amp;lt;dl&amp;gt;' + '&amp;lt;dt class="ui_tpicker_time_label"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;' + o.timeText + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_time"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the markup
				for(i=0,l=this.units.length; i&amp;lt;l; i++){
					litem = this.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// Added by Peter Medeiros:
					// - Figure out what the hour/minute/second max should be based on the step values.
					// - Example: if stepMinute is 15, then minMax is 45.
					max[litem] = parseInt((o[litem+'Max'] - ((o[litem+'Max'] - o[litem+'Min']) % o['step'+uitem])), 10);
					gridSize[litem] = 0;

					html += '&amp;lt;dt class="ui_tpicker_'+ litem +'_label"' + (show ? '' : noDisplay) + '&amp;gt;' + o[litem +'Text'] + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_'+ litem +'"&amp;gt;&amp;lt;div class="ui_tpicker_'+ litem +'_slider"' + (show ? '' : noDisplay) + '&amp;gt;&amp;lt;/div&amp;gt;';

					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						html += '&amp;lt;div style="padding-left: 1px"&amp;gt;&amp;lt;table class="ui-tpicker-grid-label"&amp;gt;&amp;lt;tr&amp;gt;';

						if(litem == 'hour'){
							for (var h = o[litem+'Min']; h &amp;lt;= max[litem]; h += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm? 'hht':'HH', {hour:h}, o);									
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + tmph + '&amp;lt;/td&amp;gt;';
							}
						}
						else{
							for (var m = o[litem+'Min']; m &amp;lt;= max[litem]; m += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + ((m &amp;lt; 10) ? '0' : '') + m + '&amp;lt;/td&amp;gt;';
							}
						}

						html += '&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;&amp;lt;/div&amp;gt;';
					}
					html += '&amp;lt;/dd&amp;gt;';
				}
				
				// Timezone
				var showTz = o.showTimezone !== null? o.showTimezone : this.support.timezone;
				html += '&amp;lt;dt class="ui_tpicker_timezone_label"' + (showTz ? '' : noDisplay) + '&amp;gt;' + o.timezoneText + '&amp;lt;/dt&amp;gt;';
				html += '&amp;lt;dd class="ui_tpicker_timezone" ' + (showTz ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the elements from string
				html += '&amp;lt;/dl&amp;gt;&amp;lt;/div&amp;gt;';
				var $tp = $(html);

				// if we only want time picker...
				if (o.timeOnly === true) {
					$tp.prepend('&amp;lt;div class="ui-widget-header ui-helper-clearfix ui-corner-all"&amp;gt;' + '&amp;lt;div class="ui-datepicker-title"&amp;gt;' + o.timeOnlyTitle + '&amp;lt;/div&amp;gt;' + '&amp;lt;/div&amp;gt;');
					$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();
				}
				
				// add sliders, adjust grids, add events
				for(i=0,l=tp_inst.units.length; i&amp;lt;l; i++){
					litem = tp_inst.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// add the slider
					tp_inst[litem+'_slider'] = tp_inst.control.create(tp_inst, $tp.find('.ui_tpicker_'+litem+'_slider'), litem, tp_inst[litem], o[litem+'Min'], max[litem], o['step'+uitem]);

					// adjust the grid and add click event
					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						size = 100 * gridSize[litem] * o[litem+'Grid'] / (max[litem] - o[litem+'Min']);
						$tp.find('.ui_tpicker_'+litem+' table').css({
							width: size + "%",
							marginLeft: o.isRTL? '0' : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL? ((size / (-2 * gridSize[litem])) + "%") : '0',
							borderCollapse: 'collapse'
						}).find("td").click(function(e){
								var $t = $(this),
									h = $t.html(),
									n = parseInt(h.replace(/[^0-9]/g),10),
									ap = h.replace(/[^apm]/ig),
									f = $t.data('for'); // loses scope, so we use data-for

								if(f == 'hour'){
									if(ap.indexOf('p') !== -1 &amp;amp;&amp;amp; n &amp;lt; 12){
										n += 12;
									}
									else{
										if(ap.indexOf('a') !== -1 &amp;amp;&amp;amp; n === 12){
											n = 0;
										}
									}
								}
								
								tp_inst.control.value(tp_inst, tp_inst[f+'_slider'], litem, n);

								tp_inst._onTimeChange();
								tp_inst._onSelectHandler();
							}).css({
								cursor: 'pointer',
								width: (100 / gridSize[litem]) + '%',
								textAlign: 'center',
								overflow: 'hidden'
							});
					} // end if grid &amp;gt; 0
				} // end for loop

				// Add timezone options
				this.timezone_select = $tp.find('.ui_tpicker_timezone').append('&amp;lt;select&amp;gt;&amp;lt;/select&amp;gt;').find("select");
				$.fn.append.apply(this.timezone_select,
				$.map(o.timezoneList, function(val, idx) {
					return $("&amp;lt;option /&amp;gt;").val(typeof val == "object" ? val.value : val).text(typeof val == "object" ? val.label : val);
				}));
				if (typeof(this.timezone) != "undefined" &amp;amp;&amp;amp; this.timezone !== null &amp;amp;&amp;amp; this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset()*-1;
					if (local_timezone == this.timezone) {
						selectLocalTimezone(tp_inst);
					} else {
						this.timezone_select.val(this.timezone);
					}
				} else {
					if (typeof(this.hour) != "undefined" &amp;amp;&amp;amp; this.hour !== null &amp;amp;&amp;amp; this.hour !== "") {
						this.timezone_select.val(o.timezone);
					} else {
						selectLocalTimezone(tp_inst);
					}
				}
				this.timezone_select.change(function() {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
				});
				// End timezone options
				
				// inject timepicker into datepicker
				var $buttonPanel = $dp.find('.ui-datepicker-buttonpane');
				if ($buttonPanel.length) {
					$buttonPanel.before($tp);
				} else {
					$dp.append($tp);
				}

				this.$timeObj = $tp.find('.ui_tpicker_time');

				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined;
				}

				// slideAccess integration: http://trentrichardson.com/2011/11/11/jquery-ui-sliders-and-touch-accessibility/
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
						
					setTimeout(function() { // fix for inline mode
						if ($tp.find('.ui-slider-access').length === 0) {
							$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);

							// fix any grids since sliders are shorter
							var sliderAccessWidth = $tp.find('.ui-slider-access:eq(0)').outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find('table:visible').each(function() {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl? 'marginRight':'marginLeft').toString().replace('%', ''),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + '%',
										css = { width: newWidth, marginRight: 0, marginLeft: 0 };
									css[rtl? 'marginRight':'marginLeft'] = newMarginLeft;
									$g.css(css);
								});
							}
						}
					}, 10);
				}
				// end slideAccess integration

				tp_inst._limitMinMaxDateTime(this.inst, true);
			}
		},

		/*
		* This function tries to limit the ability to go outside the
		* min/max date range
		*/
		_limitMinMaxDateTime: function(dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);

			if (!this._defaults.showTimepicker) {
				return;
			} // No time so nothing to check here

			if ($.datepicker._get(dp_inst, 'minDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'minDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, 'minDateTime'),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin;
				}

				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour &amp;lt;= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute &amp;lt;= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second &amp;lt;= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if(this.millisec &amp;lt;= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;lt; this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin;
									}
									this._defaults.microsecMin = this.microsecMinOriginal;
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal;
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal;
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal;
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal;
				}
			}

			if ($.datepicker._get(dp_inst, 'maxDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'maxDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, 'maxDateTime'),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax;
				}

				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour &amp;gt;= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute &amp;gt;= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second &amp;gt;= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec &amp;gt;= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;gt; this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax;
									}
									this._defaults.microsecMax = this.microsecMaxOriginal;
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal;
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal;
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal;
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal;
				}
			}

			if (adjustSliders !== undefined &amp;amp;&amp;amp; adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10);
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);

				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, 'hour', { min: this._defaults.hourMin, max: hourMax });
					this.control.value(this, this.hour_slider, 'hour', this.hour - (this.hour % this._defaults.stepHour));
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, 'minute', { min: this._defaults.minuteMin, max: minMax });
					this.control.value(this, this.minute_slider, 'minute', this.minute - (this.minute % this._defaults.stepMinute));
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, 'second', { min: this._defaults.secondMin, max: secMax });
					this.control.value(this, this.second_slider, 'second', this.second - (this.second % this._defaults.stepSecond));
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, 'millisec', { min: this._defaults.millisecMin, max: millisecMax });
					this.control.value(this, this.millisec_slider, 'millisec', this.millisec - (this.millisec % this._defaults.stepMillisec));
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, 'microsec', { min: this._defaults.microsecMin, max: microsecMax });
					this.control.value(this, this.microsec_slider, 'microsec', this.microsec - (this.microsec % this._defaults.stepMicrosec));
				}
			}

		},

		/*
		* when a slider moves, set the internal time...
		* on time change is also called when the time is updated in the text field
		*/
		_onTimeChange: function() {
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, 'hour') : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, 'minute') : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, 'second') : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, 'millisec') : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, 'microsec') : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;

			if (typeof(hour) == 'object') {
				hour = false;
			}
			if (typeof(minute) == 'object') {
				minute = false;
			}
			if (typeof(second) == 'object') {
				second = false;
			}
			if (typeof(millisec) == 'object') {
				millisec = false;
			}
			if (typeof(microsec) == 'object') {
				microsec = false;
			}
			if (typeof(timezone) == 'object') {
				timezone = false;
			}

			if (hour !== false) {
				hour = parseInt(hour, 10);
			}
			if (minute !== false) {
				minute = parseInt(minute, 10);
			}
			if (second !== false) {
				second = parseInt(second, 10);
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10);
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10);
			}

			var ampm = o[hour &amp;lt; 12 ? 'amNames' : 'pmNames'][0];

			// If the update was done in the input field, the input field should not be updated.
			// If the update was done using the sliders, update the input field.
			var hasChanged = (hour != this.hour || minute != this.minute || second != this.second || millisec != this.millisec || microsec != this.microsec 
								|| (this.ampm.length &amp;gt; 0 &amp;amp;&amp;amp; (hour &amp;lt; 12) != ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) 
								|| (this.timezone !== null &amp;amp;&amp;amp; timezone != this.timezone));

			if (hasChanged) {

				if (hour !== false) {
					this.hour = hour;
				}
				if (minute !== false) {
					this.minute = minute;
				}
				if (second !== false) {
					this.second = second;
				}
				if (millisec !== false) {
					this.millisec = millisec;
				}
				if (microsec !== false) {
					this.microsec = microsec;
				}
				if (timezone !== false) {
					this.timezone = timezone;
				}

				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0]);
				}

				this._limitMinMaxDateTime(this.inst, true);
			}
			if (this.support.ampm) {
				this.ampm = ampm;
			}

			// Updates the time within the timepicker
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if(pickerTimeFormat === o.timeFormat){
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix);
				}
				else{
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix);
				}
			}

			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime();
			}
		},

		/*
		* call custom onSelect.
		* bind to sliders slidestop, and grid click.
		*/
		_onSelectHandler: function() {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect &amp;amp;&amp;amp; inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this]);
			}
		},

		/*
		* update our input with the new date time..
		*/
		_updateDateTime: function(dp_inst) {
			dp_inst = this.inst || dp_inst;
			//var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
			var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay)),
				dateFmt = $.datepicker._get(dp_inst, 'dateFormat'),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null &amp;amp;&amp;amp; this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			
			// if a slider was changed but datepicker doesn't have a value yet, set it
			if(dp_inst.lastVal===""){
                dp_inst.currentYear=dp_inst.selectedYear;
                dp_inst.currentMonth=dp_inst.selectedMonth;
                dp_inst.currentDay=dp_inst.selectedDay;
            }

			/*
			* remove following lines to force every changes in date picker to change the input value
			* Bug descriptions: when an input field has a default value, and click on the field to pop up the date picker. 
			* If the user manually empty the value in the input field, the date picker will never change selected value.
			*/
			//if (dp_inst.lastVal !== undefined &amp;amp;&amp;amp; (dp_inst.lastVal.length &amp;gt; 0 &amp;amp;&amp;amp; this.$input.val().length === 0)) {
			//	return;
			//}

			if (this._defaults.timeOnly === true) {
				formattedDateTime = this.formattedTime;
			} else if (this._defaults.timeOnly !== true &amp;amp;&amp;amp; (this._defaults.alwaysSetTime || timeAvailable)) {
				formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix;
			}

			this.formattedDateTime = formattedDateTime;

			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate);
			} else if (this.$altInput &amp;amp;&amp;amp; this._defaults.timeOnly === false &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly === true) {
				this.$altInput.val(this.formattedTime);
				this.$input.val(this.formattedDate);
			} else if (this.$altInput) {
				this.$input.val(formattedDateTime);
				var altFormattedDateTime = '',
					altSeparator = this._defaults.altSeparator ? this._defaults.altSeparator : this._defaults.separator,
					altTimeSuffix = this._defaults.altTimeSuffix ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
				
				if(!this._defaults.timeOnly){
					if (this._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg);
					}
					else{
						altFormattedDateTime = this.formattedDate;
					}

					if (altFormattedDateTime){
						altFormattedDateTime += altSeparator;
					}
				}

				if(this._defaults.altTimeFormat){
					altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix;
				}
				else{
					altFormattedDateTime += this.formattedTime + altTimeSuffix;
				}
				this.$altInput.val(altFormattedDateTime);
			} else {
				this.$input.val(formattedDateTime);
			}

			this.$input.trigger("change");
		},

		_onFocus: function() {
			if (!this.$input.val() &amp;amp;&amp;amp; this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, 'timepicker');
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst);
						} catch (err) {
							$.timepicker.log(err);
						}
					}
				}
			}
		},

		/*
		* Small abstraction to control types
		* We can add more, just be sure to follow the pattern: create, options, value
		*/
		_controls: {
			// slider methods
			slider: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var rtl = tp_inst._defaults.isRTL; // if rtl go -60-&amp;gt;0 instead of 0-&amp;gt;60
					return obj.prop('slide', null).slider({
						orientation: "horizontal",
						value: rtl? val*-1 : val,
						min: rtl? max*-1 : min,
						max: rtl? min*-1 : max,
						step: step,
						slide: function(event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl? ui.value*-1:ui.value);
							tp_inst._onTimeChange();
						},
						stop: function(event, ui) {
							tp_inst._onSelectHandler();
						}
					});	
				},
				options: function(tp_inst, obj, unit, opts, val){
					if(tp_inst._defaults.isRTL){
						if(typeof(opts) == 'string'){
							if(opts == 'min' || opts == 'max'){
								if(val !== undefined){
									return obj.slider(opts, val*-1);
								}
								return Math.abs(obj.slider(opts));
							}
							return obj.slider(opts);
						}
						var min = opts.min, 
							max = opts.max;
						opts.min = opts.max = null;
						if(min !== undefined){
							opts.max = min * -1;
						}
						if(max !== undefined){
							opts.min = max * -1;
						}
						return obj.slider(opts);
					}
					if(typeof(opts) == 'string' &amp;amp;&amp;amp; val !== undefined){
							return obj.slider(opts, val);
					}
					return obj.slider(opts);
				},
				value: function(tp_inst, obj, unit, val){
					if(tp_inst._defaults.isRTL){
						if(val !== undefined){
							return obj.slider('value', val*-1);
						}
						return Math.abs(obj.slider('value'));
					}
					if(val !== undefined){
						return obj.slider('value', val);
					}
					return obj.slider('value');
				}
			},
			// select methods
			select: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var sel = '&amp;lt;select class="ui-timepicker-select" data-unit="'+ unit +'" data-min="'+ min +'" data-max="'+ max +'" data-step="'+ step +'"&amp;gt;',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;

					for(var i=min; i&amp;lt;=max; i+=step){						
						sel += '&amp;lt;option value="'+ i +'"'+ (i==val? ' selected':'') +'&amp;gt;';
						if(unit == 'hour'){
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig,'')), {hour:i}, tp_inst._defaults);
						}
						else if(unit == 'millisec' || unit == 'microsec' || i &amp;gt;= 10){ sel += i; }
						else {sel += '0'+ i.toString(); }
						sel += '&amp;lt;/option&amp;gt;';
					}
					sel += '&amp;lt;/select&amp;gt;';

					obj.children('select').remove();

					$(sel).appendTo(obj).change(function(e){
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
					});

					return obj;
				},
				options: function(tp_inst, obj, unit, opts, val){
					var o = {},
						$t = obj.children('select');
					if(typeof(opts) == 'string'){
						if(val === undefined){
							return $t.data(opts);
						}
						o[opts] = val;	
					}
					else{ o = opts; }
					return tp_inst.control.create(tp_inst, obj, $t.data('unit'), $t.val(), o.min || $t.data('min'), o.max || $t.data('max'), o.step || $t.data('step'));
				},
				value: function(tp_inst, obj, unit, val){
					var $t = obj.children('select');
					if(val !== undefined){
						return $t.val(val);
					}
					return $t.val();
				}
			}
		} // end _controls

	});

	$.fn.extend({
		/*
		* shorthand just to use timepicker..
		*/
		timepicker: function(o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);

			if (typeof o == 'object') {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				});
			}

			return $(this).each(function() {
				$.fn.datetimepicker.apply($(this), tmp_args);
			});
		},

		/*
		* extend timepicker to datepicker
		*/
		datetimepicker: function(o) {
			o = o || {};
			var tmp_args = arguments;

			if (typeof(o) == 'string') {
				if (o == 'getDate') {
					return $.fn.datepicker.apply($(this[0]), tmp_args);
				} else {
					return this.each(function() {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args);
					});
				}
			} else {
				return this.each(function() {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults);
				});
			}
		}
	});

	/*
	* Public Utility to parse date and time
	*/
	$.datepicker.parseDateTime = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec);
		}

		return parseRes.date;
	};

	/*
	* Public utility to parse time
	*/
	$.datepicker.parseTime = function(timeFormat, timeString, options) {		
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g,'').indexOf('Z') !== -1);

		// Strict parse requires the timeString to match the timeFormat exactly
		var strictParse = function(f, s, o){

			// pattern for standard and localized AM/PM markers
			var getPatternAmpm = function(amNames, pmNames) {
				var markers = [];
				if (amNames) {
					$.merge(markers, amNames);
				}
				if (pmNames) {
					$.merge(markers, pmNames);
				}
				markers = $.map(markers, function(val) {
					return val.replace(/[.*+?|()\[\]{}\\]/g, '\\$&amp;amp;');
				});
				return '(' + markers.join('|') + ')?';
			};

			// figure out position of time elements.. cause js cant do named captures
			var getFormatPositions = function(timeFormat) {
				var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
					orders = {
						h: -1,
						m: -1,
						s: -1,
						l: -1,
						c: -1,
						t: -1,
						z: -1
					};

				if (finds) {
					for (var i = 0; i &amp;lt; finds.length; i++) {
						if (orders[finds[i].toString().charAt(0)] == -1) {
							orders[finds[i].toString().charAt(0)] = i + 1;
						}
					}
				}
				return orders;
			};

			var regstr = '^' + f.toString()
					.replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
							var ml = match.length;
							switch (match.charAt(0).toLowerCase()) {
								case 'h': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'm': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 's': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'l': return '(\\d?\\d?\\d)';
								case 'c': return '(\\d?\\d?\\d)';
								case 'z': return '(z|[-+]\\d\\d:?\\d\\d|\\S+)?';
								case 't': return getPatternAmpm(o.amNames, o.pmNames);
								default:    // literal escaped in quotes
									return '(' + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function (m) { return "\\" + m; }) + ')?';
							}
						})
					.replace(/\s/g, '\\s?') +
					o.timeSuffix + '$',
				order = getFormatPositions(f),
				ampm = '',
				treg;

			treg = s.match(new RegExp(regstr, 'i'));

			var resTime = {
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0
			};

			if (treg) {
				if (order.t !== -1) {
					if (treg[order.t] === undefined || treg[order.t].length === 0) {
						ampm = '';
						resTime.ampm = '';
					} else {
						ampm = $.inArray(treg[order.t].toUpperCase(), o.amNames) !== -1 ? 'AM' : 'PM';
						resTime.ampm = o[ampm == 'AM' ? 'amNames' : 'pmNames'][0];
					}
				}

				if (order.h !== -1) {
					if (ampm == 'AM' &amp;amp;&amp;amp; treg[order.h] == '12') {
						resTime.hour = 0; // 12am = 0 hour
					} else {
						if (ampm == 'PM' &amp;amp;&amp;amp; treg[order.h] != '12') {
							resTime.hour = parseInt(treg[order.h], 10) + 12; // 12pm = 12 hour, any other pm = hour + 12
						} else {
							resTime.hour = Number(treg[order.h]);
						}
					}
				}

				if (order.m !== -1) {
					resTime.minute = Number(treg[order.m]);
				}
				if (order.s !== -1) {
					resTime.second = Number(treg[order.s]);
				}
				if (order.l !== -1) {
					resTime.millisec = Number(treg[order.l]);
				}
				if (order.c !== -1) {
					resTime.microsec = Number(treg[order.c]);
				}
				if (order.z !== -1 &amp;amp;&amp;amp; treg[order.z] !== undefined) {
					resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z]);
				}


				return resTime;
			}
			return false;
		};// end strictParse

		// First try JS Date, if that fails, use strictParse
		var looseParse = function(f,s,o){
			try{
				var d = new Date('2012-01-01 '+ s);
				if(isNaN(d.getTime())){
					d = new Date('2012-01-01T'+ s);
					if(isNaN(d.getTime())){
						d = new Date('01/01/2012 '+ s);
						if(isNaN(d.getTime())){
							throw "Unable to parse time with native Date: "+ s;
						}
					}
				}

				return {
					hour: d.getHours(),
					minute: d.getMinutes(),
					second: d.getSeconds(),
					millisec: d.getMilliseconds(),
					microsec: d.getMicroseconds(),
					timezone: d.getTimezoneOffset()*-1
				};
			}
			catch(err){
				try{
					return strictParse(f,s,o);
				}
				catch(err2){
					$.timepicker.log("Unable to parse \ntimeString: "+ s +"\ntimeFormat: "+ f);
				}				
			}
			return false;
		}; // end looseParse
		
		if(typeof o.parse === "function"){
			return o.parse(timeFormat, timeString, o);
		}
		if(o.parse === 'loose'){
			return looseParse(timeFormat, timeString, o);
		}
		return strictParse(timeFormat, timeString, o);
	};

	/*
	* Public utility to format the time
	* format = string format of the time
	* time = a {}, not a Date() for timezones
	* options = essentially the regional[].. amNames, pmNames, ampm
	*/
	$.datepicker.formatTime = function(format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			timezone: 0
		}, time);

		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);

		if (hour &amp;gt; 11) {
			ampmName = options.pmNames[0];
		}

		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|('.*?'|".*?"))/g, function(match) {
		switch (match) {
			case 'HH':
				return ('0' + hour).slice(-2);
			case 'H':
				return hour;
			case 'hh':
				return ('0' + convert24to12(hour)).slice(-2);
			case 'h':
				return convert24to12(hour);
			case 'mm':
				return ('0' + time.minute).slice(-2);
			case 'm':
				return time.minute;
			case 'ss':
				return ('0' + time.second).slice(-2);
			case 's':
				return time.second;
			case 'l':
				return ('00' + time.millisec).slice(-3);
			case 'c':
				return ('00' + time.microsec).slice(-3);
			case 'z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, false);
			case 'Z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, true);
			case 'T': 
				return ampmName.charAt(0).toUpperCase();
			case 'TT': 
				return ampmName.toUpperCase();
			case 't':
				return ampmName.charAt(0).toLowerCase();
			case 'tt':
				return ampmName.toLowerCase();
			default:
				return match.replace(/\'/g, "") || "'";
			}
		});

		tmptime = $.trim(tmptime);
		return tmptime;
	};

	/*
	* the bad hack :/ override datepicker so it doesnt close on select
	// inspired: http://stackoverflow.com/questions/1252512/jquery-datepicker-prevent-closing-picker-when-clicking-a-date/1762378#1762378
	*/
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function(id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			tp_inst._limitMinMaxDateTime(inst, true);
			inst.inline = inst.stay_open = true;
			//This way the onSelect handler called from calendarpicker get the full dateTime
			this._base_selectDate(id, dateStr);
			inst.inline = inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst);
		} else {
			this._base_selectDate(id, dateStr);
		}
	};

	/*
	* second bad hack :/ override datepicker so it triggers an event when changing the input field
	* and does not redraw the datepicker on every selectDate event
	*/
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function(inst) {

		// don't popup the datepicker if there is another instance already opened
		var input = inst.input[0];
		if ($.datepicker._curInst &amp;amp;&amp;amp; $.datepicker._curInst != inst &amp;amp;&amp;amp; $.datepicker._datepickerShowing &amp;amp;&amp;amp; $.datepicker._lastInput != input) {
			return;
		}

		if (typeof(inst.stay_open) !== 'boolean' || inst.stay_open === false) {

			this._base_updateDatepicker(inst);

			// Reload the time control when changing something in the input text field.
			var tp_inst = this._get(inst, 'timepicker');
			if (tp_inst) {
				tp_inst._addTimePicker(inst);
			}
		}
	};

	/*
	* third bad hack :/ override datepicker so it allows spaces and colon in the input field
	*/
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if ($.datepicker._get(inst, 'constrainInput')) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null? tp_inst._defaults.showTimezone : tp_inst.support.timezone,					
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat')),
					datetimeChars = tp_inst._defaults.timeFormat.toString()
											.replace(/[hms]/g, '')
											.replace(/TT/g, ampm ? 'APM' : '')
											.replace(/Tt/g, ampm ? 'AaPpMm' : '')
											.replace(/tT/g, ampm ? 'AaPpMm' : '')
											.replace(/T/g, ampm ? 'AP' : '')
											.replace(/tt/g, ampm ? 'apm' : '')
											.replace(/t/g, ampm ? 'ap' : '') + 
											" " + tp_inst._defaults.separator + 
											tp_inst._defaults.timeSuffix + 
											(tz ? tp_inst._defaults.timezoneList.join('') : '') + 
											(tp_inst._defaults.amNames.join('')) + (tp_inst._defaults.pmNames.join('')) + 
											dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr &amp;lt; ' ' || !dateChars || datetimeChars.indexOf(chr) &amp;gt; -1);
			}
		}

		return $.datepicker._base_doKeyPress(event);
	};

	/*
	* Fourth bad hack :/ override _updateAlternate function used in inline mode to init altField
	*/
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	/* Update any alternate field to synchronise with the main field. */
	$.datepicker._updateAlternate = function(inst) {
		var tp_inst = this._get(inst, 'timepicker');
		if(tp_inst){
			var altField = tp_inst._defaults.altField;
			if (altField) { // update alternate field too
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = '', 
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator, 
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if(!tp_inst._defaults.timeOnly &amp;amp;&amp;amp; !tp_inst._defaults.altFieldTimeOnly &amp;amp;&amp;amp; date !== null){
					if(tp_inst._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime;
					}
					else{
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime;
					}
				}
				$(altField).val(altFormattedDateTime);
			}
		}
		else{
			$.datepicker._base_updateAlternate(inst);
		}
	};

	/*
	* Override key up event to sync manual input changes.
	*/
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst);
				} catch (err) {
					$.timepicker.log(err);
				}
			}
		}

		return $.datepicker._base_doKeyUp(event);
	};

	/*
	* override "Today" button to also grab the time.
	*/
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function(id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		this._base_gotoToday(id);
		var tp_inst = this._get(inst, 'timepicker');
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		$('.ui-datepicker-today', $dp).click();
	};

	/*
	* Disable &amp;amp; enable the Time in the datetimepicker
	*/
	$.datepicker._disableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst);
		}
	};

	$.datepicker._enableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst); // Could be disabled on page load
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create our own set time function
	*/
	$.datepicker._setTime = function(inst, date) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var defaults = tp_inst._defaults;

			// calling _setTime with no date sets time to defaults
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;

			//check if within min/max times.. 
			tp_inst._limitMinMaxDateTime(inst, true);

			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create new public method to set only time, callable as $().datepicker('setTime', date)
	*/
	$.datepicker._setTimeDatepicker = function(target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date == "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec);
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds());
				}
				if (tp_date.toString() == 'Invalid Date') {
					tp_date = undefined;
				}
				this._setTime(inst, tp_date);
			}
		}

	};

	/*
	* override setDate() to allow setting time too within Date object
	*/
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function(target, date) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		if(typeof(date) === 'string'){
			date = new Date(date);
			if(!date.getTime()){
				$.timepicker.log("Error creating Date object from string.");
			}
		}

		var tp_inst = this._get(inst, 'timepicker');
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds());
		} else {
			tp_date = date;
		}
		
		// This is important if you are using the timezone option, javascript's Date 
		// object will only return the timezone offset for the current locale, so we 
		// adjust it accordingly.  If not using timezone option this won't matter..
		// If a timezone is different in tp, keep the timezone as is
		if(tp_inst){
			// look out for DST if tz wasn't specified
			if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
				tp_inst.timezone = tp_date.getTimezoneOffset()*-1;
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone);
		}

		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true);
	};

	/*
	* override getDate() to allow getting time too within Date object
	*/
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function(target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			// if it hasn't yet been defined, grab from field
			if(inst.lastVal === undefined){
				this._setDateFromField(inst, noDefault);
			}

			var date = this._getDate(inst);
			if (date &amp;amp;&amp;amp; tp_inst._parseTime($(target).val(), tp_inst.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);

				// This is important if you are using the timezone option, javascript's Date 
				// object will only return the timezone offset for the current locale, so we 
				// adjust it accordingly.  If not using timezone option this won't matter..
				if(tp_inst.timezone != null){
					// look out for DST if tz wasn't specified
					if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
						tp_inst.timezone = date.getTimezoneOffset()*-1;
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
				}
			}
			return date;
		}
		return this._base_getDateDatepicker(target, noDefault);
	};

	/*
	* override parseDate() because UI 1.8.14 throws an error about "Extra characters"
	* An option in datapicker to ignore extra format characters would be nicer.
	*/
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function(format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings);
		} catch (err) {
			// Hack!  The error message ends with a colon, a space, and
			// the "extra" characters.  We rely on that instead of
			// attempting to perfectly reproduce the parsing algorithm.
			if (err.indexOf(":") &amp;gt;= 0) {
				date = this._base_parseDate(format, value.substring(0,value.length-(err.length-err.indexOf(':')-2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format);
			} else {
				throw err;
			}
		}
		return date;
	};

	/*
	* override formatDate to set date with time to the input
	*/
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function(inst, day, month, year) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val();
		}
		return this._base_formatDate(inst);
	};

	/*
	* override options setter to add time to maxDate(Time) and minDate(Time). MaxDate
	*/
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function(target, name, value) {
		var inst = this._getInst(target),
	        name_clone;
		if (!inst) {
			return null;
		}

		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop;
		    if (typeof name == 'string') { // if min/max was set with the string
		        if (name === 'minDate' || name === 'minDateTime') {
		            min = value;
		        } else if (name === 'maxDate' || name === 'maxDateTime') {
		            max = value;
		        } else if (name === 'onSelect') {
		            onselect = value;
		        } else if (overrides.hasOwnProperty(name)) {
		            if (typeof (value) === 'undefined') {
		                return overrides[name];
		            }
		            fns[name] = value;
		            name_clone = {}; //empty results in exiting function after overrides updated
		        }
		    } else if (typeof name == 'object') { //if min/max was set with the JSON
		        if (name.minDate) {
		            min = name.minDate;
		        } else if (name.minDateTime) {
		            min = name.minDateTime;
		        } else if (name.maxDate) {
		            max = name.maxDate;
		        } else if (name.maxDateTime) {
		            max = name.maxDateTime;
		        }
		        for (prop in overrides) {
		            if (overrides.hasOwnProperty(prop) &amp;amp;&amp;amp; name[prop]) {
		                fns[prop] = name[prop];
		            }
		        }
		    }
		    for (prop in fns) {
		        if (fns.hasOwnProperty(prop)) {
		            overrides[prop] = fns[prop];
		            if (!name_clone) { name_clone = $.extend({}, name);}
		            delete name_clone[prop];
		        }
		    }
		    if (name_clone &amp;amp;&amp;amp; isEmptyObject(name_clone)) { return; }
		    if (min) { //if min was set
		        if (min === 0) {
		            min = new Date();
		        } else {
		            min = new Date(min);
		        }
		        tp_inst._defaults.minDate = min;
		        tp_inst._defaults.minDateTime = min;
		    } else if (max) { //if max was set
		        if (max === 0) {
		            max = new Date();
		        } else {
		            max = new Date(max);
		        }
		        tp_inst._defaults.maxDate = max;
		        tp_inst._defaults.maxDateTime = max;
		    } else if (onselect) {
		        tp_inst._defaults.onSelect = onselect;
		    }
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name);
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
	};
	
	/*
	* jQuery isEmptyObject does not check hasOwnProperty - if someone has added to the object prototype,
	* it will return false for all objects
	*/
	var isEmptyObject = function(obj) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(obj)) {
				return false;
			}
		}
		return true;
	};

	/*
	* jQuery extend now ignores nulls!
	*/
	var extendRemove = function(target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] === null || props[name] === undefined) {
				target[name] = props[name];
			}
		}
		return target;
	};

	/*
	* Determine by the time format which units are supported
	* Returns an object of booleans for each unit
	*/
	var detectSupport = function(timeFormat){
		var tf = timeFormat.replace(/\'.*?\'/g,'').toLowerCase(), // removes literals
			isIn = function(f, t){ // does the format contain the token?
					return f.indexOf(t) !== -1? true:false; 
				};
		return {
				hour: isIn(tf,'h'),
				minute: isIn(tf,'m'),
				second: isIn(tf,'s'),
				millisec: isIn(tf,'l'),
				microsec: isIn(tf,'c'),
				timezone: isIn(tf,'z'),
				ampm: isIn(tf,'t') &amp;amp;&amp;amp; isIn(timeFormat,'h'),
				iso8601: isIn(timeFormat, 'Z')
			};
	};

	/*
	* Converts 24 hour format into 12 hour
	* Returns 12 hour without leading 0
	*/
	var convert24to12 = function(hour) {
		if (hour &amp;gt; 12) {
			hour = hour - 12;
		}

		if (hour === 0) {
			hour = 12;
		}

		return String(hour);
	};

	/*
	* Splits datetime string into date ans time substrings.
	* Throws exception when date can't be parsed
	* Returns [dateString, timeString]
	*/
	var splitDateTime = function(dateFormat, dateTimeString, dateSettings, timeSettings) {
		try {
			// The idea is to get the number separator occurances in datetime and the time format requested (since time has 
			// fewer unknowns, mostly numbers and am/pm). We will use the time pattern to split.
			var separator = timeSettings &amp;amp;&amp;amp; timeSettings.separator ? timeSettings.separator : $.timepicker._defaults.separator,
				format = timeSettings &amp;amp;&amp;amp; timeSettings.timeFormat ? timeSettings.timeFormat : $.timepicker._defaults.timeFormat,
				timeParts = format.split(separator), // how many occurances of separator may be in our format?
				timePartsLen = timeParts.length,
				allParts = dateTimeString.split(separator),
				allPartsLen = allParts.length;

			if (allPartsLen &amp;gt; 1) {
				return [
						allParts.splice(0,allPartsLen-timePartsLen).join(separator),
						allParts.splice(0,timePartsLen).join(separator)
					];
			}

		} catch (err) {
			$.timepicker.log('Could not split the date from the time. Please check the following datetimepicker options' +
					"\nthrown error: " + err +
					"\ndateTimeString" + dateTimeString +
					"\ndateFormat = " + dateFormat +
					"\nseparator = " + timeSettings.separator +
					"\ntimeFormat = " + timeSettings.timeFormat);

			if (err.indexOf(":") &amp;gt;= 0) {
				// Hack!  The error message ends with a colon, a space, and
				// the "extra" characters.  We rely on that instead of
				// attempting to perfectly reproduce the parsing algorithm.
				var dateStringLength = dateTimeString.length - (err.length - err.indexOf(':') - 2),
					timeString = dateTimeString.substring(dateStringLength);

				return [$.trim(dateTimeString.substring(0, dateStringLength)), $.trim(dateTimeString.substring(dateStringLength))];

			} else {
				throw err;
			}
		}
		return [dateTimeString, ''];
	};

	/*
	* Internal function to parse datetime interval
	* Returns: {date: Date, timeObj: Object}, where
	*   date - parsed date without time (type Date)
	*   timeObj = {hour: , minute: , second: , millisec: , microsec: } - parsed time. Optional
	*/
	var parseDateTimeInternal = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var date;
		var splitRes = splitDateTime(dateFormat, dateTimeString, dateSettings, timeSettings);
		date = $.datepicker._base_parseDate(dateFormat, splitRes[0], dateSettings);
		if (splitRes[1] !== '') {
			var timeString = splitRes[1],
				parsedTime = $.datepicker.parseTime(timeFormat, timeString, timeSettings);

			if (parsedTime === null) {
				throw 'Wrong time format';
			}
			return {
				date: date,
				timeObj: parsedTime
			};
		} else {
			return {
				date: date
			};
		}
	};

	/*
	* Internal function to set timezone_select to the local timezone
	*/
	var selectLocalTimezone = function(tp_inst, date) {
		if (tp_inst &amp;amp;&amp;amp; tp_inst.timezone_select) {
			var now = typeof date !== 'undefined' ? date : new Date();
			tp_inst.timezone_select.val(now.getTimezoneOffset()*-1);
		}
	};

	/*
	* Create a Singleton Insance
	*/
	$.timepicker = new Timepicker();

	/**
	 * Get the timezone offset as string from a date object (eg '+0530' for UTC+5.5)
	 * @@param  number if not a number this value is returned
	 * @@param boolean if true formats in accordance to iso8601 "+12:45"
	 * @@return string
	 */
	$.timepicker.timezoneOffsetString = function(tzMinutes, iso8601) {
		if(isNaN(tzMinutes) || tzMinutes &amp;gt; 840){
			return tzMinutes;
		}

		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601? ':':'',
			tz = (off &amp;gt;= 0 ? '+' : '-') + ('0' + (hours * 101).toString()).slice(-2) + iso + ('0' + (minutes * 101).toString()).slice(-2);
		
		if(tz == '+00:00'){
			return 'Z';
		}
		return tz;
	};

	/**
	 * Get the number in minutes that represents a timezone string
	 * @@param  string formated like "+0500", "-1245"
	 * @@return number
	 */
	$.timepicker.timezoneOffsetNumber = function(tzString) {
		tzString = tzString.toString().replace(':',''); // excuse any iso8601, end up with "+1245"

		if(tzString.toUpperCase() === 'Z'){ // if iso8601 with Z, its 0 minute offset
			return 0;
		}

		if(!/^(\-|\+)\d{4}$/.test(tzString)){ // possibly a user defined tz, so just give it back
			return tzString;
		}

		return ((tzString.substr(0,1) =='-'? -1 : 1) * // plus or minus
					((parseInt(tzString.substr(1,2),10)*60) + // hours (converted to minutes)
					parseInt(tzString.substr(3,2),10))); // minutes
	};

	/**
	 * No way to set timezone in js Date, so we must adjust the minutes to compensate. (think setDate, getDate)
	 * @@param  date
	 * @@param  string formated like "+0500", "-1245"
	 * @@return date
	 */
	$.timepicker.timezoneAdjust = function(date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if(!isNaN(toTz)){
			date.setMinutes(date.getMinutes()*1 + (date.getTimezoneOffset()*-1 - toTz*1) );
		}
		return date;
	};

	/**
	 * Calls `timepicker()` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * n.b. The input value must be correctly formatted (reformatting is not supported)
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the timepicker() call
	 * @@return jQuery
	 */
	$.timepicker.timeRange = function(startTime, endTime, options) {
		return $.timepicker.handleRange('timepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datetimepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@return jQuery
	 */
	$.timepicker.datetimeRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datetimepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.dateRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.handleRange = function(method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0, // min allowed interval in milliseconds
			maxInterval: 0, // max allowed interval in milliseconds
			start: {},      // options for start picker
			end: {}         // options for end picker
		}, options);

		$.fn[method].call(startTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), endTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), endTime, 'minDate');
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), startTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), startTime, 'maxDate');
			}
		}, options, options.end));

		checkDates(startTime, endTime);
		selected(startTime, endTime, 'minDate');
		selected(endTime, startTime, 'maxDate');

		function checkDates(changed, other) {
			var startdt = startTime[method]('getDate'),
				enddt = endTime[method]('getDate'),
				changeddt = changed[method]('getDate');

			if(startdt !== null){
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());

				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);

				if(options.minInterval &amp;gt; 0 &amp;amp;&amp;amp; minDate &amp;gt; enddt){ // minInterval check
					endTime[method]('setDate',minDate);
				}
				else if(options.maxInterval &amp;gt; 0 &amp;amp;&amp;amp; maxDate &amp;lt; enddt){ // max interval check
					endTime[method]('setDate',maxDate);
				}
				else if (startdt &amp;gt; enddt) {
					other[method]('setDate',changeddt);
				}
			}
		}

		function selected(changed, other, option) {
			if (!changed.val()) {
				return;
			}
			var date = changed[method].call(changed, 'getDate');
			if(date !== null &amp;amp;&amp;amp; options.minInterval &amp;gt; 0){
				if(option == 'minDate'){
					date.setMilliseconds(date.getMilliseconds() + options.minInterval); 
				}
				if(option == 'maxDate'){
					date.setMilliseconds(date.getMilliseconds() - options.minInterval);
				}
			}
			if (date.getTime) {
				other[method].call(other, 'option', option, date);
			}
		}
		return $([startTime.get(0), endTime.get(0)]);
	};

	/**
	 * Log error or data to the console during error or debugging
	 * @@param  Object err pass any type object to log to the console during error or debugging
	 * @@return void
	 */
	$.timepicker.log = function(err){
		if(window.console){
			console.log(err);
		}
	};

	/*
	* Microsecond support
	*/
	if(!Date.prototype.getMicroseconds){
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function(){ return this.microseconds; };
		Date.prototype.setMicroseconds = function(m){ 
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m/1000));
			this.microseconds = m%1000;
			return this;
		};
	}

	/*
	* Keep up with the version
	*/
	$.timepicker.version = "1.3.1";

})(jQuery);
jQuery.noConflict();
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;datetimepicker-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;e73a652e-09fc-4c71-8e7a-e2525a2d2a99&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
function replaceAllString(oriStr, strTarget, strSubString ){
   var strText = oriStr;
   var intIndexOfMatch = strText.indexOf( strTarget );
   while (intIndexOfMatch != -1){
      strText = strText.replace( strTarget, strSubString )
      intIndexOfMatch = strText.indexOf( strTarget );
   }
   return( strText );
}
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&amp;amp;]" + name + "=([^&amp;amp;#]*)"),
    results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
};


   var jobName= getParameterByName('job')
   var fromDate= getParameterByName('fromDate')
   var toDate= getParameterByName('toDate')
   var limit= getParameterByName('limit')
   var selectedIstIid = getParameterByName('IstIid')

  $("#jobname").ready(function(){
   $("#jobname").text(jobName)
   var convertedJobName = replaceAllString(jobName, ".", "_")
   $("#IstIid" + convertedJobName).ready(function(){
     $("#IstIid" + convertedJobName).css("display","block")
     $("#select_" + convertedJobName).ready(function(){
        $("#select_" + convertedJobName).val(selectedIstIid)
     });
   });
 });

  $("#fromDate").ready(function(){
   $("#from-date").val(fromDate)
 });

  $("#toDate").ready(function(){
   $("#to-date").val(toDate)
 });

  $("#limit").ready(function(){
   if(limit!=""){
    $("#limit").val(limit)
   }
 });
 // Get data with ajax
 function ajax_getData(jobName,fromDate,toDate,limit ){
       var convertedJobName = replaceAllString(jobName, ".", "_")
       var istIid = $("#select_" + convertedJobName).val()
       window.location="/xwiki/bin/view/WiperDog/WebHome?job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid="+istIid;
 			/*$.ajax({
			 type: "GET",
			 url:"/xwiki/bin/get/Sandbox/DescriptionForJob?outputSyntax=plain&amp;amp;job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid"+selectedIstIid,
			 success : function(result){
				$("#jobname").html(jobName)
				$("#display").text('[[]]' + result)
			 }
		   });*/
 }
	$("#treemenu2 a").click(function(){
		 var limit = 10
		 var fromDate=""
		 var toDate = ""
		 jobName= $(this).text()
                 $("#jobname").html(jobName)
                 var convertedJobName = replaceAllString(jobName, ".", "_")
                 $("#listIstIid &amp;gt; div").css("display","none")
                 $("#IstIid" + convertedJobName).css("display","block")
		 //ajax_getData(jobName,fromDate,toDate,limit )

	});

	$("#from-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
		dateFormat: 'yy-mm-dd',
	});
	$("#to-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
			dateFormat: 'yy-mm-dd',

	});
	 $("#get-data").on("click",function(){
		var fromDate = $("#from-date").val()
		var toDate =  $("#to-date").val()
		 if( toDate!= "" ){
			  if(fromDate != ""){
				  if($("#from-date").datepicker( "getDate" ) &amp;gt; $("#to-date").datepicker( "getDate" )){
				  alert("'From date' cannot start later than 'To date'")
				  return false
				  }
			  }
		 }
		 limit = $("#limit").val()
		 ajax_getData(jobName,fromDate,toDate,limit )
	});
$(document).ready(function(){
  var keys = $("#lstkey").text()
  //console.log('key == ' + keys);
  //console.log('livetableJson ==' + $("#livetableJson").text());
  
  var jsonObj = $.parseJSON($("#livetableJson").text()); 
  if(keys &amp;amp;&amp;amp; keys != '[ ]'){
    /** Subtyped **/    
    var newKeys = keys.replace('[',"");
    keys = newKeys.replace(']',"");
    var keyArr = (keys.indexOf(',') != -1)? keys.split(','):new Array(keys);
    //console.log('Key after replace: '+keys)       
    for(var i=0;i&amp;lt;keyArr.length;i++){
        var keyName = keyArr[i].trim().replace('',"").replace("\"","").replace('\"','');
        var subTypeJsonObjStr = jsonObj[keyName].replace('#livetablePager','#livetablePager_'+keyName)
        var subTypeJsonObj = $.parseJSON(subTypeJsonObjStr);
        $("#livetableList_"+keyName).jqGrid(subTypeJsonObj);
        $("#livetableList_"+keyName).jqGrid('navGrid', "#livetablePager_"+keyName, {
           edit : false,
           add : false,
           del : false,
           search:false
         });
    }
    
  }else{ /** Store**/        
      $("#livetableList").jqGrid(jsonObj);
      $("#livetableList").jqGrid('navGrid', "#livetablePager", {
           edit : false,
           add : false,
           del : false,
           search:false
           
       });
   }
});
        
jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;process&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;881686cc-1bfc-456e-b8ab-71334c4a45e5&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){

	$(function () {
		function drawLineChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerline' + container).highcharts({

				chart: {
					type:'line'
				},
				title: {
					text: chart_name
				},
				tooltip :{
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				xAxis: dataXAxis ,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				series: dataSeries
			});
		};

		function drawBarChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerbar' + container).highcharts({
				chart: {
					type: 'column'
				},
				title: {
					text: chart_name
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {

					column: {
						pointPadding: 0.2,
						borderWidth: 0
					}
				},
				series: dataSeries
			});
		}

		function drawAreaChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail
			$('#containerarea' + container).highcharts({
				chart: {
					type: 'area'
				},
				title: {
					text: chart_name
				},
				subtitle: {
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					},
					labels: {
						formatter: function() {
							return this.value / 1000;
						}
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {
					area: {
						stacking: 'normal',
						lineColor: '#666666',
						lineWidth: 1,
						marker: {
							lineWidth: 1,
							lineColor: '#666666'
						}
					}
				},
				series: dataSeries
			});
		};

		function drawPieChart(data, container, chartName){
			var dataPie = data
			$(document).ready(function () {
				// Build the chart
				$('#container' + container).highcharts({
					chart: {
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: chartName
					},
					tooltip: {
						pointFormat: '{series.name}: &amp;lt;b&amp;gt;{point.percentage:.1f}%&amp;lt;/b&amp;gt;'
					},
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							dataLabels: {
								enabled: true,
                                                                color: '#000000',
                                                                connectorColor: '#000000',
                                                                format: '&amp;lt;b&amp;gt;{point.name}&amp;lt;/b&amp;gt;: {point.percentage:.1f} %'
							},
							showInLegend: true
						}
					},
					series: dataPie
				});
			});
		}

		// LINE
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                     if(($("#jsons&amp;gt;#jsonline_" + finalKey)).length &amp;gt; 0) {
					var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonline_" + finalKey).val());
					var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerline_" + finalKey).val());
				        var lstContainer = [];
  				        var data_all = [];
                                        var chartSize = arrayAll.length

                                        for(var i=0;i&amp;lt;chartSize ;i++){
                                           data_all = arrayAll[i]
                                           lstContainer = arrayContainerAll[i]
				           if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					        // data to display on tooltip
					        var data_detail = data_all[0]
					        // draw Line chart
				        	for(var j=0;j&amp;lt;data_all.length;j++){
				        		if(data_all[j].series[0].name == null){
				        			data_all[j].series[0].name = lstContainer[j]
					        	}
                                                        chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					        	drawLineChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					        }
				         }
                                      }
                                  }
				}
			} else {
				var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonline").val());
				var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerline").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length

                                for(var i=0;i&amp;lt;chartSize ;i++){
                                   data_all = arrayAll[i]
                                   lstContainer = arrayContainerAll[i]
				   if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Line chart
					for(var j=0;j&amp;lt;data_all.length;j++){
						if(data_all[j].series[0].name == null){
							data_all[j].series[0].name = lstContainer[j]
						}
                                                chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
						drawLineChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
				   }
                                }
			}
		});

		// BAR
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
			             var finalKey = lstKey[eKey]
                                     if(($("#jsons&amp;gt;#jsonbar_" + finalKey)).length &amp;gt; 0) {
					var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonbar_" + finalKey).val());
					var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerbar_" + finalKey).val());
					var lstContainer = [];
					var data_all = [];
                                        var chartSize = arrayAll.length
					for(var i=0;i&amp;lt;chartSize ;i++){
					    data_all = arrayAll[i]
					    lstContainer = arrayContainerAll[i]
					    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw bar chart
						for(var j=0;j&amp;lt;data_all.length;j++){
							if(data_all[j].series[0].name == null){
								data_all[j].series[0].name = lstContainer[j]
							}
                                                        chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
							drawBarChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
						}
                                            }
					}
                                    }
				}
			} else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonbar").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerbar").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
				    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Bar chart
					for(var j=0;j&amp;lt;data_all.length;j++){
                                            if(data_all[j].series[0].name == null){
						data_all[j].series[0].name = lstContainer[j]
					    }
                                            chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					    drawBarChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
                                    }
				}
			}
		});

		// AREA
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
                        var arrayAll
                        var arrayContainerAll
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                        if(($("#jsons&amp;gt;#jsonarea_" + finalKey)).length &amp;gt; 0) {
                                           arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonarea_" + finalKey).val());
                                           arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerarea_" + finalKey).val());
					   var lstContainer = [];
					   var data_all = [];
                                           var chartSize = arrayAll.length
					   for(var i=0;i&amp;lt;chartSize ;i++){
					       data_all = arrayAll[i]
					       lstContainer = arrayContainerAll[i]
					       if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						   // data to display on tooltip
						   var data_detail = data_all[0]
						   // draw Line chart
						   for(var j=0;j&amp;lt;data_all.length;j++){
						      if(data_all[j].series[0].name == null){
						         data_all[j].series[0].name = lstContainer[j]
						       }
                                                       chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
						       drawAreaChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
						   }
					      }
				           }
                                        }
			          }
                        } else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonarea").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerarea").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
				    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw area chart
					for(var j=0;j&amp;lt;data_all.length;j++){
                                            if(data_all[j].series[0].name == null){
						data_all[j].series[0].name = lstContainer[j]
					    }
                                            chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					    drawAreaChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
                                    }
				}
			}
		});

		// PIE
		$(document ).ready(function(){
                        var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
                        var arrayAll
                        var arrayContainerAll
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                        if(($("#jsons&amp;gt;#jsonpie_" + finalKey)).length &amp;gt; 0) {
                                           arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonpie_" + finalKey).val());
                                           arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerpie_" + finalKey).val());
					   var lstContainer = [];
					   var data_all = [];
                                           var chartSize = arrayAll.length
					  for(var i=0;i&amp;lt;chartSize ;i++){
					       data_all = arrayAll[i]
					       lstContainer = arrayContainerAll[i]
					       if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						   // draw Pie chart
						   for(var j=0;j&amp;lt;data_all.length;j++){
                                                       chartName  = data_all[j].chart_name + "( " + data_all[j].name + " )"
						       drawPieChart([data_all[j]], finalKey + "_" + lstContainer[j], chartName)
						   }
					      }
				           }
                                        }
			          }
			} else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonpie").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerpie").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
                                    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
                                                   for(var j=0;j&amp;lt;data_all.length;j++){
                                                       chartName  = data_all[j].name
console.log(i + "_pie")
						       drawPieChart([data_all[j]], i + "_pie", chartName)
						   }

                                    }
                                }
			}
		});
	});
	jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;d5873d92-b78b-42fc-9407-46d166204b88&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;/* css for timepicker */
.ui-timepicker-div .ui-widget-header { 
margin-bottom: 8px;
 }

.ui-timepicker-div dl { text-align: left; }
.ui-timepicker-div dl dt { height: 25px; margin-bottom: -25px; }
.ui-timepicker-div dl dd { margin: 0 10px 10px 65px; }
.ui-timepicker-div td { font-size: 90%; }
.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }

.ui-timepicker-rtl{ direction: rtl; }
.ui-timepicker-rtl dl { text-align: right; }
.ui-timepicker-rtl dl dd { margin: 0 65px 10px 10px; }
#ui-datepicker-div{
 position:relative;
 width:auto;
 height:auto
}
&lt;/code&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;datetimepicker -css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;1201fb1a-e9c1-4731-8c74-2ea8c0071959&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;.displayblock {
  border:2px solid;
  -webkit-border-radius:6px;
  background:gray;
  float: left;
  width:100%;
}

.displaypie {
  border:1px solid;
  -webkit-border-radius:6px;
  background:gray;
  width: 48%;
  float: left; 
  height: 300px;
}

.subtype {
  margin-top: 50px;
  font-size: 2em;
  color: red;
}&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;content&gt;{{include document="Lib.DataToDrawChart"/}}
{{include document="Lib.MongoDBConnection"/}}
{{velocity}}
$xwiki.jsx.use('Lib.JQueryUILib')
$xwiki.ssx.use('Lib.MenuGenerator')
$xwiki.jsx.use('Lib.MenuGenerator')
$xwiki.ssx.use('Lib.JQueryUILib')
$xwiki.jsx.use('Lib.JqGridLib')
$xwiki.ssx.use('Lib.JqGridLib') 
{{/velocity}}
{{include document="Lib.MenuGenerator"/}}
{{html wiki="true" clean="false"}}
&amp;lt;div id="viewer"&amp;gt;
&amp;lt;table style="text-align:left"  &amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th &amp;gt;Job name&amp;lt;/th&amp;gt;
  &amp;lt;td colspan=3&amp;gt;&amp;lt;div id="jobname"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
{{groovy}}
import org.xwiki.context.*

def ec = services.component.getInstance(Execution.class).getContext()
def mapJobIstIid = ec.getProperty("mapJobIstIid")

println '{{html clean="false" wiki="false"}}'
println '&amp;lt;tr&amp;gt;'
println '&amp;lt;th&amp;gt;IstIid&amp;lt;/th&amp;gt;'
println '&amp;lt;td colspan=3&amp;gt;'
mapJobIstIid.each{jobEntry-&amp;gt;
  def convertedJobKey = jobEntry.key.replaceAll("\\.","_")
  println "&amp;lt;div id='listIstIid'&amp;gt;"
  println "&amp;lt;div id=IstIid${convertedJobKey} style='display:none'&amp;gt;"
  println "&amp;lt;select id=select_${convertedJobKey}&amp;gt;"
  jobEntry.value.each{
     println "&amp;lt;option value=\"$it\"&amp;gt;$it&amp;lt;/option&amp;gt;"
  }
  println "&amp;lt;/select&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
}
println '&amp;lt;/td&amp;gt;'
println '&amp;lt;/tr&amp;gt;'
println '{{/html}}'
{{/groovy}}
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data monitor from&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="from-date" id="from-date"/&amp;gt;&amp;lt;/td&amp;gt;
  &amp;lt;th&amp;gt;Data monitor to&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="to-date" id="to-date"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data records limit &amp;lt;/th&amp;gt;
  &amp;lt;td &amp;gt;
     &amp;lt;select id="limit"&amp;gt;
       &amp;lt;option value=5&amp;gt;5&amp;lt;/option&amp;gt;
       &amp;lt;option value=10&amp;gt;10&amp;lt;/option&amp;gt;
       &amp;lt;option value=15&amp;gt;15&amp;lt;/option&amp;gt;
       &amp;lt;option value=20&amp;gt;20&amp;lt;/option&amp;gt;
     &amp;lt;/select&amp;gt;
  &amp;lt;/td&amp;gt;
  &amp;lt;td colspan=3 &amp;gt;&amp;lt;input type="button" value="View Data" id="get-data" class="button"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;&amp;lt;div id="display"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
  &amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
&amp;lt;/table&amp;gt;

&amp;lt;/div&amp;gt; 
   
 &amp;lt;/body&amp;gt;

{{/html}}
{{groovy}}
import groovy.json.*
xwiki.jsx.use("Lib.Highcharts")

if(request.xpage == "plain") {
	response.setContentType('text/plain')
}

def listData = []
def job = request.get("job")
def fromDate = request.get("fromDate")
def toDate = request.get("toDate")
def limit= (request.get("limit")!=null)?request.get("limit").toInteger():10
def istIid = request.get("IstIid")

def str= "No data to retrieved !"
def result = null
if(job != "" &amp;amp;&amp;amp; job != null &amp;amp;&amp;amp; istIid != null &amp;amp;&amp;amp; istIid != ""){
	MongoDBConnection.getConnection()
	if(fromDate != "" || toDate != ""){
		result = MongoDBConnection.getDataInPeriod(job,fromDate,toDate,limit,istIid)
	} else {
		result = MongoDBConnection.getDataAllFields(job,limit,istIid)
        }
MongoDBConnection.closeConnection()
} else {
   println "{{warning}}There are no selected job or IstIid{{/warning}}"
}
def listKey = []
if( (result != null) &amp;amp;&amp;amp; (result.size() &amp;gt; 0) &amp;amp;&amp;amp; (result[0].KEYEXPR != null)&amp;amp;&amp;amp;!(result[0].KEYEXPR instanceof List )){

if(result[0].type == "Subtyped") {
    println '{{html clean="false" wiki="true"}}'
    //println '&amp;lt;body&amp;gt;'
    def dataSubtype = DataToDrawChart.getDataToDrawSubtype(result)
    dataSubtype.each {key,value -&amp;gt;
        listKey.add(key)
    }
    def jsonkey = com.mongodb.util.JSON.serialize(listKey)
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$jsonkey&amp;lt;/textarea&amp;gt;"

    dataSubtype.each {key,value -&amp;gt;
            def dataLine = []
            def dataBar = []
            def dataPie = []
            def dataArea = []
            if(DataToDrawChart.getDataToDrawLine(value) != []) {
                dataLine = DataToDrawChart.getDataToDrawLine(value)
            }
            if(DataToDrawChart.getDataToDrawBar(value) != []) {
                dataBar = DataToDrawChart.getDataToDrawBar(value)
            }
            if(DataToDrawChart.getDataToDrawPie(value) != []) {
                dataPie = DataToDrawChart.getDataToDrawPie(value)
            }
            if(DataToDrawChart.getDataToDrawArea(value) != []) {
                dataArea = DataToDrawChart.getDataToDrawArea(value)
            }

		def chartColumnsLine = []
		def chartColumnsBar = []
		def chartColumnsArea = []
		def lstName

                dataLine.each {itemDataLine -&amp;gt;
                    if(itemDataLine.size() &amp;gt; 0 ){
		        chartColumnsLine.add(itemDataLine[0].chart_columns)
	            }
                }
                dataBar.each {itemDataBar -&amp;gt;
                    if(itemDataBar.size() &amp;gt; 0 ){
		        chartColumnsBar.add(itemDataBar[0].chart_columns)
	            }
                }
                dataArea.each {itemDataArea -&amp;gt;
                    if(itemDataArea.size() &amp;gt; 0 ){
		        chartColumnsArea.add(itemDataArea[0].chart_columns)
	            }
                }

		if(dataPie.size() &amp;gt; 0 ){
			lstName = dataPie['name']
		}
		def tmpListNameContainer = []
                
		if(lstName != null) {
                        def chartNumPie = 0
                        def tmpLst
                        for(def nameContainer in lstName){
                           tmpLst = []
			   for(def nameContainerItem in nameContainer ){
				nameContainerItem = chartNumPie + "_" + nameContainerItem.replaceAll("\\.", "_")
				tmpLst.add(nameContainerItem )
		            }
                            tmpListNameContainer.add(tmpLst)
                            chartNumPie++
                         }
		}
		def jsonPie
		def jsonLine
		def jsonBar
		def jsonArea
		if(dataPie != []) {
		    jsonPie = com.mongodb.util.JSON.serialize(dataPie)
		}
		if(dataLine != []) {
		    jsonLine = com.mongodb.util.JSON.serialize(dataLine)
		}
		if(dataBar != []) {
		    jsonBar = com.mongodb.util.JSON.serialize(dataBar)
		}
		if(dataArea != []) {
		    jsonArea = com.mongodb.util.JSON.serialize(dataArea)
		}
		def jsonContainerPie
		if(tmpListNameContainer != []) {
			jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
		}
		def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
		def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
		def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

		println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
		if(jsonLine != null) {
			println "&amp;lt;textarea id=\"jsonline_$key\" &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class=\"lstcontainerline_$key\" &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
		}
		if(jsonBar != null) {
			println "&amp;lt;textarea id=\"jsonbar_$key\"&amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerbar_$key' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
		}
		if(jsonPie != null &amp;amp;&amp;amp; jsonContainerPie != null) {
			println "&amp;lt;textarea id=\"jsonpie_$key\" &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerpie_$key' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
		}
		if(jsonArea != null) {
			println "&amp;lt;textarea id=\"jsonarea_$key\" &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerarea_$key' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
		}

        println "&amp;lt;/div&amp;gt;"
        def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
        def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
          
        println "&amp;lt;div style='clear:both'&amp;gt;"
            def description = value.KEYEXPR._description[0][key]
            if(description != null) {
                println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +': ' + description +'&amp;lt;/div&amp;gt;'
            } else {
                println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +'&amp;lt;/div&amp;gt;'
            }
            println "-----"
            if(jsonPie != null) {
          println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
	  chartNumPie = 0
          lstName.each{chartPieLst -&amp;gt;
		chartPieLst.each {
	            def tmp = chartNumPie + "_" + it.replaceAll("\\.", "_")
		    println " &amp;lt;div class=\"displaypie\" id=\"container${key}_${tmp}\" &amp;gt;&amp;lt;/div&amp;gt;"
          	}
		chartNumPie++
	  }	
          println "&amp;lt;/div&amp;gt;"
            }
            if(jsonLine != null) {
          	def chartLineComment = false
		def chartNumLine = 0
          	chartColumnsLine.each{chartColumnsLineItem -&amp;gt;
            		if(!chartLineComment){
               			println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
               			chartLineComment = true  
            		}
		chartColumnsLineItem.each{
              		println " &amp;lt;div class=\"displayblock\" id=\"containerline${key}_${chartNumLine}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          	}
		chartNumLine ++
	    }
          println "&amp;lt;/div&amp;gt;"
            }
            println "&amp;amp;nbsp;"

            if(jsonBar != null) {
          	def chartBarComment = false
  		def chartNumBar = 0
          	chartColumnsBar.each{chartColumnsBarItem -&amp;gt;
             		if(!chartBarComment){
                		println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
                		chartBarComment = true
              		}  
			chartColumnsBarItem.each{
             			println " &amp;lt;div class=\"displayblock\" id=\"containerbar${key}_${chartNumBar}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          		}
			chartNumBar++
		}
          	println "&amp;lt;/div&amp;gt;"
            }
            println "&amp;amp;nbsp;"

            if(jsonArea != null) {
          	def chartAreaComment = false
		def chartNumArea = 0
          	chartColumnsArea.each{chartColumnsAreaItem -&amp;gt;
          		if(!chartAreaComment){
            			println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
            			chartAreaComment = true
          		}
			chartColumnsAreaItem.each{
            			println " &amp;lt;div class=\"displayblock\" id=\"containerarea${key}_${chartNumArea}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          		}
          		chartNumArea++
            	}
        	println "&amp;lt;/div&amp;gt;"
	    }
        /** Statistic data table **/
        println "&amp;lt;center&amp;gt;"        
        println "&amp;lt;div id='livetblContent_"+key+"' style='width:100%;clear:both;align:middle;margin-top:10px'&amp;gt;"   
        println "Statistics data for "+key
        println "&amp;lt;table id='livetableList_"+key+"' style='width:100%;align:center'&amp;gt;&amp;lt;/table&amp;gt;"
        println "&amp;lt;div id='livetablePager_"+key+"' style='position:relative;width:100%'&amp;gt;&amp;lt;/div&amp;gt;"
        println "&amp;lt;/div&amp;gt;"
        println "&amp;lt;/center&amp;gt;"
        println "&amp;lt;script language='javascript'&amp;gt;console.log('Create live table for "+key+"');&amp;lt;/script&amp;gt;"
    }
    //println '&amp;lt;/body&amp;gt;'
    println '{{/html}}'
} else if(result[0].type == "Store") {
	// data store
	def dataLine = DataToDrawChart.getDataToDrawLine(result)
	def dataBar = DataToDrawChart.getDataToDrawBar(result)
	def dataPie = DataToDrawChart.getDataToDrawPie(result)
	def dataArea = DataToDrawChart.getDataToDrawArea(result)
	def chartColumnsLine = []
	def chartColumnsBar = []
	def chartColumnsArea = []
	def lstName

        dataLine.each {itemDataLine -&amp;gt;
            if(itemDataLine.size() &amp;gt; 0 ){
		chartColumnsLine.add(itemDataLine[0].chart_columns)
	    }
        }

        dataBar.each {itemDataBar -&amp;gt;
            if(itemDataBar.size() &amp;gt; 0 ){
		chartColumnsBar.add(itemDataBar[0].chart_columns)
	    }
        }

        dataArea.each {itemDataArea -&amp;gt;
            if(itemDataArea.size() &amp;gt; 0 ){
		chartColumnsArea.add(itemDataArea[0].chart_columns)
	    }
        }

	if(dataPie.size() &amp;gt; 0 ){
		lstName = dataPie['name']
	}

    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
  
    def tmpListNameContainer = []
    def chartNumPie = 0
    for(def nameContainer in lstName){
       for(def nameContainerItem in nameContainer ){
           nameContainerItem = chartNumPie + "_" + nameContainerItem.replaceAll("\\.", "_")
           tmpListNameContainer .add(nameContainerItem )
       }
    }
    
    def jsonPie = com.mongodb.util.JSON.serialize(dataPie)
    def jsonLine = com.mongodb.util.JSON.serialize(dataLine)
    def jsonBar = com.mongodb.util.JSON.serialize(dataBar)
    def jsonArea = com.mongodb.util.JSON.serialize(dataArea)

    def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
    def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
    def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
    def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

    def listEmpty = com.mongodb.util.JSON.serialize([])
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$listEmpty&amp;lt;/textarea&amp;gt;" 

    println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
    println "&amp;lt;textarea class='jsonline' &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonbar' &amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonpie' &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonarea' &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"

    println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;/div&amp;gt;"

    def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
    def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
  
    println "&amp;lt;div style='clear:both'&amp;gt;"
  
    def chartPieComment = false
    chartNumPie = 0
    lstName.each{chartPieLst-&amp;gt;
        if(!chartPieComment) {
            println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
            chartPieComment = true
        }
        chartPieLst.each {
            def tmp = chartNumPie + "_pie"
            println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
            chartNumPie++
        }
    }
    println "&amp;lt;/div&amp;gt;"
    	def chartLineComment = false
	def chartNum = 0
    	chartColumnsLine.each{chartColumnsLineItem -&amp;gt;
	    	if(!chartLineComment){
	        	println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	        	chartLineComment = true  
	    	}
		chartColumnsLineItem.each{
	    		println " &amp;lt;div class=\"displayblock\" id=\"containerline${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	    	}
		chartNum++
	}	
    	println "&amp;lt;/div&amp;gt;"
    	println "&amp;amp;nbsp;"
    	def chartBarComment = false
	chartNum = 0
    	chartColumnsBar.each{chartColumnsBarItem -&amp;gt;
	        if(!chartBarComment){
	            println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	            chartBarComment = true
	        }  
		chartColumnsBarItem.each{
	    		println " &amp;lt;div class=\"displayblock\" id=\"containerbar${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  	}
		chartNum++
	}
  println "&amp;lt;/div&amp;gt;"
  println "&amp;amp;nbsp;"
  	def chartAreaComment = false
	chartNum = 0
  	chartColumnsArea.each{chartColumnsAreaItem -&amp;gt;
	  	if(!chartAreaComment){
	    		println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	    		chartAreaComment = true
	  	}
		chartColumnsAreaItem.each{
    			println " &amp;lt;div class=\"displayblock\" id=\"containerarea${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
		}
		chartNum++
  	}
  println "&amp;lt;/div&amp;gt;"
println "&amp;lt;/div&amp;gt;"

//println '&amp;lt;/body&amp;gt;'
println '{{/html}}'
}
}else{
    println 'There is no data for this job with criterias'
}
//--=============== Start build for livetable
def subTypeURLMap = [:]
def dataModel = []
def dataUrl = ""
result.find{rec-&amp;gt;				
    def subtractData = []
    
    //-- Parsing data and assign data to subtract list
    if(rec.type == "Store"){ //-- Store data type
        subtractData = rec['data']        
        subtractData.each{r2-&amp;gt;					
            if(dataModel != null &amp;amp;&amp;amp; dataModel.size() &amp;lt;=0){ 
                dataModel.add("Fetch At")
                dataModel.addAll(r2.keySet());					
            } 
        }        
        dataUrl = "/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job="+job +"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate + "&amp;amp;toDate=" + toDate + "&amp;amp;istIid="+istIid        
        //-- Building data model				
        def model = []
        def colSpec
        dataModel.each{name-&amp;gt;
            colSpec = [:]
            colSpec['name'] = name
            colSpec['index'] = name
            colSpec['width'] = "100"
            model.add(colSpec)
        }
        def dataModelStr = (new JsonBuilder(dataModel)).toPrettyString()
        def modelStr = (new JsonBuilder(model)).toPrettyString() 
        str = 
        "{\"url\":\""+dataUrl+"\",\"datatype\":\"json\","+
            "\"colNames\":"+ dataModelStr +
            ",\"colModel\":"+ modelStr +" ,\"rowList\":[10,20,30],"+
            "\"pager\":\"#livetablePager\", \"viewrecords\": true, \"sortname\": \"RECORD_SEQ\","+
            "\"sortorder\": \"asc\", \"caption\":\""+job+"\"}"
        println "{{html clean=\"false\" wiki=\"true\"}}"
        println "&amp;lt;div id='livetableJson' style = \"display:none\"&amp;gt;"
        //println "&amp;lt;div id='livetableJson'&amp;gt;"
        println str;
        println "&amp;lt;/div&amp;gt;"
        println "{{/html}}"
    }else{ //-- Subtype			
        def subData = rec['data']
        subData.each{key,value-&amp;gt;
            dataUrl = "/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job="+job +"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate + "&amp;amp;toDate=" + toDate + "&amp;amp;istIid="+istIid+"&amp;amp;subType="+key
            subtractData = value
            subtractData.each{r2-&amp;gt;					
                if(dataModel != null &amp;amp;&amp;amp; dataModel.size() &amp;lt;=0){ 
                    dataModel.add("Fetch At")
                    dataModel.addAll(r2.keySet());					
                } 			
            }
            //-- Building data model				
            def model = []
            def colSpec
            dataModel.each{name-&amp;gt;
                colSpec = [:]
                colSpec['name'] = name
                colSpec['index'] = name
                colSpec['width'] = "100"
                model.add(colSpec)
            }
            def dataModelStr = (new JsonBuilder(dataModel)).toPrettyString()
            def modelStr = (new JsonBuilder(model)).toPrettyString() 
            str = 
            "{\"url\":\""+dataUrl+"\",\"datatype\":\"json\","+
                "\"colNames\":"+ dataModelStr +
                ",\"colModel\":"+ modelStr +" ,\"rowList\":[10,20,30],"+
                "\"pager\":\"#livetablePager\", \"viewrecords\": true, \"sortname\": \"RECORD_SEQ\","+
                "\"sortorder\": \"asc\", \"caption\":\""+job+"\"}"
            subTypeURLMap[key] = str
        }
        def finalStr = (new JsonBuilder(subTypeURLMap)).toPrettyString()
        println "{{html clean=\"false\" wiki=\"true\"}}"
        println "&amp;lt;div id='livetableJson' style = \"display:none\"&amp;gt;"
        //println "&amp;lt;div id='livetableJson'&amp;gt;"
        println finalStr;
        println "&amp;lt;/div&amp;gt;"
        println "{{/html}}"
    }
    return true
}
 //--=============== END

if(listKey.size() &amp;lt;= 0){   
    println "{{html clean=\"false\" wiki=\"true\"}}"
    println "&amp;lt;center&amp;gt;"
    println "&amp;lt;div id=\"livetblContent\" style=\"width:100%;clear:both;align:middle;margin-top:10px\"&amp;gt;"   
    println "Statistics Data"
    println "&amp;lt;table id=\"livetableList\" style=\"width:100%;align:center\"&amp;gt;&amp;lt;/table&amp;gt;"    
    println "&amp;lt;div id=\"livetablePager\"&amp;gt;&amp;lt;/div&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
    println "&amp;lt;/center&amp;gt;"
    
    println "&amp;lt;div id=\"testDiv\"&amp;gt;&amp;amp;nbsp;&amp;lt;/div&amp;gt;"
    println "{{/html}}"
}
{{/groovy}}
&lt;/content&gt;&lt;/xwikidoc&gt;@


61.52
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376568375000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;61.52&lt;/version&gt;
d2963 1
@


61.51
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376568337000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;61.51&lt;/version&gt;
d2963 1
a2963 1
						       drawPieChart([data_all[j]], i + "_pie_", chartName)
@


61.50
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376568276000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376568255000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.50&lt;/version&gt;
d3587 1
a3588 1
        chartNumPie++
@


61.49
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376568255000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;61.49&lt;/version&gt;
d2963 1
a2963 1
						       drawPieChart([data_all[j]], j + "_pie_", chartName)
@


61.48
log
@@
text
@&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xwikidoc&gt;
&lt;web&gt;WiperDog&lt;/web&gt;
&lt;name&gt;WebHome&lt;/name&gt;
&lt;language&gt;&lt;/language&gt;
&lt;defaultLanguage&gt;en&lt;/defaultLanguage&gt;
&lt;translation&gt;0&lt;/translation&gt;
&lt;parent&gt;&lt;/parent&gt;
&lt;creator&gt;XWiki.Admin&lt;/creator&gt;
&lt;author&gt;XWiki.Admin&lt;/author&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;contentAuthor&gt;XWiki.Admin&lt;/contentAuthor&gt;
&lt;creationDate&gt;1376364375000&lt;/creationDate&gt;
&lt;date&gt;1376568175000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376560922000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.48&lt;/version&gt;
&lt;title&gt;WiperDog&lt;/title&gt;
&lt;defaultTemplate&gt;&lt;/defaultTemplate&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;comment&gt;&lt;/comment&gt;
&lt;minorEdit&gt;true&lt;/minorEdit&gt;
&lt;syntaxId&gt;xwiki/2.1&lt;/syntaxId&gt;
&lt;hidden&gt;false&lt;/hidden&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;047293a8-524d-45e4-af52-cd944523d5d0&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
/*
 * jQuery timepicker addon
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 1.3.1
 * Last Modified: 07/07/2013
 *
 * Copyright 2013 Trent Richardson
 * You may use this project under MIT or GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 */

/*jslint evil: true, white: false, undef: false, nomen: false */

(function($) {

	/*
	* Lets not redefine timepicker, Prevent "Uncaught RangeError: Maximum call stack size exceeded"
	*/
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return;
	}

	/*
	* Extend jQueryUI, get it started with our version number
	*/
	$.extend($.ui, {
		timepicker: {
			version: "1.3.1"
		}
	});

	/* 
	* Timepicker manager.
	* Use the singleton instance of this class, $.timepicker, to interact with the time picker.
	* Settings for (groups of) time pickers are maintained in an instance object,
	* allowing multiple different settings on the same page.
	*/
	var Timepicker = function() {
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[''] = { // Default regional settings
			currentText: 'Now',
			closeText: 'Done',
			amNames: ['AM', 'A'],
			pmNames: ['PM', 'P'],
			timeFormat: 'HH:mm',
			timeSuffix: '',
			timeOnlyTitle: 'Choose Time',
			timeText: 'Time',
			hourText: 'Hour',
			minuteText: 'Minute',
			secondText: 'Second',
			millisecText: 'Millisecond',
			microsecText: 'Microsecond',
			timezoneText: 'Time Zone',
			isRTL: false
		};
		this._defaults = { // Global defaults for all the datetime picker instances
			showButtonPanel: true,
			timeOnly: false,
			showHour: null,
			showMinute: null,
			showSecond: null,
			showMillisec: null,
			showMicrosec: null,
			showTimezone: null,
			showTime: true,
			stepHour: 1,
			stepMinute: 1,
			stepSecond: 1,
			stepMillisec: 1,
			stepMicrosec: 1,
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null,
			hourMin: 0,
			minuteMin: 0,
			secondMin: 0,
			millisecMin: 0,
			microsecMin: 0,
			hourMax: 23,
			minuteMax: 59,
			secondMax: 59,
			millisecMax: 999,
			microsecMax: 999,
			minDateTime: null,
			maxDateTime: null,
			onSelect: null,
			hourGrid: 0,
			minuteGrid: 0,
			secondGrid: 0,
			millisecGrid: 0,
			microsecGrid: 0,
			alwaysSetTime: true,
			separator: ' ',
			altFieldTimeOnly: true,
			altTimeFormat: null,
			altSeparator: null,
			altTimeSuffix: null,
			pickerTimeFormat: null,
			pickerTimeSuffix: null,
			showTimepicker: true,
			timezoneList: null,
			addSliderAccess: false,
			sliderAccessArgs: null,
			controlType: 'slider',
			defaultValue: null,
			parse: 'strict'
		};
		$.extend(this._defaults, this.regional['']);
	};

	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: '',
		formattedDate: '',
		formattedTime: '',
		formattedDateTime: '',
		timezoneList: null,
		units: ['hour','minute','second','millisec', 'microsec'],
		support: {},
		control: null,

		/* 
		* Override the default settings for all instances of the time picker.
		* @@param  settings  object - the new settings to use as defaults (anonymous object)
		* @@return the manager object
		*/
		setDefaults: function(settings) {
			extendRemove(this._defaults, settings || {});
			return this;
		},

		/*
		* Create a new Timepicker instance
		*/
		_newInst: function($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
            	fns = {},
		    	overrides, i;

			for (var attrName in this._defaults) {
				if(this._defaults.hasOwnProperty(attrName)){
					var attrValue = $input.attr('time:' + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue);
						} catch (err) {
							inlineSettings[attrName] = attrValue;
						}
					}
				}
			}

		    overrides = {
		        beforeShow: function (input, dp_inst) {
		            if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
		                return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst);
		            }
		        },
		        onChangeMonthYear: function (year, month, dp_inst) {
		            // Update the time as well : this prevents the time from disappearing from the $input field.
		            tp_inst._updateDateTime(dp_inst);
		            if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
		                tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst);
		            }
		        },
		        onClose: function (dateText, dp_inst) {
		            if (tp_inst.timeDefined === true &amp;amp;&amp;amp; $input.val() !== '') {
		                tp_inst._updateDateTime(dp_inst);
		            }
		            if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
		                tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst);
		            }
		        }
		    };
		    for (i in overrides) {
		        if (overrides.hasOwnProperty(i)) {
		            fns[i] = opts[i] || null;
		        }
		    }

		    tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
		        evnts:fns,
		        timepicker: tp_inst // add timepicker as a property of datepicker: $.datepicker._get(dp_inst, 'timepicker');
		    });
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function(val) {
				return val.toUpperCase();
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function(val) {
				return val.toUpperCase();
			});

			// detect which units are supported
			tp_inst.support = detectSupport(
					tp_inst._defaults.timeFormat + 
					(tp_inst._defaults.pickerTimeFormat? tp_inst._defaults.pickerTimeFormat:'') + 
					(tp_inst._defaults.altTimeFormat? tp_inst._defaults.altTimeFormat:''));

			// controlType is string - key to our this._controls
			if(typeof(tp_inst._defaults.controlType) === 'string'){
				if(tp_inst._defaults.controlType == 'slider' &amp;amp;&amp;amp; typeof(jQuery.ui.slider) === 'undefined'){
					tp_inst._defaults.controlType = 'select';
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType];
			}
			// controlType is an object and must implement create, options, value methods
			else{ 
				tp_inst.control = tp_inst._defaults.controlType;
			}

			// prep the timezone options
			var timezoneList = [-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,
					0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList;
			}
			var tzl=timezoneList.length,tzi=0,tzv=null;
			if (tzl &amp;gt; 0 &amp;amp;&amp;amp; typeof timezoneList[0] !== 'object') {
				for(; tzi&amp;lt;tzl; tzi++){
					tzv = timezoneList[tzi];
					timezoneList[tzi] = { value: tzv, label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601) };
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;

			// set the default units
			tp_inst.timezone = tp_inst._defaults.timezone !== null? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) : 
							((new Date()).getTimezoneOffset()*-1);
			tp_inst.hour = tp_inst._defaults.hour &amp;lt; tp_inst._defaults.hourMin? tp_inst._defaults.hourMin : 
							tp_inst._defaults.hour &amp;gt; tp_inst._defaults.hourMax? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute &amp;lt; tp_inst._defaults.minuteMin? tp_inst._defaults.minuteMin : 
							tp_inst._defaults.minute &amp;gt; tp_inst._defaults.minuteMax? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second &amp;lt; tp_inst._defaults.secondMin? tp_inst._defaults.secondMin : 
							tp_inst._defaults.second &amp;gt; tp_inst._defaults.secondMax? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec &amp;lt; tp_inst._defaults.millisecMin? tp_inst._defaults.millisecMin : 
							tp_inst._defaults.millisec &amp;gt; tp_inst._defaults.millisecMax? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec &amp;lt; tp_inst._defaults.microsecMin? tp_inst._defaults.microsecMin : 
							tp_inst._defaults.microsec &amp;gt; tp_inst._defaults.microsecMax? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = '';
			tp_inst.$input = $input;

			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField).css({
					cursor: 'pointer'
				}).focus(function() {
					$input.trigger("focus");
				});
			}

			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date();
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date();
			}

			// datepicker needs minDate/maxDate, timepicker needs minDateTime/maxDateTime..
			if (tp_inst._defaults.minDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime());
			}
			if (tp_inst._defaults.minDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime());
			}
			if (tp_inst._defaults.maxDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime());
			}
			if (tp_inst._defaults.maxDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime());
			}
			tp_inst.$input.bind('focus', function() {
				tp_inst._onFocus();
			});

			return tp_inst;
		},

		/*
		* add our sliders to the calendar
		*/
		_addTimePicker: function(dp_inst) {
			var currDT = (this.$altInput &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly) ? this.$input.val() + ' ' + this.$altInput.val() : this.$input.val();

			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
		},

		/*
		* parse the time string from input value or _setTime
		*/
		_parseTime: function(timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0]);
			}

			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, 'dateFormat');
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false;
					}
					$.extend(this, parseRes.timeObj);
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err +
									"\ndate/time string = " + timeString +
									"\ntimeFormat = " + this._defaults.timeFormat +
									"\ndateFormat = " + dp_dateFormat);
					return false;
				}
				return true;
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false;
				}
				$.extend(this, timeObj);
				return true;
			}
		},

		/*
		* generate and inject html for timepicker into ui datepicker
		*/
		_injectTimePicker: function() {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = '',
				uitem = '',
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i=0,
				l=0;

			// Prevent displaying twice
			if ($dp.find("div.ui-timepicker-div").length === 0 &amp;amp;&amp;amp; o.showTimepicker) {
				var noDisplay = ' style="display:none;"',
					html = '&amp;lt;div class="ui-timepicker-div'+ (o.isRTL? ' ui-timepicker-rtl' : '') +'"&amp;gt;&amp;lt;dl&amp;gt;' + '&amp;lt;dt class="ui_tpicker_time_label"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;' + o.timeText + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_time"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the markup
				for(i=0,l=this.units.length; i&amp;lt;l; i++){
					litem = this.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// Added by Peter Medeiros:
					// - Figure out what the hour/minute/second max should be based on the step values.
					// - Example: if stepMinute is 15, then minMax is 45.
					max[litem] = parseInt((o[litem+'Max'] - ((o[litem+'Max'] - o[litem+'Min']) % o['step'+uitem])), 10);
					gridSize[litem] = 0;

					html += '&amp;lt;dt class="ui_tpicker_'+ litem +'_label"' + (show ? '' : noDisplay) + '&amp;gt;' + o[litem +'Text'] + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_'+ litem +'"&amp;gt;&amp;lt;div class="ui_tpicker_'+ litem +'_slider"' + (show ? '' : noDisplay) + '&amp;gt;&amp;lt;/div&amp;gt;';

					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						html += '&amp;lt;div style="padding-left: 1px"&amp;gt;&amp;lt;table class="ui-tpicker-grid-label"&amp;gt;&amp;lt;tr&amp;gt;';

						if(litem == 'hour'){
							for (var h = o[litem+'Min']; h &amp;lt;= max[litem]; h += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm? 'hht':'HH', {hour:h}, o);									
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + tmph + '&amp;lt;/td&amp;gt;';
							}
						}
						else{
							for (var m = o[litem+'Min']; m &amp;lt;= max[litem]; m += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + ((m &amp;lt; 10) ? '0' : '') + m + '&amp;lt;/td&amp;gt;';
							}
						}

						html += '&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;&amp;lt;/div&amp;gt;';
					}
					html += '&amp;lt;/dd&amp;gt;';
				}
				
				// Timezone
				var showTz = o.showTimezone !== null? o.showTimezone : this.support.timezone;
				html += '&amp;lt;dt class="ui_tpicker_timezone_label"' + (showTz ? '' : noDisplay) + '&amp;gt;' + o.timezoneText + '&amp;lt;/dt&amp;gt;';
				html += '&amp;lt;dd class="ui_tpicker_timezone" ' + (showTz ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the elements from string
				html += '&amp;lt;/dl&amp;gt;&amp;lt;/div&amp;gt;';
				var $tp = $(html);

				// if we only want time picker...
				if (o.timeOnly === true) {
					$tp.prepend('&amp;lt;div class="ui-widget-header ui-helper-clearfix ui-corner-all"&amp;gt;' + '&amp;lt;div class="ui-datepicker-title"&amp;gt;' + o.timeOnlyTitle + '&amp;lt;/div&amp;gt;' + '&amp;lt;/div&amp;gt;');
					$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();
				}
				
				// add sliders, adjust grids, add events
				for(i=0,l=tp_inst.units.length; i&amp;lt;l; i++){
					litem = tp_inst.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// add the slider
					tp_inst[litem+'_slider'] = tp_inst.control.create(tp_inst, $tp.find('.ui_tpicker_'+litem+'_slider'), litem, tp_inst[litem], o[litem+'Min'], max[litem], o['step'+uitem]);

					// adjust the grid and add click event
					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						size = 100 * gridSize[litem] * o[litem+'Grid'] / (max[litem] - o[litem+'Min']);
						$tp.find('.ui_tpicker_'+litem+' table').css({
							width: size + "%",
							marginLeft: o.isRTL? '0' : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL? ((size / (-2 * gridSize[litem])) + "%") : '0',
							borderCollapse: 'collapse'
						}).find("td").click(function(e){
								var $t = $(this),
									h = $t.html(),
									n = parseInt(h.replace(/[^0-9]/g),10),
									ap = h.replace(/[^apm]/ig),
									f = $t.data('for'); // loses scope, so we use data-for

								if(f == 'hour'){
									if(ap.indexOf('p') !== -1 &amp;amp;&amp;amp; n &amp;lt; 12){
										n += 12;
									}
									else{
										if(ap.indexOf('a') !== -1 &amp;amp;&amp;amp; n === 12){
											n = 0;
										}
									}
								}
								
								tp_inst.control.value(tp_inst, tp_inst[f+'_slider'], litem, n);

								tp_inst._onTimeChange();
								tp_inst._onSelectHandler();
							}).css({
								cursor: 'pointer',
								width: (100 / gridSize[litem]) + '%',
								textAlign: 'center',
								overflow: 'hidden'
							});
					} // end if grid &amp;gt; 0
				} // end for loop

				// Add timezone options
				this.timezone_select = $tp.find('.ui_tpicker_timezone').append('&amp;lt;select&amp;gt;&amp;lt;/select&amp;gt;').find("select");
				$.fn.append.apply(this.timezone_select,
				$.map(o.timezoneList, function(val, idx) {
					return $("&amp;lt;option /&amp;gt;").val(typeof val == "object" ? val.value : val).text(typeof val == "object" ? val.label : val);
				}));
				if (typeof(this.timezone) != "undefined" &amp;amp;&amp;amp; this.timezone !== null &amp;amp;&amp;amp; this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset()*-1;
					if (local_timezone == this.timezone) {
						selectLocalTimezone(tp_inst);
					} else {
						this.timezone_select.val(this.timezone);
					}
				} else {
					if (typeof(this.hour) != "undefined" &amp;amp;&amp;amp; this.hour !== null &amp;amp;&amp;amp; this.hour !== "") {
						this.timezone_select.val(o.timezone);
					} else {
						selectLocalTimezone(tp_inst);
					}
				}
				this.timezone_select.change(function() {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
				});
				// End timezone options
				
				// inject timepicker into datepicker
				var $buttonPanel = $dp.find('.ui-datepicker-buttonpane');
				if ($buttonPanel.length) {
					$buttonPanel.before($tp);
				} else {
					$dp.append($tp);
				}

				this.$timeObj = $tp.find('.ui_tpicker_time');

				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined;
				}

				// slideAccess integration: http://trentrichardson.com/2011/11/11/jquery-ui-sliders-and-touch-accessibility/
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
						
					setTimeout(function() { // fix for inline mode
						if ($tp.find('.ui-slider-access').length === 0) {
							$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);

							// fix any grids since sliders are shorter
							var sliderAccessWidth = $tp.find('.ui-slider-access:eq(0)').outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find('table:visible').each(function() {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl? 'marginRight':'marginLeft').toString().replace('%', ''),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + '%',
										css = { width: newWidth, marginRight: 0, marginLeft: 0 };
									css[rtl? 'marginRight':'marginLeft'] = newMarginLeft;
									$g.css(css);
								});
							}
						}
					}, 10);
				}
				// end slideAccess integration

				tp_inst._limitMinMaxDateTime(this.inst, true);
			}
		},

		/*
		* This function tries to limit the ability to go outside the
		* min/max date range
		*/
		_limitMinMaxDateTime: function(dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);

			if (!this._defaults.showTimepicker) {
				return;
			} // No time so nothing to check here

			if ($.datepicker._get(dp_inst, 'minDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'minDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, 'minDateTime'),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin;
				}

				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour &amp;lt;= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute &amp;lt;= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second &amp;lt;= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if(this.millisec &amp;lt;= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;lt; this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin;
									}
									this._defaults.microsecMin = this.microsecMinOriginal;
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal;
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal;
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal;
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal;
				}
			}

			if ($.datepicker._get(dp_inst, 'maxDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'maxDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, 'maxDateTime'),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax;
				}

				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour &amp;gt;= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute &amp;gt;= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second &amp;gt;= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec &amp;gt;= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;gt; this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax;
									}
									this._defaults.microsecMax = this.microsecMaxOriginal;
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal;
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal;
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal;
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal;
				}
			}

			if (adjustSliders !== undefined &amp;amp;&amp;amp; adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10);
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);

				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, 'hour', { min: this._defaults.hourMin, max: hourMax });
					this.control.value(this, this.hour_slider, 'hour', this.hour - (this.hour % this._defaults.stepHour));
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, 'minute', { min: this._defaults.minuteMin, max: minMax });
					this.control.value(this, this.minute_slider, 'minute', this.minute - (this.minute % this._defaults.stepMinute));
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, 'second', { min: this._defaults.secondMin, max: secMax });
					this.control.value(this, this.second_slider, 'second', this.second - (this.second % this._defaults.stepSecond));
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, 'millisec', { min: this._defaults.millisecMin, max: millisecMax });
					this.control.value(this, this.millisec_slider, 'millisec', this.millisec - (this.millisec % this._defaults.stepMillisec));
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, 'microsec', { min: this._defaults.microsecMin, max: microsecMax });
					this.control.value(this, this.microsec_slider, 'microsec', this.microsec - (this.microsec % this._defaults.stepMicrosec));
				}
			}

		},

		/*
		* when a slider moves, set the internal time...
		* on time change is also called when the time is updated in the text field
		*/
		_onTimeChange: function() {
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, 'hour') : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, 'minute') : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, 'second') : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, 'millisec') : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, 'microsec') : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;

			if (typeof(hour) == 'object') {
				hour = false;
			}
			if (typeof(minute) == 'object') {
				minute = false;
			}
			if (typeof(second) == 'object') {
				second = false;
			}
			if (typeof(millisec) == 'object') {
				millisec = false;
			}
			if (typeof(microsec) == 'object') {
				microsec = false;
			}
			if (typeof(timezone) == 'object') {
				timezone = false;
			}

			if (hour !== false) {
				hour = parseInt(hour, 10);
			}
			if (minute !== false) {
				minute = parseInt(minute, 10);
			}
			if (second !== false) {
				second = parseInt(second, 10);
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10);
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10);
			}

			var ampm = o[hour &amp;lt; 12 ? 'amNames' : 'pmNames'][0];

			// If the update was done in the input field, the input field should not be updated.
			// If the update was done using the sliders, update the input field.
			var hasChanged = (hour != this.hour || minute != this.minute || second != this.second || millisec != this.millisec || microsec != this.microsec 
								|| (this.ampm.length &amp;gt; 0 &amp;amp;&amp;amp; (hour &amp;lt; 12) != ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) 
								|| (this.timezone !== null &amp;amp;&amp;amp; timezone != this.timezone));

			if (hasChanged) {

				if (hour !== false) {
					this.hour = hour;
				}
				if (minute !== false) {
					this.minute = minute;
				}
				if (second !== false) {
					this.second = second;
				}
				if (millisec !== false) {
					this.millisec = millisec;
				}
				if (microsec !== false) {
					this.microsec = microsec;
				}
				if (timezone !== false) {
					this.timezone = timezone;
				}

				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0]);
				}

				this._limitMinMaxDateTime(this.inst, true);
			}
			if (this.support.ampm) {
				this.ampm = ampm;
			}

			// Updates the time within the timepicker
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if(pickerTimeFormat === o.timeFormat){
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix);
				}
				else{
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix);
				}
			}

			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime();
			}
		},

		/*
		* call custom onSelect.
		* bind to sliders slidestop, and grid click.
		*/
		_onSelectHandler: function() {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect &amp;amp;&amp;amp; inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this]);
			}
		},

		/*
		* update our input with the new date time..
		*/
		_updateDateTime: function(dp_inst) {
			dp_inst = this.inst || dp_inst;
			//var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
			var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay)),
				dateFmt = $.datepicker._get(dp_inst, 'dateFormat'),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null &amp;amp;&amp;amp; this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			
			// if a slider was changed but datepicker doesn't have a value yet, set it
			if(dp_inst.lastVal===""){
                dp_inst.currentYear=dp_inst.selectedYear;
                dp_inst.currentMonth=dp_inst.selectedMonth;
                dp_inst.currentDay=dp_inst.selectedDay;
            }

			/*
			* remove following lines to force every changes in date picker to change the input value
			* Bug descriptions: when an input field has a default value, and click on the field to pop up the date picker. 
			* If the user manually empty the value in the input field, the date picker will never change selected value.
			*/
			//if (dp_inst.lastVal !== undefined &amp;amp;&amp;amp; (dp_inst.lastVal.length &amp;gt; 0 &amp;amp;&amp;amp; this.$input.val().length === 0)) {
			//	return;
			//}

			if (this._defaults.timeOnly === true) {
				formattedDateTime = this.formattedTime;
			} else if (this._defaults.timeOnly !== true &amp;amp;&amp;amp; (this._defaults.alwaysSetTime || timeAvailable)) {
				formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix;
			}

			this.formattedDateTime = formattedDateTime;

			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate);
			} else if (this.$altInput &amp;amp;&amp;amp; this._defaults.timeOnly === false &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly === true) {
				this.$altInput.val(this.formattedTime);
				this.$input.val(this.formattedDate);
			} else if (this.$altInput) {
				this.$input.val(formattedDateTime);
				var altFormattedDateTime = '',
					altSeparator = this._defaults.altSeparator ? this._defaults.altSeparator : this._defaults.separator,
					altTimeSuffix = this._defaults.altTimeSuffix ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
				
				if(!this._defaults.timeOnly){
					if (this._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg);
					}
					else{
						altFormattedDateTime = this.formattedDate;
					}

					if (altFormattedDateTime){
						altFormattedDateTime += altSeparator;
					}
				}

				if(this._defaults.altTimeFormat){
					altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix;
				}
				else{
					altFormattedDateTime += this.formattedTime + altTimeSuffix;
				}
				this.$altInput.val(altFormattedDateTime);
			} else {
				this.$input.val(formattedDateTime);
			}

			this.$input.trigger("change");
		},

		_onFocus: function() {
			if (!this.$input.val() &amp;amp;&amp;amp; this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, 'timepicker');
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst);
						} catch (err) {
							$.timepicker.log(err);
						}
					}
				}
			}
		},

		/*
		* Small abstraction to control types
		* We can add more, just be sure to follow the pattern: create, options, value
		*/
		_controls: {
			// slider methods
			slider: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var rtl = tp_inst._defaults.isRTL; // if rtl go -60-&amp;gt;0 instead of 0-&amp;gt;60
					return obj.prop('slide', null).slider({
						orientation: "horizontal",
						value: rtl? val*-1 : val,
						min: rtl? max*-1 : min,
						max: rtl? min*-1 : max,
						step: step,
						slide: function(event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl? ui.value*-1:ui.value);
							tp_inst._onTimeChange();
						},
						stop: function(event, ui) {
							tp_inst._onSelectHandler();
						}
					});	
				},
				options: function(tp_inst, obj, unit, opts, val){
					if(tp_inst._defaults.isRTL){
						if(typeof(opts) == 'string'){
							if(opts == 'min' || opts == 'max'){
								if(val !== undefined){
									return obj.slider(opts, val*-1);
								}
								return Math.abs(obj.slider(opts));
							}
							return obj.slider(opts);
						}
						var min = opts.min, 
							max = opts.max;
						opts.min = opts.max = null;
						if(min !== undefined){
							opts.max = min * -1;
						}
						if(max !== undefined){
							opts.min = max * -1;
						}
						return obj.slider(opts);
					}
					if(typeof(opts) == 'string' &amp;amp;&amp;amp; val !== undefined){
							return obj.slider(opts, val);
					}
					return obj.slider(opts);
				},
				value: function(tp_inst, obj, unit, val){
					if(tp_inst._defaults.isRTL){
						if(val !== undefined){
							return obj.slider('value', val*-1);
						}
						return Math.abs(obj.slider('value'));
					}
					if(val !== undefined){
						return obj.slider('value', val);
					}
					return obj.slider('value');
				}
			},
			// select methods
			select: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var sel = '&amp;lt;select class="ui-timepicker-select" data-unit="'+ unit +'" data-min="'+ min +'" data-max="'+ max +'" data-step="'+ step +'"&amp;gt;',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;

					for(var i=min; i&amp;lt;=max; i+=step){						
						sel += '&amp;lt;option value="'+ i +'"'+ (i==val? ' selected':'') +'&amp;gt;';
						if(unit == 'hour'){
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig,'')), {hour:i}, tp_inst._defaults);
						}
						else if(unit == 'millisec' || unit == 'microsec' || i &amp;gt;= 10){ sel += i; }
						else {sel += '0'+ i.toString(); }
						sel += '&amp;lt;/option&amp;gt;';
					}
					sel += '&amp;lt;/select&amp;gt;';

					obj.children('select').remove();

					$(sel).appendTo(obj).change(function(e){
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
					});

					return obj;
				},
				options: function(tp_inst, obj, unit, opts, val){
					var o = {},
						$t = obj.children('select');
					if(typeof(opts) == 'string'){
						if(val === undefined){
							return $t.data(opts);
						}
						o[opts] = val;	
					}
					else{ o = opts; }
					return tp_inst.control.create(tp_inst, obj, $t.data('unit'), $t.val(), o.min || $t.data('min'), o.max || $t.data('max'), o.step || $t.data('step'));
				},
				value: function(tp_inst, obj, unit, val){
					var $t = obj.children('select');
					if(val !== undefined){
						return $t.val(val);
					}
					return $t.val();
				}
			}
		} // end _controls

	});

	$.fn.extend({
		/*
		* shorthand just to use timepicker..
		*/
		timepicker: function(o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);

			if (typeof o == 'object') {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				});
			}

			return $(this).each(function() {
				$.fn.datetimepicker.apply($(this), tmp_args);
			});
		},

		/*
		* extend timepicker to datepicker
		*/
		datetimepicker: function(o) {
			o = o || {};
			var tmp_args = arguments;

			if (typeof(o) == 'string') {
				if (o == 'getDate') {
					return $.fn.datepicker.apply($(this[0]), tmp_args);
				} else {
					return this.each(function() {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args);
					});
				}
			} else {
				return this.each(function() {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults);
				});
			}
		}
	});

	/*
	* Public Utility to parse date and time
	*/
	$.datepicker.parseDateTime = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec);
		}

		return parseRes.date;
	};

	/*
	* Public utility to parse time
	*/
	$.datepicker.parseTime = function(timeFormat, timeString, options) {		
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g,'').indexOf('Z') !== -1);

		// Strict parse requires the timeString to match the timeFormat exactly
		var strictParse = function(f, s, o){

			// pattern for standard and localized AM/PM markers
			var getPatternAmpm = function(amNames, pmNames) {
				var markers = [];
				if (amNames) {
					$.merge(markers, amNames);
				}
				if (pmNames) {
					$.merge(markers, pmNames);
				}
				markers = $.map(markers, function(val) {
					return val.replace(/[.*+?|()\[\]{}\\]/g, '\\$&amp;amp;');
				});
				return '(' + markers.join('|') + ')?';
			};

			// figure out position of time elements.. cause js cant do named captures
			var getFormatPositions = function(timeFormat) {
				var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
					orders = {
						h: -1,
						m: -1,
						s: -1,
						l: -1,
						c: -1,
						t: -1,
						z: -1
					};

				if (finds) {
					for (var i = 0; i &amp;lt; finds.length; i++) {
						if (orders[finds[i].toString().charAt(0)] == -1) {
							orders[finds[i].toString().charAt(0)] = i + 1;
						}
					}
				}
				return orders;
			};

			var regstr = '^' + f.toString()
					.replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
							var ml = match.length;
							switch (match.charAt(0).toLowerCase()) {
								case 'h': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'm': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 's': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'l': return '(\\d?\\d?\\d)';
								case 'c': return '(\\d?\\d?\\d)';
								case 'z': return '(z|[-+]\\d\\d:?\\d\\d|\\S+)?';
								case 't': return getPatternAmpm(o.amNames, o.pmNames);
								default:    // literal escaped in quotes
									return '(' + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function (m) { return "\\" + m; }) + ')?';
							}
						})
					.replace(/\s/g, '\\s?') +
					o.timeSuffix + '$',
				order = getFormatPositions(f),
				ampm = '',
				treg;

			treg = s.match(new RegExp(regstr, 'i'));

			var resTime = {
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0
			};

			if (treg) {
				if (order.t !== -1) {
					if (treg[order.t] === undefined || treg[order.t].length === 0) {
						ampm = '';
						resTime.ampm = '';
					} else {
						ampm = $.inArray(treg[order.t].toUpperCase(), o.amNames) !== -1 ? 'AM' : 'PM';
						resTime.ampm = o[ampm == 'AM' ? 'amNames' : 'pmNames'][0];
					}
				}

				if (order.h !== -1) {
					if (ampm == 'AM' &amp;amp;&amp;amp; treg[order.h] == '12') {
						resTime.hour = 0; // 12am = 0 hour
					} else {
						if (ampm == 'PM' &amp;amp;&amp;amp; treg[order.h] != '12') {
							resTime.hour = parseInt(treg[order.h], 10) + 12; // 12pm = 12 hour, any other pm = hour + 12
						} else {
							resTime.hour = Number(treg[order.h]);
						}
					}
				}

				if (order.m !== -1) {
					resTime.minute = Number(treg[order.m]);
				}
				if (order.s !== -1) {
					resTime.second = Number(treg[order.s]);
				}
				if (order.l !== -1) {
					resTime.millisec = Number(treg[order.l]);
				}
				if (order.c !== -1) {
					resTime.microsec = Number(treg[order.c]);
				}
				if (order.z !== -1 &amp;amp;&amp;amp; treg[order.z] !== undefined) {
					resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z]);
				}


				return resTime;
			}
			return false;
		};// end strictParse

		// First try JS Date, if that fails, use strictParse
		var looseParse = function(f,s,o){
			try{
				var d = new Date('2012-01-01 '+ s);
				if(isNaN(d.getTime())){
					d = new Date('2012-01-01T'+ s);
					if(isNaN(d.getTime())){
						d = new Date('01/01/2012 '+ s);
						if(isNaN(d.getTime())){
							throw "Unable to parse time with native Date: "+ s;
						}
					}
				}

				return {
					hour: d.getHours(),
					minute: d.getMinutes(),
					second: d.getSeconds(),
					millisec: d.getMilliseconds(),
					microsec: d.getMicroseconds(),
					timezone: d.getTimezoneOffset()*-1
				};
			}
			catch(err){
				try{
					return strictParse(f,s,o);
				}
				catch(err2){
					$.timepicker.log("Unable to parse \ntimeString: "+ s +"\ntimeFormat: "+ f);
				}				
			}
			return false;
		}; // end looseParse
		
		if(typeof o.parse === "function"){
			return o.parse(timeFormat, timeString, o);
		}
		if(o.parse === 'loose'){
			return looseParse(timeFormat, timeString, o);
		}
		return strictParse(timeFormat, timeString, o);
	};

	/*
	* Public utility to format the time
	* format = string format of the time
	* time = a {}, not a Date() for timezones
	* options = essentially the regional[].. amNames, pmNames, ampm
	*/
	$.datepicker.formatTime = function(format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			timezone: 0
		}, time);

		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);

		if (hour &amp;gt; 11) {
			ampmName = options.pmNames[0];
		}

		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|('.*?'|".*?"))/g, function(match) {
		switch (match) {
			case 'HH':
				return ('0' + hour).slice(-2);
			case 'H':
				return hour;
			case 'hh':
				return ('0' + convert24to12(hour)).slice(-2);
			case 'h':
				return convert24to12(hour);
			case 'mm':
				return ('0' + time.minute).slice(-2);
			case 'm':
				return time.minute;
			case 'ss':
				return ('0' + time.second).slice(-2);
			case 's':
				return time.second;
			case 'l':
				return ('00' + time.millisec).slice(-3);
			case 'c':
				return ('00' + time.microsec).slice(-3);
			case 'z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, false);
			case 'Z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, true);
			case 'T': 
				return ampmName.charAt(0).toUpperCase();
			case 'TT': 
				return ampmName.toUpperCase();
			case 't':
				return ampmName.charAt(0).toLowerCase();
			case 'tt':
				return ampmName.toLowerCase();
			default:
				return match.replace(/\'/g, "") || "'";
			}
		});

		tmptime = $.trim(tmptime);
		return tmptime;
	};

	/*
	* the bad hack :/ override datepicker so it doesnt close on select
	// inspired: http://stackoverflow.com/questions/1252512/jquery-datepicker-prevent-closing-picker-when-clicking-a-date/1762378#1762378
	*/
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function(id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			tp_inst._limitMinMaxDateTime(inst, true);
			inst.inline = inst.stay_open = true;
			//This way the onSelect handler called from calendarpicker get the full dateTime
			this._base_selectDate(id, dateStr);
			inst.inline = inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst);
		} else {
			this._base_selectDate(id, dateStr);
		}
	};

	/*
	* second bad hack :/ override datepicker so it triggers an event when changing the input field
	* and does not redraw the datepicker on every selectDate event
	*/
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function(inst) {

		// don't popup the datepicker if there is another instance already opened
		var input = inst.input[0];
		if ($.datepicker._curInst &amp;amp;&amp;amp; $.datepicker._curInst != inst &amp;amp;&amp;amp; $.datepicker._datepickerShowing &amp;amp;&amp;amp; $.datepicker._lastInput != input) {
			return;
		}

		if (typeof(inst.stay_open) !== 'boolean' || inst.stay_open === false) {

			this._base_updateDatepicker(inst);

			// Reload the time control when changing something in the input text field.
			var tp_inst = this._get(inst, 'timepicker');
			if (tp_inst) {
				tp_inst._addTimePicker(inst);
			}
		}
	};

	/*
	* third bad hack :/ override datepicker so it allows spaces and colon in the input field
	*/
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if ($.datepicker._get(inst, 'constrainInput')) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null? tp_inst._defaults.showTimezone : tp_inst.support.timezone,					
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat')),
					datetimeChars = tp_inst._defaults.timeFormat.toString()
											.replace(/[hms]/g, '')
											.replace(/TT/g, ampm ? 'APM' : '')
											.replace(/Tt/g, ampm ? 'AaPpMm' : '')
											.replace(/tT/g, ampm ? 'AaPpMm' : '')
											.replace(/T/g, ampm ? 'AP' : '')
											.replace(/tt/g, ampm ? 'apm' : '')
											.replace(/t/g, ampm ? 'ap' : '') + 
											" " + tp_inst._defaults.separator + 
											tp_inst._defaults.timeSuffix + 
											(tz ? tp_inst._defaults.timezoneList.join('') : '') + 
											(tp_inst._defaults.amNames.join('')) + (tp_inst._defaults.pmNames.join('')) + 
											dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr &amp;lt; ' ' || !dateChars || datetimeChars.indexOf(chr) &amp;gt; -1);
			}
		}

		return $.datepicker._base_doKeyPress(event);
	};

	/*
	* Fourth bad hack :/ override _updateAlternate function used in inline mode to init altField
	*/
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	/* Update any alternate field to synchronise with the main field. */
	$.datepicker._updateAlternate = function(inst) {
		var tp_inst = this._get(inst, 'timepicker');
		if(tp_inst){
			var altField = tp_inst._defaults.altField;
			if (altField) { // update alternate field too
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = '', 
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator, 
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if(!tp_inst._defaults.timeOnly &amp;amp;&amp;amp; !tp_inst._defaults.altFieldTimeOnly &amp;amp;&amp;amp; date !== null){
					if(tp_inst._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime;
					}
					else{
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime;
					}
				}
				$(altField).val(altFormattedDateTime);
			}
		}
		else{
			$.datepicker._base_updateAlternate(inst);
		}
	};

	/*
	* Override key up event to sync manual input changes.
	*/
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst);
				} catch (err) {
					$.timepicker.log(err);
				}
			}
		}

		return $.datepicker._base_doKeyUp(event);
	};

	/*
	* override "Today" button to also grab the time.
	*/
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function(id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		this._base_gotoToday(id);
		var tp_inst = this._get(inst, 'timepicker');
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		$('.ui-datepicker-today', $dp).click();
	};

	/*
	* Disable &amp;amp; enable the Time in the datetimepicker
	*/
	$.datepicker._disableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst);
		}
	};

	$.datepicker._enableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst); // Could be disabled on page load
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create our own set time function
	*/
	$.datepicker._setTime = function(inst, date) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var defaults = tp_inst._defaults;

			// calling _setTime with no date sets time to defaults
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;

			//check if within min/max times.. 
			tp_inst._limitMinMaxDateTime(inst, true);

			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create new public method to set only time, callable as $().datepicker('setTime', date)
	*/
	$.datepicker._setTimeDatepicker = function(target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date == "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec);
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds());
				}
				if (tp_date.toString() == 'Invalid Date') {
					tp_date = undefined;
				}
				this._setTime(inst, tp_date);
			}
		}

	};

	/*
	* override setDate() to allow setting time too within Date object
	*/
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function(target, date) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		if(typeof(date) === 'string'){
			date = new Date(date);
			if(!date.getTime()){
				$.timepicker.log("Error creating Date object from string.");
			}
		}

		var tp_inst = this._get(inst, 'timepicker');
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds());
		} else {
			tp_date = date;
		}
		
		// This is important if you are using the timezone option, javascript's Date 
		// object will only return the timezone offset for the current locale, so we 
		// adjust it accordingly.  If not using timezone option this won't matter..
		// If a timezone is different in tp, keep the timezone as is
		if(tp_inst){
			// look out for DST if tz wasn't specified
			if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
				tp_inst.timezone = tp_date.getTimezoneOffset()*-1;
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone);
		}

		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true);
	};

	/*
	* override getDate() to allow getting time too within Date object
	*/
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function(target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			// if it hasn't yet been defined, grab from field
			if(inst.lastVal === undefined){
				this._setDateFromField(inst, noDefault);
			}

			var date = this._getDate(inst);
			if (date &amp;amp;&amp;amp; tp_inst._parseTime($(target).val(), tp_inst.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);

				// This is important if you are using the timezone option, javascript's Date 
				// object will only return the timezone offset for the current locale, so we 
				// adjust it accordingly.  If not using timezone option this won't matter..
				if(tp_inst.timezone != null){
					// look out for DST if tz wasn't specified
					if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
						tp_inst.timezone = date.getTimezoneOffset()*-1;
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
				}
			}
			return date;
		}
		return this._base_getDateDatepicker(target, noDefault);
	};

	/*
	* override parseDate() because UI 1.8.14 throws an error about "Extra characters"
	* An option in datapicker to ignore extra format characters would be nicer.
	*/
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function(format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings);
		} catch (err) {
			// Hack!  The error message ends with a colon, a space, and
			// the "extra" characters.  We rely on that instead of
			// attempting to perfectly reproduce the parsing algorithm.
			if (err.indexOf(":") &amp;gt;= 0) {
				date = this._base_parseDate(format, value.substring(0,value.length-(err.length-err.indexOf(':')-2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format);
			} else {
				throw err;
			}
		}
		return date;
	};

	/*
	* override formatDate to set date with time to the input
	*/
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function(inst, day, month, year) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val();
		}
		return this._base_formatDate(inst);
	};

	/*
	* override options setter to add time to maxDate(Time) and minDate(Time). MaxDate
	*/
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function(target, name, value) {
		var inst = this._getInst(target),
	        name_clone;
		if (!inst) {
			return null;
		}

		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop;
		    if (typeof name == 'string') { // if min/max was set with the string
		        if (name === 'minDate' || name === 'minDateTime') {
		            min = value;
		        } else if (name === 'maxDate' || name === 'maxDateTime') {
		            max = value;
		        } else if (name === 'onSelect') {
		            onselect = value;
		        } else if (overrides.hasOwnProperty(name)) {
		            if (typeof (value) === 'undefined') {
		                return overrides[name];
		            }
		            fns[name] = value;
		            name_clone = {}; //empty results in exiting function after overrides updated
		        }
		    } else if (typeof name == 'object') { //if min/max was set with the JSON
		        if (name.minDate) {
		            min = name.minDate;
		        } else if (name.minDateTime) {
		            min = name.minDateTime;
		        } else if (name.maxDate) {
		            max = name.maxDate;
		        } else if (name.maxDateTime) {
		            max = name.maxDateTime;
		        }
		        for (prop in overrides) {
		            if (overrides.hasOwnProperty(prop) &amp;amp;&amp;amp; name[prop]) {
		                fns[prop] = name[prop];
		            }
		        }
		    }
		    for (prop in fns) {
		        if (fns.hasOwnProperty(prop)) {
		            overrides[prop] = fns[prop];
		            if (!name_clone) { name_clone = $.extend({}, name);}
		            delete name_clone[prop];
		        }
		    }
		    if (name_clone &amp;amp;&amp;amp; isEmptyObject(name_clone)) { return; }
		    if (min) { //if min was set
		        if (min === 0) {
		            min = new Date();
		        } else {
		            min = new Date(min);
		        }
		        tp_inst._defaults.minDate = min;
		        tp_inst._defaults.minDateTime = min;
		    } else if (max) { //if max was set
		        if (max === 0) {
		            max = new Date();
		        } else {
		            max = new Date(max);
		        }
		        tp_inst._defaults.maxDate = max;
		        tp_inst._defaults.maxDateTime = max;
		    } else if (onselect) {
		        tp_inst._defaults.onSelect = onselect;
		    }
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name);
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
	};
	
	/*
	* jQuery isEmptyObject does not check hasOwnProperty - if someone has added to the object prototype,
	* it will return false for all objects
	*/
	var isEmptyObject = function(obj) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(obj)) {
				return false;
			}
		}
		return true;
	};

	/*
	* jQuery extend now ignores nulls!
	*/
	var extendRemove = function(target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] === null || props[name] === undefined) {
				target[name] = props[name];
			}
		}
		return target;
	};

	/*
	* Determine by the time format which units are supported
	* Returns an object of booleans for each unit
	*/
	var detectSupport = function(timeFormat){
		var tf = timeFormat.replace(/\'.*?\'/g,'').toLowerCase(), // removes literals
			isIn = function(f, t){ // does the format contain the token?
					return f.indexOf(t) !== -1? true:false; 
				};
		return {
				hour: isIn(tf,'h'),
				minute: isIn(tf,'m'),
				second: isIn(tf,'s'),
				millisec: isIn(tf,'l'),
				microsec: isIn(tf,'c'),
				timezone: isIn(tf,'z'),
				ampm: isIn(tf,'t') &amp;amp;&amp;amp; isIn(timeFormat,'h'),
				iso8601: isIn(timeFormat, 'Z')
			};
	};

	/*
	* Converts 24 hour format into 12 hour
	* Returns 12 hour without leading 0
	*/
	var convert24to12 = function(hour) {
		if (hour &amp;gt; 12) {
			hour = hour - 12;
		}

		if (hour === 0) {
			hour = 12;
		}

		return String(hour);
	};

	/*
	* Splits datetime string into date ans time substrings.
	* Throws exception when date can't be parsed
	* Returns [dateString, timeString]
	*/
	var splitDateTime = function(dateFormat, dateTimeString, dateSettings, timeSettings) {
		try {
			// The idea is to get the number separator occurances in datetime and the time format requested (since time has 
			// fewer unknowns, mostly numbers and am/pm). We will use the time pattern to split.
			var separator = timeSettings &amp;amp;&amp;amp; timeSettings.separator ? timeSettings.separator : $.timepicker._defaults.separator,
				format = timeSettings &amp;amp;&amp;amp; timeSettings.timeFormat ? timeSettings.timeFormat : $.timepicker._defaults.timeFormat,
				timeParts = format.split(separator), // how many occurances of separator may be in our format?
				timePartsLen = timeParts.length,
				allParts = dateTimeString.split(separator),
				allPartsLen = allParts.length;

			if (allPartsLen &amp;gt; 1) {
				return [
						allParts.splice(0,allPartsLen-timePartsLen).join(separator),
						allParts.splice(0,timePartsLen).join(separator)
					];
			}

		} catch (err) {
			$.timepicker.log('Could not split the date from the time. Please check the following datetimepicker options' +
					"\nthrown error: " + err +
					"\ndateTimeString" + dateTimeString +
					"\ndateFormat = " + dateFormat +
					"\nseparator = " + timeSettings.separator +
					"\ntimeFormat = " + timeSettings.timeFormat);

			if (err.indexOf(":") &amp;gt;= 0) {
				// Hack!  The error message ends with a colon, a space, and
				// the "extra" characters.  We rely on that instead of
				// attempting to perfectly reproduce the parsing algorithm.
				var dateStringLength = dateTimeString.length - (err.length - err.indexOf(':') - 2),
					timeString = dateTimeString.substring(dateStringLength);

				return [$.trim(dateTimeString.substring(0, dateStringLength)), $.trim(dateTimeString.substring(dateStringLength))];

			} else {
				throw err;
			}
		}
		return [dateTimeString, ''];
	};

	/*
	* Internal function to parse datetime interval
	* Returns: {date: Date, timeObj: Object}, where
	*   date - parsed date without time (type Date)
	*   timeObj = {hour: , minute: , second: , millisec: , microsec: } - parsed time. Optional
	*/
	var parseDateTimeInternal = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var date;
		var splitRes = splitDateTime(dateFormat, dateTimeString, dateSettings, timeSettings);
		date = $.datepicker._base_parseDate(dateFormat, splitRes[0], dateSettings);
		if (splitRes[1] !== '') {
			var timeString = splitRes[1],
				parsedTime = $.datepicker.parseTime(timeFormat, timeString, timeSettings);

			if (parsedTime === null) {
				throw 'Wrong time format';
			}
			return {
				date: date,
				timeObj: parsedTime
			};
		} else {
			return {
				date: date
			};
		}
	};

	/*
	* Internal function to set timezone_select to the local timezone
	*/
	var selectLocalTimezone = function(tp_inst, date) {
		if (tp_inst &amp;amp;&amp;amp; tp_inst.timezone_select) {
			var now = typeof date !== 'undefined' ? date : new Date();
			tp_inst.timezone_select.val(now.getTimezoneOffset()*-1);
		}
	};

	/*
	* Create a Singleton Insance
	*/
	$.timepicker = new Timepicker();

	/**
	 * Get the timezone offset as string from a date object (eg '+0530' for UTC+5.5)
	 * @@param  number if not a number this value is returned
	 * @@param boolean if true formats in accordance to iso8601 "+12:45"
	 * @@return string
	 */
	$.timepicker.timezoneOffsetString = function(tzMinutes, iso8601) {
		if(isNaN(tzMinutes) || tzMinutes &amp;gt; 840){
			return tzMinutes;
		}

		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601? ':':'',
			tz = (off &amp;gt;= 0 ? '+' : '-') + ('0' + (hours * 101).toString()).slice(-2) + iso + ('0' + (minutes * 101).toString()).slice(-2);
		
		if(tz == '+00:00'){
			return 'Z';
		}
		return tz;
	};

	/**
	 * Get the number in minutes that represents a timezone string
	 * @@param  string formated like "+0500", "-1245"
	 * @@return number
	 */
	$.timepicker.timezoneOffsetNumber = function(tzString) {
		tzString = tzString.toString().replace(':',''); // excuse any iso8601, end up with "+1245"

		if(tzString.toUpperCase() === 'Z'){ // if iso8601 with Z, its 0 minute offset
			return 0;
		}

		if(!/^(\-|\+)\d{4}$/.test(tzString)){ // possibly a user defined tz, so just give it back
			return tzString;
		}

		return ((tzString.substr(0,1) =='-'? -1 : 1) * // plus or minus
					((parseInt(tzString.substr(1,2),10)*60) + // hours (converted to minutes)
					parseInt(tzString.substr(3,2),10))); // minutes
	};

	/**
	 * No way to set timezone in js Date, so we must adjust the minutes to compensate. (think setDate, getDate)
	 * @@param  date
	 * @@param  string formated like "+0500", "-1245"
	 * @@return date
	 */
	$.timepicker.timezoneAdjust = function(date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if(!isNaN(toTz)){
			date.setMinutes(date.getMinutes()*1 + (date.getTimezoneOffset()*-1 - toTz*1) );
		}
		return date;
	};

	/**
	 * Calls `timepicker()` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * n.b. The input value must be correctly formatted (reformatting is not supported)
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the timepicker() call
	 * @@return jQuery
	 */
	$.timepicker.timeRange = function(startTime, endTime, options) {
		return $.timepicker.handleRange('timepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datetimepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@return jQuery
	 */
	$.timepicker.datetimeRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datetimepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.dateRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.handleRange = function(method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0, // min allowed interval in milliseconds
			maxInterval: 0, // max allowed interval in milliseconds
			start: {},      // options for start picker
			end: {}         // options for end picker
		}, options);

		$.fn[method].call(startTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), endTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), endTime, 'minDate');
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), startTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), startTime, 'maxDate');
			}
		}, options, options.end));

		checkDates(startTime, endTime);
		selected(startTime, endTime, 'minDate');
		selected(endTime, startTime, 'maxDate');

		function checkDates(changed, other) {
			var startdt = startTime[method]('getDate'),
				enddt = endTime[method]('getDate'),
				changeddt = changed[method]('getDate');

			if(startdt !== null){
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());

				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);

				if(options.minInterval &amp;gt; 0 &amp;amp;&amp;amp; minDate &amp;gt; enddt){ // minInterval check
					endTime[method]('setDate',minDate);
				}
				else if(options.maxInterval &amp;gt; 0 &amp;amp;&amp;amp; maxDate &amp;lt; enddt){ // max interval check
					endTime[method]('setDate',maxDate);
				}
				else if (startdt &amp;gt; enddt) {
					other[method]('setDate',changeddt);
				}
			}
		}

		function selected(changed, other, option) {
			if (!changed.val()) {
				return;
			}
			var date = changed[method].call(changed, 'getDate');
			if(date !== null &amp;amp;&amp;amp; options.minInterval &amp;gt; 0){
				if(option == 'minDate'){
					date.setMilliseconds(date.getMilliseconds() + options.minInterval); 
				}
				if(option == 'maxDate'){
					date.setMilliseconds(date.getMilliseconds() - options.minInterval);
				}
			}
			if (date.getTime) {
				other[method].call(other, 'option', option, date);
			}
		}
		return $([startTime.get(0), endTime.get(0)]);
	};

	/**
	 * Log error or data to the console during error or debugging
	 * @@param  Object err pass any type object to log to the console during error or debugging
	 * @@return void
	 */
	$.timepicker.log = function(err){
		if(window.console){
			console.log(err);
		}
	};

	/*
	* Microsecond support
	*/
	if(!Date.prototype.getMicroseconds){
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function(){ return this.microseconds; };
		Date.prototype.setMicroseconds = function(m){ 
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m/1000));
			this.microseconds = m%1000;
			return this;
		};
	}

	/*
	* Keep up with the version
	*/
	$.timepicker.version = "1.3.1";

})(jQuery);
jQuery.noConflict();
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;datetimepicker-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;e73a652e-09fc-4c71-8e7a-e2525a2d2a99&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
function replaceAllString(oriStr, strTarget, strSubString ){
   var strText = oriStr;
   var intIndexOfMatch = strText.indexOf( strTarget );
   while (intIndexOfMatch != -1){
      strText = strText.replace( strTarget, strSubString )
      intIndexOfMatch = strText.indexOf( strTarget );
   }
   return( strText );
}
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&amp;amp;]" + name + "=([^&amp;amp;#]*)"),
    results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
};


   var jobName= getParameterByName('job')
   var fromDate= getParameterByName('fromDate')
   var toDate= getParameterByName('toDate')
   var limit= getParameterByName('limit')
   var selectedIstIid = getParameterByName('IstIid')

  $("#jobname").ready(function(){
   $("#jobname").text(jobName)
   var convertedJobName = replaceAllString(jobName, ".", "_")
   $("#IstIid" + convertedJobName).ready(function(){
     $("#IstIid" + convertedJobName).css("display","block")
     $("#select_" + convertedJobName).ready(function(){
        $("#select_" + convertedJobName).val(selectedIstIid)
     });
   });
 });

  $("#fromDate").ready(function(){
   $("#from-date").val(fromDate)
 });

  $("#toDate").ready(function(){
   $("#to-date").val(toDate)
 });

  $("#limit").ready(function(){
   if(limit!=""){
    $("#limit").val(limit)
   }
 });
 // Get data with ajax
 function ajax_getData(jobName,fromDate,toDate,limit ){
       var convertedJobName = replaceAllString(jobName, ".", "_")
       var istIid = $("#select_" + convertedJobName).val()
       window.location="/xwiki/bin/view/WiperDog/WebHome?job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid="+istIid;
 			/*$.ajax({
			 type: "GET",
			 url:"/xwiki/bin/get/Sandbox/DescriptionForJob?outputSyntax=plain&amp;amp;job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid"+selectedIstIid,
			 success : function(result){
				$("#jobname").html(jobName)
				$("#display").text('[[]]' + result)
			 }
		   });*/
 }
	$("#treemenu2 a").click(function(){
		 var limit = 10
		 var fromDate=""
		 var toDate = ""
		 jobName= $(this).text()
                 $("#jobname").html(jobName)
                 var convertedJobName = replaceAllString(jobName, ".", "_")
                 $("#listIstIid &amp;gt; div").css("display","none")
                 $("#IstIid" + convertedJobName).css("display","block")
		 //ajax_getData(jobName,fromDate,toDate,limit )

	});

	$("#from-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
		dateFormat: 'yy-mm-dd',
	});
	$("#to-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
			dateFormat: 'yy-mm-dd',

	});
	 $("#get-data").on("click",function(){
		var fromDate = $("#from-date").val()
		var toDate =  $("#to-date").val()
		 if( toDate!= "" ){
			  if(fromDate != ""){
				  if($("#from-date").datepicker( "getDate" ) &amp;gt; $("#to-date").datepicker( "getDate" )){
				  alert("'From date' cannot start later than 'To date'")
				  return false
				  }
			  }
		 }
		 limit = $("#limit").val()
		 ajax_getData(jobName,fromDate,toDate,limit )
	});
$(document).ready(function(){
  var keys = $("#lstkey").text()
  //console.log('key == ' + keys);
  //console.log('livetableJson ==' + $("#livetableJson").text());
  
  var jsonObj = $.parseJSON($("#livetableJson").text()); 
  if(keys &amp;amp;&amp;amp; keys != '[ ]'){
    /** Subtyped **/    
    var newKeys = keys.replace('[',"");
    keys = newKeys.replace(']',"");
    var keyArr = (keys.indexOf(',') != -1)? keys.split(','):new Array(keys);
    //console.log('Key after replace: '+keys)       
    for(var i=0;i&amp;lt;keyArr.length;i++){
        var keyName = keyArr[i].trim().replace('',"").replace("\"","").replace('\"','');
        var subTypeJsonObjStr = jsonObj[keyName].replace('#livetablePager','#livetablePager_'+keyName)
        var subTypeJsonObj = $.parseJSON(subTypeJsonObjStr);
        $("#livetableList_"+keyName).jqGrid(subTypeJsonObj);
        $("#livetableList_"+keyName).jqGrid('navGrid', "#livetablePager_"+keyName, {
           edit : false,
           add : false,
           del : false,
           search:false
         });
    }
    
  }else{ /** Store**/        
      $("#livetableList").jqGrid(jsonObj);
      $("#livetableList").jqGrid('navGrid', "#livetablePager", {
           edit : false,
           add : false,
           del : false,
           search:false
           
       });
   }
});
        
jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;process&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;881686cc-1bfc-456e-b8ab-71334c4a45e5&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){

	$(function () {
		function drawLineChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerline' + container).highcharts({

				chart: {
					type:'line'
				},
				title: {
					text: chart_name
				},
				tooltip :{
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				xAxis: dataXAxis ,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				series: dataSeries
			});
		};

		function drawBarChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerbar' + container).highcharts({
				chart: {
					type: 'column'
				},
				title: {
					text: chart_name
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {

					column: {
						pointPadding: 0.2,
						borderWidth: 0
					}
				},
				series: dataSeries
			});
		}

		function drawAreaChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail
			$('#containerarea' + container).highcharts({
				chart: {
					type: 'area'
				},
				title: {
					text: chart_name
				},
				subtitle: {
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					},
					labels: {
						formatter: function() {
							return this.value / 1000;
						}
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {
					area: {
						stacking: 'normal',
						lineColor: '#666666',
						lineWidth: 1,
						marker: {
							lineWidth: 1,
							lineColor: '#666666'
						}
					}
				},
				series: dataSeries
			});
		};

		function drawPieChart(data, container, chartName){
			var dataPie = data
			$(document).ready(function () {
				// Build the chart
				$('#container' + container).highcharts({
					chart: {
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: chartName
					},
					tooltip: {
						pointFormat: '{series.name}: &amp;lt;b&amp;gt;{point.percentage:.1f}%&amp;lt;/b&amp;gt;'
					},
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							dataLabels: {
								enabled: true,
                                                                color: '#000000',
                                                                connectorColor: '#000000',
                                                                format: '&amp;lt;b&amp;gt;{point.name}&amp;lt;/b&amp;gt;: {point.percentage:.1f} %'
							},
							showInLegend: true
						}
					},
					series: dataPie
				});
			});
		}

		// LINE
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                     if(($("#jsons&amp;gt;#jsonline_" + finalKey)).length &amp;gt; 0) {
					var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonline_" + finalKey).val());
					var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerline_" + finalKey).val());
				        var lstContainer = [];
  				        var data_all = [];
                                        var chartSize = arrayAll.length

                                        for(var i=0;i&amp;lt;chartSize ;i++){
                                           data_all = arrayAll[i]
                                           lstContainer = arrayContainerAll[i]
				           if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					        // data to display on tooltip
					        var data_detail = data_all[0]
					        // draw Line chart
				        	for(var j=0;j&amp;lt;data_all.length;j++){
				        		if(data_all[j].series[0].name == null){
				        			data_all[j].series[0].name = lstContainer[j]
					        	}
                                                        chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					        	drawLineChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					        }
				         }
                                      }
                                  }
				}
			} else {
				var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonline").val());
				var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerline").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length

                                for(var i=0;i&amp;lt;chartSize ;i++){
                                   data_all = arrayAll[i]
                                   lstContainer = arrayContainerAll[i]
				   if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Line chart
					for(var j=0;j&amp;lt;data_all.length;j++){
						if(data_all[j].series[0].name == null){
							data_all[j].series[0].name = lstContainer[j]
						}
                                                chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
						drawLineChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
				   }
                                }
			}
		});

		// BAR
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
			             var finalKey = lstKey[eKey]
                                     if(($("#jsons&amp;gt;#jsonbar_" + finalKey)).length &amp;gt; 0) {
					var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonbar_" + finalKey).val());
					var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerbar_" + finalKey).val());
					var lstContainer = [];
					var data_all = [];
                                        var chartSize = arrayAll.length
					for(var i=0;i&amp;lt;chartSize ;i++){
					    data_all = arrayAll[i]
					    lstContainer = arrayContainerAll[i]
					    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw bar chart
						for(var j=0;j&amp;lt;data_all.length;j++){
							if(data_all[j].series[0].name == null){
								data_all[j].series[0].name = lstContainer[j]
							}
                                                        chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
							drawBarChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
						}
                                            }
					}
                                    }
				}
			} else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonbar").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerbar").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
				    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Bar chart
					for(var j=0;j&amp;lt;data_all.length;j++){
                                            if(data_all[j].series[0].name == null){
						data_all[j].series[0].name = lstContainer[j]
					    }
                                            chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					    drawBarChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
                                    }
				}
			}
		});

		// AREA
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
                        var arrayAll
                        var arrayContainerAll
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                        if(($("#jsons&amp;gt;#jsonarea_" + finalKey)).length &amp;gt; 0) {
                                           arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonarea_" + finalKey).val());
                                           arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerarea_" + finalKey).val());
					   var lstContainer = [];
					   var data_all = [];
                                           var chartSize = arrayAll.length
					   for(var i=0;i&amp;lt;chartSize ;i++){
					       data_all = arrayAll[i]
					       lstContainer = arrayContainerAll[i]
					       if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						   // data to display on tooltip
						   var data_detail = data_all[0]
						   // draw Line chart
						   for(var j=0;j&amp;lt;data_all.length;j++){
						      if(data_all[j].series[0].name == null){
						         data_all[j].series[0].name = lstContainer[j]
						       }
                                                       chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
						       drawAreaChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
						   }
					      }
				           }
                                        }
			          }
                        } else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonarea").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerarea").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
				    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw area chart
					for(var j=0;j&amp;lt;data_all.length;j++){
                                            if(data_all[j].series[0].name == null){
						data_all[j].series[0].name = lstContainer[j]
					    }
                                            chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					    drawAreaChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
                                    }
				}
			}
		});

		// PIE
		$(document ).ready(function(){
                        var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
                        var arrayAll
                        var arrayContainerAll
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                        if(($("#jsons&amp;gt;#jsonpie_" + finalKey)).length &amp;gt; 0) {
                                           arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonpie_" + finalKey).val());
                                           arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerpie_" + finalKey).val());
					   var lstContainer = [];
					   var data_all = [];
                                           var chartSize = arrayAll.length
					  for(var i=0;i&amp;lt;chartSize ;i++){
					       data_all = arrayAll[i]
					       lstContainer = arrayContainerAll[i]
					       if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						   // draw Pie chart
						   for(var j=0;j&amp;lt;data_all.length;j++){
                                                       chartName  = data_all[j].chart_name + "( " + data_all[j].name + " )"
						       drawPieChart([data_all[j]], finalKey + "_" + lstContainer[j], chartName)
						   }
					      }
				           }
                                        }
			          }
			} else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonpie").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerpie").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
                                    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
                                                   for(var j=0;j&amp;lt;data_all.length;j++){
                                                       chartName  = data_all[j].name
						       drawPieChart([data_all[j]], j + "_pie_", chartName)
						   }

                                    }
                                }
			}
		});
	});
	jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;d5873d92-b78b-42fc-9407-46d166204b88&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;/* css for timepicker */
.ui-timepicker-div .ui-widget-header { 
margin-bottom: 8px;
 }

.ui-timepicker-div dl { text-align: left; }
.ui-timepicker-div dl dt { height: 25px; margin-bottom: -25px; }
.ui-timepicker-div dl dd { margin: 0 10px 10px 65px; }
.ui-timepicker-div td { font-size: 90%; }
.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }

.ui-timepicker-rtl{ direction: rtl; }
.ui-timepicker-rtl dl { text-align: right; }
.ui-timepicker-rtl dl dd { margin: 0 65px 10px 10px; }
#ui-datepicker-div{
 position:relative;
 width:auto;
 height:auto
}
&lt;/code&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;datetimepicker -css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;1201fb1a-e9c1-4731-8c74-2ea8c0071959&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;.displayblock {
  border:2px solid;
  -webkit-border-radius:6px;
  background:gray;
  float: left;
  width:100%;
}

.displaypie {
  border:1px solid;
  -webkit-border-radius:6px;
  background:gray;
  width: 48%;
  float: left; 
  height: 300px;
}

.subtype {
  margin-top: 50px;
  font-size: 2em;
  color: red;
}&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;content&gt;{{include document="Lib.DataToDrawChart"/}}
{{include document="Lib.MongoDBConnection"/}}
{{velocity}}
$xwiki.jsx.use('Lib.JQueryUILib')
$xwiki.ssx.use('Lib.MenuGenerator')
$xwiki.jsx.use('Lib.MenuGenerator')
$xwiki.ssx.use('Lib.JQueryUILib')
$xwiki.jsx.use('Lib.JqGridLib')
$xwiki.ssx.use('Lib.JqGridLib') 
{{/velocity}}
{{include document="Lib.MenuGenerator"/}}
{{html wiki="true" clean="false"}}
&amp;lt;div id="viewer"&amp;gt;
&amp;lt;table style="text-align:left"  &amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th &amp;gt;Job name&amp;lt;/th&amp;gt;
  &amp;lt;td colspan=3&amp;gt;&amp;lt;div id="jobname"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
{{groovy}}
import org.xwiki.context.*

def ec = services.component.getInstance(Execution.class).getContext()
def mapJobIstIid = ec.getProperty("mapJobIstIid")

println '{{html clean="false" wiki="false"}}'
println '&amp;lt;tr&amp;gt;'
println '&amp;lt;th&amp;gt;IstIid&amp;lt;/th&amp;gt;'
println '&amp;lt;td colspan=3&amp;gt;'
mapJobIstIid.each{jobEntry-&amp;gt;
  def convertedJobKey = jobEntry.key.replaceAll("\\.","_")
  println "&amp;lt;div id='listIstIid'&amp;gt;"
  println "&amp;lt;div id=IstIid${convertedJobKey} style='display:none'&amp;gt;"
  println "&amp;lt;select id=select_${convertedJobKey}&amp;gt;"
  jobEntry.value.each{
     println "&amp;lt;option value=\"$it\"&amp;gt;$it&amp;lt;/option&amp;gt;"
  }
  println "&amp;lt;/select&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
}
println '&amp;lt;/td&amp;gt;'
println '&amp;lt;/tr&amp;gt;'
println '{{/html}}'
{{/groovy}}
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data monitor from&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="from-date" id="from-date"/&amp;gt;&amp;lt;/td&amp;gt;
  &amp;lt;th&amp;gt;Data monitor to&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="to-date" id="to-date"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data records limit &amp;lt;/th&amp;gt;
  &amp;lt;td &amp;gt;
     &amp;lt;select id="limit"&amp;gt;
       &amp;lt;option value=5&amp;gt;5&amp;lt;/option&amp;gt;
       &amp;lt;option value=10&amp;gt;10&amp;lt;/option&amp;gt;
       &amp;lt;option value=15&amp;gt;15&amp;lt;/option&amp;gt;
       &amp;lt;option value=20&amp;gt;20&amp;lt;/option&amp;gt;
     &amp;lt;/select&amp;gt;
  &amp;lt;/td&amp;gt;
  &amp;lt;td colspan=3 &amp;gt;&amp;lt;input type="button" value="View Data" id="get-data" class="button"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;&amp;lt;div id="display"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
  &amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
&amp;lt;/table&amp;gt;

&amp;lt;/div&amp;gt; 
   
 &amp;lt;/body&amp;gt;

{{/html}}
{{groovy}}
import groovy.json.*
xwiki.jsx.use("Lib.Highcharts")

if(request.xpage == "plain") {
	response.setContentType('text/plain')
}

def listData = []
def job = request.get("job")
def fromDate = request.get("fromDate")
def toDate = request.get("toDate")
def limit= (request.get("limit")!=null)?request.get("limit").toInteger():10
def istIid = request.get("IstIid")

def str= "No data to retrieved !"
def result = null
if(job != "" &amp;amp;&amp;amp; job != null &amp;amp;&amp;amp; istIid != null &amp;amp;&amp;amp; istIid != ""){
	MongoDBConnection.getConnection()
	if(fromDate != "" || toDate != ""){
		result = MongoDBConnection.getDataInPeriod(job,fromDate,toDate,limit,istIid)
	} else {
		result = MongoDBConnection.getDataAllFields(job,limit,istIid)
        }
MongoDBConnection.closeConnection()
} else {
   println "{{warning}}There are no selected job or IstIid{{/warning}}"
}
def listKey = []
if( (result != null) &amp;amp;&amp;amp; (result.size() &amp;gt; 0) &amp;amp;&amp;amp; (result[0].KEYEXPR != null)&amp;amp;&amp;amp;!(result[0].KEYEXPR instanceof List )){

if(result[0].type == "Subtyped") {
    println '{{html clean="false" wiki="true"}}'
    //println '&amp;lt;body&amp;gt;'
    def dataSubtype = DataToDrawChart.getDataToDrawSubtype(result)
    dataSubtype.each {key,value -&amp;gt;
        listKey.add(key)
    }
    def jsonkey = com.mongodb.util.JSON.serialize(listKey)
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$jsonkey&amp;lt;/textarea&amp;gt;"

    dataSubtype.each {key,value -&amp;gt;
            def dataLine = []
            def dataBar = []
            def dataPie = []
            def dataArea = []
            if(DataToDrawChart.getDataToDrawLine(value) != []) {
                dataLine = DataToDrawChart.getDataToDrawLine(value)
            }
            if(DataToDrawChart.getDataToDrawBar(value) != []) {
                dataBar = DataToDrawChart.getDataToDrawBar(value)
            }
            if(DataToDrawChart.getDataToDrawPie(value) != []) {
                dataPie = DataToDrawChart.getDataToDrawPie(value)
            }
            if(DataToDrawChart.getDataToDrawArea(value) != []) {
                dataArea = DataToDrawChart.getDataToDrawArea(value)
            }

		def chartColumnsLine = []
		def chartColumnsBar = []
		def chartColumnsArea = []
		def lstName

                dataLine.each {itemDataLine -&amp;gt;
                    if(itemDataLine.size() &amp;gt; 0 ){
		        chartColumnsLine.add(itemDataLine[0].chart_columns)
	            }
                }
                dataBar.each {itemDataBar -&amp;gt;
                    if(itemDataBar.size() &amp;gt; 0 ){
		        chartColumnsBar.add(itemDataBar[0].chart_columns)
	            }
                }
                dataArea.each {itemDataArea -&amp;gt;
                    if(itemDataArea.size() &amp;gt; 0 ){
		        chartColumnsArea.add(itemDataArea[0].chart_columns)
	            }
                }

		if(dataPie.size() &amp;gt; 0 ){
			lstName = dataPie['name']
		}
		def tmpListNameContainer = []
                
		if(lstName != null) {
                        def chartNumPie = 0
                        def tmpLst
                        for(def nameContainer in lstName){
                           tmpLst = []
			   for(def nameContainerItem in nameContainer ){
				nameContainerItem = chartNumPie + "_" + nameContainerItem.replaceAll("\\.", "_")
				tmpLst.add(nameContainerItem )
		            }
                            tmpListNameContainer.add(tmpLst)
                            chartNumPie++
                         }
		}
		def jsonPie
		def jsonLine
		def jsonBar
		def jsonArea
		if(dataPie != []) {
		    jsonPie = com.mongodb.util.JSON.serialize(dataPie)
		}
		if(dataLine != []) {
		    jsonLine = com.mongodb.util.JSON.serialize(dataLine)
		}
		if(dataBar != []) {
		    jsonBar = com.mongodb.util.JSON.serialize(dataBar)
		}
		if(dataArea != []) {
		    jsonArea = com.mongodb.util.JSON.serialize(dataArea)
		}
		def jsonContainerPie
		if(tmpListNameContainer != []) {
			jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
		}
		def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
		def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
		def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

		println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
		if(jsonLine != null) {
			println "&amp;lt;textarea id=\"jsonline_$key\" &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class=\"lstcontainerline_$key\" &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
		}
		if(jsonBar != null) {
			println "&amp;lt;textarea id=\"jsonbar_$key\"&amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerbar_$key' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
		}
		if(jsonPie != null &amp;amp;&amp;amp; jsonContainerPie != null) {
			println "&amp;lt;textarea id=\"jsonpie_$key\" &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerpie_$key' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
		}
		if(jsonArea != null) {
			println "&amp;lt;textarea id=\"jsonarea_$key\" &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerarea_$key' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
		}

        println "&amp;lt;/div&amp;gt;"
        def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
        def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
          
        println "&amp;lt;div style='clear:both'&amp;gt;"
            def description = value.KEYEXPR._description[0][key]
            if(description != null) {
                println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +': ' + description +'&amp;lt;/div&amp;gt;'
            } else {
                println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +'&amp;lt;/div&amp;gt;'
            }
            println "-----"
            if(jsonPie != null) {
          println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
	  chartNumPie = 0
          lstName.each{chartPieLst -&amp;gt;
		chartPieLst.each {
	            def tmp = chartNumPie + "_" + it.replaceAll("\\.", "_")
		    println " &amp;lt;div class=\"displaypie\" id=\"container${key}_${tmp}\" &amp;gt;&amp;lt;/div&amp;gt;"
          	}
		chartNumPie++
	  }	
          println "&amp;lt;/div&amp;gt;"
            }
            if(jsonLine != null) {
          	def chartLineComment = false
		def chartNumLine = 0
          	chartColumnsLine.each{chartColumnsLineItem -&amp;gt;
            		if(!chartLineComment){
               			println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
               			chartLineComment = true  
            		}
		chartColumnsLineItem.each{
              		println " &amp;lt;div class=\"displayblock\" id=\"containerline${key}_${chartNumLine}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          	}
		chartNumLine ++
	    }
          println "&amp;lt;/div&amp;gt;"
            }
            println "&amp;amp;nbsp;"

            if(jsonBar != null) {
          	def chartBarComment = false
  		def chartNumBar = 0
          	chartColumnsBar.each{chartColumnsBarItem -&amp;gt;
             		if(!chartBarComment){
                		println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
                		chartBarComment = true
              		}  
			chartColumnsBarItem.each{
             			println " &amp;lt;div class=\"displayblock\" id=\"containerbar${key}_${chartNumBar}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          		}
			chartNumBar++
		}
          	println "&amp;lt;/div&amp;gt;"
            }
            println "&amp;amp;nbsp;"

            if(jsonArea != null) {
          	def chartAreaComment = false
		def chartNumArea = 0
          	chartColumnsArea.each{chartColumnsAreaItem -&amp;gt;
          		if(!chartAreaComment){
            			println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
            			chartAreaComment = true
          		}
			chartColumnsAreaItem.each{
            			println " &amp;lt;div class=\"displayblock\" id=\"containerarea${key}_${chartNumArea}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          		}
          		chartNumArea++
            	}
        	println "&amp;lt;/div&amp;gt;"
	    }
        /** Statistic data table **/
        println "&amp;lt;center&amp;gt;"        
        println "&amp;lt;div id='livetblContent_"+key+"' style='width:100%;clear:both;align:middle;margin-top:10px'&amp;gt;"   
        println "Statistics data for "+key
        println "&amp;lt;table id='livetableList_"+key+"' style='width:100%;align:center'&amp;gt;&amp;lt;/table&amp;gt;"
        println "&amp;lt;div id='livetablePager_"+key+"' style='position:relative;width:100%'&amp;gt;&amp;lt;/div&amp;gt;"
        println "&amp;lt;/div&amp;gt;"
        println "&amp;lt;/center&amp;gt;"
        println "&amp;lt;script language='javascript'&amp;gt;console.log('Create live table for "+key+"');&amp;lt;/script&amp;gt;"
    }
    //println '&amp;lt;/body&amp;gt;'
    println '{{/html}}'
} else if(result[0].type == "Store") {
	// data store
	def dataLine = DataToDrawChart.getDataToDrawLine(result)
	def dataBar = DataToDrawChart.getDataToDrawBar(result)
	def dataPie = DataToDrawChart.getDataToDrawPie(result)
	def dataArea = DataToDrawChart.getDataToDrawArea(result)
	def chartColumnsLine = []
	def chartColumnsBar = []
	def chartColumnsArea = []
	def lstName

        dataLine.each {itemDataLine -&amp;gt;
            if(itemDataLine.size() &amp;gt; 0 ){
		chartColumnsLine.add(itemDataLine[0].chart_columns)
	    }
        }

        dataBar.each {itemDataBar -&amp;gt;
            if(itemDataBar.size() &amp;gt; 0 ){
		chartColumnsBar.add(itemDataBar[0].chart_columns)
	    }
        }

        dataArea.each {itemDataArea -&amp;gt;
            if(itemDataArea.size() &amp;gt; 0 ){
		chartColumnsArea.add(itemDataArea[0].chart_columns)
	    }
        }

	if(dataPie.size() &amp;gt; 0 ){
		lstName = dataPie['name']
	}

    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
  
    def tmpListNameContainer = []
    def chartNumPie = 0
    for(def nameContainer in lstName){
       for(def nameContainerItem in nameContainer ){
           nameContainerItem = chartNumPie + "_" + nameContainerItem.replaceAll("\\.", "_")
           tmpListNameContainer .add(nameContainerItem )
       }
    }
    
    def jsonPie = com.mongodb.util.JSON.serialize(dataPie)
    def jsonLine = com.mongodb.util.JSON.serialize(dataLine)
    def jsonBar = com.mongodb.util.JSON.serialize(dataBar)
    def jsonArea = com.mongodb.util.JSON.serialize(dataArea)

    def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
    def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
    def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
    def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

    def listEmpty = com.mongodb.util.JSON.serialize([])
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$listEmpty&amp;lt;/textarea&amp;gt;" 

    println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
    println "&amp;lt;textarea class='jsonline' &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonbar' &amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonpie' &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonarea' &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"

    println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;/div&amp;gt;"

    def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
    def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
  
    println "&amp;lt;div style='clear:both'&amp;gt;"
  
    def chartPieComment = false
    chartNumPie = 0
    lstName.each{chartPieLst-&amp;gt;
        if(!chartPieComment) {
            println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
            chartPieComment = true
        }
        chartPieLst.each {
            def tmp = chartNumPie + "_pie"
            println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
        }
    }
    println "&amp;lt;/div&amp;gt;"
    	def chartLineComment = false
	def chartNum = 0
    	chartColumnsLine.each{chartColumnsLineItem -&amp;gt;
	    	if(!chartLineComment){
	        	println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	        	chartLineComment = true  
	    	}
		chartColumnsLineItem.each{
	    		println " &amp;lt;div class=\"displayblock\" id=\"containerline${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	    	}
		chartNum++
	}	
    	println "&amp;lt;/div&amp;gt;"
    	println "&amp;amp;nbsp;"
    	def chartBarComment = false
	chartNum = 0
    	chartColumnsBar.each{chartColumnsBarItem -&amp;gt;
	        if(!chartBarComment){
	            println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	            chartBarComment = true
	        }  
		chartColumnsBarItem.each{
	    		println " &amp;lt;div class=\"displayblock\" id=\"containerbar${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  	}
		chartNum++
	}
  println "&amp;lt;/div&amp;gt;"
  println "&amp;amp;nbsp;"
  	def chartAreaComment = false
	chartNum = 0
  	chartColumnsArea.each{chartColumnsAreaItem -&amp;gt;
	  	if(!chartAreaComment){
	    		println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	    		chartAreaComment = true
	  	}
		chartColumnsAreaItem.each{
    			println " &amp;lt;div class=\"displayblock\" id=\"containerarea${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
		}
		chartNum++
  	}
  println "&amp;lt;/div&amp;gt;"
println "&amp;lt;/div&amp;gt;"

//println '&amp;lt;/body&amp;gt;'
println '{{/html}}'
}
}else{
    println 'There is no data for this job with criterias'
}
//--=============== Start build for livetable
def subTypeURLMap = [:]
def dataModel = []
def dataUrl = ""
result.find{rec-&amp;gt;				
    def subtractData = []
    
    //-- Parsing data and assign data to subtract list
    if(rec.type == "Store"){ //-- Store data type
        subtractData = rec['data']        
        subtractData.each{r2-&amp;gt;					
            if(dataModel != null &amp;amp;&amp;amp; dataModel.size() &amp;lt;=0){ 
                dataModel.add("Fetch At")
                dataModel.addAll(r2.keySet());					
            } 
        }        
        dataUrl = "/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job="+job +"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate + "&amp;amp;toDate=" + toDate + "&amp;amp;istIid="+istIid        
        //-- Building data model				
        def model = []
        def colSpec
        dataModel.each{name-&amp;gt;
            colSpec = [:]
            colSpec['name'] = name
            colSpec['index'] = name
            colSpec['width'] = "100"
            model.add(colSpec)
        }
        def dataModelStr = (new JsonBuilder(dataModel)).toPrettyString()
        def modelStr = (new JsonBuilder(model)).toPrettyString() 
        str = 
        "{\"url\":\""+dataUrl+"\",\"datatype\":\"json\","+
            "\"colNames\":"+ dataModelStr +
            ",\"colModel\":"+ modelStr +" ,\"rowList\":[10,20,30],"+
            "\"pager\":\"#livetablePager\", \"viewrecords\": true, \"sortname\": \"RECORD_SEQ\","+
            "\"sortorder\": \"asc\", \"caption\":\""+job+"\"}"
        println "{{html clean=\"false\" wiki=\"true\"}}"
        println "&amp;lt;div id='livetableJson' style = \"display:none\"&amp;gt;"
        //println "&amp;lt;div id='livetableJson'&amp;gt;"
        println str;
        println "&amp;lt;/div&amp;gt;"
        println "{{/html}}"
    }else{ //-- Subtype			
        def subData = rec['data']
        subData.each{key,value-&amp;gt;
            dataUrl = "/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job="+job +"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate + "&amp;amp;toDate=" + toDate + "&amp;amp;istIid="+istIid+"&amp;amp;subType="+key
            subtractData = value
            subtractData.each{r2-&amp;gt;					
                if(dataModel != null &amp;amp;&amp;amp; dataModel.size() &amp;lt;=0){ 
                    dataModel.add("Fetch At")
                    dataModel.addAll(r2.keySet());					
                } 			
            }
            //-- Building data model				
            def model = []
            def colSpec
            dataModel.each{name-&amp;gt;
                colSpec = [:]
                colSpec['name'] = name
                colSpec['index'] = name
                colSpec['width'] = "100"
                model.add(colSpec)
            }
            def dataModelStr = (new JsonBuilder(dataModel)).toPrettyString()
            def modelStr = (new JsonBuilder(model)).toPrettyString() 
            str = 
            "{\"url\":\""+dataUrl+"\",\"datatype\":\"json\","+
                "\"colNames\":"+ dataModelStr +
                ",\"colModel\":"+ modelStr +" ,\"rowList\":[10,20,30],"+
                "\"pager\":\"#livetablePager\", \"viewrecords\": true, \"sortname\": \"RECORD_SEQ\","+
                "\"sortorder\": \"asc\", \"caption\":\""+job+"\"}"
            subTypeURLMap[key] = str
        }
        def finalStr = (new JsonBuilder(subTypeURLMap)).toPrettyString()
        println "{{html clean=\"false\" wiki=\"true\"}}"
        println "&amp;lt;div id='livetableJson' style = \"display:none\"&amp;gt;"
        //println "&amp;lt;div id='livetableJson'&amp;gt;"
        println finalStr;
        println "&amp;lt;/div&amp;gt;"
        println "{{/html}}"
    }
    return true
}
 //--=============== END

if(listKey.size() &amp;lt;= 0){   
    println "{{html clean=\"false\" wiki=\"true\"}}"
    println "&amp;lt;center&amp;gt;"
    println "&amp;lt;div id=\"livetblContent\" style=\"width:100%;clear:both;align:middle;margin-top:10px\"&amp;gt;"   
    println "Statistics Data"
    println "&amp;lt;table id=\"livetableList\" style=\"width:100%;align:center\"&amp;gt;&amp;lt;/table&amp;gt;"    
    println "&amp;lt;div id=\"livetablePager\"&amp;gt;&amp;lt;/div&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
    println "&amp;lt;/center&amp;gt;"
    
    println "&amp;lt;div id=\"testDiv\"&amp;gt;&amp;amp;nbsp;&amp;lt;/div&amp;gt;"
    println "{{/html}}"
}
{{/groovy}}
&lt;/content&gt;&lt;/xwikidoc&gt;@


61.47
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376568158000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;61.47&lt;/version&gt;
d2963 1
a2963 1
						       drawPieChart([data_all[j]], i + "_pie_" + j, chartName)
@


61.46
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376568051000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;61.46&lt;/version&gt;
@


61.45
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376567801000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;61.45&lt;/version&gt;
d2963 1
a2963 1
						       drawPieChart([data_all[j]], i + "_pie", chartName)
@


61.44
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376561895000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;61.44&lt;/version&gt;
d2963 1
a2963 1
						       drawPieChart(data_all, i + "_pie", chartName)
@


61.43
log
@@
text
@&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xwikidoc&gt;
&lt;web&gt;WiperDog&lt;/web&gt;
&lt;name&gt;WebHome&lt;/name&gt;
&lt;language&gt;&lt;/language&gt;
&lt;defaultLanguage&gt;en&lt;/defaultLanguage&gt;
&lt;translation&gt;0&lt;/translation&gt;
&lt;parent&gt;&lt;/parent&gt;
&lt;creator&gt;XWiki.Admin&lt;/creator&gt;
&lt;author&gt;XWiki.Admin&lt;/author&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;contentAuthor&gt;XWiki.Admin&lt;/contentAuthor&gt;
&lt;creationDate&gt;1376364375000&lt;/creationDate&gt;
&lt;date&gt;1376561773000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376560922000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.43&lt;/version&gt;
&lt;title&gt;WiperDog&lt;/title&gt;
&lt;defaultTemplate&gt;&lt;/defaultTemplate&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;comment&gt;&lt;/comment&gt;
&lt;minorEdit&gt;true&lt;/minorEdit&gt;
&lt;syntaxId&gt;xwiki/2.1&lt;/syntaxId&gt;
&lt;hidden&gt;false&lt;/hidden&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;047293a8-524d-45e4-af52-cd944523d5d0&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
/*
 * jQuery timepicker addon
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 1.3.1
 * Last Modified: 07/07/2013
 *
 * Copyright 2013 Trent Richardson
 * You may use this project under MIT or GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 */

/*jslint evil: true, white: false, undef: false, nomen: false */

(function($) {

	/*
	* Lets not redefine timepicker, Prevent "Uncaught RangeError: Maximum call stack size exceeded"
	*/
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return;
	}

	/*
	* Extend jQueryUI, get it started with our version number
	*/
	$.extend($.ui, {
		timepicker: {
			version: "1.3.1"
		}
	});

	/* 
	* Timepicker manager.
	* Use the singleton instance of this class, $.timepicker, to interact with the time picker.
	* Settings for (groups of) time pickers are maintained in an instance object,
	* allowing multiple different settings on the same page.
	*/
	var Timepicker = function() {
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[''] = { // Default regional settings
			currentText: 'Now',
			closeText: 'Done',
			amNames: ['AM', 'A'],
			pmNames: ['PM', 'P'],
			timeFormat: 'HH:mm',
			timeSuffix: '',
			timeOnlyTitle: 'Choose Time',
			timeText: 'Time',
			hourText: 'Hour',
			minuteText: 'Minute',
			secondText: 'Second',
			millisecText: 'Millisecond',
			microsecText: 'Microsecond',
			timezoneText: 'Time Zone',
			isRTL: false
		};
		this._defaults = { // Global defaults for all the datetime picker instances
			showButtonPanel: true,
			timeOnly: false,
			showHour: null,
			showMinute: null,
			showSecond: null,
			showMillisec: null,
			showMicrosec: null,
			showTimezone: null,
			showTime: true,
			stepHour: 1,
			stepMinute: 1,
			stepSecond: 1,
			stepMillisec: 1,
			stepMicrosec: 1,
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null,
			hourMin: 0,
			minuteMin: 0,
			secondMin: 0,
			millisecMin: 0,
			microsecMin: 0,
			hourMax: 23,
			minuteMax: 59,
			secondMax: 59,
			millisecMax: 999,
			microsecMax: 999,
			minDateTime: null,
			maxDateTime: null,
			onSelect: null,
			hourGrid: 0,
			minuteGrid: 0,
			secondGrid: 0,
			millisecGrid: 0,
			microsecGrid: 0,
			alwaysSetTime: true,
			separator: ' ',
			altFieldTimeOnly: true,
			altTimeFormat: null,
			altSeparator: null,
			altTimeSuffix: null,
			pickerTimeFormat: null,
			pickerTimeSuffix: null,
			showTimepicker: true,
			timezoneList: null,
			addSliderAccess: false,
			sliderAccessArgs: null,
			controlType: 'slider',
			defaultValue: null,
			parse: 'strict'
		};
		$.extend(this._defaults, this.regional['']);
	};

	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: '',
		formattedDate: '',
		formattedTime: '',
		formattedDateTime: '',
		timezoneList: null,
		units: ['hour','minute','second','millisec', 'microsec'],
		support: {},
		control: null,

		/* 
		* Override the default settings for all instances of the time picker.
		* @@param  settings  object - the new settings to use as defaults (anonymous object)
		* @@return the manager object
		*/
		setDefaults: function(settings) {
			extendRemove(this._defaults, settings || {});
			return this;
		},

		/*
		* Create a new Timepicker instance
		*/
		_newInst: function($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
            	fns = {},
		    	overrides, i;

			for (var attrName in this._defaults) {
				if(this._defaults.hasOwnProperty(attrName)){
					var attrValue = $input.attr('time:' + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue);
						} catch (err) {
							inlineSettings[attrName] = attrValue;
						}
					}
				}
			}

		    overrides = {
		        beforeShow: function (input, dp_inst) {
		            if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
		                return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst);
		            }
		        },
		        onChangeMonthYear: function (year, month, dp_inst) {
		            // Update the time as well : this prevents the time from disappearing from the $input field.
		            tp_inst._updateDateTime(dp_inst);
		            if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
		                tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst);
		            }
		        },
		        onClose: function (dateText, dp_inst) {
		            if (tp_inst.timeDefined === true &amp;amp;&amp;amp; $input.val() !== '') {
		                tp_inst._updateDateTime(dp_inst);
		            }
		            if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
		                tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst);
		            }
		        }
		    };
		    for (i in overrides) {
		        if (overrides.hasOwnProperty(i)) {
		            fns[i] = opts[i] || null;
		        }
		    }

		    tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
		        evnts:fns,
		        timepicker: tp_inst // add timepicker as a property of datepicker: $.datepicker._get(dp_inst, 'timepicker');
		    });
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function(val) {
				return val.toUpperCase();
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function(val) {
				return val.toUpperCase();
			});

			// detect which units are supported
			tp_inst.support = detectSupport(
					tp_inst._defaults.timeFormat + 
					(tp_inst._defaults.pickerTimeFormat? tp_inst._defaults.pickerTimeFormat:'') + 
					(tp_inst._defaults.altTimeFormat? tp_inst._defaults.altTimeFormat:''));

			// controlType is string - key to our this._controls
			if(typeof(tp_inst._defaults.controlType) === 'string'){
				if(tp_inst._defaults.controlType == 'slider' &amp;amp;&amp;amp; typeof(jQuery.ui.slider) === 'undefined'){
					tp_inst._defaults.controlType = 'select';
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType];
			}
			// controlType is an object and must implement create, options, value methods
			else{ 
				tp_inst.control = tp_inst._defaults.controlType;
			}

			// prep the timezone options
			var timezoneList = [-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,
					0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList;
			}
			var tzl=timezoneList.length,tzi=0,tzv=null;
			if (tzl &amp;gt; 0 &amp;amp;&amp;amp; typeof timezoneList[0] !== 'object') {
				for(; tzi&amp;lt;tzl; tzi++){
					tzv = timezoneList[tzi];
					timezoneList[tzi] = { value: tzv, label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601) };
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;

			// set the default units
			tp_inst.timezone = tp_inst._defaults.timezone !== null? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) : 
							((new Date()).getTimezoneOffset()*-1);
			tp_inst.hour = tp_inst._defaults.hour &amp;lt; tp_inst._defaults.hourMin? tp_inst._defaults.hourMin : 
							tp_inst._defaults.hour &amp;gt; tp_inst._defaults.hourMax? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute &amp;lt; tp_inst._defaults.minuteMin? tp_inst._defaults.minuteMin : 
							tp_inst._defaults.minute &amp;gt; tp_inst._defaults.minuteMax? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second &amp;lt; tp_inst._defaults.secondMin? tp_inst._defaults.secondMin : 
							tp_inst._defaults.second &amp;gt; tp_inst._defaults.secondMax? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec &amp;lt; tp_inst._defaults.millisecMin? tp_inst._defaults.millisecMin : 
							tp_inst._defaults.millisec &amp;gt; tp_inst._defaults.millisecMax? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec &amp;lt; tp_inst._defaults.microsecMin? tp_inst._defaults.microsecMin : 
							tp_inst._defaults.microsec &amp;gt; tp_inst._defaults.microsecMax? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = '';
			tp_inst.$input = $input;

			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField).css({
					cursor: 'pointer'
				}).focus(function() {
					$input.trigger("focus");
				});
			}

			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date();
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date();
			}

			// datepicker needs minDate/maxDate, timepicker needs minDateTime/maxDateTime..
			if (tp_inst._defaults.minDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime());
			}
			if (tp_inst._defaults.minDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime());
			}
			if (tp_inst._defaults.maxDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime());
			}
			if (tp_inst._defaults.maxDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime());
			}
			tp_inst.$input.bind('focus', function() {
				tp_inst._onFocus();
			});

			return tp_inst;
		},

		/*
		* add our sliders to the calendar
		*/
		_addTimePicker: function(dp_inst) {
			var currDT = (this.$altInput &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly) ? this.$input.val() + ' ' + this.$altInput.val() : this.$input.val();

			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
		},

		/*
		* parse the time string from input value or _setTime
		*/
		_parseTime: function(timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0]);
			}

			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, 'dateFormat');
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false;
					}
					$.extend(this, parseRes.timeObj);
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err +
									"\ndate/time string = " + timeString +
									"\ntimeFormat = " + this._defaults.timeFormat +
									"\ndateFormat = " + dp_dateFormat);
					return false;
				}
				return true;
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false;
				}
				$.extend(this, timeObj);
				return true;
			}
		},

		/*
		* generate and inject html for timepicker into ui datepicker
		*/
		_injectTimePicker: function() {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = '',
				uitem = '',
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i=0,
				l=0;

			// Prevent displaying twice
			if ($dp.find("div.ui-timepicker-div").length === 0 &amp;amp;&amp;amp; o.showTimepicker) {
				var noDisplay = ' style="display:none;"',
					html = '&amp;lt;div class="ui-timepicker-div'+ (o.isRTL? ' ui-timepicker-rtl' : '') +'"&amp;gt;&amp;lt;dl&amp;gt;' + '&amp;lt;dt class="ui_tpicker_time_label"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;' + o.timeText + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_time"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the markup
				for(i=0,l=this.units.length; i&amp;lt;l; i++){
					litem = this.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// Added by Peter Medeiros:
					// - Figure out what the hour/minute/second max should be based on the step values.
					// - Example: if stepMinute is 15, then minMax is 45.
					max[litem] = parseInt((o[litem+'Max'] - ((o[litem+'Max'] - o[litem+'Min']) % o['step'+uitem])), 10);
					gridSize[litem] = 0;

					html += '&amp;lt;dt class="ui_tpicker_'+ litem +'_label"' + (show ? '' : noDisplay) + '&amp;gt;' + o[litem +'Text'] + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_'+ litem +'"&amp;gt;&amp;lt;div class="ui_tpicker_'+ litem +'_slider"' + (show ? '' : noDisplay) + '&amp;gt;&amp;lt;/div&amp;gt;';

					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						html += '&amp;lt;div style="padding-left: 1px"&amp;gt;&amp;lt;table class="ui-tpicker-grid-label"&amp;gt;&amp;lt;tr&amp;gt;';

						if(litem == 'hour'){
							for (var h = o[litem+'Min']; h &amp;lt;= max[litem]; h += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm? 'hht':'HH', {hour:h}, o);									
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + tmph + '&amp;lt;/td&amp;gt;';
							}
						}
						else{
							for (var m = o[litem+'Min']; m &amp;lt;= max[litem]; m += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + ((m &amp;lt; 10) ? '0' : '') + m + '&amp;lt;/td&amp;gt;';
							}
						}

						html += '&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;&amp;lt;/div&amp;gt;';
					}
					html += '&amp;lt;/dd&amp;gt;';
				}
				
				// Timezone
				var showTz = o.showTimezone !== null? o.showTimezone : this.support.timezone;
				html += '&amp;lt;dt class="ui_tpicker_timezone_label"' + (showTz ? '' : noDisplay) + '&amp;gt;' + o.timezoneText + '&amp;lt;/dt&amp;gt;';
				html += '&amp;lt;dd class="ui_tpicker_timezone" ' + (showTz ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the elements from string
				html += '&amp;lt;/dl&amp;gt;&amp;lt;/div&amp;gt;';
				var $tp = $(html);

				// if we only want time picker...
				if (o.timeOnly === true) {
					$tp.prepend('&amp;lt;div class="ui-widget-header ui-helper-clearfix ui-corner-all"&amp;gt;' + '&amp;lt;div class="ui-datepicker-title"&amp;gt;' + o.timeOnlyTitle + '&amp;lt;/div&amp;gt;' + '&amp;lt;/div&amp;gt;');
					$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();
				}
				
				// add sliders, adjust grids, add events
				for(i=0,l=tp_inst.units.length; i&amp;lt;l; i++){
					litem = tp_inst.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// add the slider
					tp_inst[litem+'_slider'] = tp_inst.control.create(tp_inst, $tp.find('.ui_tpicker_'+litem+'_slider'), litem, tp_inst[litem], o[litem+'Min'], max[litem], o['step'+uitem]);

					// adjust the grid and add click event
					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						size = 100 * gridSize[litem] * o[litem+'Grid'] / (max[litem] - o[litem+'Min']);
						$tp.find('.ui_tpicker_'+litem+' table').css({
							width: size + "%",
							marginLeft: o.isRTL? '0' : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL? ((size / (-2 * gridSize[litem])) + "%") : '0',
							borderCollapse: 'collapse'
						}).find("td").click(function(e){
								var $t = $(this),
									h = $t.html(),
									n = parseInt(h.replace(/[^0-9]/g),10),
									ap = h.replace(/[^apm]/ig),
									f = $t.data('for'); // loses scope, so we use data-for

								if(f == 'hour'){
									if(ap.indexOf('p') !== -1 &amp;amp;&amp;amp; n &amp;lt; 12){
										n += 12;
									}
									else{
										if(ap.indexOf('a') !== -1 &amp;amp;&amp;amp; n === 12){
											n = 0;
										}
									}
								}
								
								tp_inst.control.value(tp_inst, tp_inst[f+'_slider'], litem, n);

								tp_inst._onTimeChange();
								tp_inst._onSelectHandler();
							}).css({
								cursor: 'pointer',
								width: (100 / gridSize[litem]) + '%',
								textAlign: 'center',
								overflow: 'hidden'
							});
					} // end if grid &amp;gt; 0
				} // end for loop

				// Add timezone options
				this.timezone_select = $tp.find('.ui_tpicker_timezone').append('&amp;lt;select&amp;gt;&amp;lt;/select&amp;gt;').find("select");
				$.fn.append.apply(this.timezone_select,
				$.map(o.timezoneList, function(val, idx) {
					return $("&amp;lt;option /&amp;gt;").val(typeof val == "object" ? val.value : val).text(typeof val == "object" ? val.label : val);
				}));
				if (typeof(this.timezone) != "undefined" &amp;amp;&amp;amp; this.timezone !== null &amp;amp;&amp;amp; this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset()*-1;
					if (local_timezone == this.timezone) {
						selectLocalTimezone(tp_inst);
					} else {
						this.timezone_select.val(this.timezone);
					}
				} else {
					if (typeof(this.hour) != "undefined" &amp;amp;&amp;amp; this.hour !== null &amp;amp;&amp;amp; this.hour !== "") {
						this.timezone_select.val(o.timezone);
					} else {
						selectLocalTimezone(tp_inst);
					}
				}
				this.timezone_select.change(function() {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
				});
				// End timezone options
				
				// inject timepicker into datepicker
				var $buttonPanel = $dp.find('.ui-datepicker-buttonpane');
				if ($buttonPanel.length) {
					$buttonPanel.before($tp);
				} else {
					$dp.append($tp);
				}

				this.$timeObj = $tp.find('.ui_tpicker_time');

				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined;
				}

				// slideAccess integration: http://trentrichardson.com/2011/11/11/jquery-ui-sliders-and-touch-accessibility/
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
						
					setTimeout(function() { // fix for inline mode
						if ($tp.find('.ui-slider-access').length === 0) {
							$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);

							// fix any grids since sliders are shorter
							var sliderAccessWidth = $tp.find('.ui-slider-access:eq(0)').outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find('table:visible').each(function() {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl? 'marginRight':'marginLeft').toString().replace('%', ''),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + '%',
										css = { width: newWidth, marginRight: 0, marginLeft: 0 };
									css[rtl? 'marginRight':'marginLeft'] = newMarginLeft;
									$g.css(css);
								});
							}
						}
					}, 10);
				}
				// end slideAccess integration

				tp_inst._limitMinMaxDateTime(this.inst, true);
			}
		},

		/*
		* This function tries to limit the ability to go outside the
		* min/max date range
		*/
		_limitMinMaxDateTime: function(dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);

			if (!this._defaults.showTimepicker) {
				return;
			} // No time so nothing to check here

			if ($.datepicker._get(dp_inst, 'minDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'minDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, 'minDateTime'),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin;
				}

				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour &amp;lt;= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute &amp;lt;= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second &amp;lt;= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if(this.millisec &amp;lt;= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;lt; this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin;
									}
									this._defaults.microsecMin = this.microsecMinOriginal;
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal;
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal;
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal;
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal;
				}
			}

			if ($.datepicker._get(dp_inst, 'maxDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'maxDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, 'maxDateTime'),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax;
				}

				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour &amp;gt;= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute &amp;gt;= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second &amp;gt;= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec &amp;gt;= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;gt; this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax;
									}
									this._defaults.microsecMax = this.microsecMaxOriginal;
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal;
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal;
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal;
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal;
				}
			}

			if (adjustSliders !== undefined &amp;amp;&amp;amp; adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10);
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);

				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, 'hour', { min: this._defaults.hourMin, max: hourMax });
					this.control.value(this, this.hour_slider, 'hour', this.hour - (this.hour % this._defaults.stepHour));
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, 'minute', { min: this._defaults.minuteMin, max: minMax });
					this.control.value(this, this.minute_slider, 'minute', this.minute - (this.minute % this._defaults.stepMinute));
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, 'second', { min: this._defaults.secondMin, max: secMax });
					this.control.value(this, this.second_slider, 'second', this.second - (this.second % this._defaults.stepSecond));
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, 'millisec', { min: this._defaults.millisecMin, max: millisecMax });
					this.control.value(this, this.millisec_slider, 'millisec', this.millisec - (this.millisec % this._defaults.stepMillisec));
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, 'microsec', { min: this._defaults.microsecMin, max: microsecMax });
					this.control.value(this, this.microsec_slider, 'microsec', this.microsec - (this.microsec % this._defaults.stepMicrosec));
				}
			}

		},

		/*
		* when a slider moves, set the internal time...
		* on time change is also called when the time is updated in the text field
		*/
		_onTimeChange: function() {
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, 'hour') : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, 'minute') : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, 'second') : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, 'millisec') : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, 'microsec') : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;

			if (typeof(hour) == 'object') {
				hour = false;
			}
			if (typeof(minute) == 'object') {
				minute = false;
			}
			if (typeof(second) == 'object') {
				second = false;
			}
			if (typeof(millisec) == 'object') {
				millisec = false;
			}
			if (typeof(microsec) == 'object') {
				microsec = false;
			}
			if (typeof(timezone) == 'object') {
				timezone = false;
			}

			if (hour !== false) {
				hour = parseInt(hour, 10);
			}
			if (minute !== false) {
				minute = parseInt(minute, 10);
			}
			if (second !== false) {
				second = parseInt(second, 10);
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10);
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10);
			}

			var ampm = o[hour &amp;lt; 12 ? 'amNames' : 'pmNames'][0];

			// If the update was done in the input field, the input field should not be updated.
			// If the update was done using the sliders, update the input field.
			var hasChanged = (hour != this.hour || minute != this.minute || second != this.second || millisec != this.millisec || microsec != this.microsec 
								|| (this.ampm.length &amp;gt; 0 &amp;amp;&amp;amp; (hour &amp;lt; 12) != ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) 
								|| (this.timezone !== null &amp;amp;&amp;amp; timezone != this.timezone));

			if (hasChanged) {

				if (hour !== false) {
					this.hour = hour;
				}
				if (minute !== false) {
					this.minute = minute;
				}
				if (second !== false) {
					this.second = second;
				}
				if (millisec !== false) {
					this.millisec = millisec;
				}
				if (microsec !== false) {
					this.microsec = microsec;
				}
				if (timezone !== false) {
					this.timezone = timezone;
				}

				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0]);
				}

				this._limitMinMaxDateTime(this.inst, true);
			}
			if (this.support.ampm) {
				this.ampm = ampm;
			}

			// Updates the time within the timepicker
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if(pickerTimeFormat === o.timeFormat){
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix);
				}
				else{
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix);
				}
			}

			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime();
			}
		},

		/*
		* call custom onSelect.
		* bind to sliders slidestop, and grid click.
		*/
		_onSelectHandler: function() {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect &amp;amp;&amp;amp; inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this]);
			}
		},

		/*
		* update our input with the new date time..
		*/
		_updateDateTime: function(dp_inst) {
			dp_inst = this.inst || dp_inst;
			//var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
			var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay)),
				dateFmt = $.datepicker._get(dp_inst, 'dateFormat'),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null &amp;amp;&amp;amp; this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			
			// if a slider was changed but datepicker doesn't have a value yet, set it
			if(dp_inst.lastVal===""){
                dp_inst.currentYear=dp_inst.selectedYear;
                dp_inst.currentMonth=dp_inst.selectedMonth;
                dp_inst.currentDay=dp_inst.selectedDay;
            }

			/*
			* remove following lines to force every changes in date picker to change the input value
			* Bug descriptions: when an input field has a default value, and click on the field to pop up the date picker. 
			* If the user manually empty the value in the input field, the date picker will never change selected value.
			*/
			//if (dp_inst.lastVal !== undefined &amp;amp;&amp;amp; (dp_inst.lastVal.length &amp;gt; 0 &amp;amp;&amp;amp; this.$input.val().length === 0)) {
			//	return;
			//}

			if (this._defaults.timeOnly === true) {
				formattedDateTime = this.formattedTime;
			} else if (this._defaults.timeOnly !== true &amp;amp;&amp;amp; (this._defaults.alwaysSetTime || timeAvailable)) {
				formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix;
			}

			this.formattedDateTime = formattedDateTime;

			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate);
			} else if (this.$altInput &amp;amp;&amp;amp; this._defaults.timeOnly === false &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly === true) {
				this.$altInput.val(this.formattedTime);
				this.$input.val(this.formattedDate);
			} else if (this.$altInput) {
				this.$input.val(formattedDateTime);
				var altFormattedDateTime = '',
					altSeparator = this._defaults.altSeparator ? this._defaults.altSeparator : this._defaults.separator,
					altTimeSuffix = this._defaults.altTimeSuffix ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
				
				if(!this._defaults.timeOnly){
					if (this._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg);
					}
					else{
						altFormattedDateTime = this.formattedDate;
					}

					if (altFormattedDateTime){
						altFormattedDateTime += altSeparator;
					}
				}

				if(this._defaults.altTimeFormat){
					altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix;
				}
				else{
					altFormattedDateTime += this.formattedTime + altTimeSuffix;
				}
				this.$altInput.val(altFormattedDateTime);
			} else {
				this.$input.val(formattedDateTime);
			}

			this.$input.trigger("change");
		},

		_onFocus: function() {
			if (!this.$input.val() &amp;amp;&amp;amp; this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, 'timepicker');
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst);
						} catch (err) {
							$.timepicker.log(err);
						}
					}
				}
			}
		},

		/*
		* Small abstraction to control types
		* We can add more, just be sure to follow the pattern: create, options, value
		*/
		_controls: {
			// slider methods
			slider: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var rtl = tp_inst._defaults.isRTL; // if rtl go -60-&amp;gt;0 instead of 0-&amp;gt;60
					return obj.prop('slide', null).slider({
						orientation: "horizontal",
						value: rtl? val*-1 : val,
						min: rtl? max*-1 : min,
						max: rtl? min*-1 : max,
						step: step,
						slide: function(event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl? ui.value*-1:ui.value);
							tp_inst._onTimeChange();
						},
						stop: function(event, ui) {
							tp_inst._onSelectHandler();
						}
					});	
				},
				options: function(tp_inst, obj, unit, opts, val){
					if(tp_inst._defaults.isRTL){
						if(typeof(opts) == 'string'){
							if(opts == 'min' || opts == 'max'){
								if(val !== undefined){
									return obj.slider(opts, val*-1);
								}
								return Math.abs(obj.slider(opts));
							}
							return obj.slider(opts);
						}
						var min = opts.min, 
							max = opts.max;
						opts.min = opts.max = null;
						if(min !== undefined){
							opts.max = min * -1;
						}
						if(max !== undefined){
							opts.min = max * -1;
						}
						return obj.slider(opts);
					}
					if(typeof(opts) == 'string' &amp;amp;&amp;amp; val !== undefined){
							return obj.slider(opts, val);
					}
					return obj.slider(opts);
				},
				value: function(tp_inst, obj, unit, val){
					if(tp_inst._defaults.isRTL){
						if(val !== undefined){
							return obj.slider('value', val*-1);
						}
						return Math.abs(obj.slider('value'));
					}
					if(val !== undefined){
						return obj.slider('value', val);
					}
					return obj.slider('value');
				}
			},
			// select methods
			select: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var sel = '&amp;lt;select class="ui-timepicker-select" data-unit="'+ unit +'" data-min="'+ min +'" data-max="'+ max +'" data-step="'+ step +'"&amp;gt;',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;

					for(var i=min; i&amp;lt;=max; i+=step){						
						sel += '&amp;lt;option value="'+ i +'"'+ (i==val? ' selected':'') +'&amp;gt;';
						if(unit == 'hour'){
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig,'')), {hour:i}, tp_inst._defaults);
						}
						else if(unit == 'millisec' || unit == 'microsec' || i &amp;gt;= 10){ sel += i; }
						else {sel += '0'+ i.toString(); }
						sel += '&amp;lt;/option&amp;gt;';
					}
					sel += '&amp;lt;/select&amp;gt;';

					obj.children('select').remove();

					$(sel).appendTo(obj).change(function(e){
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
					});

					return obj;
				},
				options: function(tp_inst, obj, unit, opts, val){
					var o = {},
						$t = obj.children('select');
					if(typeof(opts) == 'string'){
						if(val === undefined){
							return $t.data(opts);
						}
						o[opts] = val;	
					}
					else{ o = opts; }
					return tp_inst.control.create(tp_inst, obj, $t.data('unit'), $t.val(), o.min || $t.data('min'), o.max || $t.data('max'), o.step || $t.data('step'));
				},
				value: function(tp_inst, obj, unit, val){
					var $t = obj.children('select');
					if(val !== undefined){
						return $t.val(val);
					}
					return $t.val();
				}
			}
		} // end _controls

	});

	$.fn.extend({
		/*
		* shorthand just to use timepicker..
		*/
		timepicker: function(o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);

			if (typeof o == 'object') {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				});
			}

			return $(this).each(function() {
				$.fn.datetimepicker.apply($(this), tmp_args);
			});
		},

		/*
		* extend timepicker to datepicker
		*/
		datetimepicker: function(o) {
			o = o || {};
			var tmp_args = arguments;

			if (typeof(o) == 'string') {
				if (o == 'getDate') {
					return $.fn.datepicker.apply($(this[0]), tmp_args);
				} else {
					return this.each(function() {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args);
					});
				}
			} else {
				return this.each(function() {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults);
				});
			}
		}
	});

	/*
	* Public Utility to parse date and time
	*/
	$.datepicker.parseDateTime = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec);
		}

		return parseRes.date;
	};

	/*
	* Public utility to parse time
	*/
	$.datepicker.parseTime = function(timeFormat, timeString, options) {		
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g,'').indexOf('Z') !== -1);

		// Strict parse requires the timeString to match the timeFormat exactly
		var strictParse = function(f, s, o){

			// pattern for standard and localized AM/PM markers
			var getPatternAmpm = function(amNames, pmNames) {
				var markers = [];
				if (amNames) {
					$.merge(markers, amNames);
				}
				if (pmNames) {
					$.merge(markers, pmNames);
				}
				markers = $.map(markers, function(val) {
					return val.replace(/[.*+?|()\[\]{}\\]/g, '\\$&amp;amp;');
				});
				return '(' + markers.join('|') + ')?';
			};

			// figure out position of time elements.. cause js cant do named captures
			var getFormatPositions = function(timeFormat) {
				var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
					orders = {
						h: -1,
						m: -1,
						s: -1,
						l: -1,
						c: -1,
						t: -1,
						z: -1
					};

				if (finds) {
					for (var i = 0; i &amp;lt; finds.length; i++) {
						if (orders[finds[i].toString().charAt(0)] == -1) {
							orders[finds[i].toString().charAt(0)] = i + 1;
						}
					}
				}
				return orders;
			};

			var regstr = '^' + f.toString()
					.replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
							var ml = match.length;
							switch (match.charAt(0).toLowerCase()) {
								case 'h': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'm': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 's': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'l': return '(\\d?\\d?\\d)';
								case 'c': return '(\\d?\\d?\\d)';
								case 'z': return '(z|[-+]\\d\\d:?\\d\\d|\\S+)?';
								case 't': return getPatternAmpm(o.amNames, o.pmNames);
								default:    // literal escaped in quotes
									return '(' + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function (m) { return "\\" + m; }) + ')?';
							}
						})
					.replace(/\s/g, '\\s?') +
					o.timeSuffix + '$',
				order = getFormatPositions(f),
				ampm = '',
				treg;

			treg = s.match(new RegExp(regstr, 'i'));

			var resTime = {
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0
			};

			if (treg) {
				if (order.t !== -1) {
					if (treg[order.t] === undefined || treg[order.t].length === 0) {
						ampm = '';
						resTime.ampm = '';
					} else {
						ampm = $.inArray(treg[order.t].toUpperCase(), o.amNames) !== -1 ? 'AM' : 'PM';
						resTime.ampm = o[ampm == 'AM' ? 'amNames' : 'pmNames'][0];
					}
				}

				if (order.h !== -1) {
					if (ampm == 'AM' &amp;amp;&amp;amp; treg[order.h] == '12') {
						resTime.hour = 0; // 12am = 0 hour
					} else {
						if (ampm == 'PM' &amp;amp;&amp;amp; treg[order.h] != '12') {
							resTime.hour = parseInt(treg[order.h], 10) + 12; // 12pm = 12 hour, any other pm = hour + 12
						} else {
							resTime.hour = Number(treg[order.h]);
						}
					}
				}

				if (order.m !== -1) {
					resTime.minute = Number(treg[order.m]);
				}
				if (order.s !== -1) {
					resTime.second = Number(treg[order.s]);
				}
				if (order.l !== -1) {
					resTime.millisec = Number(treg[order.l]);
				}
				if (order.c !== -1) {
					resTime.microsec = Number(treg[order.c]);
				}
				if (order.z !== -1 &amp;amp;&amp;amp; treg[order.z] !== undefined) {
					resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z]);
				}


				return resTime;
			}
			return false;
		};// end strictParse

		// First try JS Date, if that fails, use strictParse
		var looseParse = function(f,s,o){
			try{
				var d = new Date('2012-01-01 '+ s);
				if(isNaN(d.getTime())){
					d = new Date('2012-01-01T'+ s);
					if(isNaN(d.getTime())){
						d = new Date('01/01/2012 '+ s);
						if(isNaN(d.getTime())){
							throw "Unable to parse time with native Date: "+ s;
						}
					}
				}

				return {
					hour: d.getHours(),
					minute: d.getMinutes(),
					second: d.getSeconds(),
					millisec: d.getMilliseconds(),
					microsec: d.getMicroseconds(),
					timezone: d.getTimezoneOffset()*-1
				};
			}
			catch(err){
				try{
					return strictParse(f,s,o);
				}
				catch(err2){
					$.timepicker.log("Unable to parse \ntimeString: "+ s +"\ntimeFormat: "+ f);
				}				
			}
			return false;
		}; // end looseParse
		
		if(typeof o.parse === "function"){
			return o.parse(timeFormat, timeString, o);
		}
		if(o.parse === 'loose'){
			return looseParse(timeFormat, timeString, o);
		}
		return strictParse(timeFormat, timeString, o);
	};

	/*
	* Public utility to format the time
	* format = string format of the time
	* time = a {}, not a Date() for timezones
	* options = essentially the regional[].. amNames, pmNames, ampm
	*/
	$.datepicker.formatTime = function(format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			timezone: 0
		}, time);

		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);

		if (hour &amp;gt; 11) {
			ampmName = options.pmNames[0];
		}

		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|('.*?'|".*?"))/g, function(match) {
		switch (match) {
			case 'HH':
				return ('0' + hour).slice(-2);
			case 'H':
				return hour;
			case 'hh':
				return ('0' + convert24to12(hour)).slice(-2);
			case 'h':
				return convert24to12(hour);
			case 'mm':
				return ('0' + time.minute).slice(-2);
			case 'm':
				return time.minute;
			case 'ss':
				return ('0' + time.second).slice(-2);
			case 's':
				return time.second;
			case 'l':
				return ('00' + time.millisec).slice(-3);
			case 'c':
				return ('00' + time.microsec).slice(-3);
			case 'z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, false);
			case 'Z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, true);
			case 'T': 
				return ampmName.charAt(0).toUpperCase();
			case 'TT': 
				return ampmName.toUpperCase();
			case 't':
				return ampmName.charAt(0).toLowerCase();
			case 'tt':
				return ampmName.toLowerCase();
			default:
				return match.replace(/\'/g, "") || "'";
			}
		});

		tmptime = $.trim(tmptime);
		return tmptime;
	};

	/*
	* the bad hack :/ override datepicker so it doesnt close on select
	// inspired: http://stackoverflow.com/questions/1252512/jquery-datepicker-prevent-closing-picker-when-clicking-a-date/1762378#1762378
	*/
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function(id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			tp_inst._limitMinMaxDateTime(inst, true);
			inst.inline = inst.stay_open = true;
			//This way the onSelect handler called from calendarpicker get the full dateTime
			this._base_selectDate(id, dateStr);
			inst.inline = inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst);
		} else {
			this._base_selectDate(id, dateStr);
		}
	};

	/*
	* second bad hack :/ override datepicker so it triggers an event when changing the input field
	* and does not redraw the datepicker on every selectDate event
	*/
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function(inst) {

		// don't popup the datepicker if there is another instance already opened
		var input = inst.input[0];
		if ($.datepicker._curInst &amp;amp;&amp;amp; $.datepicker._curInst != inst &amp;amp;&amp;amp; $.datepicker._datepickerShowing &amp;amp;&amp;amp; $.datepicker._lastInput != input) {
			return;
		}

		if (typeof(inst.stay_open) !== 'boolean' || inst.stay_open === false) {

			this._base_updateDatepicker(inst);

			// Reload the time control when changing something in the input text field.
			var tp_inst = this._get(inst, 'timepicker');
			if (tp_inst) {
				tp_inst._addTimePicker(inst);
			}
		}
	};

	/*
	* third bad hack :/ override datepicker so it allows spaces and colon in the input field
	*/
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if ($.datepicker._get(inst, 'constrainInput')) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null? tp_inst._defaults.showTimezone : tp_inst.support.timezone,					
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat')),
					datetimeChars = tp_inst._defaults.timeFormat.toString()
											.replace(/[hms]/g, '')
											.replace(/TT/g, ampm ? 'APM' : '')
											.replace(/Tt/g, ampm ? 'AaPpMm' : '')
											.replace(/tT/g, ampm ? 'AaPpMm' : '')
											.replace(/T/g, ampm ? 'AP' : '')
											.replace(/tt/g, ampm ? 'apm' : '')
											.replace(/t/g, ampm ? 'ap' : '') + 
											" " + tp_inst._defaults.separator + 
											tp_inst._defaults.timeSuffix + 
											(tz ? tp_inst._defaults.timezoneList.join('') : '') + 
											(tp_inst._defaults.amNames.join('')) + (tp_inst._defaults.pmNames.join('')) + 
											dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr &amp;lt; ' ' || !dateChars || datetimeChars.indexOf(chr) &amp;gt; -1);
			}
		}

		return $.datepicker._base_doKeyPress(event);
	};

	/*
	* Fourth bad hack :/ override _updateAlternate function used in inline mode to init altField
	*/
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	/* Update any alternate field to synchronise with the main field. */
	$.datepicker._updateAlternate = function(inst) {
		var tp_inst = this._get(inst, 'timepicker');
		if(tp_inst){
			var altField = tp_inst._defaults.altField;
			if (altField) { // update alternate field too
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = '', 
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator, 
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if(!tp_inst._defaults.timeOnly &amp;amp;&amp;amp; !tp_inst._defaults.altFieldTimeOnly &amp;amp;&amp;amp; date !== null){
					if(tp_inst._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime;
					}
					else{
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime;
					}
				}
				$(altField).val(altFormattedDateTime);
			}
		}
		else{
			$.datepicker._base_updateAlternate(inst);
		}
	};

	/*
	* Override key up event to sync manual input changes.
	*/
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst);
				} catch (err) {
					$.timepicker.log(err);
				}
			}
		}

		return $.datepicker._base_doKeyUp(event);
	};

	/*
	* override "Today" button to also grab the time.
	*/
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function(id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		this._base_gotoToday(id);
		var tp_inst = this._get(inst, 'timepicker');
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		$('.ui-datepicker-today', $dp).click();
	};

	/*
	* Disable &amp;amp; enable the Time in the datetimepicker
	*/
	$.datepicker._disableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst);
		}
	};

	$.datepicker._enableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst); // Could be disabled on page load
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create our own set time function
	*/
	$.datepicker._setTime = function(inst, date) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var defaults = tp_inst._defaults;

			// calling _setTime with no date sets time to defaults
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;

			//check if within min/max times.. 
			tp_inst._limitMinMaxDateTime(inst, true);

			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create new public method to set only time, callable as $().datepicker('setTime', date)
	*/
	$.datepicker._setTimeDatepicker = function(target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date == "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec);
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds());
				}
				if (tp_date.toString() == 'Invalid Date') {
					tp_date = undefined;
				}
				this._setTime(inst, tp_date);
			}
		}

	};

	/*
	* override setDate() to allow setting time too within Date object
	*/
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function(target, date) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		if(typeof(date) === 'string'){
			date = new Date(date);
			if(!date.getTime()){
				$.timepicker.log("Error creating Date object from string.");
			}
		}

		var tp_inst = this._get(inst, 'timepicker');
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds());
		} else {
			tp_date = date;
		}
		
		// This is important if you are using the timezone option, javascript's Date 
		// object will only return the timezone offset for the current locale, so we 
		// adjust it accordingly.  If not using timezone option this won't matter..
		// If a timezone is different in tp, keep the timezone as is
		if(tp_inst){
			// look out for DST if tz wasn't specified
			if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
				tp_inst.timezone = tp_date.getTimezoneOffset()*-1;
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone);
		}

		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true);
	};

	/*
	* override getDate() to allow getting time too within Date object
	*/
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function(target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			// if it hasn't yet been defined, grab from field
			if(inst.lastVal === undefined){
				this._setDateFromField(inst, noDefault);
			}

			var date = this._getDate(inst);
			if (date &amp;amp;&amp;amp; tp_inst._parseTime($(target).val(), tp_inst.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);

				// This is important if you are using the timezone option, javascript's Date 
				// object will only return the timezone offset for the current locale, so we 
				// adjust it accordingly.  If not using timezone option this won't matter..
				if(tp_inst.timezone != null){
					// look out for DST if tz wasn't specified
					if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
						tp_inst.timezone = date.getTimezoneOffset()*-1;
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
				}
			}
			return date;
		}
		return this._base_getDateDatepicker(target, noDefault);
	};

	/*
	* override parseDate() because UI 1.8.14 throws an error about "Extra characters"
	* An option in datapicker to ignore extra format characters would be nicer.
	*/
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function(format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings);
		} catch (err) {
			// Hack!  The error message ends with a colon, a space, and
			// the "extra" characters.  We rely on that instead of
			// attempting to perfectly reproduce the parsing algorithm.
			if (err.indexOf(":") &amp;gt;= 0) {
				date = this._base_parseDate(format, value.substring(0,value.length-(err.length-err.indexOf(':')-2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format);
			} else {
				throw err;
			}
		}
		return date;
	};

	/*
	* override formatDate to set date with time to the input
	*/
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function(inst, day, month, year) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val();
		}
		return this._base_formatDate(inst);
	};

	/*
	* override options setter to add time to maxDate(Time) and minDate(Time). MaxDate
	*/
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function(target, name, value) {
		var inst = this._getInst(target),
	        name_clone;
		if (!inst) {
			return null;
		}

		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop;
		    if (typeof name == 'string') { // if min/max was set with the string
		        if (name === 'minDate' || name === 'minDateTime') {
		            min = value;
		        } else if (name === 'maxDate' || name === 'maxDateTime') {
		            max = value;
		        } else if (name === 'onSelect') {
		            onselect = value;
		        } else if (overrides.hasOwnProperty(name)) {
		            if (typeof (value) === 'undefined') {
		                return overrides[name];
		            }
		            fns[name] = value;
		            name_clone = {}; //empty results in exiting function after overrides updated
		        }
		    } else if (typeof name == 'object') { //if min/max was set with the JSON
		        if (name.minDate) {
		            min = name.minDate;
		        } else if (name.minDateTime) {
		            min = name.minDateTime;
		        } else if (name.maxDate) {
		            max = name.maxDate;
		        } else if (name.maxDateTime) {
		            max = name.maxDateTime;
		        }
		        for (prop in overrides) {
		            if (overrides.hasOwnProperty(prop) &amp;amp;&amp;amp; name[prop]) {
		                fns[prop] = name[prop];
		            }
		        }
		    }
		    for (prop in fns) {
		        if (fns.hasOwnProperty(prop)) {
		            overrides[prop] = fns[prop];
		            if (!name_clone) { name_clone = $.extend({}, name);}
		            delete name_clone[prop];
		        }
		    }
		    if (name_clone &amp;amp;&amp;amp; isEmptyObject(name_clone)) { return; }
		    if (min) { //if min was set
		        if (min === 0) {
		            min = new Date();
		        } else {
		            min = new Date(min);
		        }
		        tp_inst._defaults.minDate = min;
		        tp_inst._defaults.minDateTime = min;
		    } else if (max) { //if max was set
		        if (max === 0) {
		            max = new Date();
		        } else {
		            max = new Date(max);
		        }
		        tp_inst._defaults.maxDate = max;
		        tp_inst._defaults.maxDateTime = max;
		    } else if (onselect) {
		        tp_inst._defaults.onSelect = onselect;
		    }
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name);
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
	};
	
	/*
	* jQuery isEmptyObject does not check hasOwnProperty - if someone has added to the object prototype,
	* it will return false for all objects
	*/
	var isEmptyObject = function(obj) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(obj)) {
				return false;
			}
		}
		return true;
	};

	/*
	* jQuery extend now ignores nulls!
	*/
	var extendRemove = function(target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] === null || props[name] === undefined) {
				target[name] = props[name];
			}
		}
		return target;
	};

	/*
	* Determine by the time format which units are supported
	* Returns an object of booleans for each unit
	*/
	var detectSupport = function(timeFormat){
		var tf = timeFormat.replace(/\'.*?\'/g,'').toLowerCase(), // removes literals
			isIn = function(f, t){ // does the format contain the token?
					return f.indexOf(t) !== -1? true:false; 
				};
		return {
				hour: isIn(tf,'h'),
				minute: isIn(tf,'m'),
				second: isIn(tf,'s'),
				millisec: isIn(tf,'l'),
				microsec: isIn(tf,'c'),
				timezone: isIn(tf,'z'),
				ampm: isIn(tf,'t') &amp;amp;&amp;amp; isIn(timeFormat,'h'),
				iso8601: isIn(timeFormat, 'Z')
			};
	};

	/*
	* Converts 24 hour format into 12 hour
	* Returns 12 hour without leading 0
	*/
	var convert24to12 = function(hour) {
		if (hour &amp;gt; 12) {
			hour = hour - 12;
		}

		if (hour === 0) {
			hour = 12;
		}

		return String(hour);
	};

	/*
	* Splits datetime string into date ans time substrings.
	* Throws exception when date can't be parsed
	* Returns [dateString, timeString]
	*/
	var splitDateTime = function(dateFormat, dateTimeString, dateSettings, timeSettings) {
		try {
			// The idea is to get the number separator occurances in datetime and the time format requested (since time has 
			// fewer unknowns, mostly numbers and am/pm). We will use the time pattern to split.
			var separator = timeSettings &amp;amp;&amp;amp; timeSettings.separator ? timeSettings.separator : $.timepicker._defaults.separator,
				format = timeSettings &amp;amp;&amp;amp; timeSettings.timeFormat ? timeSettings.timeFormat : $.timepicker._defaults.timeFormat,
				timeParts = format.split(separator), // how many occurances of separator may be in our format?
				timePartsLen = timeParts.length,
				allParts = dateTimeString.split(separator),
				allPartsLen = allParts.length;

			if (allPartsLen &amp;gt; 1) {
				return [
						allParts.splice(0,allPartsLen-timePartsLen).join(separator),
						allParts.splice(0,timePartsLen).join(separator)
					];
			}

		} catch (err) {
			$.timepicker.log('Could not split the date from the time. Please check the following datetimepicker options' +
					"\nthrown error: " + err +
					"\ndateTimeString" + dateTimeString +
					"\ndateFormat = " + dateFormat +
					"\nseparator = " + timeSettings.separator +
					"\ntimeFormat = " + timeSettings.timeFormat);

			if (err.indexOf(":") &amp;gt;= 0) {
				// Hack!  The error message ends with a colon, a space, and
				// the "extra" characters.  We rely on that instead of
				// attempting to perfectly reproduce the parsing algorithm.
				var dateStringLength = dateTimeString.length - (err.length - err.indexOf(':') - 2),
					timeString = dateTimeString.substring(dateStringLength);

				return [$.trim(dateTimeString.substring(0, dateStringLength)), $.trim(dateTimeString.substring(dateStringLength))];

			} else {
				throw err;
			}
		}
		return [dateTimeString, ''];
	};

	/*
	* Internal function to parse datetime interval
	* Returns: {date: Date, timeObj: Object}, where
	*   date - parsed date without time (type Date)
	*   timeObj = {hour: , minute: , second: , millisec: , microsec: } - parsed time. Optional
	*/
	var parseDateTimeInternal = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var date;
		var splitRes = splitDateTime(dateFormat, dateTimeString, dateSettings, timeSettings);
		date = $.datepicker._base_parseDate(dateFormat, splitRes[0], dateSettings);
		if (splitRes[1] !== '') {
			var timeString = splitRes[1],
				parsedTime = $.datepicker.parseTime(timeFormat, timeString, timeSettings);

			if (parsedTime === null) {
				throw 'Wrong time format';
			}
			return {
				date: date,
				timeObj: parsedTime
			};
		} else {
			return {
				date: date
			};
		}
	};

	/*
	* Internal function to set timezone_select to the local timezone
	*/
	var selectLocalTimezone = function(tp_inst, date) {
		if (tp_inst &amp;amp;&amp;amp; tp_inst.timezone_select) {
			var now = typeof date !== 'undefined' ? date : new Date();
			tp_inst.timezone_select.val(now.getTimezoneOffset()*-1);
		}
	};

	/*
	* Create a Singleton Insance
	*/
	$.timepicker = new Timepicker();

	/**
	 * Get the timezone offset as string from a date object (eg '+0530' for UTC+5.5)
	 * @@param  number if not a number this value is returned
	 * @@param boolean if true formats in accordance to iso8601 "+12:45"
	 * @@return string
	 */
	$.timepicker.timezoneOffsetString = function(tzMinutes, iso8601) {
		if(isNaN(tzMinutes) || tzMinutes &amp;gt; 840){
			return tzMinutes;
		}

		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601? ':':'',
			tz = (off &amp;gt;= 0 ? '+' : '-') + ('0' + (hours * 101).toString()).slice(-2) + iso + ('0' + (minutes * 101).toString()).slice(-2);
		
		if(tz == '+00:00'){
			return 'Z';
		}
		return tz;
	};

	/**
	 * Get the number in minutes that represents a timezone string
	 * @@param  string formated like "+0500", "-1245"
	 * @@return number
	 */
	$.timepicker.timezoneOffsetNumber = function(tzString) {
		tzString = tzString.toString().replace(':',''); // excuse any iso8601, end up with "+1245"

		if(tzString.toUpperCase() === 'Z'){ // if iso8601 with Z, its 0 minute offset
			return 0;
		}

		if(!/^(\-|\+)\d{4}$/.test(tzString)){ // possibly a user defined tz, so just give it back
			return tzString;
		}

		return ((tzString.substr(0,1) =='-'? -1 : 1) * // plus or minus
					((parseInt(tzString.substr(1,2),10)*60) + // hours (converted to minutes)
					parseInt(tzString.substr(3,2),10))); // minutes
	};

	/**
	 * No way to set timezone in js Date, so we must adjust the minutes to compensate. (think setDate, getDate)
	 * @@param  date
	 * @@param  string formated like "+0500", "-1245"
	 * @@return date
	 */
	$.timepicker.timezoneAdjust = function(date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if(!isNaN(toTz)){
			date.setMinutes(date.getMinutes()*1 + (date.getTimezoneOffset()*-1 - toTz*1) );
		}
		return date;
	};

	/**
	 * Calls `timepicker()` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * n.b. The input value must be correctly formatted (reformatting is not supported)
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the timepicker() call
	 * @@return jQuery
	 */
	$.timepicker.timeRange = function(startTime, endTime, options) {
		return $.timepicker.handleRange('timepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datetimepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@return jQuery
	 */
	$.timepicker.datetimeRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datetimepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.dateRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.handleRange = function(method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0, // min allowed interval in milliseconds
			maxInterval: 0, // max allowed interval in milliseconds
			start: {},      // options for start picker
			end: {}         // options for end picker
		}, options);

		$.fn[method].call(startTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), endTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), endTime, 'minDate');
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), startTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), startTime, 'maxDate');
			}
		}, options, options.end));

		checkDates(startTime, endTime);
		selected(startTime, endTime, 'minDate');
		selected(endTime, startTime, 'maxDate');

		function checkDates(changed, other) {
			var startdt = startTime[method]('getDate'),
				enddt = endTime[method]('getDate'),
				changeddt = changed[method]('getDate');

			if(startdt !== null){
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());

				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);

				if(options.minInterval &amp;gt; 0 &amp;amp;&amp;amp; minDate &amp;gt; enddt){ // minInterval check
					endTime[method]('setDate',minDate);
				}
				else if(options.maxInterval &amp;gt; 0 &amp;amp;&amp;amp; maxDate &amp;lt; enddt){ // max interval check
					endTime[method]('setDate',maxDate);
				}
				else if (startdt &amp;gt; enddt) {
					other[method]('setDate',changeddt);
				}
			}
		}

		function selected(changed, other, option) {
			if (!changed.val()) {
				return;
			}
			var date = changed[method].call(changed, 'getDate');
			if(date !== null &amp;amp;&amp;amp; options.minInterval &amp;gt; 0){
				if(option == 'minDate'){
					date.setMilliseconds(date.getMilliseconds() + options.minInterval); 
				}
				if(option == 'maxDate'){
					date.setMilliseconds(date.getMilliseconds() - options.minInterval);
				}
			}
			if (date.getTime) {
				other[method].call(other, 'option', option, date);
			}
		}
		return $([startTime.get(0), endTime.get(0)]);
	};

	/**
	 * Log error or data to the console during error or debugging
	 * @@param  Object err pass any type object to log to the console during error or debugging
	 * @@return void
	 */
	$.timepicker.log = function(err){
		if(window.console){
			console.log(err);
		}
	};

	/*
	* Microsecond support
	*/
	if(!Date.prototype.getMicroseconds){
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function(){ return this.microseconds; };
		Date.prototype.setMicroseconds = function(m){ 
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m/1000));
			this.microseconds = m%1000;
			return this;
		};
	}

	/*
	* Keep up with the version
	*/
	$.timepicker.version = "1.3.1";

})(jQuery);
jQuery.noConflict();
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;datetimepicker-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;e73a652e-09fc-4c71-8e7a-e2525a2d2a99&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
function replaceAllString(oriStr, strTarget, strSubString ){
   var strText = oriStr;
   var intIndexOfMatch = strText.indexOf( strTarget );
   while (intIndexOfMatch != -1){
      strText = strText.replace( strTarget, strSubString )
      intIndexOfMatch = strText.indexOf( strTarget );
   }
   return( strText );
}
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&amp;amp;]" + name + "=([^&amp;amp;#]*)"),
    results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
};


   var jobName= getParameterByName('job')
   var fromDate= getParameterByName('fromDate')
   var toDate= getParameterByName('toDate')
   var limit= getParameterByName('limit')
   var selectedIstIid = getParameterByName('IstIid')

  $("#jobname").ready(function(){
   $("#jobname").text(jobName)
   var convertedJobName = replaceAllString(jobName, ".", "_")
   $("#IstIid" + convertedJobName).ready(function(){
     $("#IstIid" + convertedJobName).css("display","block")
     $("#select_" + convertedJobName).ready(function(){
        $("#select_" + convertedJobName).val(selectedIstIid)
     });
   });
 });

  $("#fromDate").ready(function(){
   $("#from-date").val(fromDate)
 });

  $("#toDate").ready(function(){
   $("#to-date").val(toDate)
 });

  $("#limit").ready(function(){
   if(limit!=""){
    $("#limit").val(limit)
   }
 });
 // Get data with ajax
 function ajax_getData(jobName,fromDate,toDate,limit ){
       var convertedJobName = replaceAllString(jobName, ".", "_")
       var istIid = $("#select_" + convertedJobName).val()
       window.location="/xwiki/bin/view/WiperDog/WebHome?job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid="+istIid;
 			/*$.ajax({
			 type: "GET",
			 url:"/xwiki/bin/get/Sandbox/DescriptionForJob?outputSyntax=plain&amp;amp;job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid"+selectedIstIid,
			 success : function(result){
				$("#jobname").html(jobName)
				$("#display").text('[[]]' + result)
			 }
		   });*/
 }
	$("#treemenu2 a").click(function(){
		 var limit = 10
		 var fromDate=""
		 var toDate = ""
		 jobName= $(this).text()
                 $("#jobname").html(jobName)
                 var convertedJobName = replaceAllString(jobName, ".", "_")
                 $("#listIstIid &amp;gt; div").css("display","none")
                 $("#IstIid" + convertedJobName).css("display","block")
		 //ajax_getData(jobName,fromDate,toDate,limit )

	});

	$("#from-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
		dateFormat: 'yy-mm-dd',
	});
	$("#to-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
			dateFormat: 'yy-mm-dd',

	});
	 $("#get-data").on("click",function(){
		var fromDate = $("#from-date").val()
		var toDate =  $("#to-date").val()
		 if( toDate!= "" ){
			  if(fromDate != ""){
				  if($("#from-date").datepicker( "getDate" ) &amp;gt; $("#to-date").datepicker( "getDate" )){
				  alert("'From date' cannot start later than 'To date'")
				  return false
				  }
			  }
		 }
		 limit = $("#limit").val()
		 ajax_getData(jobName,fromDate,toDate,limit )
	});
$(document).ready(function(){
  var keys = $("#lstkey").text()
  //console.log('key == ' + keys);
  //console.log('livetableJson ==' + $("#livetableJson").text());
  
  var jsonObj = $.parseJSON($("#livetableJson").text()); 
  if(keys &amp;amp;&amp;amp; keys != '[ ]'){
    /** Subtyped **/    
    var newKeys = keys.replace('[',"");
    keys = newKeys.replace(']',"");
    var keyArr = (keys.indexOf(',') != -1)? keys.split(','):new Array(keys);
    //console.log('Key after replace: '+keys)       
    for(var i=0;i&amp;lt;keyArr.length;i++){
        var keyName = keyArr[i].trim().replace('',"").replace("\"","").replace('\"','');
        var subTypeJsonObjStr = jsonObj[keyName].replace('#livetablePager','#livetablePager_'+keyName)
        var subTypeJsonObj = $.parseJSON(subTypeJsonObjStr);
        $("#livetableList_"+keyName).jqGrid(subTypeJsonObj);
        $("#livetableList_"+keyName).jqGrid('navGrid', "#livetablePager_"+keyName, {
           edit : false,
           add : false,
           del : false,
           search:false
         });
    }
    
  }else{ /** Store**/        
      $("#livetableList").jqGrid(jsonObj);
      $("#livetableList").jqGrid('navGrid', "#livetablePager", {
           edit : false,
           add : false,
           del : false,
           search:false
           
       });
   }
});
        
jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;process&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;881686cc-1bfc-456e-b8ab-71334c4a45e5&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){

	$(function () {
		function drawLineChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerline' + container).highcharts({

				chart: {
					type:'line'
				},
				title: {
					text: chart_name
				},
				tooltip :{
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				xAxis: dataXAxis ,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				series: dataSeries
			});
		};

		function drawBarChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerbar' + container).highcharts({
				chart: {
					type: 'column'
				},
				title: {
					text: chart_name
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {

					column: {
						pointPadding: 0.2,
						borderWidth: 0
					}
				},
				series: dataSeries
			});
		}

		function drawAreaChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail
			$('#containerarea' + container).highcharts({
				chart: {
					type: 'area'
				},
				title: {
					text: chart_name
				},
				subtitle: {
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					},
					labels: {
						formatter: function() {
							return this.value / 1000;
						}
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {
					area: {
						stacking: 'normal',
						lineColor: '#666666',
						lineWidth: 1,
						marker: {
							lineWidth: 1,
							lineColor: '#666666'
						}
					}
				},
				series: dataSeries
			});
		};

		function drawPieChart(data, container, chartName){
			var dataPie = data
			$(document).ready(function () {
				// Build the chart
				$('#container' + container).highcharts({
					chart: {
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: chartName
					},
					tooltip: {
						pointFormat: '{series.name}: &amp;lt;b&amp;gt;{point.percentage:.1f}%&amp;lt;/b&amp;gt;'
					},
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							dataLabels: {
								enabled: true,
                                                                color: '#000000',
                                                                connectorColor: '#000000',
                                                                format: '&amp;lt;b&amp;gt;{point.name}&amp;lt;/b&amp;gt;: {point.percentage:.1f} %'
							},
							showInLegend: true
						}
					},
					series: dataPie
				});
			});
		}

		// LINE
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                     if(($("#jsons&amp;gt;#jsonline_" + finalKey)).length &amp;gt; 0) {
					var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonline_" + finalKey).val());
					var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerline_" + finalKey).val());
				        var lstContainer = [];
  				        var data_all = [];
                                        var chartSize = arrayAll.length

                                        for(var i=0;i&amp;lt;chartSize ;i++){
                                           data_all = arrayAll[i]
                                           lstContainer = arrayContainerAll[i]
				           if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					        // data to display on tooltip
					        var data_detail = data_all[0]
					        // draw Line chart
				        	for(var j=0;j&amp;lt;data_all.length;j++){
				        		if(data_all[j].series[0].name == null){
				        			data_all[j].series[0].name = lstContainer[j]
					        	}
                                                        chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					        	drawLineChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					        }
				         }
                                      }
                                  }
				}
			} else {
				var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonline").val());
				var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerline").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length

                                for(var i=0;i&amp;lt;chartSize ;i++){
                                   data_all = arrayAll[i]
                                   lstContainer = arrayContainerAll[i]
				   if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Line chart
					for(var j=0;j&amp;lt;data_all.length;j++){
						if(data_all[j].series[0].name == null){
							data_all[j].series[0].name = lstContainer[j]
						}
                                                chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
						drawLineChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
				   }
                                }
			}
		});

		// BAR
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
			             var finalKey = lstKey[eKey]
                                     if(($("#jsons&amp;gt;#jsonbar_" + finalKey)).length &amp;gt; 0) {
					var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonbar_" + finalKey).val());
					var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerbar_" + finalKey).val());
					var lstContainer = [];
					var data_all = [];
                                        var chartSize = arrayAll.length
					for(var i=0;i&amp;lt;chartSize ;i++){
					    data_all = arrayAll[i]
					    lstContainer = arrayContainerAll[i]
					    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw bar chart
						for(var j=0;j&amp;lt;data_all.length;j++){
							if(data_all[j].series[0].name == null){
								data_all[j].series[0].name = lstContainer[j]
							}
                                                        chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
							drawBarChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
						}
                                            }
					}
                                    }
				}
			} else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonbar").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerbar").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
				    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Bar chart
					for(var j=0;j&amp;lt;data_all.length;j++){
                                            if(data_all[j].series[0].name == null){
						data_all[j].series[0].name = lstContainer[j]
					    }
                                            chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					    drawBarChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
                                    }
				}
			}
		});

		// AREA
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
                        var arrayAll
                        var arrayContainerAll
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                        if(($("#jsons&amp;gt;#jsonarea_" + finalKey)).length &amp;gt; 0) {
                                           arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonarea_" + finalKey).val());
                                           arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerarea_" + finalKey).val());
					   var lstContainer = [];
					   var data_all = [];
                                           var chartSize = arrayAll.length
					   for(var i=0;i&amp;lt;chartSize ;i++){
					       data_all = arrayAll[i]
					       lstContainer = arrayContainerAll[i]
					       if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						   // data to display on tooltip
						   var data_detail = data_all[0]
						   // draw Line chart
						   for(var j=0;j&amp;lt;data_all.length;j++){
						      if(data_all[j].series[0].name == null){
						         data_all[j].series[0].name = lstContainer[j]
						       }
                                                       chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
						       drawAreaChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
						   }
					      }
				           }
                                        }
			          }
                        } else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonarea").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerarea").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
				    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw area chart
					for(var j=0;j&amp;lt;data_all.length;j++){
                                            if(data_all[j].series[0].name == null){
						data_all[j].series[0].name = lstContainer[j]
					    }
                                            chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					    drawAreaChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
                                    }
				}
			}
		});

		// PIE
		$(document ).ready(function(){
                        var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
                        var arrayAll
                        var arrayContainerAll
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                        if(($("#jsons&amp;gt;#jsonpie_" + finalKey)).length &amp;gt; 0) {
                                           arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonpie_" + finalKey).val());
                                           arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerpie_" + finalKey).val());
					   var lstContainer = [];
					   var data_all = [];
                                           var chartSize = arrayAll.length
					  for(var i=0;i&amp;lt;chartSize ;i++){
					       data_all = arrayAll[i]
					       lstContainer = arrayContainerAll[i]
					       if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						   // draw Pie chart
						   for(var j=0;j&amp;lt;data_all.length;j++){
                                                       chartName  = data_all[j].chart_name + "( " + data_all[j].name + " )"
console.log(data_all)
						       drawPieChart([data_all[j]], finalKey + "_" + lstContainer[j], chartName)
						   }
					      }
				           }
                                        }
			          }
			} else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonpie").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerpie").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
                                    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
                                                   for(var j=0;j&amp;lt;data_all.length;j++){
                                                       chartName  = data_all[j].name
						       drawPieChart(data_all, i + "_pie", chartName)
						   }

                                    }
                                }
			}
		});
	});
	jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;d5873d92-b78b-42fc-9407-46d166204b88&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;/* css for timepicker */
.ui-timepicker-div .ui-widget-header { 
margin-bottom: 8px;
 }

.ui-timepicker-div dl { text-align: left; }
.ui-timepicker-div dl dt { height: 25px; margin-bottom: -25px; }
.ui-timepicker-div dl dd { margin: 0 10px 10px 65px; }
.ui-timepicker-div td { font-size: 90%; }
.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }

.ui-timepicker-rtl{ direction: rtl; }
.ui-timepicker-rtl dl { text-align: right; }
.ui-timepicker-rtl dl dd { margin: 0 65px 10px 10px; }
#ui-datepicker-div{
 position:relative;
 width:auto;
 height:auto
}
&lt;/code&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;datetimepicker -css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;1201fb1a-e9c1-4731-8c74-2ea8c0071959&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;.displayblock {
  border:2px solid;
  -webkit-border-radius:6px;
  background:gray;
  float: left;
  width:100%;
}

.displaypie {
  border:1px solid;
  -webkit-border-radius:6px;
  background:gray;
  width: 48%;
  float: left; 
  height: 300px;
}

.subtype {
  margin-top: 50px;
  font-size: 2em;
  color: red;
}&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;content&gt;{{include document="Lib.DataToDrawChart"/}}
{{include document="Lib.MongoDBConnection"/}}
{{velocity}}
$xwiki.jsx.use('Lib.JQueryUILib')
$xwiki.ssx.use('Lib.MenuGenerator')
$xwiki.jsx.use('Lib.MenuGenerator')
$xwiki.ssx.use('Lib.JQueryUILib')
$xwiki.jsx.use('Lib.JqGridLib')
$xwiki.ssx.use('Lib.JqGridLib') 
{{/velocity}}
{{include document="Lib.MenuGenerator"/}}
{{html wiki="true" clean="false"}}
&amp;lt;div id="viewer"&amp;gt;
&amp;lt;table style="text-align:left"  &amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th &amp;gt;Job name&amp;lt;/th&amp;gt;
  &amp;lt;td colspan=3&amp;gt;&amp;lt;div id="jobname"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
{{groovy}}
import org.xwiki.context.*

def ec = services.component.getInstance(Execution.class).getContext()
def mapJobIstIid = ec.getProperty("mapJobIstIid")

println '{{html clean="false" wiki="false"}}'
println '&amp;lt;tr&amp;gt;'
println '&amp;lt;th&amp;gt;IstIid&amp;lt;/th&amp;gt;'
println '&amp;lt;td colspan=3&amp;gt;'
mapJobIstIid.each{jobEntry-&amp;gt;
  def convertedJobKey = jobEntry.key.replaceAll("\\.","_")
  println "&amp;lt;div id='listIstIid'&amp;gt;"
  println "&amp;lt;div id=IstIid${convertedJobKey} style='display:none'&amp;gt;"
  println "&amp;lt;select id=select_${convertedJobKey}&amp;gt;"
  jobEntry.value.each{
     println "&amp;lt;option value=\"$it\"&amp;gt;$it&amp;lt;/option&amp;gt;"
  }
  println "&amp;lt;/select&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
}
println '&amp;lt;/td&amp;gt;'
println '&amp;lt;/tr&amp;gt;'
println '{{/html}}'
{{/groovy}}
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data monitor from&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="from-date" id="from-date"/&amp;gt;&amp;lt;/td&amp;gt;
  &amp;lt;th&amp;gt;Data monitor to&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="to-date" id="to-date"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data records limit &amp;lt;/th&amp;gt;
  &amp;lt;td &amp;gt;
     &amp;lt;select id="limit"&amp;gt;
       &amp;lt;option value=5&amp;gt;5&amp;lt;/option&amp;gt;
       &amp;lt;option value=10&amp;gt;10&amp;lt;/option&amp;gt;
       &amp;lt;option value=15&amp;gt;15&amp;lt;/option&amp;gt;
       &amp;lt;option value=20&amp;gt;20&amp;lt;/option&amp;gt;
     &amp;lt;/select&amp;gt;
  &amp;lt;/td&amp;gt;
  &amp;lt;td colspan=3 &amp;gt;&amp;lt;input type="button" value="View Data" id="get-data" class="button"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;&amp;lt;div id="display"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
  &amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
&amp;lt;/table&amp;gt;

&amp;lt;/div&amp;gt; 
   
 &amp;lt;/body&amp;gt;

{{/html}}
{{groovy}}
import groovy.json.*
xwiki.jsx.use("Lib.Highcharts")

if(request.xpage == "plain") {
	response.setContentType('text/plain')
}

def listData = []
def job = request.get("job")
def fromDate = request.get("fromDate")
def toDate = request.get("toDate")
def limit= (request.get("limit")!=null)?request.get("limit").toInteger():10
def istIid = request.get("IstIid")

def str= "No data to retrieved !"
def result = null
if(job != "" &amp;amp;&amp;amp; job != null &amp;amp;&amp;amp; istIid != null &amp;amp;&amp;amp; istIid != ""){
	MongoDBConnection.getConnection()
	if(fromDate != "" || toDate != ""){
		result = MongoDBConnection.getDataInPeriod(job,fromDate,toDate,limit,istIid)
	} else {
		result = MongoDBConnection.getDataAllFields(job,limit,istIid)
        }
MongoDBConnection.closeConnection()
} else {
   println "{{warning}}There are no selected job or IstIid{{/warning}}"
}
def listKey = []
if( (result != null) &amp;amp;&amp;amp; (result.size() &amp;gt; 0) &amp;amp;&amp;amp; (result[0].KEYEXPR != null)&amp;amp;&amp;amp;!(result[0].KEYEXPR instanceof List )){

if(result[0].type == "Subtyped") {
    println '{{html clean="false" wiki="true"}}'
    //println '&amp;lt;body&amp;gt;'
    def dataSubtype = DataToDrawChart.getDataToDrawSubtype(result)
    dataSubtype.each {key,value -&amp;gt;
        listKey.add(key)
    }
    def jsonkey = com.mongodb.util.JSON.serialize(listKey)
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$jsonkey&amp;lt;/textarea&amp;gt;"

    dataSubtype.each {key,value -&amp;gt;
            def dataLine = []
            def dataBar = []
            def dataPie = []
            def dataArea = []
            if(DataToDrawChart.getDataToDrawLine(value) != []) {
                dataLine = DataToDrawChart.getDataToDrawLine(value)
            }
            if(DataToDrawChart.getDataToDrawBar(value) != []) {
                dataBar = DataToDrawChart.getDataToDrawBar(value)
            }
            if(DataToDrawChart.getDataToDrawPie(value) != []) {
                dataPie = DataToDrawChart.getDataToDrawPie(value)
            }
            if(DataToDrawChart.getDataToDrawArea(value) != []) {
                dataArea = DataToDrawChart.getDataToDrawArea(value)
            }

		def chartColumnsLine = []
		def chartColumnsBar = []
		def chartColumnsArea = []
		def lstName

                dataLine.each {itemDataLine -&amp;gt;
                    if(itemDataLine.size() &amp;gt; 0 ){
		        chartColumnsLine.add(itemDataLine[0].chart_columns)
	            }
                }
                dataBar.each {itemDataBar -&amp;gt;
                    if(itemDataBar.size() &amp;gt; 0 ){
		        chartColumnsBar.add(itemDataBar[0].chart_columns)
	            }
                }
                dataArea.each {itemDataArea -&amp;gt;
                    if(itemDataArea.size() &amp;gt; 0 ){
		        chartColumnsArea.add(itemDataArea[0].chart_columns)
	            }
                }

		if(dataPie.size() &amp;gt; 0 ){
			lstName = dataPie['name']
		}
		def tmpListNameContainer = []
                
		if(lstName != null) {
                        def chartNumPie = 0
                        def tmpLst
                        for(def nameContainer in lstName){
                           tmpLst = []
			   for(def nameContainerItem in nameContainer ){
				nameContainerItem = chartNumPie + "_" + nameContainerItem.replaceAll("\\.", "_")
				tmpLst.add(nameContainerItem )
		            }
                            tmpListNameContainer.add(tmpLst)
                            chartNumPie++
                         }
		}
		def jsonPie
		def jsonLine
		def jsonBar
		def jsonArea
		if(dataPie != []) {
		    jsonPie = com.mongodb.util.JSON.serialize(dataPie)
		}
		if(dataLine != []) {
		    jsonLine = com.mongodb.util.JSON.serialize(dataLine)
		}
		if(dataBar != []) {
		    jsonBar = com.mongodb.util.JSON.serialize(dataBar)
		}
		if(dataArea != []) {
		    jsonArea = com.mongodb.util.JSON.serialize(dataArea)
		}
		def jsonContainerPie
		if(tmpListNameContainer != []) {
			jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
		}
		def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
		def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
		def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

		println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
		if(jsonLine != null) {
			println "&amp;lt;textarea id=\"jsonline_$key\" &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class=\"lstcontainerline_$key\" &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
		}
		if(jsonBar != null) {
			println "&amp;lt;textarea id=\"jsonbar_$key\"&amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerbar_$key' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
		}
		if(jsonPie != null &amp;amp;&amp;amp; jsonContainerPie != null) {
			println "&amp;lt;textarea id=\"jsonpie_$key\" &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerpie_$key' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
		}
		if(jsonArea != null) {
			println "&amp;lt;textarea id=\"jsonarea_$key\" &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerarea_$key' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
		}

        println "&amp;lt;/div&amp;gt;"
        def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
        def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
          
        println "&amp;lt;div style='clear:both'&amp;gt;"
            def description = value.KEYEXPR._description[0][key]
            if(description != null) {
                println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +': ' + description +'&amp;lt;/div&amp;gt;'
            } else {
                println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +'&amp;lt;/div&amp;gt;'
            }
            println "-----"
            if(jsonPie != null) {
          println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
	  chartNumPie = 0
          lstName.each{chartPieLst -&amp;gt;
		chartPieLst.each {
	            def tmp = chartNumPie + "_" + it.replaceAll("\\.", "_")
		    println " &amp;lt;div class=\"displaypie\" id=\"container${key}_${tmp}\" &amp;gt;&amp;lt;/div&amp;gt;"
          	}
		chartNumPie++
	  }	
          println "&amp;lt;/div&amp;gt;"
            }
            if(jsonLine != null) {
          	def chartLineComment = false
		def chartNumLine = 0
          	chartColumnsLine.each{chartColumnsLineItem -&amp;gt;
            		if(!chartLineComment){
               			println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
               			chartLineComment = true  
            		}
		chartColumnsLineItem.each{
              		println " &amp;lt;div class=\"displayblock\" id=\"containerline${key}_${chartNumLine}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          	}
		chartNumLine ++
	    }
          println "&amp;lt;/div&amp;gt;"
            }
            println "&amp;amp;nbsp;"

            if(jsonBar != null) {
          	def chartBarComment = false
  		def chartNumBar = 0
          	chartColumnsBar.each{chartColumnsBarItem -&amp;gt;
             		if(!chartBarComment){
                		println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
                		chartBarComment = true
              		}  
			chartColumnsBarItem.each{
             			println " &amp;lt;div class=\"displayblock\" id=\"containerbar${key}_${chartNumBar}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          		}
			chartNumBar++
		}
          	println "&amp;lt;/div&amp;gt;"
            }
            println "&amp;amp;nbsp;"

            if(jsonArea != null) {
          	def chartAreaComment = false
		def chartNumArea = 0
          	chartColumnsArea.each{chartColumnsAreaItem -&amp;gt;
          		if(!chartAreaComment){
            			println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
            			chartAreaComment = true
          		}
			chartColumnsAreaItem.each{
            			println " &amp;lt;div class=\"displayblock\" id=\"containerarea${key}_${chartNumArea}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          		}
          		chartNumArea++
            	}
        	println "&amp;lt;/div&amp;gt;"
	    }
        /** Statistic data table **/
        println "&amp;lt;center&amp;gt;"        
        println "&amp;lt;div id='livetblContent_"+key+"' style='width:100%;clear:both;align:middle;margin-top:10px'&amp;gt;"   
        println "Statistics data for "+key
        println "&amp;lt;table id='livetableList_"+key+"' style='width:100%;align:center'&amp;gt;&amp;lt;/table&amp;gt;"
        println "&amp;lt;div id='livetablePager_"+key+"' style='position:relative;width:100%'&amp;gt;&amp;lt;/div&amp;gt;"
        println "&amp;lt;/div&amp;gt;"
        println "&amp;lt;/center&amp;gt;"
        println "&amp;lt;script language='javascript'&amp;gt;console.log('Create live table for "+key+"');&amp;lt;/script&amp;gt;"
    }
    //println '&amp;lt;/body&amp;gt;'
    println '{{/html}}'
} else if(result[0].type == "Store") {
	// data store
	def dataLine = DataToDrawChart.getDataToDrawLine(result)
	def dataBar = DataToDrawChart.getDataToDrawBar(result)
	def dataPie = DataToDrawChart.getDataToDrawPie(result)
	def dataArea = DataToDrawChart.getDataToDrawArea(result)
	def chartColumnsLine = []
	def chartColumnsBar = []
	def chartColumnsArea = []
	def lstName

        dataLine.each {itemDataLine -&amp;gt;
            if(itemDataLine.size() &amp;gt; 0 ){
		chartColumnsLine.add(itemDataLine[0].chart_columns)
	    }
        }

        dataBar.each {itemDataBar -&amp;gt;
            if(itemDataBar.size() &amp;gt; 0 ){
		chartColumnsBar.add(itemDataBar[0].chart_columns)
	    }
        }

        dataArea.each {itemDataArea -&amp;gt;
            if(itemDataArea.size() &amp;gt; 0 ){
		chartColumnsArea.add(itemDataArea[0].chart_columns)
	    }
        }

	if(dataPie.size() &amp;gt; 0 ){
		lstName = dataPie['name']
	}

    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
  
    def tmpListNameContainer = []
    def chartNumPie = 0
    for(def nameContainer in lstName){
       for(def nameContainerItem in nameContainer ){
           nameContainerItem = chartNumPie + "_" + nameContainerItem.replaceAll("\\.", "_")
           tmpListNameContainer .add(nameContainerItem )
       }
    }
    
    def jsonPie = com.mongodb.util.JSON.serialize(dataPie)
    def jsonLine = com.mongodb.util.JSON.serialize(dataLine)
    def jsonBar = com.mongodb.util.JSON.serialize(dataBar)
    def jsonArea = com.mongodb.util.JSON.serialize(dataArea)

    def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
    def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
    def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
    def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

    def listEmpty = com.mongodb.util.JSON.serialize([])
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$listEmpty&amp;lt;/textarea&amp;gt;" 

    println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
    println "&amp;lt;textarea class='jsonline' &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonbar' &amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonpie' &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonarea' &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"

    println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;/div&amp;gt;"

    def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
    def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
  
    println "&amp;lt;div style='clear:both'&amp;gt;"
  
    def chartPieComment = false
    chartNumPie = 0
    lstName.each{chartPieLst-&amp;gt;
        if(!chartPieComment) {
            println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
            chartPieComment = true
        }
        chartPieLst.each {
            def tmp = chartNumPie + "_pie"
            println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
        }
    }
    println "&amp;lt;/div&amp;gt;"
    	def chartLineComment = false
	def chartNum = 0
    	chartColumnsLine.each{chartColumnsLineItem -&amp;gt;
	    	if(!chartLineComment){
	        	println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	        	chartLineComment = true  
	    	}
		chartColumnsLineItem.each{
	    		println " &amp;lt;div class=\"displayblock\" id=\"containerline${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	    	}
		chartNum++
	}	
    	println "&amp;lt;/div&amp;gt;"
    	println "&amp;amp;nbsp;"
    	def chartBarComment = false
	chartNum = 0
    	chartColumnsBar.each{chartColumnsBarItem -&amp;gt;
	        if(!chartBarComment){
	            println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	            chartBarComment = true
	        }  
		chartColumnsBarItem.each{
	    		println " &amp;lt;div class=\"displayblock\" id=\"containerbar${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  	}
		chartNum++
	}
  println "&amp;lt;/div&amp;gt;"
  println "&amp;amp;nbsp;"
  	def chartAreaComment = false
	chartNum = 0
  	chartColumnsArea.each{chartColumnsAreaItem -&amp;gt;
	  	if(!chartAreaComment){
	    		println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	    		chartAreaComment = true
	  	}
		chartColumnsAreaItem.each{
    			println " &amp;lt;div class=\"displayblock\" id=\"containerarea${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
		}
		chartNum++
  	}
  println "&amp;lt;/div&amp;gt;"
println "&amp;lt;/div&amp;gt;"

//println '&amp;lt;/body&amp;gt;'
println '{{/html}}'
}
}else{
    println 'There is no data for this job with criterias'
}
//--=============== Start build for livetable
def subTypeURLMap = [:]
def dataModel = []
def dataUrl = ""
result.find{rec-&amp;gt;				
    def subtractData = []
    
    //-- Parsing data and assign data to subtract list
    if(rec.type == "Store"){ //-- Store data type
        subtractData = rec['data']        
        subtractData.each{r2-&amp;gt;					
            if(dataModel != null &amp;amp;&amp;amp; dataModel.size() &amp;lt;=0){ 
                dataModel.add("Fetch At")
                dataModel.addAll(r2.keySet());					
            } 
        }        
        dataUrl = "/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job="+job +"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate + "&amp;amp;toDate=" + toDate + "&amp;amp;istIid="+istIid        
        //-- Building data model				
        def model = []
        def colSpec
        dataModel.each{name-&amp;gt;
            colSpec = [:]
            colSpec['name'] = name
            colSpec['index'] = name
            colSpec['width'] = "100"
            model.add(colSpec)
        }
        def dataModelStr = (new JsonBuilder(dataModel)).toPrettyString()
        def modelStr = (new JsonBuilder(model)).toPrettyString() 
        str = 
        "{\"url\":\""+dataUrl+"\",\"datatype\":\"json\","+
            "\"colNames\":"+ dataModelStr +
            ",\"colModel\":"+ modelStr +" ,\"rowList\":[10,20,30],"+
            "\"pager\":\"#livetablePager\", \"viewrecords\": true, \"sortname\": \"RECORD_SEQ\","+
            "\"sortorder\": \"asc\", \"caption\":\""+job+"\"}"
        println "{{html clean=\"false\" wiki=\"true\"}}"
        println "&amp;lt;div id='livetableJson' style = \"display:none\"&amp;gt;"
        //println "&amp;lt;div id='livetableJson'&amp;gt;"
        println str;
        println "&amp;lt;/div&amp;gt;"
        println "{{/html}}"
    }else{ //-- Subtype			
        def subData = rec['data']
        subData.each{key,value-&amp;gt;
            dataUrl = "/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job="+job +"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate + "&amp;amp;toDate=" + toDate + "&amp;amp;istIid="+istIid+"&amp;amp;subType="+key
            subtractData = value
            subtractData.each{r2-&amp;gt;					
                if(dataModel != null &amp;amp;&amp;amp; dataModel.size() &amp;lt;=0){ 
                    dataModel.add("Fetch At")
                    dataModel.addAll(r2.keySet());					
                } 			
            }
            //-- Building data model				
            def model = []
            def colSpec
            dataModel.each{name-&amp;gt;
                colSpec = [:]
                colSpec['name'] = name
                colSpec['index'] = name
                colSpec['width'] = "100"
                model.add(colSpec)
            }
            def dataModelStr = (new JsonBuilder(dataModel)).toPrettyString()
            def modelStr = (new JsonBuilder(model)).toPrettyString() 
            str = 
            "{\"url\":\""+dataUrl+"\",\"datatype\":\"json\","+
                "\"colNames\":"+ dataModelStr +
                ",\"colModel\":"+ modelStr +" ,\"rowList\":[10,20,30],"+
                "\"pager\":\"#livetablePager\", \"viewrecords\": true, \"sortname\": \"RECORD_SEQ\","+
                "\"sortorder\": \"asc\", \"caption\":\""+job+"\"}"
            subTypeURLMap[key] = str
        }
        def finalStr = (new JsonBuilder(subTypeURLMap)).toPrettyString()
        println "{{html clean=\"false\" wiki=\"true\"}}"
        println "&amp;lt;div id='livetableJson' style = \"display:none\"&amp;gt;"
        //println "&amp;lt;div id='livetableJson'&amp;gt;"
        println finalStr;
        println "&amp;lt;/div&amp;gt;"
        println "{{/html}}"
    }
    return true
}
 //--=============== END

if(listKey.size() &amp;lt;= 0){   
    println "{{html clean=\"false\" wiki=\"true\"}}"
    println "&amp;lt;center&amp;gt;"
    println "&amp;lt;div id=\"livetblContent\" style=\"width:100%;clear:both;align:middle;margin-top:10px\"&amp;gt;"   
    println "Statistics Data"
    println "&amp;lt;table id=\"livetableList\" style=\"width:100%;align:center\"&amp;gt;&amp;lt;/table&amp;gt;"    
    println "&amp;lt;div id=\"livetablePager\"&amp;gt;&amp;lt;/div&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
    println "&amp;lt;/center&amp;gt;"
    
    println "&amp;lt;div id=\"testDiv\"&amp;gt;&amp;amp;nbsp;&amp;lt;/div&amp;gt;"
    println "{{/html}}"
}
{{/groovy}}
&lt;/content&gt;&lt;/xwikidoc&gt;@


61.42
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376561369000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;61.42&lt;/version&gt;
d2946 1
a2946 1
						       drawPieChart(data_all, finalKey + "_" + lstContainer[j], chartName)
@


61.41
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376561276000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;61.41&lt;/version&gt;
d2945 1
@


61.40
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376561011000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;61.40&lt;/version&gt;
d2944 2
a2945 2
                                                       chartName  = data_all[j].name
						       drawPieChart(data_all[j], finalKey + "_" + lstContainer[j], chartName)
@


61.39
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376560922000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;61.39&lt;/version&gt;
d2945 1
a2945 1
						       drawPieChart(data_all, finalKey + "_" + lstContainer[j], chartName)
@


61.38
log
@@
text
@&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xwikidoc&gt;
&lt;web&gt;WiperDog&lt;/web&gt;
&lt;name&gt;WebHome&lt;/name&gt;
&lt;language&gt;&lt;/language&gt;
&lt;defaultLanguage&gt;en&lt;/defaultLanguage&gt;
&lt;translation&gt;0&lt;/translation&gt;
&lt;parent&gt;&lt;/parent&gt;
&lt;creator&gt;XWiki.Admin&lt;/creator&gt;
&lt;author&gt;XWiki.Admin&lt;/author&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;contentAuthor&gt;XWiki.Admin&lt;/contentAuthor&gt;
&lt;creationDate&gt;1376364375000&lt;/creationDate&gt;
&lt;date&gt;1376560885000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376560885000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.38&lt;/version&gt;
&lt;title&gt;WiperDog&lt;/title&gt;
&lt;defaultTemplate&gt;&lt;/defaultTemplate&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;comment&gt;&lt;/comment&gt;
&lt;minorEdit&gt;true&lt;/minorEdit&gt;
&lt;syntaxId&gt;xwiki/2.1&lt;/syntaxId&gt;
&lt;hidden&gt;false&lt;/hidden&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;047293a8-524d-45e4-af52-cd944523d5d0&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
/*
 * jQuery timepicker addon
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 1.3.1
 * Last Modified: 07/07/2013
 *
 * Copyright 2013 Trent Richardson
 * You may use this project under MIT or GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 */

/*jslint evil: true, white: false, undef: false, nomen: false */

(function($) {

	/*
	* Lets not redefine timepicker, Prevent "Uncaught RangeError: Maximum call stack size exceeded"
	*/
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return;
	}

	/*
	* Extend jQueryUI, get it started with our version number
	*/
	$.extend($.ui, {
		timepicker: {
			version: "1.3.1"
		}
	});

	/* 
	* Timepicker manager.
	* Use the singleton instance of this class, $.timepicker, to interact with the time picker.
	* Settings for (groups of) time pickers are maintained in an instance object,
	* allowing multiple different settings on the same page.
	*/
	var Timepicker = function() {
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[''] = { // Default regional settings
			currentText: 'Now',
			closeText: 'Done',
			amNames: ['AM', 'A'],
			pmNames: ['PM', 'P'],
			timeFormat: 'HH:mm',
			timeSuffix: '',
			timeOnlyTitle: 'Choose Time',
			timeText: 'Time',
			hourText: 'Hour',
			minuteText: 'Minute',
			secondText: 'Second',
			millisecText: 'Millisecond',
			microsecText: 'Microsecond',
			timezoneText: 'Time Zone',
			isRTL: false
		};
		this._defaults = { // Global defaults for all the datetime picker instances
			showButtonPanel: true,
			timeOnly: false,
			showHour: null,
			showMinute: null,
			showSecond: null,
			showMillisec: null,
			showMicrosec: null,
			showTimezone: null,
			showTime: true,
			stepHour: 1,
			stepMinute: 1,
			stepSecond: 1,
			stepMillisec: 1,
			stepMicrosec: 1,
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null,
			hourMin: 0,
			minuteMin: 0,
			secondMin: 0,
			millisecMin: 0,
			microsecMin: 0,
			hourMax: 23,
			minuteMax: 59,
			secondMax: 59,
			millisecMax: 999,
			microsecMax: 999,
			minDateTime: null,
			maxDateTime: null,
			onSelect: null,
			hourGrid: 0,
			minuteGrid: 0,
			secondGrid: 0,
			millisecGrid: 0,
			microsecGrid: 0,
			alwaysSetTime: true,
			separator: ' ',
			altFieldTimeOnly: true,
			altTimeFormat: null,
			altSeparator: null,
			altTimeSuffix: null,
			pickerTimeFormat: null,
			pickerTimeSuffix: null,
			showTimepicker: true,
			timezoneList: null,
			addSliderAccess: false,
			sliderAccessArgs: null,
			controlType: 'slider',
			defaultValue: null,
			parse: 'strict'
		};
		$.extend(this._defaults, this.regional['']);
	};

	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: '',
		formattedDate: '',
		formattedTime: '',
		formattedDateTime: '',
		timezoneList: null,
		units: ['hour','minute','second','millisec', 'microsec'],
		support: {},
		control: null,

		/* 
		* Override the default settings for all instances of the time picker.
		* @@param  settings  object - the new settings to use as defaults (anonymous object)
		* @@return the manager object
		*/
		setDefaults: function(settings) {
			extendRemove(this._defaults, settings || {});
			return this;
		},

		/*
		* Create a new Timepicker instance
		*/
		_newInst: function($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
            	fns = {},
		    	overrides, i;

			for (var attrName in this._defaults) {
				if(this._defaults.hasOwnProperty(attrName)){
					var attrValue = $input.attr('time:' + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue);
						} catch (err) {
							inlineSettings[attrName] = attrValue;
						}
					}
				}
			}

		    overrides = {
		        beforeShow: function (input, dp_inst) {
		            if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
		                return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst);
		            }
		        },
		        onChangeMonthYear: function (year, month, dp_inst) {
		            // Update the time as well : this prevents the time from disappearing from the $input field.
		            tp_inst._updateDateTime(dp_inst);
		            if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
		                tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst);
		            }
		        },
		        onClose: function (dateText, dp_inst) {
		            if (tp_inst.timeDefined === true &amp;amp;&amp;amp; $input.val() !== '') {
		                tp_inst._updateDateTime(dp_inst);
		            }
		            if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
		                tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst);
		            }
		        }
		    };
		    for (i in overrides) {
		        if (overrides.hasOwnProperty(i)) {
		            fns[i] = opts[i] || null;
		        }
		    }

		    tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
		        evnts:fns,
		        timepicker: tp_inst // add timepicker as a property of datepicker: $.datepicker._get(dp_inst, 'timepicker');
		    });
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function(val) {
				return val.toUpperCase();
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function(val) {
				return val.toUpperCase();
			});

			// detect which units are supported
			tp_inst.support = detectSupport(
					tp_inst._defaults.timeFormat + 
					(tp_inst._defaults.pickerTimeFormat? tp_inst._defaults.pickerTimeFormat:'') + 
					(tp_inst._defaults.altTimeFormat? tp_inst._defaults.altTimeFormat:''));

			// controlType is string - key to our this._controls
			if(typeof(tp_inst._defaults.controlType) === 'string'){
				if(tp_inst._defaults.controlType == 'slider' &amp;amp;&amp;amp; typeof(jQuery.ui.slider) === 'undefined'){
					tp_inst._defaults.controlType = 'select';
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType];
			}
			// controlType is an object and must implement create, options, value methods
			else{ 
				tp_inst.control = tp_inst._defaults.controlType;
			}

			// prep the timezone options
			var timezoneList = [-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,
					0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList;
			}
			var tzl=timezoneList.length,tzi=0,tzv=null;
			if (tzl &amp;gt; 0 &amp;amp;&amp;amp; typeof timezoneList[0] !== 'object') {
				for(; tzi&amp;lt;tzl; tzi++){
					tzv = timezoneList[tzi];
					timezoneList[tzi] = { value: tzv, label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601) };
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;

			// set the default units
			tp_inst.timezone = tp_inst._defaults.timezone !== null? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) : 
							((new Date()).getTimezoneOffset()*-1);
			tp_inst.hour = tp_inst._defaults.hour &amp;lt; tp_inst._defaults.hourMin? tp_inst._defaults.hourMin : 
							tp_inst._defaults.hour &amp;gt; tp_inst._defaults.hourMax? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute &amp;lt; tp_inst._defaults.minuteMin? tp_inst._defaults.minuteMin : 
							tp_inst._defaults.minute &amp;gt; tp_inst._defaults.minuteMax? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second &amp;lt; tp_inst._defaults.secondMin? tp_inst._defaults.secondMin : 
							tp_inst._defaults.second &amp;gt; tp_inst._defaults.secondMax? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec &amp;lt; tp_inst._defaults.millisecMin? tp_inst._defaults.millisecMin : 
							tp_inst._defaults.millisec &amp;gt; tp_inst._defaults.millisecMax? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec &amp;lt; tp_inst._defaults.microsecMin? tp_inst._defaults.microsecMin : 
							tp_inst._defaults.microsec &amp;gt; tp_inst._defaults.microsecMax? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = '';
			tp_inst.$input = $input;

			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField).css({
					cursor: 'pointer'
				}).focus(function() {
					$input.trigger("focus");
				});
			}

			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date();
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date();
			}

			// datepicker needs minDate/maxDate, timepicker needs minDateTime/maxDateTime..
			if (tp_inst._defaults.minDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime());
			}
			if (tp_inst._defaults.minDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime());
			}
			if (tp_inst._defaults.maxDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime());
			}
			if (tp_inst._defaults.maxDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime());
			}
			tp_inst.$input.bind('focus', function() {
				tp_inst._onFocus();
			});

			return tp_inst;
		},

		/*
		* add our sliders to the calendar
		*/
		_addTimePicker: function(dp_inst) {
			var currDT = (this.$altInput &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly) ? this.$input.val() + ' ' + this.$altInput.val() : this.$input.val();

			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
		},

		/*
		* parse the time string from input value or _setTime
		*/
		_parseTime: function(timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0]);
			}

			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, 'dateFormat');
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false;
					}
					$.extend(this, parseRes.timeObj);
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err +
									"\ndate/time string = " + timeString +
									"\ntimeFormat = " + this._defaults.timeFormat +
									"\ndateFormat = " + dp_dateFormat);
					return false;
				}
				return true;
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false;
				}
				$.extend(this, timeObj);
				return true;
			}
		},

		/*
		* generate and inject html for timepicker into ui datepicker
		*/
		_injectTimePicker: function() {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = '',
				uitem = '',
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i=0,
				l=0;

			// Prevent displaying twice
			if ($dp.find("div.ui-timepicker-div").length === 0 &amp;amp;&amp;amp; o.showTimepicker) {
				var noDisplay = ' style="display:none;"',
					html = '&amp;lt;div class="ui-timepicker-div'+ (o.isRTL? ' ui-timepicker-rtl' : '') +'"&amp;gt;&amp;lt;dl&amp;gt;' + '&amp;lt;dt class="ui_tpicker_time_label"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;' + o.timeText + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_time"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the markup
				for(i=0,l=this.units.length; i&amp;lt;l; i++){
					litem = this.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// Added by Peter Medeiros:
					// - Figure out what the hour/minute/second max should be based on the step values.
					// - Example: if stepMinute is 15, then minMax is 45.
					max[litem] = parseInt((o[litem+'Max'] - ((o[litem+'Max'] - o[litem+'Min']) % o['step'+uitem])), 10);
					gridSize[litem] = 0;

					html += '&amp;lt;dt class="ui_tpicker_'+ litem +'_label"' + (show ? '' : noDisplay) + '&amp;gt;' + o[litem +'Text'] + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_'+ litem +'"&amp;gt;&amp;lt;div class="ui_tpicker_'+ litem +'_slider"' + (show ? '' : noDisplay) + '&amp;gt;&amp;lt;/div&amp;gt;';

					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						html += '&amp;lt;div style="padding-left: 1px"&amp;gt;&amp;lt;table class="ui-tpicker-grid-label"&amp;gt;&amp;lt;tr&amp;gt;';

						if(litem == 'hour'){
							for (var h = o[litem+'Min']; h &amp;lt;= max[litem]; h += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm? 'hht':'HH', {hour:h}, o);									
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + tmph + '&amp;lt;/td&amp;gt;';
							}
						}
						else{
							for (var m = o[litem+'Min']; m &amp;lt;= max[litem]; m += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + ((m &amp;lt; 10) ? '0' : '') + m + '&amp;lt;/td&amp;gt;';
							}
						}

						html += '&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;&amp;lt;/div&amp;gt;';
					}
					html += '&amp;lt;/dd&amp;gt;';
				}
				
				// Timezone
				var showTz = o.showTimezone !== null? o.showTimezone : this.support.timezone;
				html += '&amp;lt;dt class="ui_tpicker_timezone_label"' + (showTz ? '' : noDisplay) + '&amp;gt;' + o.timezoneText + '&amp;lt;/dt&amp;gt;';
				html += '&amp;lt;dd class="ui_tpicker_timezone" ' + (showTz ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the elements from string
				html += '&amp;lt;/dl&amp;gt;&amp;lt;/div&amp;gt;';
				var $tp = $(html);

				// if we only want time picker...
				if (o.timeOnly === true) {
					$tp.prepend('&amp;lt;div class="ui-widget-header ui-helper-clearfix ui-corner-all"&amp;gt;' + '&amp;lt;div class="ui-datepicker-title"&amp;gt;' + o.timeOnlyTitle + '&amp;lt;/div&amp;gt;' + '&amp;lt;/div&amp;gt;');
					$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();
				}
				
				// add sliders, adjust grids, add events
				for(i=0,l=tp_inst.units.length; i&amp;lt;l; i++){
					litem = tp_inst.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// add the slider
					tp_inst[litem+'_slider'] = tp_inst.control.create(tp_inst, $tp.find('.ui_tpicker_'+litem+'_slider'), litem, tp_inst[litem], o[litem+'Min'], max[litem], o['step'+uitem]);

					// adjust the grid and add click event
					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						size = 100 * gridSize[litem] * o[litem+'Grid'] / (max[litem] - o[litem+'Min']);
						$tp.find('.ui_tpicker_'+litem+' table').css({
							width: size + "%",
							marginLeft: o.isRTL? '0' : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL? ((size / (-2 * gridSize[litem])) + "%") : '0',
							borderCollapse: 'collapse'
						}).find("td").click(function(e){
								var $t = $(this),
									h = $t.html(),
									n = parseInt(h.replace(/[^0-9]/g),10),
									ap = h.replace(/[^apm]/ig),
									f = $t.data('for'); // loses scope, so we use data-for

								if(f == 'hour'){
									if(ap.indexOf('p') !== -1 &amp;amp;&amp;amp; n &amp;lt; 12){
										n += 12;
									}
									else{
										if(ap.indexOf('a') !== -1 &amp;amp;&amp;amp; n === 12){
											n = 0;
										}
									}
								}
								
								tp_inst.control.value(tp_inst, tp_inst[f+'_slider'], litem, n);

								tp_inst._onTimeChange();
								tp_inst._onSelectHandler();
							}).css({
								cursor: 'pointer',
								width: (100 / gridSize[litem]) + '%',
								textAlign: 'center',
								overflow: 'hidden'
							});
					} // end if grid &amp;gt; 0
				} // end for loop

				// Add timezone options
				this.timezone_select = $tp.find('.ui_tpicker_timezone').append('&amp;lt;select&amp;gt;&amp;lt;/select&amp;gt;').find("select");
				$.fn.append.apply(this.timezone_select,
				$.map(o.timezoneList, function(val, idx) {
					return $("&amp;lt;option /&amp;gt;").val(typeof val == "object" ? val.value : val).text(typeof val == "object" ? val.label : val);
				}));
				if (typeof(this.timezone) != "undefined" &amp;amp;&amp;amp; this.timezone !== null &amp;amp;&amp;amp; this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset()*-1;
					if (local_timezone == this.timezone) {
						selectLocalTimezone(tp_inst);
					} else {
						this.timezone_select.val(this.timezone);
					}
				} else {
					if (typeof(this.hour) != "undefined" &amp;amp;&amp;amp; this.hour !== null &amp;amp;&amp;amp; this.hour !== "") {
						this.timezone_select.val(o.timezone);
					} else {
						selectLocalTimezone(tp_inst);
					}
				}
				this.timezone_select.change(function() {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
				});
				// End timezone options
				
				// inject timepicker into datepicker
				var $buttonPanel = $dp.find('.ui-datepicker-buttonpane');
				if ($buttonPanel.length) {
					$buttonPanel.before($tp);
				} else {
					$dp.append($tp);
				}

				this.$timeObj = $tp.find('.ui_tpicker_time');

				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined;
				}

				// slideAccess integration: http://trentrichardson.com/2011/11/11/jquery-ui-sliders-and-touch-accessibility/
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
						
					setTimeout(function() { // fix for inline mode
						if ($tp.find('.ui-slider-access').length === 0) {
							$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);

							// fix any grids since sliders are shorter
							var sliderAccessWidth = $tp.find('.ui-slider-access:eq(0)').outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find('table:visible').each(function() {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl? 'marginRight':'marginLeft').toString().replace('%', ''),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + '%',
										css = { width: newWidth, marginRight: 0, marginLeft: 0 };
									css[rtl? 'marginRight':'marginLeft'] = newMarginLeft;
									$g.css(css);
								});
							}
						}
					}, 10);
				}
				// end slideAccess integration

				tp_inst._limitMinMaxDateTime(this.inst, true);
			}
		},

		/*
		* This function tries to limit the ability to go outside the
		* min/max date range
		*/
		_limitMinMaxDateTime: function(dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);

			if (!this._defaults.showTimepicker) {
				return;
			} // No time so nothing to check here

			if ($.datepicker._get(dp_inst, 'minDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'minDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, 'minDateTime'),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin;
				}

				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour &amp;lt;= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute &amp;lt;= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second &amp;lt;= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if(this.millisec &amp;lt;= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;lt; this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin;
									}
									this._defaults.microsecMin = this.microsecMinOriginal;
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal;
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal;
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal;
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal;
				}
			}

			if ($.datepicker._get(dp_inst, 'maxDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'maxDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, 'maxDateTime'),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax;
				}

				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour &amp;gt;= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute &amp;gt;= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second &amp;gt;= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec &amp;gt;= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;gt; this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax;
									}
									this._defaults.microsecMax = this.microsecMaxOriginal;
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal;
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal;
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal;
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal;
				}
			}

			if (adjustSliders !== undefined &amp;amp;&amp;amp; adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10);
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);

				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, 'hour', { min: this._defaults.hourMin, max: hourMax });
					this.control.value(this, this.hour_slider, 'hour', this.hour - (this.hour % this._defaults.stepHour));
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, 'minute', { min: this._defaults.minuteMin, max: minMax });
					this.control.value(this, this.minute_slider, 'minute', this.minute - (this.minute % this._defaults.stepMinute));
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, 'second', { min: this._defaults.secondMin, max: secMax });
					this.control.value(this, this.second_slider, 'second', this.second - (this.second % this._defaults.stepSecond));
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, 'millisec', { min: this._defaults.millisecMin, max: millisecMax });
					this.control.value(this, this.millisec_slider, 'millisec', this.millisec - (this.millisec % this._defaults.stepMillisec));
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, 'microsec', { min: this._defaults.microsecMin, max: microsecMax });
					this.control.value(this, this.microsec_slider, 'microsec', this.microsec - (this.microsec % this._defaults.stepMicrosec));
				}
			}

		},

		/*
		* when a slider moves, set the internal time...
		* on time change is also called when the time is updated in the text field
		*/
		_onTimeChange: function() {
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, 'hour') : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, 'minute') : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, 'second') : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, 'millisec') : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, 'microsec') : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;

			if (typeof(hour) == 'object') {
				hour = false;
			}
			if (typeof(minute) == 'object') {
				minute = false;
			}
			if (typeof(second) == 'object') {
				second = false;
			}
			if (typeof(millisec) == 'object') {
				millisec = false;
			}
			if (typeof(microsec) == 'object') {
				microsec = false;
			}
			if (typeof(timezone) == 'object') {
				timezone = false;
			}

			if (hour !== false) {
				hour = parseInt(hour, 10);
			}
			if (minute !== false) {
				minute = parseInt(minute, 10);
			}
			if (second !== false) {
				second = parseInt(second, 10);
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10);
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10);
			}

			var ampm = o[hour &amp;lt; 12 ? 'amNames' : 'pmNames'][0];

			// If the update was done in the input field, the input field should not be updated.
			// If the update was done using the sliders, update the input field.
			var hasChanged = (hour != this.hour || minute != this.minute || second != this.second || millisec != this.millisec || microsec != this.microsec 
								|| (this.ampm.length &amp;gt; 0 &amp;amp;&amp;amp; (hour &amp;lt; 12) != ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) 
								|| (this.timezone !== null &amp;amp;&amp;amp; timezone != this.timezone));

			if (hasChanged) {

				if (hour !== false) {
					this.hour = hour;
				}
				if (minute !== false) {
					this.minute = minute;
				}
				if (second !== false) {
					this.second = second;
				}
				if (millisec !== false) {
					this.millisec = millisec;
				}
				if (microsec !== false) {
					this.microsec = microsec;
				}
				if (timezone !== false) {
					this.timezone = timezone;
				}

				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0]);
				}

				this._limitMinMaxDateTime(this.inst, true);
			}
			if (this.support.ampm) {
				this.ampm = ampm;
			}

			// Updates the time within the timepicker
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if(pickerTimeFormat === o.timeFormat){
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix);
				}
				else{
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix);
				}
			}

			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime();
			}
		},

		/*
		* call custom onSelect.
		* bind to sliders slidestop, and grid click.
		*/
		_onSelectHandler: function() {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect &amp;amp;&amp;amp; inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this]);
			}
		},

		/*
		* update our input with the new date time..
		*/
		_updateDateTime: function(dp_inst) {
			dp_inst = this.inst || dp_inst;
			//var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
			var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay)),
				dateFmt = $.datepicker._get(dp_inst, 'dateFormat'),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null &amp;amp;&amp;amp; this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			
			// if a slider was changed but datepicker doesn't have a value yet, set it
			if(dp_inst.lastVal===""){
                dp_inst.currentYear=dp_inst.selectedYear;
                dp_inst.currentMonth=dp_inst.selectedMonth;
                dp_inst.currentDay=dp_inst.selectedDay;
            }

			/*
			* remove following lines to force every changes in date picker to change the input value
			* Bug descriptions: when an input field has a default value, and click on the field to pop up the date picker. 
			* If the user manually empty the value in the input field, the date picker will never change selected value.
			*/
			//if (dp_inst.lastVal !== undefined &amp;amp;&amp;amp; (dp_inst.lastVal.length &amp;gt; 0 &amp;amp;&amp;amp; this.$input.val().length === 0)) {
			//	return;
			//}

			if (this._defaults.timeOnly === true) {
				formattedDateTime = this.formattedTime;
			} else if (this._defaults.timeOnly !== true &amp;amp;&amp;amp; (this._defaults.alwaysSetTime || timeAvailable)) {
				formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix;
			}

			this.formattedDateTime = formattedDateTime;

			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate);
			} else if (this.$altInput &amp;amp;&amp;amp; this._defaults.timeOnly === false &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly === true) {
				this.$altInput.val(this.formattedTime);
				this.$input.val(this.formattedDate);
			} else if (this.$altInput) {
				this.$input.val(formattedDateTime);
				var altFormattedDateTime = '',
					altSeparator = this._defaults.altSeparator ? this._defaults.altSeparator : this._defaults.separator,
					altTimeSuffix = this._defaults.altTimeSuffix ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
				
				if(!this._defaults.timeOnly){
					if (this._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg);
					}
					else{
						altFormattedDateTime = this.formattedDate;
					}

					if (altFormattedDateTime){
						altFormattedDateTime += altSeparator;
					}
				}

				if(this._defaults.altTimeFormat){
					altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix;
				}
				else{
					altFormattedDateTime += this.formattedTime + altTimeSuffix;
				}
				this.$altInput.val(altFormattedDateTime);
			} else {
				this.$input.val(formattedDateTime);
			}

			this.$input.trigger("change");
		},

		_onFocus: function() {
			if (!this.$input.val() &amp;amp;&amp;amp; this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, 'timepicker');
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst);
						} catch (err) {
							$.timepicker.log(err);
						}
					}
				}
			}
		},

		/*
		* Small abstraction to control types
		* We can add more, just be sure to follow the pattern: create, options, value
		*/
		_controls: {
			// slider methods
			slider: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var rtl = tp_inst._defaults.isRTL; // if rtl go -60-&amp;gt;0 instead of 0-&amp;gt;60
					return obj.prop('slide', null).slider({
						orientation: "horizontal",
						value: rtl? val*-1 : val,
						min: rtl? max*-1 : min,
						max: rtl? min*-1 : max,
						step: step,
						slide: function(event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl? ui.value*-1:ui.value);
							tp_inst._onTimeChange();
						},
						stop: function(event, ui) {
							tp_inst._onSelectHandler();
						}
					});	
				},
				options: function(tp_inst, obj, unit, opts, val){
					if(tp_inst._defaults.isRTL){
						if(typeof(opts) == 'string'){
							if(opts == 'min' || opts == 'max'){
								if(val !== undefined){
									return obj.slider(opts, val*-1);
								}
								return Math.abs(obj.slider(opts));
							}
							return obj.slider(opts);
						}
						var min = opts.min, 
							max = opts.max;
						opts.min = opts.max = null;
						if(min !== undefined){
							opts.max = min * -1;
						}
						if(max !== undefined){
							opts.min = max * -1;
						}
						return obj.slider(opts);
					}
					if(typeof(opts) == 'string' &amp;amp;&amp;amp; val !== undefined){
							return obj.slider(opts, val);
					}
					return obj.slider(opts);
				},
				value: function(tp_inst, obj, unit, val){
					if(tp_inst._defaults.isRTL){
						if(val !== undefined){
							return obj.slider('value', val*-1);
						}
						return Math.abs(obj.slider('value'));
					}
					if(val !== undefined){
						return obj.slider('value', val);
					}
					return obj.slider('value');
				}
			},
			// select methods
			select: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var sel = '&amp;lt;select class="ui-timepicker-select" data-unit="'+ unit +'" data-min="'+ min +'" data-max="'+ max +'" data-step="'+ step +'"&amp;gt;',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;

					for(var i=min; i&amp;lt;=max; i+=step){						
						sel += '&amp;lt;option value="'+ i +'"'+ (i==val? ' selected':'') +'&amp;gt;';
						if(unit == 'hour'){
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig,'')), {hour:i}, tp_inst._defaults);
						}
						else if(unit == 'millisec' || unit == 'microsec' || i &amp;gt;= 10){ sel += i; }
						else {sel += '0'+ i.toString(); }
						sel += '&amp;lt;/option&amp;gt;';
					}
					sel += '&amp;lt;/select&amp;gt;';

					obj.children('select').remove();

					$(sel).appendTo(obj).change(function(e){
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
					});

					return obj;
				},
				options: function(tp_inst, obj, unit, opts, val){
					var o = {},
						$t = obj.children('select');
					if(typeof(opts) == 'string'){
						if(val === undefined){
							return $t.data(opts);
						}
						o[opts] = val;	
					}
					else{ o = opts; }
					return tp_inst.control.create(tp_inst, obj, $t.data('unit'), $t.val(), o.min || $t.data('min'), o.max || $t.data('max'), o.step || $t.data('step'));
				},
				value: function(tp_inst, obj, unit, val){
					var $t = obj.children('select');
					if(val !== undefined){
						return $t.val(val);
					}
					return $t.val();
				}
			}
		} // end _controls

	});

	$.fn.extend({
		/*
		* shorthand just to use timepicker..
		*/
		timepicker: function(o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);

			if (typeof o == 'object') {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				});
			}

			return $(this).each(function() {
				$.fn.datetimepicker.apply($(this), tmp_args);
			});
		},

		/*
		* extend timepicker to datepicker
		*/
		datetimepicker: function(o) {
			o = o || {};
			var tmp_args = arguments;

			if (typeof(o) == 'string') {
				if (o == 'getDate') {
					return $.fn.datepicker.apply($(this[0]), tmp_args);
				} else {
					return this.each(function() {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args);
					});
				}
			} else {
				return this.each(function() {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults);
				});
			}
		}
	});

	/*
	* Public Utility to parse date and time
	*/
	$.datepicker.parseDateTime = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec);
		}

		return parseRes.date;
	};

	/*
	* Public utility to parse time
	*/
	$.datepicker.parseTime = function(timeFormat, timeString, options) {		
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g,'').indexOf('Z') !== -1);

		// Strict parse requires the timeString to match the timeFormat exactly
		var strictParse = function(f, s, o){

			// pattern for standard and localized AM/PM markers
			var getPatternAmpm = function(amNames, pmNames) {
				var markers = [];
				if (amNames) {
					$.merge(markers, amNames);
				}
				if (pmNames) {
					$.merge(markers, pmNames);
				}
				markers = $.map(markers, function(val) {
					return val.replace(/[.*+?|()\[\]{}\\]/g, '\\$&amp;amp;');
				});
				return '(' + markers.join('|') + ')?';
			};

			// figure out position of time elements.. cause js cant do named captures
			var getFormatPositions = function(timeFormat) {
				var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
					orders = {
						h: -1,
						m: -1,
						s: -1,
						l: -1,
						c: -1,
						t: -1,
						z: -1
					};

				if (finds) {
					for (var i = 0; i &amp;lt; finds.length; i++) {
						if (orders[finds[i].toString().charAt(0)] == -1) {
							orders[finds[i].toString().charAt(0)] = i + 1;
						}
					}
				}
				return orders;
			};

			var regstr = '^' + f.toString()
					.replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
							var ml = match.length;
							switch (match.charAt(0).toLowerCase()) {
								case 'h': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'm': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 's': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'l': return '(\\d?\\d?\\d)';
								case 'c': return '(\\d?\\d?\\d)';
								case 'z': return '(z|[-+]\\d\\d:?\\d\\d|\\S+)?';
								case 't': return getPatternAmpm(o.amNames, o.pmNames);
								default:    // literal escaped in quotes
									return '(' + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function (m) { return "\\" + m; }) + ')?';
							}
						})
					.replace(/\s/g, '\\s?') +
					o.timeSuffix + '$',
				order = getFormatPositions(f),
				ampm = '',
				treg;

			treg = s.match(new RegExp(regstr, 'i'));

			var resTime = {
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0
			};

			if (treg) {
				if (order.t !== -1) {
					if (treg[order.t] === undefined || treg[order.t].length === 0) {
						ampm = '';
						resTime.ampm = '';
					} else {
						ampm = $.inArray(treg[order.t].toUpperCase(), o.amNames) !== -1 ? 'AM' : 'PM';
						resTime.ampm = o[ampm == 'AM' ? 'amNames' : 'pmNames'][0];
					}
				}

				if (order.h !== -1) {
					if (ampm == 'AM' &amp;amp;&amp;amp; treg[order.h] == '12') {
						resTime.hour = 0; // 12am = 0 hour
					} else {
						if (ampm == 'PM' &amp;amp;&amp;amp; treg[order.h] != '12') {
							resTime.hour = parseInt(treg[order.h], 10) + 12; // 12pm = 12 hour, any other pm = hour + 12
						} else {
							resTime.hour = Number(treg[order.h]);
						}
					}
				}

				if (order.m !== -1) {
					resTime.minute = Number(treg[order.m]);
				}
				if (order.s !== -1) {
					resTime.second = Number(treg[order.s]);
				}
				if (order.l !== -1) {
					resTime.millisec = Number(treg[order.l]);
				}
				if (order.c !== -1) {
					resTime.microsec = Number(treg[order.c]);
				}
				if (order.z !== -1 &amp;amp;&amp;amp; treg[order.z] !== undefined) {
					resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z]);
				}


				return resTime;
			}
			return false;
		};// end strictParse

		// First try JS Date, if that fails, use strictParse
		var looseParse = function(f,s,o){
			try{
				var d = new Date('2012-01-01 '+ s);
				if(isNaN(d.getTime())){
					d = new Date('2012-01-01T'+ s);
					if(isNaN(d.getTime())){
						d = new Date('01/01/2012 '+ s);
						if(isNaN(d.getTime())){
							throw "Unable to parse time with native Date: "+ s;
						}
					}
				}

				return {
					hour: d.getHours(),
					minute: d.getMinutes(),
					second: d.getSeconds(),
					millisec: d.getMilliseconds(),
					microsec: d.getMicroseconds(),
					timezone: d.getTimezoneOffset()*-1
				};
			}
			catch(err){
				try{
					return strictParse(f,s,o);
				}
				catch(err2){
					$.timepicker.log("Unable to parse \ntimeString: "+ s +"\ntimeFormat: "+ f);
				}				
			}
			return false;
		}; // end looseParse
		
		if(typeof o.parse === "function"){
			return o.parse(timeFormat, timeString, o);
		}
		if(o.parse === 'loose'){
			return looseParse(timeFormat, timeString, o);
		}
		return strictParse(timeFormat, timeString, o);
	};

	/*
	* Public utility to format the time
	* format = string format of the time
	* time = a {}, not a Date() for timezones
	* options = essentially the regional[].. amNames, pmNames, ampm
	*/
	$.datepicker.formatTime = function(format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			timezone: 0
		}, time);

		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);

		if (hour &amp;gt; 11) {
			ampmName = options.pmNames[0];
		}

		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|('.*?'|".*?"))/g, function(match) {
		switch (match) {
			case 'HH':
				return ('0' + hour).slice(-2);
			case 'H':
				return hour;
			case 'hh':
				return ('0' + convert24to12(hour)).slice(-2);
			case 'h':
				return convert24to12(hour);
			case 'mm':
				return ('0' + time.minute).slice(-2);
			case 'm':
				return time.minute;
			case 'ss':
				return ('0' + time.second).slice(-2);
			case 's':
				return time.second;
			case 'l':
				return ('00' + time.millisec).slice(-3);
			case 'c':
				return ('00' + time.microsec).slice(-3);
			case 'z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, false);
			case 'Z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, true);
			case 'T': 
				return ampmName.charAt(0).toUpperCase();
			case 'TT': 
				return ampmName.toUpperCase();
			case 't':
				return ampmName.charAt(0).toLowerCase();
			case 'tt':
				return ampmName.toLowerCase();
			default:
				return match.replace(/\'/g, "") || "'";
			}
		});

		tmptime = $.trim(tmptime);
		return tmptime;
	};

	/*
	* the bad hack :/ override datepicker so it doesnt close on select
	// inspired: http://stackoverflow.com/questions/1252512/jquery-datepicker-prevent-closing-picker-when-clicking-a-date/1762378#1762378
	*/
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function(id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			tp_inst._limitMinMaxDateTime(inst, true);
			inst.inline = inst.stay_open = true;
			//This way the onSelect handler called from calendarpicker get the full dateTime
			this._base_selectDate(id, dateStr);
			inst.inline = inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst);
		} else {
			this._base_selectDate(id, dateStr);
		}
	};

	/*
	* second bad hack :/ override datepicker so it triggers an event when changing the input field
	* and does not redraw the datepicker on every selectDate event
	*/
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function(inst) {

		// don't popup the datepicker if there is another instance already opened
		var input = inst.input[0];
		if ($.datepicker._curInst &amp;amp;&amp;amp; $.datepicker._curInst != inst &amp;amp;&amp;amp; $.datepicker._datepickerShowing &amp;amp;&amp;amp; $.datepicker._lastInput != input) {
			return;
		}

		if (typeof(inst.stay_open) !== 'boolean' || inst.stay_open === false) {

			this._base_updateDatepicker(inst);

			// Reload the time control when changing something in the input text field.
			var tp_inst = this._get(inst, 'timepicker');
			if (tp_inst) {
				tp_inst._addTimePicker(inst);
			}
		}
	};

	/*
	* third bad hack :/ override datepicker so it allows spaces and colon in the input field
	*/
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if ($.datepicker._get(inst, 'constrainInput')) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null? tp_inst._defaults.showTimezone : tp_inst.support.timezone,					
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat')),
					datetimeChars = tp_inst._defaults.timeFormat.toString()
											.replace(/[hms]/g, '')
											.replace(/TT/g, ampm ? 'APM' : '')
											.replace(/Tt/g, ampm ? 'AaPpMm' : '')
											.replace(/tT/g, ampm ? 'AaPpMm' : '')
											.replace(/T/g, ampm ? 'AP' : '')
											.replace(/tt/g, ampm ? 'apm' : '')
											.replace(/t/g, ampm ? 'ap' : '') + 
											" " + tp_inst._defaults.separator + 
											tp_inst._defaults.timeSuffix + 
											(tz ? tp_inst._defaults.timezoneList.join('') : '') + 
											(tp_inst._defaults.amNames.join('')) + (tp_inst._defaults.pmNames.join('')) + 
											dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr &amp;lt; ' ' || !dateChars || datetimeChars.indexOf(chr) &amp;gt; -1);
			}
		}

		return $.datepicker._base_doKeyPress(event);
	};

	/*
	* Fourth bad hack :/ override _updateAlternate function used in inline mode to init altField
	*/
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	/* Update any alternate field to synchronise with the main field. */
	$.datepicker._updateAlternate = function(inst) {
		var tp_inst = this._get(inst, 'timepicker');
		if(tp_inst){
			var altField = tp_inst._defaults.altField;
			if (altField) { // update alternate field too
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = '', 
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator, 
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if(!tp_inst._defaults.timeOnly &amp;amp;&amp;amp; !tp_inst._defaults.altFieldTimeOnly &amp;amp;&amp;amp; date !== null){
					if(tp_inst._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime;
					}
					else{
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime;
					}
				}
				$(altField).val(altFormattedDateTime);
			}
		}
		else{
			$.datepicker._base_updateAlternate(inst);
		}
	};

	/*
	* Override key up event to sync manual input changes.
	*/
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst);
				} catch (err) {
					$.timepicker.log(err);
				}
			}
		}

		return $.datepicker._base_doKeyUp(event);
	};

	/*
	* override "Today" button to also grab the time.
	*/
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function(id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		this._base_gotoToday(id);
		var tp_inst = this._get(inst, 'timepicker');
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		$('.ui-datepicker-today', $dp).click();
	};

	/*
	* Disable &amp;amp; enable the Time in the datetimepicker
	*/
	$.datepicker._disableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst);
		}
	};

	$.datepicker._enableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst); // Could be disabled on page load
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create our own set time function
	*/
	$.datepicker._setTime = function(inst, date) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var defaults = tp_inst._defaults;

			// calling _setTime with no date sets time to defaults
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;

			//check if within min/max times.. 
			tp_inst._limitMinMaxDateTime(inst, true);

			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create new public method to set only time, callable as $().datepicker('setTime', date)
	*/
	$.datepicker._setTimeDatepicker = function(target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date == "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec);
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds());
				}
				if (tp_date.toString() == 'Invalid Date') {
					tp_date = undefined;
				}
				this._setTime(inst, tp_date);
			}
		}

	};

	/*
	* override setDate() to allow setting time too within Date object
	*/
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function(target, date) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		if(typeof(date) === 'string'){
			date = new Date(date);
			if(!date.getTime()){
				$.timepicker.log("Error creating Date object from string.");
			}
		}

		var tp_inst = this._get(inst, 'timepicker');
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds());
		} else {
			tp_date = date;
		}
		
		// This is important if you are using the timezone option, javascript's Date 
		// object will only return the timezone offset for the current locale, so we 
		// adjust it accordingly.  If not using timezone option this won't matter..
		// If a timezone is different in tp, keep the timezone as is
		if(tp_inst){
			// look out for DST if tz wasn't specified
			if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
				tp_inst.timezone = tp_date.getTimezoneOffset()*-1;
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone);
		}

		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true);
	};

	/*
	* override getDate() to allow getting time too within Date object
	*/
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function(target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			// if it hasn't yet been defined, grab from field
			if(inst.lastVal === undefined){
				this._setDateFromField(inst, noDefault);
			}

			var date = this._getDate(inst);
			if (date &amp;amp;&amp;amp; tp_inst._parseTime($(target).val(), tp_inst.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);

				// This is important if you are using the timezone option, javascript's Date 
				// object will only return the timezone offset for the current locale, so we 
				// adjust it accordingly.  If not using timezone option this won't matter..
				if(tp_inst.timezone != null){
					// look out for DST if tz wasn't specified
					if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
						tp_inst.timezone = date.getTimezoneOffset()*-1;
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
				}
			}
			return date;
		}
		return this._base_getDateDatepicker(target, noDefault);
	};

	/*
	* override parseDate() because UI 1.8.14 throws an error about "Extra characters"
	* An option in datapicker to ignore extra format characters would be nicer.
	*/
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function(format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings);
		} catch (err) {
			// Hack!  The error message ends with a colon, a space, and
			// the "extra" characters.  We rely on that instead of
			// attempting to perfectly reproduce the parsing algorithm.
			if (err.indexOf(":") &amp;gt;= 0) {
				date = this._base_parseDate(format, value.substring(0,value.length-(err.length-err.indexOf(':')-2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format);
			} else {
				throw err;
			}
		}
		return date;
	};

	/*
	* override formatDate to set date with time to the input
	*/
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function(inst, day, month, year) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val();
		}
		return this._base_formatDate(inst);
	};

	/*
	* override options setter to add time to maxDate(Time) and minDate(Time). MaxDate
	*/
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function(target, name, value) {
		var inst = this._getInst(target),
	        name_clone;
		if (!inst) {
			return null;
		}

		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop;
		    if (typeof name == 'string') { // if min/max was set with the string
		        if (name === 'minDate' || name === 'minDateTime') {
		            min = value;
		        } else if (name === 'maxDate' || name === 'maxDateTime') {
		            max = value;
		        } else if (name === 'onSelect') {
		            onselect = value;
		        } else if (overrides.hasOwnProperty(name)) {
		            if (typeof (value) === 'undefined') {
		                return overrides[name];
		            }
		            fns[name] = value;
		            name_clone = {}; //empty results in exiting function after overrides updated
		        }
		    } else if (typeof name == 'object') { //if min/max was set with the JSON
		        if (name.minDate) {
		            min = name.minDate;
		        } else if (name.minDateTime) {
		            min = name.minDateTime;
		        } else if (name.maxDate) {
		            max = name.maxDate;
		        } else if (name.maxDateTime) {
		            max = name.maxDateTime;
		        }
		        for (prop in overrides) {
		            if (overrides.hasOwnProperty(prop) &amp;amp;&amp;amp; name[prop]) {
		                fns[prop] = name[prop];
		            }
		        }
		    }
		    for (prop in fns) {
		        if (fns.hasOwnProperty(prop)) {
		            overrides[prop] = fns[prop];
		            if (!name_clone) { name_clone = $.extend({}, name);}
		            delete name_clone[prop];
		        }
		    }
		    if (name_clone &amp;amp;&amp;amp; isEmptyObject(name_clone)) { return; }
		    if (min) { //if min was set
		        if (min === 0) {
		            min = new Date();
		        } else {
		            min = new Date(min);
		        }
		        tp_inst._defaults.minDate = min;
		        tp_inst._defaults.minDateTime = min;
		    } else if (max) { //if max was set
		        if (max === 0) {
		            max = new Date();
		        } else {
		            max = new Date(max);
		        }
		        tp_inst._defaults.maxDate = max;
		        tp_inst._defaults.maxDateTime = max;
		    } else if (onselect) {
		        tp_inst._defaults.onSelect = onselect;
		    }
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name);
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
	};
	
	/*
	* jQuery isEmptyObject does not check hasOwnProperty - if someone has added to the object prototype,
	* it will return false for all objects
	*/
	var isEmptyObject = function(obj) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(obj)) {
				return false;
			}
		}
		return true;
	};

	/*
	* jQuery extend now ignores nulls!
	*/
	var extendRemove = function(target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] === null || props[name] === undefined) {
				target[name] = props[name];
			}
		}
		return target;
	};

	/*
	* Determine by the time format which units are supported
	* Returns an object of booleans for each unit
	*/
	var detectSupport = function(timeFormat){
		var tf = timeFormat.replace(/\'.*?\'/g,'').toLowerCase(), // removes literals
			isIn = function(f, t){ // does the format contain the token?
					return f.indexOf(t) !== -1? true:false; 
				};
		return {
				hour: isIn(tf,'h'),
				minute: isIn(tf,'m'),
				second: isIn(tf,'s'),
				millisec: isIn(tf,'l'),
				microsec: isIn(tf,'c'),
				timezone: isIn(tf,'z'),
				ampm: isIn(tf,'t') &amp;amp;&amp;amp; isIn(timeFormat,'h'),
				iso8601: isIn(timeFormat, 'Z')
			};
	};

	/*
	* Converts 24 hour format into 12 hour
	* Returns 12 hour without leading 0
	*/
	var convert24to12 = function(hour) {
		if (hour &amp;gt; 12) {
			hour = hour - 12;
		}

		if (hour === 0) {
			hour = 12;
		}

		return String(hour);
	};

	/*
	* Splits datetime string into date ans time substrings.
	* Throws exception when date can't be parsed
	* Returns [dateString, timeString]
	*/
	var splitDateTime = function(dateFormat, dateTimeString, dateSettings, timeSettings) {
		try {
			// The idea is to get the number separator occurances in datetime and the time format requested (since time has 
			// fewer unknowns, mostly numbers and am/pm). We will use the time pattern to split.
			var separator = timeSettings &amp;amp;&amp;amp; timeSettings.separator ? timeSettings.separator : $.timepicker._defaults.separator,
				format = timeSettings &amp;amp;&amp;amp; timeSettings.timeFormat ? timeSettings.timeFormat : $.timepicker._defaults.timeFormat,
				timeParts = format.split(separator), // how many occurances of separator may be in our format?
				timePartsLen = timeParts.length,
				allParts = dateTimeString.split(separator),
				allPartsLen = allParts.length;

			if (allPartsLen &amp;gt; 1) {
				return [
						allParts.splice(0,allPartsLen-timePartsLen).join(separator),
						allParts.splice(0,timePartsLen).join(separator)
					];
			}

		} catch (err) {
			$.timepicker.log('Could not split the date from the time. Please check the following datetimepicker options' +
					"\nthrown error: " + err +
					"\ndateTimeString" + dateTimeString +
					"\ndateFormat = " + dateFormat +
					"\nseparator = " + timeSettings.separator +
					"\ntimeFormat = " + timeSettings.timeFormat);

			if (err.indexOf(":") &amp;gt;= 0) {
				// Hack!  The error message ends with a colon, a space, and
				// the "extra" characters.  We rely on that instead of
				// attempting to perfectly reproduce the parsing algorithm.
				var dateStringLength = dateTimeString.length - (err.length - err.indexOf(':') - 2),
					timeString = dateTimeString.substring(dateStringLength);

				return [$.trim(dateTimeString.substring(0, dateStringLength)), $.trim(dateTimeString.substring(dateStringLength))];

			} else {
				throw err;
			}
		}
		return [dateTimeString, ''];
	};

	/*
	* Internal function to parse datetime interval
	* Returns: {date: Date, timeObj: Object}, where
	*   date - parsed date without time (type Date)
	*   timeObj = {hour: , minute: , second: , millisec: , microsec: } - parsed time. Optional
	*/
	var parseDateTimeInternal = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var date;
		var splitRes = splitDateTime(dateFormat, dateTimeString, dateSettings, timeSettings);
		date = $.datepicker._base_parseDate(dateFormat, splitRes[0], dateSettings);
		if (splitRes[1] !== '') {
			var timeString = splitRes[1],
				parsedTime = $.datepicker.parseTime(timeFormat, timeString, timeSettings);

			if (parsedTime === null) {
				throw 'Wrong time format';
			}
			return {
				date: date,
				timeObj: parsedTime
			};
		} else {
			return {
				date: date
			};
		}
	};

	/*
	* Internal function to set timezone_select to the local timezone
	*/
	var selectLocalTimezone = function(tp_inst, date) {
		if (tp_inst &amp;amp;&amp;amp; tp_inst.timezone_select) {
			var now = typeof date !== 'undefined' ? date : new Date();
			tp_inst.timezone_select.val(now.getTimezoneOffset()*-1);
		}
	};

	/*
	* Create a Singleton Insance
	*/
	$.timepicker = new Timepicker();

	/**
	 * Get the timezone offset as string from a date object (eg '+0530' for UTC+5.5)
	 * @@param  number if not a number this value is returned
	 * @@param boolean if true formats in accordance to iso8601 "+12:45"
	 * @@return string
	 */
	$.timepicker.timezoneOffsetString = function(tzMinutes, iso8601) {
		if(isNaN(tzMinutes) || tzMinutes &amp;gt; 840){
			return tzMinutes;
		}

		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601? ':':'',
			tz = (off &amp;gt;= 0 ? '+' : '-') + ('0' + (hours * 101).toString()).slice(-2) + iso + ('0' + (minutes * 101).toString()).slice(-2);
		
		if(tz == '+00:00'){
			return 'Z';
		}
		return tz;
	};

	/**
	 * Get the number in minutes that represents a timezone string
	 * @@param  string formated like "+0500", "-1245"
	 * @@return number
	 */
	$.timepicker.timezoneOffsetNumber = function(tzString) {
		tzString = tzString.toString().replace(':',''); // excuse any iso8601, end up with "+1245"

		if(tzString.toUpperCase() === 'Z'){ // if iso8601 with Z, its 0 minute offset
			return 0;
		}

		if(!/^(\-|\+)\d{4}$/.test(tzString)){ // possibly a user defined tz, so just give it back
			return tzString;
		}

		return ((tzString.substr(0,1) =='-'? -1 : 1) * // plus or minus
					((parseInt(tzString.substr(1,2),10)*60) + // hours (converted to minutes)
					parseInt(tzString.substr(3,2),10))); // minutes
	};

	/**
	 * No way to set timezone in js Date, so we must adjust the minutes to compensate. (think setDate, getDate)
	 * @@param  date
	 * @@param  string formated like "+0500", "-1245"
	 * @@return date
	 */
	$.timepicker.timezoneAdjust = function(date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if(!isNaN(toTz)){
			date.setMinutes(date.getMinutes()*1 + (date.getTimezoneOffset()*-1 - toTz*1) );
		}
		return date;
	};

	/**
	 * Calls `timepicker()` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * n.b. The input value must be correctly formatted (reformatting is not supported)
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the timepicker() call
	 * @@return jQuery
	 */
	$.timepicker.timeRange = function(startTime, endTime, options) {
		return $.timepicker.handleRange('timepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datetimepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@return jQuery
	 */
	$.timepicker.datetimeRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datetimepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.dateRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.handleRange = function(method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0, // min allowed interval in milliseconds
			maxInterval: 0, // max allowed interval in milliseconds
			start: {},      // options for start picker
			end: {}         // options for end picker
		}, options);

		$.fn[method].call(startTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), endTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), endTime, 'minDate');
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), startTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), startTime, 'maxDate');
			}
		}, options, options.end));

		checkDates(startTime, endTime);
		selected(startTime, endTime, 'minDate');
		selected(endTime, startTime, 'maxDate');

		function checkDates(changed, other) {
			var startdt = startTime[method]('getDate'),
				enddt = endTime[method]('getDate'),
				changeddt = changed[method]('getDate');

			if(startdt !== null){
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());

				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);

				if(options.minInterval &amp;gt; 0 &amp;amp;&amp;amp; minDate &amp;gt; enddt){ // minInterval check
					endTime[method]('setDate',minDate);
				}
				else if(options.maxInterval &amp;gt; 0 &amp;amp;&amp;amp; maxDate &amp;lt; enddt){ // max interval check
					endTime[method]('setDate',maxDate);
				}
				else if (startdt &amp;gt; enddt) {
					other[method]('setDate',changeddt);
				}
			}
		}

		function selected(changed, other, option) {
			if (!changed.val()) {
				return;
			}
			var date = changed[method].call(changed, 'getDate');
			if(date !== null &amp;amp;&amp;amp; options.minInterval &amp;gt; 0){
				if(option == 'minDate'){
					date.setMilliseconds(date.getMilliseconds() + options.minInterval); 
				}
				if(option == 'maxDate'){
					date.setMilliseconds(date.getMilliseconds() - options.minInterval);
				}
			}
			if (date.getTime) {
				other[method].call(other, 'option', option, date);
			}
		}
		return $([startTime.get(0), endTime.get(0)]);
	};

	/**
	 * Log error or data to the console during error or debugging
	 * @@param  Object err pass any type object to log to the console during error or debugging
	 * @@return void
	 */
	$.timepicker.log = function(err){
		if(window.console){
			console.log(err);
		}
	};

	/*
	* Microsecond support
	*/
	if(!Date.prototype.getMicroseconds){
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function(){ return this.microseconds; };
		Date.prototype.setMicroseconds = function(m){ 
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m/1000));
			this.microseconds = m%1000;
			return this;
		};
	}

	/*
	* Keep up with the version
	*/
	$.timepicker.version = "1.3.1";

})(jQuery);
jQuery.noConflict();
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;datetimepicker-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;e73a652e-09fc-4c71-8e7a-e2525a2d2a99&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
function replaceAllString(oriStr, strTarget, strSubString ){
   var strText = oriStr;
   var intIndexOfMatch = strText.indexOf( strTarget );
   while (intIndexOfMatch != -1){
      strText = strText.replace( strTarget, strSubString )
      intIndexOfMatch = strText.indexOf( strTarget );
   }
   return( strText );
}
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&amp;amp;]" + name + "=([^&amp;amp;#]*)"),
    results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
};


   var jobName= getParameterByName('job')
   var fromDate= getParameterByName('fromDate')
   var toDate= getParameterByName('toDate')
   var limit= getParameterByName('limit')
   var selectedIstIid = getParameterByName('IstIid')

  $("#jobname").ready(function(){
   $("#jobname").text(jobName)
   var convertedJobName = replaceAllString(jobName, ".", "_")
   $("#IstIid" + convertedJobName).ready(function(){
     $("#IstIid" + convertedJobName).css("display","block")
     $("#select_" + convertedJobName).ready(function(){
        $("#select_" + convertedJobName).val(selectedIstIid)
     });
   });
 });

  $("#fromDate").ready(function(){
   $("#from-date").val(fromDate)
 });

  $("#toDate").ready(function(){
   $("#to-date").val(toDate)
 });

  $("#limit").ready(function(){
   if(limit!=""){
    $("#limit").val(limit)
   }
 });
 // Get data with ajax
 function ajax_getData(jobName,fromDate,toDate,limit ){
       var convertedJobName = replaceAllString(jobName, ".", "_")
       var istIid = $("#select_" + convertedJobName).val()
       window.location="/xwiki/bin/view/WiperDog/WebHome?job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid="+istIid;
 			/*$.ajax({
			 type: "GET",
			 url:"/xwiki/bin/get/Sandbox/DescriptionForJob?outputSyntax=plain&amp;amp;job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid"+selectedIstIid,
			 success : function(result){
				$("#jobname").html(jobName)
				$("#display").text('[[]]' + result)
			 }
		   });*/
 }
	$("#treemenu2 a").click(function(){
		 var limit = 10
		 var fromDate=""
		 var toDate = ""
		 jobName= $(this).text()
                 $("#jobname").html(jobName)
                 var convertedJobName = replaceAllString(jobName, ".", "_")
                 $("#listIstIid &amp;gt; div").css("display","none")
                 $("#IstIid" + convertedJobName).css("display","block")
		 //ajax_getData(jobName,fromDate,toDate,limit )

	});

	$("#from-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
		dateFormat: 'yy-mm-dd',
	});
	$("#to-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
			dateFormat: 'yy-mm-dd',

	});
	 $("#get-data").on("click",function(){
		var fromDate = $("#from-date").val()
		var toDate =  $("#to-date").val()
		 if( toDate!= "" ){
			  if(fromDate != ""){
				  if($("#from-date").datepicker( "getDate" ) &amp;gt; $("#to-date").datepicker( "getDate" )){
				  alert("'From date' cannot start later than 'To date'")
				  return false
				  }
			  }
		 }
		 limit = $("#limit").val()
		 ajax_getData(jobName,fromDate,toDate,limit )
	});
$(document).ready(function(){
  var keys = $("#lstkey").text()
  //console.log('key == ' + keys);
  //console.log('livetableJson ==' + $("#livetableJson").text());
  
  var jsonObj = $.parseJSON($("#livetableJson").text()); 
  if(keys &amp;amp;&amp;amp; keys != '[ ]'){
    /** Subtyped **/    
    var newKeys = keys.replace('[',"");
    keys = newKeys.replace(']',"");
    var keyArr = (keys.indexOf(',') != -1)? keys.split(','):new Array(keys);
    //console.log('Key after replace: '+keys)       
    for(var i=0;i&amp;lt;keyArr.length;i++){
        var keyName = keyArr[i].trim().replace('',"").replace("\"","").replace('\"','');
        var subTypeJsonObjStr = jsonObj[keyName].replace('#livetablePager','#livetablePager_'+keyName)
        var subTypeJsonObj = $.parseJSON(subTypeJsonObjStr);
        $("#livetableList_"+keyName).jqGrid(subTypeJsonObj);
        $("#livetableList_"+keyName).jqGrid('navGrid', "#livetablePager_"+keyName, {
           edit : false,
           add : false,
           del : false,
           search:false
         });
    }
    
  }else{ /** Store**/        
      $("#livetableList").jqGrid(jsonObj);
      $("#livetableList").jqGrid('navGrid', "#livetablePager", {
           edit : false,
           add : false,
           del : false,
           search:false
           
       });
   }
});
        
jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;process&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;881686cc-1bfc-456e-b8ab-71334c4a45e5&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){

	$(function () {
		function drawLineChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerline' + container).highcharts({

				chart: {
					type:'line'
				},
				title: {
					text: chart_name
				},
				tooltip :{
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				xAxis: dataXAxis ,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				series: dataSeries
			});
		};

		function drawBarChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerbar' + container).highcharts({
				chart: {
					type: 'column'
				},
				title: {
					text: chart_name
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {

					column: {
						pointPadding: 0.2,
						borderWidth: 0
					}
				},
				series: dataSeries
			});
		}

		function drawAreaChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail
			$('#containerarea' + container).highcharts({
				chart: {
					type: 'area'
				},
				title: {
					text: chart_name
				},
				subtitle: {
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					},
					labels: {
						formatter: function() {
							return this.value / 1000;
						}
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {
					area: {
						stacking: 'normal',
						lineColor: '#666666',
						lineWidth: 1,
						marker: {
							lineWidth: 1,
							lineColor: '#666666'
						}
					}
				},
				series: dataSeries
			});
		};

		function drawPieChart(data, container, chartName){
			var dataPie = data
			$(document).ready(function () {
				// Build the chart
				$('#container' + container).highcharts({
					chart: {
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: chartName
					},
					tooltip: {
						pointFormat: '{series.name}: &amp;lt;b&amp;gt;{point.percentage:.1f}%&amp;lt;/b&amp;gt;'
					},
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							dataLabels: {
								enabled: true,
                                                                color: '#000000',
                                                                connectorColor: '#000000',
                                                                format: '&amp;lt;b&amp;gt;{point.name}&amp;lt;/b&amp;gt;: {point.percentage:.1f} %'
							},
							showInLegend: true
						}
					},
					series: dataPie
				});
			});
		}

		// LINE
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                     if(($("#jsons&amp;gt;#jsonline_" + finalKey)).length &amp;gt; 0) {
					var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonline_" + finalKey).val());
					var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerline_" + finalKey).val());
				        var lstContainer = [];
  				        var data_all = [];
                                        var chartSize = arrayAll.length

                                        for(var i=0;i&amp;lt;chartSize ;i++){
                                           data_all = arrayAll[i]
                                           lstContainer = arrayContainerAll[i]
				           if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					        // data to display on tooltip
					        var data_detail = data_all[0]
					        // draw Line chart
				        	for(var j=0;j&amp;lt;data_all.length;j++){
				        		if(data_all[j].series[0].name == null){
				        			data_all[j].series[0].name = lstContainer[j]
					        	}
                                                        chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					        	drawLineChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					        }
				         }
                                      }
                                  }
				}
			} else {
				var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonline").val());
				var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerline").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length

                                for(var i=0;i&amp;lt;chartSize ;i++){
                                   data_all = arrayAll[i]
                                   lstContainer = arrayContainerAll[i]
				   if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Line chart
					for(var j=0;j&amp;lt;data_all.length;j++){
						if(data_all[j].series[0].name == null){
							data_all[j].series[0].name = lstContainer[j]
						}
                                                chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
						drawLineChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
				   }
                                }
			}
		});

		// BAR
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
			             var finalKey = lstKey[eKey]
                                     if(($("#jsons&amp;gt;#jsonbar_" + finalKey)).length &amp;gt; 0) {
					var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonbar_" + finalKey).val());
					var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerbar_" + finalKey).val());
					var lstContainer = [];
					var data_all = [];
                                        var chartSize = arrayAll.length
					for(var i=0;i&amp;lt;chartSize ;i++){
					    data_all = arrayAll[i]
					    lstContainer = arrayContainerAll[i]
					    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw bar chart
						for(var j=0;j&amp;lt;data_all.length;j++){
							if(data_all[j].series[0].name == null){
								data_all[j].series[0].name = lstContainer[j]
							}
                                                        chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
							drawBarChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
						}
                                            }
					}
                                    }
				}
			} else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonbar").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerbar").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
				    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Bar chart
					for(var j=0;j&amp;lt;data_all.length;j++){
                                            if(data_all[j].series[0].name == null){
						data_all[j].series[0].name = lstContainer[j]
					    }
                                            chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					    drawBarChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
                                    }
				}
			}
		});

		// AREA
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
                        var arrayAll
                        var arrayContainerAll
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                        if(($("#jsons&amp;gt;#jsonarea_" + finalKey)).length &amp;gt; 0) {
                                           arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonarea_" + finalKey).val());
                                           arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerarea_" + finalKey).val());
					   var lstContainer = [];
					   var data_all = [];
                                           var chartSize = arrayAll.length
					   for(var i=0;i&amp;lt;chartSize ;i++){
					       data_all = arrayAll[i]
					       lstContainer = arrayContainerAll[i]
					       if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						   // data to display on tooltip
						   var data_detail = data_all[0]
						   // draw Line chart
						   for(var j=0;j&amp;lt;data_all.length;j++){
						      if(data_all[j].series[0].name == null){
						         data_all[j].series[0].name = lstContainer[j]
						       }
                                                       chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
						       drawAreaChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
						   }
					      }
				           }
                                        }
			          }
                        } else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonarea").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerarea").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
				    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw area chart
					for(var j=0;j&amp;lt;data_all.length;j++){
                                            if(data_all[j].series[0].name == null){
						data_all[j].series[0].name = lstContainer[j]
					    }
                                            chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					    drawAreaChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
                                    }
				}
			}
		});

		// PIE
		$(document ).ready(function(){
                        var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
                        var arrayAll
                        var arrayContainerAll
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                        if(($("#jsons&amp;gt;#jsonpie_" + finalKey)).length &amp;gt; 0) {
                                           arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonpie_" + finalKey).val());
                                           arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerpie_" + finalKey).val());
					   var lstContainer = [];
					   var data_all = [];
                                           var chartSize = arrayAll.length
					  for(var i=0;i&amp;lt;chartSize ;i++){
					       data_all = arrayAll[i]
					       lstContainer = arrayContainerAll[i]
					       if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						   // draw Pie chart
						   for(var j=0;j&amp;lt;data_all.length;j++){
                                                       chartName  = data_all[j].name
						       drawPieChart(data_all, finalKey + "_" + lstContainer[j], chartName)
						   }
					      }
				           }
                                        }
			          }
			} else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonpie").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerpie").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
                                    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
                                                   for(var j=0;j&amp;lt;data_all.length;j++){
                                                       chartName  = data_all[j].name
						       drawPieChart(data_all, i + "_pie", chartName)
						   }

                                    }
                                }
			}
		});
	});
	jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;d5873d92-b78b-42fc-9407-46d166204b88&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;/* css for timepicker */
.ui-timepicker-div .ui-widget-header { 
margin-bottom: 8px;
 }

.ui-timepicker-div dl { text-align: left; }
.ui-timepicker-div dl dt { height: 25px; margin-bottom: -25px; }
.ui-timepicker-div dl dd { margin: 0 10px 10px 65px; }
.ui-timepicker-div td { font-size: 90%; }
.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }

.ui-timepicker-rtl{ direction: rtl; }
.ui-timepicker-rtl dl { text-align: right; }
.ui-timepicker-rtl dl dd { margin: 0 65px 10px 10px; }
#ui-datepicker-div{
 position:relative;
 width:auto;
 height:auto
}
&lt;/code&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;datetimepicker -css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;1201fb1a-e9c1-4731-8c74-2ea8c0071959&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;.displayblock {
  border:2px solid;
  -webkit-border-radius:6px;
  background:gray;
  float: left;
  width:100%;
}

.displaypie {
  border:1px solid;
  -webkit-border-radius:6px;
  background:gray;
  width: 48%;
  float: left; 
  height: 300px;
}

.subtype {
  margin-top: 50px;
  font-size: 2em;
  color: red;
}&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;content&gt;{{include document="Lib.DataToDrawChart"/}}
{{include document="Lib.MongoDBConnection"/}}
{{velocity}}
$xwiki.jsx.use('Lib.JQueryUILib')
$xwiki.ssx.use('Lib.MenuGenerator')
$xwiki.jsx.use('Lib.MenuGenerator')
$xwiki.ssx.use('Lib.JQueryUILib')
$xwiki.jsx.use('Lib.JqGridLib')
$xwiki.ssx.use('Lib.JqGridLib') 
{{/velocity}}
{{include document="Lib.MenuGenerator"/}}
{{html wiki="true" clean="false"}}
&amp;lt;div id="viewer"&amp;gt;
&amp;lt;table style="text-align:left"  &amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th &amp;gt;Job name&amp;lt;/th&amp;gt;
  &amp;lt;td colspan=3&amp;gt;&amp;lt;div id="jobname"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
{{groovy}}
import org.xwiki.context.*

def ec = services.component.getInstance(Execution.class).getContext()
def mapJobIstIid = ec.getProperty("mapJobIstIid")

println '{{html clean="false" wiki="false"}}'
println '&amp;lt;tr&amp;gt;'
println '&amp;lt;th&amp;gt;IstIid&amp;lt;/th&amp;gt;'
println '&amp;lt;td colspan=3&amp;gt;'
mapJobIstIid.each{jobEntry-&amp;gt;
  def convertedJobKey = jobEntry.key.replaceAll("\\.","_")
  println "&amp;lt;div id='listIstIid'&amp;gt;"
  println "&amp;lt;div id=IstIid${convertedJobKey} style='display:none'&amp;gt;"
  println "&amp;lt;select id=select_${convertedJobKey}&amp;gt;"
  jobEntry.value.each{
     println "&amp;lt;option value=\"$it\"&amp;gt;$it&amp;lt;/option&amp;gt;"
  }
  println "&amp;lt;/select&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
}
println '&amp;lt;/td&amp;gt;'
println '&amp;lt;/tr&amp;gt;'
println '{{/html}}'
{{/groovy}}
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data monitor from&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="from-date" id="from-date"/&amp;gt;&amp;lt;/td&amp;gt;
  &amp;lt;th&amp;gt;Data monitor to&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="to-date" id="to-date"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data records limit &amp;lt;/th&amp;gt;
  &amp;lt;td &amp;gt;
     &amp;lt;select id="limit"&amp;gt;
       &amp;lt;option value=5&amp;gt;5&amp;lt;/option&amp;gt;
       &amp;lt;option value=10&amp;gt;10&amp;lt;/option&amp;gt;
       &amp;lt;option value=15&amp;gt;15&amp;lt;/option&amp;gt;
       &amp;lt;option value=20&amp;gt;20&amp;lt;/option&amp;gt;
     &amp;lt;/select&amp;gt;
  &amp;lt;/td&amp;gt;
  &amp;lt;td colspan=3 &amp;gt;&amp;lt;input type="button" value="View Data" id="get-data" class="button"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;&amp;lt;div id="display"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
  &amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
&amp;lt;/table&amp;gt;

&amp;lt;/div&amp;gt; 
   
 &amp;lt;/body&amp;gt;

{{/html}}
{{groovy}}
import groovy.json.*
xwiki.jsx.use("Lib.Highcharts")

if(request.xpage == "plain") {
	response.setContentType('text/plain')
}

def listData = []
def job = request.get("job")
def fromDate = request.get("fromDate")
def toDate = request.get("toDate")
def limit= (request.get("limit")!=null)?request.get("limit").toInteger():10
def istIid = request.get("IstIid")

def str= "No data to retrieved !"
def result = null
if(job != "" &amp;amp;&amp;amp; job != null &amp;amp;&amp;amp; istIid != null &amp;amp;&amp;amp; istIid != ""){
	MongoDBConnection.getConnection()
	if(fromDate != "" || toDate != ""){
		result = MongoDBConnection.getDataInPeriod(job,fromDate,toDate,limit,istIid)
	} else {
		result = MongoDBConnection.getDataAllFields(job,limit,istIid)
        }
MongoDBConnection.closeConnection()
} else {
   println "{{warning}}There are no selected job or IstIid{{/warning}}"
}
def listKey = []
if( (result != null) &amp;amp;&amp;amp; (result.size() &amp;gt; 0) &amp;amp;&amp;amp; (result[0].KEYEXPR != null)&amp;amp;&amp;amp;!(result[0].KEYEXPR instanceof List )){

if(result[0].type == "Subtyped") {
    println '{{html clean="false" wiki="true"}}'
    //println '&amp;lt;body&amp;gt;'
    def dataSubtype = DataToDrawChart.getDataToDrawSubtype(result)
    dataSubtype.each {key,value -&amp;gt;
        listKey.add(key)
    }
    def jsonkey = com.mongodb.util.JSON.serialize(listKey)
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$jsonkey&amp;lt;/textarea&amp;gt;"

    dataSubtype.each {key,value -&amp;gt;
            def dataLine = []
            def dataBar = []
            def dataPie = []
            def dataArea = []
            if(DataToDrawChart.getDataToDrawLine(value) != []) {
                dataLine = DataToDrawChart.getDataToDrawLine(value)
            }
            if(DataToDrawChart.getDataToDrawBar(value) != []) {
                dataBar = DataToDrawChart.getDataToDrawBar(value)
            }
            if(DataToDrawChart.getDataToDrawPie(value) != []) {
                dataPie = DataToDrawChart.getDataToDrawPie(value)
            }
            if(DataToDrawChart.getDataToDrawArea(value) != []) {
                dataArea = DataToDrawChart.getDataToDrawArea(value)
            }

		def chartColumnsLine = []
		def chartColumnsBar = []
		def chartColumnsArea = []
		def lstName

                dataLine.each {itemDataLine -&amp;gt;
                    if(itemDataLine.size() &amp;gt; 0 ){
		        chartColumnsLine.add(itemDataLine[0].chart_columns)
	            }
                }
                dataBar.each {itemDataBar -&amp;gt;
                    if(itemDataBar.size() &amp;gt; 0 ){
		        chartColumnsBar.add(itemDataBar[0].chart_columns)
	            }
                }
                dataArea.each {itemDataArea -&amp;gt;
                    if(itemDataArea.size() &amp;gt; 0 ){
		        chartColumnsArea.add(itemDataArea[0].chart_columns)
	            }
                }

		if(dataPie.size() &amp;gt; 0 ){
			lstName = dataPie['name']
		}
		def tmpListNameContainer = []
                
		if(lstName != null) {
                        def chartNumPie = 0
                        def tmpLst
                        for(def nameContainer in lstName){
                           tmpLst = []
			   for(def nameContainerItem in nameContainer ){
				nameContainerItem = chartNumPie + "_" + nameContainerItem.replaceAll("\\.", "_")
				tmpLst.add(nameContainerItem )
		            }
                            tmpListNameContainer.add(tmpLst)
                            chartNumPie++
                         }
		}
		def jsonPie
		def jsonLine
		def jsonBar
		def jsonArea
		if(dataPie != []) {
		    jsonPie = com.mongodb.util.JSON.serialize(dataPie)
		}
		if(dataLine != []) {
		    jsonLine = com.mongodb.util.JSON.serialize(dataLine)
		}
		if(dataBar != []) {
		    jsonBar = com.mongodb.util.JSON.serialize(dataBar)
		}
		if(dataArea != []) {
		    jsonArea = com.mongodb.util.JSON.serialize(dataArea)
		}
		def jsonContainerPie
		if(tmpListNameContainer != []) {
			jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
		}
		def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
		def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
		def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

		println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
		if(jsonLine != null) {
			println "&amp;lt;textarea id=\"jsonline_$key\" &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class=\"lstcontainerline_$key\" &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
		}
		if(jsonBar != null) {
			println "&amp;lt;textarea id=\"jsonbar_$key\"&amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerbar_$key' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
		}
		if(jsonPie != null &amp;amp;&amp;amp; jsonContainerPie != null) {
			println "&amp;lt;textarea id=\"jsonpie_$key\" &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerpie_$key' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
		}
		if(jsonArea != null) {
			println "&amp;lt;textarea id=\"jsonarea_$key\" &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerarea_$key' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
		}

        println "&amp;lt;/div&amp;gt;"
        def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
        def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
          
        println "&amp;lt;div style='clear:both'&amp;gt;"
            def description = value.KEYEXPR._description[0][key]
            if(description != null) {
                println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +': ' + description +'&amp;lt;/div&amp;gt;'
            } else {
                println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +'&amp;lt;/div&amp;gt;'
            }
            println "-----"
            if(jsonPie != null) {
          println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
	  chartNumPie = 0
          lstName.each{chartPieLst -&amp;gt;
		chartPieLst.each {
	            def tmp = chartNumPie + "_" + it.replaceAll("\\.", "_")
println "container${key}_${tmp}"
		   // println " &amp;lt;div class=\"displaypie\" id=\"container${key}_${tmp}\" &amp;gt;&amp;lt;/div&amp;gt;"
          	}
		chartNumPie++
	  }	
          println "&amp;lt;/div&amp;gt;"
            }
            if(jsonLine != null) {
          	def chartLineComment = false
		def chartNumLine = 0
          	chartColumnsLine.each{chartColumnsLineItem -&amp;gt;
            		if(!chartLineComment){
               			println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
               			chartLineComment = true  
            		}
		chartColumnsLineItem.each{
              		println " &amp;lt;div class=\"displayblock\" id=\"containerline${key}_${chartNumLine}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          	}
		chartNumLine ++
	    }
          println "&amp;lt;/div&amp;gt;"
            }
            println "&amp;amp;nbsp;"

            if(jsonBar != null) {
          	def chartBarComment = false
  		def chartNumBar = 0
          	chartColumnsBar.each{chartColumnsBarItem -&amp;gt;
             		if(!chartBarComment){
                		println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
                		chartBarComment = true
              		}  
			chartColumnsBarItem.each{
             			println " &amp;lt;div class=\"displayblock\" id=\"containerbar${key}_${chartNumBar}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          		}
			chartNumBar++
		}
          	println "&amp;lt;/div&amp;gt;"
            }
            println "&amp;amp;nbsp;"

            if(jsonArea != null) {
          	def chartAreaComment = false
		def chartNumArea = 0
          	chartColumnsArea.each{chartColumnsAreaItem -&amp;gt;
          		if(!chartAreaComment){
            			println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
            			chartAreaComment = true
          		}
			chartColumnsAreaItem.each{
            			println " &amp;lt;div class=\"displayblock\" id=\"containerarea${key}_${chartNumArea}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          		}
          		chartNumArea++
            	}
        	println "&amp;lt;/div&amp;gt;"
	    }
        /** Statistic data table **/
        println "&amp;lt;center&amp;gt;"        
        println "&amp;lt;div id='livetblContent_"+key+"' style='width:100%;clear:both;align:middle;margin-top:10px'&amp;gt;"   
        println "Statistics data for "+key
        println "&amp;lt;table id='livetableList_"+key+"' style='width:100%;align:center'&amp;gt;&amp;lt;/table&amp;gt;"
        println "&amp;lt;div id='livetablePager_"+key+"' style='position:relative;width:100%'&amp;gt;&amp;lt;/div&amp;gt;"
        println "&amp;lt;/div&amp;gt;"
        println "&amp;lt;/center&amp;gt;"
        println "&amp;lt;script language='javascript'&amp;gt;console.log('Create live table for "+key+"');&amp;lt;/script&amp;gt;"
    }
    //println '&amp;lt;/body&amp;gt;'
    println '{{/html}}'
} else if(result[0].type == "Store") {
	// data store
	def dataLine = DataToDrawChart.getDataToDrawLine(result)
	def dataBar = DataToDrawChart.getDataToDrawBar(result)
	def dataPie = DataToDrawChart.getDataToDrawPie(result)
	def dataArea = DataToDrawChart.getDataToDrawArea(result)
	def chartColumnsLine = []
	def chartColumnsBar = []
	def chartColumnsArea = []
	def lstName

        dataLine.each {itemDataLine -&amp;gt;
            if(itemDataLine.size() &amp;gt; 0 ){
		chartColumnsLine.add(itemDataLine[0].chart_columns)
	    }
        }

        dataBar.each {itemDataBar -&amp;gt;
            if(itemDataBar.size() &amp;gt; 0 ){
		chartColumnsBar.add(itemDataBar[0].chart_columns)
	    }
        }

        dataArea.each {itemDataArea -&amp;gt;
            if(itemDataArea.size() &amp;gt; 0 ){
		chartColumnsArea.add(itemDataArea[0].chart_columns)
	    }
        }

	if(dataPie.size() &amp;gt; 0 ){
		lstName = dataPie['name']
	}

    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
  
    def tmpListNameContainer = []
    def chartNumPie = 0
    for(def nameContainer in lstName){
       for(def nameContainerItem in nameContainer ){
           nameContainerItem = chartNumPie + "_" + nameContainerItem.replaceAll("\\.", "_")
           tmpListNameContainer .add(nameContainerItem )
       }
    }
    
    def jsonPie = com.mongodb.util.JSON.serialize(dataPie)
    def jsonLine = com.mongodb.util.JSON.serialize(dataLine)
    def jsonBar = com.mongodb.util.JSON.serialize(dataBar)
    def jsonArea = com.mongodb.util.JSON.serialize(dataArea)

    def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
    def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
    def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
    def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

    def listEmpty = com.mongodb.util.JSON.serialize([])
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$listEmpty&amp;lt;/textarea&amp;gt;" 

    println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
    println "&amp;lt;textarea class='jsonline' &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonbar' &amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonpie' &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonarea' &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"

    println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;/div&amp;gt;"

    def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
    def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
  
    println "&amp;lt;div style='clear:both'&amp;gt;"
  
    def chartPieComment = false
    chartNumPie = 0
    lstName.each{chartPieLst-&amp;gt;
        if(!chartPieComment) {
            println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
            chartPieComment = true
        }
        chartPieLst.each {
            def tmp = chartNumPie + "_pie"
            println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
        }
    }
    println "&amp;lt;/div&amp;gt;"
    	def chartLineComment = false
	def chartNum = 0
    	chartColumnsLine.each{chartColumnsLineItem -&amp;gt;
	    	if(!chartLineComment){
	        	println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	        	chartLineComment = true  
	    	}
		chartColumnsLineItem.each{
	    		println " &amp;lt;div class=\"displayblock\" id=\"containerline${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	    	}
		chartNum++
	}	
    	println "&amp;lt;/div&amp;gt;"
    	println "&amp;amp;nbsp;"
    	def chartBarComment = false
	chartNum = 0
    	chartColumnsBar.each{chartColumnsBarItem -&amp;gt;
	        if(!chartBarComment){
	            println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	            chartBarComment = true
	        }  
		chartColumnsBarItem.each{
	    		println " &amp;lt;div class=\"displayblock\" id=\"containerbar${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  	}
		chartNum++
	}
  println "&amp;lt;/div&amp;gt;"
  println "&amp;amp;nbsp;"
  	def chartAreaComment = false
	chartNum = 0
  	chartColumnsArea.each{chartColumnsAreaItem -&amp;gt;
	  	if(!chartAreaComment){
	    		println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	    		chartAreaComment = true
	  	}
		chartColumnsAreaItem.each{
    			println " &amp;lt;div class=\"displayblock\" id=\"containerarea${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
		}
		chartNum++
  	}
  println "&amp;lt;/div&amp;gt;"
println "&amp;lt;/div&amp;gt;"

//println '&amp;lt;/body&amp;gt;'
println '{{/html}}'
}
}else{
    println 'There is no data for this job with criterias'
}
//--=============== Start build for livetable
def subTypeURLMap = [:]
def dataModel = []
def dataUrl = ""
result.find{rec-&amp;gt;				
    def subtractData = []
    
    //-- Parsing data and assign data to subtract list
    if(rec.type == "Store"){ //-- Store data type
        subtractData = rec['data']        
        subtractData.each{r2-&amp;gt;					
            if(dataModel != null &amp;amp;&amp;amp; dataModel.size() &amp;lt;=0){ 
                dataModel.add("Fetch At")
                dataModel.addAll(r2.keySet());					
            } 
        }        
        dataUrl = "/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job="+job +"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate + "&amp;amp;toDate=" + toDate + "&amp;amp;istIid="+istIid        
        //-- Building data model				
        def model = []
        def colSpec
        dataModel.each{name-&amp;gt;
            colSpec = [:]
            colSpec['name'] = name
            colSpec['index'] = name
            colSpec['width'] = "100"
            model.add(colSpec)
        }
        def dataModelStr = (new JsonBuilder(dataModel)).toPrettyString()
        def modelStr = (new JsonBuilder(model)).toPrettyString() 
        str = 
        "{\"url\":\""+dataUrl+"\",\"datatype\":\"json\","+
            "\"colNames\":"+ dataModelStr +
            ",\"colModel\":"+ modelStr +" ,\"rowList\":[10,20,30],"+
            "\"pager\":\"#livetablePager\", \"viewrecords\": true, \"sortname\": \"RECORD_SEQ\","+
            "\"sortorder\": \"asc\", \"caption\":\""+job+"\"}"
        println "{{html clean=\"false\" wiki=\"true\"}}"
        println "&amp;lt;div id='livetableJson' style = \"display:none\"&amp;gt;"
        //println "&amp;lt;div id='livetableJson'&amp;gt;"
        println str;
        println "&amp;lt;/div&amp;gt;"
        println "{{/html}}"
    }else{ //-- Subtype			
        def subData = rec['data']
        subData.each{key,value-&amp;gt;
            dataUrl = "/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job="+job +"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate + "&amp;amp;toDate=" + toDate + "&amp;amp;istIid="+istIid+"&amp;amp;subType="+key
            subtractData = value
            subtractData.each{r2-&amp;gt;					
                if(dataModel != null &amp;amp;&amp;amp; dataModel.size() &amp;lt;=0){ 
                    dataModel.add("Fetch At")
                    dataModel.addAll(r2.keySet());					
                } 			
            }
            //-- Building data model				
            def model = []
            def colSpec
            dataModel.each{name-&amp;gt;
                colSpec = [:]
                colSpec['name'] = name
                colSpec['index'] = name
                colSpec['width'] = "100"
                model.add(colSpec)
            }
            def dataModelStr = (new JsonBuilder(dataModel)).toPrettyString()
            def modelStr = (new JsonBuilder(model)).toPrettyString() 
            str = 
            "{\"url\":\""+dataUrl+"\",\"datatype\":\"json\","+
                "\"colNames\":"+ dataModelStr +
                ",\"colModel\":"+ modelStr +" ,\"rowList\":[10,20,30],"+
                "\"pager\":\"#livetablePager\", \"viewrecords\": true, \"sortname\": \"RECORD_SEQ\","+
                "\"sortorder\": \"asc\", \"caption\":\""+job+"\"}"
            subTypeURLMap[key] = str
        }
        def finalStr = (new JsonBuilder(subTypeURLMap)).toPrettyString()
        println "{{html clean=\"false\" wiki=\"true\"}}"
        println "&amp;lt;div id='livetableJson' style = \"display:none\"&amp;gt;"
        //println "&amp;lt;div id='livetableJson'&amp;gt;"
        println finalStr;
        println "&amp;lt;/div&amp;gt;"
        println "{{/html}}"
    }
    return true
}
 //--=============== END

if(listKey.size() &amp;lt;= 0){   
    println "{{html clean=\"false\" wiki=\"true\"}}"
    println "&amp;lt;center&amp;gt;"
    println "&amp;lt;div id=\"livetblContent\" style=\"width:100%;clear:both;align:middle;margin-top:10px\"&amp;gt;"   
    println "Statistics Data"
    println "&amp;lt;table id=\"livetableList\" style=\"width:100%;align:center\"&amp;gt;&amp;lt;/table&amp;gt;"    
    println "&amp;lt;div id=\"livetablePager\"&amp;gt;&amp;lt;/div&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
    println "&amp;lt;/center&amp;gt;"
    
    println "&amp;lt;div id=\"testDiv\"&amp;gt;&amp;amp;nbsp;&amp;lt;/div&amp;gt;"
    println "{{/html}}"
}
{{/groovy}}
&lt;/content&gt;&lt;/xwikidoc&gt;@


61.37
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376560723000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376560723000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.37&lt;/version&gt;
a3374 1
println "tmpListNameContainer" + tmpListNameContainer
a3417 2
          println "jsonPie" + jsonPie
          println "jsonContainerPie " + jsonContainerPie 
d3431 1
a3431 1
		chartNumPie = 0
d3434 2
a3435 2
println "container${key}_${it}"
	            //def tmp = chartNumPie + "_" + it.replaceAll("\\.", "_")
@


61.36
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376560642000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376560642000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.36&lt;/version&gt;
a3367 1
                                println "nameContainerItem :" + nameContainerItem 
a3368 1
                                //nameContainerItem = nameContainerItem.replaceAll("\\.", "_")
d3375 1
@


61.35
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376558761000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376558092000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.35&lt;/version&gt;
d3356 1
a3356 1
println "dataPie" + dataPie
d3438 1
a3438 1
println "container${key}_${tmp}"
@


61.34
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376558689000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;61.34&lt;/version&gt;
a2939 1
console.log(data_all)
@


61.33
log
@@
text
@&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xwikidoc&gt;
&lt;web&gt;WiperDog&lt;/web&gt;
&lt;name&gt;WebHome&lt;/name&gt;
&lt;language&gt;&lt;/language&gt;
&lt;defaultLanguage&gt;en&lt;/defaultLanguage&gt;
&lt;translation&gt;0&lt;/translation&gt;
&lt;parent&gt;&lt;/parent&gt;
&lt;creator&gt;XWiki.Admin&lt;/creator&gt;
&lt;author&gt;XWiki.Admin&lt;/author&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;contentAuthor&gt;XWiki.Admin&lt;/contentAuthor&gt;
&lt;creationDate&gt;1376364375000&lt;/creationDate&gt;
&lt;date&gt;1376558680000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376558092000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.33&lt;/version&gt;
&lt;title&gt;WiperDog&lt;/title&gt;
&lt;defaultTemplate&gt;&lt;/defaultTemplate&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;comment&gt;&lt;/comment&gt;
&lt;minorEdit&gt;true&lt;/minorEdit&gt;
&lt;syntaxId&gt;xwiki/2.1&lt;/syntaxId&gt;
&lt;hidden&gt;false&lt;/hidden&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;047293a8-524d-45e4-af52-cd944523d5d0&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
/*
 * jQuery timepicker addon
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 1.3.1
 * Last Modified: 07/07/2013
 *
 * Copyright 2013 Trent Richardson
 * You may use this project under MIT or GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 */

/*jslint evil: true, white: false, undef: false, nomen: false */

(function($) {

	/*
	* Lets not redefine timepicker, Prevent "Uncaught RangeError: Maximum call stack size exceeded"
	*/
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return;
	}

	/*
	* Extend jQueryUI, get it started with our version number
	*/
	$.extend($.ui, {
		timepicker: {
			version: "1.3.1"
		}
	});

	/* 
	* Timepicker manager.
	* Use the singleton instance of this class, $.timepicker, to interact with the time picker.
	* Settings for (groups of) time pickers are maintained in an instance object,
	* allowing multiple different settings on the same page.
	*/
	var Timepicker = function() {
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[''] = { // Default regional settings
			currentText: 'Now',
			closeText: 'Done',
			amNames: ['AM', 'A'],
			pmNames: ['PM', 'P'],
			timeFormat: 'HH:mm',
			timeSuffix: '',
			timeOnlyTitle: 'Choose Time',
			timeText: 'Time',
			hourText: 'Hour',
			minuteText: 'Minute',
			secondText: 'Second',
			millisecText: 'Millisecond',
			microsecText: 'Microsecond',
			timezoneText: 'Time Zone',
			isRTL: false
		};
		this._defaults = { // Global defaults for all the datetime picker instances
			showButtonPanel: true,
			timeOnly: false,
			showHour: null,
			showMinute: null,
			showSecond: null,
			showMillisec: null,
			showMicrosec: null,
			showTimezone: null,
			showTime: true,
			stepHour: 1,
			stepMinute: 1,
			stepSecond: 1,
			stepMillisec: 1,
			stepMicrosec: 1,
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null,
			hourMin: 0,
			minuteMin: 0,
			secondMin: 0,
			millisecMin: 0,
			microsecMin: 0,
			hourMax: 23,
			minuteMax: 59,
			secondMax: 59,
			millisecMax: 999,
			microsecMax: 999,
			minDateTime: null,
			maxDateTime: null,
			onSelect: null,
			hourGrid: 0,
			minuteGrid: 0,
			secondGrid: 0,
			millisecGrid: 0,
			microsecGrid: 0,
			alwaysSetTime: true,
			separator: ' ',
			altFieldTimeOnly: true,
			altTimeFormat: null,
			altSeparator: null,
			altTimeSuffix: null,
			pickerTimeFormat: null,
			pickerTimeSuffix: null,
			showTimepicker: true,
			timezoneList: null,
			addSliderAccess: false,
			sliderAccessArgs: null,
			controlType: 'slider',
			defaultValue: null,
			parse: 'strict'
		};
		$.extend(this._defaults, this.regional['']);
	};

	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: '',
		formattedDate: '',
		formattedTime: '',
		formattedDateTime: '',
		timezoneList: null,
		units: ['hour','minute','second','millisec', 'microsec'],
		support: {},
		control: null,

		/* 
		* Override the default settings for all instances of the time picker.
		* @@param  settings  object - the new settings to use as defaults (anonymous object)
		* @@return the manager object
		*/
		setDefaults: function(settings) {
			extendRemove(this._defaults, settings || {});
			return this;
		},

		/*
		* Create a new Timepicker instance
		*/
		_newInst: function($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
            	fns = {},
		    	overrides, i;

			for (var attrName in this._defaults) {
				if(this._defaults.hasOwnProperty(attrName)){
					var attrValue = $input.attr('time:' + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue);
						} catch (err) {
							inlineSettings[attrName] = attrValue;
						}
					}
				}
			}

		    overrides = {
		        beforeShow: function (input, dp_inst) {
		            if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
		                return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst);
		            }
		        },
		        onChangeMonthYear: function (year, month, dp_inst) {
		            // Update the time as well : this prevents the time from disappearing from the $input field.
		            tp_inst._updateDateTime(dp_inst);
		            if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
		                tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst);
		            }
		        },
		        onClose: function (dateText, dp_inst) {
		            if (tp_inst.timeDefined === true &amp;amp;&amp;amp; $input.val() !== '') {
		                tp_inst._updateDateTime(dp_inst);
		            }
		            if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
		                tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst);
		            }
		        }
		    };
		    for (i in overrides) {
		        if (overrides.hasOwnProperty(i)) {
		            fns[i] = opts[i] || null;
		        }
		    }

		    tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
		        evnts:fns,
		        timepicker: tp_inst // add timepicker as a property of datepicker: $.datepicker._get(dp_inst, 'timepicker');
		    });
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function(val) {
				return val.toUpperCase();
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function(val) {
				return val.toUpperCase();
			});

			// detect which units are supported
			tp_inst.support = detectSupport(
					tp_inst._defaults.timeFormat + 
					(tp_inst._defaults.pickerTimeFormat? tp_inst._defaults.pickerTimeFormat:'') + 
					(tp_inst._defaults.altTimeFormat? tp_inst._defaults.altTimeFormat:''));

			// controlType is string - key to our this._controls
			if(typeof(tp_inst._defaults.controlType) === 'string'){
				if(tp_inst._defaults.controlType == 'slider' &amp;amp;&amp;amp; typeof(jQuery.ui.slider) === 'undefined'){
					tp_inst._defaults.controlType = 'select';
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType];
			}
			// controlType is an object and must implement create, options, value methods
			else{ 
				tp_inst.control = tp_inst._defaults.controlType;
			}

			// prep the timezone options
			var timezoneList = [-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,
					0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList;
			}
			var tzl=timezoneList.length,tzi=0,tzv=null;
			if (tzl &amp;gt; 0 &amp;amp;&amp;amp; typeof timezoneList[0] !== 'object') {
				for(; tzi&amp;lt;tzl; tzi++){
					tzv = timezoneList[tzi];
					timezoneList[tzi] = { value: tzv, label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601) };
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;

			// set the default units
			tp_inst.timezone = tp_inst._defaults.timezone !== null? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) : 
							((new Date()).getTimezoneOffset()*-1);
			tp_inst.hour = tp_inst._defaults.hour &amp;lt; tp_inst._defaults.hourMin? tp_inst._defaults.hourMin : 
							tp_inst._defaults.hour &amp;gt; tp_inst._defaults.hourMax? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute &amp;lt; tp_inst._defaults.minuteMin? tp_inst._defaults.minuteMin : 
							tp_inst._defaults.minute &amp;gt; tp_inst._defaults.minuteMax? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second &amp;lt; tp_inst._defaults.secondMin? tp_inst._defaults.secondMin : 
							tp_inst._defaults.second &amp;gt; tp_inst._defaults.secondMax? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec &amp;lt; tp_inst._defaults.millisecMin? tp_inst._defaults.millisecMin : 
							tp_inst._defaults.millisec &amp;gt; tp_inst._defaults.millisecMax? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec &amp;lt; tp_inst._defaults.microsecMin? tp_inst._defaults.microsecMin : 
							tp_inst._defaults.microsec &amp;gt; tp_inst._defaults.microsecMax? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = '';
			tp_inst.$input = $input;

			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField).css({
					cursor: 'pointer'
				}).focus(function() {
					$input.trigger("focus");
				});
			}

			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date();
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date();
			}

			// datepicker needs minDate/maxDate, timepicker needs minDateTime/maxDateTime..
			if (tp_inst._defaults.minDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime());
			}
			if (tp_inst._defaults.minDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime());
			}
			if (tp_inst._defaults.maxDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime());
			}
			if (tp_inst._defaults.maxDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime());
			}
			tp_inst.$input.bind('focus', function() {
				tp_inst._onFocus();
			});

			return tp_inst;
		},

		/*
		* add our sliders to the calendar
		*/
		_addTimePicker: function(dp_inst) {
			var currDT = (this.$altInput &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly) ? this.$input.val() + ' ' + this.$altInput.val() : this.$input.val();

			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
		},

		/*
		* parse the time string from input value or _setTime
		*/
		_parseTime: function(timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0]);
			}

			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, 'dateFormat');
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false;
					}
					$.extend(this, parseRes.timeObj);
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err +
									"\ndate/time string = " + timeString +
									"\ntimeFormat = " + this._defaults.timeFormat +
									"\ndateFormat = " + dp_dateFormat);
					return false;
				}
				return true;
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false;
				}
				$.extend(this, timeObj);
				return true;
			}
		},

		/*
		* generate and inject html for timepicker into ui datepicker
		*/
		_injectTimePicker: function() {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = '',
				uitem = '',
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i=0,
				l=0;

			// Prevent displaying twice
			if ($dp.find("div.ui-timepicker-div").length === 0 &amp;amp;&amp;amp; o.showTimepicker) {
				var noDisplay = ' style="display:none;"',
					html = '&amp;lt;div class="ui-timepicker-div'+ (o.isRTL? ' ui-timepicker-rtl' : '') +'"&amp;gt;&amp;lt;dl&amp;gt;' + '&amp;lt;dt class="ui_tpicker_time_label"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;' + o.timeText + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_time"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the markup
				for(i=0,l=this.units.length; i&amp;lt;l; i++){
					litem = this.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// Added by Peter Medeiros:
					// - Figure out what the hour/minute/second max should be based on the step values.
					// - Example: if stepMinute is 15, then minMax is 45.
					max[litem] = parseInt((o[litem+'Max'] - ((o[litem+'Max'] - o[litem+'Min']) % o['step'+uitem])), 10);
					gridSize[litem] = 0;

					html += '&amp;lt;dt class="ui_tpicker_'+ litem +'_label"' + (show ? '' : noDisplay) + '&amp;gt;' + o[litem +'Text'] + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_'+ litem +'"&amp;gt;&amp;lt;div class="ui_tpicker_'+ litem +'_slider"' + (show ? '' : noDisplay) + '&amp;gt;&amp;lt;/div&amp;gt;';

					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						html += '&amp;lt;div style="padding-left: 1px"&amp;gt;&amp;lt;table class="ui-tpicker-grid-label"&amp;gt;&amp;lt;tr&amp;gt;';

						if(litem == 'hour'){
							for (var h = o[litem+'Min']; h &amp;lt;= max[litem]; h += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm? 'hht':'HH', {hour:h}, o);									
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + tmph + '&amp;lt;/td&amp;gt;';
							}
						}
						else{
							for (var m = o[litem+'Min']; m &amp;lt;= max[litem]; m += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + ((m &amp;lt; 10) ? '0' : '') + m + '&amp;lt;/td&amp;gt;';
							}
						}

						html += '&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;&amp;lt;/div&amp;gt;';
					}
					html += '&amp;lt;/dd&amp;gt;';
				}
				
				// Timezone
				var showTz = o.showTimezone !== null? o.showTimezone : this.support.timezone;
				html += '&amp;lt;dt class="ui_tpicker_timezone_label"' + (showTz ? '' : noDisplay) + '&amp;gt;' + o.timezoneText + '&amp;lt;/dt&amp;gt;';
				html += '&amp;lt;dd class="ui_tpicker_timezone" ' + (showTz ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the elements from string
				html += '&amp;lt;/dl&amp;gt;&amp;lt;/div&amp;gt;';
				var $tp = $(html);

				// if we only want time picker...
				if (o.timeOnly === true) {
					$tp.prepend('&amp;lt;div class="ui-widget-header ui-helper-clearfix ui-corner-all"&amp;gt;' + '&amp;lt;div class="ui-datepicker-title"&amp;gt;' + o.timeOnlyTitle + '&amp;lt;/div&amp;gt;' + '&amp;lt;/div&amp;gt;');
					$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();
				}
				
				// add sliders, adjust grids, add events
				for(i=0,l=tp_inst.units.length; i&amp;lt;l; i++){
					litem = tp_inst.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// add the slider
					tp_inst[litem+'_slider'] = tp_inst.control.create(tp_inst, $tp.find('.ui_tpicker_'+litem+'_slider'), litem, tp_inst[litem], o[litem+'Min'], max[litem], o['step'+uitem]);

					// adjust the grid and add click event
					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						size = 100 * gridSize[litem] * o[litem+'Grid'] / (max[litem] - o[litem+'Min']);
						$tp.find('.ui_tpicker_'+litem+' table').css({
							width: size + "%",
							marginLeft: o.isRTL? '0' : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL? ((size / (-2 * gridSize[litem])) + "%") : '0',
							borderCollapse: 'collapse'
						}).find("td").click(function(e){
								var $t = $(this),
									h = $t.html(),
									n = parseInt(h.replace(/[^0-9]/g),10),
									ap = h.replace(/[^apm]/ig),
									f = $t.data('for'); // loses scope, so we use data-for

								if(f == 'hour'){
									if(ap.indexOf('p') !== -1 &amp;amp;&amp;amp; n &amp;lt; 12){
										n += 12;
									}
									else{
										if(ap.indexOf('a') !== -1 &amp;amp;&amp;amp; n === 12){
											n = 0;
										}
									}
								}
								
								tp_inst.control.value(tp_inst, tp_inst[f+'_slider'], litem, n);

								tp_inst._onTimeChange();
								tp_inst._onSelectHandler();
							}).css({
								cursor: 'pointer',
								width: (100 / gridSize[litem]) + '%',
								textAlign: 'center',
								overflow: 'hidden'
							});
					} // end if grid &amp;gt; 0
				} // end for loop

				// Add timezone options
				this.timezone_select = $tp.find('.ui_tpicker_timezone').append('&amp;lt;select&amp;gt;&amp;lt;/select&amp;gt;').find("select");
				$.fn.append.apply(this.timezone_select,
				$.map(o.timezoneList, function(val, idx) {
					return $("&amp;lt;option /&amp;gt;").val(typeof val == "object" ? val.value : val).text(typeof val == "object" ? val.label : val);
				}));
				if (typeof(this.timezone) != "undefined" &amp;amp;&amp;amp; this.timezone !== null &amp;amp;&amp;amp; this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset()*-1;
					if (local_timezone == this.timezone) {
						selectLocalTimezone(tp_inst);
					} else {
						this.timezone_select.val(this.timezone);
					}
				} else {
					if (typeof(this.hour) != "undefined" &amp;amp;&amp;amp; this.hour !== null &amp;amp;&amp;amp; this.hour !== "") {
						this.timezone_select.val(o.timezone);
					} else {
						selectLocalTimezone(tp_inst);
					}
				}
				this.timezone_select.change(function() {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
				});
				// End timezone options
				
				// inject timepicker into datepicker
				var $buttonPanel = $dp.find('.ui-datepicker-buttonpane');
				if ($buttonPanel.length) {
					$buttonPanel.before($tp);
				} else {
					$dp.append($tp);
				}

				this.$timeObj = $tp.find('.ui_tpicker_time');

				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined;
				}

				// slideAccess integration: http://trentrichardson.com/2011/11/11/jquery-ui-sliders-and-touch-accessibility/
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
						
					setTimeout(function() { // fix for inline mode
						if ($tp.find('.ui-slider-access').length === 0) {
							$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);

							// fix any grids since sliders are shorter
							var sliderAccessWidth = $tp.find('.ui-slider-access:eq(0)').outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find('table:visible').each(function() {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl? 'marginRight':'marginLeft').toString().replace('%', ''),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + '%',
										css = { width: newWidth, marginRight: 0, marginLeft: 0 };
									css[rtl? 'marginRight':'marginLeft'] = newMarginLeft;
									$g.css(css);
								});
							}
						}
					}, 10);
				}
				// end slideAccess integration

				tp_inst._limitMinMaxDateTime(this.inst, true);
			}
		},

		/*
		* This function tries to limit the ability to go outside the
		* min/max date range
		*/
		_limitMinMaxDateTime: function(dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);

			if (!this._defaults.showTimepicker) {
				return;
			} // No time so nothing to check here

			if ($.datepicker._get(dp_inst, 'minDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'minDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, 'minDateTime'),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin;
				}

				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour &amp;lt;= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute &amp;lt;= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second &amp;lt;= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if(this.millisec &amp;lt;= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;lt; this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin;
									}
									this._defaults.microsecMin = this.microsecMinOriginal;
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal;
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal;
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal;
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal;
				}
			}

			if ($.datepicker._get(dp_inst, 'maxDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'maxDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, 'maxDateTime'),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax;
				}

				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour &amp;gt;= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute &amp;gt;= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second &amp;gt;= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec &amp;gt;= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;gt; this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax;
									}
									this._defaults.microsecMax = this.microsecMaxOriginal;
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal;
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal;
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal;
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal;
				}
			}

			if (adjustSliders !== undefined &amp;amp;&amp;amp; adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10);
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);

				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, 'hour', { min: this._defaults.hourMin, max: hourMax });
					this.control.value(this, this.hour_slider, 'hour', this.hour - (this.hour % this._defaults.stepHour));
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, 'minute', { min: this._defaults.minuteMin, max: minMax });
					this.control.value(this, this.minute_slider, 'minute', this.minute - (this.minute % this._defaults.stepMinute));
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, 'second', { min: this._defaults.secondMin, max: secMax });
					this.control.value(this, this.second_slider, 'second', this.second - (this.second % this._defaults.stepSecond));
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, 'millisec', { min: this._defaults.millisecMin, max: millisecMax });
					this.control.value(this, this.millisec_slider, 'millisec', this.millisec - (this.millisec % this._defaults.stepMillisec));
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, 'microsec', { min: this._defaults.microsecMin, max: microsecMax });
					this.control.value(this, this.microsec_slider, 'microsec', this.microsec - (this.microsec % this._defaults.stepMicrosec));
				}
			}

		},

		/*
		* when a slider moves, set the internal time...
		* on time change is also called when the time is updated in the text field
		*/
		_onTimeChange: function() {
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, 'hour') : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, 'minute') : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, 'second') : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, 'millisec') : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, 'microsec') : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;

			if (typeof(hour) == 'object') {
				hour = false;
			}
			if (typeof(minute) == 'object') {
				minute = false;
			}
			if (typeof(second) == 'object') {
				second = false;
			}
			if (typeof(millisec) == 'object') {
				millisec = false;
			}
			if (typeof(microsec) == 'object') {
				microsec = false;
			}
			if (typeof(timezone) == 'object') {
				timezone = false;
			}

			if (hour !== false) {
				hour = parseInt(hour, 10);
			}
			if (minute !== false) {
				minute = parseInt(minute, 10);
			}
			if (second !== false) {
				second = parseInt(second, 10);
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10);
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10);
			}

			var ampm = o[hour &amp;lt; 12 ? 'amNames' : 'pmNames'][0];

			// If the update was done in the input field, the input field should not be updated.
			// If the update was done using the sliders, update the input field.
			var hasChanged = (hour != this.hour || minute != this.minute || second != this.second || millisec != this.millisec || microsec != this.microsec 
								|| (this.ampm.length &amp;gt; 0 &amp;amp;&amp;amp; (hour &amp;lt; 12) != ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) 
								|| (this.timezone !== null &amp;amp;&amp;amp; timezone != this.timezone));

			if (hasChanged) {

				if (hour !== false) {
					this.hour = hour;
				}
				if (minute !== false) {
					this.minute = minute;
				}
				if (second !== false) {
					this.second = second;
				}
				if (millisec !== false) {
					this.millisec = millisec;
				}
				if (microsec !== false) {
					this.microsec = microsec;
				}
				if (timezone !== false) {
					this.timezone = timezone;
				}

				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0]);
				}

				this._limitMinMaxDateTime(this.inst, true);
			}
			if (this.support.ampm) {
				this.ampm = ampm;
			}

			// Updates the time within the timepicker
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if(pickerTimeFormat === o.timeFormat){
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix);
				}
				else{
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix);
				}
			}

			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime();
			}
		},

		/*
		* call custom onSelect.
		* bind to sliders slidestop, and grid click.
		*/
		_onSelectHandler: function() {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect &amp;amp;&amp;amp; inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this]);
			}
		},

		/*
		* update our input with the new date time..
		*/
		_updateDateTime: function(dp_inst) {
			dp_inst = this.inst || dp_inst;
			//var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
			var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay)),
				dateFmt = $.datepicker._get(dp_inst, 'dateFormat'),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null &amp;amp;&amp;amp; this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			
			// if a slider was changed but datepicker doesn't have a value yet, set it
			if(dp_inst.lastVal===""){
                dp_inst.currentYear=dp_inst.selectedYear;
                dp_inst.currentMonth=dp_inst.selectedMonth;
                dp_inst.currentDay=dp_inst.selectedDay;
            }

			/*
			* remove following lines to force every changes in date picker to change the input value
			* Bug descriptions: when an input field has a default value, and click on the field to pop up the date picker. 
			* If the user manually empty the value in the input field, the date picker will never change selected value.
			*/
			//if (dp_inst.lastVal !== undefined &amp;amp;&amp;amp; (dp_inst.lastVal.length &amp;gt; 0 &amp;amp;&amp;amp; this.$input.val().length === 0)) {
			//	return;
			//}

			if (this._defaults.timeOnly === true) {
				formattedDateTime = this.formattedTime;
			} else if (this._defaults.timeOnly !== true &amp;amp;&amp;amp; (this._defaults.alwaysSetTime || timeAvailable)) {
				formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix;
			}

			this.formattedDateTime = formattedDateTime;

			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate);
			} else if (this.$altInput &amp;amp;&amp;amp; this._defaults.timeOnly === false &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly === true) {
				this.$altInput.val(this.formattedTime);
				this.$input.val(this.formattedDate);
			} else if (this.$altInput) {
				this.$input.val(formattedDateTime);
				var altFormattedDateTime = '',
					altSeparator = this._defaults.altSeparator ? this._defaults.altSeparator : this._defaults.separator,
					altTimeSuffix = this._defaults.altTimeSuffix ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
				
				if(!this._defaults.timeOnly){
					if (this._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg);
					}
					else{
						altFormattedDateTime = this.formattedDate;
					}

					if (altFormattedDateTime){
						altFormattedDateTime += altSeparator;
					}
				}

				if(this._defaults.altTimeFormat){
					altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix;
				}
				else{
					altFormattedDateTime += this.formattedTime + altTimeSuffix;
				}
				this.$altInput.val(altFormattedDateTime);
			} else {
				this.$input.val(formattedDateTime);
			}

			this.$input.trigger("change");
		},

		_onFocus: function() {
			if (!this.$input.val() &amp;amp;&amp;amp; this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, 'timepicker');
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst);
						} catch (err) {
							$.timepicker.log(err);
						}
					}
				}
			}
		},

		/*
		* Small abstraction to control types
		* We can add more, just be sure to follow the pattern: create, options, value
		*/
		_controls: {
			// slider methods
			slider: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var rtl = tp_inst._defaults.isRTL; // if rtl go -60-&amp;gt;0 instead of 0-&amp;gt;60
					return obj.prop('slide', null).slider({
						orientation: "horizontal",
						value: rtl? val*-1 : val,
						min: rtl? max*-1 : min,
						max: rtl? min*-1 : max,
						step: step,
						slide: function(event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl? ui.value*-1:ui.value);
							tp_inst._onTimeChange();
						},
						stop: function(event, ui) {
							tp_inst._onSelectHandler();
						}
					});	
				},
				options: function(tp_inst, obj, unit, opts, val){
					if(tp_inst._defaults.isRTL){
						if(typeof(opts) == 'string'){
							if(opts == 'min' || opts == 'max'){
								if(val !== undefined){
									return obj.slider(opts, val*-1);
								}
								return Math.abs(obj.slider(opts));
							}
							return obj.slider(opts);
						}
						var min = opts.min, 
							max = opts.max;
						opts.min = opts.max = null;
						if(min !== undefined){
							opts.max = min * -1;
						}
						if(max !== undefined){
							opts.min = max * -1;
						}
						return obj.slider(opts);
					}
					if(typeof(opts) == 'string' &amp;amp;&amp;amp; val !== undefined){
							return obj.slider(opts, val);
					}
					return obj.slider(opts);
				},
				value: function(tp_inst, obj, unit, val){
					if(tp_inst._defaults.isRTL){
						if(val !== undefined){
							return obj.slider('value', val*-1);
						}
						return Math.abs(obj.slider('value'));
					}
					if(val !== undefined){
						return obj.slider('value', val);
					}
					return obj.slider('value');
				}
			},
			// select methods
			select: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var sel = '&amp;lt;select class="ui-timepicker-select" data-unit="'+ unit +'" data-min="'+ min +'" data-max="'+ max +'" data-step="'+ step +'"&amp;gt;',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;

					for(var i=min; i&amp;lt;=max; i+=step){						
						sel += '&amp;lt;option value="'+ i +'"'+ (i==val? ' selected':'') +'&amp;gt;';
						if(unit == 'hour'){
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig,'')), {hour:i}, tp_inst._defaults);
						}
						else if(unit == 'millisec' || unit == 'microsec' || i &amp;gt;= 10){ sel += i; }
						else {sel += '0'+ i.toString(); }
						sel += '&amp;lt;/option&amp;gt;';
					}
					sel += '&amp;lt;/select&amp;gt;';

					obj.children('select').remove();

					$(sel).appendTo(obj).change(function(e){
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
					});

					return obj;
				},
				options: function(tp_inst, obj, unit, opts, val){
					var o = {},
						$t = obj.children('select');
					if(typeof(opts) == 'string'){
						if(val === undefined){
							return $t.data(opts);
						}
						o[opts] = val;	
					}
					else{ o = opts; }
					return tp_inst.control.create(tp_inst, obj, $t.data('unit'), $t.val(), o.min || $t.data('min'), o.max || $t.data('max'), o.step || $t.data('step'));
				},
				value: function(tp_inst, obj, unit, val){
					var $t = obj.children('select');
					if(val !== undefined){
						return $t.val(val);
					}
					return $t.val();
				}
			}
		} // end _controls

	});

	$.fn.extend({
		/*
		* shorthand just to use timepicker..
		*/
		timepicker: function(o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);

			if (typeof o == 'object') {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				});
			}

			return $(this).each(function() {
				$.fn.datetimepicker.apply($(this), tmp_args);
			});
		},

		/*
		* extend timepicker to datepicker
		*/
		datetimepicker: function(o) {
			o = o || {};
			var tmp_args = arguments;

			if (typeof(o) == 'string') {
				if (o == 'getDate') {
					return $.fn.datepicker.apply($(this[0]), tmp_args);
				} else {
					return this.each(function() {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args);
					});
				}
			} else {
				return this.each(function() {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults);
				});
			}
		}
	});

	/*
	* Public Utility to parse date and time
	*/
	$.datepicker.parseDateTime = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec);
		}

		return parseRes.date;
	};

	/*
	* Public utility to parse time
	*/
	$.datepicker.parseTime = function(timeFormat, timeString, options) {		
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g,'').indexOf('Z') !== -1);

		// Strict parse requires the timeString to match the timeFormat exactly
		var strictParse = function(f, s, o){

			// pattern for standard and localized AM/PM markers
			var getPatternAmpm = function(amNames, pmNames) {
				var markers = [];
				if (amNames) {
					$.merge(markers, amNames);
				}
				if (pmNames) {
					$.merge(markers, pmNames);
				}
				markers = $.map(markers, function(val) {
					return val.replace(/[.*+?|()\[\]{}\\]/g, '\\$&amp;amp;');
				});
				return '(' + markers.join('|') + ')?';
			};

			// figure out position of time elements.. cause js cant do named captures
			var getFormatPositions = function(timeFormat) {
				var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
					orders = {
						h: -1,
						m: -1,
						s: -1,
						l: -1,
						c: -1,
						t: -1,
						z: -1
					};

				if (finds) {
					for (var i = 0; i &amp;lt; finds.length; i++) {
						if (orders[finds[i].toString().charAt(0)] == -1) {
							orders[finds[i].toString().charAt(0)] = i + 1;
						}
					}
				}
				return orders;
			};

			var regstr = '^' + f.toString()
					.replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
							var ml = match.length;
							switch (match.charAt(0).toLowerCase()) {
								case 'h': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'm': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 's': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'l': return '(\\d?\\d?\\d)';
								case 'c': return '(\\d?\\d?\\d)';
								case 'z': return '(z|[-+]\\d\\d:?\\d\\d|\\S+)?';
								case 't': return getPatternAmpm(o.amNames, o.pmNames);
								default:    // literal escaped in quotes
									return '(' + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function (m) { return "\\" + m; }) + ')?';
							}
						})
					.replace(/\s/g, '\\s?') +
					o.timeSuffix + '$',
				order = getFormatPositions(f),
				ampm = '',
				treg;

			treg = s.match(new RegExp(regstr, 'i'));

			var resTime = {
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0
			};

			if (treg) {
				if (order.t !== -1) {
					if (treg[order.t] === undefined || treg[order.t].length === 0) {
						ampm = '';
						resTime.ampm = '';
					} else {
						ampm = $.inArray(treg[order.t].toUpperCase(), o.amNames) !== -1 ? 'AM' : 'PM';
						resTime.ampm = o[ampm == 'AM' ? 'amNames' : 'pmNames'][0];
					}
				}

				if (order.h !== -1) {
					if (ampm == 'AM' &amp;amp;&amp;amp; treg[order.h] == '12') {
						resTime.hour = 0; // 12am = 0 hour
					} else {
						if (ampm == 'PM' &amp;amp;&amp;amp; treg[order.h] != '12') {
							resTime.hour = parseInt(treg[order.h], 10) + 12; // 12pm = 12 hour, any other pm = hour + 12
						} else {
							resTime.hour = Number(treg[order.h]);
						}
					}
				}

				if (order.m !== -1) {
					resTime.minute = Number(treg[order.m]);
				}
				if (order.s !== -1) {
					resTime.second = Number(treg[order.s]);
				}
				if (order.l !== -1) {
					resTime.millisec = Number(treg[order.l]);
				}
				if (order.c !== -1) {
					resTime.microsec = Number(treg[order.c]);
				}
				if (order.z !== -1 &amp;amp;&amp;amp; treg[order.z] !== undefined) {
					resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z]);
				}


				return resTime;
			}
			return false;
		};// end strictParse

		// First try JS Date, if that fails, use strictParse
		var looseParse = function(f,s,o){
			try{
				var d = new Date('2012-01-01 '+ s);
				if(isNaN(d.getTime())){
					d = new Date('2012-01-01T'+ s);
					if(isNaN(d.getTime())){
						d = new Date('01/01/2012 '+ s);
						if(isNaN(d.getTime())){
							throw "Unable to parse time with native Date: "+ s;
						}
					}
				}

				return {
					hour: d.getHours(),
					minute: d.getMinutes(),
					second: d.getSeconds(),
					millisec: d.getMilliseconds(),
					microsec: d.getMicroseconds(),
					timezone: d.getTimezoneOffset()*-1
				};
			}
			catch(err){
				try{
					return strictParse(f,s,o);
				}
				catch(err2){
					$.timepicker.log("Unable to parse \ntimeString: "+ s +"\ntimeFormat: "+ f);
				}				
			}
			return false;
		}; // end looseParse
		
		if(typeof o.parse === "function"){
			return o.parse(timeFormat, timeString, o);
		}
		if(o.parse === 'loose'){
			return looseParse(timeFormat, timeString, o);
		}
		return strictParse(timeFormat, timeString, o);
	};

	/*
	* Public utility to format the time
	* format = string format of the time
	* time = a {}, not a Date() for timezones
	* options = essentially the regional[].. amNames, pmNames, ampm
	*/
	$.datepicker.formatTime = function(format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			timezone: 0
		}, time);

		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);

		if (hour &amp;gt; 11) {
			ampmName = options.pmNames[0];
		}

		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|('.*?'|".*?"))/g, function(match) {
		switch (match) {
			case 'HH':
				return ('0' + hour).slice(-2);
			case 'H':
				return hour;
			case 'hh':
				return ('0' + convert24to12(hour)).slice(-2);
			case 'h':
				return convert24to12(hour);
			case 'mm':
				return ('0' + time.minute).slice(-2);
			case 'm':
				return time.minute;
			case 'ss':
				return ('0' + time.second).slice(-2);
			case 's':
				return time.second;
			case 'l':
				return ('00' + time.millisec).slice(-3);
			case 'c':
				return ('00' + time.microsec).slice(-3);
			case 'z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, false);
			case 'Z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, true);
			case 'T': 
				return ampmName.charAt(0).toUpperCase();
			case 'TT': 
				return ampmName.toUpperCase();
			case 't':
				return ampmName.charAt(0).toLowerCase();
			case 'tt':
				return ampmName.toLowerCase();
			default:
				return match.replace(/\'/g, "") || "'";
			}
		});

		tmptime = $.trim(tmptime);
		return tmptime;
	};

	/*
	* the bad hack :/ override datepicker so it doesnt close on select
	// inspired: http://stackoverflow.com/questions/1252512/jquery-datepicker-prevent-closing-picker-when-clicking-a-date/1762378#1762378
	*/
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function(id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			tp_inst._limitMinMaxDateTime(inst, true);
			inst.inline = inst.stay_open = true;
			//This way the onSelect handler called from calendarpicker get the full dateTime
			this._base_selectDate(id, dateStr);
			inst.inline = inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst);
		} else {
			this._base_selectDate(id, dateStr);
		}
	};

	/*
	* second bad hack :/ override datepicker so it triggers an event when changing the input field
	* and does not redraw the datepicker on every selectDate event
	*/
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function(inst) {

		// don't popup the datepicker if there is another instance already opened
		var input = inst.input[0];
		if ($.datepicker._curInst &amp;amp;&amp;amp; $.datepicker._curInst != inst &amp;amp;&amp;amp; $.datepicker._datepickerShowing &amp;amp;&amp;amp; $.datepicker._lastInput != input) {
			return;
		}

		if (typeof(inst.stay_open) !== 'boolean' || inst.stay_open === false) {

			this._base_updateDatepicker(inst);

			// Reload the time control when changing something in the input text field.
			var tp_inst = this._get(inst, 'timepicker');
			if (tp_inst) {
				tp_inst._addTimePicker(inst);
			}
		}
	};

	/*
	* third bad hack :/ override datepicker so it allows spaces and colon in the input field
	*/
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if ($.datepicker._get(inst, 'constrainInput')) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null? tp_inst._defaults.showTimezone : tp_inst.support.timezone,					
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat')),
					datetimeChars = tp_inst._defaults.timeFormat.toString()
											.replace(/[hms]/g, '')
											.replace(/TT/g, ampm ? 'APM' : '')
											.replace(/Tt/g, ampm ? 'AaPpMm' : '')
											.replace(/tT/g, ampm ? 'AaPpMm' : '')
											.replace(/T/g, ampm ? 'AP' : '')
											.replace(/tt/g, ampm ? 'apm' : '')
											.replace(/t/g, ampm ? 'ap' : '') + 
											" " + tp_inst._defaults.separator + 
											tp_inst._defaults.timeSuffix + 
											(tz ? tp_inst._defaults.timezoneList.join('') : '') + 
											(tp_inst._defaults.amNames.join('')) + (tp_inst._defaults.pmNames.join('')) + 
											dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr &amp;lt; ' ' || !dateChars || datetimeChars.indexOf(chr) &amp;gt; -1);
			}
		}

		return $.datepicker._base_doKeyPress(event);
	};

	/*
	* Fourth bad hack :/ override _updateAlternate function used in inline mode to init altField
	*/
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	/* Update any alternate field to synchronise with the main field. */
	$.datepicker._updateAlternate = function(inst) {
		var tp_inst = this._get(inst, 'timepicker');
		if(tp_inst){
			var altField = tp_inst._defaults.altField;
			if (altField) { // update alternate field too
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = '', 
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator, 
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if(!tp_inst._defaults.timeOnly &amp;amp;&amp;amp; !tp_inst._defaults.altFieldTimeOnly &amp;amp;&amp;amp; date !== null){
					if(tp_inst._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime;
					}
					else{
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime;
					}
				}
				$(altField).val(altFormattedDateTime);
			}
		}
		else{
			$.datepicker._base_updateAlternate(inst);
		}
	};

	/*
	* Override key up event to sync manual input changes.
	*/
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst);
				} catch (err) {
					$.timepicker.log(err);
				}
			}
		}

		return $.datepicker._base_doKeyUp(event);
	};

	/*
	* override "Today" button to also grab the time.
	*/
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function(id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		this._base_gotoToday(id);
		var tp_inst = this._get(inst, 'timepicker');
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		$('.ui-datepicker-today', $dp).click();
	};

	/*
	* Disable &amp;amp; enable the Time in the datetimepicker
	*/
	$.datepicker._disableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst);
		}
	};

	$.datepicker._enableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst); // Could be disabled on page load
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create our own set time function
	*/
	$.datepicker._setTime = function(inst, date) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var defaults = tp_inst._defaults;

			// calling _setTime with no date sets time to defaults
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;

			//check if within min/max times.. 
			tp_inst._limitMinMaxDateTime(inst, true);

			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create new public method to set only time, callable as $().datepicker('setTime', date)
	*/
	$.datepicker._setTimeDatepicker = function(target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date == "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec);
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds());
				}
				if (tp_date.toString() == 'Invalid Date') {
					tp_date = undefined;
				}
				this._setTime(inst, tp_date);
			}
		}

	};

	/*
	* override setDate() to allow setting time too within Date object
	*/
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function(target, date) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		if(typeof(date) === 'string'){
			date = new Date(date);
			if(!date.getTime()){
				$.timepicker.log("Error creating Date object from string.");
			}
		}

		var tp_inst = this._get(inst, 'timepicker');
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds());
		} else {
			tp_date = date;
		}
		
		// This is important if you are using the timezone option, javascript's Date 
		// object will only return the timezone offset for the current locale, so we 
		// adjust it accordingly.  If not using timezone option this won't matter..
		// If a timezone is different in tp, keep the timezone as is
		if(tp_inst){
			// look out for DST if tz wasn't specified
			if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
				tp_inst.timezone = tp_date.getTimezoneOffset()*-1;
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone);
		}

		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true);
	};

	/*
	* override getDate() to allow getting time too within Date object
	*/
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function(target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			// if it hasn't yet been defined, grab from field
			if(inst.lastVal === undefined){
				this._setDateFromField(inst, noDefault);
			}

			var date = this._getDate(inst);
			if (date &amp;amp;&amp;amp; tp_inst._parseTime($(target).val(), tp_inst.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);

				// This is important if you are using the timezone option, javascript's Date 
				// object will only return the timezone offset for the current locale, so we 
				// adjust it accordingly.  If not using timezone option this won't matter..
				if(tp_inst.timezone != null){
					// look out for DST if tz wasn't specified
					if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
						tp_inst.timezone = date.getTimezoneOffset()*-1;
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
				}
			}
			return date;
		}
		return this._base_getDateDatepicker(target, noDefault);
	};

	/*
	* override parseDate() because UI 1.8.14 throws an error about "Extra characters"
	* An option in datapicker to ignore extra format characters would be nicer.
	*/
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function(format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings);
		} catch (err) {
			// Hack!  The error message ends with a colon, a space, and
			// the "extra" characters.  We rely on that instead of
			// attempting to perfectly reproduce the parsing algorithm.
			if (err.indexOf(":") &amp;gt;= 0) {
				date = this._base_parseDate(format, value.substring(0,value.length-(err.length-err.indexOf(':')-2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format);
			} else {
				throw err;
			}
		}
		return date;
	};

	/*
	* override formatDate to set date with time to the input
	*/
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function(inst, day, month, year) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val();
		}
		return this._base_formatDate(inst);
	};

	/*
	* override options setter to add time to maxDate(Time) and minDate(Time). MaxDate
	*/
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function(target, name, value) {
		var inst = this._getInst(target),
	        name_clone;
		if (!inst) {
			return null;
		}

		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop;
		    if (typeof name == 'string') { // if min/max was set with the string
		        if (name === 'minDate' || name === 'minDateTime') {
		            min = value;
		        } else if (name === 'maxDate' || name === 'maxDateTime') {
		            max = value;
		        } else if (name === 'onSelect') {
		            onselect = value;
		        } else if (overrides.hasOwnProperty(name)) {
		            if (typeof (value) === 'undefined') {
		                return overrides[name];
		            }
		            fns[name] = value;
		            name_clone = {}; //empty results in exiting function after overrides updated
		        }
		    } else if (typeof name == 'object') { //if min/max was set with the JSON
		        if (name.minDate) {
		            min = name.minDate;
		        } else if (name.minDateTime) {
		            min = name.minDateTime;
		        } else if (name.maxDate) {
		            max = name.maxDate;
		        } else if (name.maxDateTime) {
		            max = name.maxDateTime;
		        }
		        for (prop in overrides) {
		            if (overrides.hasOwnProperty(prop) &amp;amp;&amp;amp; name[prop]) {
		                fns[prop] = name[prop];
		            }
		        }
		    }
		    for (prop in fns) {
		        if (fns.hasOwnProperty(prop)) {
		            overrides[prop] = fns[prop];
		            if (!name_clone) { name_clone = $.extend({}, name);}
		            delete name_clone[prop];
		        }
		    }
		    if (name_clone &amp;amp;&amp;amp; isEmptyObject(name_clone)) { return; }
		    if (min) { //if min was set
		        if (min === 0) {
		            min = new Date();
		        } else {
		            min = new Date(min);
		        }
		        tp_inst._defaults.minDate = min;
		        tp_inst._defaults.minDateTime = min;
		    } else if (max) { //if max was set
		        if (max === 0) {
		            max = new Date();
		        } else {
		            max = new Date(max);
		        }
		        tp_inst._defaults.maxDate = max;
		        tp_inst._defaults.maxDateTime = max;
		    } else if (onselect) {
		        tp_inst._defaults.onSelect = onselect;
		    }
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name);
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
	};
	
	/*
	* jQuery isEmptyObject does not check hasOwnProperty - if someone has added to the object prototype,
	* it will return false for all objects
	*/
	var isEmptyObject = function(obj) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(obj)) {
				return false;
			}
		}
		return true;
	};

	/*
	* jQuery extend now ignores nulls!
	*/
	var extendRemove = function(target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] === null || props[name] === undefined) {
				target[name] = props[name];
			}
		}
		return target;
	};

	/*
	* Determine by the time format which units are supported
	* Returns an object of booleans for each unit
	*/
	var detectSupport = function(timeFormat){
		var tf = timeFormat.replace(/\'.*?\'/g,'').toLowerCase(), // removes literals
			isIn = function(f, t){ // does the format contain the token?
					return f.indexOf(t) !== -1? true:false; 
				};
		return {
				hour: isIn(tf,'h'),
				minute: isIn(tf,'m'),
				second: isIn(tf,'s'),
				millisec: isIn(tf,'l'),
				microsec: isIn(tf,'c'),
				timezone: isIn(tf,'z'),
				ampm: isIn(tf,'t') &amp;amp;&amp;amp; isIn(timeFormat,'h'),
				iso8601: isIn(timeFormat, 'Z')
			};
	};

	/*
	* Converts 24 hour format into 12 hour
	* Returns 12 hour without leading 0
	*/
	var convert24to12 = function(hour) {
		if (hour &amp;gt; 12) {
			hour = hour - 12;
		}

		if (hour === 0) {
			hour = 12;
		}

		return String(hour);
	};

	/*
	* Splits datetime string into date ans time substrings.
	* Throws exception when date can't be parsed
	* Returns [dateString, timeString]
	*/
	var splitDateTime = function(dateFormat, dateTimeString, dateSettings, timeSettings) {
		try {
			// The idea is to get the number separator occurances in datetime and the time format requested (since time has 
			// fewer unknowns, mostly numbers and am/pm). We will use the time pattern to split.
			var separator = timeSettings &amp;amp;&amp;amp; timeSettings.separator ? timeSettings.separator : $.timepicker._defaults.separator,
				format = timeSettings &amp;amp;&amp;amp; timeSettings.timeFormat ? timeSettings.timeFormat : $.timepicker._defaults.timeFormat,
				timeParts = format.split(separator), // how many occurances of separator may be in our format?
				timePartsLen = timeParts.length,
				allParts = dateTimeString.split(separator),
				allPartsLen = allParts.length;

			if (allPartsLen &amp;gt; 1) {
				return [
						allParts.splice(0,allPartsLen-timePartsLen).join(separator),
						allParts.splice(0,timePartsLen).join(separator)
					];
			}

		} catch (err) {
			$.timepicker.log('Could not split the date from the time. Please check the following datetimepicker options' +
					"\nthrown error: " + err +
					"\ndateTimeString" + dateTimeString +
					"\ndateFormat = " + dateFormat +
					"\nseparator = " + timeSettings.separator +
					"\ntimeFormat = " + timeSettings.timeFormat);

			if (err.indexOf(":") &amp;gt;= 0) {
				// Hack!  The error message ends with a colon, a space, and
				// the "extra" characters.  We rely on that instead of
				// attempting to perfectly reproduce the parsing algorithm.
				var dateStringLength = dateTimeString.length - (err.length - err.indexOf(':') - 2),
					timeString = dateTimeString.substring(dateStringLength);

				return [$.trim(dateTimeString.substring(0, dateStringLength)), $.trim(dateTimeString.substring(dateStringLength))];

			} else {
				throw err;
			}
		}
		return [dateTimeString, ''];
	};

	/*
	* Internal function to parse datetime interval
	* Returns: {date: Date, timeObj: Object}, where
	*   date - parsed date without time (type Date)
	*   timeObj = {hour: , minute: , second: , millisec: , microsec: } - parsed time. Optional
	*/
	var parseDateTimeInternal = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var date;
		var splitRes = splitDateTime(dateFormat, dateTimeString, dateSettings, timeSettings);
		date = $.datepicker._base_parseDate(dateFormat, splitRes[0], dateSettings);
		if (splitRes[1] !== '') {
			var timeString = splitRes[1],
				parsedTime = $.datepicker.parseTime(timeFormat, timeString, timeSettings);

			if (parsedTime === null) {
				throw 'Wrong time format';
			}
			return {
				date: date,
				timeObj: parsedTime
			};
		} else {
			return {
				date: date
			};
		}
	};

	/*
	* Internal function to set timezone_select to the local timezone
	*/
	var selectLocalTimezone = function(tp_inst, date) {
		if (tp_inst &amp;amp;&amp;amp; tp_inst.timezone_select) {
			var now = typeof date !== 'undefined' ? date : new Date();
			tp_inst.timezone_select.val(now.getTimezoneOffset()*-1);
		}
	};

	/*
	* Create a Singleton Insance
	*/
	$.timepicker = new Timepicker();

	/**
	 * Get the timezone offset as string from a date object (eg '+0530' for UTC+5.5)
	 * @@param  number if not a number this value is returned
	 * @@param boolean if true formats in accordance to iso8601 "+12:45"
	 * @@return string
	 */
	$.timepicker.timezoneOffsetString = function(tzMinutes, iso8601) {
		if(isNaN(tzMinutes) || tzMinutes &amp;gt; 840){
			return tzMinutes;
		}

		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601? ':':'',
			tz = (off &amp;gt;= 0 ? '+' : '-') + ('0' + (hours * 101).toString()).slice(-2) + iso + ('0' + (minutes * 101).toString()).slice(-2);
		
		if(tz == '+00:00'){
			return 'Z';
		}
		return tz;
	};

	/**
	 * Get the number in minutes that represents a timezone string
	 * @@param  string formated like "+0500", "-1245"
	 * @@return number
	 */
	$.timepicker.timezoneOffsetNumber = function(tzString) {
		tzString = tzString.toString().replace(':',''); // excuse any iso8601, end up with "+1245"

		if(tzString.toUpperCase() === 'Z'){ // if iso8601 with Z, its 0 minute offset
			return 0;
		}

		if(!/^(\-|\+)\d{4}$/.test(tzString)){ // possibly a user defined tz, so just give it back
			return tzString;
		}

		return ((tzString.substr(0,1) =='-'? -1 : 1) * // plus or minus
					((parseInt(tzString.substr(1,2),10)*60) + // hours (converted to minutes)
					parseInt(tzString.substr(3,2),10))); // minutes
	};

	/**
	 * No way to set timezone in js Date, so we must adjust the minutes to compensate. (think setDate, getDate)
	 * @@param  date
	 * @@param  string formated like "+0500", "-1245"
	 * @@return date
	 */
	$.timepicker.timezoneAdjust = function(date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if(!isNaN(toTz)){
			date.setMinutes(date.getMinutes()*1 + (date.getTimezoneOffset()*-1 - toTz*1) );
		}
		return date;
	};

	/**
	 * Calls `timepicker()` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * n.b. The input value must be correctly formatted (reformatting is not supported)
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the timepicker() call
	 * @@return jQuery
	 */
	$.timepicker.timeRange = function(startTime, endTime, options) {
		return $.timepicker.handleRange('timepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datetimepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@return jQuery
	 */
	$.timepicker.datetimeRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datetimepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.dateRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.handleRange = function(method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0, // min allowed interval in milliseconds
			maxInterval: 0, // max allowed interval in milliseconds
			start: {},      // options for start picker
			end: {}         // options for end picker
		}, options);

		$.fn[method].call(startTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), endTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), endTime, 'minDate');
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), startTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), startTime, 'maxDate');
			}
		}, options, options.end));

		checkDates(startTime, endTime);
		selected(startTime, endTime, 'minDate');
		selected(endTime, startTime, 'maxDate');

		function checkDates(changed, other) {
			var startdt = startTime[method]('getDate'),
				enddt = endTime[method]('getDate'),
				changeddt = changed[method]('getDate');

			if(startdt !== null){
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());

				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);

				if(options.minInterval &amp;gt; 0 &amp;amp;&amp;amp; minDate &amp;gt; enddt){ // minInterval check
					endTime[method]('setDate',minDate);
				}
				else if(options.maxInterval &amp;gt; 0 &amp;amp;&amp;amp; maxDate &amp;lt; enddt){ // max interval check
					endTime[method]('setDate',maxDate);
				}
				else if (startdt &amp;gt; enddt) {
					other[method]('setDate',changeddt);
				}
			}
		}

		function selected(changed, other, option) {
			if (!changed.val()) {
				return;
			}
			var date = changed[method].call(changed, 'getDate');
			if(date !== null &amp;amp;&amp;amp; options.minInterval &amp;gt; 0){
				if(option == 'minDate'){
					date.setMilliseconds(date.getMilliseconds() + options.minInterval); 
				}
				if(option == 'maxDate'){
					date.setMilliseconds(date.getMilliseconds() - options.minInterval);
				}
			}
			if (date.getTime) {
				other[method].call(other, 'option', option, date);
			}
		}
		return $([startTime.get(0), endTime.get(0)]);
	};

	/**
	 * Log error or data to the console during error or debugging
	 * @@param  Object err pass any type object to log to the console during error or debugging
	 * @@return void
	 */
	$.timepicker.log = function(err){
		if(window.console){
			console.log(err);
		}
	};

	/*
	* Microsecond support
	*/
	if(!Date.prototype.getMicroseconds){
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function(){ return this.microseconds; };
		Date.prototype.setMicroseconds = function(m){ 
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m/1000));
			this.microseconds = m%1000;
			return this;
		};
	}

	/*
	* Keep up with the version
	*/
	$.timepicker.version = "1.3.1";

})(jQuery);
jQuery.noConflict();
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;datetimepicker-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;e73a652e-09fc-4c71-8e7a-e2525a2d2a99&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
function replaceAllString(oriStr, strTarget, strSubString ){
   var strText = oriStr;
   var intIndexOfMatch = strText.indexOf( strTarget );
   while (intIndexOfMatch != -1){
      strText = strText.replace( strTarget, strSubString )
      intIndexOfMatch = strText.indexOf( strTarget );
   }
   return( strText );
}
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&amp;amp;]" + name + "=([^&amp;amp;#]*)"),
    results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
};


   var jobName= getParameterByName('job')
   var fromDate= getParameterByName('fromDate')
   var toDate= getParameterByName('toDate')
   var limit= getParameterByName('limit')
   var selectedIstIid = getParameterByName('IstIid')

  $("#jobname").ready(function(){
   $("#jobname").text(jobName)
   var convertedJobName = replaceAllString(jobName, ".", "_")
   $("#IstIid" + convertedJobName).ready(function(){
     $("#IstIid" + convertedJobName).css("display","block")
     $("#select_" + convertedJobName).ready(function(){
        $("#select_" + convertedJobName).val(selectedIstIid)
     });
   });
 });

  $("#fromDate").ready(function(){
   $("#from-date").val(fromDate)
 });

  $("#toDate").ready(function(){
   $("#to-date").val(toDate)
 });

  $("#limit").ready(function(){
   if(limit!=""){
    $("#limit").val(limit)
   }
 });
 // Get data with ajax
 function ajax_getData(jobName,fromDate,toDate,limit ){
       var convertedJobName = replaceAllString(jobName, ".", "_")
       var istIid = $("#select_" + convertedJobName).val()
       window.location="/xwiki/bin/view/WiperDog/WebHome?job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid="+istIid;
 			/*$.ajax({
			 type: "GET",
			 url:"/xwiki/bin/get/Sandbox/DescriptionForJob?outputSyntax=plain&amp;amp;job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid"+selectedIstIid,
			 success : function(result){
				$("#jobname").html(jobName)
				$("#display").text('[[]]' + result)
			 }
		   });*/
 }
	$("#treemenu2 a").click(function(){
		 var limit = 10
		 var fromDate=""
		 var toDate = ""
		 jobName= $(this).text()
                 $("#jobname").html(jobName)
                 var convertedJobName = replaceAllString(jobName, ".", "_")
                 $("#listIstIid &amp;gt; div").css("display","none")
                 $("#IstIid" + convertedJobName).css("display","block")
		 //ajax_getData(jobName,fromDate,toDate,limit )

	});

	$("#from-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
		dateFormat: 'yy-mm-dd',
	});
	$("#to-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
			dateFormat: 'yy-mm-dd',

	});
	 $("#get-data").on("click",function(){
		var fromDate = $("#from-date").val()
		var toDate =  $("#to-date").val()
		 if( toDate!= "" ){
			  if(fromDate != ""){
				  if($("#from-date").datepicker( "getDate" ) &amp;gt; $("#to-date").datepicker( "getDate" )){
				  alert("'From date' cannot start later than 'To date'")
				  return false
				  }
			  }
		 }
		 limit = $("#limit").val()
		 ajax_getData(jobName,fromDate,toDate,limit )
	});
$(document).ready(function(){
  var keys = $("#lstkey").text()
  //console.log('key == ' + keys);
  //console.log('livetableJson ==' + $("#livetableJson").text());
  
  var jsonObj = $.parseJSON($("#livetableJson").text()); 
  if(keys &amp;amp;&amp;amp; keys != '[ ]'){
    /** Subtyped **/    
    var newKeys = keys.replace('[',"");
    keys = newKeys.replace(']',"");
    var keyArr = (keys.indexOf(',') != -1)? keys.split(','):new Array(keys);
    //console.log('Key after replace: '+keys)       
    for(var i=0;i&amp;lt;keyArr.length;i++){
        var keyName = keyArr[i].trim().replace('',"").replace("\"","").replace('\"','');
        var subTypeJsonObjStr = jsonObj[keyName].replace('#livetablePager','#livetablePager_'+keyName)
        var subTypeJsonObj = $.parseJSON(subTypeJsonObjStr);
        $("#livetableList_"+keyName).jqGrid(subTypeJsonObj);
        $("#livetableList_"+keyName).jqGrid('navGrid', "#livetablePager_"+keyName, {
           edit : false,
           add : false,
           del : false,
           search:false
         });
    }
    
  }else{ /** Store**/        
      $("#livetableList").jqGrid(jsonObj);
      $("#livetableList").jqGrid('navGrid', "#livetablePager", {
           edit : false,
           add : false,
           del : false,
           search:false
           
       });
   }
});
        
jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;process&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;881686cc-1bfc-456e-b8ab-71334c4a45e5&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){

	$(function () {
		function drawLineChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerline' + container).highcharts({

				chart: {
					type:'line'
				},
				title: {
					text: chart_name
				},
				tooltip :{
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				xAxis: dataXAxis ,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				series: dataSeries
			});
		};

		function drawBarChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerbar' + container).highcharts({
				chart: {
					type: 'column'
				},
				title: {
					text: chart_name
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {

					column: {
						pointPadding: 0.2,
						borderWidth: 0
					}
				},
				series: dataSeries
			});
		}

		function drawAreaChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail
			$('#containerarea' + container).highcharts({
				chart: {
					type: 'area'
				},
				title: {
					text: chart_name
				},
				subtitle: {
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					},
					labels: {
						formatter: function() {
							return this.value / 1000;
						}
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {
					area: {
						stacking: 'normal',
						lineColor: '#666666',
						lineWidth: 1,
						marker: {
							lineWidth: 1,
							lineColor: '#666666'
						}
					}
				},
				series: dataSeries
			});
		};

		function drawPieChart(data, container, chartName){
			var dataPie = data
			$(document).ready(function () {
				// Build the chart
				$('#container' + container).highcharts({
					chart: {
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: chartName
					},
					tooltip: {
						pointFormat: '{series.name}: &amp;lt;b&amp;gt;{point.percentage:.1f}%&amp;lt;/b&amp;gt;'
					},
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							dataLabels: {
								enabled: true,
                                                                color: '#000000',
                                                                connectorColor: '#000000',
                                                                format: '&amp;lt;b&amp;gt;{point.name}&amp;lt;/b&amp;gt;: {point.percentage:.1f} %'
							},
							showInLegend: true
						}
					},
					series: dataPie
				});
			});
		}

		// LINE
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                     if(($("#jsons&amp;gt;#jsonline_" + finalKey)).length &amp;gt; 0) {
					var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonline_" + finalKey).val());
					var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerline_" + finalKey).val());
				        var lstContainer = [];
  				        var data_all = [];
                                        var chartSize = arrayAll.length

                                        for(var i=0;i&amp;lt;chartSize ;i++){
                                           data_all = arrayAll[i]
                                           lstContainer = arrayContainerAll[i]
				           if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					        // data to display on tooltip
					        var data_detail = data_all[0]
					        // draw Line chart
				        	for(var j=0;j&amp;lt;data_all.length;j++){
				        		if(data_all[j].series[0].name == null){
				        			data_all[j].series[0].name = lstContainer[j]
					        	}
                                                        chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					        	drawLineChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					        }
				         }
                                      }
                                  }
				}
			} else {
				var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonline").val());
				var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerline").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length

                                for(var i=0;i&amp;lt;chartSize ;i++){
                                   data_all = arrayAll[i]
                                   lstContainer = arrayContainerAll[i]
				   if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Line chart
					for(var j=0;j&amp;lt;data_all.length;j++){
						if(data_all[j].series[0].name == null){
							data_all[j].series[0].name = lstContainer[j]
						}
                                                chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
						drawLineChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
				   }
                                }
			}
		});

		// BAR
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
			             var finalKey = lstKey[eKey]
                                     if(($("#jsons&amp;gt;#jsonbar_" + finalKey)).length &amp;gt; 0) {
					var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonbar_" + finalKey).val());
					var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerbar_" + finalKey).val());
					var lstContainer = [];
					var data_all = [];
                                        var chartSize = arrayAll.length
					for(var i=0;i&amp;lt;chartSize ;i++){
					    data_all = arrayAll[i]
					    lstContainer = arrayContainerAll[i]
					    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw bar chart
						for(var j=0;j&amp;lt;data_all.length;j++){
							if(data_all[j].series[0].name == null){
								data_all[j].series[0].name = lstContainer[j]
							}
                                                        chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
							drawBarChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
						}
                                            }
					}
                                    }
				}
			} else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonbar").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerbar").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
				    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Bar chart
					for(var j=0;j&amp;lt;data_all.length;j++){
                                            if(data_all[j].series[0].name == null){
						data_all[j].series[0].name = lstContainer[j]
					    }
                                            chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					    drawBarChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
                                    }
				}
			}
		});

		// AREA
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
                        var arrayAll
                        var arrayContainerAll
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                        if(($("#jsons&amp;gt;#jsonarea_" + finalKey)).length &amp;gt; 0) {
                                           arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonarea_" + finalKey).val());
                                           arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerarea_" + finalKey).val());
					   var lstContainer = [];
					   var data_all = [];
                                           var chartSize = arrayAll.length
					   for(var i=0;i&amp;lt;chartSize ;i++){
					       data_all = arrayAll[i]
					       lstContainer = arrayContainerAll[i]
					       if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						   // data to display on tooltip
						   var data_detail = data_all[0]
						   // draw Line chart
						   for(var j=0;j&amp;lt;data_all.length;j++){
						      if(data_all[j].series[0].name == null){
						         data_all[j].series[0].name = lstContainer[j]
						       }
                                                       chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
						       drawAreaChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
						   }
					      }
				           }
                                        }
			          }
                        } else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonarea").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerarea").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
				    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw area chart
					for(var j=0;j&amp;lt;data_all.length;j++){
                                            if(data_all[j].series[0].name == null){
						data_all[j].series[0].name = lstContainer[j]
					    }
                                            chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					    drawAreaChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
                                    }
				}
			}
		});

		// PIE
		$(document ).ready(function(){
                        var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
                        var arrayAll
                        var arrayContainerAll
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                        if(($("#jsons&amp;gt;#jsonpie_" + finalKey)).length &amp;gt; 0) {
                                           arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonpie_" + finalKey).val());
                                           arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerpie_" + finalKey).val());
					   var lstContainer = [];
					   var data_all = [];
                                           var chartSize = arrayAll.length
					  for(var i=0;i&amp;lt;chartSize ;i++){
					       data_all = arrayAll[i]
console.log(data_all)
					       lstContainer = arrayContainerAll[i]
					       if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						   // draw Pie chart
						   for(var j=0;j&amp;lt;data_all.length;j++){
                                                       //chartName = data_all[j].chart_name
                                                       chartName  = data_all[j].name
						       drawPieChart(data_all, finalKey + "_" + lstContainer[j], chartName)
						   }
					      }
				           }
                                        }
			          }
			} else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonpie").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerpie").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
                                    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
                                                   for(var j=0;j&amp;lt;data_all.length;j++){
                                                       chartName  = data_all[j].name
						       drawPieChart(data_all, i + "_pie", chartName)
						   }

                                    }
                                }
			}
		});
	});
	jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;d5873d92-b78b-42fc-9407-46d166204b88&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;/* css for timepicker */
.ui-timepicker-div .ui-widget-header { 
margin-bottom: 8px;
 }

.ui-timepicker-div dl { text-align: left; }
.ui-timepicker-div dl dt { height: 25px; margin-bottom: -25px; }
.ui-timepicker-div dl dd { margin: 0 10px 10px 65px; }
.ui-timepicker-div td { font-size: 90%; }
.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }

.ui-timepicker-rtl{ direction: rtl; }
.ui-timepicker-rtl dl { text-align: right; }
.ui-timepicker-rtl dl dd { margin: 0 65px 10px 10px; }
#ui-datepicker-div{
 position:relative;
 width:auto;
 height:auto
}
&lt;/code&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;datetimepicker -css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;1201fb1a-e9c1-4731-8c74-2ea8c0071959&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;.displayblock {
  border:2px solid;
  -webkit-border-radius:6px;
  background:gray;
  float: left;
  width:100%;
}

.displaypie {
  border:1px solid;
  -webkit-border-radius:6px;
  background:gray;
  width: 48%;
  float: left; 
  height: 300px;
}

.subtype {
  margin-top: 50px;
  font-size: 2em;
  color: red;
}&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;content&gt;{{include document="Lib.DataToDrawChart"/}}
{{include document="Lib.MongoDBConnection"/}}
{{velocity}}
$xwiki.jsx.use('Lib.JQueryUILib')
$xwiki.ssx.use('Lib.MenuGenerator')
$xwiki.jsx.use('Lib.MenuGenerator')
$xwiki.ssx.use('Lib.JQueryUILib')
$xwiki.jsx.use('Lib.JqGridLib')
$xwiki.ssx.use('Lib.JqGridLib') 
{{/velocity}}
{{include document="Lib.MenuGenerator"/}}
{{html wiki="true" clean="false"}}
&amp;lt;div id="viewer"&amp;gt;
&amp;lt;table style="text-align:left"  &amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th &amp;gt;Job name&amp;lt;/th&amp;gt;
  &amp;lt;td colspan=3&amp;gt;&amp;lt;div id="jobname"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
{{groovy}}
import org.xwiki.context.*

def ec = services.component.getInstance(Execution.class).getContext()
def mapJobIstIid = ec.getProperty("mapJobIstIid")

println '{{html clean="false" wiki="false"}}'
println '&amp;lt;tr&amp;gt;'
println '&amp;lt;th&amp;gt;IstIid&amp;lt;/th&amp;gt;'
println '&amp;lt;td colspan=3&amp;gt;'
mapJobIstIid.each{jobEntry-&amp;gt;
  def convertedJobKey = jobEntry.key.replaceAll("\\.","_")
  println "&amp;lt;div id='listIstIid'&amp;gt;"
  println "&amp;lt;div id=IstIid${convertedJobKey} style='display:none'&amp;gt;"
  println "&amp;lt;select id=select_${convertedJobKey}&amp;gt;"
  jobEntry.value.each{
     println "&amp;lt;option value=\"$it\"&amp;gt;$it&amp;lt;/option&amp;gt;"
  }
  println "&amp;lt;/select&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
}
println '&amp;lt;/td&amp;gt;'
println '&amp;lt;/tr&amp;gt;'
println '{{/html}}'
{{/groovy}}
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data monitor from&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="from-date" id="from-date"/&amp;gt;&amp;lt;/td&amp;gt;
  &amp;lt;th&amp;gt;Data monitor to&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="to-date" id="to-date"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data records limit &amp;lt;/th&amp;gt;
  &amp;lt;td &amp;gt;
     &amp;lt;select id="limit"&amp;gt;
       &amp;lt;option value=5&amp;gt;5&amp;lt;/option&amp;gt;
       &amp;lt;option value=10&amp;gt;10&amp;lt;/option&amp;gt;
       &amp;lt;option value=15&amp;gt;15&amp;lt;/option&amp;gt;
       &amp;lt;option value=20&amp;gt;20&amp;lt;/option&amp;gt;
     &amp;lt;/select&amp;gt;
  &amp;lt;/td&amp;gt;
  &amp;lt;td colspan=3 &amp;gt;&amp;lt;input type="button" value="View Data" id="get-data" class="button"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;&amp;lt;div id="display"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
  &amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
&amp;lt;/table&amp;gt;

&amp;lt;/div&amp;gt; 
   
 &amp;lt;/body&amp;gt;

{{/html}}
{{groovy}}
import groovy.json.*
xwiki.jsx.use("Lib.Highcharts")

if(request.xpage == "plain") {
	response.setContentType('text/plain')
}

def listData = []
def job = request.get("job")
def fromDate = request.get("fromDate")
def toDate = request.get("toDate")
def limit= (request.get("limit")!=null)?request.get("limit").toInteger():10
def istIid = request.get("IstIid")

def str= "No data to retrieved !"
def result = null
if(job != "" &amp;amp;&amp;amp; job != null &amp;amp;&amp;amp; istIid != null &amp;amp;&amp;amp; istIid != ""){
	MongoDBConnection.getConnection()
	if(fromDate != "" || toDate != ""){
		result = MongoDBConnection.getDataInPeriod(job,fromDate,toDate,limit,istIid)
	} else {
		result = MongoDBConnection.getDataAllFields(job,limit,istIid)
        }
MongoDBConnection.closeConnection()
} else {
   println "{{warning}}There are no selected job or IstIid{{/warning}}"
}
def listKey = []
if( (result != null) &amp;amp;&amp;amp; (result.size() &amp;gt; 0) &amp;amp;&amp;amp; (result[0].KEYEXPR != null)&amp;amp;&amp;amp;!(result[0].KEYEXPR instanceof List )){

if(result[0].type == "Subtyped") {
    println '{{html clean="false" wiki="true"}}'
    //println '&amp;lt;body&amp;gt;'
    def dataSubtype = DataToDrawChart.getDataToDrawSubtype(result)
    dataSubtype.each {key,value -&amp;gt;
        listKey.add(key)
    }
    def jsonkey = com.mongodb.util.JSON.serialize(listKey)
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$jsonkey&amp;lt;/textarea&amp;gt;"

    dataSubtype.each {key,value -&amp;gt;
            def dataLine = []
            def dataBar = []
            def dataPie = []
            def dataArea = []
            if(DataToDrawChart.getDataToDrawLine(value) != []) {
                dataLine = DataToDrawChart.getDataToDrawLine(value)
            }
            if(DataToDrawChart.getDataToDrawBar(value) != []) {
                dataBar = DataToDrawChart.getDataToDrawBar(value)
            }
            if(DataToDrawChart.getDataToDrawPie(value) != []) {
                dataPie = DataToDrawChart.getDataToDrawPie(value)
            }
            if(DataToDrawChart.getDataToDrawArea(value) != []) {
                dataArea = DataToDrawChart.getDataToDrawArea(value)
            }

		def chartColumnsLine = []
		def chartColumnsBar = []
		def chartColumnsArea = []
		def lstName

                dataLine.each {itemDataLine -&amp;gt;
                    if(itemDataLine.size() &amp;gt; 0 ){
		        chartColumnsLine.add(itemDataLine[0].chart_columns)
	            }
                }
                dataBar.each {itemDataBar -&amp;gt;
                    if(itemDataBar.size() &amp;gt; 0 ){
		        chartColumnsBar.add(itemDataBar[0].chart_columns)
	            }
                }
                dataArea.each {itemDataArea -&amp;gt;
                    if(itemDataArea.size() &amp;gt; 0 ){
		        chartColumnsArea.add(itemDataArea[0].chart_columns)
	            }
                }
println "dataPie" + dataPie
		if(dataPie.size() &amp;gt; 0 ){
			lstName = dataPie['name']
		}
		def tmpListNameContainer = []
                
		if(lstName != null) {
                        def chartNumPie = 0
                        def tmpLst
                        for(def nameContainer in lstName){
                           tmpLst = []
			   for(def nameContainerItem in nameContainer ){
                                println "nameContainerItem :" + nameContainerItem 
				nameContainerItem = chartNumPie + "_" + nameContainerItem.replaceAll("\\.", "_")
                                //nameContainerItem = nameContainerItem.replaceAll("\\.", "_")
				tmpLst.add(nameContainerItem )
		            }
                            tmpListNameContainer.add(tmpLst)
                            chartNumPie++
                         }
		}
		def jsonPie
		def jsonLine
		def jsonBar
		def jsonArea
		if(dataPie != []) {
		    jsonPie = com.mongodb.util.JSON.serialize(dataPie)
		}
		if(dataLine != []) {
		    jsonLine = com.mongodb.util.JSON.serialize(dataLine)
		}
		if(dataBar != []) {
		    jsonBar = com.mongodb.util.JSON.serialize(dataBar)
		}
		if(dataArea != []) {
		    jsonArea = com.mongodb.util.JSON.serialize(dataArea)
		}
		def jsonContainerPie
		if(tmpListNameContainer != []) {
			jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
		}
		def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
		def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
		def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

		println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
		if(jsonLine != null) {
			println "&amp;lt;textarea id=\"jsonline_$key\" &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class=\"lstcontainerline_$key\" &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
		}
		if(jsonBar != null) {
			println "&amp;lt;textarea id=\"jsonbar_$key\"&amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerbar_$key' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
		}
		if(jsonPie != null &amp;amp;&amp;amp; jsonContainerPie != null) {
			println "&amp;lt;textarea id=\"jsonpie_$key\" &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerpie_$key' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
		}
		if(jsonArea != null) {
			println "&amp;lt;textarea id=\"jsonarea_$key\" &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerarea_$key' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
		}

        println "&amp;lt;/div&amp;gt;"
          println "jsonPie" + jsonPie
          println "jsonContainerPie " + jsonContainerPie 
        def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
        def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
          
        println "&amp;lt;div style='clear:both'&amp;gt;"
            def description = value.KEYEXPR._description[0][key]
            if(description != null) {
                println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +': ' + description +'&amp;lt;/div&amp;gt;'
            } else {
                println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +'&amp;lt;/div&amp;gt;'
            }
            println "-----"
            if(jsonPie != null) {
          println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
		chartNumPie = 0
          lstName.each{chartPieLst -&amp;gt;
		chartPieLst.each {
println "container${key}_${tmp}"
	            //def tmp = chartNumPie + "_" + it.replaceAll("\\.", "_")
		   // println " &amp;lt;div class=\"displaypie\" id=\"container${key}_${tmp}\" &amp;gt;&amp;lt;/div&amp;gt;"
          	}
		chartNumPie++
	  }	
          println "&amp;lt;/div&amp;gt;"
            }
            if(jsonLine != null) {
          	def chartLineComment = false
		def chartNumLine = 0
          	chartColumnsLine.each{chartColumnsLineItem -&amp;gt;
            		if(!chartLineComment){
               			println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
               			chartLineComment = true  
            		}
		chartColumnsLineItem.each{
              		println " &amp;lt;div class=\"displayblock\" id=\"containerline${key}_${chartNumLine}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          	}
		chartNumLine ++
	    }
          println "&amp;lt;/div&amp;gt;"
            }
            println "&amp;amp;nbsp;"

            if(jsonBar != null) {
          	def chartBarComment = false
  		def chartNumBar = 0
          	chartColumnsBar.each{chartColumnsBarItem -&amp;gt;
             		if(!chartBarComment){
                		println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
                		chartBarComment = true
              		}  
			chartColumnsBarItem.each{
             			println " &amp;lt;div class=\"displayblock\" id=\"containerbar${key}_${chartNumBar}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          		}
			chartNumBar++
		}
          	println "&amp;lt;/div&amp;gt;"
            }
            println "&amp;amp;nbsp;"

            if(jsonArea != null) {
          	def chartAreaComment = false
		def chartNumArea = 0
          	chartColumnsArea.each{chartColumnsAreaItem -&amp;gt;
          		if(!chartAreaComment){
            			println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
            			chartAreaComment = true
          		}
			chartColumnsAreaItem.each{
            			println " &amp;lt;div class=\"displayblock\" id=\"containerarea${key}_${chartNumArea}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          		}
          		chartNumArea++
            	}
        	println "&amp;lt;/div&amp;gt;"
	    }
        /** Statistic data table **/
        println "&amp;lt;center&amp;gt;"        
        println "&amp;lt;div id='livetblContent_"+key+"' style='width:100%;clear:both;align:middle;margin-top:10px'&amp;gt;"   
        println "Statistics data for "+key
        println "&amp;lt;table id='livetableList_"+key+"' style='width:100%;align:center'&amp;gt;&amp;lt;/table&amp;gt;"
        println "&amp;lt;div id='livetablePager_"+key+"' style='position:relative;width:100%'&amp;gt;&amp;lt;/div&amp;gt;"
        println "&amp;lt;/div&amp;gt;"
        println "&amp;lt;/center&amp;gt;"
        println "&amp;lt;script language='javascript'&amp;gt;console.log('Create live table for "+key+"');&amp;lt;/script&amp;gt;"
    }
    //println '&amp;lt;/body&amp;gt;'
    println '{{/html}}'
} else if(result[0].type == "Store") {
	// data store
	def dataLine = DataToDrawChart.getDataToDrawLine(result)
	def dataBar = DataToDrawChart.getDataToDrawBar(result)
	def dataPie = DataToDrawChart.getDataToDrawPie(result)
	def dataArea = DataToDrawChart.getDataToDrawArea(result)
	def chartColumnsLine = []
	def chartColumnsBar = []
	def chartColumnsArea = []
	def lstName

        dataLine.each {itemDataLine -&amp;gt;
            if(itemDataLine.size() &amp;gt; 0 ){
		chartColumnsLine.add(itemDataLine[0].chart_columns)
	    }
        }

        dataBar.each {itemDataBar -&amp;gt;
            if(itemDataBar.size() &amp;gt; 0 ){
		chartColumnsBar.add(itemDataBar[0].chart_columns)
	    }
        }

        dataArea.each {itemDataArea -&amp;gt;
            if(itemDataArea.size() &amp;gt; 0 ){
		chartColumnsArea.add(itemDataArea[0].chart_columns)
	    }
        }

	if(dataPie.size() &amp;gt; 0 ){
		lstName = dataPie['name']
	}

    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
  
    def tmpListNameContainer = []
    def chartNumPie = 0
    for(def nameContainer in lstName){
       for(def nameContainerItem in nameContainer ){
           nameContainerItem = chartNumPie + "_" + nameContainerItem.replaceAll("\\.", "_")
           tmpListNameContainer .add(nameContainerItem )
       }
    }
    
    def jsonPie = com.mongodb.util.JSON.serialize(dataPie)
    def jsonLine = com.mongodb.util.JSON.serialize(dataLine)
    def jsonBar = com.mongodb.util.JSON.serialize(dataBar)
    def jsonArea = com.mongodb.util.JSON.serialize(dataArea)

    def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
    def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
    def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
    def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

    def listEmpty = com.mongodb.util.JSON.serialize([])
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$listEmpty&amp;lt;/textarea&amp;gt;" 

    println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
    println "&amp;lt;textarea class='jsonline' &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonbar' &amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonpie' &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonarea' &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"

    println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;/div&amp;gt;"

    def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
    def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
  
    println "&amp;lt;div style='clear:both'&amp;gt;"
  
    def chartPieComment = false
    chartNumPie = 0
    lstName.each{chartPieLst-&amp;gt;
        if(!chartPieComment) {
            println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
            chartPieComment = true
        }
        chartPieLst.each {
            def tmp = chartNumPie + "_pie"
            println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
        }
    }
    println "&amp;lt;/div&amp;gt;"
    	def chartLineComment = false
	def chartNum = 0
    	chartColumnsLine.each{chartColumnsLineItem -&amp;gt;
	    	if(!chartLineComment){
	        	println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	        	chartLineComment = true  
	    	}
		chartColumnsLineItem.each{
	    		println " &amp;lt;div class=\"displayblock\" id=\"containerline${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	    	}
		chartNum++
	}	
    	println "&amp;lt;/div&amp;gt;"
    	println "&amp;amp;nbsp;"
    	def chartBarComment = false
	chartNum = 0
    	chartColumnsBar.each{chartColumnsBarItem -&amp;gt;
	        if(!chartBarComment){
	            println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	            chartBarComment = true
	        }  
		chartColumnsBarItem.each{
	    		println " &amp;lt;div class=\"displayblock\" id=\"containerbar${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  	}
		chartNum++
	}
  println "&amp;lt;/div&amp;gt;"
  println "&amp;amp;nbsp;"
  	def chartAreaComment = false
	chartNum = 0
  	chartColumnsArea.each{chartColumnsAreaItem -&amp;gt;
	  	if(!chartAreaComment){
	    		println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	    		chartAreaComment = true
	  	}
		chartColumnsAreaItem.each{
    			println " &amp;lt;div class=\"displayblock\" id=\"containerarea${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
		}
		chartNum++
  	}
  println "&amp;lt;/div&amp;gt;"
println "&amp;lt;/div&amp;gt;"

//println '&amp;lt;/body&amp;gt;'
println '{{/html}}'
}
}else{
    println 'There is no data for this job with criterias'
}
//--=============== Start build for livetable
def subTypeURLMap = [:]
def dataModel = []
def dataUrl = ""
result.find{rec-&amp;gt;				
    def subtractData = []
    
    //-- Parsing data and assign data to subtract list
    if(rec.type == "Store"){ //-- Store data type
        subtractData = rec['data']        
        subtractData.each{r2-&amp;gt;					
            if(dataModel != null &amp;amp;&amp;amp; dataModel.size() &amp;lt;=0){ 
                dataModel.add("Fetch At")
                dataModel.addAll(r2.keySet());					
            } 
        }        
        dataUrl = "/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job="+job +"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate + "&amp;amp;toDate=" + toDate + "&amp;amp;istIid="+istIid        
        //-- Building data model				
        def model = []
        def colSpec
        dataModel.each{name-&amp;gt;
            colSpec = [:]
            colSpec['name'] = name
            colSpec['index'] = name
            colSpec['width'] = "100"
            model.add(colSpec)
        }
        def dataModelStr = (new JsonBuilder(dataModel)).toPrettyString()
        def modelStr = (new JsonBuilder(model)).toPrettyString() 
        str = 
        "{\"url\":\""+dataUrl+"\",\"datatype\":\"json\","+
            "\"colNames\":"+ dataModelStr +
            ",\"colModel\":"+ modelStr +" ,\"rowList\":[10,20,30],"+
            "\"pager\":\"#livetablePager\", \"viewrecords\": true, \"sortname\": \"RECORD_SEQ\","+
            "\"sortorder\": \"asc\", \"caption\":\""+job+"\"}"
        println "{{html clean=\"false\" wiki=\"true\"}}"
        println "&amp;lt;div id='livetableJson' style = \"display:none\"&amp;gt;"
        //println "&amp;lt;div id='livetableJson'&amp;gt;"
        println str;
        println "&amp;lt;/div&amp;gt;"
        println "{{/html}}"
    }else{ //-- Subtype			
        def subData = rec['data']
        subData.each{key,value-&amp;gt;
            dataUrl = "/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job="+job +"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate + "&amp;amp;toDate=" + toDate + "&amp;amp;istIid="+istIid+"&amp;amp;subType="+key
            subtractData = value
            subtractData.each{r2-&amp;gt;					
                if(dataModel != null &amp;amp;&amp;amp; dataModel.size() &amp;lt;=0){ 
                    dataModel.add("Fetch At")
                    dataModel.addAll(r2.keySet());					
                } 			
            }
            //-- Building data model				
            def model = []
            def colSpec
            dataModel.each{name-&amp;gt;
                colSpec = [:]
                colSpec['name'] = name
                colSpec['index'] = name
                colSpec['width'] = "100"
                model.add(colSpec)
            }
            def dataModelStr = (new JsonBuilder(dataModel)).toPrettyString()
            def modelStr = (new JsonBuilder(model)).toPrettyString() 
            str = 
            "{\"url\":\""+dataUrl+"\",\"datatype\":\"json\","+
                "\"colNames\":"+ dataModelStr +
                ",\"colModel\":"+ modelStr +" ,\"rowList\":[10,20,30],"+
                "\"pager\":\"#livetablePager\", \"viewrecords\": true, \"sortname\": \"RECORD_SEQ\","+
                "\"sortorder\": \"asc\", \"caption\":\""+job+"\"}"
            subTypeURLMap[key] = str
        }
        def finalStr = (new JsonBuilder(subTypeURLMap)).toPrettyString()
        println "{{html clean=\"false\" wiki=\"true\"}}"
        println "&amp;lt;div id='livetableJson' style = \"display:none\"&amp;gt;"
        //println "&amp;lt;div id='livetableJson'&amp;gt;"
        println finalStr;
        println "&amp;lt;/div&amp;gt;"
        println "{{/html}}"
    }
    return true
}
 //--=============== END

if(listKey.size() &amp;lt;= 0){   
    println "{{html clean=\"false\" wiki=\"true\"}}"
    println "&amp;lt;center&amp;gt;"
    println "&amp;lt;div id=\"livetblContent\" style=\"width:100%;clear:both;align:middle;margin-top:10px\"&amp;gt;"   
    println "Statistics Data"
    println "&amp;lt;table id=\"livetableList\" style=\"width:100%;align:center\"&amp;gt;&amp;lt;/table&amp;gt;"    
    println "&amp;lt;div id=\"livetablePager\"&amp;gt;&amp;lt;/div&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
    println "&amp;lt;/center&amp;gt;"
    
    println "&amp;lt;div id=\"testDiv\"&amp;gt;&amp;amp;nbsp;&amp;lt;/div&amp;gt;"
    println "{{/html}}"
}
{{/groovy}}
&lt;/content&gt;&lt;/xwikidoc&gt;@


61.32
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376558635000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;61.32&lt;/version&gt;
a2963 1
                                                       //chartName = data_all[j].chart_name
@


61.31
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376558593000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;61.31&lt;/version&gt;
d2966 1
a2966 1
						       drawPieChart(data_all, i + "_pie"], chartName)
@


61.30
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376558519000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;61.30&lt;/version&gt;
d2966 1
a2966 2
console.log( i + "_pie")
						       //drawPieChart(data_all, i + "_pie"], chartName)
@


61.29
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376558505000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;61.29&lt;/version&gt;
d2966 1
a2966 1
console.log(finalKey + "_pie")
@


61.28
log
@@
text
@&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xwikidoc&gt;
&lt;web&gt;WiperDog&lt;/web&gt;
&lt;name&gt;WebHome&lt;/name&gt;
&lt;language&gt;&lt;/language&gt;
&lt;defaultLanguage&gt;en&lt;/defaultLanguage&gt;
&lt;translation&gt;0&lt;/translation&gt;
&lt;parent&gt;&lt;/parent&gt;
&lt;creator&gt;XWiki.Admin&lt;/creator&gt;
&lt;author&gt;XWiki.Admin&lt;/author&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;contentAuthor&gt;XWiki.Admin&lt;/contentAuthor&gt;
&lt;creationDate&gt;1376364375000&lt;/creationDate&gt;
&lt;date&gt;1376558484000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376558092000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.28&lt;/version&gt;
&lt;title&gt;WiperDog&lt;/title&gt;
&lt;defaultTemplate&gt;&lt;/defaultTemplate&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;comment&gt;&lt;/comment&gt;
&lt;minorEdit&gt;true&lt;/minorEdit&gt;
&lt;syntaxId&gt;xwiki/2.1&lt;/syntaxId&gt;
&lt;hidden&gt;false&lt;/hidden&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;047293a8-524d-45e4-af52-cd944523d5d0&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
/*
 * jQuery timepicker addon
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 1.3.1
 * Last Modified: 07/07/2013
 *
 * Copyright 2013 Trent Richardson
 * You may use this project under MIT or GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 */

/*jslint evil: true, white: false, undef: false, nomen: false */

(function($) {

	/*
	* Lets not redefine timepicker, Prevent "Uncaught RangeError: Maximum call stack size exceeded"
	*/
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return;
	}

	/*
	* Extend jQueryUI, get it started with our version number
	*/
	$.extend($.ui, {
		timepicker: {
			version: "1.3.1"
		}
	});

	/* 
	* Timepicker manager.
	* Use the singleton instance of this class, $.timepicker, to interact with the time picker.
	* Settings for (groups of) time pickers are maintained in an instance object,
	* allowing multiple different settings on the same page.
	*/
	var Timepicker = function() {
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[''] = { // Default regional settings
			currentText: 'Now',
			closeText: 'Done',
			amNames: ['AM', 'A'],
			pmNames: ['PM', 'P'],
			timeFormat: 'HH:mm',
			timeSuffix: '',
			timeOnlyTitle: 'Choose Time',
			timeText: 'Time',
			hourText: 'Hour',
			minuteText: 'Minute',
			secondText: 'Second',
			millisecText: 'Millisecond',
			microsecText: 'Microsecond',
			timezoneText: 'Time Zone',
			isRTL: false
		};
		this._defaults = { // Global defaults for all the datetime picker instances
			showButtonPanel: true,
			timeOnly: false,
			showHour: null,
			showMinute: null,
			showSecond: null,
			showMillisec: null,
			showMicrosec: null,
			showTimezone: null,
			showTime: true,
			stepHour: 1,
			stepMinute: 1,
			stepSecond: 1,
			stepMillisec: 1,
			stepMicrosec: 1,
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null,
			hourMin: 0,
			minuteMin: 0,
			secondMin: 0,
			millisecMin: 0,
			microsecMin: 0,
			hourMax: 23,
			minuteMax: 59,
			secondMax: 59,
			millisecMax: 999,
			microsecMax: 999,
			minDateTime: null,
			maxDateTime: null,
			onSelect: null,
			hourGrid: 0,
			minuteGrid: 0,
			secondGrid: 0,
			millisecGrid: 0,
			microsecGrid: 0,
			alwaysSetTime: true,
			separator: ' ',
			altFieldTimeOnly: true,
			altTimeFormat: null,
			altSeparator: null,
			altTimeSuffix: null,
			pickerTimeFormat: null,
			pickerTimeSuffix: null,
			showTimepicker: true,
			timezoneList: null,
			addSliderAccess: false,
			sliderAccessArgs: null,
			controlType: 'slider',
			defaultValue: null,
			parse: 'strict'
		};
		$.extend(this._defaults, this.regional['']);
	};

	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: '',
		formattedDate: '',
		formattedTime: '',
		formattedDateTime: '',
		timezoneList: null,
		units: ['hour','minute','second','millisec', 'microsec'],
		support: {},
		control: null,

		/* 
		* Override the default settings for all instances of the time picker.
		* @@param  settings  object - the new settings to use as defaults (anonymous object)
		* @@return the manager object
		*/
		setDefaults: function(settings) {
			extendRemove(this._defaults, settings || {});
			return this;
		},

		/*
		* Create a new Timepicker instance
		*/
		_newInst: function($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
            	fns = {},
		    	overrides, i;

			for (var attrName in this._defaults) {
				if(this._defaults.hasOwnProperty(attrName)){
					var attrValue = $input.attr('time:' + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue);
						} catch (err) {
							inlineSettings[attrName] = attrValue;
						}
					}
				}
			}

		    overrides = {
		        beforeShow: function (input, dp_inst) {
		            if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
		                return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst);
		            }
		        },
		        onChangeMonthYear: function (year, month, dp_inst) {
		            // Update the time as well : this prevents the time from disappearing from the $input field.
		            tp_inst._updateDateTime(dp_inst);
		            if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
		                tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst);
		            }
		        },
		        onClose: function (dateText, dp_inst) {
		            if (tp_inst.timeDefined === true &amp;amp;&amp;amp; $input.val() !== '') {
		                tp_inst._updateDateTime(dp_inst);
		            }
		            if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
		                tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst);
		            }
		        }
		    };
		    for (i in overrides) {
		        if (overrides.hasOwnProperty(i)) {
		            fns[i] = opts[i] || null;
		        }
		    }

		    tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
		        evnts:fns,
		        timepicker: tp_inst // add timepicker as a property of datepicker: $.datepicker._get(dp_inst, 'timepicker');
		    });
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function(val) {
				return val.toUpperCase();
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function(val) {
				return val.toUpperCase();
			});

			// detect which units are supported
			tp_inst.support = detectSupport(
					tp_inst._defaults.timeFormat + 
					(tp_inst._defaults.pickerTimeFormat? tp_inst._defaults.pickerTimeFormat:'') + 
					(tp_inst._defaults.altTimeFormat? tp_inst._defaults.altTimeFormat:''));

			// controlType is string - key to our this._controls
			if(typeof(tp_inst._defaults.controlType) === 'string'){
				if(tp_inst._defaults.controlType == 'slider' &amp;amp;&amp;amp; typeof(jQuery.ui.slider) === 'undefined'){
					tp_inst._defaults.controlType = 'select';
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType];
			}
			// controlType is an object and must implement create, options, value methods
			else{ 
				tp_inst.control = tp_inst._defaults.controlType;
			}

			// prep the timezone options
			var timezoneList = [-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,
					0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList;
			}
			var tzl=timezoneList.length,tzi=0,tzv=null;
			if (tzl &amp;gt; 0 &amp;amp;&amp;amp; typeof timezoneList[0] !== 'object') {
				for(; tzi&amp;lt;tzl; tzi++){
					tzv = timezoneList[tzi];
					timezoneList[tzi] = { value: tzv, label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601) };
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;

			// set the default units
			tp_inst.timezone = tp_inst._defaults.timezone !== null? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) : 
							((new Date()).getTimezoneOffset()*-1);
			tp_inst.hour = tp_inst._defaults.hour &amp;lt; tp_inst._defaults.hourMin? tp_inst._defaults.hourMin : 
							tp_inst._defaults.hour &amp;gt; tp_inst._defaults.hourMax? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute &amp;lt; tp_inst._defaults.minuteMin? tp_inst._defaults.minuteMin : 
							tp_inst._defaults.minute &amp;gt; tp_inst._defaults.minuteMax? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second &amp;lt; tp_inst._defaults.secondMin? tp_inst._defaults.secondMin : 
							tp_inst._defaults.second &amp;gt; tp_inst._defaults.secondMax? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec &amp;lt; tp_inst._defaults.millisecMin? tp_inst._defaults.millisecMin : 
							tp_inst._defaults.millisec &amp;gt; tp_inst._defaults.millisecMax? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec &amp;lt; tp_inst._defaults.microsecMin? tp_inst._defaults.microsecMin : 
							tp_inst._defaults.microsec &amp;gt; tp_inst._defaults.microsecMax? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = '';
			tp_inst.$input = $input;

			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField).css({
					cursor: 'pointer'
				}).focus(function() {
					$input.trigger("focus");
				});
			}

			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date();
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date();
			}

			// datepicker needs minDate/maxDate, timepicker needs minDateTime/maxDateTime..
			if (tp_inst._defaults.minDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime());
			}
			if (tp_inst._defaults.minDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime());
			}
			if (tp_inst._defaults.maxDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime());
			}
			if (tp_inst._defaults.maxDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime());
			}
			tp_inst.$input.bind('focus', function() {
				tp_inst._onFocus();
			});

			return tp_inst;
		},

		/*
		* add our sliders to the calendar
		*/
		_addTimePicker: function(dp_inst) {
			var currDT = (this.$altInput &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly) ? this.$input.val() + ' ' + this.$altInput.val() : this.$input.val();

			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
		},

		/*
		* parse the time string from input value or _setTime
		*/
		_parseTime: function(timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0]);
			}

			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, 'dateFormat');
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false;
					}
					$.extend(this, parseRes.timeObj);
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err +
									"\ndate/time string = " + timeString +
									"\ntimeFormat = " + this._defaults.timeFormat +
									"\ndateFormat = " + dp_dateFormat);
					return false;
				}
				return true;
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false;
				}
				$.extend(this, timeObj);
				return true;
			}
		},

		/*
		* generate and inject html for timepicker into ui datepicker
		*/
		_injectTimePicker: function() {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = '',
				uitem = '',
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i=0,
				l=0;

			// Prevent displaying twice
			if ($dp.find("div.ui-timepicker-div").length === 0 &amp;amp;&amp;amp; o.showTimepicker) {
				var noDisplay = ' style="display:none;"',
					html = '&amp;lt;div class="ui-timepicker-div'+ (o.isRTL? ' ui-timepicker-rtl' : '') +'"&amp;gt;&amp;lt;dl&amp;gt;' + '&amp;lt;dt class="ui_tpicker_time_label"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;' + o.timeText + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_time"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the markup
				for(i=0,l=this.units.length; i&amp;lt;l; i++){
					litem = this.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// Added by Peter Medeiros:
					// - Figure out what the hour/minute/second max should be based on the step values.
					// - Example: if stepMinute is 15, then minMax is 45.
					max[litem] = parseInt((o[litem+'Max'] - ((o[litem+'Max'] - o[litem+'Min']) % o['step'+uitem])), 10);
					gridSize[litem] = 0;

					html += '&amp;lt;dt class="ui_tpicker_'+ litem +'_label"' + (show ? '' : noDisplay) + '&amp;gt;' + o[litem +'Text'] + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_'+ litem +'"&amp;gt;&amp;lt;div class="ui_tpicker_'+ litem +'_slider"' + (show ? '' : noDisplay) + '&amp;gt;&amp;lt;/div&amp;gt;';

					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						html += '&amp;lt;div style="padding-left: 1px"&amp;gt;&amp;lt;table class="ui-tpicker-grid-label"&amp;gt;&amp;lt;tr&amp;gt;';

						if(litem == 'hour'){
							for (var h = o[litem+'Min']; h &amp;lt;= max[litem]; h += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm? 'hht':'HH', {hour:h}, o);									
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + tmph + '&amp;lt;/td&amp;gt;';
							}
						}
						else{
							for (var m = o[litem+'Min']; m &amp;lt;= max[litem]; m += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + ((m &amp;lt; 10) ? '0' : '') + m + '&amp;lt;/td&amp;gt;';
							}
						}

						html += '&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;&amp;lt;/div&amp;gt;';
					}
					html += '&amp;lt;/dd&amp;gt;';
				}
				
				// Timezone
				var showTz = o.showTimezone !== null? o.showTimezone : this.support.timezone;
				html += '&amp;lt;dt class="ui_tpicker_timezone_label"' + (showTz ? '' : noDisplay) + '&amp;gt;' + o.timezoneText + '&amp;lt;/dt&amp;gt;';
				html += '&amp;lt;dd class="ui_tpicker_timezone" ' + (showTz ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the elements from string
				html += '&amp;lt;/dl&amp;gt;&amp;lt;/div&amp;gt;';
				var $tp = $(html);

				// if we only want time picker...
				if (o.timeOnly === true) {
					$tp.prepend('&amp;lt;div class="ui-widget-header ui-helper-clearfix ui-corner-all"&amp;gt;' + '&amp;lt;div class="ui-datepicker-title"&amp;gt;' + o.timeOnlyTitle + '&amp;lt;/div&amp;gt;' + '&amp;lt;/div&amp;gt;');
					$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();
				}
				
				// add sliders, adjust grids, add events
				for(i=0,l=tp_inst.units.length; i&amp;lt;l; i++){
					litem = tp_inst.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// add the slider
					tp_inst[litem+'_slider'] = tp_inst.control.create(tp_inst, $tp.find('.ui_tpicker_'+litem+'_slider'), litem, tp_inst[litem], o[litem+'Min'], max[litem], o['step'+uitem]);

					// adjust the grid and add click event
					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						size = 100 * gridSize[litem] * o[litem+'Grid'] / (max[litem] - o[litem+'Min']);
						$tp.find('.ui_tpicker_'+litem+' table').css({
							width: size + "%",
							marginLeft: o.isRTL? '0' : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL? ((size / (-2 * gridSize[litem])) + "%") : '0',
							borderCollapse: 'collapse'
						}).find("td").click(function(e){
								var $t = $(this),
									h = $t.html(),
									n = parseInt(h.replace(/[^0-9]/g),10),
									ap = h.replace(/[^apm]/ig),
									f = $t.data('for'); // loses scope, so we use data-for

								if(f == 'hour'){
									if(ap.indexOf('p') !== -1 &amp;amp;&amp;amp; n &amp;lt; 12){
										n += 12;
									}
									else{
										if(ap.indexOf('a') !== -1 &amp;amp;&amp;amp; n === 12){
											n = 0;
										}
									}
								}
								
								tp_inst.control.value(tp_inst, tp_inst[f+'_slider'], litem, n);

								tp_inst._onTimeChange();
								tp_inst._onSelectHandler();
							}).css({
								cursor: 'pointer',
								width: (100 / gridSize[litem]) + '%',
								textAlign: 'center',
								overflow: 'hidden'
							});
					} // end if grid &amp;gt; 0
				} // end for loop

				// Add timezone options
				this.timezone_select = $tp.find('.ui_tpicker_timezone').append('&amp;lt;select&amp;gt;&amp;lt;/select&amp;gt;').find("select");
				$.fn.append.apply(this.timezone_select,
				$.map(o.timezoneList, function(val, idx) {
					return $("&amp;lt;option /&amp;gt;").val(typeof val == "object" ? val.value : val).text(typeof val == "object" ? val.label : val);
				}));
				if (typeof(this.timezone) != "undefined" &amp;amp;&amp;amp; this.timezone !== null &amp;amp;&amp;amp; this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset()*-1;
					if (local_timezone == this.timezone) {
						selectLocalTimezone(tp_inst);
					} else {
						this.timezone_select.val(this.timezone);
					}
				} else {
					if (typeof(this.hour) != "undefined" &amp;amp;&amp;amp; this.hour !== null &amp;amp;&amp;amp; this.hour !== "") {
						this.timezone_select.val(o.timezone);
					} else {
						selectLocalTimezone(tp_inst);
					}
				}
				this.timezone_select.change(function() {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
				});
				// End timezone options
				
				// inject timepicker into datepicker
				var $buttonPanel = $dp.find('.ui-datepicker-buttonpane');
				if ($buttonPanel.length) {
					$buttonPanel.before($tp);
				} else {
					$dp.append($tp);
				}

				this.$timeObj = $tp.find('.ui_tpicker_time');

				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined;
				}

				// slideAccess integration: http://trentrichardson.com/2011/11/11/jquery-ui-sliders-and-touch-accessibility/
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
						
					setTimeout(function() { // fix for inline mode
						if ($tp.find('.ui-slider-access').length === 0) {
							$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);

							// fix any grids since sliders are shorter
							var sliderAccessWidth = $tp.find('.ui-slider-access:eq(0)').outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find('table:visible').each(function() {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl? 'marginRight':'marginLeft').toString().replace('%', ''),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + '%',
										css = { width: newWidth, marginRight: 0, marginLeft: 0 };
									css[rtl? 'marginRight':'marginLeft'] = newMarginLeft;
									$g.css(css);
								});
							}
						}
					}, 10);
				}
				// end slideAccess integration

				tp_inst._limitMinMaxDateTime(this.inst, true);
			}
		},

		/*
		* This function tries to limit the ability to go outside the
		* min/max date range
		*/
		_limitMinMaxDateTime: function(dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);

			if (!this._defaults.showTimepicker) {
				return;
			} // No time so nothing to check here

			if ($.datepicker._get(dp_inst, 'minDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'minDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, 'minDateTime'),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin;
				}

				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour &amp;lt;= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute &amp;lt;= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second &amp;lt;= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if(this.millisec &amp;lt;= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;lt; this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin;
									}
									this._defaults.microsecMin = this.microsecMinOriginal;
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal;
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal;
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal;
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal;
				}
			}

			if ($.datepicker._get(dp_inst, 'maxDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'maxDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, 'maxDateTime'),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax;
				}

				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour &amp;gt;= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute &amp;gt;= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second &amp;gt;= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec &amp;gt;= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;gt; this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax;
									}
									this._defaults.microsecMax = this.microsecMaxOriginal;
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal;
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal;
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal;
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal;
				}
			}

			if (adjustSliders !== undefined &amp;amp;&amp;amp; adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10);
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);

				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, 'hour', { min: this._defaults.hourMin, max: hourMax });
					this.control.value(this, this.hour_slider, 'hour', this.hour - (this.hour % this._defaults.stepHour));
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, 'minute', { min: this._defaults.minuteMin, max: minMax });
					this.control.value(this, this.minute_slider, 'minute', this.minute - (this.minute % this._defaults.stepMinute));
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, 'second', { min: this._defaults.secondMin, max: secMax });
					this.control.value(this, this.second_slider, 'second', this.second - (this.second % this._defaults.stepSecond));
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, 'millisec', { min: this._defaults.millisecMin, max: millisecMax });
					this.control.value(this, this.millisec_slider, 'millisec', this.millisec - (this.millisec % this._defaults.stepMillisec));
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, 'microsec', { min: this._defaults.microsecMin, max: microsecMax });
					this.control.value(this, this.microsec_slider, 'microsec', this.microsec - (this.microsec % this._defaults.stepMicrosec));
				}
			}

		},

		/*
		* when a slider moves, set the internal time...
		* on time change is also called when the time is updated in the text field
		*/
		_onTimeChange: function() {
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, 'hour') : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, 'minute') : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, 'second') : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, 'millisec') : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, 'microsec') : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;

			if (typeof(hour) == 'object') {
				hour = false;
			}
			if (typeof(minute) == 'object') {
				minute = false;
			}
			if (typeof(second) == 'object') {
				second = false;
			}
			if (typeof(millisec) == 'object') {
				millisec = false;
			}
			if (typeof(microsec) == 'object') {
				microsec = false;
			}
			if (typeof(timezone) == 'object') {
				timezone = false;
			}

			if (hour !== false) {
				hour = parseInt(hour, 10);
			}
			if (minute !== false) {
				minute = parseInt(minute, 10);
			}
			if (second !== false) {
				second = parseInt(second, 10);
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10);
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10);
			}

			var ampm = o[hour &amp;lt; 12 ? 'amNames' : 'pmNames'][0];

			// If the update was done in the input field, the input field should not be updated.
			// If the update was done using the sliders, update the input field.
			var hasChanged = (hour != this.hour || minute != this.minute || second != this.second || millisec != this.millisec || microsec != this.microsec 
								|| (this.ampm.length &amp;gt; 0 &amp;amp;&amp;amp; (hour &amp;lt; 12) != ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) 
								|| (this.timezone !== null &amp;amp;&amp;amp; timezone != this.timezone));

			if (hasChanged) {

				if (hour !== false) {
					this.hour = hour;
				}
				if (minute !== false) {
					this.minute = minute;
				}
				if (second !== false) {
					this.second = second;
				}
				if (millisec !== false) {
					this.millisec = millisec;
				}
				if (microsec !== false) {
					this.microsec = microsec;
				}
				if (timezone !== false) {
					this.timezone = timezone;
				}

				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0]);
				}

				this._limitMinMaxDateTime(this.inst, true);
			}
			if (this.support.ampm) {
				this.ampm = ampm;
			}

			// Updates the time within the timepicker
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if(pickerTimeFormat === o.timeFormat){
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix);
				}
				else{
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix);
				}
			}

			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime();
			}
		},

		/*
		* call custom onSelect.
		* bind to sliders slidestop, and grid click.
		*/
		_onSelectHandler: function() {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect &amp;amp;&amp;amp; inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this]);
			}
		},

		/*
		* update our input with the new date time..
		*/
		_updateDateTime: function(dp_inst) {
			dp_inst = this.inst || dp_inst;
			//var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
			var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay)),
				dateFmt = $.datepicker._get(dp_inst, 'dateFormat'),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null &amp;amp;&amp;amp; this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			
			// if a slider was changed but datepicker doesn't have a value yet, set it
			if(dp_inst.lastVal===""){
                dp_inst.currentYear=dp_inst.selectedYear;
                dp_inst.currentMonth=dp_inst.selectedMonth;
                dp_inst.currentDay=dp_inst.selectedDay;
            }

			/*
			* remove following lines to force every changes in date picker to change the input value
			* Bug descriptions: when an input field has a default value, and click on the field to pop up the date picker. 
			* If the user manually empty the value in the input field, the date picker will never change selected value.
			*/
			//if (dp_inst.lastVal !== undefined &amp;amp;&amp;amp; (dp_inst.lastVal.length &amp;gt; 0 &amp;amp;&amp;amp; this.$input.val().length === 0)) {
			//	return;
			//}

			if (this._defaults.timeOnly === true) {
				formattedDateTime = this.formattedTime;
			} else if (this._defaults.timeOnly !== true &amp;amp;&amp;amp; (this._defaults.alwaysSetTime || timeAvailable)) {
				formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix;
			}

			this.formattedDateTime = formattedDateTime;

			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate);
			} else if (this.$altInput &amp;amp;&amp;amp; this._defaults.timeOnly === false &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly === true) {
				this.$altInput.val(this.formattedTime);
				this.$input.val(this.formattedDate);
			} else if (this.$altInput) {
				this.$input.val(formattedDateTime);
				var altFormattedDateTime = '',
					altSeparator = this._defaults.altSeparator ? this._defaults.altSeparator : this._defaults.separator,
					altTimeSuffix = this._defaults.altTimeSuffix ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
				
				if(!this._defaults.timeOnly){
					if (this._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg);
					}
					else{
						altFormattedDateTime = this.formattedDate;
					}

					if (altFormattedDateTime){
						altFormattedDateTime += altSeparator;
					}
				}

				if(this._defaults.altTimeFormat){
					altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix;
				}
				else{
					altFormattedDateTime += this.formattedTime + altTimeSuffix;
				}
				this.$altInput.val(altFormattedDateTime);
			} else {
				this.$input.val(formattedDateTime);
			}

			this.$input.trigger("change");
		},

		_onFocus: function() {
			if (!this.$input.val() &amp;amp;&amp;amp; this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, 'timepicker');
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst);
						} catch (err) {
							$.timepicker.log(err);
						}
					}
				}
			}
		},

		/*
		* Small abstraction to control types
		* We can add more, just be sure to follow the pattern: create, options, value
		*/
		_controls: {
			// slider methods
			slider: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var rtl = tp_inst._defaults.isRTL; // if rtl go -60-&amp;gt;0 instead of 0-&amp;gt;60
					return obj.prop('slide', null).slider({
						orientation: "horizontal",
						value: rtl? val*-1 : val,
						min: rtl? max*-1 : min,
						max: rtl? min*-1 : max,
						step: step,
						slide: function(event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl? ui.value*-1:ui.value);
							tp_inst._onTimeChange();
						},
						stop: function(event, ui) {
							tp_inst._onSelectHandler();
						}
					});	
				},
				options: function(tp_inst, obj, unit, opts, val){
					if(tp_inst._defaults.isRTL){
						if(typeof(opts) == 'string'){
							if(opts == 'min' || opts == 'max'){
								if(val !== undefined){
									return obj.slider(opts, val*-1);
								}
								return Math.abs(obj.slider(opts));
							}
							return obj.slider(opts);
						}
						var min = opts.min, 
							max = opts.max;
						opts.min = opts.max = null;
						if(min !== undefined){
							opts.max = min * -1;
						}
						if(max !== undefined){
							opts.min = max * -1;
						}
						return obj.slider(opts);
					}
					if(typeof(opts) == 'string' &amp;amp;&amp;amp; val !== undefined){
							return obj.slider(opts, val);
					}
					return obj.slider(opts);
				},
				value: function(tp_inst, obj, unit, val){
					if(tp_inst._defaults.isRTL){
						if(val !== undefined){
							return obj.slider('value', val*-1);
						}
						return Math.abs(obj.slider('value'));
					}
					if(val !== undefined){
						return obj.slider('value', val);
					}
					return obj.slider('value');
				}
			},
			// select methods
			select: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var sel = '&amp;lt;select class="ui-timepicker-select" data-unit="'+ unit +'" data-min="'+ min +'" data-max="'+ max +'" data-step="'+ step +'"&amp;gt;',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;

					for(var i=min; i&amp;lt;=max; i+=step){						
						sel += '&amp;lt;option value="'+ i +'"'+ (i==val? ' selected':'') +'&amp;gt;';
						if(unit == 'hour'){
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig,'')), {hour:i}, tp_inst._defaults);
						}
						else if(unit == 'millisec' || unit == 'microsec' || i &amp;gt;= 10){ sel += i; }
						else {sel += '0'+ i.toString(); }
						sel += '&amp;lt;/option&amp;gt;';
					}
					sel += '&amp;lt;/select&amp;gt;';

					obj.children('select').remove();

					$(sel).appendTo(obj).change(function(e){
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
					});

					return obj;
				},
				options: function(tp_inst, obj, unit, opts, val){
					var o = {},
						$t = obj.children('select');
					if(typeof(opts) == 'string'){
						if(val === undefined){
							return $t.data(opts);
						}
						o[opts] = val;	
					}
					else{ o = opts; }
					return tp_inst.control.create(tp_inst, obj, $t.data('unit'), $t.val(), o.min || $t.data('min'), o.max || $t.data('max'), o.step || $t.data('step'));
				},
				value: function(tp_inst, obj, unit, val){
					var $t = obj.children('select');
					if(val !== undefined){
						return $t.val(val);
					}
					return $t.val();
				}
			}
		} // end _controls

	});

	$.fn.extend({
		/*
		* shorthand just to use timepicker..
		*/
		timepicker: function(o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);

			if (typeof o == 'object') {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				});
			}

			return $(this).each(function() {
				$.fn.datetimepicker.apply($(this), tmp_args);
			});
		},

		/*
		* extend timepicker to datepicker
		*/
		datetimepicker: function(o) {
			o = o || {};
			var tmp_args = arguments;

			if (typeof(o) == 'string') {
				if (o == 'getDate') {
					return $.fn.datepicker.apply($(this[0]), tmp_args);
				} else {
					return this.each(function() {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args);
					});
				}
			} else {
				return this.each(function() {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults);
				});
			}
		}
	});

	/*
	* Public Utility to parse date and time
	*/
	$.datepicker.parseDateTime = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec);
		}

		return parseRes.date;
	};

	/*
	* Public utility to parse time
	*/
	$.datepicker.parseTime = function(timeFormat, timeString, options) {		
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g,'').indexOf('Z') !== -1);

		// Strict parse requires the timeString to match the timeFormat exactly
		var strictParse = function(f, s, o){

			// pattern for standard and localized AM/PM markers
			var getPatternAmpm = function(amNames, pmNames) {
				var markers = [];
				if (amNames) {
					$.merge(markers, amNames);
				}
				if (pmNames) {
					$.merge(markers, pmNames);
				}
				markers = $.map(markers, function(val) {
					return val.replace(/[.*+?|()\[\]{}\\]/g, '\\$&amp;amp;');
				});
				return '(' + markers.join('|') + ')?';
			};

			// figure out position of time elements.. cause js cant do named captures
			var getFormatPositions = function(timeFormat) {
				var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
					orders = {
						h: -1,
						m: -1,
						s: -1,
						l: -1,
						c: -1,
						t: -1,
						z: -1
					};

				if (finds) {
					for (var i = 0; i &amp;lt; finds.length; i++) {
						if (orders[finds[i].toString().charAt(0)] == -1) {
							orders[finds[i].toString().charAt(0)] = i + 1;
						}
					}
				}
				return orders;
			};

			var regstr = '^' + f.toString()
					.replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
							var ml = match.length;
							switch (match.charAt(0).toLowerCase()) {
								case 'h': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'm': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 's': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'l': return '(\\d?\\d?\\d)';
								case 'c': return '(\\d?\\d?\\d)';
								case 'z': return '(z|[-+]\\d\\d:?\\d\\d|\\S+)?';
								case 't': return getPatternAmpm(o.amNames, o.pmNames);
								default:    // literal escaped in quotes
									return '(' + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function (m) { return "\\" + m; }) + ')?';
							}
						})
					.replace(/\s/g, '\\s?') +
					o.timeSuffix + '$',
				order = getFormatPositions(f),
				ampm = '',
				treg;

			treg = s.match(new RegExp(regstr, 'i'));

			var resTime = {
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0
			};

			if (treg) {
				if (order.t !== -1) {
					if (treg[order.t] === undefined || treg[order.t].length === 0) {
						ampm = '';
						resTime.ampm = '';
					} else {
						ampm = $.inArray(treg[order.t].toUpperCase(), o.amNames) !== -1 ? 'AM' : 'PM';
						resTime.ampm = o[ampm == 'AM' ? 'amNames' : 'pmNames'][0];
					}
				}

				if (order.h !== -1) {
					if (ampm == 'AM' &amp;amp;&amp;amp; treg[order.h] == '12') {
						resTime.hour = 0; // 12am = 0 hour
					} else {
						if (ampm == 'PM' &amp;amp;&amp;amp; treg[order.h] != '12') {
							resTime.hour = parseInt(treg[order.h], 10) + 12; // 12pm = 12 hour, any other pm = hour + 12
						} else {
							resTime.hour = Number(treg[order.h]);
						}
					}
				}

				if (order.m !== -1) {
					resTime.minute = Number(treg[order.m]);
				}
				if (order.s !== -1) {
					resTime.second = Number(treg[order.s]);
				}
				if (order.l !== -1) {
					resTime.millisec = Number(treg[order.l]);
				}
				if (order.c !== -1) {
					resTime.microsec = Number(treg[order.c]);
				}
				if (order.z !== -1 &amp;amp;&amp;amp; treg[order.z] !== undefined) {
					resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z]);
				}


				return resTime;
			}
			return false;
		};// end strictParse

		// First try JS Date, if that fails, use strictParse
		var looseParse = function(f,s,o){
			try{
				var d = new Date('2012-01-01 '+ s);
				if(isNaN(d.getTime())){
					d = new Date('2012-01-01T'+ s);
					if(isNaN(d.getTime())){
						d = new Date('01/01/2012 '+ s);
						if(isNaN(d.getTime())){
							throw "Unable to parse time with native Date: "+ s;
						}
					}
				}

				return {
					hour: d.getHours(),
					minute: d.getMinutes(),
					second: d.getSeconds(),
					millisec: d.getMilliseconds(),
					microsec: d.getMicroseconds(),
					timezone: d.getTimezoneOffset()*-1
				};
			}
			catch(err){
				try{
					return strictParse(f,s,o);
				}
				catch(err2){
					$.timepicker.log("Unable to parse \ntimeString: "+ s +"\ntimeFormat: "+ f);
				}				
			}
			return false;
		}; // end looseParse
		
		if(typeof o.parse === "function"){
			return o.parse(timeFormat, timeString, o);
		}
		if(o.parse === 'loose'){
			return looseParse(timeFormat, timeString, o);
		}
		return strictParse(timeFormat, timeString, o);
	};

	/*
	* Public utility to format the time
	* format = string format of the time
	* time = a {}, not a Date() for timezones
	* options = essentially the regional[].. amNames, pmNames, ampm
	*/
	$.datepicker.formatTime = function(format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			timezone: 0
		}, time);

		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);

		if (hour &amp;gt; 11) {
			ampmName = options.pmNames[0];
		}

		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|('.*?'|".*?"))/g, function(match) {
		switch (match) {
			case 'HH':
				return ('0' + hour).slice(-2);
			case 'H':
				return hour;
			case 'hh':
				return ('0' + convert24to12(hour)).slice(-2);
			case 'h':
				return convert24to12(hour);
			case 'mm':
				return ('0' + time.minute).slice(-2);
			case 'm':
				return time.minute;
			case 'ss':
				return ('0' + time.second).slice(-2);
			case 's':
				return time.second;
			case 'l':
				return ('00' + time.millisec).slice(-3);
			case 'c':
				return ('00' + time.microsec).slice(-3);
			case 'z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, false);
			case 'Z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, true);
			case 'T': 
				return ampmName.charAt(0).toUpperCase();
			case 'TT': 
				return ampmName.toUpperCase();
			case 't':
				return ampmName.charAt(0).toLowerCase();
			case 'tt':
				return ampmName.toLowerCase();
			default:
				return match.replace(/\'/g, "") || "'";
			}
		});

		tmptime = $.trim(tmptime);
		return tmptime;
	};

	/*
	* the bad hack :/ override datepicker so it doesnt close on select
	// inspired: http://stackoverflow.com/questions/1252512/jquery-datepicker-prevent-closing-picker-when-clicking-a-date/1762378#1762378
	*/
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function(id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			tp_inst._limitMinMaxDateTime(inst, true);
			inst.inline = inst.stay_open = true;
			//This way the onSelect handler called from calendarpicker get the full dateTime
			this._base_selectDate(id, dateStr);
			inst.inline = inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst);
		} else {
			this._base_selectDate(id, dateStr);
		}
	};

	/*
	* second bad hack :/ override datepicker so it triggers an event when changing the input field
	* and does not redraw the datepicker on every selectDate event
	*/
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function(inst) {

		// don't popup the datepicker if there is another instance already opened
		var input = inst.input[0];
		if ($.datepicker._curInst &amp;amp;&amp;amp; $.datepicker._curInst != inst &amp;amp;&amp;amp; $.datepicker._datepickerShowing &amp;amp;&amp;amp; $.datepicker._lastInput != input) {
			return;
		}

		if (typeof(inst.stay_open) !== 'boolean' || inst.stay_open === false) {

			this._base_updateDatepicker(inst);

			// Reload the time control when changing something in the input text field.
			var tp_inst = this._get(inst, 'timepicker');
			if (tp_inst) {
				tp_inst._addTimePicker(inst);
			}
		}
	};

	/*
	* third bad hack :/ override datepicker so it allows spaces and colon in the input field
	*/
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if ($.datepicker._get(inst, 'constrainInput')) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null? tp_inst._defaults.showTimezone : tp_inst.support.timezone,					
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat')),
					datetimeChars = tp_inst._defaults.timeFormat.toString()
											.replace(/[hms]/g, '')
											.replace(/TT/g, ampm ? 'APM' : '')
											.replace(/Tt/g, ampm ? 'AaPpMm' : '')
											.replace(/tT/g, ampm ? 'AaPpMm' : '')
											.replace(/T/g, ampm ? 'AP' : '')
											.replace(/tt/g, ampm ? 'apm' : '')
											.replace(/t/g, ampm ? 'ap' : '') + 
											" " + tp_inst._defaults.separator + 
											tp_inst._defaults.timeSuffix + 
											(tz ? tp_inst._defaults.timezoneList.join('') : '') + 
											(tp_inst._defaults.amNames.join('')) + (tp_inst._defaults.pmNames.join('')) + 
											dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr &amp;lt; ' ' || !dateChars || datetimeChars.indexOf(chr) &amp;gt; -1);
			}
		}

		return $.datepicker._base_doKeyPress(event);
	};

	/*
	* Fourth bad hack :/ override _updateAlternate function used in inline mode to init altField
	*/
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	/* Update any alternate field to synchronise with the main field. */
	$.datepicker._updateAlternate = function(inst) {
		var tp_inst = this._get(inst, 'timepicker');
		if(tp_inst){
			var altField = tp_inst._defaults.altField;
			if (altField) { // update alternate field too
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = '', 
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator, 
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if(!tp_inst._defaults.timeOnly &amp;amp;&amp;amp; !tp_inst._defaults.altFieldTimeOnly &amp;amp;&amp;amp; date !== null){
					if(tp_inst._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime;
					}
					else{
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime;
					}
				}
				$(altField).val(altFormattedDateTime);
			}
		}
		else{
			$.datepicker._base_updateAlternate(inst);
		}
	};

	/*
	* Override key up event to sync manual input changes.
	*/
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst);
				} catch (err) {
					$.timepicker.log(err);
				}
			}
		}

		return $.datepicker._base_doKeyUp(event);
	};

	/*
	* override "Today" button to also grab the time.
	*/
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function(id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		this._base_gotoToday(id);
		var tp_inst = this._get(inst, 'timepicker');
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		$('.ui-datepicker-today', $dp).click();
	};

	/*
	* Disable &amp;amp; enable the Time in the datetimepicker
	*/
	$.datepicker._disableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst);
		}
	};

	$.datepicker._enableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst); // Could be disabled on page load
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create our own set time function
	*/
	$.datepicker._setTime = function(inst, date) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var defaults = tp_inst._defaults;

			// calling _setTime with no date sets time to defaults
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;

			//check if within min/max times.. 
			tp_inst._limitMinMaxDateTime(inst, true);

			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create new public method to set only time, callable as $().datepicker('setTime', date)
	*/
	$.datepicker._setTimeDatepicker = function(target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date == "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec);
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds());
				}
				if (tp_date.toString() == 'Invalid Date') {
					tp_date = undefined;
				}
				this._setTime(inst, tp_date);
			}
		}

	};

	/*
	* override setDate() to allow setting time too within Date object
	*/
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function(target, date) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		if(typeof(date) === 'string'){
			date = new Date(date);
			if(!date.getTime()){
				$.timepicker.log("Error creating Date object from string.");
			}
		}

		var tp_inst = this._get(inst, 'timepicker');
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds());
		} else {
			tp_date = date;
		}
		
		// This is important if you are using the timezone option, javascript's Date 
		// object will only return the timezone offset for the current locale, so we 
		// adjust it accordingly.  If not using timezone option this won't matter..
		// If a timezone is different in tp, keep the timezone as is
		if(tp_inst){
			// look out for DST if tz wasn't specified
			if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
				tp_inst.timezone = tp_date.getTimezoneOffset()*-1;
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone);
		}

		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true);
	};

	/*
	* override getDate() to allow getting time too within Date object
	*/
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function(target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			// if it hasn't yet been defined, grab from field
			if(inst.lastVal === undefined){
				this._setDateFromField(inst, noDefault);
			}

			var date = this._getDate(inst);
			if (date &amp;amp;&amp;amp; tp_inst._parseTime($(target).val(), tp_inst.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);

				// This is important if you are using the timezone option, javascript's Date 
				// object will only return the timezone offset for the current locale, so we 
				// adjust it accordingly.  If not using timezone option this won't matter..
				if(tp_inst.timezone != null){
					// look out for DST if tz wasn't specified
					if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
						tp_inst.timezone = date.getTimezoneOffset()*-1;
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
				}
			}
			return date;
		}
		return this._base_getDateDatepicker(target, noDefault);
	};

	/*
	* override parseDate() because UI 1.8.14 throws an error about "Extra characters"
	* An option in datapicker to ignore extra format characters would be nicer.
	*/
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function(format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings);
		} catch (err) {
			// Hack!  The error message ends with a colon, a space, and
			// the "extra" characters.  We rely on that instead of
			// attempting to perfectly reproduce the parsing algorithm.
			if (err.indexOf(":") &amp;gt;= 0) {
				date = this._base_parseDate(format, value.substring(0,value.length-(err.length-err.indexOf(':')-2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format);
			} else {
				throw err;
			}
		}
		return date;
	};

	/*
	* override formatDate to set date with time to the input
	*/
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function(inst, day, month, year) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val();
		}
		return this._base_formatDate(inst);
	};

	/*
	* override options setter to add time to maxDate(Time) and minDate(Time). MaxDate
	*/
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function(target, name, value) {
		var inst = this._getInst(target),
	        name_clone;
		if (!inst) {
			return null;
		}

		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop;
		    if (typeof name == 'string') { // if min/max was set with the string
		        if (name === 'minDate' || name === 'minDateTime') {
		            min = value;
		        } else if (name === 'maxDate' || name === 'maxDateTime') {
		            max = value;
		        } else if (name === 'onSelect') {
		            onselect = value;
		        } else if (overrides.hasOwnProperty(name)) {
		            if (typeof (value) === 'undefined') {
		                return overrides[name];
		            }
		            fns[name] = value;
		            name_clone = {}; //empty results in exiting function after overrides updated
		        }
		    } else if (typeof name == 'object') { //if min/max was set with the JSON
		        if (name.minDate) {
		            min = name.minDate;
		        } else if (name.minDateTime) {
		            min = name.minDateTime;
		        } else if (name.maxDate) {
		            max = name.maxDate;
		        } else if (name.maxDateTime) {
		            max = name.maxDateTime;
		        }
		        for (prop in overrides) {
		            if (overrides.hasOwnProperty(prop) &amp;amp;&amp;amp; name[prop]) {
		                fns[prop] = name[prop];
		            }
		        }
		    }
		    for (prop in fns) {
		        if (fns.hasOwnProperty(prop)) {
		            overrides[prop] = fns[prop];
		            if (!name_clone) { name_clone = $.extend({}, name);}
		            delete name_clone[prop];
		        }
		    }
		    if (name_clone &amp;amp;&amp;amp; isEmptyObject(name_clone)) { return; }
		    if (min) { //if min was set
		        if (min === 0) {
		            min = new Date();
		        } else {
		            min = new Date(min);
		        }
		        tp_inst._defaults.minDate = min;
		        tp_inst._defaults.minDateTime = min;
		    } else if (max) { //if max was set
		        if (max === 0) {
		            max = new Date();
		        } else {
		            max = new Date(max);
		        }
		        tp_inst._defaults.maxDate = max;
		        tp_inst._defaults.maxDateTime = max;
		    } else if (onselect) {
		        tp_inst._defaults.onSelect = onselect;
		    }
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name);
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
	};
	
	/*
	* jQuery isEmptyObject does not check hasOwnProperty - if someone has added to the object prototype,
	* it will return false for all objects
	*/
	var isEmptyObject = function(obj) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(obj)) {
				return false;
			}
		}
		return true;
	};

	/*
	* jQuery extend now ignores nulls!
	*/
	var extendRemove = function(target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] === null || props[name] === undefined) {
				target[name] = props[name];
			}
		}
		return target;
	};

	/*
	* Determine by the time format which units are supported
	* Returns an object of booleans for each unit
	*/
	var detectSupport = function(timeFormat){
		var tf = timeFormat.replace(/\'.*?\'/g,'').toLowerCase(), // removes literals
			isIn = function(f, t){ // does the format contain the token?
					return f.indexOf(t) !== -1? true:false; 
				};
		return {
				hour: isIn(tf,'h'),
				minute: isIn(tf,'m'),
				second: isIn(tf,'s'),
				millisec: isIn(tf,'l'),
				microsec: isIn(tf,'c'),
				timezone: isIn(tf,'z'),
				ampm: isIn(tf,'t') &amp;amp;&amp;amp; isIn(timeFormat,'h'),
				iso8601: isIn(timeFormat, 'Z')
			};
	};

	/*
	* Converts 24 hour format into 12 hour
	* Returns 12 hour without leading 0
	*/
	var convert24to12 = function(hour) {
		if (hour &amp;gt; 12) {
			hour = hour - 12;
		}

		if (hour === 0) {
			hour = 12;
		}

		return String(hour);
	};

	/*
	* Splits datetime string into date ans time substrings.
	* Throws exception when date can't be parsed
	* Returns [dateString, timeString]
	*/
	var splitDateTime = function(dateFormat, dateTimeString, dateSettings, timeSettings) {
		try {
			// The idea is to get the number separator occurances in datetime and the time format requested (since time has 
			// fewer unknowns, mostly numbers and am/pm). We will use the time pattern to split.
			var separator = timeSettings &amp;amp;&amp;amp; timeSettings.separator ? timeSettings.separator : $.timepicker._defaults.separator,
				format = timeSettings &amp;amp;&amp;amp; timeSettings.timeFormat ? timeSettings.timeFormat : $.timepicker._defaults.timeFormat,
				timeParts = format.split(separator), // how many occurances of separator may be in our format?
				timePartsLen = timeParts.length,
				allParts = dateTimeString.split(separator),
				allPartsLen = allParts.length;

			if (allPartsLen &amp;gt; 1) {
				return [
						allParts.splice(0,allPartsLen-timePartsLen).join(separator),
						allParts.splice(0,timePartsLen).join(separator)
					];
			}

		} catch (err) {
			$.timepicker.log('Could not split the date from the time. Please check the following datetimepicker options' +
					"\nthrown error: " + err +
					"\ndateTimeString" + dateTimeString +
					"\ndateFormat = " + dateFormat +
					"\nseparator = " + timeSettings.separator +
					"\ntimeFormat = " + timeSettings.timeFormat);

			if (err.indexOf(":") &amp;gt;= 0) {
				// Hack!  The error message ends with a colon, a space, and
				// the "extra" characters.  We rely on that instead of
				// attempting to perfectly reproduce the parsing algorithm.
				var dateStringLength = dateTimeString.length - (err.length - err.indexOf(':') - 2),
					timeString = dateTimeString.substring(dateStringLength);

				return [$.trim(dateTimeString.substring(0, dateStringLength)), $.trim(dateTimeString.substring(dateStringLength))];

			} else {
				throw err;
			}
		}
		return [dateTimeString, ''];
	};

	/*
	* Internal function to parse datetime interval
	* Returns: {date: Date, timeObj: Object}, where
	*   date - parsed date without time (type Date)
	*   timeObj = {hour: , minute: , second: , millisec: , microsec: } - parsed time. Optional
	*/
	var parseDateTimeInternal = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var date;
		var splitRes = splitDateTime(dateFormat, dateTimeString, dateSettings, timeSettings);
		date = $.datepicker._base_parseDate(dateFormat, splitRes[0], dateSettings);
		if (splitRes[1] !== '') {
			var timeString = splitRes[1],
				parsedTime = $.datepicker.parseTime(timeFormat, timeString, timeSettings);

			if (parsedTime === null) {
				throw 'Wrong time format';
			}
			return {
				date: date,
				timeObj: parsedTime
			};
		} else {
			return {
				date: date
			};
		}
	};

	/*
	* Internal function to set timezone_select to the local timezone
	*/
	var selectLocalTimezone = function(tp_inst, date) {
		if (tp_inst &amp;amp;&amp;amp; tp_inst.timezone_select) {
			var now = typeof date !== 'undefined' ? date : new Date();
			tp_inst.timezone_select.val(now.getTimezoneOffset()*-1);
		}
	};

	/*
	* Create a Singleton Insance
	*/
	$.timepicker = new Timepicker();

	/**
	 * Get the timezone offset as string from a date object (eg '+0530' for UTC+5.5)
	 * @@param  number if not a number this value is returned
	 * @@param boolean if true formats in accordance to iso8601 "+12:45"
	 * @@return string
	 */
	$.timepicker.timezoneOffsetString = function(tzMinutes, iso8601) {
		if(isNaN(tzMinutes) || tzMinutes &amp;gt; 840){
			return tzMinutes;
		}

		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601? ':':'',
			tz = (off &amp;gt;= 0 ? '+' : '-') + ('0' + (hours * 101).toString()).slice(-2) + iso + ('0' + (minutes * 101).toString()).slice(-2);
		
		if(tz == '+00:00'){
			return 'Z';
		}
		return tz;
	};

	/**
	 * Get the number in minutes that represents a timezone string
	 * @@param  string formated like "+0500", "-1245"
	 * @@return number
	 */
	$.timepicker.timezoneOffsetNumber = function(tzString) {
		tzString = tzString.toString().replace(':',''); // excuse any iso8601, end up with "+1245"

		if(tzString.toUpperCase() === 'Z'){ // if iso8601 with Z, its 0 minute offset
			return 0;
		}

		if(!/^(\-|\+)\d{4}$/.test(tzString)){ // possibly a user defined tz, so just give it back
			return tzString;
		}

		return ((tzString.substr(0,1) =='-'? -1 : 1) * // plus or minus
					((parseInt(tzString.substr(1,2),10)*60) + // hours (converted to minutes)
					parseInt(tzString.substr(3,2),10))); // minutes
	};

	/**
	 * No way to set timezone in js Date, so we must adjust the minutes to compensate. (think setDate, getDate)
	 * @@param  date
	 * @@param  string formated like "+0500", "-1245"
	 * @@return date
	 */
	$.timepicker.timezoneAdjust = function(date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if(!isNaN(toTz)){
			date.setMinutes(date.getMinutes()*1 + (date.getTimezoneOffset()*-1 - toTz*1) );
		}
		return date;
	};

	/**
	 * Calls `timepicker()` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * n.b. The input value must be correctly formatted (reformatting is not supported)
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the timepicker() call
	 * @@return jQuery
	 */
	$.timepicker.timeRange = function(startTime, endTime, options) {
		return $.timepicker.handleRange('timepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datetimepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@return jQuery
	 */
	$.timepicker.datetimeRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datetimepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.dateRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.handleRange = function(method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0, // min allowed interval in milliseconds
			maxInterval: 0, // max allowed interval in milliseconds
			start: {},      // options for start picker
			end: {}         // options for end picker
		}, options);

		$.fn[method].call(startTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), endTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), endTime, 'minDate');
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), startTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), startTime, 'maxDate');
			}
		}, options, options.end));

		checkDates(startTime, endTime);
		selected(startTime, endTime, 'minDate');
		selected(endTime, startTime, 'maxDate');

		function checkDates(changed, other) {
			var startdt = startTime[method]('getDate'),
				enddt = endTime[method]('getDate'),
				changeddt = changed[method]('getDate');

			if(startdt !== null){
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());

				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);

				if(options.minInterval &amp;gt; 0 &amp;amp;&amp;amp; minDate &amp;gt; enddt){ // minInterval check
					endTime[method]('setDate',minDate);
				}
				else if(options.maxInterval &amp;gt; 0 &amp;amp;&amp;amp; maxDate &amp;lt; enddt){ // max interval check
					endTime[method]('setDate',maxDate);
				}
				else if (startdt &amp;gt; enddt) {
					other[method]('setDate',changeddt);
				}
			}
		}

		function selected(changed, other, option) {
			if (!changed.val()) {
				return;
			}
			var date = changed[method].call(changed, 'getDate');
			if(date !== null &amp;amp;&amp;amp; options.minInterval &amp;gt; 0){
				if(option == 'minDate'){
					date.setMilliseconds(date.getMilliseconds() + options.minInterval); 
				}
				if(option == 'maxDate'){
					date.setMilliseconds(date.getMilliseconds() - options.minInterval);
				}
			}
			if (date.getTime) {
				other[method].call(other, 'option', option, date);
			}
		}
		return $([startTime.get(0), endTime.get(0)]);
	};

	/**
	 * Log error or data to the console during error or debugging
	 * @@param  Object err pass any type object to log to the console during error or debugging
	 * @@return void
	 */
	$.timepicker.log = function(err){
		if(window.console){
			console.log(err);
		}
	};

	/*
	* Microsecond support
	*/
	if(!Date.prototype.getMicroseconds){
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function(){ return this.microseconds; };
		Date.prototype.setMicroseconds = function(m){ 
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m/1000));
			this.microseconds = m%1000;
			return this;
		};
	}

	/*
	* Keep up with the version
	*/
	$.timepicker.version = "1.3.1";

})(jQuery);
jQuery.noConflict();
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;datetimepicker-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;e73a652e-09fc-4c71-8e7a-e2525a2d2a99&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
function replaceAllString(oriStr, strTarget, strSubString ){
   var strText = oriStr;
   var intIndexOfMatch = strText.indexOf( strTarget );
   while (intIndexOfMatch != -1){
      strText = strText.replace( strTarget, strSubString )
      intIndexOfMatch = strText.indexOf( strTarget );
   }
   return( strText );
}
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&amp;amp;]" + name + "=([^&amp;amp;#]*)"),
    results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
};


   var jobName= getParameterByName('job')
   var fromDate= getParameterByName('fromDate')
   var toDate= getParameterByName('toDate')
   var limit= getParameterByName('limit')
   var selectedIstIid = getParameterByName('IstIid')

  $("#jobname").ready(function(){
   $("#jobname").text(jobName)
   var convertedJobName = replaceAllString(jobName, ".", "_")
   $("#IstIid" + convertedJobName).ready(function(){
     $("#IstIid" + convertedJobName).css("display","block")
     $("#select_" + convertedJobName).ready(function(){
        $("#select_" + convertedJobName).val(selectedIstIid)
     });
   });
 });

  $("#fromDate").ready(function(){
   $("#from-date").val(fromDate)
 });

  $("#toDate").ready(function(){
   $("#to-date").val(toDate)
 });

  $("#limit").ready(function(){
   if(limit!=""){
    $("#limit").val(limit)
   }
 });
 // Get data with ajax
 function ajax_getData(jobName,fromDate,toDate,limit ){
       var convertedJobName = replaceAllString(jobName, ".", "_")
       var istIid = $("#select_" + convertedJobName).val()
       window.location="/xwiki/bin/view/WiperDog/WebHome?job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid="+istIid;
 			/*$.ajax({
			 type: "GET",
			 url:"/xwiki/bin/get/Sandbox/DescriptionForJob?outputSyntax=plain&amp;amp;job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid"+selectedIstIid,
			 success : function(result){
				$("#jobname").html(jobName)
				$("#display").text('[[]]' + result)
			 }
		   });*/
 }
	$("#treemenu2 a").click(function(){
		 var limit = 10
		 var fromDate=""
		 var toDate = ""
		 jobName= $(this).text()
                 $("#jobname").html(jobName)
                 var convertedJobName = replaceAllString(jobName, ".", "_")
                 $("#listIstIid &amp;gt; div").css("display","none")
                 $("#IstIid" + convertedJobName).css("display","block")
		 //ajax_getData(jobName,fromDate,toDate,limit )

	});

	$("#from-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
		dateFormat: 'yy-mm-dd',
	});
	$("#to-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
			dateFormat: 'yy-mm-dd',

	});
	 $("#get-data").on("click",function(){
		var fromDate = $("#from-date").val()
		var toDate =  $("#to-date").val()
		 if( toDate!= "" ){
			  if(fromDate != ""){
				  if($("#from-date").datepicker( "getDate" ) &amp;gt; $("#to-date").datepicker( "getDate" )){
				  alert("'From date' cannot start later than 'To date'")
				  return false
				  }
			  }
		 }
		 limit = $("#limit").val()
		 ajax_getData(jobName,fromDate,toDate,limit )
	});
$(document).ready(function(){
  var keys = $("#lstkey").text()
  //console.log('key == ' + keys);
  //console.log('livetableJson ==' + $("#livetableJson").text());
  
  var jsonObj = $.parseJSON($("#livetableJson").text()); 
  if(keys &amp;amp;&amp;amp; keys != '[ ]'){
    /** Subtyped **/    
    var newKeys = keys.replace('[',"");
    keys = newKeys.replace(']',"");
    var keyArr = (keys.indexOf(',') != -1)? keys.split(','):new Array(keys);
    //console.log('Key after replace: '+keys)       
    for(var i=0;i&amp;lt;keyArr.length;i++){
        var keyName = keyArr[i].trim().replace('',"").replace("\"","").replace('\"','');
        var subTypeJsonObjStr = jsonObj[keyName].replace('#livetablePager','#livetablePager_'+keyName)
        var subTypeJsonObj = $.parseJSON(subTypeJsonObjStr);
        $("#livetableList_"+keyName).jqGrid(subTypeJsonObj);
        $("#livetableList_"+keyName).jqGrid('navGrid', "#livetablePager_"+keyName, {
           edit : false,
           add : false,
           del : false,
           search:false
         });
    }
    
  }else{ /** Store**/        
      $("#livetableList").jqGrid(jsonObj);
      $("#livetableList").jqGrid('navGrid', "#livetablePager", {
           edit : false,
           add : false,
           del : false,
           search:false
           
       });
   }
});
        
jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;process&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;881686cc-1bfc-456e-b8ab-71334c4a45e5&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){

	$(function () {
		function drawLineChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerline' + container).highcharts({

				chart: {
					type:'line'
				},
				title: {
					text: chart_name
				},
				tooltip :{
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				xAxis: dataXAxis ,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				series: dataSeries
			});
		};

		function drawBarChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerbar' + container).highcharts({
				chart: {
					type: 'column'
				},
				title: {
					text: chart_name
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {

					column: {
						pointPadding: 0.2,
						borderWidth: 0
					}
				},
				series: dataSeries
			});
		}

		function drawAreaChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail
			$('#containerarea' + container).highcharts({
				chart: {
					type: 'area'
				},
				title: {
					text: chart_name
				},
				subtitle: {
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					},
					labels: {
						formatter: function() {
							return this.value / 1000;
						}
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {
					area: {
						stacking: 'normal',
						lineColor: '#666666',
						lineWidth: 1,
						marker: {
							lineWidth: 1,
							lineColor: '#666666'
						}
					}
				},
				series: dataSeries
			});
		};

		function drawPieChart(data, container, chartName){
			var dataPie = data
			$(document).ready(function () {
				// Build the chart
				$('#container' + container).highcharts({
					chart: {
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: chartName
					},
					tooltip: {
						pointFormat: '{series.name}: &amp;lt;b&amp;gt;{point.percentage:.1f}%&amp;lt;/b&amp;gt;'
					},
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							dataLabels: {
								enabled: true,
                                                                color: '#000000',
                                                                connectorColor: '#000000',
                                                                format: '&amp;lt;b&amp;gt;{point.name}&amp;lt;/b&amp;gt;: {point.percentage:.1f} %'
							},
							showInLegend: true
						}
					},
					series: dataPie
				});
			});
		}

		// LINE
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                     if(($("#jsons&amp;gt;#jsonline_" + finalKey)).length &amp;gt; 0) {
					var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonline_" + finalKey).val());
					var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerline_" + finalKey).val());
				        var lstContainer = [];
  				        var data_all = [];
                                        var chartSize = arrayAll.length

                                        for(var i=0;i&amp;lt;chartSize ;i++){
                                           data_all = arrayAll[i]
                                           lstContainer = arrayContainerAll[i]
				           if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					        // data to display on tooltip
					        var data_detail = data_all[0]
					        // draw Line chart
				        	for(var j=0;j&amp;lt;data_all.length;j++){
				        		if(data_all[j].series[0].name == null){
				        			data_all[j].series[0].name = lstContainer[j]
					        	}
                                                        chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					        	drawLineChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					        }
				         }
                                      }
                                  }
				}
			} else {
				var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonline").val());
				var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerline").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length

                                for(var i=0;i&amp;lt;chartSize ;i++){
                                   data_all = arrayAll[i]
                                   lstContainer = arrayContainerAll[i]
				   if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Line chart
					for(var j=0;j&amp;lt;data_all.length;j++){
						if(data_all[j].series[0].name == null){
							data_all[j].series[0].name = lstContainer[j]
						}
                                                chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
						drawLineChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
				   }
                                }
			}
		});

		// BAR
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
			             var finalKey = lstKey[eKey]
                                     if(($("#jsons&amp;gt;#jsonbar_" + finalKey)).length &amp;gt; 0) {
					var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonbar_" + finalKey).val());
					var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerbar_" + finalKey).val());
					var lstContainer = [];
					var data_all = [];
                                        var chartSize = arrayAll.length
					for(var i=0;i&amp;lt;chartSize ;i++){
					    data_all = arrayAll[i]
					    lstContainer = arrayContainerAll[i]
					    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw bar chart
						for(var j=0;j&amp;lt;data_all.length;j++){
							if(data_all[j].series[0].name == null){
								data_all[j].series[0].name = lstContainer[j]
							}
                                                        chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
							drawBarChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
						}
                                            }
					}
                                    }
				}
			} else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonbar").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerbar").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
				    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Bar chart
					for(var j=0;j&amp;lt;data_all.length;j++){
                                            if(data_all[j].series[0].name == null){
						data_all[j].series[0].name = lstContainer[j]
					    }
                                            chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					    drawBarChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
                                    }
				}
			}
		});

		// AREA
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
                        var arrayAll
                        var arrayContainerAll
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                        if(($("#jsons&amp;gt;#jsonarea_" + finalKey)).length &amp;gt; 0) {
                                           arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonarea_" + finalKey).val());
                                           arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerarea_" + finalKey).val());
					   var lstContainer = [];
					   var data_all = [];
                                           var chartSize = arrayAll.length
					   for(var i=0;i&amp;lt;chartSize ;i++){
					       data_all = arrayAll[i]
					       lstContainer = arrayContainerAll[i]
					       if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						   // data to display on tooltip
						   var data_detail = data_all[0]
						   // draw Line chart
						   for(var j=0;j&amp;lt;data_all.length;j++){
						      if(data_all[j].series[0].name == null){
						         data_all[j].series[0].name = lstContainer[j]
						       }
                                                       chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
						       drawAreaChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
						   }
					      }
				           }
                                        }
			          }
                        } else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonarea").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerarea").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
				    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw area chart
					for(var j=0;j&amp;lt;data_all.length;j++){
                                            if(data_all[j].series[0].name == null){
						data_all[j].series[0].name = lstContainer[j]
					    }
                                            chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					    drawAreaChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
                                    }
				}
			}
		});

		// PIE
		$(document ).ready(function(){
                        var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
                        var arrayAll
                        var arrayContainerAll
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                        if(($("#jsons&amp;gt;#jsonpie_" + finalKey)).length &amp;gt; 0) {
                                           arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonpie_" + finalKey).val());
                                           arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerpie_" + finalKey).val());
					   var lstContainer = [];
					   var data_all = [];
                                           var chartSize = arrayAll.length
					  for(var i=0;i&amp;lt;chartSize ;i++){
					       data_all = arrayAll[i]
console.log(data_all)
					       lstContainer = arrayContainerAll[i]
					       if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						   // draw Pie chart
						   for(var j=0;j&amp;lt;data_all.length;j++){
                                                       //chartName = data_all[j].chart_name
                                                       chartName  = data_all[j].name
						       drawPieChart(data_all, finalKey + "_" + lstContainer[j], chartName)
						   }
					      }
				           }
                                        }
			          }
			} else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonpie").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerpie").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
                                    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
                                                   for(var j=0;j&amp;lt;data_all.length;j++){
                                                       //chartName = data_all[j].chart_name
                                                       chartName  = data_all[j].name
console.log(finalKey + "_pie")
						       //drawPieChart(data_all, "_pie"], chartName)
						   }

                                    }
                                }
			}
		});
	});
	jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;d5873d92-b78b-42fc-9407-46d166204b88&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;/* css for timepicker */
.ui-timepicker-div .ui-widget-header { 
margin-bottom: 8px;
 }

.ui-timepicker-div dl { text-align: left; }
.ui-timepicker-div dl dt { height: 25px; margin-bottom: -25px; }
.ui-timepicker-div dl dd { margin: 0 10px 10px 65px; }
.ui-timepicker-div td { font-size: 90%; }
.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }

.ui-timepicker-rtl{ direction: rtl; }
.ui-timepicker-rtl dl { text-align: right; }
.ui-timepicker-rtl dl dd { margin: 0 65px 10px 10px; }
#ui-datepicker-div{
 position:relative;
 width:auto;
 height:auto
}
&lt;/code&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;datetimepicker -css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;1201fb1a-e9c1-4731-8c74-2ea8c0071959&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;.displayblock {
  border:2px solid;
  -webkit-border-radius:6px;
  background:gray;
  float: left;
  width:100%;
}

.displaypie {
  border:1px solid;
  -webkit-border-radius:6px;
  background:gray;
  width: 48%;
  float: left; 
  height: 300px;
}

.subtype {
  margin-top: 50px;
  font-size: 2em;
  color: red;
}&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;content&gt;{{include document="Lib.DataToDrawChart"/}}
{{include document="Lib.MongoDBConnection"/}}
{{velocity}}
$xwiki.jsx.use('Lib.JQueryUILib')
$xwiki.ssx.use('Lib.MenuGenerator')
$xwiki.jsx.use('Lib.MenuGenerator')
$xwiki.ssx.use('Lib.JQueryUILib')
$xwiki.jsx.use('Lib.JqGridLib')
$xwiki.ssx.use('Lib.JqGridLib') 
{{/velocity}}
{{include document="Lib.MenuGenerator"/}}
{{html wiki="true" clean="false"}}
&amp;lt;div id="viewer"&amp;gt;
&amp;lt;table style="text-align:left"  &amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th &amp;gt;Job name&amp;lt;/th&amp;gt;
  &amp;lt;td colspan=3&amp;gt;&amp;lt;div id="jobname"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
{{groovy}}
import org.xwiki.context.*

def ec = services.component.getInstance(Execution.class).getContext()
def mapJobIstIid = ec.getProperty("mapJobIstIid")

println '{{html clean="false" wiki="false"}}'
println '&amp;lt;tr&amp;gt;'
println '&amp;lt;th&amp;gt;IstIid&amp;lt;/th&amp;gt;'
println '&amp;lt;td colspan=3&amp;gt;'
mapJobIstIid.each{jobEntry-&amp;gt;
  def convertedJobKey = jobEntry.key.replaceAll("\\.","_")
  println "&amp;lt;div id='listIstIid'&amp;gt;"
  println "&amp;lt;div id=IstIid${convertedJobKey} style='display:none'&amp;gt;"
  println "&amp;lt;select id=select_${convertedJobKey}&amp;gt;"
  jobEntry.value.each{
     println "&amp;lt;option value=\"$it\"&amp;gt;$it&amp;lt;/option&amp;gt;"
  }
  println "&amp;lt;/select&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
}
println '&amp;lt;/td&amp;gt;'
println '&amp;lt;/tr&amp;gt;'
println '{{/html}}'
{{/groovy}}
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data monitor from&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="from-date" id="from-date"/&amp;gt;&amp;lt;/td&amp;gt;
  &amp;lt;th&amp;gt;Data monitor to&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="to-date" id="to-date"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data records limit &amp;lt;/th&amp;gt;
  &amp;lt;td &amp;gt;
     &amp;lt;select id="limit"&amp;gt;
       &amp;lt;option value=5&amp;gt;5&amp;lt;/option&amp;gt;
       &amp;lt;option value=10&amp;gt;10&amp;lt;/option&amp;gt;
       &amp;lt;option value=15&amp;gt;15&amp;lt;/option&amp;gt;
       &amp;lt;option value=20&amp;gt;20&amp;lt;/option&amp;gt;
     &amp;lt;/select&amp;gt;
  &amp;lt;/td&amp;gt;
  &amp;lt;td colspan=3 &amp;gt;&amp;lt;input type="button" value="View Data" id="get-data" class="button"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;&amp;lt;div id="display"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
  &amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
&amp;lt;/table&amp;gt;

&amp;lt;/div&amp;gt; 
   
 &amp;lt;/body&amp;gt;

{{/html}}
{{groovy}}
import groovy.json.*
xwiki.jsx.use("Lib.Highcharts")

if(request.xpage == "plain") {
	response.setContentType('text/plain')
}

def listData = []
def job = request.get("job")
def fromDate = request.get("fromDate")
def toDate = request.get("toDate")
def limit= (request.get("limit")!=null)?request.get("limit").toInteger():10
def istIid = request.get("IstIid")

def str= "No data to retrieved !"
def result = null
if(job != "" &amp;amp;&amp;amp; job != null &amp;amp;&amp;amp; istIid != null &amp;amp;&amp;amp; istIid != ""){
	MongoDBConnection.getConnection()
	if(fromDate != "" || toDate != ""){
		result = MongoDBConnection.getDataInPeriod(job,fromDate,toDate,limit,istIid)
	} else {
		result = MongoDBConnection.getDataAllFields(job,limit,istIid)
        }
MongoDBConnection.closeConnection()
} else {
   println "{{warning}}There are no selected job or IstIid{{/warning}}"
}
def listKey = []
if( (result != null) &amp;amp;&amp;amp; (result.size() &amp;gt; 0) &amp;amp;&amp;amp; (result[0].KEYEXPR != null)&amp;amp;&amp;amp;!(result[0].KEYEXPR instanceof List )){

if(result[0].type == "Subtyped") {
    println '{{html clean="false" wiki="true"}}'
    //println '&amp;lt;body&amp;gt;'
    def dataSubtype = DataToDrawChart.getDataToDrawSubtype(result)
    dataSubtype.each {key,value -&amp;gt;
        listKey.add(key)
    }
    def jsonkey = com.mongodb.util.JSON.serialize(listKey)
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$jsonkey&amp;lt;/textarea&amp;gt;"

    dataSubtype.each {key,value -&amp;gt;
            def dataLine = []
            def dataBar = []
            def dataPie = []
            def dataArea = []
            if(DataToDrawChart.getDataToDrawLine(value) != []) {
                dataLine = DataToDrawChart.getDataToDrawLine(value)
            }
            if(DataToDrawChart.getDataToDrawBar(value) != []) {
                dataBar = DataToDrawChart.getDataToDrawBar(value)
            }
            if(DataToDrawChart.getDataToDrawPie(value) != []) {
                dataPie = DataToDrawChart.getDataToDrawPie(value)
            }
            if(DataToDrawChart.getDataToDrawArea(value) != []) {
                dataArea = DataToDrawChart.getDataToDrawArea(value)
            }

		def chartColumnsLine = []
		def chartColumnsBar = []
		def chartColumnsArea = []
		def lstName

                dataLine.each {itemDataLine -&amp;gt;
                    if(itemDataLine.size() &amp;gt; 0 ){
		        chartColumnsLine.add(itemDataLine[0].chart_columns)
	            }
                }
                dataBar.each {itemDataBar -&amp;gt;
                    if(itemDataBar.size() &amp;gt; 0 ){
		        chartColumnsBar.add(itemDataBar[0].chart_columns)
	            }
                }
                dataArea.each {itemDataArea -&amp;gt;
                    if(itemDataArea.size() &amp;gt; 0 ){
		        chartColumnsArea.add(itemDataArea[0].chart_columns)
	            }
                }
println "dataPie" + dataPie
		if(dataPie.size() &amp;gt; 0 ){
			lstName = dataPie['name']
		}
		def tmpListNameContainer = []
                
		if(lstName != null) {
                        def chartNumPie = 0
                        def tmpLst
                        for(def nameContainer in lstName){
                           tmpLst = []
			   for(def nameContainerItem in nameContainer ){
                                println "nameContainerItem :" + nameContainerItem 
				nameContainerItem = chartNumPie + "_" + nameContainerItem.replaceAll("\\.", "_")
                                //nameContainerItem = nameContainerItem.replaceAll("\\.", "_")
				tmpLst.add(nameContainerItem )
		            }
                            tmpListNameContainer.add(tmpLst)
                            chartNumPie++
                         }
		}
		def jsonPie
		def jsonLine
		def jsonBar
		def jsonArea
		if(dataPie != []) {
		    jsonPie = com.mongodb.util.JSON.serialize(dataPie)
		}
		if(dataLine != []) {
		    jsonLine = com.mongodb.util.JSON.serialize(dataLine)
		}
		if(dataBar != []) {
		    jsonBar = com.mongodb.util.JSON.serialize(dataBar)
		}
		if(dataArea != []) {
		    jsonArea = com.mongodb.util.JSON.serialize(dataArea)
		}
		def jsonContainerPie
		if(tmpListNameContainer != []) {
			jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
		}
		def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
		def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
		def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

		println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
		if(jsonLine != null) {
			println "&amp;lt;textarea id=\"jsonline_$key\" &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class=\"lstcontainerline_$key\" &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
		}
		if(jsonBar != null) {
			println "&amp;lt;textarea id=\"jsonbar_$key\"&amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerbar_$key' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
		}
		if(jsonPie != null &amp;amp;&amp;amp; jsonContainerPie != null) {
			println "&amp;lt;textarea id=\"jsonpie_$key\" &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerpie_$key' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
		}
		if(jsonArea != null) {
			println "&amp;lt;textarea id=\"jsonarea_$key\" &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerarea_$key' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
		}

        println "&amp;lt;/div&amp;gt;"
          println "jsonPie" + jsonPie
          println "jsonContainerPie " + jsonContainerPie 
        def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
        def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
          
        println "&amp;lt;div style='clear:both'&amp;gt;"
            def description = value.KEYEXPR._description[0][key]
            if(description != null) {
                println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +': ' + description +'&amp;lt;/div&amp;gt;'
            } else {
                println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +'&amp;lt;/div&amp;gt;'
            }
            println "-----"
            if(jsonPie != null) {
          println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
		chartNumPie = 0
          lstName.each{chartPieLst -&amp;gt;
		chartPieLst.each {
println "container${key}_${tmp}"
	            //def tmp = chartNumPie + "_" + it.replaceAll("\\.", "_")
		   // println " &amp;lt;div class=\"displaypie\" id=\"container${key}_${tmp}\" &amp;gt;&amp;lt;/div&amp;gt;"
          	}
		chartNumPie++
	  }	
          println "&amp;lt;/div&amp;gt;"
            }
            if(jsonLine != null) {
          	def chartLineComment = false
		def chartNumLine = 0
          	chartColumnsLine.each{chartColumnsLineItem -&amp;gt;
            		if(!chartLineComment){
               			println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
               			chartLineComment = true  
            		}
		chartColumnsLineItem.each{
              		println " &amp;lt;div class=\"displayblock\" id=\"containerline${key}_${chartNumLine}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          	}
		chartNumLine ++
	    }
          println "&amp;lt;/div&amp;gt;"
            }
            println "&amp;amp;nbsp;"

            if(jsonBar != null) {
          	def chartBarComment = false
  		def chartNumBar = 0
          	chartColumnsBar.each{chartColumnsBarItem -&amp;gt;
             		if(!chartBarComment){
                		println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
                		chartBarComment = true
              		}  
			chartColumnsBarItem.each{
             			println " &amp;lt;div class=\"displayblock\" id=\"containerbar${key}_${chartNumBar}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          		}
			chartNumBar++
		}
          	println "&amp;lt;/div&amp;gt;"
            }
            println "&amp;amp;nbsp;"

            if(jsonArea != null) {
          	def chartAreaComment = false
		def chartNumArea = 0
          	chartColumnsArea.each{chartColumnsAreaItem -&amp;gt;
          		if(!chartAreaComment){
            			println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
            			chartAreaComment = true
          		}
			chartColumnsAreaItem.each{
            			println " &amp;lt;div class=\"displayblock\" id=\"containerarea${key}_${chartNumArea}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          		}
          		chartNumArea++
            	}
        	println "&amp;lt;/div&amp;gt;"
	    }
        /** Statistic data table **/
        println "&amp;lt;center&amp;gt;"        
        println "&amp;lt;div id='livetblContent_"+key+"' style='width:100%;clear:both;align:middle;margin-top:10px'&amp;gt;"   
        println "Statistics data for "+key
        println "&amp;lt;table id='livetableList_"+key+"' style='width:100%;align:center'&amp;gt;&amp;lt;/table&amp;gt;"
        println "&amp;lt;div id='livetablePager_"+key+"' style='position:relative;width:100%'&amp;gt;&amp;lt;/div&amp;gt;"
        println "&amp;lt;/div&amp;gt;"
        println "&amp;lt;/center&amp;gt;"
        println "&amp;lt;script language='javascript'&amp;gt;console.log('Create live table for "+key+"');&amp;lt;/script&amp;gt;"
    }
    //println '&amp;lt;/body&amp;gt;'
    println '{{/html}}'
} else if(result[0].type == "Store") {
	// data store
	def dataLine = DataToDrawChart.getDataToDrawLine(result)
	def dataBar = DataToDrawChart.getDataToDrawBar(result)
	def dataPie = DataToDrawChart.getDataToDrawPie(result)
	def dataArea = DataToDrawChart.getDataToDrawArea(result)
	def chartColumnsLine = []
	def chartColumnsBar = []
	def chartColumnsArea = []
	def lstName

        dataLine.each {itemDataLine -&amp;gt;
            if(itemDataLine.size() &amp;gt; 0 ){
		chartColumnsLine.add(itemDataLine[0].chart_columns)
	    }
        }

        dataBar.each {itemDataBar -&amp;gt;
            if(itemDataBar.size() &amp;gt; 0 ){
		chartColumnsBar.add(itemDataBar[0].chart_columns)
	    }
        }

        dataArea.each {itemDataArea -&amp;gt;
            if(itemDataArea.size() &amp;gt; 0 ){
		chartColumnsArea.add(itemDataArea[0].chart_columns)
	    }
        }

	if(dataPie.size() &amp;gt; 0 ){
		lstName = dataPie['name']
	}

    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
  
    def tmpListNameContainer = []
    def chartNumPie = 0
    for(def nameContainer in lstName){
       for(def nameContainerItem in nameContainer ){
           nameContainerItem = chartNumPie + "_" + nameContainerItem.replaceAll("\\.", "_")
           tmpListNameContainer .add(nameContainerItem )
       }
    }
    
    def jsonPie = com.mongodb.util.JSON.serialize(dataPie)
    def jsonLine = com.mongodb.util.JSON.serialize(dataLine)
    def jsonBar = com.mongodb.util.JSON.serialize(dataBar)
    def jsonArea = com.mongodb.util.JSON.serialize(dataArea)

    def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
    def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
    def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
    def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

    def listEmpty = com.mongodb.util.JSON.serialize([])
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$listEmpty&amp;lt;/textarea&amp;gt;" 

    println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
    println "&amp;lt;textarea class='jsonline' &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonbar' &amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonpie' &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonarea' &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"

    println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;/div&amp;gt;"

    def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
    def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
  
    println "&amp;lt;div style='clear:both'&amp;gt;"
  
    def chartPieComment = false
    chartNumPie = 0
    lstName.each{chartPieLst-&amp;gt;
        if(!chartPieComment) {
            println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
            chartPieComment = true
        }
        chartPieLst.each {
            def tmp = chartNumPie + "_pie"
            println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
        }
    }
    println "&amp;lt;/div&amp;gt;"
    	def chartLineComment = false
	def chartNum = 0
    	chartColumnsLine.each{chartColumnsLineItem -&amp;gt;
	    	if(!chartLineComment){
	        	println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	        	chartLineComment = true  
	    	}
		chartColumnsLineItem.each{
	    		println " &amp;lt;div class=\"displayblock\" id=\"containerline${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	    	}
		chartNum++
	}	
    	println "&amp;lt;/div&amp;gt;"
    	println "&amp;amp;nbsp;"
    	def chartBarComment = false
	chartNum = 0
    	chartColumnsBar.each{chartColumnsBarItem -&amp;gt;
	        if(!chartBarComment){
	            println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	            chartBarComment = true
	        }  
		chartColumnsBarItem.each{
	    		println " &amp;lt;div class=\"displayblock\" id=\"containerbar${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  	}
		chartNum++
	}
  println "&amp;lt;/div&amp;gt;"
  println "&amp;amp;nbsp;"
  	def chartAreaComment = false
	chartNum = 0
  	chartColumnsArea.each{chartColumnsAreaItem -&amp;gt;
	  	if(!chartAreaComment){
	    		println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	    		chartAreaComment = true
	  	}
		chartColumnsAreaItem.each{
    			println " &amp;lt;div class=\"displayblock\" id=\"containerarea${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
		}
		chartNum++
  	}
  println "&amp;lt;/div&amp;gt;"
println "&amp;lt;/div&amp;gt;"

//println '&amp;lt;/body&amp;gt;'
println '{{/html}}'
}
}else{
    println 'There is no data for this job with criterias'
}
//--=============== Start build for livetable
def subTypeURLMap = [:]
def dataModel = []
def dataUrl = ""
result.find{rec-&amp;gt;				
    def subtractData = []
    
    //-- Parsing data and assign data to subtract list
    if(rec.type == "Store"){ //-- Store data type
        subtractData = rec['data']        
        subtractData.each{r2-&amp;gt;					
            if(dataModel != null &amp;amp;&amp;amp; dataModel.size() &amp;lt;=0){ 
                dataModel.add("Fetch At")
                dataModel.addAll(r2.keySet());					
            } 
        }        
        dataUrl = "/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job="+job +"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate + "&amp;amp;toDate=" + toDate + "&amp;amp;istIid="+istIid        
        //-- Building data model				
        def model = []
        def colSpec
        dataModel.each{name-&amp;gt;
            colSpec = [:]
            colSpec['name'] = name
            colSpec['index'] = name
            colSpec['width'] = "100"
            model.add(colSpec)
        }
        def dataModelStr = (new JsonBuilder(dataModel)).toPrettyString()
        def modelStr = (new JsonBuilder(model)).toPrettyString() 
        str = 
        "{\"url\":\""+dataUrl+"\",\"datatype\":\"json\","+
            "\"colNames\":"+ dataModelStr +
            ",\"colModel\":"+ modelStr +" ,\"rowList\":[10,20,30],"+
            "\"pager\":\"#livetablePager\", \"viewrecords\": true, \"sortname\": \"RECORD_SEQ\","+
            "\"sortorder\": \"asc\", \"caption\":\""+job+"\"}"
        println "{{html clean=\"false\" wiki=\"true\"}}"
        println "&amp;lt;div id='livetableJson' style = \"display:none\"&amp;gt;"
        //println "&amp;lt;div id='livetableJson'&amp;gt;"
        println str;
        println "&amp;lt;/div&amp;gt;"
        println "{{/html}}"
    }else{ //-- Subtype			
        def subData = rec['data']
        subData.each{key,value-&amp;gt;
            dataUrl = "/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job="+job +"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate + "&amp;amp;toDate=" + toDate + "&amp;amp;istIid="+istIid+"&amp;amp;subType="+key
            subtractData = value
            subtractData.each{r2-&amp;gt;					
                if(dataModel != null &amp;amp;&amp;amp; dataModel.size() &amp;lt;=0){ 
                    dataModel.add("Fetch At")
                    dataModel.addAll(r2.keySet());					
                } 			
            }
            //-- Building data model				
            def model = []
            def colSpec
            dataModel.each{name-&amp;gt;
                colSpec = [:]
                colSpec['name'] = name
                colSpec['index'] = name
                colSpec['width'] = "100"
                model.add(colSpec)
            }
            def dataModelStr = (new JsonBuilder(dataModel)).toPrettyString()
            def modelStr = (new JsonBuilder(model)).toPrettyString() 
            str = 
            "{\"url\":\""+dataUrl+"\",\"datatype\":\"json\","+
                "\"colNames\":"+ dataModelStr +
                ",\"colModel\":"+ modelStr +" ,\"rowList\":[10,20,30],"+
                "\"pager\":\"#livetablePager\", \"viewrecords\": true, \"sortname\": \"RECORD_SEQ\","+
                "\"sortorder\": \"asc\", \"caption\":\""+job+"\"}"
            subTypeURLMap[key] = str
        }
        def finalStr = (new JsonBuilder(subTypeURLMap)).toPrettyString()
        println "{{html clean=\"false\" wiki=\"true\"}}"
        println "&amp;lt;div id='livetableJson' style = \"display:none\"&amp;gt;"
        //println "&amp;lt;div id='livetableJson'&amp;gt;"
        println finalStr;
        println "&amp;lt;/div&amp;gt;"
        println "{{/html}}"
    }
    return true
}
 //--=============== END

if(listKey.size() &amp;lt;= 0){   
    println "{{html clean=\"false\" wiki=\"true\"}}"
    println "&amp;lt;center&amp;gt;"
    println "&amp;lt;div id=\"livetblContent\" style=\"width:100%;clear:both;align:middle;margin-top:10px\"&amp;gt;"   
    println "Statistics Data"
    println "&amp;lt;table id=\"livetableList\" style=\"width:100%;align:center\"&amp;gt;&amp;lt;/table&amp;gt;"    
    println "&amp;lt;div id=\"livetablePager\"&amp;gt;&amp;lt;/div&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
    println "&amp;lt;/center&amp;gt;"
    
    println "&amp;lt;div id=\"testDiv\"&amp;gt;&amp;amp;nbsp;&amp;lt;/div&amp;gt;"
    println "{{/html}}"
}
{{/groovy}}
&lt;/content&gt;&lt;/xwikidoc&gt;@


61.27
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376558442000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;61.27&lt;/version&gt;
d2967 1
a2967 1
						       //drawPieChart(data_all, finalKey + "_pie"], chartName)
@


61.26
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376558416000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;61.26&lt;/version&gt;
@


61.25
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376558365000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;61.25&lt;/version&gt;
d2966 2
a2967 2
console.log(chartName  )
						       //drawPieChart(data_all, finalKey + "_" + lstContainer[j], chartName)
@


61.24
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376558303000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;61.24&lt;/version&gt;
d2966 2
a2967 1
						       drawPieChart(data_all, finalKey + "_" + lstContainer[j], chartName)
@


61.23
log
@@
text
@&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xwikidoc&gt;
&lt;web&gt;WiperDog&lt;/web&gt;
&lt;name&gt;WebHome&lt;/name&gt;
&lt;language&gt;&lt;/language&gt;
&lt;defaultLanguage&gt;en&lt;/defaultLanguage&gt;
&lt;translation&gt;0&lt;/translation&gt;
&lt;parent&gt;&lt;/parent&gt;
&lt;creator&gt;XWiki.Admin&lt;/creator&gt;
&lt;author&gt;XWiki.Admin&lt;/author&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;contentAuthor&gt;XWiki.Admin&lt;/contentAuthor&gt;
&lt;creationDate&gt;1376364375000&lt;/creationDate&gt;
&lt;date&gt;1376558092000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376558092000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.23&lt;/version&gt;
&lt;title&gt;WiperDog&lt;/title&gt;
&lt;defaultTemplate&gt;&lt;/defaultTemplate&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;comment&gt;&lt;/comment&gt;
&lt;minorEdit&gt;true&lt;/minorEdit&gt;
&lt;syntaxId&gt;xwiki/2.1&lt;/syntaxId&gt;
&lt;hidden&gt;false&lt;/hidden&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;047293a8-524d-45e4-af52-cd944523d5d0&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
/*
 * jQuery timepicker addon
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 1.3.1
 * Last Modified: 07/07/2013
 *
 * Copyright 2013 Trent Richardson
 * You may use this project under MIT or GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 */

/*jslint evil: true, white: false, undef: false, nomen: false */

(function($) {

	/*
	* Lets not redefine timepicker, Prevent "Uncaught RangeError: Maximum call stack size exceeded"
	*/
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return;
	}

	/*
	* Extend jQueryUI, get it started with our version number
	*/
	$.extend($.ui, {
		timepicker: {
			version: "1.3.1"
		}
	});

	/* 
	* Timepicker manager.
	* Use the singleton instance of this class, $.timepicker, to interact with the time picker.
	* Settings for (groups of) time pickers are maintained in an instance object,
	* allowing multiple different settings on the same page.
	*/
	var Timepicker = function() {
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[''] = { // Default regional settings
			currentText: 'Now',
			closeText: 'Done',
			amNames: ['AM', 'A'],
			pmNames: ['PM', 'P'],
			timeFormat: 'HH:mm',
			timeSuffix: '',
			timeOnlyTitle: 'Choose Time',
			timeText: 'Time',
			hourText: 'Hour',
			minuteText: 'Minute',
			secondText: 'Second',
			millisecText: 'Millisecond',
			microsecText: 'Microsecond',
			timezoneText: 'Time Zone',
			isRTL: false
		};
		this._defaults = { // Global defaults for all the datetime picker instances
			showButtonPanel: true,
			timeOnly: false,
			showHour: null,
			showMinute: null,
			showSecond: null,
			showMillisec: null,
			showMicrosec: null,
			showTimezone: null,
			showTime: true,
			stepHour: 1,
			stepMinute: 1,
			stepSecond: 1,
			stepMillisec: 1,
			stepMicrosec: 1,
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null,
			hourMin: 0,
			minuteMin: 0,
			secondMin: 0,
			millisecMin: 0,
			microsecMin: 0,
			hourMax: 23,
			minuteMax: 59,
			secondMax: 59,
			millisecMax: 999,
			microsecMax: 999,
			minDateTime: null,
			maxDateTime: null,
			onSelect: null,
			hourGrid: 0,
			minuteGrid: 0,
			secondGrid: 0,
			millisecGrid: 0,
			microsecGrid: 0,
			alwaysSetTime: true,
			separator: ' ',
			altFieldTimeOnly: true,
			altTimeFormat: null,
			altSeparator: null,
			altTimeSuffix: null,
			pickerTimeFormat: null,
			pickerTimeSuffix: null,
			showTimepicker: true,
			timezoneList: null,
			addSliderAccess: false,
			sliderAccessArgs: null,
			controlType: 'slider',
			defaultValue: null,
			parse: 'strict'
		};
		$.extend(this._defaults, this.regional['']);
	};

	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: '',
		formattedDate: '',
		formattedTime: '',
		formattedDateTime: '',
		timezoneList: null,
		units: ['hour','minute','second','millisec', 'microsec'],
		support: {},
		control: null,

		/* 
		* Override the default settings for all instances of the time picker.
		* @@param  settings  object - the new settings to use as defaults (anonymous object)
		* @@return the manager object
		*/
		setDefaults: function(settings) {
			extendRemove(this._defaults, settings || {});
			return this;
		},

		/*
		* Create a new Timepicker instance
		*/
		_newInst: function($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
            	fns = {},
		    	overrides, i;

			for (var attrName in this._defaults) {
				if(this._defaults.hasOwnProperty(attrName)){
					var attrValue = $input.attr('time:' + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue);
						} catch (err) {
							inlineSettings[attrName] = attrValue;
						}
					}
				}
			}

		    overrides = {
		        beforeShow: function (input, dp_inst) {
		            if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
		                return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst);
		            }
		        },
		        onChangeMonthYear: function (year, month, dp_inst) {
		            // Update the time as well : this prevents the time from disappearing from the $input field.
		            tp_inst._updateDateTime(dp_inst);
		            if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
		                tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst);
		            }
		        },
		        onClose: function (dateText, dp_inst) {
		            if (tp_inst.timeDefined === true &amp;amp;&amp;amp; $input.val() !== '') {
		                tp_inst._updateDateTime(dp_inst);
		            }
		            if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
		                tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst);
		            }
		        }
		    };
		    for (i in overrides) {
		        if (overrides.hasOwnProperty(i)) {
		            fns[i] = opts[i] || null;
		        }
		    }

		    tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
		        evnts:fns,
		        timepicker: tp_inst // add timepicker as a property of datepicker: $.datepicker._get(dp_inst, 'timepicker');
		    });
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function(val) {
				return val.toUpperCase();
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function(val) {
				return val.toUpperCase();
			});

			// detect which units are supported
			tp_inst.support = detectSupport(
					tp_inst._defaults.timeFormat + 
					(tp_inst._defaults.pickerTimeFormat? tp_inst._defaults.pickerTimeFormat:'') + 
					(tp_inst._defaults.altTimeFormat? tp_inst._defaults.altTimeFormat:''));

			// controlType is string - key to our this._controls
			if(typeof(tp_inst._defaults.controlType) === 'string'){
				if(tp_inst._defaults.controlType == 'slider' &amp;amp;&amp;amp; typeof(jQuery.ui.slider) === 'undefined'){
					tp_inst._defaults.controlType = 'select';
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType];
			}
			// controlType is an object and must implement create, options, value methods
			else{ 
				tp_inst.control = tp_inst._defaults.controlType;
			}

			// prep the timezone options
			var timezoneList = [-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,
					0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList;
			}
			var tzl=timezoneList.length,tzi=0,tzv=null;
			if (tzl &amp;gt; 0 &amp;amp;&amp;amp; typeof timezoneList[0] !== 'object') {
				for(; tzi&amp;lt;tzl; tzi++){
					tzv = timezoneList[tzi];
					timezoneList[tzi] = { value: tzv, label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601) };
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;

			// set the default units
			tp_inst.timezone = tp_inst._defaults.timezone !== null? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) : 
							((new Date()).getTimezoneOffset()*-1);
			tp_inst.hour = tp_inst._defaults.hour &amp;lt; tp_inst._defaults.hourMin? tp_inst._defaults.hourMin : 
							tp_inst._defaults.hour &amp;gt; tp_inst._defaults.hourMax? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute &amp;lt; tp_inst._defaults.minuteMin? tp_inst._defaults.minuteMin : 
							tp_inst._defaults.minute &amp;gt; tp_inst._defaults.minuteMax? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second &amp;lt; tp_inst._defaults.secondMin? tp_inst._defaults.secondMin : 
							tp_inst._defaults.second &amp;gt; tp_inst._defaults.secondMax? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec &amp;lt; tp_inst._defaults.millisecMin? tp_inst._defaults.millisecMin : 
							tp_inst._defaults.millisec &amp;gt; tp_inst._defaults.millisecMax? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec &amp;lt; tp_inst._defaults.microsecMin? tp_inst._defaults.microsecMin : 
							tp_inst._defaults.microsec &amp;gt; tp_inst._defaults.microsecMax? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = '';
			tp_inst.$input = $input;

			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField).css({
					cursor: 'pointer'
				}).focus(function() {
					$input.trigger("focus");
				});
			}

			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date();
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date();
			}

			// datepicker needs minDate/maxDate, timepicker needs minDateTime/maxDateTime..
			if (tp_inst._defaults.minDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime());
			}
			if (tp_inst._defaults.minDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime());
			}
			if (tp_inst._defaults.maxDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime());
			}
			if (tp_inst._defaults.maxDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime());
			}
			tp_inst.$input.bind('focus', function() {
				tp_inst._onFocus();
			});

			return tp_inst;
		},

		/*
		* add our sliders to the calendar
		*/
		_addTimePicker: function(dp_inst) {
			var currDT = (this.$altInput &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly) ? this.$input.val() + ' ' + this.$altInput.val() : this.$input.val();

			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
		},

		/*
		* parse the time string from input value or _setTime
		*/
		_parseTime: function(timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0]);
			}

			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, 'dateFormat');
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false;
					}
					$.extend(this, parseRes.timeObj);
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err +
									"\ndate/time string = " + timeString +
									"\ntimeFormat = " + this._defaults.timeFormat +
									"\ndateFormat = " + dp_dateFormat);
					return false;
				}
				return true;
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false;
				}
				$.extend(this, timeObj);
				return true;
			}
		},

		/*
		* generate and inject html for timepicker into ui datepicker
		*/
		_injectTimePicker: function() {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = '',
				uitem = '',
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i=0,
				l=0;

			// Prevent displaying twice
			if ($dp.find("div.ui-timepicker-div").length === 0 &amp;amp;&amp;amp; o.showTimepicker) {
				var noDisplay = ' style="display:none;"',
					html = '&amp;lt;div class="ui-timepicker-div'+ (o.isRTL? ' ui-timepicker-rtl' : '') +'"&amp;gt;&amp;lt;dl&amp;gt;' + '&amp;lt;dt class="ui_tpicker_time_label"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;' + o.timeText + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_time"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the markup
				for(i=0,l=this.units.length; i&amp;lt;l; i++){
					litem = this.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// Added by Peter Medeiros:
					// - Figure out what the hour/minute/second max should be based on the step values.
					// - Example: if stepMinute is 15, then minMax is 45.
					max[litem] = parseInt((o[litem+'Max'] - ((o[litem+'Max'] - o[litem+'Min']) % o['step'+uitem])), 10);
					gridSize[litem] = 0;

					html += '&amp;lt;dt class="ui_tpicker_'+ litem +'_label"' + (show ? '' : noDisplay) + '&amp;gt;' + o[litem +'Text'] + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_'+ litem +'"&amp;gt;&amp;lt;div class="ui_tpicker_'+ litem +'_slider"' + (show ? '' : noDisplay) + '&amp;gt;&amp;lt;/div&amp;gt;';

					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						html += '&amp;lt;div style="padding-left: 1px"&amp;gt;&amp;lt;table class="ui-tpicker-grid-label"&amp;gt;&amp;lt;tr&amp;gt;';

						if(litem == 'hour'){
							for (var h = o[litem+'Min']; h &amp;lt;= max[litem]; h += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm? 'hht':'HH', {hour:h}, o);									
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + tmph + '&amp;lt;/td&amp;gt;';
							}
						}
						else{
							for (var m = o[litem+'Min']; m &amp;lt;= max[litem]; m += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + ((m &amp;lt; 10) ? '0' : '') + m + '&amp;lt;/td&amp;gt;';
							}
						}

						html += '&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;&amp;lt;/div&amp;gt;';
					}
					html += '&amp;lt;/dd&amp;gt;';
				}
				
				// Timezone
				var showTz = o.showTimezone !== null? o.showTimezone : this.support.timezone;
				html += '&amp;lt;dt class="ui_tpicker_timezone_label"' + (showTz ? '' : noDisplay) + '&amp;gt;' + o.timezoneText + '&amp;lt;/dt&amp;gt;';
				html += '&amp;lt;dd class="ui_tpicker_timezone" ' + (showTz ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the elements from string
				html += '&amp;lt;/dl&amp;gt;&amp;lt;/div&amp;gt;';
				var $tp = $(html);

				// if we only want time picker...
				if (o.timeOnly === true) {
					$tp.prepend('&amp;lt;div class="ui-widget-header ui-helper-clearfix ui-corner-all"&amp;gt;' + '&amp;lt;div class="ui-datepicker-title"&amp;gt;' + o.timeOnlyTitle + '&amp;lt;/div&amp;gt;' + '&amp;lt;/div&amp;gt;');
					$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();
				}
				
				// add sliders, adjust grids, add events
				for(i=0,l=tp_inst.units.length; i&amp;lt;l; i++){
					litem = tp_inst.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// add the slider
					tp_inst[litem+'_slider'] = tp_inst.control.create(tp_inst, $tp.find('.ui_tpicker_'+litem+'_slider'), litem, tp_inst[litem], o[litem+'Min'], max[litem], o['step'+uitem]);

					// adjust the grid and add click event
					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						size = 100 * gridSize[litem] * o[litem+'Grid'] / (max[litem] - o[litem+'Min']);
						$tp.find('.ui_tpicker_'+litem+' table').css({
							width: size + "%",
							marginLeft: o.isRTL? '0' : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL? ((size / (-2 * gridSize[litem])) + "%") : '0',
							borderCollapse: 'collapse'
						}).find("td").click(function(e){
								var $t = $(this),
									h = $t.html(),
									n = parseInt(h.replace(/[^0-9]/g),10),
									ap = h.replace(/[^apm]/ig),
									f = $t.data('for'); // loses scope, so we use data-for

								if(f == 'hour'){
									if(ap.indexOf('p') !== -1 &amp;amp;&amp;amp; n &amp;lt; 12){
										n += 12;
									}
									else{
										if(ap.indexOf('a') !== -1 &amp;amp;&amp;amp; n === 12){
											n = 0;
										}
									}
								}
								
								tp_inst.control.value(tp_inst, tp_inst[f+'_slider'], litem, n);

								tp_inst._onTimeChange();
								tp_inst._onSelectHandler();
							}).css({
								cursor: 'pointer',
								width: (100 / gridSize[litem]) + '%',
								textAlign: 'center',
								overflow: 'hidden'
							});
					} // end if grid &amp;gt; 0
				} // end for loop

				// Add timezone options
				this.timezone_select = $tp.find('.ui_tpicker_timezone').append('&amp;lt;select&amp;gt;&amp;lt;/select&amp;gt;').find("select");
				$.fn.append.apply(this.timezone_select,
				$.map(o.timezoneList, function(val, idx) {
					return $("&amp;lt;option /&amp;gt;").val(typeof val == "object" ? val.value : val).text(typeof val == "object" ? val.label : val);
				}));
				if (typeof(this.timezone) != "undefined" &amp;amp;&amp;amp; this.timezone !== null &amp;amp;&amp;amp; this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset()*-1;
					if (local_timezone == this.timezone) {
						selectLocalTimezone(tp_inst);
					} else {
						this.timezone_select.val(this.timezone);
					}
				} else {
					if (typeof(this.hour) != "undefined" &amp;amp;&amp;amp; this.hour !== null &amp;amp;&amp;amp; this.hour !== "") {
						this.timezone_select.val(o.timezone);
					} else {
						selectLocalTimezone(tp_inst);
					}
				}
				this.timezone_select.change(function() {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
				});
				// End timezone options
				
				// inject timepicker into datepicker
				var $buttonPanel = $dp.find('.ui-datepicker-buttonpane');
				if ($buttonPanel.length) {
					$buttonPanel.before($tp);
				} else {
					$dp.append($tp);
				}

				this.$timeObj = $tp.find('.ui_tpicker_time');

				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined;
				}

				// slideAccess integration: http://trentrichardson.com/2011/11/11/jquery-ui-sliders-and-touch-accessibility/
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
						
					setTimeout(function() { // fix for inline mode
						if ($tp.find('.ui-slider-access').length === 0) {
							$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);

							// fix any grids since sliders are shorter
							var sliderAccessWidth = $tp.find('.ui-slider-access:eq(0)').outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find('table:visible').each(function() {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl? 'marginRight':'marginLeft').toString().replace('%', ''),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + '%',
										css = { width: newWidth, marginRight: 0, marginLeft: 0 };
									css[rtl? 'marginRight':'marginLeft'] = newMarginLeft;
									$g.css(css);
								});
							}
						}
					}, 10);
				}
				// end slideAccess integration

				tp_inst._limitMinMaxDateTime(this.inst, true);
			}
		},

		/*
		* This function tries to limit the ability to go outside the
		* min/max date range
		*/
		_limitMinMaxDateTime: function(dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);

			if (!this._defaults.showTimepicker) {
				return;
			} // No time so nothing to check here

			if ($.datepicker._get(dp_inst, 'minDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'minDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, 'minDateTime'),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin;
				}

				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour &amp;lt;= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute &amp;lt;= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second &amp;lt;= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if(this.millisec &amp;lt;= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;lt; this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin;
									}
									this._defaults.microsecMin = this.microsecMinOriginal;
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal;
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal;
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal;
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal;
				}
			}

			if ($.datepicker._get(dp_inst, 'maxDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'maxDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, 'maxDateTime'),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax;
				}

				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour &amp;gt;= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute &amp;gt;= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second &amp;gt;= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec &amp;gt;= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;gt; this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax;
									}
									this._defaults.microsecMax = this.microsecMaxOriginal;
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal;
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal;
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal;
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal;
				}
			}

			if (adjustSliders !== undefined &amp;amp;&amp;amp; adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10);
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);

				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, 'hour', { min: this._defaults.hourMin, max: hourMax });
					this.control.value(this, this.hour_slider, 'hour', this.hour - (this.hour % this._defaults.stepHour));
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, 'minute', { min: this._defaults.minuteMin, max: minMax });
					this.control.value(this, this.minute_slider, 'minute', this.minute - (this.minute % this._defaults.stepMinute));
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, 'second', { min: this._defaults.secondMin, max: secMax });
					this.control.value(this, this.second_slider, 'second', this.second - (this.second % this._defaults.stepSecond));
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, 'millisec', { min: this._defaults.millisecMin, max: millisecMax });
					this.control.value(this, this.millisec_slider, 'millisec', this.millisec - (this.millisec % this._defaults.stepMillisec));
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, 'microsec', { min: this._defaults.microsecMin, max: microsecMax });
					this.control.value(this, this.microsec_slider, 'microsec', this.microsec - (this.microsec % this._defaults.stepMicrosec));
				}
			}

		},

		/*
		* when a slider moves, set the internal time...
		* on time change is also called when the time is updated in the text field
		*/
		_onTimeChange: function() {
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, 'hour') : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, 'minute') : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, 'second') : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, 'millisec') : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, 'microsec') : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;

			if (typeof(hour) == 'object') {
				hour = false;
			}
			if (typeof(minute) == 'object') {
				minute = false;
			}
			if (typeof(second) == 'object') {
				second = false;
			}
			if (typeof(millisec) == 'object') {
				millisec = false;
			}
			if (typeof(microsec) == 'object') {
				microsec = false;
			}
			if (typeof(timezone) == 'object') {
				timezone = false;
			}

			if (hour !== false) {
				hour = parseInt(hour, 10);
			}
			if (minute !== false) {
				minute = parseInt(minute, 10);
			}
			if (second !== false) {
				second = parseInt(second, 10);
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10);
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10);
			}

			var ampm = o[hour &amp;lt; 12 ? 'amNames' : 'pmNames'][0];

			// If the update was done in the input field, the input field should not be updated.
			// If the update was done using the sliders, update the input field.
			var hasChanged = (hour != this.hour || minute != this.minute || second != this.second || millisec != this.millisec || microsec != this.microsec 
								|| (this.ampm.length &amp;gt; 0 &amp;amp;&amp;amp; (hour &amp;lt; 12) != ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) 
								|| (this.timezone !== null &amp;amp;&amp;amp; timezone != this.timezone));

			if (hasChanged) {

				if (hour !== false) {
					this.hour = hour;
				}
				if (minute !== false) {
					this.minute = minute;
				}
				if (second !== false) {
					this.second = second;
				}
				if (millisec !== false) {
					this.millisec = millisec;
				}
				if (microsec !== false) {
					this.microsec = microsec;
				}
				if (timezone !== false) {
					this.timezone = timezone;
				}

				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0]);
				}

				this._limitMinMaxDateTime(this.inst, true);
			}
			if (this.support.ampm) {
				this.ampm = ampm;
			}

			// Updates the time within the timepicker
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if(pickerTimeFormat === o.timeFormat){
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix);
				}
				else{
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix);
				}
			}

			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime();
			}
		},

		/*
		* call custom onSelect.
		* bind to sliders slidestop, and grid click.
		*/
		_onSelectHandler: function() {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect &amp;amp;&amp;amp; inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this]);
			}
		},

		/*
		* update our input with the new date time..
		*/
		_updateDateTime: function(dp_inst) {
			dp_inst = this.inst || dp_inst;
			//var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
			var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay)),
				dateFmt = $.datepicker._get(dp_inst, 'dateFormat'),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null &amp;amp;&amp;amp; this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			
			// if a slider was changed but datepicker doesn't have a value yet, set it
			if(dp_inst.lastVal===""){
                dp_inst.currentYear=dp_inst.selectedYear;
                dp_inst.currentMonth=dp_inst.selectedMonth;
                dp_inst.currentDay=dp_inst.selectedDay;
            }

			/*
			* remove following lines to force every changes in date picker to change the input value
			* Bug descriptions: when an input field has a default value, and click on the field to pop up the date picker. 
			* If the user manually empty the value in the input field, the date picker will never change selected value.
			*/
			//if (dp_inst.lastVal !== undefined &amp;amp;&amp;amp; (dp_inst.lastVal.length &amp;gt; 0 &amp;amp;&amp;amp; this.$input.val().length === 0)) {
			//	return;
			//}

			if (this._defaults.timeOnly === true) {
				formattedDateTime = this.formattedTime;
			} else if (this._defaults.timeOnly !== true &amp;amp;&amp;amp; (this._defaults.alwaysSetTime || timeAvailable)) {
				formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix;
			}

			this.formattedDateTime = formattedDateTime;

			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate);
			} else if (this.$altInput &amp;amp;&amp;amp; this._defaults.timeOnly === false &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly === true) {
				this.$altInput.val(this.formattedTime);
				this.$input.val(this.formattedDate);
			} else if (this.$altInput) {
				this.$input.val(formattedDateTime);
				var altFormattedDateTime = '',
					altSeparator = this._defaults.altSeparator ? this._defaults.altSeparator : this._defaults.separator,
					altTimeSuffix = this._defaults.altTimeSuffix ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
				
				if(!this._defaults.timeOnly){
					if (this._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg);
					}
					else{
						altFormattedDateTime = this.formattedDate;
					}

					if (altFormattedDateTime){
						altFormattedDateTime += altSeparator;
					}
				}

				if(this._defaults.altTimeFormat){
					altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix;
				}
				else{
					altFormattedDateTime += this.formattedTime + altTimeSuffix;
				}
				this.$altInput.val(altFormattedDateTime);
			} else {
				this.$input.val(formattedDateTime);
			}

			this.$input.trigger("change");
		},

		_onFocus: function() {
			if (!this.$input.val() &amp;amp;&amp;amp; this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, 'timepicker');
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst);
						} catch (err) {
							$.timepicker.log(err);
						}
					}
				}
			}
		},

		/*
		* Small abstraction to control types
		* We can add more, just be sure to follow the pattern: create, options, value
		*/
		_controls: {
			// slider methods
			slider: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var rtl = tp_inst._defaults.isRTL; // if rtl go -60-&amp;gt;0 instead of 0-&amp;gt;60
					return obj.prop('slide', null).slider({
						orientation: "horizontal",
						value: rtl? val*-1 : val,
						min: rtl? max*-1 : min,
						max: rtl? min*-1 : max,
						step: step,
						slide: function(event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl? ui.value*-1:ui.value);
							tp_inst._onTimeChange();
						},
						stop: function(event, ui) {
							tp_inst._onSelectHandler();
						}
					});	
				},
				options: function(tp_inst, obj, unit, opts, val){
					if(tp_inst._defaults.isRTL){
						if(typeof(opts) == 'string'){
							if(opts == 'min' || opts == 'max'){
								if(val !== undefined){
									return obj.slider(opts, val*-1);
								}
								return Math.abs(obj.slider(opts));
							}
							return obj.slider(opts);
						}
						var min = opts.min, 
							max = opts.max;
						opts.min = opts.max = null;
						if(min !== undefined){
							opts.max = min * -1;
						}
						if(max !== undefined){
							opts.min = max * -1;
						}
						return obj.slider(opts);
					}
					if(typeof(opts) == 'string' &amp;amp;&amp;amp; val !== undefined){
							return obj.slider(opts, val);
					}
					return obj.slider(opts);
				},
				value: function(tp_inst, obj, unit, val){
					if(tp_inst._defaults.isRTL){
						if(val !== undefined){
							return obj.slider('value', val*-1);
						}
						return Math.abs(obj.slider('value'));
					}
					if(val !== undefined){
						return obj.slider('value', val);
					}
					return obj.slider('value');
				}
			},
			// select methods
			select: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var sel = '&amp;lt;select class="ui-timepicker-select" data-unit="'+ unit +'" data-min="'+ min +'" data-max="'+ max +'" data-step="'+ step +'"&amp;gt;',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;

					for(var i=min; i&amp;lt;=max; i+=step){						
						sel += '&amp;lt;option value="'+ i +'"'+ (i==val? ' selected':'') +'&amp;gt;';
						if(unit == 'hour'){
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig,'')), {hour:i}, tp_inst._defaults);
						}
						else if(unit == 'millisec' || unit == 'microsec' || i &amp;gt;= 10){ sel += i; }
						else {sel += '0'+ i.toString(); }
						sel += '&amp;lt;/option&amp;gt;';
					}
					sel += '&amp;lt;/select&amp;gt;';

					obj.children('select').remove();

					$(sel).appendTo(obj).change(function(e){
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
					});

					return obj;
				},
				options: function(tp_inst, obj, unit, opts, val){
					var o = {},
						$t = obj.children('select');
					if(typeof(opts) == 'string'){
						if(val === undefined){
							return $t.data(opts);
						}
						o[opts] = val;	
					}
					else{ o = opts; }
					return tp_inst.control.create(tp_inst, obj, $t.data('unit'), $t.val(), o.min || $t.data('min'), o.max || $t.data('max'), o.step || $t.data('step'));
				},
				value: function(tp_inst, obj, unit, val){
					var $t = obj.children('select');
					if(val !== undefined){
						return $t.val(val);
					}
					return $t.val();
				}
			}
		} // end _controls

	});

	$.fn.extend({
		/*
		* shorthand just to use timepicker..
		*/
		timepicker: function(o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);

			if (typeof o == 'object') {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				});
			}

			return $(this).each(function() {
				$.fn.datetimepicker.apply($(this), tmp_args);
			});
		},

		/*
		* extend timepicker to datepicker
		*/
		datetimepicker: function(o) {
			o = o || {};
			var tmp_args = arguments;

			if (typeof(o) == 'string') {
				if (o == 'getDate') {
					return $.fn.datepicker.apply($(this[0]), tmp_args);
				} else {
					return this.each(function() {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args);
					});
				}
			} else {
				return this.each(function() {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults);
				});
			}
		}
	});

	/*
	* Public Utility to parse date and time
	*/
	$.datepicker.parseDateTime = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec);
		}

		return parseRes.date;
	};

	/*
	* Public utility to parse time
	*/
	$.datepicker.parseTime = function(timeFormat, timeString, options) {		
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g,'').indexOf('Z') !== -1);

		// Strict parse requires the timeString to match the timeFormat exactly
		var strictParse = function(f, s, o){

			// pattern for standard and localized AM/PM markers
			var getPatternAmpm = function(amNames, pmNames) {
				var markers = [];
				if (amNames) {
					$.merge(markers, amNames);
				}
				if (pmNames) {
					$.merge(markers, pmNames);
				}
				markers = $.map(markers, function(val) {
					return val.replace(/[.*+?|()\[\]{}\\]/g, '\\$&amp;amp;');
				});
				return '(' + markers.join('|') + ')?';
			};

			// figure out position of time elements.. cause js cant do named captures
			var getFormatPositions = function(timeFormat) {
				var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
					orders = {
						h: -1,
						m: -1,
						s: -1,
						l: -1,
						c: -1,
						t: -1,
						z: -1
					};

				if (finds) {
					for (var i = 0; i &amp;lt; finds.length; i++) {
						if (orders[finds[i].toString().charAt(0)] == -1) {
							orders[finds[i].toString().charAt(0)] = i + 1;
						}
					}
				}
				return orders;
			};

			var regstr = '^' + f.toString()
					.replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
							var ml = match.length;
							switch (match.charAt(0).toLowerCase()) {
								case 'h': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'm': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 's': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'l': return '(\\d?\\d?\\d)';
								case 'c': return '(\\d?\\d?\\d)';
								case 'z': return '(z|[-+]\\d\\d:?\\d\\d|\\S+)?';
								case 't': return getPatternAmpm(o.amNames, o.pmNames);
								default:    // literal escaped in quotes
									return '(' + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function (m) { return "\\" + m; }) + ')?';
							}
						})
					.replace(/\s/g, '\\s?') +
					o.timeSuffix + '$',
				order = getFormatPositions(f),
				ampm = '',
				treg;

			treg = s.match(new RegExp(regstr, 'i'));

			var resTime = {
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0
			};

			if (treg) {
				if (order.t !== -1) {
					if (treg[order.t] === undefined || treg[order.t].length === 0) {
						ampm = '';
						resTime.ampm = '';
					} else {
						ampm = $.inArray(treg[order.t].toUpperCase(), o.amNames) !== -1 ? 'AM' : 'PM';
						resTime.ampm = o[ampm == 'AM' ? 'amNames' : 'pmNames'][0];
					}
				}

				if (order.h !== -1) {
					if (ampm == 'AM' &amp;amp;&amp;amp; treg[order.h] == '12') {
						resTime.hour = 0; // 12am = 0 hour
					} else {
						if (ampm == 'PM' &amp;amp;&amp;amp; treg[order.h] != '12') {
							resTime.hour = parseInt(treg[order.h], 10) + 12; // 12pm = 12 hour, any other pm = hour + 12
						} else {
							resTime.hour = Number(treg[order.h]);
						}
					}
				}

				if (order.m !== -1) {
					resTime.minute = Number(treg[order.m]);
				}
				if (order.s !== -1) {
					resTime.second = Number(treg[order.s]);
				}
				if (order.l !== -1) {
					resTime.millisec = Number(treg[order.l]);
				}
				if (order.c !== -1) {
					resTime.microsec = Number(treg[order.c]);
				}
				if (order.z !== -1 &amp;amp;&amp;amp; treg[order.z] !== undefined) {
					resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z]);
				}


				return resTime;
			}
			return false;
		};// end strictParse

		// First try JS Date, if that fails, use strictParse
		var looseParse = function(f,s,o){
			try{
				var d = new Date('2012-01-01 '+ s);
				if(isNaN(d.getTime())){
					d = new Date('2012-01-01T'+ s);
					if(isNaN(d.getTime())){
						d = new Date('01/01/2012 '+ s);
						if(isNaN(d.getTime())){
							throw "Unable to parse time with native Date: "+ s;
						}
					}
				}

				return {
					hour: d.getHours(),
					minute: d.getMinutes(),
					second: d.getSeconds(),
					millisec: d.getMilliseconds(),
					microsec: d.getMicroseconds(),
					timezone: d.getTimezoneOffset()*-1
				};
			}
			catch(err){
				try{
					return strictParse(f,s,o);
				}
				catch(err2){
					$.timepicker.log("Unable to parse \ntimeString: "+ s +"\ntimeFormat: "+ f);
				}				
			}
			return false;
		}; // end looseParse
		
		if(typeof o.parse === "function"){
			return o.parse(timeFormat, timeString, o);
		}
		if(o.parse === 'loose'){
			return looseParse(timeFormat, timeString, o);
		}
		return strictParse(timeFormat, timeString, o);
	};

	/*
	* Public utility to format the time
	* format = string format of the time
	* time = a {}, not a Date() for timezones
	* options = essentially the regional[].. amNames, pmNames, ampm
	*/
	$.datepicker.formatTime = function(format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			timezone: 0
		}, time);

		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);

		if (hour &amp;gt; 11) {
			ampmName = options.pmNames[0];
		}

		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|('.*?'|".*?"))/g, function(match) {
		switch (match) {
			case 'HH':
				return ('0' + hour).slice(-2);
			case 'H':
				return hour;
			case 'hh':
				return ('0' + convert24to12(hour)).slice(-2);
			case 'h':
				return convert24to12(hour);
			case 'mm':
				return ('0' + time.minute).slice(-2);
			case 'm':
				return time.minute;
			case 'ss':
				return ('0' + time.second).slice(-2);
			case 's':
				return time.second;
			case 'l':
				return ('00' + time.millisec).slice(-3);
			case 'c':
				return ('00' + time.microsec).slice(-3);
			case 'z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, false);
			case 'Z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, true);
			case 'T': 
				return ampmName.charAt(0).toUpperCase();
			case 'TT': 
				return ampmName.toUpperCase();
			case 't':
				return ampmName.charAt(0).toLowerCase();
			case 'tt':
				return ampmName.toLowerCase();
			default:
				return match.replace(/\'/g, "") || "'";
			}
		});

		tmptime = $.trim(tmptime);
		return tmptime;
	};

	/*
	* the bad hack :/ override datepicker so it doesnt close on select
	// inspired: http://stackoverflow.com/questions/1252512/jquery-datepicker-prevent-closing-picker-when-clicking-a-date/1762378#1762378
	*/
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function(id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			tp_inst._limitMinMaxDateTime(inst, true);
			inst.inline = inst.stay_open = true;
			//This way the onSelect handler called from calendarpicker get the full dateTime
			this._base_selectDate(id, dateStr);
			inst.inline = inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst);
		} else {
			this._base_selectDate(id, dateStr);
		}
	};

	/*
	* second bad hack :/ override datepicker so it triggers an event when changing the input field
	* and does not redraw the datepicker on every selectDate event
	*/
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function(inst) {

		// don't popup the datepicker if there is another instance already opened
		var input = inst.input[0];
		if ($.datepicker._curInst &amp;amp;&amp;amp; $.datepicker._curInst != inst &amp;amp;&amp;amp; $.datepicker._datepickerShowing &amp;amp;&amp;amp; $.datepicker._lastInput != input) {
			return;
		}

		if (typeof(inst.stay_open) !== 'boolean' || inst.stay_open === false) {

			this._base_updateDatepicker(inst);

			// Reload the time control when changing something in the input text field.
			var tp_inst = this._get(inst, 'timepicker');
			if (tp_inst) {
				tp_inst._addTimePicker(inst);
			}
		}
	};

	/*
	* third bad hack :/ override datepicker so it allows spaces and colon in the input field
	*/
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if ($.datepicker._get(inst, 'constrainInput')) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null? tp_inst._defaults.showTimezone : tp_inst.support.timezone,					
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat')),
					datetimeChars = tp_inst._defaults.timeFormat.toString()
											.replace(/[hms]/g, '')
											.replace(/TT/g, ampm ? 'APM' : '')
											.replace(/Tt/g, ampm ? 'AaPpMm' : '')
											.replace(/tT/g, ampm ? 'AaPpMm' : '')
											.replace(/T/g, ampm ? 'AP' : '')
											.replace(/tt/g, ampm ? 'apm' : '')
											.replace(/t/g, ampm ? 'ap' : '') + 
											" " + tp_inst._defaults.separator + 
											tp_inst._defaults.timeSuffix + 
											(tz ? tp_inst._defaults.timezoneList.join('') : '') + 
											(tp_inst._defaults.amNames.join('')) + (tp_inst._defaults.pmNames.join('')) + 
											dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr &amp;lt; ' ' || !dateChars || datetimeChars.indexOf(chr) &amp;gt; -1);
			}
		}

		return $.datepicker._base_doKeyPress(event);
	};

	/*
	* Fourth bad hack :/ override _updateAlternate function used in inline mode to init altField
	*/
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	/* Update any alternate field to synchronise with the main field. */
	$.datepicker._updateAlternate = function(inst) {
		var tp_inst = this._get(inst, 'timepicker');
		if(tp_inst){
			var altField = tp_inst._defaults.altField;
			if (altField) { // update alternate field too
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = '', 
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator, 
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if(!tp_inst._defaults.timeOnly &amp;amp;&amp;amp; !tp_inst._defaults.altFieldTimeOnly &amp;amp;&amp;amp; date !== null){
					if(tp_inst._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime;
					}
					else{
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime;
					}
				}
				$(altField).val(altFormattedDateTime);
			}
		}
		else{
			$.datepicker._base_updateAlternate(inst);
		}
	};

	/*
	* Override key up event to sync manual input changes.
	*/
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst);
				} catch (err) {
					$.timepicker.log(err);
				}
			}
		}

		return $.datepicker._base_doKeyUp(event);
	};

	/*
	* override "Today" button to also grab the time.
	*/
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function(id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		this._base_gotoToday(id);
		var tp_inst = this._get(inst, 'timepicker');
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		$('.ui-datepicker-today', $dp).click();
	};

	/*
	* Disable &amp;amp; enable the Time in the datetimepicker
	*/
	$.datepicker._disableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst);
		}
	};

	$.datepicker._enableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst); // Could be disabled on page load
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create our own set time function
	*/
	$.datepicker._setTime = function(inst, date) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var defaults = tp_inst._defaults;

			// calling _setTime with no date sets time to defaults
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;

			//check if within min/max times.. 
			tp_inst._limitMinMaxDateTime(inst, true);

			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create new public method to set only time, callable as $().datepicker('setTime', date)
	*/
	$.datepicker._setTimeDatepicker = function(target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date == "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec);
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds());
				}
				if (tp_date.toString() == 'Invalid Date') {
					tp_date = undefined;
				}
				this._setTime(inst, tp_date);
			}
		}

	};

	/*
	* override setDate() to allow setting time too within Date object
	*/
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function(target, date) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		if(typeof(date) === 'string'){
			date = new Date(date);
			if(!date.getTime()){
				$.timepicker.log("Error creating Date object from string.");
			}
		}

		var tp_inst = this._get(inst, 'timepicker');
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds());
		} else {
			tp_date = date;
		}
		
		// This is important if you are using the timezone option, javascript's Date 
		// object will only return the timezone offset for the current locale, so we 
		// adjust it accordingly.  If not using timezone option this won't matter..
		// If a timezone is different in tp, keep the timezone as is
		if(tp_inst){
			// look out for DST if tz wasn't specified
			if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
				tp_inst.timezone = tp_date.getTimezoneOffset()*-1;
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone);
		}

		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true);
	};

	/*
	* override getDate() to allow getting time too within Date object
	*/
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function(target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			// if it hasn't yet been defined, grab from field
			if(inst.lastVal === undefined){
				this._setDateFromField(inst, noDefault);
			}

			var date = this._getDate(inst);
			if (date &amp;amp;&amp;amp; tp_inst._parseTime($(target).val(), tp_inst.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);

				// This is important if you are using the timezone option, javascript's Date 
				// object will only return the timezone offset for the current locale, so we 
				// adjust it accordingly.  If not using timezone option this won't matter..
				if(tp_inst.timezone != null){
					// look out for DST if tz wasn't specified
					if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
						tp_inst.timezone = date.getTimezoneOffset()*-1;
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
				}
			}
			return date;
		}
		return this._base_getDateDatepicker(target, noDefault);
	};

	/*
	* override parseDate() because UI 1.8.14 throws an error about "Extra characters"
	* An option in datapicker to ignore extra format characters would be nicer.
	*/
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function(format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings);
		} catch (err) {
			// Hack!  The error message ends with a colon, a space, and
			// the "extra" characters.  We rely on that instead of
			// attempting to perfectly reproduce the parsing algorithm.
			if (err.indexOf(":") &amp;gt;= 0) {
				date = this._base_parseDate(format, value.substring(0,value.length-(err.length-err.indexOf(':')-2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format);
			} else {
				throw err;
			}
		}
		return date;
	};

	/*
	* override formatDate to set date with time to the input
	*/
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function(inst, day, month, year) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val();
		}
		return this._base_formatDate(inst);
	};

	/*
	* override options setter to add time to maxDate(Time) and minDate(Time). MaxDate
	*/
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function(target, name, value) {
		var inst = this._getInst(target),
	        name_clone;
		if (!inst) {
			return null;
		}

		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop;
		    if (typeof name == 'string') { // if min/max was set with the string
		        if (name === 'minDate' || name === 'minDateTime') {
		            min = value;
		        } else if (name === 'maxDate' || name === 'maxDateTime') {
		            max = value;
		        } else if (name === 'onSelect') {
		            onselect = value;
		        } else if (overrides.hasOwnProperty(name)) {
		            if (typeof (value) === 'undefined') {
		                return overrides[name];
		            }
		            fns[name] = value;
		            name_clone = {}; //empty results in exiting function after overrides updated
		        }
		    } else if (typeof name == 'object') { //if min/max was set with the JSON
		        if (name.minDate) {
		            min = name.minDate;
		        } else if (name.minDateTime) {
		            min = name.minDateTime;
		        } else if (name.maxDate) {
		            max = name.maxDate;
		        } else if (name.maxDateTime) {
		            max = name.maxDateTime;
		        }
		        for (prop in overrides) {
		            if (overrides.hasOwnProperty(prop) &amp;amp;&amp;amp; name[prop]) {
		                fns[prop] = name[prop];
		            }
		        }
		    }
		    for (prop in fns) {
		        if (fns.hasOwnProperty(prop)) {
		            overrides[prop] = fns[prop];
		            if (!name_clone) { name_clone = $.extend({}, name);}
		            delete name_clone[prop];
		        }
		    }
		    if (name_clone &amp;amp;&amp;amp; isEmptyObject(name_clone)) { return; }
		    if (min) { //if min was set
		        if (min === 0) {
		            min = new Date();
		        } else {
		            min = new Date(min);
		        }
		        tp_inst._defaults.minDate = min;
		        tp_inst._defaults.minDateTime = min;
		    } else if (max) { //if max was set
		        if (max === 0) {
		            max = new Date();
		        } else {
		            max = new Date(max);
		        }
		        tp_inst._defaults.maxDate = max;
		        tp_inst._defaults.maxDateTime = max;
		    } else if (onselect) {
		        tp_inst._defaults.onSelect = onselect;
		    }
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name);
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
	};
	
	/*
	* jQuery isEmptyObject does not check hasOwnProperty - if someone has added to the object prototype,
	* it will return false for all objects
	*/
	var isEmptyObject = function(obj) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(obj)) {
				return false;
			}
		}
		return true;
	};

	/*
	* jQuery extend now ignores nulls!
	*/
	var extendRemove = function(target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] === null || props[name] === undefined) {
				target[name] = props[name];
			}
		}
		return target;
	};

	/*
	* Determine by the time format which units are supported
	* Returns an object of booleans for each unit
	*/
	var detectSupport = function(timeFormat){
		var tf = timeFormat.replace(/\'.*?\'/g,'').toLowerCase(), // removes literals
			isIn = function(f, t){ // does the format contain the token?
					return f.indexOf(t) !== -1? true:false; 
				};
		return {
				hour: isIn(tf,'h'),
				minute: isIn(tf,'m'),
				second: isIn(tf,'s'),
				millisec: isIn(tf,'l'),
				microsec: isIn(tf,'c'),
				timezone: isIn(tf,'z'),
				ampm: isIn(tf,'t') &amp;amp;&amp;amp; isIn(timeFormat,'h'),
				iso8601: isIn(timeFormat, 'Z')
			};
	};

	/*
	* Converts 24 hour format into 12 hour
	* Returns 12 hour without leading 0
	*/
	var convert24to12 = function(hour) {
		if (hour &amp;gt; 12) {
			hour = hour - 12;
		}

		if (hour === 0) {
			hour = 12;
		}

		return String(hour);
	};

	/*
	* Splits datetime string into date ans time substrings.
	* Throws exception when date can't be parsed
	* Returns [dateString, timeString]
	*/
	var splitDateTime = function(dateFormat, dateTimeString, dateSettings, timeSettings) {
		try {
			// The idea is to get the number separator occurances in datetime and the time format requested (since time has 
			// fewer unknowns, mostly numbers and am/pm). We will use the time pattern to split.
			var separator = timeSettings &amp;amp;&amp;amp; timeSettings.separator ? timeSettings.separator : $.timepicker._defaults.separator,
				format = timeSettings &amp;amp;&amp;amp; timeSettings.timeFormat ? timeSettings.timeFormat : $.timepicker._defaults.timeFormat,
				timeParts = format.split(separator), // how many occurances of separator may be in our format?
				timePartsLen = timeParts.length,
				allParts = dateTimeString.split(separator),
				allPartsLen = allParts.length;

			if (allPartsLen &amp;gt; 1) {
				return [
						allParts.splice(0,allPartsLen-timePartsLen).join(separator),
						allParts.splice(0,timePartsLen).join(separator)
					];
			}

		} catch (err) {
			$.timepicker.log('Could not split the date from the time. Please check the following datetimepicker options' +
					"\nthrown error: " + err +
					"\ndateTimeString" + dateTimeString +
					"\ndateFormat = " + dateFormat +
					"\nseparator = " + timeSettings.separator +
					"\ntimeFormat = " + timeSettings.timeFormat);

			if (err.indexOf(":") &amp;gt;= 0) {
				// Hack!  The error message ends with a colon, a space, and
				// the "extra" characters.  We rely on that instead of
				// attempting to perfectly reproduce the parsing algorithm.
				var dateStringLength = dateTimeString.length - (err.length - err.indexOf(':') - 2),
					timeString = dateTimeString.substring(dateStringLength);

				return [$.trim(dateTimeString.substring(0, dateStringLength)), $.trim(dateTimeString.substring(dateStringLength))];

			} else {
				throw err;
			}
		}
		return [dateTimeString, ''];
	};

	/*
	* Internal function to parse datetime interval
	* Returns: {date: Date, timeObj: Object}, where
	*   date - parsed date without time (type Date)
	*   timeObj = {hour: , minute: , second: , millisec: , microsec: } - parsed time. Optional
	*/
	var parseDateTimeInternal = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var date;
		var splitRes = splitDateTime(dateFormat, dateTimeString, dateSettings, timeSettings);
		date = $.datepicker._base_parseDate(dateFormat, splitRes[0], dateSettings);
		if (splitRes[1] !== '') {
			var timeString = splitRes[1],
				parsedTime = $.datepicker.parseTime(timeFormat, timeString, timeSettings);

			if (parsedTime === null) {
				throw 'Wrong time format';
			}
			return {
				date: date,
				timeObj: parsedTime
			};
		} else {
			return {
				date: date
			};
		}
	};

	/*
	* Internal function to set timezone_select to the local timezone
	*/
	var selectLocalTimezone = function(tp_inst, date) {
		if (tp_inst &amp;amp;&amp;amp; tp_inst.timezone_select) {
			var now = typeof date !== 'undefined' ? date : new Date();
			tp_inst.timezone_select.val(now.getTimezoneOffset()*-1);
		}
	};

	/*
	* Create a Singleton Insance
	*/
	$.timepicker = new Timepicker();

	/**
	 * Get the timezone offset as string from a date object (eg '+0530' for UTC+5.5)
	 * @@param  number if not a number this value is returned
	 * @@param boolean if true formats in accordance to iso8601 "+12:45"
	 * @@return string
	 */
	$.timepicker.timezoneOffsetString = function(tzMinutes, iso8601) {
		if(isNaN(tzMinutes) || tzMinutes &amp;gt; 840){
			return tzMinutes;
		}

		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601? ':':'',
			tz = (off &amp;gt;= 0 ? '+' : '-') + ('0' + (hours * 101).toString()).slice(-2) + iso + ('0' + (minutes * 101).toString()).slice(-2);
		
		if(tz == '+00:00'){
			return 'Z';
		}
		return tz;
	};

	/**
	 * Get the number in minutes that represents a timezone string
	 * @@param  string formated like "+0500", "-1245"
	 * @@return number
	 */
	$.timepicker.timezoneOffsetNumber = function(tzString) {
		tzString = tzString.toString().replace(':',''); // excuse any iso8601, end up with "+1245"

		if(tzString.toUpperCase() === 'Z'){ // if iso8601 with Z, its 0 minute offset
			return 0;
		}

		if(!/^(\-|\+)\d{4}$/.test(tzString)){ // possibly a user defined tz, so just give it back
			return tzString;
		}

		return ((tzString.substr(0,1) =='-'? -1 : 1) * // plus or minus
					((parseInt(tzString.substr(1,2),10)*60) + // hours (converted to minutes)
					parseInt(tzString.substr(3,2),10))); // minutes
	};

	/**
	 * No way to set timezone in js Date, so we must adjust the minutes to compensate. (think setDate, getDate)
	 * @@param  date
	 * @@param  string formated like "+0500", "-1245"
	 * @@return date
	 */
	$.timepicker.timezoneAdjust = function(date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if(!isNaN(toTz)){
			date.setMinutes(date.getMinutes()*1 + (date.getTimezoneOffset()*-1 - toTz*1) );
		}
		return date;
	};

	/**
	 * Calls `timepicker()` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * n.b. The input value must be correctly formatted (reformatting is not supported)
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the timepicker() call
	 * @@return jQuery
	 */
	$.timepicker.timeRange = function(startTime, endTime, options) {
		return $.timepicker.handleRange('timepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datetimepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@return jQuery
	 */
	$.timepicker.datetimeRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datetimepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.dateRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.handleRange = function(method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0, // min allowed interval in milliseconds
			maxInterval: 0, // max allowed interval in milliseconds
			start: {},      // options for start picker
			end: {}         // options for end picker
		}, options);

		$.fn[method].call(startTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), endTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), endTime, 'minDate');
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), startTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), startTime, 'maxDate');
			}
		}, options, options.end));

		checkDates(startTime, endTime);
		selected(startTime, endTime, 'minDate');
		selected(endTime, startTime, 'maxDate');

		function checkDates(changed, other) {
			var startdt = startTime[method]('getDate'),
				enddt = endTime[method]('getDate'),
				changeddt = changed[method]('getDate');

			if(startdt !== null){
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());

				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);

				if(options.minInterval &amp;gt; 0 &amp;amp;&amp;amp; minDate &amp;gt; enddt){ // minInterval check
					endTime[method]('setDate',minDate);
				}
				else if(options.maxInterval &amp;gt; 0 &amp;amp;&amp;amp; maxDate &amp;lt; enddt){ // max interval check
					endTime[method]('setDate',maxDate);
				}
				else if (startdt &amp;gt; enddt) {
					other[method]('setDate',changeddt);
				}
			}
		}

		function selected(changed, other, option) {
			if (!changed.val()) {
				return;
			}
			var date = changed[method].call(changed, 'getDate');
			if(date !== null &amp;amp;&amp;amp; options.minInterval &amp;gt; 0){
				if(option == 'minDate'){
					date.setMilliseconds(date.getMilliseconds() + options.minInterval); 
				}
				if(option == 'maxDate'){
					date.setMilliseconds(date.getMilliseconds() - options.minInterval);
				}
			}
			if (date.getTime) {
				other[method].call(other, 'option', option, date);
			}
		}
		return $([startTime.get(0), endTime.get(0)]);
	};

	/**
	 * Log error or data to the console during error or debugging
	 * @@param  Object err pass any type object to log to the console during error or debugging
	 * @@return void
	 */
	$.timepicker.log = function(err){
		if(window.console){
			console.log(err);
		}
	};

	/*
	* Microsecond support
	*/
	if(!Date.prototype.getMicroseconds){
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function(){ return this.microseconds; };
		Date.prototype.setMicroseconds = function(m){ 
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m/1000));
			this.microseconds = m%1000;
			return this;
		};
	}

	/*
	* Keep up with the version
	*/
	$.timepicker.version = "1.3.1";

})(jQuery);
jQuery.noConflict();
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;datetimepicker-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;e73a652e-09fc-4c71-8e7a-e2525a2d2a99&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
function replaceAllString(oriStr, strTarget, strSubString ){
   var strText = oriStr;
   var intIndexOfMatch = strText.indexOf( strTarget );
   while (intIndexOfMatch != -1){
      strText = strText.replace( strTarget, strSubString )
      intIndexOfMatch = strText.indexOf( strTarget );
   }
   return( strText );
}
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&amp;amp;]" + name + "=([^&amp;amp;#]*)"),
    results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
};


   var jobName= getParameterByName('job')
   var fromDate= getParameterByName('fromDate')
   var toDate= getParameterByName('toDate')
   var limit= getParameterByName('limit')
   var selectedIstIid = getParameterByName('IstIid')

  $("#jobname").ready(function(){
   $("#jobname").text(jobName)
   var convertedJobName = replaceAllString(jobName, ".", "_")
   $("#IstIid" + convertedJobName).ready(function(){
     $("#IstIid" + convertedJobName).css("display","block")
     $("#select_" + convertedJobName).ready(function(){
        $("#select_" + convertedJobName).val(selectedIstIid)
     });
   });
 });

  $("#fromDate").ready(function(){
   $("#from-date").val(fromDate)
 });

  $("#toDate").ready(function(){
   $("#to-date").val(toDate)
 });

  $("#limit").ready(function(){
   if(limit!=""){
    $("#limit").val(limit)
   }
 });
 // Get data with ajax
 function ajax_getData(jobName,fromDate,toDate,limit ){
       var convertedJobName = replaceAllString(jobName, ".", "_")
       var istIid = $("#select_" + convertedJobName).val()
       window.location="/xwiki/bin/view/WiperDog/WebHome?job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid="+istIid;
 			/*$.ajax({
			 type: "GET",
			 url:"/xwiki/bin/get/Sandbox/DescriptionForJob?outputSyntax=plain&amp;amp;job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid"+selectedIstIid,
			 success : function(result){
				$("#jobname").html(jobName)
				$("#display").text('[[]]' + result)
			 }
		   });*/
 }
	$("#treemenu2 a").click(function(){
		 var limit = 10
		 var fromDate=""
		 var toDate = ""
		 jobName= $(this).text()
                 $("#jobname").html(jobName)
                 var convertedJobName = replaceAllString(jobName, ".", "_")
                 $("#listIstIid &amp;gt; div").css("display","none")
                 $("#IstIid" + convertedJobName).css("display","block")
		 //ajax_getData(jobName,fromDate,toDate,limit )

	});

	$("#from-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
		dateFormat: 'yy-mm-dd',
	});
	$("#to-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
			dateFormat: 'yy-mm-dd',

	});
	 $("#get-data").on("click",function(){
		var fromDate = $("#from-date").val()
		var toDate =  $("#to-date").val()
		 if( toDate!= "" ){
			  if(fromDate != ""){
				  if($("#from-date").datepicker( "getDate" ) &amp;gt; $("#to-date").datepicker( "getDate" )){
				  alert("'From date' cannot start later than 'To date'")
				  return false
				  }
			  }
		 }
		 limit = $("#limit").val()
		 ajax_getData(jobName,fromDate,toDate,limit )
	});
$(document).ready(function(){
  var keys = $("#lstkey").text()
  //console.log('key == ' + keys);
  //console.log('livetableJson ==' + $("#livetableJson").text());
  
  var jsonObj = $.parseJSON($("#livetableJson").text()); 
  if(keys &amp;amp;&amp;amp; keys != '[ ]'){
    /** Subtyped **/    
    var newKeys = keys.replace('[',"");
    keys = newKeys.replace(']',"");
    var keyArr = (keys.indexOf(',') != -1)? keys.split(','):new Array(keys);
    //console.log('Key after replace: '+keys)       
    for(var i=0;i&amp;lt;keyArr.length;i++){
        var keyName = keyArr[i].trim().replace('',"").replace("\"","").replace('\"','');
        var subTypeJsonObjStr = jsonObj[keyName].replace('#livetablePager','#livetablePager_'+keyName)
        var subTypeJsonObj = $.parseJSON(subTypeJsonObjStr);
        $("#livetableList_"+keyName).jqGrid(subTypeJsonObj);
        $("#livetableList_"+keyName).jqGrid('navGrid', "#livetablePager_"+keyName, {
           edit : false,
           add : false,
           del : false,
           search:false
         });
    }
    
  }else{ /** Store**/        
      $("#livetableList").jqGrid(jsonObj);
      $("#livetableList").jqGrid('navGrid', "#livetablePager", {
           edit : false,
           add : false,
           del : false,
           search:false
           
       });
   }
});
        
jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;process&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;881686cc-1bfc-456e-b8ab-71334c4a45e5&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){

	$(function () {
		function drawLineChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerline' + container).highcharts({

				chart: {
					type:'line'
				},
				title: {
					text: chart_name
				},
				tooltip :{
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				xAxis: dataXAxis ,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				series: dataSeries
			});
		};

		function drawBarChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerbar' + container).highcharts({
				chart: {
					type: 'column'
				},
				title: {
					text: chart_name
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {

					column: {
						pointPadding: 0.2,
						borderWidth: 0
					}
				},
				series: dataSeries
			});
		}

		function drawAreaChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail
			$('#containerarea' + container).highcharts({
				chart: {
					type: 'area'
				},
				title: {
					text: chart_name
				},
				subtitle: {
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					},
					labels: {
						formatter: function() {
							return this.value / 1000;
						}
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {
					area: {
						stacking: 'normal',
						lineColor: '#666666',
						lineWidth: 1,
						marker: {
							lineWidth: 1,
							lineColor: '#666666'
						}
					}
				},
				series: dataSeries
			});
		};

		function drawPieChart(data, container, chartName){
			var dataPie = data
			$(document).ready(function () {
				// Build the chart
				$('#container' + container).highcharts({
					chart: {
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: chartName
					},
					tooltip: {
						pointFormat: '{series.name}: &amp;lt;b&amp;gt;{point.percentage:.1f}%&amp;lt;/b&amp;gt;'
					},
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							dataLabels: {
								enabled: true,
                                                                color: '#000000',
                                                                connectorColor: '#000000',
                                                                format: '&amp;lt;b&amp;gt;{point.name}&amp;lt;/b&amp;gt;: {point.percentage:.1f} %'
							},
							showInLegend: true
						}
					},
					series: dataPie
				});
			});
		}

		// LINE
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                     if(($("#jsons&amp;gt;#jsonline_" + finalKey)).length &amp;gt; 0) {
					var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonline_" + finalKey).val());
					var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerline_" + finalKey).val());
				        var lstContainer = [];
  				        var data_all = [];
                                        var chartSize = arrayAll.length

                                        for(var i=0;i&amp;lt;chartSize ;i++){
                                           data_all = arrayAll[i]
                                           lstContainer = arrayContainerAll[i]
				           if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					        // data to display on tooltip
					        var data_detail = data_all[0]
					        // draw Line chart
				        	for(var j=0;j&amp;lt;data_all.length;j++){
				        		if(data_all[j].series[0].name == null){
				        			data_all[j].series[0].name = lstContainer[j]
					        	}
                                                        chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					        	drawLineChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					        }
				         }
                                      }
                                  }
				}
			} else {
				var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonline").val());
				var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerline").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length

                                for(var i=0;i&amp;lt;chartSize ;i++){
                                   data_all = arrayAll[i]
                                   lstContainer = arrayContainerAll[i]
				   if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Line chart
					for(var j=0;j&amp;lt;data_all.length;j++){
						if(data_all[j].series[0].name == null){
							data_all[j].series[0].name = lstContainer[j]
						}
                                                chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
						drawLineChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
				   }
                                }
			}
		});

		// BAR
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
			             var finalKey = lstKey[eKey]
                                     if(($("#jsons&amp;gt;#jsonbar_" + finalKey)).length &amp;gt; 0) {
					var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonbar_" + finalKey).val());
					var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerbar_" + finalKey).val());
					var lstContainer = [];
					var data_all = [];
                                        var chartSize = arrayAll.length
					for(var i=0;i&amp;lt;chartSize ;i++){
					    data_all = arrayAll[i]
					    lstContainer = arrayContainerAll[i]
					    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw bar chart
						for(var j=0;j&amp;lt;data_all.length;j++){
							if(data_all[j].series[0].name == null){
								data_all[j].series[0].name = lstContainer[j]
							}
                                                        chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
							drawBarChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
						}
                                            }
					}
                                    }
				}
			} else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonbar").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerbar").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
				    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Bar chart
					for(var j=0;j&amp;lt;data_all.length;j++){
                                            if(data_all[j].series[0].name == null){
						data_all[j].series[0].name = lstContainer[j]
					    }
                                            chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					    drawBarChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
                                    }
				}
			}
		});

		// AREA
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
                        var arrayAll
                        var arrayContainerAll
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                        if(($("#jsons&amp;gt;#jsonarea_" + finalKey)).length &amp;gt; 0) {
                                           arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonarea_" + finalKey).val());
                                           arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerarea_" + finalKey).val());
					   var lstContainer = [];
					   var data_all = [];
                                           var chartSize = arrayAll.length
					   for(var i=0;i&amp;lt;chartSize ;i++){
					       data_all = arrayAll[i]
					       lstContainer = arrayContainerAll[i]
					       if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						   // data to display on tooltip
						   var data_detail = data_all[0]
						   // draw Line chart
						   for(var j=0;j&amp;lt;data_all.length;j++){
						      if(data_all[j].series[0].name == null){
						         data_all[j].series[0].name = lstContainer[j]
						       }
                                                       chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
						       drawAreaChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
						   }
					      }
				           }
                                        }
			          }
                        } else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonarea").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerarea").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
				    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw area chart
					for(var j=0;j&amp;lt;data_all.length;j++){
                                            if(data_all[j].series[0].name == null){
						data_all[j].series[0].name = lstContainer[j]
					    }
                                            chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					    drawAreaChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
                                    }
				}
			}
		});

		// PIE
		$(document ).ready(function(){
                        var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
                        var arrayAll
                        var arrayContainerAll
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                        if(($("#jsons&amp;gt;#jsonpie_" + finalKey)).length &amp;gt; 0) {
                                           arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonpie_" + finalKey).val());
                                           arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerpie_" + finalKey).val());
					   var lstContainer = [];
					   var data_all = [];
                                           var chartSize = arrayAll.length
					  for(var i=0;i&amp;lt;chartSize ;i++){
					       data_all = arrayAll[i]
console.log(data_all)
					       lstContainer = arrayContainerAll[i]
					       if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						   // draw Pie chart
						   for(var j=0;j&amp;lt;data_all.length;j++){
                                                       //chartName = data_all[j].chart_name
                                                       chartName  = data_all[j].name
						       drawPieChart(data_all, finalKey + "_" + lstContainer[j], chartName)
						   }
					      }
				           }
                                        }
			          }
			} else {/*
				var array = $("#jsons&amp;gt;.jsonpie");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerpie");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					// draw Pie Chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						var finalData = []
						finalData[0] = data_all[0][i]
						//drawPieChart(finalData, lstContainer[0][i])
					}
				}*/
			}
		});
	});
	jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;d5873d92-b78b-42fc-9407-46d166204b88&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;/* css for timepicker */
.ui-timepicker-div .ui-widget-header { 
margin-bottom: 8px;
 }

.ui-timepicker-div dl { text-align: left; }
.ui-timepicker-div dl dt { height: 25px; margin-bottom: -25px; }
.ui-timepicker-div dl dd { margin: 0 10px 10px 65px; }
.ui-timepicker-div td { font-size: 90%; }
.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }

.ui-timepicker-rtl{ direction: rtl; }
.ui-timepicker-rtl dl { text-align: right; }
.ui-timepicker-rtl dl dd { margin: 0 65px 10px 10px; }
#ui-datepicker-div{
 position:relative;
 width:auto;
 height:auto
}
&lt;/code&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;datetimepicker -css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;1201fb1a-e9c1-4731-8c74-2ea8c0071959&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;.displayblock {
  border:2px solid;
  -webkit-border-radius:6px;
  background:gray;
  float: left;
  width:100%;
}

.displaypie {
  border:1px solid;
  -webkit-border-radius:6px;
  background:gray;
  width: 48%;
  float: left; 
  height: 300px;
}

.subtype {
  margin-top: 50px;
  font-size: 2em;
  color: red;
}&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;content&gt;{{include document="Lib.DataToDrawChart"/}}
{{include document="Lib.MongoDBConnection"/}}
{{velocity}}
$xwiki.jsx.use('Lib.JQueryUILib')
$xwiki.ssx.use('Lib.MenuGenerator')
$xwiki.jsx.use('Lib.MenuGenerator')
$xwiki.ssx.use('Lib.JQueryUILib')
$xwiki.jsx.use('Lib.JqGridLib')
$xwiki.ssx.use('Lib.JqGridLib') 
{{/velocity}}
{{include document="Lib.MenuGenerator"/}}
{{html wiki="true" clean="false"}}
&amp;lt;div id="viewer"&amp;gt;
&amp;lt;table style="text-align:left"  &amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th &amp;gt;Job name&amp;lt;/th&amp;gt;
  &amp;lt;td colspan=3&amp;gt;&amp;lt;div id="jobname"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
{{groovy}}
import org.xwiki.context.*

def ec = services.component.getInstance(Execution.class).getContext()
def mapJobIstIid = ec.getProperty("mapJobIstIid")

println '{{html clean="false" wiki="false"}}'
println '&amp;lt;tr&amp;gt;'
println '&amp;lt;th&amp;gt;IstIid&amp;lt;/th&amp;gt;'
println '&amp;lt;td colspan=3&amp;gt;'
mapJobIstIid.each{jobEntry-&amp;gt;
  def convertedJobKey = jobEntry.key.replaceAll("\\.","_")
  println "&amp;lt;div id='listIstIid'&amp;gt;"
  println "&amp;lt;div id=IstIid${convertedJobKey} style='display:none'&amp;gt;"
  println "&amp;lt;select id=select_${convertedJobKey}&amp;gt;"
  jobEntry.value.each{
     println "&amp;lt;option value=\"$it\"&amp;gt;$it&amp;lt;/option&amp;gt;"
  }
  println "&amp;lt;/select&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
}
println '&amp;lt;/td&amp;gt;'
println '&amp;lt;/tr&amp;gt;'
println '{{/html}}'
{{/groovy}}
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data monitor from&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="from-date" id="from-date"/&amp;gt;&amp;lt;/td&amp;gt;
  &amp;lt;th&amp;gt;Data monitor to&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="to-date" id="to-date"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data records limit &amp;lt;/th&amp;gt;
  &amp;lt;td &amp;gt;
     &amp;lt;select id="limit"&amp;gt;
       &amp;lt;option value=5&amp;gt;5&amp;lt;/option&amp;gt;
       &amp;lt;option value=10&amp;gt;10&amp;lt;/option&amp;gt;
       &amp;lt;option value=15&amp;gt;15&amp;lt;/option&amp;gt;
       &amp;lt;option value=20&amp;gt;20&amp;lt;/option&amp;gt;
     &amp;lt;/select&amp;gt;
  &amp;lt;/td&amp;gt;
  &amp;lt;td colspan=3 &amp;gt;&amp;lt;input type="button" value="View Data" id="get-data" class="button"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;&amp;lt;div id="display"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
  &amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
&amp;lt;/table&amp;gt;

&amp;lt;/div&amp;gt; 
   
 &amp;lt;/body&amp;gt;

{{/html}}
{{groovy}}
import groovy.json.*
xwiki.jsx.use("Lib.Highcharts")

if(request.xpage == "plain") {
	response.setContentType('text/plain')
}

def listData = []
def job = request.get("job")
def fromDate = request.get("fromDate")
def toDate = request.get("toDate")
def limit= (request.get("limit")!=null)?request.get("limit").toInteger():10
def istIid = request.get("IstIid")

def str= "No data to retrieved !"
def result = null
if(job != "" &amp;amp;&amp;amp; job != null &amp;amp;&amp;amp; istIid != null &amp;amp;&amp;amp; istIid != ""){
	MongoDBConnection.getConnection()
	if(fromDate != "" || toDate != ""){
		result = MongoDBConnection.getDataInPeriod(job,fromDate,toDate,limit,istIid)
	} else {
		result = MongoDBConnection.getDataAllFields(job,limit,istIid)
        }
MongoDBConnection.closeConnection()
} else {
   println "{{warning}}There are no selected job or IstIid{{/warning}}"
}
def listKey = []
if( (result != null) &amp;amp;&amp;amp; (result.size() &amp;gt; 0) &amp;amp;&amp;amp; (result[0].KEYEXPR != null)&amp;amp;&amp;amp;!(result[0].KEYEXPR instanceof List )){

if(result[0].type == "Subtyped") {
    println '{{html clean="false" wiki="true"}}'
    //println '&amp;lt;body&amp;gt;'
    def dataSubtype = DataToDrawChart.getDataToDrawSubtype(result)
    dataSubtype.each {key,value -&amp;gt;
        listKey.add(key)
    }
    def jsonkey = com.mongodb.util.JSON.serialize(listKey)
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$jsonkey&amp;lt;/textarea&amp;gt;"

    dataSubtype.each {key,value -&amp;gt;
            def dataLine = []
            def dataBar = []
            def dataPie = []
            def dataArea = []
            if(DataToDrawChart.getDataToDrawLine(value) != []) {
                dataLine = DataToDrawChart.getDataToDrawLine(value)
            }
            if(DataToDrawChart.getDataToDrawBar(value) != []) {
                dataBar = DataToDrawChart.getDataToDrawBar(value)
            }
            if(DataToDrawChart.getDataToDrawPie(value) != []) {
                dataPie = DataToDrawChart.getDataToDrawPie(value)
            }
            if(DataToDrawChart.getDataToDrawArea(value) != []) {
                dataArea = DataToDrawChart.getDataToDrawArea(value)
            }

		def chartColumnsLine = []
		def chartColumnsBar = []
		def chartColumnsArea = []
		def lstName

                dataLine.each {itemDataLine -&amp;gt;
                    if(itemDataLine.size() &amp;gt; 0 ){
		        chartColumnsLine.add(itemDataLine[0].chart_columns)
	            }
                }
                dataBar.each {itemDataBar -&amp;gt;
                    if(itemDataBar.size() &amp;gt; 0 ){
		        chartColumnsBar.add(itemDataBar[0].chart_columns)
	            }
                }
                dataArea.each {itemDataArea -&amp;gt;
                    if(itemDataArea.size() &amp;gt; 0 ){
		        chartColumnsArea.add(itemDataArea[0].chart_columns)
	            }
                }
println "dataPie" + dataPie
		if(dataPie.size() &amp;gt; 0 ){
			lstName = dataPie['name']
		}
		def tmpListNameContainer = []
                
		if(lstName != null) {
                        def chartNumPie = 0
                        def tmpLst
                        for(def nameContainer in lstName){
                           tmpLst = []
			   for(def nameContainerItem in nameContainer ){
                                println "nameContainerItem :" + nameContainerItem 
				nameContainerItem = chartNumPie + "_" + nameContainerItem.replaceAll("\\.", "_")
                                //nameContainerItem = nameContainerItem.replaceAll("\\.", "_")
				tmpLst.add(nameContainerItem )
		            }
                            tmpListNameContainer.add(tmpLst)
                            chartNumPie++
                         }
		}
		def jsonPie
		def jsonLine
		def jsonBar
		def jsonArea
		if(dataPie != []) {
		    jsonPie = com.mongodb.util.JSON.serialize(dataPie)
		}
		if(dataLine != []) {
		    jsonLine = com.mongodb.util.JSON.serialize(dataLine)
		}
		if(dataBar != []) {
		    jsonBar = com.mongodb.util.JSON.serialize(dataBar)
		}
		if(dataArea != []) {
		    jsonArea = com.mongodb.util.JSON.serialize(dataArea)
		}
		def jsonContainerPie
		if(tmpListNameContainer != []) {
			jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
		}
		def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
		def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
		def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

		println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
		if(jsonLine != null) {
			println "&amp;lt;textarea id=\"jsonline_$key\" &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class=\"lstcontainerline_$key\" &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
		}
		if(jsonBar != null) {
			println "&amp;lt;textarea id=\"jsonbar_$key\"&amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerbar_$key' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
		}
		if(jsonPie != null &amp;amp;&amp;amp; jsonContainerPie != null) {
			println "&amp;lt;textarea id=\"jsonpie_$key\" &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerpie_$key' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
		}
		if(jsonArea != null) {
			println "&amp;lt;textarea id=\"jsonarea_$key\" &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerarea_$key' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
		}

        println "&amp;lt;/div&amp;gt;"
          println "jsonPie" + jsonPie
          println "jsonContainerPie " + jsonContainerPie 
        def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
        def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
          
        println "&amp;lt;div style='clear:both'&amp;gt;"
            def description = value.KEYEXPR._description[0][key]
            if(description != null) {
                println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +': ' + description +'&amp;lt;/div&amp;gt;'
            } else {
                println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +'&amp;lt;/div&amp;gt;'
            }
            println "-----"
            if(jsonPie != null) {
          println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
		chartNumPie = 0
          lstName.each{chartPieLst -&amp;gt;
		chartPieLst.each {
println "container${key}_${tmp}"
	            //def tmp = chartNumPie + "_" + it.replaceAll("\\.", "_")
		   // println " &amp;lt;div class=\"displaypie\" id=\"container${key}_${tmp}\" &amp;gt;&amp;lt;/div&amp;gt;"
          	}
		chartNumPie++
	  }	
          println "&amp;lt;/div&amp;gt;"
            }
            if(jsonLine != null) {
          	def chartLineComment = false
		def chartNumLine = 0
          	chartColumnsLine.each{chartColumnsLineItem -&amp;gt;
            		if(!chartLineComment){
               			println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
               			chartLineComment = true  
            		}
		chartColumnsLineItem.each{
              		println " &amp;lt;div class=\"displayblock\" id=\"containerline${key}_${chartNumLine}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          	}
		chartNumLine ++
	    }
          println "&amp;lt;/div&amp;gt;"
            }
            println "&amp;amp;nbsp;"

            if(jsonBar != null) {
          	def chartBarComment = false
  		def chartNumBar = 0
          	chartColumnsBar.each{chartColumnsBarItem -&amp;gt;
             		if(!chartBarComment){
                		println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
                		chartBarComment = true
              		}  
			chartColumnsBarItem.each{
             			println " &amp;lt;div class=\"displayblock\" id=\"containerbar${key}_${chartNumBar}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          		}
			chartNumBar++
		}
          	println "&amp;lt;/div&amp;gt;"
            }
            println "&amp;amp;nbsp;"

            if(jsonArea != null) {
          	def chartAreaComment = false
		def chartNumArea = 0
          	chartColumnsArea.each{chartColumnsAreaItem -&amp;gt;
          		if(!chartAreaComment){
            			println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
            			chartAreaComment = true
          		}
			chartColumnsAreaItem.each{
            			println " &amp;lt;div class=\"displayblock\" id=\"containerarea${key}_${chartNumArea}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          		}
          		chartNumArea++
            	}
        	println "&amp;lt;/div&amp;gt;"
	    }
        /** Statistic data table **/
        println "&amp;lt;center&amp;gt;"        
        println "&amp;lt;div id='livetblContent_"+key+"' style='width:100%;clear:both;align:middle;margin-top:10px'&amp;gt;"   
        println "Statistics data for "+key
        println "&amp;lt;table id='livetableList_"+key+"' style='width:100%;align:center'&amp;gt;&amp;lt;/table&amp;gt;"
        println "&amp;lt;div id='livetablePager_"+key+"' style='position:relative;width:100%'&amp;gt;&amp;lt;/div&amp;gt;"
        println "&amp;lt;/div&amp;gt;"
        println "&amp;lt;/center&amp;gt;"
        println "&amp;lt;script language='javascript'&amp;gt;console.log('Create live table for "+key+"');&amp;lt;/script&amp;gt;"
    }
    //println '&amp;lt;/body&amp;gt;'
    println '{{/html}}'
} else if(result[0].type == "Store") {
	// data store
	def dataLine = DataToDrawChart.getDataToDrawLine(result)
	def dataBar = DataToDrawChart.getDataToDrawBar(result)
	def dataPie = DataToDrawChart.getDataToDrawPie(result)
	def dataArea = DataToDrawChart.getDataToDrawArea(result)
	def chartColumnsLine = []
	def chartColumnsBar = []
	def chartColumnsArea = []
	def lstName

        dataLine.each {itemDataLine -&amp;gt;
            if(itemDataLine.size() &amp;gt; 0 ){
		chartColumnsLine.add(itemDataLine[0].chart_columns)
	    }
        }

        dataBar.each {itemDataBar -&amp;gt;
            if(itemDataBar.size() &amp;gt; 0 ){
		chartColumnsBar.add(itemDataBar[0].chart_columns)
	    }
        }

        dataArea.each {itemDataArea -&amp;gt;
            if(itemDataArea.size() &amp;gt; 0 ){
		chartColumnsArea.add(itemDataArea[0].chart_columns)
	    }
        }

	if(dataPie.size() &amp;gt; 0 ){
		lstName = dataPie['name']
	}

    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
  
    def tmpListNameContainer = []
    def chartNumPie = 0
    for(def nameContainer in lstName){
       for(def nameContainerItem in nameContainer ){
           nameContainerItem = chartNumPie + "_" + nameContainerItem.replaceAll("\\.", "_")
           tmpListNameContainer .add(nameContainerItem )
       }
    }
    
    def jsonPie = com.mongodb.util.JSON.serialize(dataPie)
    def jsonLine = com.mongodb.util.JSON.serialize(dataLine)
    def jsonBar = com.mongodb.util.JSON.serialize(dataBar)
    def jsonArea = com.mongodb.util.JSON.serialize(dataArea)

    def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
    def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
    def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
    def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

    def listEmpty = com.mongodb.util.JSON.serialize([])
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$listEmpty&amp;lt;/textarea&amp;gt;" 

    println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
    println "&amp;lt;textarea class='jsonline' &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonbar' &amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonpie' &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonarea' &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"

    println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;/div&amp;gt;"

    def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
    def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
  
    println "&amp;lt;div style='clear:both'&amp;gt;"
  
    def chartPieComment = false
    chartNumPie = 0
    lstName.each{chartPieLst-&amp;gt;
        if(!chartPieComment) {
            println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
            chartPieComment = true
        }
        chartPieLst.each {
            def tmp = chartNumPie + "_pie"
            println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
        }
    }
    println "&amp;lt;/div&amp;gt;"
    	def chartLineComment = false
	def chartNum = 0
    	chartColumnsLine.each{chartColumnsLineItem -&amp;gt;
	    	if(!chartLineComment){
	        	println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	        	chartLineComment = true  
	    	}
		chartColumnsLineItem.each{
	    		println " &amp;lt;div class=\"displayblock\" id=\"containerline${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	    	}
		chartNum++
	}	
    	println "&amp;lt;/div&amp;gt;"
    	println "&amp;amp;nbsp;"
    	def chartBarComment = false
	chartNum = 0
    	chartColumnsBar.each{chartColumnsBarItem -&amp;gt;
	        if(!chartBarComment){
	            println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	            chartBarComment = true
	        }  
		chartColumnsBarItem.each{
	    		println " &amp;lt;div class=\"displayblock\" id=\"containerbar${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  	}
		chartNum++
	}
  println "&amp;lt;/div&amp;gt;"
  println "&amp;amp;nbsp;"
  	def chartAreaComment = false
	chartNum = 0
  	chartColumnsArea.each{chartColumnsAreaItem -&amp;gt;
	  	if(!chartAreaComment){
	    		println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	    		chartAreaComment = true
	  	}
		chartColumnsAreaItem.each{
    			println " &amp;lt;div class=\"displayblock\" id=\"containerarea${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
		}
		chartNum++
  	}
  println "&amp;lt;/div&amp;gt;"
println "&amp;lt;/div&amp;gt;"

//println '&amp;lt;/body&amp;gt;'
println '{{/html}}'
}
}else{
    println 'There is no data for this job with criterias'
}
//--=============== Start build for livetable
def subTypeURLMap = [:]
def dataModel = []
def dataUrl = ""
result.find{rec-&amp;gt;				
    def subtractData = []
    
    //-- Parsing data and assign data to subtract list
    if(rec.type == "Store"){ //-- Store data type
        subtractData = rec['data']        
        subtractData.each{r2-&amp;gt;					
            if(dataModel != null &amp;amp;&amp;amp; dataModel.size() &amp;lt;=0){ 
                dataModel.add("Fetch At")
                dataModel.addAll(r2.keySet());					
            } 
        }        
        dataUrl = "/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job="+job +"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate + "&amp;amp;toDate=" + toDate + "&amp;amp;istIid="+istIid        
        //-- Building data model				
        def model = []
        def colSpec
        dataModel.each{name-&amp;gt;
            colSpec = [:]
            colSpec['name'] = name
            colSpec['index'] = name
            colSpec['width'] = "100"
            model.add(colSpec)
        }
        def dataModelStr = (new JsonBuilder(dataModel)).toPrettyString()
        def modelStr = (new JsonBuilder(model)).toPrettyString() 
        str = 
        "{\"url\":\""+dataUrl+"\",\"datatype\":\"json\","+
            "\"colNames\":"+ dataModelStr +
            ",\"colModel\":"+ modelStr +" ,\"rowList\":[10,20,30],"+
            "\"pager\":\"#livetablePager\", \"viewrecords\": true, \"sortname\": \"RECORD_SEQ\","+
            "\"sortorder\": \"asc\", \"caption\":\""+job+"\"}"
        println "{{html clean=\"false\" wiki=\"true\"}}"
        println "&amp;lt;div id='livetableJson' style = \"display:none\"&amp;gt;"
        //println "&amp;lt;div id='livetableJson'&amp;gt;"
        println str;
        println "&amp;lt;/div&amp;gt;"
        println "{{/html}}"
    }else{ //-- Subtype			
        def subData = rec['data']
        subData.each{key,value-&amp;gt;
            dataUrl = "/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job="+job +"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate + "&amp;amp;toDate=" + toDate + "&amp;amp;istIid="+istIid+"&amp;amp;subType="+key
            subtractData = value
            subtractData.each{r2-&amp;gt;					
                if(dataModel != null &amp;amp;&amp;amp; dataModel.size() &amp;lt;=0){ 
                    dataModel.add("Fetch At")
                    dataModel.addAll(r2.keySet());					
                } 			
            }
            //-- Building data model				
            def model = []
            def colSpec
            dataModel.each{name-&amp;gt;
                colSpec = [:]
                colSpec['name'] = name
                colSpec['index'] = name
                colSpec['width'] = "100"
                model.add(colSpec)
            }
            def dataModelStr = (new JsonBuilder(dataModel)).toPrettyString()
            def modelStr = (new JsonBuilder(model)).toPrettyString() 
            str = 
            "{\"url\":\""+dataUrl+"\",\"datatype\":\"json\","+
                "\"colNames\":"+ dataModelStr +
                ",\"colModel\":"+ modelStr +" ,\"rowList\":[10,20,30],"+
                "\"pager\":\"#livetablePager\", \"viewrecords\": true, \"sortname\": \"RECORD_SEQ\","+
                "\"sortorder\": \"asc\", \"caption\":\""+job+"\"}"
            subTypeURLMap[key] = str
        }
        def finalStr = (new JsonBuilder(subTypeURLMap)).toPrettyString()
        println "{{html clean=\"false\" wiki=\"true\"}}"
        println "&amp;lt;div id='livetableJson' style = \"display:none\"&amp;gt;"
        //println "&amp;lt;div id='livetableJson'&amp;gt;"
        println finalStr;
        println "&amp;lt;/div&amp;gt;"
        println "{{/html}}"
    }
    return true
}
 //--=============== END

if(listKey.size() &amp;lt;= 0){   
    println "{{html clean=\"false\" wiki=\"true\"}}"
    println "&amp;lt;center&amp;gt;"
    println "&amp;lt;div id=\"livetblContent\" style=\"width:100%;clear:both;align:middle;margin-top:10px\"&amp;gt;"   
    println "Statistics Data"
    println "&amp;lt;table id=\"livetableList\" style=\"width:100%;align:center\"&amp;gt;&amp;lt;/table&amp;gt;"    
    println "&amp;lt;div id=\"livetablePager\"&amp;gt;&amp;lt;/div&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
    println "&amp;lt;/center&amp;gt;"
    
    println "&amp;lt;div id=\"testDiv\"&amp;gt;&amp;amp;nbsp;&amp;lt;/div&amp;gt;"
    println "{{/html}}"
}
{{/groovy}}
&lt;/content&gt;&lt;/xwikidoc&gt;@


61.22
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376557864000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376557864000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.22&lt;/version&gt;
a3542 1
println "dataPie" + dataPie['name']
d3593 1
a3593 2
            def tmp = chartNumPie + "_" + it.replaceAll("\\.", "_")
println "tmp:" + tmp 
@


61.21
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376557792000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376557792000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.21&lt;/version&gt;
d3543 1
a3543 1
println "dataPie" + dataPie
@


61.20
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376557665000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376557665000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.20&lt;/version&gt;
d3543 1
@


61.19
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376557392000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376557392000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.19&lt;/version&gt;
d3359 1
@


61.18
log
@@
text
@&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xwikidoc&gt;
&lt;web&gt;WiperDog&lt;/web&gt;
&lt;name&gt;WebHome&lt;/name&gt;
&lt;language&gt;&lt;/language&gt;
&lt;defaultLanguage&gt;en&lt;/defaultLanguage&gt;
&lt;translation&gt;0&lt;/translation&gt;
&lt;parent&gt;&lt;/parent&gt;
&lt;creator&gt;XWiki.Admin&lt;/creator&gt;
&lt;author&gt;XWiki.Admin&lt;/author&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;contentAuthor&gt;XWiki.Admin&lt;/contentAuthor&gt;
&lt;creationDate&gt;1376364375000&lt;/creationDate&gt;
&lt;date&gt;1376557192000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376557115000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.18&lt;/version&gt;
&lt;title&gt;WiperDog&lt;/title&gt;
&lt;defaultTemplate&gt;&lt;/defaultTemplate&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;comment&gt;&lt;/comment&gt;
&lt;minorEdit&gt;true&lt;/minorEdit&gt;
&lt;syntaxId&gt;xwiki/2.1&lt;/syntaxId&gt;
&lt;hidden&gt;false&lt;/hidden&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;047293a8-524d-45e4-af52-cd944523d5d0&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
/*
 * jQuery timepicker addon
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 1.3.1
 * Last Modified: 07/07/2013
 *
 * Copyright 2013 Trent Richardson
 * You may use this project under MIT or GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 */

/*jslint evil: true, white: false, undef: false, nomen: false */

(function($) {

	/*
	* Lets not redefine timepicker, Prevent "Uncaught RangeError: Maximum call stack size exceeded"
	*/
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return;
	}

	/*
	* Extend jQueryUI, get it started with our version number
	*/
	$.extend($.ui, {
		timepicker: {
			version: "1.3.1"
		}
	});

	/* 
	* Timepicker manager.
	* Use the singleton instance of this class, $.timepicker, to interact with the time picker.
	* Settings for (groups of) time pickers are maintained in an instance object,
	* allowing multiple different settings on the same page.
	*/
	var Timepicker = function() {
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[''] = { // Default regional settings
			currentText: 'Now',
			closeText: 'Done',
			amNames: ['AM', 'A'],
			pmNames: ['PM', 'P'],
			timeFormat: 'HH:mm',
			timeSuffix: '',
			timeOnlyTitle: 'Choose Time',
			timeText: 'Time',
			hourText: 'Hour',
			minuteText: 'Minute',
			secondText: 'Second',
			millisecText: 'Millisecond',
			microsecText: 'Microsecond',
			timezoneText: 'Time Zone',
			isRTL: false
		};
		this._defaults = { // Global defaults for all the datetime picker instances
			showButtonPanel: true,
			timeOnly: false,
			showHour: null,
			showMinute: null,
			showSecond: null,
			showMillisec: null,
			showMicrosec: null,
			showTimezone: null,
			showTime: true,
			stepHour: 1,
			stepMinute: 1,
			stepSecond: 1,
			stepMillisec: 1,
			stepMicrosec: 1,
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null,
			hourMin: 0,
			minuteMin: 0,
			secondMin: 0,
			millisecMin: 0,
			microsecMin: 0,
			hourMax: 23,
			minuteMax: 59,
			secondMax: 59,
			millisecMax: 999,
			microsecMax: 999,
			minDateTime: null,
			maxDateTime: null,
			onSelect: null,
			hourGrid: 0,
			minuteGrid: 0,
			secondGrid: 0,
			millisecGrid: 0,
			microsecGrid: 0,
			alwaysSetTime: true,
			separator: ' ',
			altFieldTimeOnly: true,
			altTimeFormat: null,
			altSeparator: null,
			altTimeSuffix: null,
			pickerTimeFormat: null,
			pickerTimeSuffix: null,
			showTimepicker: true,
			timezoneList: null,
			addSliderAccess: false,
			sliderAccessArgs: null,
			controlType: 'slider',
			defaultValue: null,
			parse: 'strict'
		};
		$.extend(this._defaults, this.regional['']);
	};

	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: '',
		formattedDate: '',
		formattedTime: '',
		formattedDateTime: '',
		timezoneList: null,
		units: ['hour','minute','second','millisec', 'microsec'],
		support: {},
		control: null,

		/* 
		* Override the default settings for all instances of the time picker.
		* @@param  settings  object - the new settings to use as defaults (anonymous object)
		* @@return the manager object
		*/
		setDefaults: function(settings) {
			extendRemove(this._defaults, settings || {});
			return this;
		},

		/*
		* Create a new Timepicker instance
		*/
		_newInst: function($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
            	fns = {},
		    	overrides, i;

			for (var attrName in this._defaults) {
				if(this._defaults.hasOwnProperty(attrName)){
					var attrValue = $input.attr('time:' + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue);
						} catch (err) {
							inlineSettings[attrName] = attrValue;
						}
					}
				}
			}

		    overrides = {
		        beforeShow: function (input, dp_inst) {
		            if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
		                return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst);
		            }
		        },
		        onChangeMonthYear: function (year, month, dp_inst) {
		            // Update the time as well : this prevents the time from disappearing from the $input field.
		            tp_inst._updateDateTime(dp_inst);
		            if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
		                tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst);
		            }
		        },
		        onClose: function (dateText, dp_inst) {
		            if (tp_inst.timeDefined === true &amp;amp;&amp;amp; $input.val() !== '') {
		                tp_inst._updateDateTime(dp_inst);
		            }
		            if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
		                tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst);
		            }
		        }
		    };
		    for (i in overrides) {
		        if (overrides.hasOwnProperty(i)) {
		            fns[i] = opts[i] || null;
		        }
		    }

		    tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
		        evnts:fns,
		        timepicker: tp_inst // add timepicker as a property of datepicker: $.datepicker._get(dp_inst, 'timepicker');
		    });
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function(val) {
				return val.toUpperCase();
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function(val) {
				return val.toUpperCase();
			});

			// detect which units are supported
			tp_inst.support = detectSupport(
					tp_inst._defaults.timeFormat + 
					(tp_inst._defaults.pickerTimeFormat? tp_inst._defaults.pickerTimeFormat:'') + 
					(tp_inst._defaults.altTimeFormat? tp_inst._defaults.altTimeFormat:''));

			// controlType is string - key to our this._controls
			if(typeof(tp_inst._defaults.controlType) === 'string'){
				if(tp_inst._defaults.controlType == 'slider' &amp;amp;&amp;amp; typeof(jQuery.ui.slider) === 'undefined'){
					tp_inst._defaults.controlType = 'select';
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType];
			}
			// controlType is an object and must implement create, options, value methods
			else{ 
				tp_inst.control = tp_inst._defaults.controlType;
			}

			// prep the timezone options
			var timezoneList = [-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,
					0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList;
			}
			var tzl=timezoneList.length,tzi=0,tzv=null;
			if (tzl &amp;gt; 0 &amp;amp;&amp;amp; typeof timezoneList[0] !== 'object') {
				for(; tzi&amp;lt;tzl; tzi++){
					tzv = timezoneList[tzi];
					timezoneList[tzi] = { value: tzv, label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601) };
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;

			// set the default units
			tp_inst.timezone = tp_inst._defaults.timezone !== null? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) : 
							((new Date()).getTimezoneOffset()*-1);
			tp_inst.hour = tp_inst._defaults.hour &amp;lt; tp_inst._defaults.hourMin? tp_inst._defaults.hourMin : 
							tp_inst._defaults.hour &amp;gt; tp_inst._defaults.hourMax? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute &amp;lt; tp_inst._defaults.minuteMin? tp_inst._defaults.minuteMin : 
							tp_inst._defaults.minute &amp;gt; tp_inst._defaults.minuteMax? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second &amp;lt; tp_inst._defaults.secondMin? tp_inst._defaults.secondMin : 
							tp_inst._defaults.second &amp;gt; tp_inst._defaults.secondMax? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec &amp;lt; tp_inst._defaults.millisecMin? tp_inst._defaults.millisecMin : 
							tp_inst._defaults.millisec &amp;gt; tp_inst._defaults.millisecMax? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec &amp;lt; tp_inst._defaults.microsecMin? tp_inst._defaults.microsecMin : 
							tp_inst._defaults.microsec &amp;gt; tp_inst._defaults.microsecMax? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = '';
			tp_inst.$input = $input;

			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField).css({
					cursor: 'pointer'
				}).focus(function() {
					$input.trigger("focus");
				});
			}

			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date();
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date();
			}

			// datepicker needs minDate/maxDate, timepicker needs minDateTime/maxDateTime..
			if (tp_inst._defaults.minDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime());
			}
			if (tp_inst._defaults.minDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime());
			}
			if (tp_inst._defaults.maxDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime());
			}
			if (tp_inst._defaults.maxDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime());
			}
			tp_inst.$input.bind('focus', function() {
				tp_inst._onFocus();
			});

			return tp_inst;
		},

		/*
		* add our sliders to the calendar
		*/
		_addTimePicker: function(dp_inst) {
			var currDT = (this.$altInput &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly) ? this.$input.val() + ' ' + this.$altInput.val() : this.$input.val();

			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
		},

		/*
		* parse the time string from input value or _setTime
		*/
		_parseTime: function(timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0]);
			}

			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, 'dateFormat');
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false;
					}
					$.extend(this, parseRes.timeObj);
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err +
									"\ndate/time string = " + timeString +
									"\ntimeFormat = " + this._defaults.timeFormat +
									"\ndateFormat = " + dp_dateFormat);
					return false;
				}
				return true;
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false;
				}
				$.extend(this, timeObj);
				return true;
			}
		},

		/*
		* generate and inject html for timepicker into ui datepicker
		*/
		_injectTimePicker: function() {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = '',
				uitem = '',
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i=0,
				l=0;

			// Prevent displaying twice
			if ($dp.find("div.ui-timepicker-div").length === 0 &amp;amp;&amp;amp; o.showTimepicker) {
				var noDisplay = ' style="display:none;"',
					html = '&amp;lt;div class="ui-timepicker-div'+ (o.isRTL? ' ui-timepicker-rtl' : '') +'"&amp;gt;&amp;lt;dl&amp;gt;' + '&amp;lt;dt class="ui_tpicker_time_label"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;' + o.timeText + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_time"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the markup
				for(i=0,l=this.units.length; i&amp;lt;l; i++){
					litem = this.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// Added by Peter Medeiros:
					// - Figure out what the hour/minute/second max should be based on the step values.
					// - Example: if stepMinute is 15, then minMax is 45.
					max[litem] = parseInt((o[litem+'Max'] - ((o[litem+'Max'] - o[litem+'Min']) % o['step'+uitem])), 10);
					gridSize[litem] = 0;

					html += '&amp;lt;dt class="ui_tpicker_'+ litem +'_label"' + (show ? '' : noDisplay) + '&amp;gt;' + o[litem +'Text'] + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_'+ litem +'"&amp;gt;&amp;lt;div class="ui_tpicker_'+ litem +'_slider"' + (show ? '' : noDisplay) + '&amp;gt;&amp;lt;/div&amp;gt;';

					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						html += '&amp;lt;div style="padding-left: 1px"&amp;gt;&amp;lt;table class="ui-tpicker-grid-label"&amp;gt;&amp;lt;tr&amp;gt;';

						if(litem == 'hour'){
							for (var h = o[litem+'Min']; h &amp;lt;= max[litem]; h += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm? 'hht':'HH', {hour:h}, o);									
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + tmph + '&amp;lt;/td&amp;gt;';
							}
						}
						else{
							for (var m = o[litem+'Min']; m &amp;lt;= max[litem]; m += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + ((m &amp;lt; 10) ? '0' : '') + m + '&amp;lt;/td&amp;gt;';
							}
						}

						html += '&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;&amp;lt;/div&amp;gt;';
					}
					html += '&amp;lt;/dd&amp;gt;';
				}
				
				// Timezone
				var showTz = o.showTimezone !== null? o.showTimezone : this.support.timezone;
				html += '&amp;lt;dt class="ui_tpicker_timezone_label"' + (showTz ? '' : noDisplay) + '&amp;gt;' + o.timezoneText + '&amp;lt;/dt&amp;gt;';
				html += '&amp;lt;dd class="ui_tpicker_timezone" ' + (showTz ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the elements from string
				html += '&amp;lt;/dl&amp;gt;&amp;lt;/div&amp;gt;';
				var $tp = $(html);

				// if we only want time picker...
				if (o.timeOnly === true) {
					$tp.prepend('&amp;lt;div class="ui-widget-header ui-helper-clearfix ui-corner-all"&amp;gt;' + '&amp;lt;div class="ui-datepicker-title"&amp;gt;' + o.timeOnlyTitle + '&amp;lt;/div&amp;gt;' + '&amp;lt;/div&amp;gt;');
					$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();
				}
				
				// add sliders, adjust grids, add events
				for(i=0,l=tp_inst.units.length; i&amp;lt;l; i++){
					litem = tp_inst.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// add the slider
					tp_inst[litem+'_slider'] = tp_inst.control.create(tp_inst, $tp.find('.ui_tpicker_'+litem+'_slider'), litem, tp_inst[litem], o[litem+'Min'], max[litem], o['step'+uitem]);

					// adjust the grid and add click event
					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						size = 100 * gridSize[litem] * o[litem+'Grid'] / (max[litem] - o[litem+'Min']);
						$tp.find('.ui_tpicker_'+litem+' table').css({
							width: size + "%",
							marginLeft: o.isRTL? '0' : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL? ((size / (-2 * gridSize[litem])) + "%") : '0',
							borderCollapse: 'collapse'
						}).find("td").click(function(e){
								var $t = $(this),
									h = $t.html(),
									n = parseInt(h.replace(/[^0-9]/g),10),
									ap = h.replace(/[^apm]/ig),
									f = $t.data('for'); // loses scope, so we use data-for

								if(f == 'hour'){
									if(ap.indexOf('p') !== -1 &amp;amp;&amp;amp; n &amp;lt; 12){
										n += 12;
									}
									else{
										if(ap.indexOf('a') !== -1 &amp;amp;&amp;amp; n === 12){
											n = 0;
										}
									}
								}
								
								tp_inst.control.value(tp_inst, tp_inst[f+'_slider'], litem, n);

								tp_inst._onTimeChange();
								tp_inst._onSelectHandler();
							}).css({
								cursor: 'pointer',
								width: (100 / gridSize[litem]) + '%',
								textAlign: 'center',
								overflow: 'hidden'
							});
					} // end if grid &amp;gt; 0
				} // end for loop

				// Add timezone options
				this.timezone_select = $tp.find('.ui_tpicker_timezone').append('&amp;lt;select&amp;gt;&amp;lt;/select&amp;gt;').find("select");
				$.fn.append.apply(this.timezone_select,
				$.map(o.timezoneList, function(val, idx) {
					return $("&amp;lt;option /&amp;gt;").val(typeof val == "object" ? val.value : val).text(typeof val == "object" ? val.label : val);
				}));
				if (typeof(this.timezone) != "undefined" &amp;amp;&amp;amp; this.timezone !== null &amp;amp;&amp;amp; this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset()*-1;
					if (local_timezone == this.timezone) {
						selectLocalTimezone(tp_inst);
					} else {
						this.timezone_select.val(this.timezone);
					}
				} else {
					if (typeof(this.hour) != "undefined" &amp;amp;&amp;amp; this.hour !== null &amp;amp;&amp;amp; this.hour !== "") {
						this.timezone_select.val(o.timezone);
					} else {
						selectLocalTimezone(tp_inst);
					}
				}
				this.timezone_select.change(function() {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
				});
				// End timezone options
				
				// inject timepicker into datepicker
				var $buttonPanel = $dp.find('.ui-datepicker-buttonpane');
				if ($buttonPanel.length) {
					$buttonPanel.before($tp);
				} else {
					$dp.append($tp);
				}

				this.$timeObj = $tp.find('.ui_tpicker_time');

				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined;
				}

				// slideAccess integration: http://trentrichardson.com/2011/11/11/jquery-ui-sliders-and-touch-accessibility/
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
						
					setTimeout(function() { // fix for inline mode
						if ($tp.find('.ui-slider-access').length === 0) {
							$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);

							// fix any grids since sliders are shorter
							var sliderAccessWidth = $tp.find('.ui-slider-access:eq(0)').outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find('table:visible').each(function() {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl? 'marginRight':'marginLeft').toString().replace('%', ''),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + '%',
										css = { width: newWidth, marginRight: 0, marginLeft: 0 };
									css[rtl? 'marginRight':'marginLeft'] = newMarginLeft;
									$g.css(css);
								});
							}
						}
					}, 10);
				}
				// end slideAccess integration

				tp_inst._limitMinMaxDateTime(this.inst, true);
			}
		},

		/*
		* This function tries to limit the ability to go outside the
		* min/max date range
		*/
		_limitMinMaxDateTime: function(dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);

			if (!this._defaults.showTimepicker) {
				return;
			} // No time so nothing to check here

			if ($.datepicker._get(dp_inst, 'minDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'minDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, 'minDateTime'),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin;
				}

				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour &amp;lt;= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute &amp;lt;= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second &amp;lt;= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if(this.millisec &amp;lt;= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;lt; this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin;
									}
									this._defaults.microsecMin = this.microsecMinOriginal;
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal;
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal;
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal;
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal;
				}
			}

			if ($.datepicker._get(dp_inst, 'maxDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'maxDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, 'maxDateTime'),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax;
				}

				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour &amp;gt;= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute &amp;gt;= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second &amp;gt;= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec &amp;gt;= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;gt; this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax;
									}
									this._defaults.microsecMax = this.microsecMaxOriginal;
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal;
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal;
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal;
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal;
				}
			}

			if (adjustSliders !== undefined &amp;amp;&amp;amp; adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10);
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);

				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, 'hour', { min: this._defaults.hourMin, max: hourMax });
					this.control.value(this, this.hour_slider, 'hour', this.hour - (this.hour % this._defaults.stepHour));
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, 'minute', { min: this._defaults.minuteMin, max: minMax });
					this.control.value(this, this.minute_slider, 'minute', this.minute - (this.minute % this._defaults.stepMinute));
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, 'second', { min: this._defaults.secondMin, max: secMax });
					this.control.value(this, this.second_slider, 'second', this.second - (this.second % this._defaults.stepSecond));
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, 'millisec', { min: this._defaults.millisecMin, max: millisecMax });
					this.control.value(this, this.millisec_slider, 'millisec', this.millisec - (this.millisec % this._defaults.stepMillisec));
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, 'microsec', { min: this._defaults.microsecMin, max: microsecMax });
					this.control.value(this, this.microsec_slider, 'microsec', this.microsec - (this.microsec % this._defaults.stepMicrosec));
				}
			}

		},

		/*
		* when a slider moves, set the internal time...
		* on time change is also called when the time is updated in the text field
		*/
		_onTimeChange: function() {
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, 'hour') : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, 'minute') : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, 'second') : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, 'millisec') : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, 'microsec') : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;

			if (typeof(hour) == 'object') {
				hour = false;
			}
			if (typeof(minute) == 'object') {
				minute = false;
			}
			if (typeof(second) == 'object') {
				second = false;
			}
			if (typeof(millisec) == 'object') {
				millisec = false;
			}
			if (typeof(microsec) == 'object') {
				microsec = false;
			}
			if (typeof(timezone) == 'object') {
				timezone = false;
			}

			if (hour !== false) {
				hour = parseInt(hour, 10);
			}
			if (minute !== false) {
				minute = parseInt(minute, 10);
			}
			if (second !== false) {
				second = parseInt(second, 10);
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10);
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10);
			}

			var ampm = o[hour &amp;lt; 12 ? 'amNames' : 'pmNames'][0];

			// If the update was done in the input field, the input field should not be updated.
			// If the update was done using the sliders, update the input field.
			var hasChanged = (hour != this.hour || minute != this.minute || second != this.second || millisec != this.millisec || microsec != this.microsec 
								|| (this.ampm.length &amp;gt; 0 &amp;amp;&amp;amp; (hour &amp;lt; 12) != ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) 
								|| (this.timezone !== null &amp;amp;&amp;amp; timezone != this.timezone));

			if (hasChanged) {

				if (hour !== false) {
					this.hour = hour;
				}
				if (minute !== false) {
					this.minute = minute;
				}
				if (second !== false) {
					this.second = second;
				}
				if (millisec !== false) {
					this.millisec = millisec;
				}
				if (microsec !== false) {
					this.microsec = microsec;
				}
				if (timezone !== false) {
					this.timezone = timezone;
				}

				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0]);
				}

				this._limitMinMaxDateTime(this.inst, true);
			}
			if (this.support.ampm) {
				this.ampm = ampm;
			}

			// Updates the time within the timepicker
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if(pickerTimeFormat === o.timeFormat){
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix);
				}
				else{
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix);
				}
			}

			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime();
			}
		},

		/*
		* call custom onSelect.
		* bind to sliders slidestop, and grid click.
		*/
		_onSelectHandler: function() {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect &amp;amp;&amp;amp; inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this]);
			}
		},

		/*
		* update our input with the new date time..
		*/
		_updateDateTime: function(dp_inst) {
			dp_inst = this.inst || dp_inst;
			//var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
			var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay)),
				dateFmt = $.datepicker._get(dp_inst, 'dateFormat'),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null &amp;amp;&amp;amp; this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			
			// if a slider was changed but datepicker doesn't have a value yet, set it
			if(dp_inst.lastVal===""){
                dp_inst.currentYear=dp_inst.selectedYear;
                dp_inst.currentMonth=dp_inst.selectedMonth;
                dp_inst.currentDay=dp_inst.selectedDay;
            }

			/*
			* remove following lines to force every changes in date picker to change the input value
			* Bug descriptions: when an input field has a default value, and click on the field to pop up the date picker. 
			* If the user manually empty the value in the input field, the date picker will never change selected value.
			*/
			//if (dp_inst.lastVal !== undefined &amp;amp;&amp;amp; (dp_inst.lastVal.length &amp;gt; 0 &amp;amp;&amp;amp; this.$input.val().length === 0)) {
			//	return;
			//}

			if (this._defaults.timeOnly === true) {
				formattedDateTime = this.formattedTime;
			} else if (this._defaults.timeOnly !== true &amp;amp;&amp;amp; (this._defaults.alwaysSetTime || timeAvailable)) {
				formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix;
			}

			this.formattedDateTime = formattedDateTime;

			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate);
			} else if (this.$altInput &amp;amp;&amp;amp; this._defaults.timeOnly === false &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly === true) {
				this.$altInput.val(this.formattedTime);
				this.$input.val(this.formattedDate);
			} else if (this.$altInput) {
				this.$input.val(formattedDateTime);
				var altFormattedDateTime = '',
					altSeparator = this._defaults.altSeparator ? this._defaults.altSeparator : this._defaults.separator,
					altTimeSuffix = this._defaults.altTimeSuffix ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
				
				if(!this._defaults.timeOnly){
					if (this._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg);
					}
					else{
						altFormattedDateTime = this.formattedDate;
					}

					if (altFormattedDateTime){
						altFormattedDateTime += altSeparator;
					}
				}

				if(this._defaults.altTimeFormat){
					altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix;
				}
				else{
					altFormattedDateTime += this.formattedTime + altTimeSuffix;
				}
				this.$altInput.val(altFormattedDateTime);
			} else {
				this.$input.val(formattedDateTime);
			}

			this.$input.trigger("change");
		},

		_onFocus: function() {
			if (!this.$input.val() &amp;amp;&amp;amp; this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, 'timepicker');
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst);
						} catch (err) {
							$.timepicker.log(err);
						}
					}
				}
			}
		},

		/*
		* Small abstraction to control types
		* We can add more, just be sure to follow the pattern: create, options, value
		*/
		_controls: {
			// slider methods
			slider: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var rtl = tp_inst._defaults.isRTL; // if rtl go -60-&amp;gt;0 instead of 0-&amp;gt;60
					return obj.prop('slide', null).slider({
						orientation: "horizontal",
						value: rtl? val*-1 : val,
						min: rtl? max*-1 : min,
						max: rtl? min*-1 : max,
						step: step,
						slide: function(event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl? ui.value*-1:ui.value);
							tp_inst._onTimeChange();
						},
						stop: function(event, ui) {
							tp_inst._onSelectHandler();
						}
					});	
				},
				options: function(tp_inst, obj, unit, opts, val){
					if(tp_inst._defaults.isRTL){
						if(typeof(opts) == 'string'){
							if(opts == 'min' || opts == 'max'){
								if(val !== undefined){
									return obj.slider(opts, val*-1);
								}
								return Math.abs(obj.slider(opts));
							}
							return obj.slider(opts);
						}
						var min = opts.min, 
							max = opts.max;
						opts.min = opts.max = null;
						if(min !== undefined){
							opts.max = min * -1;
						}
						if(max !== undefined){
							opts.min = max * -1;
						}
						return obj.slider(opts);
					}
					if(typeof(opts) == 'string' &amp;amp;&amp;amp; val !== undefined){
							return obj.slider(opts, val);
					}
					return obj.slider(opts);
				},
				value: function(tp_inst, obj, unit, val){
					if(tp_inst._defaults.isRTL){
						if(val !== undefined){
							return obj.slider('value', val*-1);
						}
						return Math.abs(obj.slider('value'));
					}
					if(val !== undefined){
						return obj.slider('value', val);
					}
					return obj.slider('value');
				}
			},
			// select methods
			select: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var sel = '&amp;lt;select class="ui-timepicker-select" data-unit="'+ unit +'" data-min="'+ min +'" data-max="'+ max +'" data-step="'+ step +'"&amp;gt;',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;

					for(var i=min; i&amp;lt;=max; i+=step){						
						sel += '&amp;lt;option value="'+ i +'"'+ (i==val? ' selected':'') +'&amp;gt;';
						if(unit == 'hour'){
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig,'')), {hour:i}, tp_inst._defaults);
						}
						else if(unit == 'millisec' || unit == 'microsec' || i &amp;gt;= 10){ sel += i; }
						else {sel += '0'+ i.toString(); }
						sel += '&amp;lt;/option&amp;gt;';
					}
					sel += '&amp;lt;/select&amp;gt;';

					obj.children('select').remove();

					$(sel).appendTo(obj).change(function(e){
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
					});

					return obj;
				},
				options: function(tp_inst, obj, unit, opts, val){
					var o = {},
						$t = obj.children('select');
					if(typeof(opts) == 'string'){
						if(val === undefined){
							return $t.data(opts);
						}
						o[opts] = val;	
					}
					else{ o = opts; }
					return tp_inst.control.create(tp_inst, obj, $t.data('unit'), $t.val(), o.min || $t.data('min'), o.max || $t.data('max'), o.step || $t.data('step'));
				},
				value: function(tp_inst, obj, unit, val){
					var $t = obj.children('select');
					if(val !== undefined){
						return $t.val(val);
					}
					return $t.val();
				}
			}
		} // end _controls

	});

	$.fn.extend({
		/*
		* shorthand just to use timepicker..
		*/
		timepicker: function(o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);

			if (typeof o == 'object') {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				});
			}

			return $(this).each(function() {
				$.fn.datetimepicker.apply($(this), tmp_args);
			});
		},

		/*
		* extend timepicker to datepicker
		*/
		datetimepicker: function(o) {
			o = o || {};
			var tmp_args = arguments;

			if (typeof(o) == 'string') {
				if (o == 'getDate') {
					return $.fn.datepicker.apply($(this[0]), tmp_args);
				} else {
					return this.each(function() {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args);
					});
				}
			} else {
				return this.each(function() {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults);
				});
			}
		}
	});

	/*
	* Public Utility to parse date and time
	*/
	$.datepicker.parseDateTime = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec);
		}

		return parseRes.date;
	};

	/*
	* Public utility to parse time
	*/
	$.datepicker.parseTime = function(timeFormat, timeString, options) {		
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g,'').indexOf('Z') !== -1);

		// Strict parse requires the timeString to match the timeFormat exactly
		var strictParse = function(f, s, o){

			// pattern for standard and localized AM/PM markers
			var getPatternAmpm = function(amNames, pmNames) {
				var markers = [];
				if (amNames) {
					$.merge(markers, amNames);
				}
				if (pmNames) {
					$.merge(markers, pmNames);
				}
				markers = $.map(markers, function(val) {
					return val.replace(/[.*+?|()\[\]{}\\]/g, '\\$&amp;amp;');
				});
				return '(' + markers.join('|') + ')?';
			};

			// figure out position of time elements.. cause js cant do named captures
			var getFormatPositions = function(timeFormat) {
				var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
					orders = {
						h: -1,
						m: -1,
						s: -1,
						l: -1,
						c: -1,
						t: -1,
						z: -1
					};

				if (finds) {
					for (var i = 0; i &amp;lt; finds.length; i++) {
						if (orders[finds[i].toString().charAt(0)] == -1) {
							orders[finds[i].toString().charAt(0)] = i + 1;
						}
					}
				}
				return orders;
			};

			var regstr = '^' + f.toString()
					.replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
							var ml = match.length;
							switch (match.charAt(0).toLowerCase()) {
								case 'h': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'm': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 's': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'l': return '(\\d?\\d?\\d)';
								case 'c': return '(\\d?\\d?\\d)';
								case 'z': return '(z|[-+]\\d\\d:?\\d\\d|\\S+)?';
								case 't': return getPatternAmpm(o.amNames, o.pmNames);
								default:    // literal escaped in quotes
									return '(' + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function (m) { return "\\" + m; }) + ')?';
							}
						})
					.replace(/\s/g, '\\s?') +
					o.timeSuffix + '$',
				order = getFormatPositions(f),
				ampm = '',
				treg;

			treg = s.match(new RegExp(regstr, 'i'));

			var resTime = {
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0
			};

			if (treg) {
				if (order.t !== -1) {
					if (treg[order.t] === undefined || treg[order.t].length === 0) {
						ampm = '';
						resTime.ampm = '';
					} else {
						ampm = $.inArray(treg[order.t].toUpperCase(), o.amNames) !== -1 ? 'AM' : 'PM';
						resTime.ampm = o[ampm == 'AM' ? 'amNames' : 'pmNames'][0];
					}
				}

				if (order.h !== -1) {
					if (ampm == 'AM' &amp;amp;&amp;amp; treg[order.h] == '12') {
						resTime.hour = 0; // 12am = 0 hour
					} else {
						if (ampm == 'PM' &amp;amp;&amp;amp; treg[order.h] != '12') {
							resTime.hour = parseInt(treg[order.h], 10) + 12; // 12pm = 12 hour, any other pm = hour + 12
						} else {
							resTime.hour = Number(treg[order.h]);
						}
					}
				}

				if (order.m !== -1) {
					resTime.minute = Number(treg[order.m]);
				}
				if (order.s !== -1) {
					resTime.second = Number(treg[order.s]);
				}
				if (order.l !== -1) {
					resTime.millisec = Number(treg[order.l]);
				}
				if (order.c !== -1) {
					resTime.microsec = Number(treg[order.c]);
				}
				if (order.z !== -1 &amp;amp;&amp;amp; treg[order.z] !== undefined) {
					resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z]);
				}


				return resTime;
			}
			return false;
		};// end strictParse

		// First try JS Date, if that fails, use strictParse
		var looseParse = function(f,s,o){
			try{
				var d = new Date('2012-01-01 '+ s);
				if(isNaN(d.getTime())){
					d = new Date('2012-01-01T'+ s);
					if(isNaN(d.getTime())){
						d = new Date('01/01/2012 '+ s);
						if(isNaN(d.getTime())){
							throw "Unable to parse time with native Date: "+ s;
						}
					}
				}

				return {
					hour: d.getHours(),
					minute: d.getMinutes(),
					second: d.getSeconds(),
					millisec: d.getMilliseconds(),
					microsec: d.getMicroseconds(),
					timezone: d.getTimezoneOffset()*-1
				};
			}
			catch(err){
				try{
					return strictParse(f,s,o);
				}
				catch(err2){
					$.timepicker.log("Unable to parse \ntimeString: "+ s +"\ntimeFormat: "+ f);
				}				
			}
			return false;
		}; // end looseParse
		
		if(typeof o.parse === "function"){
			return o.parse(timeFormat, timeString, o);
		}
		if(o.parse === 'loose'){
			return looseParse(timeFormat, timeString, o);
		}
		return strictParse(timeFormat, timeString, o);
	};

	/*
	* Public utility to format the time
	* format = string format of the time
	* time = a {}, not a Date() for timezones
	* options = essentially the regional[].. amNames, pmNames, ampm
	*/
	$.datepicker.formatTime = function(format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			timezone: 0
		}, time);

		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);

		if (hour &amp;gt; 11) {
			ampmName = options.pmNames[0];
		}

		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|('.*?'|".*?"))/g, function(match) {
		switch (match) {
			case 'HH':
				return ('0' + hour).slice(-2);
			case 'H':
				return hour;
			case 'hh':
				return ('0' + convert24to12(hour)).slice(-2);
			case 'h':
				return convert24to12(hour);
			case 'mm':
				return ('0' + time.minute).slice(-2);
			case 'm':
				return time.minute;
			case 'ss':
				return ('0' + time.second).slice(-2);
			case 's':
				return time.second;
			case 'l':
				return ('00' + time.millisec).slice(-3);
			case 'c':
				return ('00' + time.microsec).slice(-3);
			case 'z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, false);
			case 'Z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, true);
			case 'T': 
				return ampmName.charAt(0).toUpperCase();
			case 'TT': 
				return ampmName.toUpperCase();
			case 't':
				return ampmName.charAt(0).toLowerCase();
			case 'tt':
				return ampmName.toLowerCase();
			default:
				return match.replace(/\'/g, "") || "'";
			}
		});

		tmptime = $.trim(tmptime);
		return tmptime;
	};

	/*
	* the bad hack :/ override datepicker so it doesnt close on select
	// inspired: http://stackoverflow.com/questions/1252512/jquery-datepicker-prevent-closing-picker-when-clicking-a-date/1762378#1762378
	*/
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function(id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			tp_inst._limitMinMaxDateTime(inst, true);
			inst.inline = inst.stay_open = true;
			//This way the onSelect handler called from calendarpicker get the full dateTime
			this._base_selectDate(id, dateStr);
			inst.inline = inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst);
		} else {
			this._base_selectDate(id, dateStr);
		}
	};

	/*
	* second bad hack :/ override datepicker so it triggers an event when changing the input field
	* and does not redraw the datepicker on every selectDate event
	*/
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function(inst) {

		// don't popup the datepicker if there is another instance already opened
		var input = inst.input[0];
		if ($.datepicker._curInst &amp;amp;&amp;amp; $.datepicker._curInst != inst &amp;amp;&amp;amp; $.datepicker._datepickerShowing &amp;amp;&amp;amp; $.datepicker._lastInput != input) {
			return;
		}

		if (typeof(inst.stay_open) !== 'boolean' || inst.stay_open === false) {

			this._base_updateDatepicker(inst);

			// Reload the time control when changing something in the input text field.
			var tp_inst = this._get(inst, 'timepicker');
			if (tp_inst) {
				tp_inst._addTimePicker(inst);
			}
		}
	};

	/*
	* third bad hack :/ override datepicker so it allows spaces and colon in the input field
	*/
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if ($.datepicker._get(inst, 'constrainInput')) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null? tp_inst._defaults.showTimezone : tp_inst.support.timezone,					
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat')),
					datetimeChars = tp_inst._defaults.timeFormat.toString()
											.replace(/[hms]/g, '')
											.replace(/TT/g, ampm ? 'APM' : '')
											.replace(/Tt/g, ampm ? 'AaPpMm' : '')
											.replace(/tT/g, ampm ? 'AaPpMm' : '')
											.replace(/T/g, ampm ? 'AP' : '')
											.replace(/tt/g, ampm ? 'apm' : '')
											.replace(/t/g, ampm ? 'ap' : '') + 
											" " + tp_inst._defaults.separator + 
											tp_inst._defaults.timeSuffix + 
											(tz ? tp_inst._defaults.timezoneList.join('') : '') + 
											(tp_inst._defaults.amNames.join('')) + (tp_inst._defaults.pmNames.join('')) + 
											dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr &amp;lt; ' ' || !dateChars || datetimeChars.indexOf(chr) &amp;gt; -1);
			}
		}

		return $.datepicker._base_doKeyPress(event);
	};

	/*
	* Fourth bad hack :/ override _updateAlternate function used in inline mode to init altField
	*/
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	/* Update any alternate field to synchronise with the main field. */
	$.datepicker._updateAlternate = function(inst) {
		var tp_inst = this._get(inst, 'timepicker');
		if(tp_inst){
			var altField = tp_inst._defaults.altField;
			if (altField) { // update alternate field too
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = '', 
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator, 
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if(!tp_inst._defaults.timeOnly &amp;amp;&amp;amp; !tp_inst._defaults.altFieldTimeOnly &amp;amp;&amp;amp; date !== null){
					if(tp_inst._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime;
					}
					else{
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime;
					}
				}
				$(altField).val(altFormattedDateTime);
			}
		}
		else{
			$.datepicker._base_updateAlternate(inst);
		}
	};

	/*
	* Override key up event to sync manual input changes.
	*/
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst);
				} catch (err) {
					$.timepicker.log(err);
				}
			}
		}

		return $.datepicker._base_doKeyUp(event);
	};

	/*
	* override "Today" button to also grab the time.
	*/
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function(id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		this._base_gotoToday(id);
		var tp_inst = this._get(inst, 'timepicker');
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		$('.ui-datepicker-today', $dp).click();
	};

	/*
	* Disable &amp;amp; enable the Time in the datetimepicker
	*/
	$.datepicker._disableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst);
		}
	};

	$.datepicker._enableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst); // Could be disabled on page load
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create our own set time function
	*/
	$.datepicker._setTime = function(inst, date) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var defaults = tp_inst._defaults;

			// calling _setTime with no date sets time to defaults
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;

			//check if within min/max times.. 
			tp_inst._limitMinMaxDateTime(inst, true);

			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create new public method to set only time, callable as $().datepicker('setTime', date)
	*/
	$.datepicker._setTimeDatepicker = function(target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date == "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec);
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds());
				}
				if (tp_date.toString() == 'Invalid Date') {
					tp_date = undefined;
				}
				this._setTime(inst, tp_date);
			}
		}

	};

	/*
	* override setDate() to allow setting time too within Date object
	*/
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function(target, date) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		if(typeof(date) === 'string'){
			date = new Date(date);
			if(!date.getTime()){
				$.timepicker.log("Error creating Date object from string.");
			}
		}

		var tp_inst = this._get(inst, 'timepicker');
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds());
		} else {
			tp_date = date;
		}
		
		// This is important if you are using the timezone option, javascript's Date 
		// object will only return the timezone offset for the current locale, so we 
		// adjust it accordingly.  If not using timezone option this won't matter..
		// If a timezone is different in tp, keep the timezone as is
		if(tp_inst){
			// look out for DST if tz wasn't specified
			if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
				tp_inst.timezone = tp_date.getTimezoneOffset()*-1;
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone);
		}

		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true);
	};

	/*
	* override getDate() to allow getting time too within Date object
	*/
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function(target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			// if it hasn't yet been defined, grab from field
			if(inst.lastVal === undefined){
				this._setDateFromField(inst, noDefault);
			}

			var date = this._getDate(inst);
			if (date &amp;amp;&amp;amp; tp_inst._parseTime($(target).val(), tp_inst.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);

				// This is important if you are using the timezone option, javascript's Date 
				// object will only return the timezone offset for the current locale, so we 
				// adjust it accordingly.  If not using timezone option this won't matter..
				if(tp_inst.timezone != null){
					// look out for DST if tz wasn't specified
					if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
						tp_inst.timezone = date.getTimezoneOffset()*-1;
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
				}
			}
			return date;
		}
		return this._base_getDateDatepicker(target, noDefault);
	};

	/*
	* override parseDate() because UI 1.8.14 throws an error about "Extra characters"
	* An option in datapicker to ignore extra format characters would be nicer.
	*/
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function(format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings);
		} catch (err) {
			// Hack!  The error message ends with a colon, a space, and
			// the "extra" characters.  We rely on that instead of
			// attempting to perfectly reproduce the parsing algorithm.
			if (err.indexOf(":") &amp;gt;= 0) {
				date = this._base_parseDate(format, value.substring(0,value.length-(err.length-err.indexOf(':')-2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format);
			} else {
				throw err;
			}
		}
		return date;
	};

	/*
	* override formatDate to set date with time to the input
	*/
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function(inst, day, month, year) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val();
		}
		return this._base_formatDate(inst);
	};

	/*
	* override options setter to add time to maxDate(Time) and minDate(Time). MaxDate
	*/
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function(target, name, value) {
		var inst = this._getInst(target),
	        name_clone;
		if (!inst) {
			return null;
		}

		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop;
		    if (typeof name == 'string') { // if min/max was set with the string
		        if (name === 'minDate' || name === 'minDateTime') {
		            min = value;
		        } else if (name === 'maxDate' || name === 'maxDateTime') {
		            max = value;
		        } else if (name === 'onSelect') {
		            onselect = value;
		        } else if (overrides.hasOwnProperty(name)) {
		            if (typeof (value) === 'undefined') {
		                return overrides[name];
		            }
		            fns[name] = value;
		            name_clone = {}; //empty results in exiting function after overrides updated
		        }
		    } else if (typeof name == 'object') { //if min/max was set with the JSON
		        if (name.minDate) {
		            min = name.minDate;
		        } else if (name.minDateTime) {
		            min = name.minDateTime;
		        } else if (name.maxDate) {
		            max = name.maxDate;
		        } else if (name.maxDateTime) {
		            max = name.maxDateTime;
		        }
		        for (prop in overrides) {
		            if (overrides.hasOwnProperty(prop) &amp;amp;&amp;amp; name[prop]) {
		                fns[prop] = name[prop];
		            }
		        }
		    }
		    for (prop in fns) {
		        if (fns.hasOwnProperty(prop)) {
		            overrides[prop] = fns[prop];
		            if (!name_clone) { name_clone = $.extend({}, name);}
		            delete name_clone[prop];
		        }
		    }
		    if (name_clone &amp;amp;&amp;amp; isEmptyObject(name_clone)) { return; }
		    if (min) { //if min was set
		        if (min === 0) {
		            min = new Date();
		        } else {
		            min = new Date(min);
		        }
		        tp_inst._defaults.minDate = min;
		        tp_inst._defaults.minDateTime = min;
		    } else if (max) { //if max was set
		        if (max === 0) {
		            max = new Date();
		        } else {
		            max = new Date(max);
		        }
		        tp_inst._defaults.maxDate = max;
		        tp_inst._defaults.maxDateTime = max;
		    } else if (onselect) {
		        tp_inst._defaults.onSelect = onselect;
		    }
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name);
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
	};
	
	/*
	* jQuery isEmptyObject does not check hasOwnProperty - if someone has added to the object prototype,
	* it will return false for all objects
	*/
	var isEmptyObject = function(obj) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(obj)) {
				return false;
			}
		}
		return true;
	};

	/*
	* jQuery extend now ignores nulls!
	*/
	var extendRemove = function(target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] === null || props[name] === undefined) {
				target[name] = props[name];
			}
		}
		return target;
	};

	/*
	* Determine by the time format which units are supported
	* Returns an object of booleans for each unit
	*/
	var detectSupport = function(timeFormat){
		var tf = timeFormat.replace(/\'.*?\'/g,'').toLowerCase(), // removes literals
			isIn = function(f, t){ // does the format contain the token?
					return f.indexOf(t) !== -1? true:false; 
				};
		return {
				hour: isIn(tf,'h'),
				minute: isIn(tf,'m'),
				second: isIn(tf,'s'),
				millisec: isIn(tf,'l'),
				microsec: isIn(tf,'c'),
				timezone: isIn(tf,'z'),
				ampm: isIn(tf,'t') &amp;amp;&amp;amp; isIn(timeFormat,'h'),
				iso8601: isIn(timeFormat, 'Z')
			};
	};

	/*
	* Converts 24 hour format into 12 hour
	* Returns 12 hour without leading 0
	*/
	var convert24to12 = function(hour) {
		if (hour &amp;gt; 12) {
			hour = hour - 12;
		}

		if (hour === 0) {
			hour = 12;
		}

		return String(hour);
	};

	/*
	* Splits datetime string into date ans time substrings.
	* Throws exception when date can't be parsed
	* Returns [dateString, timeString]
	*/
	var splitDateTime = function(dateFormat, dateTimeString, dateSettings, timeSettings) {
		try {
			// The idea is to get the number separator occurances in datetime and the time format requested (since time has 
			// fewer unknowns, mostly numbers and am/pm). We will use the time pattern to split.
			var separator = timeSettings &amp;amp;&amp;amp; timeSettings.separator ? timeSettings.separator : $.timepicker._defaults.separator,
				format = timeSettings &amp;amp;&amp;amp; timeSettings.timeFormat ? timeSettings.timeFormat : $.timepicker._defaults.timeFormat,
				timeParts = format.split(separator), // how many occurances of separator may be in our format?
				timePartsLen = timeParts.length,
				allParts = dateTimeString.split(separator),
				allPartsLen = allParts.length;

			if (allPartsLen &amp;gt; 1) {
				return [
						allParts.splice(0,allPartsLen-timePartsLen).join(separator),
						allParts.splice(0,timePartsLen).join(separator)
					];
			}

		} catch (err) {
			$.timepicker.log('Could not split the date from the time. Please check the following datetimepicker options' +
					"\nthrown error: " + err +
					"\ndateTimeString" + dateTimeString +
					"\ndateFormat = " + dateFormat +
					"\nseparator = " + timeSettings.separator +
					"\ntimeFormat = " + timeSettings.timeFormat);

			if (err.indexOf(":") &amp;gt;= 0) {
				// Hack!  The error message ends with a colon, a space, and
				// the "extra" characters.  We rely on that instead of
				// attempting to perfectly reproduce the parsing algorithm.
				var dateStringLength = dateTimeString.length - (err.length - err.indexOf(':') - 2),
					timeString = dateTimeString.substring(dateStringLength);

				return [$.trim(dateTimeString.substring(0, dateStringLength)), $.trim(dateTimeString.substring(dateStringLength))];

			} else {
				throw err;
			}
		}
		return [dateTimeString, ''];
	};

	/*
	* Internal function to parse datetime interval
	* Returns: {date: Date, timeObj: Object}, where
	*   date - parsed date without time (type Date)
	*   timeObj = {hour: , minute: , second: , millisec: , microsec: } - parsed time. Optional
	*/
	var parseDateTimeInternal = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var date;
		var splitRes = splitDateTime(dateFormat, dateTimeString, dateSettings, timeSettings);
		date = $.datepicker._base_parseDate(dateFormat, splitRes[0], dateSettings);
		if (splitRes[1] !== '') {
			var timeString = splitRes[1],
				parsedTime = $.datepicker.parseTime(timeFormat, timeString, timeSettings);

			if (parsedTime === null) {
				throw 'Wrong time format';
			}
			return {
				date: date,
				timeObj: parsedTime
			};
		} else {
			return {
				date: date
			};
		}
	};

	/*
	* Internal function to set timezone_select to the local timezone
	*/
	var selectLocalTimezone = function(tp_inst, date) {
		if (tp_inst &amp;amp;&amp;amp; tp_inst.timezone_select) {
			var now = typeof date !== 'undefined' ? date : new Date();
			tp_inst.timezone_select.val(now.getTimezoneOffset()*-1);
		}
	};

	/*
	* Create a Singleton Insance
	*/
	$.timepicker = new Timepicker();

	/**
	 * Get the timezone offset as string from a date object (eg '+0530' for UTC+5.5)
	 * @@param  number if not a number this value is returned
	 * @@param boolean if true formats in accordance to iso8601 "+12:45"
	 * @@return string
	 */
	$.timepicker.timezoneOffsetString = function(tzMinutes, iso8601) {
		if(isNaN(tzMinutes) || tzMinutes &amp;gt; 840){
			return tzMinutes;
		}

		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601? ':':'',
			tz = (off &amp;gt;= 0 ? '+' : '-') + ('0' + (hours * 101).toString()).slice(-2) + iso + ('0' + (minutes * 101).toString()).slice(-2);
		
		if(tz == '+00:00'){
			return 'Z';
		}
		return tz;
	};

	/**
	 * Get the number in minutes that represents a timezone string
	 * @@param  string formated like "+0500", "-1245"
	 * @@return number
	 */
	$.timepicker.timezoneOffsetNumber = function(tzString) {
		tzString = tzString.toString().replace(':',''); // excuse any iso8601, end up with "+1245"

		if(tzString.toUpperCase() === 'Z'){ // if iso8601 with Z, its 0 minute offset
			return 0;
		}

		if(!/^(\-|\+)\d{4}$/.test(tzString)){ // possibly a user defined tz, so just give it back
			return tzString;
		}

		return ((tzString.substr(0,1) =='-'? -1 : 1) * // plus or minus
					((parseInt(tzString.substr(1,2),10)*60) + // hours (converted to minutes)
					parseInt(tzString.substr(3,2),10))); // minutes
	};

	/**
	 * No way to set timezone in js Date, so we must adjust the minutes to compensate. (think setDate, getDate)
	 * @@param  date
	 * @@param  string formated like "+0500", "-1245"
	 * @@return date
	 */
	$.timepicker.timezoneAdjust = function(date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if(!isNaN(toTz)){
			date.setMinutes(date.getMinutes()*1 + (date.getTimezoneOffset()*-1 - toTz*1) );
		}
		return date;
	};

	/**
	 * Calls `timepicker()` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * n.b. The input value must be correctly formatted (reformatting is not supported)
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the timepicker() call
	 * @@return jQuery
	 */
	$.timepicker.timeRange = function(startTime, endTime, options) {
		return $.timepicker.handleRange('timepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datetimepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@return jQuery
	 */
	$.timepicker.datetimeRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datetimepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.dateRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.handleRange = function(method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0, // min allowed interval in milliseconds
			maxInterval: 0, // max allowed interval in milliseconds
			start: {},      // options for start picker
			end: {}         // options for end picker
		}, options);

		$.fn[method].call(startTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), endTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), endTime, 'minDate');
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), startTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), startTime, 'maxDate');
			}
		}, options, options.end));

		checkDates(startTime, endTime);
		selected(startTime, endTime, 'minDate');
		selected(endTime, startTime, 'maxDate');

		function checkDates(changed, other) {
			var startdt = startTime[method]('getDate'),
				enddt = endTime[method]('getDate'),
				changeddt = changed[method]('getDate');

			if(startdt !== null){
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());

				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);

				if(options.minInterval &amp;gt; 0 &amp;amp;&amp;amp; minDate &amp;gt; enddt){ // minInterval check
					endTime[method]('setDate',minDate);
				}
				else if(options.maxInterval &amp;gt; 0 &amp;amp;&amp;amp; maxDate &amp;lt; enddt){ // max interval check
					endTime[method]('setDate',maxDate);
				}
				else if (startdt &amp;gt; enddt) {
					other[method]('setDate',changeddt);
				}
			}
		}

		function selected(changed, other, option) {
			if (!changed.val()) {
				return;
			}
			var date = changed[method].call(changed, 'getDate');
			if(date !== null &amp;amp;&amp;amp; options.minInterval &amp;gt; 0){
				if(option == 'minDate'){
					date.setMilliseconds(date.getMilliseconds() + options.minInterval); 
				}
				if(option == 'maxDate'){
					date.setMilliseconds(date.getMilliseconds() - options.minInterval);
				}
			}
			if (date.getTime) {
				other[method].call(other, 'option', option, date);
			}
		}
		return $([startTime.get(0), endTime.get(0)]);
	};

	/**
	 * Log error or data to the console during error or debugging
	 * @@param  Object err pass any type object to log to the console during error or debugging
	 * @@return void
	 */
	$.timepicker.log = function(err){
		if(window.console){
			console.log(err);
		}
	};

	/*
	* Microsecond support
	*/
	if(!Date.prototype.getMicroseconds){
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function(){ return this.microseconds; };
		Date.prototype.setMicroseconds = function(m){ 
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m/1000));
			this.microseconds = m%1000;
			return this;
		};
	}

	/*
	* Keep up with the version
	*/
	$.timepicker.version = "1.3.1";

})(jQuery);
jQuery.noConflict();
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;datetimepicker-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;e73a652e-09fc-4c71-8e7a-e2525a2d2a99&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
function replaceAllString(oriStr, strTarget, strSubString ){
   var strText = oriStr;
   var intIndexOfMatch = strText.indexOf( strTarget );
   while (intIndexOfMatch != -1){
      strText = strText.replace( strTarget, strSubString )
      intIndexOfMatch = strText.indexOf( strTarget );
   }
   return( strText );
}
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&amp;amp;]" + name + "=([^&amp;amp;#]*)"),
    results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
};


   var jobName= getParameterByName('job')
   var fromDate= getParameterByName('fromDate')
   var toDate= getParameterByName('toDate')
   var limit= getParameterByName('limit')
   var selectedIstIid = getParameterByName('IstIid')

  $("#jobname").ready(function(){
   $("#jobname").text(jobName)
   var convertedJobName = replaceAllString(jobName, ".", "_")
   $("#IstIid" + convertedJobName).ready(function(){
     $("#IstIid" + convertedJobName).css("display","block")
     $("#select_" + convertedJobName).ready(function(){
        $("#select_" + convertedJobName).val(selectedIstIid)
     });
   });
 });

  $("#fromDate").ready(function(){
   $("#from-date").val(fromDate)
 });

  $("#toDate").ready(function(){
   $("#to-date").val(toDate)
 });

  $("#limit").ready(function(){
   if(limit!=""){
    $("#limit").val(limit)
   }
 });
 // Get data with ajax
 function ajax_getData(jobName,fromDate,toDate,limit ){
       var convertedJobName = replaceAllString(jobName, ".", "_")
       var istIid = $("#select_" + convertedJobName).val()
       window.location="/xwiki/bin/view/WiperDog/WebHome?job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid="+istIid;
 			/*$.ajax({
			 type: "GET",
			 url:"/xwiki/bin/get/Sandbox/DescriptionForJob?outputSyntax=plain&amp;amp;job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid"+selectedIstIid,
			 success : function(result){
				$("#jobname").html(jobName)
				$("#display").text('[[]]' + result)
			 }
		   });*/
 }
	$("#treemenu2 a").click(function(){
		 var limit = 10
		 var fromDate=""
		 var toDate = ""
		 jobName= $(this).text()
                 $("#jobname").html(jobName)
                 var convertedJobName = replaceAllString(jobName, ".", "_")
                 $("#listIstIid &amp;gt; div").css("display","none")
                 $("#IstIid" + convertedJobName).css("display","block")
		 //ajax_getData(jobName,fromDate,toDate,limit )

	});

	$("#from-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
		dateFormat: 'yy-mm-dd',
	});
	$("#to-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
			dateFormat: 'yy-mm-dd',

	});
	 $("#get-data").on("click",function(){
		var fromDate = $("#from-date").val()
		var toDate =  $("#to-date").val()
		 if( toDate!= "" ){
			  if(fromDate != ""){
				  if($("#from-date").datepicker( "getDate" ) &amp;gt; $("#to-date").datepicker( "getDate" )){
				  alert("'From date' cannot start later than 'To date'")
				  return false
				  }
			  }
		 }
		 limit = $("#limit").val()
		 ajax_getData(jobName,fromDate,toDate,limit )
	});
$(document).ready(function(){
  var keys = $("#lstkey").text()
  //console.log('key == ' + keys);
  //console.log('livetableJson ==' + $("#livetableJson").text());
  
  var jsonObj = $.parseJSON($("#livetableJson").text()); 
  if(keys &amp;amp;&amp;amp; keys != '[ ]'){
    /** Subtyped **/    
    var newKeys = keys.replace('[',"");
    keys = newKeys.replace(']',"");
    var keyArr = (keys.indexOf(',') != -1)? keys.split(','):new Array(keys);
    //console.log('Key after replace: '+keys)       
    for(var i=0;i&amp;lt;keyArr.length;i++){
        var keyName = keyArr[i].trim().replace('',"").replace("\"","").replace('\"','');
        var subTypeJsonObjStr = jsonObj[keyName].replace('#livetablePager','#livetablePager_'+keyName)
        var subTypeJsonObj = $.parseJSON(subTypeJsonObjStr);
        $("#livetableList_"+keyName).jqGrid(subTypeJsonObj);
        $("#livetableList_"+keyName).jqGrid('navGrid', "#livetablePager_"+keyName, {
           edit : false,
           add : false,
           del : false,
           search:false
         });
    }
    
  }else{ /** Store**/        
      $("#livetableList").jqGrid(jsonObj);
      $("#livetableList").jqGrid('navGrid', "#livetablePager", {
           edit : false,
           add : false,
           del : false,
           search:false
           
       });
   }
});
        
jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;process&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;881686cc-1bfc-456e-b8ab-71334c4a45e5&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){

	$(function () {
		function drawLineChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerline' + container).highcharts({

				chart: {
					type:'line'
				},
				title: {
					text: chart_name
				},
				tooltip :{
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				xAxis: dataXAxis ,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				series: dataSeries
			});
		};

		function drawBarChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerbar' + container).highcharts({
				chart: {
					type: 'column'
				},
				title: {
					text: chart_name
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {

					column: {
						pointPadding: 0.2,
						borderWidth: 0
					}
				},
				series: dataSeries
			});
		}

		function drawAreaChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail
			$('#containerarea' + container).highcharts({
				chart: {
					type: 'area'
				},
				title: {
					text: chart_name
				},
				subtitle: {
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					},
					labels: {
						formatter: function() {
							return this.value / 1000;
						}
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {
					area: {
						stacking: 'normal',
						lineColor: '#666666',
						lineWidth: 1,
						marker: {
							lineWidth: 1,
							lineColor: '#666666'
						}
					}
				},
				series: dataSeries
			});
		};

		function drawPieChart(data, container, chartName){
			var dataPie = data
			$(document).ready(function () {
				// Build the chart
				$('#container' + container).highcharts({
					chart: {
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: chartName
					},
					tooltip: {
						pointFormat: '{series.name}: &amp;lt;b&amp;gt;{point.percentage:.1f}%&amp;lt;/b&amp;gt;'
					},
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							dataLabels: {
								enabled: true,
                                                                color: '#000000',
                                                                connectorColor: '#000000',
                                                                format: '&amp;lt;b&amp;gt;{point.name}&amp;lt;/b&amp;gt;: {point.percentage:.1f} %'
							},
							showInLegend: true
						}
					},
					series: dataPie
				});
			});
		}

		// LINE
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                     if(($("#jsons&amp;gt;#jsonline_" + finalKey)).length &amp;gt; 0) {
					var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonline_" + finalKey).val());
					var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerline_" + finalKey).val());
				        var lstContainer = [];
  				        var data_all = [];
                                        var chartSize = arrayAll.length

                                        for(var i=0;i&amp;lt;chartSize ;i++){
                                           data_all = arrayAll[i]
                                           lstContainer = arrayContainerAll[i]
				           if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					        // data to display on tooltip
					        var data_detail = data_all[0]
					        // draw Line chart
				        	for(var j=0;j&amp;lt;data_all.length;j++){
				        		if(data_all[j].series[0].name == null){
				        			data_all[j].series[0].name = lstContainer[j]
					        	}
                                                        chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					        	drawLineChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					        }
				         }
                                      }
                                  }
				}
			} else {
				var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonline").val());
				var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerline").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length

                                for(var i=0;i&amp;lt;chartSize ;i++){
                                   data_all = arrayAll[i]
                                   lstContainer = arrayContainerAll[i]
				   if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Line chart
					for(var j=0;j&amp;lt;data_all.length;j++){
						if(data_all[j].series[0].name == null){
							data_all[j].series[0].name = lstContainer[j]
						}
                                                chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
						drawLineChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
				   }
                                }
			}
		});

		// BAR
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
			             var finalKey = lstKey[eKey]
                                     if(($("#jsons&amp;gt;#jsonbar_" + finalKey)).length &amp;gt; 0) {
					var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonbar_" + finalKey).val());
					var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerbar_" + finalKey).val());
					var lstContainer = [];
					var data_all = [];
                                        var chartSize = arrayAll.length
					for(var i=0;i&amp;lt;chartSize ;i++){
					    data_all = arrayAll[i]
					    lstContainer = arrayContainerAll[i]
					    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw bar chart
						for(var j=0;j&amp;lt;data_all.length;j++){
							if(data_all[j].series[0].name == null){
								data_all[j].series[0].name = lstContainer[j]
							}
                                                        chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
							drawBarChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
						}
                                            }
					}
                                    }
				}
			} else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonbar").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerbar").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
				    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Bar chart
					for(var j=0;j&amp;lt;data_all.length;j++){
                                            if(data_all[j].series[0].name == null){
						data_all[j].series[0].name = lstContainer[j]
					    }
                                            chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					    drawBarChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
                                    }
				}
			}
		});

		// AREA
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
                        var arrayAll
                        var arrayContainerAll
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                        if(($("#jsons&amp;gt;#jsonarea_" + finalKey)).length &amp;gt; 0) {
                                           arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonarea_" + finalKey).val());
                                           arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerarea_" + finalKey).val());
					   var lstContainer = [];
					   var data_all = [];
                                           var chartSize = arrayAll.length
					   for(var i=0;i&amp;lt;chartSize ;i++){
					       data_all = arrayAll[i]
					       lstContainer = arrayContainerAll[i]
					       if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						   // data to display on tooltip
						   var data_detail = data_all[0]
						   // draw Line chart
						   for(var j=0;j&amp;lt;data_all.length;j++){
						      if(data_all[j].series[0].name == null){
						         data_all[j].series[0].name = lstContainer[j]
						       }
                                                       chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
						       drawAreaChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
						   }
					      }
				           }
                                        }
			          }
                        } else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonarea").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerarea").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
				    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw area chart
					for(var j=0;j&amp;lt;data_all.length;j++){
                                            if(data_all[j].series[0].name == null){
						data_all[j].series[0].name = lstContainer[j]
					    }
                                            chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					    drawAreaChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
                                    }
				}
			}
		});

		// PIE
		$(document ).ready(function(){
                        var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
                        var arrayAll
                        var arrayContainerAll
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                        if(($("#jsons&amp;gt;#jsonpie_" + finalKey)).length &amp;gt; 0) {
                                           arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonpie_" + finalKey).val());
                                           arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerpie_" + finalKey).val());
					   var lstContainer = [];
					   var data_all = [];
                                           var chartSize = arrayAll.length
					  for(var i=0;i&amp;lt;chartSize ;i++){
					       data_all = arrayAll[i]
console.log(data_all)
					       lstContainer = arrayContainerAll[i]
					       if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						   // draw Pie chart
						   for(var j=0;j&amp;lt;data_all.length;j++){
                                                       //chartName = data_all[j].chart_name
                                                       chartName  = data_all[j].name
						       drawPieChart(data_all, finalKey + "_" + lstContainer[j], chartName)
						   }
					      }
				           }
                                        }
			          }
			} else {/*
				var array = $("#jsons&amp;gt;.jsonpie");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerpie");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					// draw Pie Chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						var finalData = []
						finalData[0] = data_all[0][i]
						//drawPieChart(finalData, lstContainer[0][i])
					}
				}*/
			}
		});
	});
	jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;d5873d92-b78b-42fc-9407-46d166204b88&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;/* css for timepicker */
.ui-timepicker-div .ui-widget-header { 
margin-bottom: 8px;
 }

.ui-timepicker-div dl { text-align: left; }
.ui-timepicker-div dl dt { height: 25px; margin-bottom: -25px; }
.ui-timepicker-div dl dd { margin: 0 10px 10px 65px; }
.ui-timepicker-div td { font-size: 90%; }
.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }

.ui-timepicker-rtl{ direction: rtl; }
.ui-timepicker-rtl dl { text-align: right; }
.ui-timepicker-rtl dl dd { margin: 0 65px 10px 10px; }
#ui-datepicker-div{
 position:relative;
 width:auto;
 height:auto
}
&lt;/code&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;datetimepicker -css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;1201fb1a-e9c1-4731-8c74-2ea8c0071959&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;.displayblock {
  border:2px solid;
  -webkit-border-radius:6px;
  background:gray;
  float: left;
  width:100%;
}

.displaypie {
  border:1px solid;
  -webkit-border-radius:6px;
  background:gray;
  width: 48%;
  float: left; 
  height: 300px;
}

.subtype {
  margin-top: 50px;
  font-size: 2em;
  color: red;
}&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;content&gt;{{include document="Lib.DataToDrawChart"/}}
{{include document="Lib.MongoDBConnection"/}}
{{velocity}}
$xwiki.jsx.use('Lib.JQueryUILib')
$xwiki.ssx.use('Lib.MenuGenerator')
$xwiki.jsx.use('Lib.MenuGenerator')
$xwiki.ssx.use('Lib.JQueryUILib')
$xwiki.jsx.use('Lib.JqGridLib')
$xwiki.ssx.use('Lib.JqGridLib') 
{{/velocity}}
{{include document="Lib.MenuGenerator"/}}
{{html wiki="true" clean="false"}}
&amp;lt;div id="viewer"&amp;gt;
&amp;lt;table style="text-align:left"  &amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th &amp;gt;Job name&amp;lt;/th&amp;gt;
  &amp;lt;td colspan=3&amp;gt;&amp;lt;div id="jobname"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
{{groovy}}
import org.xwiki.context.*

def ec = services.component.getInstance(Execution.class).getContext()
def mapJobIstIid = ec.getProperty("mapJobIstIid")

println '{{html clean="false" wiki="false"}}'
println '&amp;lt;tr&amp;gt;'
println '&amp;lt;th&amp;gt;IstIid&amp;lt;/th&amp;gt;'
println '&amp;lt;td colspan=3&amp;gt;'
mapJobIstIid.each{jobEntry-&amp;gt;
  def convertedJobKey = jobEntry.key.replaceAll("\\.","_")
  println "&amp;lt;div id='listIstIid'&amp;gt;"
  println "&amp;lt;div id=IstIid${convertedJobKey} style='display:none'&amp;gt;"
  println "&amp;lt;select id=select_${convertedJobKey}&amp;gt;"
  jobEntry.value.each{
     println "&amp;lt;option value=\"$it\"&amp;gt;$it&amp;lt;/option&amp;gt;"
  }
  println "&amp;lt;/select&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
}
println '&amp;lt;/td&amp;gt;'
println '&amp;lt;/tr&amp;gt;'
println '{{/html}}'
{{/groovy}}
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data monitor from&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="from-date" id="from-date"/&amp;gt;&amp;lt;/td&amp;gt;
  &amp;lt;th&amp;gt;Data monitor to&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="to-date" id="to-date"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data records limit &amp;lt;/th&amp;gt;
  &amp;lt;td &amp;gt;
     &amp;lt;select id="limit"&amp;gt;
       &amp;lt;option value=5&amp;gt;5&amp;lt;/option&amp;gt;
       &amp;lt;option value=10&amp;gt;10&amp;lt;/option&amp;gt;
       &amp;lt;option value=15&amp;gt;15&amp;lt;/option&amp;gt;
       &amp;lt;option value=20&amp;gt;20&amp;lt;/option&amp;gt;
     &amp;lt;/select&amp;gt;
  &amp;lt;/td&amp;gt;
  &amp;lt;td colspan=3 &amp;gt;&amp;lt;input type="button" value="View Data" id="get-data" class="button"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;&amp;lt;div id="display"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
  &amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
&amp;lt;/table&amp;gt;

&amp;lt;/div&amp;gt; 
   
 &amp;lt;/body&amp;gt;

{{/html}}
{{groovy}}
import groovy.json.*
xwiki.jsx.use("Lib.Highcharts")

if(request.xpage == "plain") {
	response.setContentType('text/plain')
}

def listData = []
def job = request.get("job")
def fromDate = request.get("fromDate")
def toDate = request.get("toDate")
def limit= (request.get("limit")!=null)?request.get("limit").toInteger():10
def istIid = request.get("IstIid")

def str= "No data to retrieved !"
def result = null
if(job != "" &amp;amp;&amp;amp; job != null &amp;amp;&amp;amp; istIid != null &amp;amp;&amp;amp; istIid != ""){
	MongoDBConnection.getConnection()
	if(fromDate != "" || toDate != ""){
		result = MongoDBConnection.getDataInPeriod(job,fromDate,toDate,limit,istIid)
	} else {
		result = MongoDBConnection.getDataAllFields(job,limit,istIid)
        }
MongoDBConnection.closeConnection()
} else {
   println "{{warning}}There are no selected job or IstIid{{/warning}}"
}
def listKey = []
if( (result != null) &amp;amp;&amp;amp; (result.size() &amp;gt; 0) &amp;amp;&amp;amp; (result[0].KEYEXPR != null)&amp;amp;&amp;amp;!(result[0].KEYEXPR instanceof List )){

if(result[0].type == "Subtyped") {
    println '{{html clean="false" wiki="true"}}'
    //println '&amp;lt;body&amp;gt;'
    def dataSubtype = DataToDrawChart.getDataToDrawSubtype(result)
    dataSubtype.each {key,value -&amp;gt;
        listKey.add(key)
    }
    def jsonkey = com.mongodb.util.JSON.serialize(listKey)
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$jsonkey&amp;lt;/textarea&amp;gt;"

    dataSubtype.each {key,value -&amp;gt;
            def dataLine = []
            def dataBar = []
            def dataPie = []
            def dataArea = []
            if(DataToDrawChart.getDataToDrawLine(value) != []) {
                dataLine = DataToDrawChart.getDataToDrawLine(value)
            }
            if(DataToDrawChart.getDataToDrawBar(value) != []) {
                dataBar = DataToDrawChart.getDataToDrawBar(value)
            }
            if(DataToDrawChart.getDataToDrawPie(value) != []) {
                dataPie = DataToDrawChart.getDataToDrawPie(value)
            }
            if(DataToDrawChart.getDataToDrawArea(value) != []) {
                dataArea = DataToDrawChart.getDataToDrawArea(value)
            }

		def chartColumnsLine = []
		def chartColumnsBar = []
		def chartColumnsArea = []
		def lstName

                dataLine.each {itemDataLine -&amp;gt;
                    if(itemDataLine.size() &amp;gt; 0 ){
		        chartColumnsLine.add(itemDataLine[0].chart_columns)
	            }
                }
                dataBar.each {itemDataBar -&amp;gt;
                    if(itemDataBar.size() &amp;gt; 0 ){
		        chartColumnsBar.add(itemDataBar[0].chart_columns)
	            }
                }
                dataArea.each {itemDataArea -&amp;gt;
                    if(itemDataArea.size() &amp;gt; 0 ){
		        chartColumnsArea.add(itemDataArea[0].chart_columns)
	            }
                }
		if(dataPie.size() &amp;gt; 0 ){
			lstName = dataPie['name']
		}
		def tmpListNameContainer = []
                
		if(lstName != null) {
                        def chartNumPie = 0
                        def tmpLst
                        for(def nameContainer in lstName){
                           tmpLst = []
			   for(def nameContainerItem in nameContainer ){
                                println "nameContainerItem :" + nameContainerItem 
				nameContainerItem = chartNumPie + "_" + nameContainerItem.replaceAll("\\.", "_")
                                //nameContainerItem = nameContainerItem.replaceAll("\\.", "_")
				tmpLst.add(nameContainerItem )
		            }
                            tmpListNameContainer.add(tmpLst)
                            chartNumPie++
                         }
		}
		def jsonPie
		def jsonLine
		def jsonBar
		def jsonArea
		if(dataPie != []) {
		    jsonPie = com.mongodb.util.JSON.serialize(dataPie)
		}
		if(dataLine != []) {
		    jsonLine = com.mongodb.util.JSON.serialize(dataLine)
		}
		if(dataBar != []) {
		    jsonBar = com.mongodb.util.JSON.serialize(dataBar)
		}
		if(dataArea != []) {
		    jsonArea = com.mongodb.util.JSON.serialize(dataArea)
		}
		def jsonContainerPie
		if(tmpListNameContainer != []) {
			jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
		}
		def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
		def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
		def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

		println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
		if(jsonLine != null) {
			println "&amp;lt;textarea id=\"jsonline_$key\" &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class=\"lstcontainerline_$key\" &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
		}
		if(jsonBar != null) {
			println "&amp;lt;textarea id=\"jsonbar_$key\"&amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerbar_$key' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
		}
		if(jsonPie != null &amp;amp;&amp;amp; jsonContainerPie != null) {
			println "&amp;lt;textarea id=\"jsonpie_$key\" &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerpie_$key' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
		}
		if(jsonArea != null) {
			println "&amp;lt;textarea id=\"jsonarea_$key\" &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerarea_$key' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
		}

        println "&amp;lt;/div&amp;gt;"
          println "jsonPie" + jsonPie
          println "jsonContainerPie " + jsonContainerPie 
        def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
        def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
          
        println "&amp;lt;div style='clear:both'&amp;gt;"
            def description = value.KEYEXPR._description[0][key]
            if(description != null) {
                println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +': ' + description +'&amp;lt;/div&amp;gt;'
            } else {
                println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +'&amp;lt;/div&amp;gt;'
            }
            println "-----"
            if(jsonPie != null) {
          println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
		chartNumPie = 0
          lstName.each{chartPieLst -&amp;gt;
		chartPieLst.each {
println "container${key}_${tmp}"
	            //def tmp = chartNumPie + "_" + it.replaceAll("\\.", "_")
		   // println " &amp;lt;div class=\"displaypie\" id=\"container${key}_${tmp}\" &amp;gt;&amp;lt;/div&amp;gt;"
          	}
		chartNumPie++
	  }	
          println "&amp;lt;/div&amp;gt;"
            }
            if(jsonLine != null) {
          	def chartLineComment = false
		def chartNumLine = 0
          	chartColumnsLine.each{chartColumnsLineItem -&amp;gt;
            		if(!chartLineComment){
               			println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
               			chartLineComment = true  
            		}
		chartColumnsLineItem.each{
              		println " &amp;lt;div class=\"displayblock\" id=\"containerline${key}_${chartNumLine}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          	}
		chartNumLine ++
	    }
          println "&amp;lt;/div&amp;gt;"
            }
            println "&amp;amp;nbsp;"

            if(jsonBar != null) {
          	def chartBarComment = false
  		def chartNumBar = 0
          	chartColumnsBar.each{chartColumnsBarItem -&amp;gt;
             		if(!chartBarComment){
                		println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
                		chartBarComment = true
              		}  
			chartColumnsBarItem.each{
             			println " &amp;lt;div class=\"displayblock\" id=\"containerbar${key}_${chartNumBar}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          		}
			chartNumBar++
		}
          	println "&amp;lt;/div&amp;gt;"
            }
            println "&amp;amp;nbsp;"

            if(jsonArea != null) {
          	def chartAreaComment = false
		def chartNumArea = 0
          	chartColumnsArea.each{chartColumnsAreaItem -&amp;gt;
          		if(!chartAreaComment){
            			println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
            			chartAreaComment = true
          		}
			chartColumnsAreaItem.each{
            			println " &amp;lt;div class=\"displayblock\" id=\"containerarea${key}_${chartNumArea}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          		}
          		chartNumArea++
            	}
        	println "&amp;lt;/div&amp;gt;"
	    }
        /** Statistic data table **/
        println "&amp;lt;center&amp;gt;"        
        println "&amp;lt;div id='livetblContent_"+key+"' style='width:100%;clear:both;align:middle;margin-top:10px'&amp;gt;"   
        println "Statistics data for "+key
        println "&amp;lt;table id='livetableList_"+key+"' style='width:100%;align:center'&amp;gt;&amp;lt;/table&amp;gt;"
        println "&amp;lt;div id='livetablePager_"+key+"' style='position:relative;width:100%'&amp;gt;&amp;lt;/div&amp;gt;"
        println "&amp;lt;/div&amp;gt;"
        println "&amp;lt;/center&amp;gt;"
        println "&amp;lt;script language='javascript'&amp;gt;console.log('Create live table for "+key+"');&amp;lt;/script&amp;gt;"
    }
    //println '&amp;lt;/body&amp;gt;'
    println '{{/html}}'
} else if(result[0].type == "Store") {
	// data store
	def dataLine = DataToDrawChart.getDataToDrawLine(result)
	def dataBar = DataToDrawChart.getDataToDrawBar(result)
	def dataPie = DataToDrawChart.getDataToDrawPie(result)
	def dataArea = DataToDrawChart.getDataToDrawArea(result)
	def chartColumnsLine = []
	def chartColumnsBar = []
	def chartColumnsArea = []
	def lstName

        dataLine.each {itemDataLine -&amp;gt;
            if(itemDataLine.size() &amp;gt; 0 ){
		chartColumnsLine.add(itemDataLine[0].chart_columns)
	    }
        }

        dataBar.each {itemDataBar -&amp;gt;
            if(itemDataBar.size() &amp;gt; 0 ){
		chartColumnsBar.add(itemDataBar[0].chart_columns)
	    }
        }

        dataArea.each {itemDataArea -&amp;gt;
            if(itemDataArea.size() &amp;gt; 0 ){
		chartColumnsArea.add(itemDataArea[0].chart_columns)
	    }
        }

	if(dataPie.size() &amp;gt; 0 ){
		lstName = dataPie['name']
	}

    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
  
    def tmpListNameContainer = []
    def chartNumPie = 0
    for(def nameContainer in lstName){
       for(def nameContainerItem in nameContainer ){
           nameContainerItem = chartNumPie + "_" + nameContainerItem.replaceAll("\\.", "_")
           tmpListNameContainer .add(nameContainerItem )
       }
    }
    
    def jsonPie = com.mongodb.util.JSON.serialize(dataPie)
    def jsonLine = com.mongodb.util.JSON.serialize(dataLine)
    def jsonBar = com.mongodb.util.JSON.serialize(dataBar)
    def jsonArea = com.mongodb.util.JSON.serialize(dataArea)

    def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
    def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
    def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
    def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

    def listEmpty = com.mongodb.util.JSON.serialize([])
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$listEmpty&amp;lt;/textarea&amp;gt;" 

    println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
    println "&amp;lt;textarea class='jsonline' &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonbar' &amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonpie' &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonarea' &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"

    println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;/div&amp;gt;"

    def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
    def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
  
    println "&amp;lt;div style='clear:both'&amp;gt;"
  
    def chartPieComment = false
    chartNumPie = 0
    lstName.each{chartPieLst-&amp;gt;
        if(!chartPieComment) {
            println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
            chartPieComment = true
        }
        chartPieLst.each {
            def tmp = chartNumPie + "_" + it.replaceAll("\\.", "_")
            println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
        }
    }
    println "&amp;lt;/div&amp;gt;"
    	def chartLineComment = false
	def chartNum = 0
    	chartColumnsLine.each{chartColumnsLineItem -&amp;gt;
	    	if(!chartLineComment){
	        	println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	        	chartLineComment = true  
	    	}
		chartColumnsLineItem.each{
	    		println " &amp;lt;div class=\"displayblock\" id=\"containerline${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	    	}
		chartNum++
	}	
    	println "&amp;lt;/div&amp;gt;"
    	println "&amp;amp;nbsp;"
    	def chartBarComment = false
	chartNum = 0
    	chartColumnsBar.each{chartColumnsBarItem -&amp;gt;
	        if(!chartBarComment){
	            println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	            chartBarComment = true
	        }  
		chartColumnsBarItem.each{
	    		println " &amp;lt;div class=\"displayblock\" id=\"containerbar${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  	}
		chartNum++
	}
  println "&amp;lt;/div&amp;gt;"
  println "&amp;amp;nbsp;"
  	def chartAreaComment = false
	chartNum = 0
  	chartColumnsArea.each{chartColumnsAreaItem -&amp;gt;
	  	if(!chartAreaComment){
	    		println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	    		chartAreaComment = true
	  	}
		chartColumnsAreaItem.each{
    			println " &amp;lt;div class=\"displayblock\" id=\"containerarea${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
		}
		chartNum++
  	}
  println "&amp;lt;/div&amp;gt;"
println "&amp;lt;/div&amp;gt;"

//println '&amp;lt;/body&amp;gt;'
println '{{/html}}'
}
}else{
    println 'There is no data for this job with criterias'
}
//--=============== Start build for livetable
def subTypeURLMap = [:]
def dataModel = []
def dataUrl = ""
result.find{rec-&amp;gt;				
    def subtractData = []
    
    //-- Parsing data and assign data to subtract list
    if(rec.type == "Store"){ //-- Store data type
        subtractData = rec['data']        
        subtractData.each{r2-&amp;gt;					
            if(dataModel != null &amp;amp;&amp;amp; dataModel.size() &amp;lt;=0){ 
                dataModel.add("Fetch At")
                dataModel.addAll(r2.keySet());					
            } 
        }        
        dataUrl = "/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job="+job +"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate + "&amp;amp;toDate=" + toDate + "&amp;amp;istIid="+istIid        
        //-- Building data model				
        def model = []
        def colSpec
        dataModel.each{name-&amp;gt;
            colSpec = [:]
            colSpec['name'] = name
            colSpec['index'] = name
            colSpec['width'] = "100"
            model.add(colSpec)
        }
        def dataModelStr = (new JsonBuilder(dataModel)).toPrettyString()
        def modelStr = (new JsonBuilder(model)).toPrettyString() 
        str = 
        "{\"url\":\""+dataUrl+"\",\"datatype\":\"json\","+
            "\"colNames\":"+ dataModelStr +
            ",\"colModel\":"+ modelStr +" ,\"rowList\":[10,20,30],"+
            "\"pager\":\"#livetablePager\", \"viewrecords\": true, \"sortname\": \"RECORD_SEQ\","+
            "\"sortorder\": \"asc\", \"caption\":\""+job+"\"}"
        println "{{html clean=\"false\" wiki=\"true\"}}"
        println "&amp;lt;div id='livetableJson' style = \"display:none\"&amp;gt;"
        //println "&amp;lt;div id='livetableJson'&amp;gt;"
        println str;
        println "&amp;lt;/div&amp;gt;"
        println "{{/html}}"
    }else{ //-- Subtype			
        def subData = rec['data']
        subData.each{key,value-&amp;gt;
            dataUrl = "/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job="+job +"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate + "&amp;amp;toDate=" + toDate + "&amp;amp;istIid="+istIid+"&amp;amp;subType="+key
            subtractData = value
            subtractData.each{r2-&amp;gt;					
                if(dataModel != null &amp;amp;&amp;amp; dataModel.size() &amp;lt;=0){ 
                    dataModel.add("Fetch At")
                    dataModel.addAll(r2.keySet());					
                } 			
            }
            //-- Building data model				
            def model = []
            def colSpec
            dataModel.each{name-&amp;gt;
                colSpec = [:]
                colSpec['name'] = name
                colSpec['index'] = name
                colSpec['width'] = "100"
                model.add(colSpec)
            }
            def dataModelStr = (new JsonBuilder(dataModel)).toPrettyString()
            def modelStr = (new JsonBuilder(model)).toPrettyString() 
            str = 
            "{\"url\":\""+dataUrl+"\",\"datatype\":\"json\","+
                "\"colNames\":"+ dataModelStr +
                ",\"colModel\":"+ modelStr +" ,\"rowList\":[10,20,30],"+
                "\"pager\":\"#livetablePager\", \"viewrecords\": true, \"sortname\": \"RECORD_SEQ\","+
                "\"sortorder\": \"asc\", \"caption\":\""+job+"\"}"
            subTypeURLMap[key] = str
        }
        def finalStr = (new JsonBuilder(subTypeURLMap)).toPrettyString()
        println "{{html clean=\"false\" wiki=\"true\"}}"
        println "&amp;lt;div id='livetableJson' style = \"display:none\"&amp;gt;"
        //println "&amp;lt;div id='livetableJson'&amp;gt;"
        println finalStr;
        println "&amp;lt;/div&amp;gt;"
        println "{{/html}}"
    }
    return true
}
 //--=============== END

if(listKey.size() &amp;lt;= 0){   
    println "{{html clean=\"false\" wiki=\"true\"}}"
    println "&amp;lt;center&amp;gt;"
    println "&amp;lt;div id=\"livetblContent\" style=\"width:100%;clear:both;align:middle;margin-top:10px\"&amp;gt;"   
    println "Statistics Data"
    println "&amp;lt;table id=\"livetableList\" style=\"width:100%;align:center\"&amp;gt;&amp;lt;/table&amp;gt;"    
    println "&amp;lt;div id=\"livetablePager\"&amp;gt;&amp;lt;/div&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
    println "&amp;lt;/center&amp;gt;"
    
    println "&amp;lt;div id=\"testDiv\"&amp;gt;&amp;amp;nbsp;&amp;lt;/div&amp;gt;"
    println "{{/html}}"
}
{{/groovy}}
&lt;/content&gt;&lt;/xwikidoc&gt;@


61.17
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376557115000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;61.17&lt;/version&gt;
d2953 1
a2953 1
			} else {
d2968 1
a2968 1
						drawPieChart(finalData, lstContainer[0][i])
d2970 1
a2970 1
				}
@


61.16
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376557063000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376557063000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.16&lt;/version&gt;
d3441 2
a3442 2
	            def tmp = chartNumPie + "_" + it.replaceAll("\\.", "_")
		    println " &amp;lt;div class=\"displaypie\" id=\"container${key}_${tmp}\" &amp;gt;&amp;lt;/div&amp;gt;"
@


61.15
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376556974000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376556974000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.15&lt;/version&gt;
d3422 2
a3423 1
          
@


61.14
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376552941000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376552941000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.14&lt;/version&gt;
a3420 4
        println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
        println "&amp;lt;input style=\"display:none\" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;"
        println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
        println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'
d3439 1
@


61.13
log
@@
text
@&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xwikidoc&gt;
&lt;web&gt;WiperDog&lt;/web&gt;
&lt;name&gt;WebHome&lt;/name&gt;
&lt;language&gt;&lt;/language&gt;
&lt;defaultLanguage&gt;en&lt;/defaultLanguage&gt;
&lt;translation&gt;0&lt;/translation&gt;
&lt;parent&gt;&lt;/parent&gt;
&lt;creator&gt;XWiki.Admin&lt;/creator&gt;
&lt;author&gt;XWiki.Admin&lt;/author&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;contentAuthor&gt;XWiki.Admin&lt;/contentAuthor&gt;
&lt;creationDate&gt;1376364375000&lt;/creationDate&gt;
&lt;date&gt;1376552765000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376552765000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.13&lt;/version&gt;
&lt;title&gt;WiperDog&lt;/title&gt;
&lt;defaultTemplate&gt;&lt;/defaultTemplate&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;comment&gt;&lt;/comment&gt;
&lt;minorEdit&gt;true&lt;/minorEdit&gt;
&lt;syntaxId&gt;xwiki/2.1&lt;/syntaxId&gt;
&lt;hidden&gt;false&lt;/hidden&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;047293a8-524d-45e4-af52-cd944523d5d0&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
/*
 * jQuery timepicker addon
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 1.3.1
 * Last Modified: 07/07/2013
 *
 * Copyright 2013 Trent Richardson
 * You may use this project under MIT or GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 */

/*jslint evil: true, white: false, undef: false, nomen: false */

(function($) {

	/*
	* Lets not redefine timepicker, Prevent "Uncaught RangeError: Maximum call stack size exceeded"
	*/
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return;
	}

	/*
	* Extend jQueryUI, get it started with our version number
	*/
	$.extend($.ui, {
		timepicker: {
			version: "1.3.1"
		}
	});

	/* 
	* Timepicker manager.
	* Use the singleton instance of this class, $.timepicker, to interact with the time picker.
	* Settings for (groups of) time pickers are maintained in an instance object,
	* allowing multiple different settings on the same page.
	*/
	var Timepicker = function() {
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[''] = { // Default regional settings
			currentText: 'Now',
			closeText: 'Done',
			amNames: ['AM', 'A'],
			pmNames: ['PM', 'P'],
			timeFormat: 'HH:mm',
			timeSuffix: '',
			timeOnlyTitle: 'Choose Time',
			timeText: 'Time',
			hourText: 'Hour',
			minuteText: 'Minute',
			secondText: 'Second',
			millisecText: 'Millisecond',
			microsecText: 'Microsecond',
			timezoneText: 'Time Zone',
			isRTL: false
		};
		this._defaults = { // Global defaults for all the datetime picker instances
			showButtonPanel: true,
			timeOnly: false,
			showHour: null,
			showMinute: null,
			showSecond: null,
			showMillisec: null,
			showMicrosec: null,
			showTimezone: null,
			showTime: true,
			stepHour: 1,
			stepMinute: 1,
			stepSecond: 1,
			stepMillisec: 1,
			stepMicrosec: 1,
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null,
			hourMin: 0,
			minuteMin: 0,
			secondMin: 0,
			millisecMin: 0,
			microsecMin: 0,
			hourMax: 23,
			minuteMax: 59,
			secondMax: 59,
			millisecMax: 999,
			microsecMax: 999,
			minDateTime: null,
			maxDateTime: null,
			onSelect: null,
			hourGrid: 0,
			minuteGrid: 0,
			secondGrid: 0,
			millisecGrid: 0,
			microsecGrid: 0,
			alwaysSetTime: true,
			separator: ' ',
			altFieldTimeOnly: true,
			altTimeFormat: null,
			altSeparator: null,
			altTimeSuffix: null,
			pickerTimeFormat: null,
			pickerTimeSuffix: null,
			showTimepicker: true,
			timezoneList: null,
			addSliderAccess: false,
			sliderAccessArgs: null,
			controlType: 'slider',
			defaultValue: null,
			parse: 'strict'
		};
		$.extend(this._defaults, this.regional['']);
	};

	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: '',
		formattedDate: '',
		formattedTime: '',
		formattedDateTime: '',
		timezoneList: null,
		units: ['hour','minute','second','millisec', 'microsec'],
		support: {},
		control: null,

		/* 
		* Override the default settings for all instances of the time picker.
		* @@param  settings  object - the new settings to use as defaults (anonymous object)
		* @@return the manager object
		*/
		setDefaults: function(settings) {
			extendRemove(this._defaults, settings || {});
			return this;
		},

		/*
		* Create a new Timepicker instance
		*/
		_newInst: function($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
            	fns = {},
		    	overrides, i;

			for (var attrName in this._defaults) {
				if(this._defaults.hasOwnProperty(attrName)){
					var attrValue = $input.attr('time:' + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue);
						} catch (err) {
							inlineSettings[attrName] = attrValue;
						}
					}
				}
			}

		    overrides = {
		        beforeShow: function (input, dp_inst) {
		            if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
		                return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst);
		            }
		        },
		        onChangeMonthYear: function (year, month, dp_inst) {
		            // Update the time as well : this prevents the time from disappearing from the $input field.
		            tp_inst._updateDateTime(dp_inst);
		            if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
		                tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst);
		            }
		        },
		        onClose: function (dateText, dp_inst) {
		            if (tp_inst.timeDefined === true &amp;amp;&amp;amp; $input.val() !== '') {
		                tp_inst._updateDateTime(dp_inst);
		            }
		            if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
		                tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst);
		            }
		        }
		    };
		    for (i in overrides) {
		        if (overrides.hasOwnProperty(i)) {
		            fns[i] = opts[i] || null;
		        }
		    }

		    tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
		        evnts:fns,
		        timepicker: tp_inst // add timepicker as a property of datepicker: $.datepicker._get(dp_inst, 'timepicker');
		    });
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function(val) {
				return val.toUpperCase();
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function(val) {
				return val.toUpperCase();
			});

			// detect which units are supported
			tp_inst.support = detectSupport(
					tp_inst._defaults.timeFormat + 
					(tp_inst._defaults.pickerTimeFormat? tp_inst._defaults.pickerTimeFormat:'') + 
					(tp_inst._defaults.altTimeFormat? tp_inst._defaults.altTimeFormat:''));

			// controlType is string - key to our this._controls
			if(typeof(tp_inst._defaults.controlType) === 'string'){
				if(tp_inst._defaults.controlType == 'slider' &amp;amp;&amp;amp; typeof(jQuery.ui.slider) === 'undefined'){
					tp_inst._defaults.controlType = 'select';
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType];
			}
			// controlType is an object and must implement create, options, value methods
			else{ 
				tp_inst.control = tp_inst._defaults.controlType;
			}

			// prep the timezone options
			var timezoneList = [-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,
					0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList;
			}
			var tzl=timezoneList.length,tzi=0,tzv=null;
			if (tzl &amp;gt; 0 &amp;amp;&amp;amp; typeof timezoneList[0] !== 'object') {
				for(; tzi&amp;lt;tzl; tzi++){
					tzv = timezoneList[tzi];
					timezoneList[tzi] = { value: tzv, label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601) };
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;

			// set the default units
			tp_inst.timezone = tp_inst._defaults.timezone !== null? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) : 
							((new Date()).getTimezoneOffset()*-1);
			tp_inst.hour = tp_inst._defaults.hour &amp;lt; tp_inst._defaults.hourMin? tp_inst._defaults.hourMin : 
							tp_inst._defaults.hour &amp;gt; tp_inst._defaults.hourMax? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute &amp;lt; tp_inst._defaults.minuteMin? tp_inst._defaults.minuteMin : 
							tp_inst._defaults.minute &amp;gt; tp_inst._defaults.minuteMax? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second &amp;lt; tp_inst._defaults.secondMin? tp_inst._defaults.secondMin : 
							tp_inst._defaults.second &amp;gt; tp_inst._defaults.secondMax? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec &amp;lt; tp_inst._defaults.millisecMin? tp_inst._defaults.millisecMin : 
							tp_inst._defaults.millisec &amp;gt; tp_inst._defaults.millisecMax? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec &amp;lt; tp_inst._defaults.microsecMin? tp_inst._defaults.microsecMin : 
							tp_inst._defaults.microsec &amp;gt; tp_inst._defaults.microsecMax? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = '';
			tp_inst.$input = $input;

			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField).css({
					cursor: 'pointer'
				}).focus(function() {
					$input.trigger("focus");
				});
			}

			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date();
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date();
			}

			// datepicker needs minDate/maxDate, timepicker needs minDateTime/maxDateTime..
			if (tp_inst._defaults.minDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime());
			}
			if (tp_inst._defaults.minDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime());
			}
			if (tp_inst._defaults.maxDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime());
			}
			if (tp_inst._defaults.maxDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime());
			}
			tp_inst.$input.bind('focus', function() {
				tp_inst._onFocus();
			});

			return tp_inst;
		},

		/*
		* add our sliders to the calendar
		*/
		_addTimePicker: function(dp_inst) {
			var currDT = (this.$altInput &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly) ? this.$input.val() + ' ' + this.$altInput.val() : this.$input.val();

			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
		},

		/*
		* parse the time string from input value or _setTime
		*/
		_parseTime: function(timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0]);
			}

			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, 'dateFormat');
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false;
					}
					$.extend(this, parseRes.timeObj);
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err +
									"\ndate/time string = " + timeString +
									"\ntimeFormat = " + this._defaults.timeFormat +
									"\ndateFormat = " + dp_dateFormat);
					return false;
				}
				return true;
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false;
				}
				$.extend(this, timeObj);
				return true;
			}
		},

		/*
		* generate and inject html for timepicker into ui datepicker
		*/
		_injectTimePicker: function() {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = '',
				uitem = '',
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i=0,
				l=0;

			// Prevent displaying twice
			if ($dp.find("div.ui-timepicker-div").length === 0 &amp;amp;&amp;amp; o.showTimepicker) {
				var noDisplay = ' style="display:none;"',
					html = '&amp;lt;div class="ui-timepicker-div'+ (o.isRTL? ' ui-timepicker-rtl' : '') +'"&amp;gt;&amp;lt;dl&amp;gt;' + '&amp;lt;dt class="ui_tpicker_time_label"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;' + o.timeText + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_time"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the markup
				for(i=0,l=this.units.length; i&amp;lt;l; i++){
					litem = this.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// Added by Peter Medeiros:
					// - Figure out what the hour/minute/second max should be based on the step values.
					// - Example: if stepMinute is 15, then minMax is 45.
					max[litem] = parseInt((o[litem+'Max'] - ((o[litem+'Max'] - o[litem+'Min']) % o['step'+uitem])), 10);
					gridSize[litem] = 0;

					html += '&amp;lt;dt class="ui_tpicker_'+ litem +'_label"' + (show ? '' : noDisplay) + '&amp;gt;' + o[litem +'Text'] + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_'+ litem +'"&amp;gt;&amp;lt;div class="ui_tpicker_'+ litem +'_slider"' + (show ? '' : noDisplay) + '&amp;gt;&amp;lt;/div&amp;gt;';

					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						html += '&amp;lt;div style="padding-left: 1px"&amp;gt;&amp;lt;table class="ui-tpicker-grid-label"&amp;gt;&amp;lt;tr&amp;gt;';

						if(litem == 'hour'){
							for (var h = o[litem+'Min']; h &amp;lt;= max[litem]; h += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm? 'hht':'HH', {hour:h}, o);									
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + tmph + '&amp;lt;/td&amp;gt;';
							}
						}
						else{
							for (var m = o[litem+'Min']; m &amp;lt;= max[litem]; m += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + ((m &amp;lt; 10) ? '0' : '') + m + '&amp;lt;/td&amp;gt;';
							}
						}

						html += '&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;&amp;lt;/div&amp;gt;';
					}
					html += '&amp;lt;/dd&amp;gt;';
				}
				
				// Timezone
				var showTz = o.showTimezone !== null? o.showTimezone : this.support.timezone;
				html += '&amp;lt;dt class="ui_tpicker_timezone_label"' + (showTz ? '' : noDisplay) + '&amp;gt;' + o.timezoneText + '&amp;lt;/dt&amp;gt;';
				html += '&amp;lt;dd class="ui_tpicker_timezone" ' + (showTz ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the elements from string
				html += '&amp;lt;/dl&amp;gt;&amp;lt;/div&amp;gt;';
				var $tp = $(html);

				// if we only want time picker...
				if (o.timeOnly === true) {
					$tp.prepend('&amp;lt;div class="ui-widget-header ui-helper-clearfix ui-corner-all"&amp;gt;' + '&amp;lt;div class="ui-datepicker-title"&amp;gt;' + o.timeOnlyTitle + '&amp;lt;/div&amp;gt;' + '&amp;lt;/div&amp;gt;');
					$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();
				}
				
				// add sliders, adjust grids, add events
				for(i=0,l=tp_inst.units.length; i&amp;lt;l; i++){
					litem = tp_inst.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// add the slider
					tp_inst[litem+'_slider'] = tp_inst.control.create(tp_inst, $tp.find('.ui_tpicker_'+litem+'_slider'), litem, tp_inst[litem], o[litem+'Min'], max[litem], o['step'+uitem]);

					// adjust the grid and add click event
					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						size = 100 * gridSize[litem] * o[litem+'Grid'] / (max[litem] - o[litem+'Min']);
						$tp.find('.ui_tpicker_'+litem+' table').css({
							width: size + "%",
							marginLeft: o.isRTL? '0' : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL? ((size / (-2 * gridSize[litem])) + "%") : '0',
							borderCollapse: 'collapse'
						}).find("td").click(function(e){
								var $t = $(this),
									h = $t.html(),
									n = parseInt(h.replace(/[^0-9]/g),10),
									ap = h.replace(/[^apm]/ig),
									f = $t.data('for'); // loses scope, so we use data-for

								if(f == 'hour'){
									if(ap.indexOf('p') !== -1 &amp;amp;&amp;amp; n &amp;lt; 12){
										n += 12;
									}
									else{
										if(ap.indexOf('a') !== -1 &amp;amp;&amp;amp; n === 12){
											n = 0;
										}
									}
								}
								
								tp_inst.control.value(tp_inst, tp_inst[f+'_slider'], litem, n);

								tp_inst._onTimeChange();
								tp_inst._onSelectHandler();
							}).css({
								cursor: 'pointer',
								width: (100 / gridSize[litem]) + '%',
								textAlign: 'center',
								overflow: 'hidden'
							});
					} // end if grid &amp;gt; 0
				} // end for loop

				// Add timezone options
				this.timezone_select = $tp.find('.ui_tpicker_timezone').append('&amp;lt;select&amp;gt;&amp;lt;/select&amp;gt;').find("select");
				$.fn.append.apply(this.timezone_select,
				$.map(o.timezoneList, function(val, idx) {
					return $("&amp;lt;option /&amp;gt;").val(typeof val == "object" ? val.value : val).text(typeof val == "object" ? val.label : val);
				}));
				if (typeof(this.timezone) != "undefined" &amp;amp;&amp;amp; this.timezone !== null &amp;amp;&amp;amp; this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset()*-1;
					if (local_timezone == this.timezone) {
						selectLocalTimezone(tp_inst);
					} else {
						this.timezone_select.val(this.timezone);
					}
				} else {
					if (typeof(this.hour) != "undefined" &amp;amp;&amp;amp; this.hour !== null &amp;amp;&amp;amp; this.hour !== "") {
						this.timezone_select.val(o.timezone);
					} else {
						selectLocalTimezone(tp_inst);
					}
				}
				this.timezone_select.change(function() {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
				});
				// End timezone options
				
				// inject timepicker into datepicker
				var $buttonPanel = $dp.find('.ui-datepicker-buttonpane');
				if ($buttonPanel.length) {
					$buttonPanel.before($tp);
				} else {
					$dp.append($tp);
				}

				this.$timeObj = $tp.find('.ui_tpicker_time');

				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined;
				}

				// slideAccess integration: http://trentrichardson.com/2011/11/11/jquery-ui-sliders-and-touch-accessibility/
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
						
					setTimeout(function() { // fix for inline mode
						if ($tp.find('.ui-slider-access').length === 0) {
							$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);

							// fix any grids since sliders are shorter
							var sliderAccessWidth = $tp.find('.ui-slider-access:eq(0)').outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find('table:visible').each(function() {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl? 'marginRight':'marginLeft').toString().replace('%', ''),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + '%',
										css = { width: newWidth, marginRight: 0, marginLeft: 0 };
									css[rtl? 'marginRight':'marginLeft'] = newMarginLeft;
									$g.css(css);
								});
							}
						}
					}, 10);
				}
				// end slideAccess integration

				tp_inst._limitMinMaxDateTime(this.inst, true);
			}
		},

		/*
		* This function tries to limit the ability to go outside the
		* min/max date range
		*/
		_limitMinMaxDateTime: function(dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);

			if (!this._defaults.showTimepicker) {
				return;
			} // No time so nothing to check here

			if ($.datepicker._get(dp_inst, 'minDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'minDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, 'minDateTime'),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin;
				}

				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour &amp;lt;= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute &amp;lt;= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second &amp;lt;= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if(this.millisec &amp;lt;= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;lt; this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin;
									}
									this._defaults.microsecMin = this.microsecMinOriginal;
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal;
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal;
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal;
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal;
				}
			}

			if ($.datepicker._get(dp_inst, 'maxDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'maxDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, 'maxDateTime'),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax;
				}

				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour &amp;gt;= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute &amp;gt;= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second &amp;gt;= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec &amp;gt;= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;gt; this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax;
									}
									this._defaults.microsecMax = this.microsecMaxOriginal;
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal;
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal;
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal;
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal;
				}
			}

			if (adjustSliders !== undefined &amp;amp;&amp;amp; adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10);
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);

				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, 'hour', { min: this._defaults.hourMin, max: hourMax });
					this.control.value(this, this.hour_slider, 'hour', this.hour - (this.hour % this._defaults.stepHour));
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, 'minute', { min: this._defaults.minuteMin, max: minMax });
					this.control.value(this, this.minute_slider, 'minute', this.minute - (this.minute % this._defaults.stepMinute));
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, 'second', { min: this._defaults.secondMin, max: secMax });
					this.control.value(this, this.second_slider, 'second', this.second - (this.second % this._defaults.stepSecond));
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, 'millisec', { min: this._defaults.millisecMin, max: millisecMax });
					this.control.value(this, this.millisec_slider, 'millisec', this.millisec - (this.millisec % this._defaults.stepMillisec));
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, 'microsec', { min: this._defaults.microsecMin, max: microsecMax });
					this.control.value(this, this.microsec_slider, 'microsec', this.microsec - (this.microsec % this._defaults.stepMicrosec));
				}
			}

		},

		/*
		* when a slider moves, set the internal time...
		* on time change is also called when the time is updated in the text field
		*/
		_onTimeChange: function() {
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, 'hour') : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, 'minute') : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, 'second') : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, 'millisec') : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, 'microsec') : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;

			if (typeof(hour) == 'object') {
				hour = false;
			}
			if (typeof(minute) == 'object') {
				minute = false;
			}
			if (typeof(second) == 'object') {
				second = false;
			}
			if (typeof(millisec) == 'object') {
				millisec = false;
			}
			if (typeof(microsec) == 'object') {
				microsec = false;
			}
			if (typeof(timezone) == 'object') {
				timezone = false;
			}

			if (hour !== false) {
				hour = parseInt(hour, 10);
			}
			if (minute !== false) {
				minute = parseInt(minute, 10);
			}
			if (second !== false) {
				second = parseInt(second, 10);
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10);
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10);
			}

			var ampm = o[hour &amp;lt; 12 ? 'amNames' : 'pmNames'][0];

			// If the update was done in the input field, the input field should not be updated.
			// If the update was done using the sliders, update the input field.
			var hasChanged = (hour != this.hour || minute != this.minute || second != this.second || millisec != this.millisec || microsec != this.microsec 
								|| (this.ampm.length &amp;gt; 0 &amp;amp;&amp;amp; (hour &amp;lt; 12) != ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) 
								|| (this.timezone !== null &amp;amp;&amp;amp; timezone != this.timezone));

			if (hasChanged) {

				if (hour !== false) {
					this.hour = hour;
				}
				if (minute !== false) {
					this.minute = minute;
				}
				if (second !== false) {
					this.second = second;
				}
				if (millisec !== false) {
					this.millisec = millisec;
				}
				if (microsec !== false) {
					this.microsec = microsec;
				}
				if (timezone !== false) {
					this.timezone = timezone;
				}

				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0]);
				}

				this._limitMinMaxDateTime(this.inst, true);
			}
			if (this.support.ampm) {
				this.ampm = ampm;
			}

			// Updates the time within the timepicker
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if(pickerTimeFormat === o.timeFormat){
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix);
				}
				else{
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix);
				}
			}

			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime();
			}
		},

		/*
		* call custom onSelect.
		* bind to sliders slidestop, and grid click.
		*/
		_onSelectHandler: function() {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect &amp;amp;&amp;amp; inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this]);
			}
		},

		/*
		* update our input with the new date time..
		*/
		_updateDateTime: function(dp_inst) {
			dp_inst = this.inst || dp_inst;
			//var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
			var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay)),
				dateFmt = $.datepicker._get(dp_inst, 'dateFormat'),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null &amp;amp;&amp;amp; this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			
			// if a slider was changed but datepicker doesn't have a value yet, set it
			if(dp_inst.lastVal===""){
                dp_inst.currentYear=dp_inst.selectedYear;
                dp_inst.currentMonth=dp_inst.selectedMonth;
                dp_inst.currentDay=dp_inst.selectedDay;
            }

			/*
			* remove following lines to force every changes in date picker to change the input value
			* Bug descriptions: when an input field has a default value, and click on the field to pop up the date picker. 
			* If the user manually empty the value in the input field, the date picker will never change selected value.
			*/
			//if (dp_inst.lastVal !== undefined &amp;amp;&amp;amp; (dp_inst.lastVal.length &amp;gt; 0 &amp;amp;&amp;amp; this.$input.val().length === 0)) {
			//	return;
			//}

			if (this._defaults.timeOnly === true) {
				formattedDateTime = this.formattedTime;
			} else if (this._defaults.timeOnly !== true &amp;amp;&amp;amp; (this._defaults.alwaysSetTime || timeAvailable)) {
				formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix;
			}

			this.formattedDateTime = formattedDateTime;

			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate);
			} else if (this.$altInput &amp;amp;&amp;amp; this._defaults.timeOnly === false &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly === true) {
				this.$altInput.val(this.formattedTime);
				this.$input.val(this.formattedDate);
			} else if (this.$altInput) {
				this.$input.val(formattedDateTime);
				var altFormattedDateTime = '',
					altSeparator = this._defaults.altSeparator ? this._defaults.altSeparator : this._defaults.separator,
					altTimeSuffix = this._defaults.altTimeSuffix ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
				
				if(!this._defaults.timeOnly){
					if (this._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg);
					}
					else{
						altFormattedDateTime = this.formattedDate;
					}

					if (altFormattedDateTime){
						altFormattedDateTime += altSeparator;
					}
				}

				if(this._defaults.altTimeFormat){
					altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix;
				}
				else{
					altFormattedDateTime += this.formattedTime + altTimeSuffix;
				}
				this.$altInput.val(altFormattedDateTime);
			} else {
				this.$input.val(formattedDateTime);
			}

			this.$input.trigger("change");
		},

		_onFocus: function() {
			if (!this.$input.val() &amp;amp;&amp;amp; this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, 'timepicker');
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst);
						} catch (err) {
							$.timepicker.log(err);
						}
					}
				}
			}
		},

		/*
		* Small abstraction to control types
		* We can add more, just be sure to follow the pattern: create, options, value
		*/
		_controls: {
			// slider methods
			slider: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var rtl = tp_inst._defaults.isRTL; // if rtl go -60-&amp;gt;0 instead of 0-&amp;gt;60
					return obj.prop('slide', null).slider({
						orientation: "horizontal",
						value: rtl? val*-1 : val,
						min: rtl? max*-1 : min,
						max: rtl? min*-1 : max,
						step: step,
						slide: function(event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl? ui.value*-1:ui.value);
							tp_inst._onTimeChange();
						},
						stop: function(event, ui) {
							tp_inst._onSelectHandler();
						}
					});	
				},
				options: function(tp_inst, obj, unit, opts, val){
					if(tp_inst._defaults.isRTL){
						if(typeof(opts) == 'string'){
							if(opts == 'min' || opts == 'max'){
								if(val !== undefined){
									return obj.slider(opts, val*-1);
								}
								return Math.abs(obj.slider(opts));
							}
							return obj.slider(opts);
						}
						var min = opts.min, 
							max = opts.max;
						opts.min = opts.max = null;
						if(min !== undefined){
							opts.max = min * -1;
						}
						if(max !== undefined){
							opts.min = max * -1;
						}
						return obj.slider(opts);
					}
					if(typeof(opts) == 'string' &amp;amp;&amp;amp; val !== undefined){
							return obj.slider(opts, val);
					}
					return obj.slider(opts);
				},
				value: function(tp_inst, obj, unit, val){
					if(tp_inst._defaults.isRTL){
						if(val !== undefined){
							return obj.slider('value', val*-1);
						}
						return Math.abs(obj.slider('value'));
					}
					if(val !== undefined){
						return obj.slider('value', val);
					}
					return obj.slider('value');
				}
			},
			// select methods
			select: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var sel = '&amp;lt;select class="ui-timepicker-select" data-unit="'+ unit +'" data-min="'+ min +'" data-max="'+ max +'" data-step="'+ step +'"&amp;gt;',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;

					for(var i=min; i&amp;lt;=max; i+=step){						
						sel += '&amp;lt;option value="'+ i +'"'+ (i==val? ' selected':'') +'&amp;gt;';
						if(unit == 'hour'){
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig,'')), {hour:i}, tp_inst._defaults);
						}
						else if(unit == 'millisec' || unit == 'microsec' || i &amp;gt;= 10){ sel += i; }
						else {sel += '0'+ i.toString(); }
						sel += '&amp;lt;/option&amp;gt;';
					}
					sel += '&amp;lt;/select&amp;gt;';

					obj.children('select').remove();

					$(sel).appendTo(obj).change(function(e){
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
					});

					return obj;
				},
				options: function(tp_inst, obj, unit, opts, val){
					var o = {},
						$t = obj.children('select');
					if(typeof(opts) == 'string'){
						if(val === undefined){
							return $t.data(opts);
						}
						o[opts] = val;	
					}
					else{ o = opts; }
					return tp_inst.control.create(tp_inst, obj, $t.data('unit'), $t.val(), o.min || $t.data('min'), o.max || $t.data('max'), o.step || $t.data('step'));
				},
				value: function(tp_inst, obj, unit, val){
					var $t = obj.children('select');
					if(val !== undefined){
						return $t.val(val);
					}
					return $t.val();
				}
			}
		} // end _controls

	});

	$.fn.extend({
		/*
		* shorthand just to use timepicker..
		*/
		timepicker: function(o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);

			if (typeof o == 'object') {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				});
			}

			return $(this).each(function() {
				$.fn.datetimepicker.apply($(this), tmp_args);
			});
		},

		/*
		* extend timepicker to datepicker
		*/
		datetimepicker: function(o) {
			o = o || {};
			var tmp_args = arguments;

			if (typeof(o) == 'string') {
				if (o == 'getDate') {
					return $.fn.datepicker.apply($(this[0]), tmp_args);
				} else {
					return this.each(function() {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args);
					});
				}
			} else {
				return this.each(function() {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults);
				});
			}
		}
	});

	/*
	* Public Utility to parse date and time
	*/
	$.datepicker.parseDateTime = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec);
		}

		return parseRes.date;
	};

	/*
	* Public utility to parse time
	*/
	$.datepicker.parseTime = function(timeFormat, timeString, options) {		
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g,'').indexOf('Z') !== -1);

		// Strict parse requires the timeString to match the timeFormat exactly
		var strictParse = function(f, s, o){

			// pattern for standard and localized AM/PM markers
			var getPatternAmpm = function(amNames, pmNames) {
				var markers = [];
				if (amNames) {
					$.merge(markers, amNames);
				}
				if (pmNames) {
					$.merge(markers, pmNames);
				}
				markers = $.map(markers, function(val) {
					return val.replace(/[.*+?|()\[\]{}\\]/g, '\\$&amp;amp;');
				});
				return '(' + markers.join('|') + ')?';
			};

			// figure out position of time elements.. cause js cant do named captures
			var getFormatPositions = function(timeFormat) {
				var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
					orders = {
						h: -1,
						m: -1,
						s: -1,
						l: -1,
						c: -1,
						t: -1,
						z: -1
					};

				if (finds) {
					for (var i = 0; i &amp;lt; finds.length; i++) {
						if (orders[finds[i].toString().charAt(0)] == -1) {
							orders[finds[i].toString().charAt(0)] = i + 1;
						}
					}
				}
				return orders;
			};

			var regstr = '^' + f.toString()
					.replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
							var ml = match.length;
							switch (match.charAt(0).toLowerCase()) {
								case 'h': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'm': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 's': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'l': return '(\\d?\\d?\\d)';
								case 'c': return '(\\d?\\d?\\d)';
								case 'z': return '(z|[-+]\\d\\d:?\\d\\d|\\S+)?';
								case 't': return getPatternAmpm(o.amNames, o.pmNames);
								default:    // literal escaped in quotes
									return '(' + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function (m) { return "\\" + m; }) + ')?';
							}
						})
					.replace(/\s/g, '\\s?') +
					o.timeSuffix + '$',
				order = getFormatPositions(f),
				ampm = '',
				treg;

			treg = s.match(new RegExp(regstr, 'i'));

			var resTime = {
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0
			};

			if (treg) {
				if (order.t !== -1) {
					if (treg[order.t] === undefined || treg[order.t].length === 0) {
						ampm = '';
						resTime.ampm = '';
					} else {
						ampm = $.inArray(treg[order.t].toUpperCase(), o.amNames) !== -1 ? 'AM' : 'PM';
						resTime.ampm = o[ampm == 'AM' ? 'amNames' : 'pmNames'][0];
					}
				}

				if (order.h !== -1) {
					if (ampm == 'AM' &amp;amp;&amp;amp; treg[order.h] == '12') {
						resTime.hour = 0; // 12am = 0 hour
					} else {
						if (ampm == 'PM' &amp;amp;&amp;amp; treg[order.h] != '12') {
							resTime.hour = parseInt(treg[order.h], 10) + 12; // 12pm = 12 hour, any other pm = hour + 12
						} else {
							resTime.hour = Number(treg[order.h]);
						}
					}
				}

				if (order.m !== -1) {
					resTime.minute = Number(treg[order.m]);
				}
				if (order.s !== -1) {
					resTime.second = Number(treg[order.s]);
				}
				if (order.l !== -1) {
					resTime.millisec = Number(treg[order.l]);
				}
				if (order.c !== -1) {
					resTime.microsec = Number(treg[order.c]);
				}
				if (order.z !== -1 &amp;amp;&amp;amp; treg[order.z] !== undefined) {
					resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z]);
				}


				return resTime;
			}
			return false;
		};// end strictParse

		// First try JS Date, if that fails, use strictParse
		var looseParse = function(f,s,o){
			try{
				var d = new Date('2012-01-01 '+ s);
				if(isNaN(d.getTime())){
					d = new Date('2012-01-01T'+ s);
					if(isNaN(d.getTime())){
						d = new Date('01/01/2012 '+ s);
						if(isNaN(d.getTime())){
							throw "Unable to parse time with native Date: "+ s;
						}
					}
				}

				return {
					hour: d.getHours(),
					minute: d.getMinutes(),
					second: d.getSeconds(),
					millisec: d.getMilliseconds(),
					microsec: d.getMicroseconds(),
					timezone: d.getTimezoneOffset()*-1
				};
			}
			catch(err){
				try{
					return strictParse(f,s,o);
				}
				catch(err2){
					$.timepicker.log("Unable to parse \ntimeString: "+ s +"\ntimeFormat: "+ f);
				}				
			}
			return false;
		}; // end looseParse
		
		if(typeof o.parse === "function"){
			return o.parse(timeFormat, timeString, o);
		}
		if(o.parse === 'loose'){
			return looseParse(timeFormat, timeString, o);
		}
		return strictParse(timeFormat, timeString, o);
	};

	/*
	* Public utility to format the time
	* format = string format of the time
	* time = a {}, not a Date() for timezones
	* options = essentially the regional[].. amNames, pmNames, ampm
	*/
	$.datepicker.formatTime = function(format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			timezone: 0
		}, time);

		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);

		if (hour &amp;gt; 11) {
			ampmName = options.pmNames[0];
		}

		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|('.*?'|".*?"))/g, function(match) {
		switch (match) {
			case 'HH':
				return ('0' + hour).slice(-2);
			case 'H':
				return hour;
			case 'hh':
				return ('0' + convert24to12(hour)).slice(-2);
			case 'h':
				return convert24to12(hour);
			case 'mm':
				return ('0' + time.minute).slice(-2);
			case 'm':
				return time.minute;
			case 'ss':
				return ('0' + time.second).slice(-2);
			case 's':
				return time.second;
			case 'l':
				return ('00' + time.millisec).slice(-3);
			case 'c':
				return ('00' + time.microsec).slice(-3);
			case 'z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, false);
			case 'Z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, true);
			case 'T': 
				return ampmName.charAt(0).toUpperCase();
			case 'TT': 
				return ampmName.toUpperCase();
			case 't':
				return ampmName.charAt(0).toLowerCase();
			case 'tt':
				return ampmName.toLowerCase();
			default:
				return match.replace(/\'/g, "") || "'";
			}
		});

		tmptime = $.trim(tmptime);
		return tmptime;
	};

	/*
	* the bad hack :/ override datepicker so it doesnt close on select
	// inspired: http://stackoverflow.com/questions/1252512/jquery-datepicker-prevent-closing-picker-when-clicking-a-date/1762378#1762378
	*/
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function(id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			tp_inst._limitMinMaxDateTime(inst, true);
			inst.inline = inst.stay_open = true;
			//This way the onSelect handler called from calendarpicker get the full dateTime
			this._base_selectDate(id, dateStr);
			inst.inline = inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst);
		} else {
			this._base_selectDate(id, dateStr);
		}
	};

	/*
	* second bad hack :/ override datepicker so it triggers an event when changing the input field
	* and does not redraw the datepicker on every selectDate event
	*/
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function(inst) {

		// don't popup the datepicker if there is another instance already opened
		var input = inst.input[0];
		if ($.datepicker._curInst &amp;amp;&amp;amp; $.datepicker._curInst != inst &amp;amp;&amp;amp; $.datepicker._datepickerShowing &amp;amp;&amp;amp; $.datepicker._lastInput != input) {
			return;
		}

		if (typeof(inst.stay_open) !== 'boolean' || inst.stay_open === false) {

			this._base_updateDatepicker(inst);

			// Reload the time control when changing something in the input text field.
			var tp_inst = this._get(inst, 'timepicker');
			if (tp_inst) {
				tp_inst._addTimePicker(inst);
			}
		}
	};

	/*
	* third bad hack :/ override datepicker so it allows spaces and colon in the input field
	*/
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if ($.datepicker._get(inst, 'constrainInput')) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null? tp_inst._defaults.showTimezone : tp_inst.support.timezone,					
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat')),
					datetimeChars = tp_inst._defaults.timeFormat.toString()
											.replace(/[hms]/g, '')
											.replace(/TT/g, ampm ? 'APM' : '')
											.replace(/Tt/g, ampm ? 'AaPpMm' : '')
											.replace(/tT/g, ampm ? 'AaPpMm' : '')
											.replace(/T/g, ampm ? 'AP' : '')
											.replace(/tt/g, ampm ? 'apm' : '')
											.replace(/t/g, ampm ? 'ap' : '') + 
											" " + tp_inst._defaults.separator + 
											tp_inst._defaults.timeSuffix + 
											(tz ? tp_inst._defaults.timezoneList.join('') : '') + 
											(tp_inst._defaults.amNames.join('')) + (tp_inst._defaults.pmNames.join('')) + 
											dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr &amp;lt; ' ' || !dateChars || datetimeChars.indexOf(chr) &amp;gt; -1);
			}
		}

		return $.datepicker._base_doKeyPress(event);
	};

	/*
	* Fourth bad hack :/ override _updateAlternate function used in inline mode to init altField
	*/
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	/* Update any alternate field to synchronise with the main field. */
	$.datepicker._updateAlternate = function(inst) {
		var tp_inst = this._get(inst, 'timepicker');
		if(tp_inst){
			var altField = tp_inst._defaults.altField;
			if (altField) { // update alternate field too
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = '', 
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator, 
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if(!tp_inst._defaults.timeOnly &amp;amp;&amp;amp; !tp_inst._defaults.altFieldTimeOnly &amp;amp;&amp;amp; date !== null){
					if(tp_inst._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime;
					}
					else{
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime;
					}
				}
				$(altField).val(altFormattedDateTime);
			}
		}
		else{
			$.datepicker._base_updateAlternate(inst);
		}
	};

	/*
	* Override key up event to sync manual input changes.
	*/
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst);
				} catch (err) {
					$.timepicker.log(err);
				}
			}
		}

		return $.datepicker._base_doKeyUp(event);
	};

	/*
	* override "Today" button to also grab the time.
	*/
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function(id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		this._base_gotoToday(id);
		var tp_inst = this._get(inst, 'timepicker');
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		$('.ui-datepicker-today', $dp).click();
	};

	/*
	* Disable &amp;amp; enable the Time in the datetimepicker
	*/
	$.datepicker._disableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst);
		}
	};

	$.datepicker._enableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst); // Could be disabled on page load
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create our own set time function
	*/
	$.datepicker._setTime = function(inst, date) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var defaults = tp_inst._defaults;

			// calling _setTime with no date sets time to defaults
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;

			//check if within min/max times.. 
			tp_inst._limitMinMaxDateTime(inst, true);

			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create new public method to set only time, callable as $().datepicker('setTime', date)
	*/
	$.datepicker._setTimeDatepicker = function(target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date == "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec);
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds());
				}
				if (tp_date.toString() == 'Invalid Date') {
					tp_date = undefined;
				}
				this._setTime(inst, tp_date);
			}
		}

	};

	/*
	* override setDate() to allow setting time too within Date object
	*/
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function(target, date) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		if(typeof(date) === 'string'){
			date = new Date(date);
			if(!date.getTime()){
				$.timepicker.log("Error creating Date object from string.");
			}
		}

		var tp_inst = this._get(inst, 'timepicker');
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds());
		} else {
			tp_date = date;
		}
		
		// This is important if you are using the timezone option, javascript's Date 
		// object will only return the timezone offset for the current locale, so we 
		// adjust it accordingly.  If not using timezone option this won't matter..
		// If a timezone is different in tp, keep the timezone as is
		if(tp_inst){
			// look out for DST if tz wasn't specified
			if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
				tp_inst.timezone = tp_date.getTimezoneOffset()*-1;
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone);
		}

		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true);
	};

	/*
	* override getDate() to allow getting time too within Date object
	*/
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function(target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			// if it hasn't yet been defined, grab from field
			if(inst.lastVal === undefined){
				this._setDateFromField(inst, noDefault);
			}

			var date = this._getDate(inst);
			if (date &amp;amp;&amp;amp; tp_inst._parseTime($(target).val(), tp_inst.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);

				// This is important if you are using the timezone option, javascript's Date 
				// object will only return the timezone offset for the current locale, so we 
				// adjust it accordingly.  If not using timezone option this won't matter..
				if(tp_inst.timezone != null){
					// look out for DST if tz wasn't specified
					if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
						tp_inst.timezone = date.getTimezoneOffset()*-1;
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
				}
			}
			return date;
		}
		return this._base_getDateDatepicker(target, noDefault);
	};

	/*
	* override parseDate() because UI 1.8.14 throws an error about "Extra characters"
	* An option in datapicker to ignore extra format characters would be nicer.
	*/
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function(format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings);
		} catch (err) {
			// Hack!  The error message ends with a colon, a space, and
			// the "extra" characters.  We rely on that instead of
			// attempting to perfectly reproduce the parsing algorithm.
			if (err.indexOf(":") &amp;gt;= 0) {
				date = this._base_parseDate(format, value.substring(0,value.length-(err.length-err.indexOf(':')-2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format);
			} else {
				throw err;
			}
		}
		return date;
	};

	/*
	* override formatDate to set date with time to the input
	*/
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function(inst, day, month, year) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val();
		}
		return this._base_formatDate(inst);
	};

	/*
	* override options setter to add time to maxDate(Time) and minDate(Time). MaxDate
	*/
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function(target, name, value) {
		var inst = this._getInst(target),
	        name_clone;
		if (!inst) {
			return null;
		}

		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop;
		    if (typeof name == 'string') { // if min/max was set with the string
		        if (name === 'minDate' || name === 'minDateTime') {
		            min = value;
		        } else if (name === 'maxDate' || name === 'maxDateTime') {
		            max = value;
		        } else if (name === 'onSelect') {
		            onselect = value;
		        } else if (overrides.hasOwnProperty(name)) {
		            if (typeof (value) === 'undefined') {
		                return overrides[name];
		            }
		            fns[name] = value;
		            name_clone = {}; //empty results in exiting function after overrides updated
		        }
		    } else if (typeof name == 'object') { //if min/max was set with the JSON
		        if (name.minDate) {
		            min = name.minDate;
		        } else if (name.minDateTime) {
		            min = name.minDateTime;
		        } else if (name.maxDate) {
		            max = name.maxDate;
		        } else if (name.maxDateTime) {
		            max = name.maxDateTime;
		        }
		        for (prop in overrides) {
		            if (overrides.hasOwnProperty(prop) &amp;amp;&amp;amp; name[prop]) {
		                fns[prop] = name[prop];
		            }
		        }
		    }
		    for (prop in fns) {
		        if (fns.hasOwnProperty(prop)) {
		            overrides[prop] = fns[prop];
		            if (!name_clone) { name_clone = $.extend({}, name);}
		            delete name_clone[prop];
		        }
		    }
		    if (name_clone &amp;amp;&amp;amp; isEmptyObject(name_clone)) { return; }
		    if (min) { //if min was set
		        if (min === 0) {
		            min = new Date();
		        } else {
		            min = new Date(min);
		        }
		        tp_inst._defaults.minDate = min;
		        tp_inst._defaults.minDateTime = min;
		    } else if (max) { //if max was set
		        if (max === 0) {
		            max = new Date();
		        } else {
		            max = new Date(max);
		        }
		        tp_inst._defaults.maxDate = max;
		        tp_inst._defaults.maxDateTime = max;
		    } else if (onselect) {
		        tp_inst._defaults.onSelect = onselect;
		    }
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name);
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
	};
	
	/*
	* jQuery isEmptyObject does not check hasOwnProperty - if someone has added to the object prototype,
	* it will return false for all objects
	*/
	var isEmptyObject = function(obj) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(obj)) {
				return false;
			}
		}
		return true;
	};

	/*
	* jQuery extend now ignores nulls!
	*/
	var extendRemove = function(target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] === null || props[name] === undefined) {
				target[name] = props[name];
			}
		}
		return target;
	};

	/*
	* Determine by the time format which units are supported
	* Returns an object of booleans for each unit
	*/
	var detectSupport = function(timeFormat){
		var tf = timeFormat.replace(/\'.*?\'/g,'').toLowerCase(), // removes literals
			isIn = function(f, t){ // does the format contain the token?
					return f.indexOf(t) !== -1? true:false; 
				};
		return {
				hour: isIn(tf,'h'),
				minute: isIn(tf,'m'),
				second: isIn(tf,'s'),
				millisec: isIn(tf,'l'),
				microsec: isIn(tf,'c'),
				timezone: isIn(tf,'z'),
				ampm: isIn(tf,'t') &amp;amp;&amp;amp; isIn(timeFormat,'h'),
				iso8601: isIn(timeFormat, 'Z')
			};
	};

	/*
	* Converts 24 hour format into 12 hour
	* Returns 12 hour without leading 0
	*/
	var convert24to12 = function(hour) {
		if (hour &amp;gt; 12) {
			hour = hour - 12;
		}

		if (hour === 0) {
			hour = 12;
		}

		return String(hour);
	};

	/*
	* Splits datetime string into date ans time substrings.
	* Throws exception when date can't be parsed
	* Returns [dateString, timeString]
	*/
	var splitDateTime = function(dateFormat, dateTimeString, dateSettings, timeSettings) {
		try {
			// The idea is to get the number separator occurances in datetime and the time format requested (since time has 
			// fewer unknowns, mostly numbers and am/pm). We will use the time pattern to split.
			var separator = timeSettings &amp;amp;&amp;amp; timeSettings.separator ? timeSettings.separator : $.timepicker._defaults.separator,
				format = timeSettings &amp;amp;&amp;amp; timeSettings.timeFormat ? timeSettings.timeFormat : $.timepicker._defaults.timeFormat,
				timeParts = format.split(separator), // how many occurances of separator may be in our format?
				timePartsLen = timeParts.length,
				allParts = dateTimeString.split(separator),
				allPartsLen = allParts.length;

			if (allPartsLen &amp;gt; 1) {
				return [
						allParts.splice(0,allPartsLen-timePartsLen).join(separator),
						allParts.splice(0,timePartsLen).join(separator)
					];
			}

		} catch (err) {
			$.timepicker.log('Could not split the date from the time. Please check the following datetimepicker options' +
					"\nthrown error: " + err +
					"\ndateTimeString" + dateTimeString +
					"\ndateFormat = " + dateFormat +
					"\nseparator = " + timeSettings.separator +
					"\ntimeFormat = " + timeSettings.timeFormat);

			if (err.indexOf(":") &amp;gt;= 0) {
				// Hack!  The error message ends with a colon, a space, and
				// the "extra" characters.  We rely on that instead of
				// attempting to perfectly reproduce the parsing algorithm.
				var dateStringLength = dateTimeString.length - (err.length - err.indexOf(':') - 2),
					timeString = dateTimeString.substring(dateStringLength);

				return [$.trim(dateTimeString.substring(0, dateStringLength)), $.trim(dateTimeString.substring(dateStringLength))];

			} else {
				throw err;
			}
		}
		return [dateTimeString, ''];
	};

	/*
	* Internal function to parse datetime interval
	* Returns: {date: Date, timeObj: Object}, where
	*   date - parsed date without time (type Date)
	*   timeObj = {hour: , minute: , second: , millisec: , microsec: } - parsed time. Optional
	*/
	var parseDateTimeInternal = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var date;
		var splitRes = splitDateTime(dateFormat, dateTimeString, dateSettings, timeSettings);
		date = $.datepicker._base_parseDate(dateFormat, splitRes[0], dateSettings);
		if (splitRes[1] !== '') {
			var timeString = splitRes[1],
				parsedTime = $.datepicker.parseTime(timeFormat, timeString, timeSettings);

			if (parsedTime === null) {
				throw 'Wrong time format';
			}
			return {
				date: date,
				timeObj: parsedTime
			};
		} else {
			return {
				date: date
			};
		}
	};

	/*
	* Internal function to set timezone_select to the local timezone
	*/
	var selectLocalTimezone = function(tp_inst, date) {
		if (tp_inst &amp;amp;&amp;amp; tp_inst.timezone_select) {
			var now = typeof date !== 'undefined' ? date : new Date();
			tp_inst.timezone_select.val(now.getTimezoneOffset()*-1);
		}
	};

	/*
	* Create a Singleton Insance
	*/
	$.timepicker = new Timepicker();

	/**
	 * Get the timezone offset as string from a date object (eg '+0530' for UTC+5.5)
	 * @@param  number if not a number this value is returned
	 * @@param boolean if true formats in accordance to iso8601 "+12:45"
	 * @@return string
	 */
	$.timepicker.timezoneOffsetString = function(tzMinutes, iso8601) {
		if(isNaN(tzMinutes) || tzMinutes &amp;gt; 840){
			return tzMinutes;
		}

		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601? ':':'',
			tz = (off &amp;gt;= 0 ? '+' : '-') + ('0' + (hours * 101).toString()).slice(-2) + iso + ('0' + (minutes * 101).toString()).slice(-2);
		
		if(tz == '+00:00'){
			return 'Z';
		}
		return tz;
	};

	/**
	 * Get the number in minutes that represents a timezone string
	 * @@param  string formated like "+0500", "-1245"
	 * @@return number
	 */
	$.timepicker.timezoneOffsetNumber = function(tzString) {
		tzString = tzString.toString().replace(':',''); // excuse any iso8601, end up with "+1245"

		if(tzString.toUpperCase() === 'Z'){ // if iso8601 with Z, its 0 minute offset
			return 0;
		}

		if(!/^(\-|\+)\d{4}$/.test(tzString)){ // possibly a user defined tz, so just give it back
			return tzString;
		}

		return ((tzString.substr(0,1) =='-'? -1 : 1) * // plus or minus
					((parseInt(tzString.substr(1,2),10)*60) + // hours (converted to minutes)
					parseInt(tzString.substr(3,2),10))); // minutes
	};

	/**
	 * No way to set timezone in js Date, so we must adjust the minutes to compensate. (think setDate, getDate)
	 * @@param  date
	 * @@param  string formated like "+0500", "-1245"
	 * @@return date
	 */
	$.timepicker.timezoneAdjust = function(date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if(!isNaN(toTz)){
			date.setMinutes(date.getMinutes()*1 + (date.getTimezoneOffset()*-1 - toTz*1) );
		}
		return date;
	};

	/**
	 * Calls `timepicker()` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * n.b. The input value must be correctly formatted (reformatting is not supported)
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the timepicker() call
	 * @@return jQuery
	 */
	$.timepicker.timeRange = function(startTime, endTime, options) {
		return $.timepicker.handleRange('timepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datetimepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@return jQuery
	 */
	$.timepicker.datetimeRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datetimepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.dateRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.handleRange = function(method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0, // min allowed interval in milliseconds
			maxInterval: 0, // max allowed interval in milliseconds
			start: {},      // options for start picker
			end: {}         // options for end picker
		}, options);

		$.fn[method].call(startTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), endTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), endTime, 'minDate');
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), startTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), startTime, 'maxDate');
			}
		}, options, options.end));

		checkDates(startTime, endTime);
		selected(startTime, endTime, 'minDate');
		selected(endTime, startTime, 'maxDate');

		function checkDates(changed, other) {
			var startdt = startTime[method]('getDate'),
				enddt = endTime[method]('getDate'),
				changeddt = changed[method]('getDate');

			if(startdt !== null){
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());

				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);

				if(options.minInterval &amp;gt; 0 &amp;amp;&amp;amp; minDate &amp;gt; enddt){ // minInterval check
					endTime[method]('setDate',minDate);
				}
				else if(options.maxInterval &amp;gt; 0 &amp;amp;&amp;amp; maxDate &amp;lt; enddt){ // max interval check
					endTime[method]('setDate',maxDate);
				}
				else if (startdt &amp;gt; enddt) {
					other[method]('setDate',changeddt);
				}
			}
		}

		function selected(changed, other, option) {
			if (!changed.val()) {
				return;
			}
			var date = changed[method].call(changed, 'getDate');
			if(date !== null &amp;amp;&amp;amp; options.minInterval &amp;gt; 0){
				if(option == 'minDate'){
					date.setMilliseconds(date.getMilliseconds() + options.minInterval); 
				}
				if(option == 'maxDate'){
					date.setMilliseconds(date.getMilliseconds() - options.minInterval);
				}
			}
			if (date.getTime) {
				other[method].call(other, 'option', option, date);
			}
		}
		return $([startTime.get(0), endTime.get(0)]);
	};

	/**
	 * Log error or data to the console during error or debugging
	 * @@param  Object err pass any type object to log to the console during error or debugging
	 * @@return void
	 */
	$.timepicker.log = function(err){
		if(window.console){
			console.log(err);
		}
	};

	/*
	* Microsecond support
	*/
	if(!Date.prototype.getMicroseconds){
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function(){ return this.microseconds; };
		Date.prototype.setMicroseconds = function(m){ 
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m/1000));
			this.microseconds = m%1000;
			return this;
		};
	}

	/*
	* Keep up with the version
	*/
	$.timepicker.version = "1.3.1";

})(jQuery);
jQuery.noConflict();
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;datetimepicker-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;e73a652e-09fc-4c71-8e7a-e2525a2d2a99&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
function replaceAllString(oriStr, strTarget, strSubString ){
   var strText = oriStr;
   var intIndexOfMatch = strText.indexOf( strTarget );
   while (intIndexOfMatch != -1){
      strText = strText.replace( strTarget, strSubString )
      intIndexOfMatch = strText.indexOf( strTarget );
   }
   return( strText );
}
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&amp;amp;]" + name + "=([^&amp;amp;#]*)"),
    results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
};


   var jobName= getParameterByName('job')
   var fromDate= getParameterByName('fromDate')
   var toDate= getParameterByName('toDate')
   var limit= getParameterByName('limit')
   var selectedIstIid = getParameterByName('IstIid')

  $("#jobname").ready(function(){
   $("#jobname").text(jobName)
   var convertedJobName = replaceAllString(jobName, ".", "_")
   $("#IstIid" + convertedJobName).ready(function(){
     $("#IstIid" + convertedJobName).css("display","block")
     $("#select_" + convertedJobName).ready(function(){
        $("#select_" + convertedJobName).val(selectedIstIid)
     });
   });
 });

  $("#fromDate").ready(function(){
   $("#from-date").val(fromDate)
 });

  $("#toDate").ready(function(){
   $("#to-date").val(toDate)
 });

  $("#limit").ready(function(){
   if(limit!=""){
    $("#limit").val(limit)
   }
 });
 // Get data with ajax
 function ajax_getData(jobName,fromDate,toDate,limit ){
       var convertedJobName = replaceAllString(jobName, ".", "_")
       var istIid = $("#select_" + convertedJobName).val()
       window.location="/xwiki/bin/view/WiperDog/WebHome?job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid="+istIid;
 			/*$.ajax({
			 type: "GET",
			 url:"/xwiki/bin/get/Sandbox/DescriptionForJob?outputSyntax=plain&amp;amp;job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid"+selectedIstIid,
			 success : function(result){
				$("#jobname").html(jobName)
				$("#display").text('[[]]' + result)
			 }
		   });*/
 }
	$("#treemenu2 a").click(function(){
		 var limit = 10
		 var fromDate=""
		 var toDate = ""
		 jobName= $(this).text()
                 $("#jobname").html(jobName)
                 var convertedJobName = replaceAllString(jobName, ".", "_")
                 $("#listIstIid &amp;gt; div").css("display","none")
                 $("#IstIid" + convertedJobName).css("display","block")
		 //ajax_getData(jobName,fromDate,toDate,limit )

	});

	$("#from-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
		dateFormat: 'yy-mm-dd',
	});
	$("#to-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
			dateFormat: 'yy-mm-dd',

	});
	 $("#get-data").on("click",function(){
		var fromDate = $("#from-date").val()
		var toDate =  $("#to-date").val()
		 if( toDate!= "" ){
			  if(fromDate != ""){
				  if($("#from-date").datepicker( "getDate" ) &amp;gt; $("#to-date").datepicker( "getDate" )){
				  alert("'From date' cannot start later than 'To date'")
				  return false
				  }
			  }
		 }
		 limit = $("#limit").val()
		 ajax_getData(jobName,fromDate,toDate,limit )
	});
$(document).ready(function(){
  var keys = $("#lstkey").text()
  //console.log('key == ' + keys);
  //console.log('livetableJson ==' + $("#livetableJson").text());
  
  var jsonObj = $.parseJSON($("#livetableJson").text()); 
  if(keys &amp;amp;&amp;amp; keys != '[ ]'){
    /** Subtyped **/    
    var newKeys = keys.replace('[',"");
    keys = newKeys.replace(']',"");
    var keyArr = (keys.indexOf(',') != -1)? keys.split(','):new Array(keys);
    //console.log('Key after replace: '+keys)       
    for(var i=0;i&amp;lt;keyArr.length;i++){
        var keyName = keyArr[i].trim().replace('',"").replace("\"","").replace('\"','');
        var subTypeJsonObjStr = jsonObj[keyName].replace('#livetablePager','#livetablePager_'+keyName)
        var subTypeJsonObj = $.parseJSON(subTypeJsonObjStr);
        $("#livetableList_"+keyName).jqGrid(subTypeJsonObj);
        $("#livetableList_"+keyName).jqGrid('navGrid', "#livetablePager_"+keyName, {
           edit : false,
           add : false,
           del : false,
           search:false
         });
    }
    
  }else{ /** Store**/        
      $("#livetableList").jqGrid(jsonObj);
      $("#livetableList").jqGrid('navGrid', "#livetablePager", {
           edit : false,
           add : false,
           del : false,
           search:false
           
       });
   }
});
        
jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;process&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;881686cc-1bfc-456e-b8ab-71334c4a45e5&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){

	$(function () {
		function drawLineChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerline' + container).highcharts({

				chart: {
					type:'line'
				},
				title: {
					text: chart_name
				},
				tooltip :{
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				xAxis: dataXAxis ,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				series: dataSeries
			});
		};

		function drawBarChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerbar' + container).highcharts({
				chart: {
					type: 'column'
				},
				title: {
					text: chart_name
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {

					column: {
						pointPadding: 0.2,
						borderWidth: 0
					}
				},
				series: dataSeries
			});
		}

		function drawAreaChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail
			$('#containerarea' + container).highcharts({
				chart: {
					type: 'area'
				},
				title: {
					text: chart_name
				},
				subtitle: {
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					},
					labels: {
						formatter: function() {
							return this.value / 1000;
						}
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {
					area: {
						stacking: 'normal',
						lineColor: '#666666',
						lineWidth: 1,
						marker: {
							lineWidth: 1,
							lineColor: '#666666'
						}
					}
				},
				series: dataSeries
			});
		};

		function drawPieChart(data, container, chartName){
			var dataPie = data
			$(document).ready(function () {
				// Build the chart
				$('#container' + container).highcharts({
					chart: {
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: chartName
					},
					tooltip: {
						pointFormat: '{series.name}: &amp;lt;b&amp;gt;{point.percentage:.1f}%&amp;lt;/b&amp;gt;'
					},
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							dataLabels: {
								enabled: true,
                                                                color: '#000000',
                                                                connectorColor: '#000000',
                                                                format: '&amp;lt;b&amp;gt;{point.name}&amp;lt;/b&amp;gt;: {point.percentage:.1f} %'
							},
							showInLegend: true
						}
					},
					series: dataPie
				});
			});
		}

		// LINE
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                     if(($("#jsons&amp;gt;#jsonline_" + finalKey)).length &amp;gt; 0) {
					var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonline_" + finalKey).val());
					var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerline_" + finalKey).val());
				        var lstContainer = [];
  				        var data_all = [];
                                        var chartSize = arrayAll.length

                                        for(var i=0;i&amp;lt;chartSize ;i++){
                                           data_all = arrayAll[i]
                                           lstContainer = arrayContainerAll[i]
				           if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					        // data to display on tooltip
					        var data_detail = data_all[0]
					        // draw Line chart
				        	for(var j=0;j&amp;lt;data_all.length;j++){
				        		if(data_all[j].series[0].name == null){
				        			data_all[j].series[0].name = lstContainer[j]
					        	}
                                                        chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					        	drawLineChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					        }
				         }
                                      }
                                  }
				}
			} else {
				var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonline").val());
				var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerline").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length

                                for(var i=0;i&amp;lt;chartSize ;i++){
                                   data_all = arrayAll[i]
                                   lstContainer = arrayContainerAll[i]
				   if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Line chart
					for(var j=0;j&amp;lt;data_all.length;j++){
						if(data_all[j].series[0].name == null){
							data_all[j].series[0].name = lstContainer[j]
						}
                                                chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
						drawLineChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
				   }
                                }
			}
		});

		// BAR
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
			             var finalKey = lstKey[eKey]
                                     if(($("#jsons&amp;gt;#jsonbar_" + finalKey)).length &amp;gt; 0) {
					var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonbar_" + finalKey).val());
					var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerbar_" + finalKey).val());
					var lstContainer = [];
					var data_all = [];
                                        var chartSize = arrayAll.length
					for(var i=0;i&amp;lt;chartSize ;i++){
					    data_all = arrayAll[i]
					    lstContainer = arrayContainerAll[i]
					    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw bar chart
						for(var j=0;j&amp;lt;data_all.length;j++){
							if(data_all[j].series[0].name == null){
								data_all[j].series[0].name = lstContainer[j]
							}
                                                        chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
							drawBarChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
						}
                                            }
					}
                                    }
				}
			} else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonbar").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerbar").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
				    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Bar chart
					for(var j=0;j&amp;lt;data_all.length;j++){
                                            if(data_all[j].series[0].name == null){
						data_all[j].series[0].name = lstContainer[j]
					    }
                                            chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					    drawBarChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
                                    }
				}
			}
		});

		// AREA
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
                        var arrayAll
                        var arrayContainerAll
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                        if(($("#jsons&amp;gt;#jsonarea_" + finalKey)).length &amp;gt; 0) {
                                           arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonarea_" + finalKey).val());
                                           arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerarea_" + finalKey).val());
					   var lstContainer = [];
					   var data_all = [];
                                           var chartSize = arrayAll.length
					   for(var i=0;i&amp;lt;chartSize ;i++){
					       data_all = arrayAll[i]
					       lstContainer = arrayContainerAll[i]
					       if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						   // data to display on tooltip
						   var data_detail = data_all[0]
						   // draw Line chart
						   for(var j=0;j&amp;lt;data_all.length;j++){
						      if(data_all[j].series[0].name == null){
						         data_all[j].series[0].name = lstContainer[j]
						       }
                                                       chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
						       drawAreaChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
						   }
					      }
				           }
                                        }
			          }
                        } else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonarea").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerarea").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
				    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw area chart
					for(var j=0;j&amp;lt;data_all.length;j++){
                                            if(data_all[j].series[0].name == null){
						data_all[j].series[0].name = lstContainer[j]
					    }
                                            chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					    drawAreaChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
                                    }
				}
			}
		});

		// PIE
		$(document ).ready(function(){
                        var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
                        var arrayAll
                        var arrayContainerAll
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                        if(($("#jsons&amp;gt;#jsonpie_" + finalKey)).length &amp;gt; 0) {
                                           arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonpie_" + finalKey).val());
                                           arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerpie_" + finalKey).val());
					   var lstContainer = [];
					   var data_all = [];
                                           var chartSize = arrayAll.length
					  for(var i=0;i&amp;lt;chartSize ;i++){
					       data_all = arrayAll[i]
console.log(data_all)
					       lstContainer = arrayContainerAll[i]
					       if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						   // draw Pie chart
						   for(var j=0;j&amp;lt;data_all.length;j++){
                                                       //chartName = data_all[j].chart_name
                                                       chartName  = data_all[j].name
						       drawPieChart(data_all, finalKey + "_" + lstContainer[j], chartName)
						   }
					      }
				           }
                                        }
			          }
			} else {
				var array = $("#jsons&amp;gt;.jsonpie");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerpie");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					// draw Pie Chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						var finalData = []
						finalData[0] = data_all[0][i]
						drawPieChart(finalData, lstContainer[0][i])
					}
				}
			}
		});
	});
	jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;d5873d92-b78b-42fc-9407-46d166204b88&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;/* css for timepicker */
.ui-timepicker-div .ui-widget-header { 
margin-bottom: 8px;
 }

.ui-timepicker-div dl { text-align: left; }
.ui-timepicker-div dl dt { height: 25px; margin-bottom: -25px; }
.ui-timepicker-div dl dd { margin: 0 10px 10px 65px; }
.ui-timepicker-div td { font-size: 90%; }
.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }

.ui-timepicker-rtl{ direction: rtl; }
.ui-timepicker-rtl dl { text-align: right; }
.ui-timepicker-rtl dl dd { margin: 0 65px 10px 10px; }
#ui-datepicker-div{
 position:relative;
 width:auto;
 height:auto
}
&lt;/code&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;datetimepicker -css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;1201fb1a-e9c1-4731-8c74-2ea8c0071959&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;.displayblock {
  border:2px solid;
  -webkit-border-radius:6px;
  background:gray;
  float: left;
  width:100%;
}

.displaypie {
  border:1px solid;
  -webkit-border-radius:6px;
  background:gray;
  width: 48%;
  float: left; 
  height: 300px;
}

.subtype {
  margin-top: 50px;
  font-size: 2em;
  color: red;
}&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;content&gt;{{include document="Lib.DataToDrawChart"/}}
{{include document="Lib.MongoDBConnection"/}}
{{velocity}}
$xwiki.jsx.use('Lib.JQueryUILib')
$xwiki.ssx.use('Lib.MenuGenerator')
$xwiki.jsx.use('Lib.MenuGenerator')
$xwiki.ssx.use('Lib.JQueryUILib')
$xwiki.jsx.use('Lib.JqGridLib')
$xwiki.ssx.use('Lib.JqGridLib') 
{{/velocity}}
{{include document="Lib.MenuGenerator"/}}
{{html wiki="true" clean="false"}}
&amp;lt;div id="viewer"&amp;gt;
&amp;lt;table style="text-align:left"  &amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th &amp;gt;Job name&amp;lt;/th&amp;gt;
  &amp;lt;td colspan=3&amp;gt;&amp;lt;div id="jobname"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
{{groovy}}
import org.xwiki.context.*

def ec = services.component.getInstance(Execution.class).getContext()
def mapJobIstIid = ec.getProperty("mapJobIstIid")

println '{{html clean="false" wiki="false"}}'
println '&amp;lt;tr&amp;gt;'
println '&amp;lt;th&amp;gt;IstIid&amp;lt;/th&amp;gt;'
println '&amp;lt;td colspan=3&amp;gt;'
mapJobIstIid.each{jobEntry-&amp;gt;
  def convertedJobKey = jobEntry.key.replaceAll("\\.","_")
  println "&amp;lt;div id='listIstIid'&amp;gt;"
  println "&amp;lt;div id=IstIid${convertedJobKey} style='display:none'&amp;gt;"
  println "&amp;lt;select id=select_${convertedJobKey}&amp;gt;"
  jobEntry.value.each{
     println "&amp;lt;option value=\"$it\"&amp;gt;$it&amp;lt;/option&amp;gt;"
  }
  println "&amp;lt;/select&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
}
println '&amp;lt;/td&amp;gt;'
println '&amp;lt;/tr&amp;gt;'
println '{{/html}}'
{{/groovy}}
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data monitor from&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="from-date" id="from-date"/&amp;gt;&amp;lt;/td&amp;gt;
  &amp;lt;th&amp;gt;Data monitor to&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="to-date" id="to-date"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data records limit &amp;lt;/th&amp;gt;
  &amp;lt;td &amp;gt;
     &amp;lt;select id="limit"&amp;gt;
       &amp;lt;option value=5&amp;gt;5&amp;lt;/option&amp;gt;
       &amp;lt;option value=10&amp;gt;10&amp;lt;/option&amp;gt;
       &amp;lt;option value=15&amp;gt;15&amp;lt;/option&amp;gt;
       &amp;lt;option value=20&amp;gt;20&amp;lt;/option&amp;gt;
     &amp;lt;/select&amp;gt;
  &amp;lt;/td&amp;gt;
  &amp;lt;td colspan=3 &amp;gt;&amp;lt;input type="button" value="View Data" id="get-data" class="button"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;&amp;lt;div id="display"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
  &amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
&amp;lt;/table&amp;gt;

&amp;lt;/div&amp;gt; 
   
 &amp;lt;/body&amp;gt;

{{/html}}
{{groovy}}
import groovy.json.*
xwiki.jsx.use("Lib.Highcharts")

if(request.xpage == "plain") {
	response.setContentType('text/plain')
}

def listData = []
def job = request.get("job")
def fromDate = request.get("fromDate")
def toDate = request.get("toDate")
def limit= (request.get("limit")!=null)?request.get("limit").toInteger():10
def istIid = request.get("IstIid")

def str= "No data to retrieved !"
def result = null
if(job != "" &amp;amp;&amp;amp; job != null &amp;amp;&amp;amp; istIid != null &amp;amp;&amp;amp; istIid != ""){
	MongoDBConnection.getConnection()
	if(fromDate != "" || toDate != ""){
		result = MongoDBConnection.getDataInPeriod(job,fromDate,toDate,limit,istIid)
	} else {
		result = MongoDBConnection.getDataAllFields(job,limit,istIid)
        }
MongoDBConnection.closeConnection()
} else {
   println "{{warning}}There are no selected job or IstIid{{/warning}}"
}
def listKey = []
if( (result != null) &amp;amp;&amp;amp; (result.size() &amp;gt; 0) &amp;amp;&amp;amp; (result[0].KEYEXPR != null)&amp;amp;&amp;amp;!(result[0].KEYEXPR instanceof List )){

if(result[0].type == "Subtyped") {
    println '{{html clean="false" wiki="true"}}'
    //println '&amp;lt;body&amp;gt;'
    def dataSubtype = DataToDrawChart.getDataToDrawSubtype(result)
    dataSubtype.each {key,value -&amp;gt;
        listKey.add(key)
    }
    def jsonkey = com.mongodb.util.JSON.serialize(listKey)
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$jsonkey&amp;lt;/textarea&amp;gt;"

    dataSubtype.each {key,value -&amp;gt;
            def dataLine = []
            def dataBar = []
            def dataPie = []
            def dataArea = []
            if(DataToDrawChart.getDataToDrawLine(value) != []) {
                dataLine = DataToDrawChart.getDataToDrawLine(value)
            }
            if(DataToDrawChart.getDataToDrawBar(value) != []) {
                dataBar = DataToDrawChart.getDataToDrawBar(value)
            }
            if(DataToDrawChart.getDataToDrawPie(value) != []) {
                dataPie = DataToDrawChart.getDataToDrawPie(value)
            }
            if(DataToDrawChart.getDataToDrawArea(value) != []) {
                dataArea = DataToDrawChart.getDataToDrawArea(value)
            }

		def chartColumnsLine = []
		def chartColumnsBar = []
		def chartColumnsArea = []
		def lstName

                dataLine.each {itemDataLine -&amp;gt;
                    if(itemDataLine.size() &amp;gt; 0 ){
		        chartColumnsLine.add(itemDataLine[0].chart_columns)
	            }
                }
                dataBar.each {itemDataBar -&amp;gt;
                    if(itemDataBar.size() &amp;gt; 0 ){
		        chartColumnsBar.add(itemDataBar[0].chart_columns)
	            }
                }
                dataArea.each {itemDataArea -&amp;gt;
                    if(itemDataArea.size() &amp;gt; 0 ){
		        chartColumnsArea.add(itemDataArea[0].chart_columns)
	            }
                }
		if(dataPie.size() &amp;gt; 0 ){
			lstName = dataPie['name']
		}
		def tmpListNameContainer = []
                
		if(lstName != null) {
                        def chartNumPie = 0
                        def tmpLst
                        for(def nameContainer in lstName){
                           tmpLst = []
			   for(def nameContainerItem in nameContainer ){
                                println "nameContainerItem :" + nameContainerItem 
				nameContainerItem = chartNumPie + "_" + nameContainerItem.replaceAll("\\.", "_")
                                //nameContainerItem = nameContainerItem.replaceAll("\\.", "_")
				tmpLst.add(nameContainerItem )
		            }
                            tmpListNameContainer.add(tmpLst)
                            chartNumPie++
                         }
		}
		def jsonPie
		def jsonLine
		def jsonBar
		def jsonArea
		if(dataPie != []) {
		    jsonPie = com.mongodb.util.JSON.serialize(dataPie)
		}
		if(dataLine != []) {
		    jsonLine = com.mongodb.util.JSON.serialize(dataLine)
		}
		if(dataBar != []) {
		    jsonBar = com.mongodb.util.JSON.serialize(dataBar)
		}
		if(dataArea != []) {
		    jsonArea = com.mongodb.util.JSON.serialize(dataArea)
		}
		def jsonContainerPie
		if(tmpListNameContainer != []) {
			jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
		}
		def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
		def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
		def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

		println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
		if(jsonLine != null) {
			println "&amp;lt;textarea id=\"jsonline_$key\" &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class=\"lstcontainerline_$key\" &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
		}
		if(jsonBar != null) {
			println "&amp;lt;textarea id=\"jsonbar_$key\"&amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerbar_$key' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
		}
		if(jsonPie != null &amp;amp;&amp;amp; jsonContainerPie != null) {
			println "&amp;lt;textarea id=\"jsonpie_$key\" &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerpie_$key' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
		}
		if(jsonArea != null) {
			println "&amp;lt;textarea id=\"jsonarea_$key\" &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerarea_$key' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
		}

        println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
        println "&amp;lt;input style=\"display:none\" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;"
        println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
        println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'
        println "&amp;lt;/div&amp;gt;"
          
        def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
        def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
          
        println "&amp;lt;div style='clear:both'&amp;gt;"
            def description = value.KEYEXPR._description[0][key]
            if(description != null) {
                println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +': ' + description +'&amp;lt;/div&amp;gt;'
            } else {
                println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +'&amp;lt;/div&amp;gt;'
            }
            println "-----"
            if(jsonPie != null) {
          println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
		chartNumPie = 0
          lstName.each{chartPieLst -&amp;gt;
		chartPieLst.each {
	            def tmp = chartNumPie + "_" + it.replaceAll("\\.", "_")
		    println " &amp;lt;div class=\"displaypie\" id=\"container${key}_${tmp}\" &amp;gt;&amp;lt;/div&amp;gt;"
          	}
		chartNumPie++
	  }	
          println "&amp;lt;/div&amp;gt;"
            }
            if(jsonLine != null) {
          	def chartLineComment = false
		def chartNumLine = 0
          	chartColumnsLine.each{chartColumnsLineItem -&amp;gt;
            		if(!chartLineComment){
               			println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
               			chartLineComment = true  
            		}
		chartColumnsLineItem.each{
              		println " &amp;lt;div class=\"displayblock\" id=\"containerline${key}_${chartNumLine}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          	}
		chartNumLine ++
	    }
          println "&amp;lt;/div&amp;gt;"
            }
            println "&amp;amp;nbsp;"

            if(jsonBar != null) {
          	def chartBarComment = false
  		def chartNumBar = 0
          	chartColumnsBar.each{chartColumnsBarItem -&amp;gt;
             		if(!chartBarComment){
                		println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
                		chartBarComment = true
              		}  
			chartColumnsBarItem.each{
             			println " &amp;lt;div class=\"displayblock\" id=\"containerbar${key}_${chartNumBar}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          		}
			chartNumBar++
		}
          	println "&amp;lt;/div&amp;gt;"
            }
            println "&amp;amp;nbsp;"

            if(jsonArea != null) {
          	def chartAreaComment = false
		def chartNumArea = 0
          	chartColumnsArea.each{chartColumnsAreaItem -&amp;gt;
          		if(!chartAreaComment){
            			println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
            			chartAreaComment = true
          		}
			chartColumnsAreaItem.each{
            			println " &amp;lt;div class=\"displayblock\" id=\"containerarea${key}_${chartNumArea}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          		}
          		chartNumArea++
            	}
        	println "&amp;lt;/div&amp;gt;"
	    }
        /** Statistic data table **/
        println "&amp;lt;center&amp;gt;"        
        println "&amp;lt;div id='livetblContent_"+key+"' style='width:100%;clear:both;align:middle;margin-top:10px'&amp;gt;"   
        println "Statistics data for "+key
        println "&amp;lt;table id='livetableList_"+key+"' style='width:100%;align:center'&amp;gt;&amp;lt;/table&amp;gt;"
        println "&amp;lt;div id='livetablePager_"+key+"' style='position:relative;width:100%'&amp;gt;&amp;lt;/div&amp;gt;"
        println "&amp;lt;/div&amp;gt;"
        println "&amp;lt;/center&amp;gt;"
        println "&amp;lt;script language='javascript'&amp;gt;console.log('Create live table for "+key+"');&amp;lt;/script&amp;gt;"
    }
    //println '&amp;lt;/body&amp;gt;'
    println '{{/html}}'
} else if(result[0].type == "Store") {
	// data store
	def dataLine = DataToDrawChart.getDataToDrawLine(result)
	def dataBar = DataToDrawChart.getDataToDrawBar(result)
	def dataPie = DataToDrawChart.getDataToDrawPie(result)
	def dataArea = DataToDrawChart.getDataToDrawArea(result)
	def chartColumnsLine = []
	def chartColumnsBar = []
	def chartColumnsArea = []
	def lstName

        dataLine.each {itemDataLine -&amp;gt;
            if(itemDataLine.size() &amp;gt; 0 ){
		chartColumnsLine.add(itemDataLine[0].chart_columns)
	    }
        }

        dataBar.each {itemDataBar -&amp;gt;
            if(itemDataBar.size() &amp;gt; 0 ){
		chartColumnsBar.add(itemDataBar[0].chart_columns)
	    }
        }

        dataArea.each {itemDataArea -&amp;gt;
            if(itemDataArea.size() &amp;gt; 0 ){
		chartColumnsArea.add(itemDataArea[0].chart_columns)
	    }
        }

	if(dataPie.size() &amp;gt; 0 ){
		lstName = dataPie['name']
	}

    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
  
    def tmpListNameContainer = []
    def chartNumPie = 0
    for(def nameContainer in lstName){
       for(def nameContainerItem in nameContainer ){
           nameContainerItem = chartNumPie + "_" + nameContainerItem.replaceAll("\\.", "_")
           tmpListNameContainer .add(nameContainerItem )
       }
    }
    
    def jsonPie = com.mongodb.util.JSON.serialize(dataPie)
    def jsonLine = com.mongodb.util.JSON.serialize(dataLine)
    def jsonBar = com.mongodb.util.JSON.serialize(dataBar)
    def jsonArea = com.mongodb.util.JSON.serialize(dataArea)

    def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
    def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
    def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
    def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

    def listEmpty = com.mongodb.util.JSON.serialize([])
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$listEmpty&amp;lt;/textarea&amp;gt;" 

    println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
    println "&amp;lt;textarea class='jsonline' &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonbar' &amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonpie' &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonarea' &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"

    println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
  println "jsonpie: " + jsonPie
 println "jsonContainerPie " + jsonContainerPie 
    def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
    def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
  
    println "&amp;lt;div style='clear:both'&amp;gt;"
  
    def chartPieComment = false
    lstName.each{
        if(!chartPieComment) {
            println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
            chartPieComment = true
        }
        def tmp = it//.replaceAll("\\.", "_")
        println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    	def chartLineComment = false
	def chartNum = 0
    	chartColumnsLine.each{chartColumnsLineItem -&amp;gt;
	    	if(!chartLineComment){
	        	println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	        	chartLineComment = true  
	    	}
		chartColumnsLineItem.each{
	    		println " &amp;lt;div class=\"displayblock\" id=\"containerline${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	    	}
		chartNum++
	}	
    	println "&amp;lt;/div&amp;gt;"
    	println "&amp;amp;nbsp;"
    	def chartBarComment = false
	chartNum = 0
    	chartColumnsBar.each{chartColumnsBarItem -&amp;gt;
	        if(!chartBarComment){
	            println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	            chartBarComment = true
	        }  
		chartColumnsBarItem.each{
	    		println " &amp;lt;div class=\"displayblock\" id=\"containerbar${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  	}
		chartNum++
	}
  println "&amp;lt;/div&amp;gt;"
  println "&amp;amp;nbsp;"
  	def chartAreaComment = false
	chartNum = 0
  	chartColumnsArea.each{chartColumnsAreaItem -&amp;gt;
	  	if(!chartAreaComment){
	    		println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	    		chartAreaComment = true
	  	}
		chartColumnsAreaItem.each{
    			println " &amp;lt;div class=\"displayblock\" id=\"containerarea${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
		}
		chartNum++
  	}
  println "&amp;lt;/div&amp;gt;"
println "&amp;lt;/div&amp;gt;"

//println '&amp;lt;/body&amp;gt;'
println '{{/html}}'
}
}else{
    println 'There is no data for this job with criterias'
}
//--=============== Start build for livetable
def subTypeURLMap = [:]
def dataModel = []
def dataUrl = ""
result.find{rec-&amp;gt;				
    def subtractData = []
    
    //-- Parsing data and assign data to subtract list
    if(rec.type == "Store"){ //-- Store data type
        subtractData = rec['data']        
        subtractData.each{r2-&amp;gt;					
            if(dataModel != null &amp;amp;&amp;amp; dataModel.size() &amp;lt;=0){ 
                dataModel.add("Fetch At")
                dataModel.addAll(r2.keySet());					
            } 
        }        
        dataUrl = "/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job="+job +"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate + "&amp;amp;toDate=" + toDate + "&amp;amp;istIid="+istIid        
        //-- Building data model				
        def model = []
        def colSpec
        dataModel.each{name-&amp;gt;
            colSpec = [:]
            colSpec['name'] = name
            colSpec['index'] = name
            colSpec['width'] = "100"
            model.add(colSpec)
        }
        def dataModelStr = (new JsonBuilder(dataModel)).toPrettyString()
        def modelStr = (new JsonBuilder(model)).toPrettyString() 
        str = 
        "{\"url\":\""+dataUrl+"\",\"datatype\":\"json\","+
            "\"colNames\":"+ dataModelStr +
            ",\"colModel\":"+ modelStr +" ,\"rowList\":[10,20,30],"+
            "\"pager\":\"#livetablePager\", \"viewrecords\": true, \"sortname\": \"RECORD_SEQ\","+
            "\"sortorder\": \"asc\", \"caption\":\""+job+"\"}"
        println "{{html clean=\"false\" wiki=\"true\"}}"
        println "&amp;lt;div id='livetableJson' style = \"display:none\"&amp;gt;"
        //println "&amp;lt;div id='livetableJson'&amp;gt;"
        println str;
        println "&amp;lt;/div&amp;gt;"
        println "{{/html}}"
    }else{ //-- Subtype			
        def subData = rec['data']
        subData.each{key,value-&amp;gt;
            dataUrl = "/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job="+job +"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate + "&amp;amp;toDate=" + toDate + "&amp;amp;istIid="+istIid+"&amp;amp;subType="+key
            subtractData = value
            subtractData.each{r2-&amp;gt;					
                if(dataModel != null &amp;amp;&amp;amp; dataModel.size() &amp;lt;=0){ 
                    dataModel.add("Fetch At")
                    dataModel.addAll(r2.keySet());					
                } 			
            }
            //-- Building data model				
            def model = []
            def colSpec
            dataModel.each{name-&amp;gt;
                colSpec = [:]
                colSpec['name'] = name
                colSpec['index'] = name
                colSpec['width'] = "100"
                model.add(colSpec)
            }
            def dataModelStr = (new JsonBuilder(dataModel)).toPrettyString()
            def modelStr = (new JsonBuilder(model)).toPrettyString() 
            str = 
            "{\"url\":\""+dataUrl+"\",\"datatype\":\"json\","+
                "\"colNames\":"+ dataModelStr +
                ",\"colModel\":"+ modelStr +" ,\"rowList\":[10,20,30],"+
                "\"pager\":\"#livetablePager\", \"viewrecords\": true, \"sortname\": \"RECORD_SEQ\","+
                "\"sortorder\": \"asc\", \"caption\":\""+job+"\"}"
            subTypeURLMap[key] = str
        }
        def finalStr = (new JsonBuilder(subTypeURLMap)).toPrettyString()
        println "{{html clean=\"false\" wiki=\"true\"}}"
        println "&amp;lt;div id='livetableJson' style = \"display:none\"&amp;gt;"
        //println "&amp;lt;div id='livetableJson'&amp;gt;"
        println finalStr;
        println "&amp;lt;/div&amp;gt;"
        println "{{/html}}"
    }
    return true
}
 //--=============== END

if(listKey.size() &amp;lt;= 0){   
    println "{{html clean=\"false\" wiki=\"true\"}}"
    println "&amp;lt;center&amp;gt;"
    println "&amp;lt;div id=\"livetblContent\" style=\"width:100%;clear:both;align:middle;margin-top:10px\"&amp;gt;"   
    println "Statistics Data"
    println "&amp;lt;table id=\"livetableList\" style=\"width:100%;align:center\"&amp;gt;&amp;lt;/table&amp;gt;"    
    println "&amp;lt;div id=\"livetablePager\"&amp;gt;&amp;lt;/div&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
    println "&amp;lt;/center&amp;gt;"
    
    println "&amp;lt;div id=\"testDiv\"&amp;gt;&amp;amp;nbsp;&amp;lt;/div&amp;gt;"
    println "{{/html}}"
}
{{/groovy}}
&lt;/content&gt;&lt;/xwikidoc&gt;@


61.12
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376552705000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376552705000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.12&lt;/version&gt;
d3580 1
a3580 1
  println "jsonpie: " + jsonpie
@


61.11
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376552681000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376552681000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.11&lt;/version&gt;
d3580 1
a3580 1
  println "jsonLine : " + jsonLine 
@


61.10
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376552601000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376552601000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.10&lt;/version&gt;
d3580 2
a3581 1
  
@


61.9
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376552550000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376552550000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.9&lt;/version&gt;
d3555 1
a3555 1
  println "tmpListNameContainer " + tmpListNameContainer 
a3568 5
    println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'

@


61.8
log
@@
text
@&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xwikidoc&gt;
&lt;web&gt;WiperDog&lt;/web&gt;
&lt;name&gt;WebHome&lt;/name&gt;
&lt;language&gt;&lt;/language&gt;
&lt;defaultLanguage&gt;en&lt;/defaultLanguage&gt;
&lt;translation&gt;0&lt;/translation&gt;
&lt;parent&gt;&lt;/parent&gt;
&lt;creator&gt;XWiki.Admin&lt;/creator&gt;
&lt;author&gt;XWiki.Admin&lt;/author&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;contentAuthor&gt;XWiki.Admin&lt;/contentAuthor&gt;
&lt;creationDate&gt;1376364375000&lt;/creationDate&gt;
&lt;date&gt;1376552076000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376552076000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.8&lt;/version&gt;
&lt;title&gt;WiperDog&lt;/title&gt;
&lt;defaultTemplate&gt;&lt;/defaultTemplate&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;comment&gt;&lt;/comment&gt;
&lt;minorEdit&gt;true&lt;/minorEdit&gt;
&lt;syntaxId&gt;xwiki/2.1&lt;/syntaxId&gt;
&lt;hidden&gt;false&lt;/hidden&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;047293a8-524d-45e4-af52-cd944523d5d0&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
/*
 * jQuery timepicker addon
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 1.3.1
 * Last Modified: 07/07/2013
 *
 * Copyright 2013 Trent Richardson
 * You may use this project under MIT or GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 */

/*jslint evil: true, white: false, undef: false, nomen: false */

(function($) {

	/*
	* Lets not redefine timepicker, Prevent "Uncaught RangeError: Maximum call stack size exceeded"
	*/
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return;
	}

	/*
	* Extend jQueryUI, get it started with our version number
	*/
	$.extend($.ui, {
		timepicker: {
			version: "1.3.1"
		}
	});

	/* 
	* Timepicker manager.
	* Use the singleton instance of this class, $.timepicker, to interact with the time picker.
	* Settings for (groups of) time pickers are maintained in an instance object,
	* allowing multiple different settings on the same page.
	*/
	var Timepicker = function() {
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[''] = { // Default regional settings
			currentText: 'Now',
			closeText: 'Done',
			amNames: ['AM', 'A'],
			pmNames: ['PM', 'P'],
			timeFormat: 'HH:mm',
			timeSuffix: '',
			timeOnlyTitle: 'Choose Time',
			timeText: 'Time',
			hourText: 'Hour',
			minuteText: 'Minute',
			secondText: 'Second',
			millisecText: 'Millisecond',
			microsecText: 'Microsecond',
			timezoneText: 'Time Zone',
			isRTL: false
		};
		this._defaults = { // Global defaults for all the datetime picker instances
			showButtonPanel: true,
			timeOnly: false,
			showHour: null,
			showMinute: null,
			showSecond: null,
			showMillisec: null,
			showMicrosec: null,
			showTimezone: null,
			showTime: true,
			stepHour: 1,
			stepMinute: 1,
			stepSecond: 1,
			stepMillisec: 1,
			stepMicrosec: 1,
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null,
			hourMin: 0,
			minuteMin: 0,
			secondMin: 0,
			millisecMin: 0,
			microsecMin: 0,
			hourMax: 23,
			minuteMax: 59,
			secondMax: 59,
			millisecMax: 999,
			microsecMax: 999,
			minDateTime: null,
			maxDateTime: null,
			onSelect: null,
			hourGrid: 0,
			minuteGrid: 0,
			secondGrid: 0,
			millisecGrid: 0,
			microsecGrid: 0,
			alwaysSetTime: true,
			separator: ' ',
			altFieldTimeOnly: true,
			altTimeFormat: null,
			altSeparator: null,
			altTimeSuffix: null,
			pickerTimeFormat: null,
			pickerTimeSuffix: null,
			showTimepicker: true,
			timezoneList: null,
			addSliderAccess: false,
			sliderAccessArgs: null,
			controlType: 'slider',
			defaultValue: null,
			parse: 'strict'
		};
		$.extend(this._defaults, this.regional['']);
	};

	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: '',
		formattedDate: '',
		formattedTime: '',
		formattedDateTime: '',
		timezoneList: null,
		units: ['hour','minute','second','millisec', 'microsec'],
		support: {},
		control: null,

		/* 
		* Override the default settings for all instances of the time picker.
		* @@param  settings  object - the new settings to use as defaults (anonymous object)
		* @@return the manager object
		*/
		setDefaults: function(settings) {
			extendRemove(this._defaults, settings || {});
			return this;
		},

		/*
		* Create a new Timepicker instance
		*/
		_newInst: function($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
            	fns = {},
		    	overrides, i;

			for (var attrName in this._defaults) {
				if(this._defaults.hasOwnProperty(attrName)){
					var attrValue = $input.attr('time:' + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue);
						} catch (err) {
							inlineSettings[attrName] = attrValue;
						}
					}
				}
			}

		    overrides = {
		        beforeShow: function (input, dp_inst) {
		            if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
		                return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst);
		            }
		        },
		        onChangeMonthYear: function (year, month, dp_inst) {
		            // Update the time as well : this prevents the time from disappearing from the $input field.
		            tp_inst._updateDateTime(dp_inst);
		            if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
		                tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst);
		            }
		        },
		        onClose: function (dateText, dp_inst) {
		            if (tp_inst.timeDefined === true &amp;amp;&amp;amp; $input.val() !== '') {
		                tp_inst._updateDateTime(dp_inst);
		            }
		            if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
		                tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst);
		            }
		        }
		    };
		    for (i in overrides) {
		        if (overrides.hasOwnProperty(i)) {
		            fns[i] = opts[i] || null;
		        }
		    }

		    tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
		        evnts:fns,
		        timepicker: tp_inst // add timepicker as a property of datepicker: $.datepicker._get(dp_inst, 'timepicker');
		    });
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function(val) {
				return val.toUpperCase();
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function(val) {
				return val.toUpperCase();
			});

			// detect which units are supported
			tp_inst.support = detectSupport(
					tp_inst._defaults.timeFormat + 
					(tp_inst._defaults.pickerTimeFormat? tp_inst._defaults.pickerTimeFormat:'') + 
					(tp_inst._defaults.altTimeFormat? tp_inst._defaults.altTimeFormat:''));

			// controlType is string - key to our this._controls
			if(typeof(tp_inst._defaults.controlType) === 'string'){
				if(tp_inst._defaults.controlType == 'slider' &amp;amp;&amp;amp; typeof(jQuery.ui.slider) === 'undefined'){
					tp_inst._defaults.controlType = 'select';
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType];
			}
			// controlType is an object and must implement create, options, value methods
			else{ 
				tp_inst.control = tp_inst._defaults.controlType;
			}

			// prep the timezone options
			var timezoneList = [-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,
					0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList;
			}
			var tzl=timezoneList.length,tzi=0,tzv=null;
			if (tzl &amp;gt; 0 &amp;amp;&amp;amp; typeof timezoneList[0] !== 'object') {
				for(; tzi&amp;lt;tzl; tzi++){
					tzv = timezoneList[tzi];
					timezoneList[tzi] = { value: tzv, label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601) };
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;

			// set the default units
			tp_inst.timezone = tp_inst._defaults.timezone !== null? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) : 
							((new Date()).getTimezoneOffset()*-1);
			tp_inst.hour = tp_inst._defaults.hour &amp;lt; tp_inst._defaults.hourMin? tp_inst._defaults.hourMin : 
							tp_inst._defaults.hour &amp;gt; tp_inst._defaults.hourMax? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute &amp;lt; tp_inst._defaults.minuteMin? tp_inst._defaults.minuteMin : 
							tp_inst._defaults.minute &amp;gt; tp_inst._defaults.minuteMax? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second &amp;lt; tp_inst._defaults.secondMin? tp_inst._defaults.secondMin : 
							tp_inst._defaults.second &amp;gt; tp_inst._defaults.secondMax? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec &amp;lt; tp_inst._defaults.millisecMin? tp_inst._defaults.millisecMin : 
							tp_inst._defaults.millisec &amp;gt; tp_inst._defaults.millisecMax? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec &amp;lt; tp_inst._defaults.microsecMin? tp_inst._defaults.microsecMin : 
							tp_inst._defaults.microsec &amp;gt; tp_inst._defaults.microsecMax? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = '';
			tp_inst.$input = $input;

			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField).css({
					cursor: 'pointer'
				}).focus(function() {
					$input.trigger("focus");
				});
			}

			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date();
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date();
			}

			// datepicker needs minDate/maxDate, timepicker needs minDateTime/maxDateTime..
			if (tp_inst._defaults.minDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime());
			}
			if (tp_inst._defaults.minDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime());
			}
			if (tp_inst._defaults.maxDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime());
			}
			if (tp_inst._defaults.maxDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime());
			}
			tp_inst.$input.bind('focus', function() {
				tp_inst._onFocus();
			});

			return tp_inst;
		},

		/*
		* add our sliders to the calendar
		*/
		_addTimePicker: function(dp_inst) {
			var currDT = (this.$altInput &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly) ? this.$input.val() + ' ' + this.$altInput.val() : this.$input.val();

			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
		},

		/*
		* parse the time string from input value or _setTime
		*/
		_parseTime: function(timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0]);
			}

			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, 'dateFormat');
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false;
					}
					$.extend(this, parseRes.timeObj);
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err +
									"\ndate/time string = " + timeString +
									"\ntimeFormat = " + this._defaults.timeFormat +
									"\ndateFormat = " + dp_dateFormat);
					return false;
				}
				return true;
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false;
				}
				$.extend(this, timeObj);
				return true;
			}
		},

		/*
		* generate and inject html for timepicker into ui datepicker
		*/
		_injectTimePicker: function() {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = '',
				uitem = '',
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i=0,
				l=0;

			// Prevent displaying twice
			if ($dp.find("div.ui-timepicker-div").length === 0 &amp;amp;&amp;amp; o.showTimepicker) {
				var noDisplay = ' style="display:none;"',
					html = '&amp;lt;div class="ui-timepicker-div'+ (o.isRTL? ' ui-timepicker-rtl' : '') +'"&amp;gt;&amp;lt;dl&amp;gt;' + '&amp;lt;dt class="ui_tpicker_time_label"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;' + o.timeText + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_time"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the markup
				for(i=0,l=this.units.length; i&amp;lt;l; i++){
					litem = this.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// Added by Peter Medeiros:
					// - Figure out what the hour/minute/second max should be based on the step values.
					// - Example: if stepMinute is 15, then minMax is 45.
					max[litem] = parseInt((o[litem+'Max'] - ((o[litem+'Max'] - o[litem+'Min']) % o['step'+uitem])), 10);
					gridSize[litem] = 0;

					html += '&amp;lt;dt class="ui_tpicker_'+ litem +'_label"' + (show ? '' : noDisplay) + '&amp;gt;' + o[litem +'Text'] + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_'+ litem +'"&amp;gt;&amp;lt;div class="ui_tpicker_'+ litem +'_slider"' + (show ? '' : noDisplay) + '&amp;gt;&amp;lt;/div&amp;gt;';

					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						html += '&amp;lt;div style="padding-left: 1px"&amp;gt;&amp;lt;table class="ui-tpicker-grid-label"&amp;gt;&amp;lt;tr&amp;gt;';

						if(litem == 'hour'){
							for (var h = o[litem+'Min']; h &amp;lt;= max[litem]; h += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm? 'hht':'HH', {hour:h}, o);									
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + tmph + '&amp;lt;/td&amp;gt;';
							}
						}
						else{
							for (var m = o[litem+'Min']; m &amp;lt;= max[litem]; m += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + ((m &amp;lt; 10) ? '0' : '') + m + '&amp;lt;/td&amp;gt;';
							}
						}

						html += '&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;&amp;lt;/div&amp;gt;';
					}
					html += '&amp;lt;/dd&amp;gt;';
				}
				
				// Timezone
				var showTz = o.showTimezone !== null? o.showTimezone : this.support.timezone;
				html += '&amp;lt;dt class="ui_tpicker_timezone_label"' + (showTz ? '' : noDisplay) + '&amp;gt;' + o.timezoneText + '&amp;lt;/dt&amp;gt;';
				html += '&amp;lt;dd class="ui_tpicker_timezone" ' + (showTz ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the elements from string
				html += '&amp;lt;/dl&amp;gt;&amp;lt;/div&amp;gt;';
				var $tp = $(html);

				// if we only want time picker...
				if (o.timeOnly === true) {
					$tp.prepend('&amp;lt;div class="ui-widget-header ui-helper-clearfix ui-corner-all"&amp;gt;' + '&amp;lt;div class="ui-datepicker-title"&amp;gt;' + o.timeOnlyTitle + '&amp;lt;/div&amp;gt;' + '&amp;lt;/div&amp;gt;');
					$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();
				}
				
				// add sliders, adjust grids, add events
				for(i=0,l=tp_inst.units.length; i&amp;lt;l; i++){
					litem = tp_inst.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// add the slider
					tp_inst[litem+'_slider'] = tp_inst.control.create(tp_inst, $tp.find('.ui_tpicker_'+litem+'_slider'), litem, tp_inst[litem], o[litem+'Min'], max[litem], o['step'+uitem]);

					// adjust the grid and add click event
					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						size = 100 * gridSize[litem] * o[litem+'Grid'] / (max[litem] - o[litem+'Min']);
						$tp.find('.ui_tpicker_'+litem+' table').css({
							width: size + "%",
							marginLeft: o.isRTL? '0' : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL? ((size / (-2 * gridSize[litem])) + "%") : '0',
							borderCollapse: 'collapse'
						}).find("td").click(function(e){
								var $t = $(this),
									h = $t.html(),
									n = parseInt(h.replace(/[^0-9]/g),10),
									ap = h.replace(/[^apm]/ig),
									f = $t.data('for'); // loses scope, so we use data-for

								if(f == 'hour'){
									if(ap.indexOf('p') !== -1 &amp;amp;&amp;amp; n &amp;lt; 12){
										n += 12;
									}
									else{
										if(ap.indexOf('a') !== -1 &amp;amp;&amp;amp; n === 12){
											n = 0;
										}
									}
								}
								
								tp_inst.control.value(tp_inst, tp_inst[f+'_slider'], litem, n);

								tp_inst._onTimeChange();
								tp_inst._onSelectHandler();
							}).css({
								cursor: 'pointer',
								width: (100 / gridSize[litem]) + '%',
								textAlign: 'center',
								overflow: 'hidden'
							});
					} // end if grid &amp;gt; 0
				} // end for loop

				// Add timezone options
				this.timezone_select = $tp.find('.ui_tpicker_timezone').append('&amp;lt;select&amp;gt;&amp;lt;/select&amp;gt;').find("select");
				$.fn.append.apply(this.timezone_select,
				$.map(o.timezoneList, function(val, idx) {
					return $("&amp;lt;option /&amp;gt;").val(typeof val == "object" ? val.value : val).text(typeof val == "object" ? val.label : val);
				}));
				if (typeof(this.timezone) != "undefined" &amp;amp;&amp;amp; this.timezone !== null &amp;amp;&amp;amp; this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset()*-1;
					if (local_timezone == this.timezone) {
						selectLocalTimezone(tp_inst);
					} else {
						this.timezone_select.val(this.timezone);
					}
				} else {
					if (typeof(this.hour) != "undefined" &amp;amp;&amp;amp; this.hour !== null &amp;amp;&amp;amp; this.hour !== "") {
						this.timezone_select.val(o.timezone);
					} else {
						selectLocalTimezone(tp_inst);
					}
				}
				this.timezone_select.change(function() {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
				});
				// End timezone options
				
				// inject timepicker into datepicker
				var $buttonPanel = $dp.find('.ui-datepicker-buttonpane');
				if ($buttonPanel.length) {
					$buttonPanel.before($tp);
				} else {
					$dp.append($tp);
				}

				this.$timeObj = $tp.find('.ui_tpicker_time');

				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined;
				}

				// slideAccess integration: http://trentrichardson.com/2011/11/11/jquery-ui-sliders-and-touch-accessibility/
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
						
					setTimeout(function() { // fix for inline mode
						if ($tp.find('.ui-slider-access').length === 0) {
							$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);

							// fix any grids since sliders are shorter
							var sliderAccessWidth = $tp.find('.ui-slider-access:eq(0)').outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find('table:visible').each(function() {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl? 'marginRight':'marginLeft').toString().replace('%', ''),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + '%',
										css = { width: newWidth, marginRight: 0, marginLeft: 0 };
									css[rtl? 'marginRight':'marginLeft'] = newMarginLeft;
									$g.css(css);
								});
							}
						}
					}, 10);
				}
				// end slideAccess integration

				tp_inst._limitMinMaxDateTime(this.inst, true);
			}
		},

		/*
		* This function tries to limit the ability to go outside the
		* min/max date range
		*/
		_limitMinMaxDateTime: function(dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);

			if (!this._defaults.showTimepicker) {
				return;
			} // No time so nothing to check here

			if ($.datepicker._get(dp_inst, 'minDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'minDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, 'minDateTime'),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin;
				}

				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour &amp;lt;= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute &amp;lt;= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second &amp;lt;= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if(this.millisec &amp;lt;= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;lt; this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin;
									}
									this._defaults.microsecMin = this.microsecMinOriginal;
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal;
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal;
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal;
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal;
				}
			}

			if ($.datepicker._get(dp_inst, 'maxDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'maxDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, 'maxDateTime'),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax;
				}

				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour &amp;gt;= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute &amp;gt;= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second &amp;gt;= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec &amp;gt;= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;gt; this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax;
									}
									this._defaults.microsecMax = this.microsecMaxOriginal;
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal;
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal;
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal;
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal;
				}
			}

			if (adjustSliders !== undefined &amp;amp;&amp;amp; adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10);
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);

				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, 'hour', { min: this._defaults.hourMin, max: hourMax });
					this.control.value(this, this.hour_slider, 'hour', this.hour - (this.hour % this._defaults.stepHour));
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, 'minute', { min: this._defaults.minuteMin, max: minMax });
					this.control.value(this, this.minute_slider, 'minute', this.minute - (this.minute % this._defaults.stepMinute));
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, 'second', { min: this._defaults.secondMin, max: secMax });
					this.control.value(this, this.second_slider, 'second', this.second - (this.second % this._defaults.stepSecond));
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, 'millisec', { min: this._defaults.millisecMin, max: millisecMax });
					this.control.value(this, this.millisec_slider, 'millisec', this.millisec - (this.millisec % this._defaults.stepMillisec));
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, 'microsec', { min: this._defaults.microsecMin, max: microsecMax });
					this.control.value(this, this.microsec_slider, 'microsec', this.microsec - (this.microsec % this._defaults.stepMicrosec));
				}
			}

		},

		/*
		* when a slider moves, set the internal time...
		* on time change is also called when the time is updated in the text field
		*/
		_onTimeChange: function() {
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, 'hour') : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, 'minute') : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, 'second') : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, 'millisec') : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, 'microsec') : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;

			if (typeof(hour) == 'object') {
				hour = false;
			}
			if (typeof(minute) == 'object') {
				minute = false;
			}
			if (typeof(second) == 'object') {
				second = false;
			}
			if (typeof(millisec) == 'object') {
				millisec = false;
			}
			if (typeof(microsec) == 'object') {
				microsec = false;
			}
			if (typeof(timezone) == 'object') {
				timezone = false;
			}

			if (hour !== false) {
				hour = parseInt(hour, 10);
			}
			if (minute !== false) {
				minute = parseInt(minute, 10);
			}
			if (second !== false) {
				second = parseInt(second, 10);
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10);
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10);
			}

			var ampm = o[hour &amp;lt; 12 ? 'amNames' : 'pmNames'][0];

			// If the update was done in the input field, the input field should not be updated.
			// If the update was done using the sliders, update the input field.
			var hasChanged = (hour != this.hour || minute != this.minute || second != this.second || millisec != this.millisec || microsec != this.microsec 
								|| (this.ampm.length &amp;gt; 0 &amp;amp;&amp;amp; (hour &amp;lt; 12) != ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) 
								|| (this.timezone !== null &amp;amp;&amp;amp; timezone != this.timezone));

			if (hasChanged) {

				if (hour !== false) {
					this.hour = hour;
				}
				if (minute !== false) {
					this.minute = minute;
				}
				if (second !== false) {
					this.second = second;
				}
				if (millisec !== false) {
					this.millisec = millisec;
				}
				if (microsec !== false) {
					this.microsec = microsec;
				}
				if (timezone !== false) {
					this.timezone = timezone;
				}

				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0]);
				}

				this._limitMinMaxDateTime(this.inst, true);
			}
			if (this.support.ampm) {
				this.ampm = ampm;
			}

			// Updates the time within the timepicker
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if(pickerTimeFormat === o.timeFormat){
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix);
				}
				else{
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix);
				}
			}

			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime();
			}
		},

		/*
		* call custom onSelect.
		* bind to sliders slidestop, and grid click.
		*/
		_onSelectHandler: function() {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect &amp;amp;&amp;amp; inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this]);
			}
		},

		/*
		* update our input with the new date time..
		*/
		_updateDateTime: function(dp_inst) {
			dp_inst = this.inst || dp_inst;
			//var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
			var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay)),
				dateFmt = $.datepicker._get(dp_inst, 'dateFormat'),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null &amp;amp;&amp;amp; this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			
			// if a slider was changed but datepicker doesn't have a value yet, set it
			if(dp_inst.lastVal===""){
                dp_inst.currentYear=dp_inst.selectedYear;
                dp_inst.currentMonth=dp_inst.selectedMonth;
                dp_inst.currentDay=dp_inst.selectedDay;
            }

			/*
			* remove following lines to force every changes in date picker to change the input value
			* Bug descriptions: when an input field has a default value, and click on the field to pop up the date picker. 
			* If the user manually empty the value in the input field, the date picker will never change selected value.
			*/
			//if (dp_inst.lastVal !== undefined &amp;amp;&amp;amp; (dp_inst.lastVal.length &amp;gt; 0 &amp;amp;&amp;amp; this.$input.val().length === 0)) {
			//	return;
			//}

			if (this._defaults.timeOnly === true) {
				formattedDateTime = this.formattedTime;
			} else if (this._defaults.timeOnly !== true &amp;amp;&amp;amp; (this._defaults.alwaysSetTime || timeAvailable)) {
				formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix;
			}

			this.formattedDateTime = formattedDateTime;

			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate);
			} else if (this.$altInput &amp;amp;&amp;amp; this._defaults.timeOnly === false &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly === true) {
				this.$altInput.val(this.formattedTime);
				this.$input.val(this.formattedDate);
			} else if (this.$altInput) {
				this.$input.val(formattedDateTime);
				var altFormattedDateTime = '',
					altSeparator = this._defaults.altSeparator ? this._defaults.altSeparator : this._defaults.separator,
					altTimeSuffix = this._defaults.altTimeSuffix ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
				
				if(!this._defaults.timeOnly){
					if (this._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg);
					}
					else{
						altFormattedDateTime = this.formattedDate;
					}

					if (altFormattedDateTime){
						altFormattedDateTime += altSeparator;
					}
				}

				if(this._defaults.altTimeFormat){
					altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix;
				}
				else{
					altFormattedDateTime += this.formattedTime + altTimeSuffix;
				}
				this.$altInput.val(altFormattedDateTime);
			} else {
				this.$input.val(formattedDateTime);
			}

			this.$input.trigger("change");
		},

		_onFocus: function() {
			if (!this.$input.val() &amp;amp;&amp;amp; this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, 'timepicker');
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst);
						} catch (err) {
							$.timepicker.log(err);
						}
					}
				}
			}
		},

		/*
		* Small abstraction to control types
		* We can add more, just be sure to follow the pattern: create, options, value
		*/
		_controls: {
			// slider methods
			slider: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var rtl = tp_inst._defaults.isRTL; // if rtl go -60-&amp;gt;0 instead of 0-&amp;gt;60
					return obj.prop('slide', null).slider({
						orientation: "horizontal",
						value: rtl? val*-1 : val,
						min: rtl? max*-1 : min,
						max: rtl? min*-1 : max,
						step: step,
						slide: function(event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl? ui.value*-1:ui.value);
							tp_inst._onTimeChange();
						},
						stop: function(event, ui) {
							tp_inst._onSelectHandler();
						}
					});	
				},
				options: function(tp_inst, obj, unit, opts, val){
					if(tp_inst._defaults.isRTL){
						if(typeof(opts) == 'string'){
							if(opts == 'min' || opts == 'max'){
								if(val !== undefined){
									return obj.slider(opts, val*-1);
								}
								return Math.abs(obj.slider(opts));
							}
							return obj.slider(opts);
						}
						var min = opts.min, 
							max = opts.max;
						opts.min = opts.max = null;
						if(min !== undefined){
							opts.max = min * -1;
						}
						if(max !== undefined){
							opts.min = max * -1;
						}
						return obj.slider(opts);
					}
					if(typeof(opts) == 'string' &amp;amp;&amp;amp; val !== undefined){
							return obj.slider(opts, val);
					}
					return obj.slider(opts);
				},
				value: function(tp_inst, obj, unit, val){
					if(tp_inst._defaults.isRTL){
						if(val !== undefined){
							return obj.slider('value', val*-1);
						}
						return Math.abs(obj.slider('value'));
					}
					if(val !== undefined){
						return obj.slider('value', val);
					}
					return obj.slider('value');
				}
			},
			// select methods
			select: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var sel = '&amp;lt;select class="ui-timepicker-select" data-unit="'+ unit +'" data-min="'+ min +'" data-max="'+ max +'" data-step="'+ step +'"&amp;gt;',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;

					for(var i=min; i&amp;lt;=max; i+=step){						
						sel += '&amp;lt;option value="'+ i +'"'+ (i==val? ' selected':'') +'&amp;gt;';
						if(unit == 'hour'){
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig,'')), {hour:i}, tp_inst._defaults);
						}
						else if(unit == 'millisec' || unit == 'microsec' || i &amp;gt;= 10){ sel += i; }
						else {sel += '0'+ i.toString(); }
						sel += '&amp;lt;/option&amp;gt;';
					}
					sel += '&amp;lt;/select&amp;gt;';

					obj.children('select').remove();

					$(sel).appendTo(obj).change(function(e){
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
					});

					return obj;
				},
				options: function(tp_inst, obj, unit, opts, val){
					var o = {},
						$t = obj.children('select');
					if(typeof(opts) == 'string'){
						if(val === undefined){
							return $t.data(opts);
						}
						o[opts] = val;	
					}
					else{ o = opts; }
					return tp_inst.control.create(tp_inst, obj, $t.data('unit'), $t.val(), o.min || $t.data('min'), o.max || $t.data('max'), o.step || $t.data('step'));
				},
				value: function(tp_inst, obj, unit, val){
					var $t = obj.children('select');
					if(val !== undefined){
						return $t.val(val);
					}
					return $t.val();
				}
			}
		} // end _controls

	});

	$.fn.extend({
		/*
		* shorthand just to use timepicker..
		*/
		timepicker: function(o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);

			if (typeof o == 'object') {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				});
			}

			return $(this).each(function() {
				$.fn.datetimepicker.apply($(this), tmp_args);
			});
		},

		/*
		* extend timepicker to datepicker
		*/
		datetimepicker: function(o) {
			o = o || {};
			var tmp_args = arguments;

			if (typeof(o) == 'string') {
				if (o == 'getDate') {
					return $.fn.datepicker.apply($(this[0]), tmp_args);
				} else {
					return this.each(function() {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args);
					});
				}
			} else {
				return this.each(function() {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults);
				});
			}
		}
	});

	/*
	* Public Utility to parse date and time
	*/
	$.datepicker.parseDateTime = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec);
		}

		return parseRes.date;
	};

	/*
	* Public utility to parse time
	*/
	$.datepicker.parseTime = function(timeFormat, timeString, options) {		
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g,'').indexOf('Z') !== -1);

		// Strict parse requires the timeString to match the timeFormat exactly
		var strictParse = function(f, s, o){

			// pattern for standard and localized AM/PM markers
			var getPatternAmpm = function(amNames, pmNames) {
				var markers = [];
				if (amNames) {
					$.merge(markers, amNames);
				}
				if (pmNames) {
					$.merge(markers, pmNames);
				}
				markers = $.map(markers, function(val) {
					return val.replace(/[.*+?|()\[\]{}\\]/g, '\\$&amp;amp;');
				});
				return '(' + markers.join('|') + ')?';
			};

			// figure out position of time elements.. cause js cant do named captures
			var getFormatPositions = function(timeFormat) {
				var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
					orders = {
						h: -1,
						m: -1,
						s: -1,
						l: -1,
						c: -1,
						t: -1,
						z: -1
					};

				if (finds) {
					for (var i = 0; i &amp;lt; finds.length; i++) {
						if (orders[finds[i].toString().charAt(0)] == -1) {
							orders[finds[i].toString().charAt(0)] = i + 1;
						}
					}
				}
				return orders;
			};

			var regstr = '^' + f.toString()
					.replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
							var ml = match.length;
							switch (match.charAt(0).toLowerCase()) {
								case 'h': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'm': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 's': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'l': return '(\\d?\\d?\\d)';
								case 'c': return '(\\d?\\d?\\d)';
								case 'z': return '(z|[-+]\\d\\d:?\\d\\d|\\S+)?';
								case 't': return getPatternAmpm(o.amNames, o.pmNames);
								default:    // literal escaped in quotes
									return '(' + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function (m) { return "\\" + m; }) + ')?';
							}
						})
					.replace(/\s/g, '\\s?') +
					o.timeSuffix + '$',
				order = getFormatPositions(f),
				ampm = '',
				treg;

			treg = s.match(new RegExp(regstr, 'i'));

			var resTime = {
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0
			};

			if (treg) {
				if (order.t !== -1) {
					if (treg[order.t] === undefined || treg[order.t].length === 0) {
						ampm = '';
						resTime.ampm = '';
					} else {
						ampm = $.inArray(treg[order.t].toUpperCase(), o.amNames) !== -1 ? 'AM' : 'PM';
						resTime.ampm = o[ampm == 'AM' ? 'amNames' : 'pmNames'][0];
					}
				}

				if (order.h !== -1) {
					if (ampm == 'AM' &amp;amp;&amp;amp; treg[order.h] == '12') {
						resTime.hour = 0; // 12am = 0 hour
					} else {
						if (ampm == 'PM' &amp;amp;&amp;amp; treg[order.h] != '12') {
							resTime.hour = parseInt(treg[order.h], 10) + 12; // 12pm = 12 hour, any other pm = hour + 12
						} else {
							resTime.hour = Number(treg[order.h]);
						}
					}
				}

				if (order.m !== -1) {
					resTime.minute = Number(treg[order.m]);
				}
				if (order.s !== -1) {
					resTime.second = Number(treg[order.s]);
				}
				if (order.l !== -1) {
					resTime.millisec = Number(treg[order.l]);
				}
				if (order.c !== -1) {
					resTime.microsec = Number(treg[order.c]);
				}
				if (order.z !== -1 &amp;amp;&amp;amp; treg[order.z] !== undefined) {
					resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z]);
				}


				return resTime;
			}
			return false;
		};// end strictParse

		// First try JS Date, if that fails, use strictParse
		var looseParse = function(f,s,o){
			try{
				var d = new Date('2012-01-01 '+ s);
				if(isNaN(d.getTime())){
					d = new Date('2012-01-01T'+ s);
					if(isNaN(d.getTime())){
						d = new Date('01/01/2012 '+ s);
						if(isNaN(d.getTime())){
							throw "Unable to parse time with native Date: "+ s;
						}
					}
				}

				return {
					hour: d.getHours(),
					minute: d.getMinutes(),
					second: d.getSeconds(),
					millisec: d.getMilliseconds(),
					microsec: d.getMicroseconds(),
					timezone: d.getTimezoneOffset()*-1
				};
			}
			catch(err){
				try{
					return strictParse(f,s,o);
				}
				catch(err2){
					$.timepicker.log("Unable to parse \ntimeString: "+ s +"\ntimeFormat: "+ f);
				}				
			}
			return false;
		}; // end looseParse
		
		if(typeof o.parse === "function"){
			return o.parse(timeFormat, timeString, o);
		}
		if(o.parse === 'loose'){
			return looseParse(timeFormat, timeString, o);
		}
		return strictParse(timeFormat, timeString, o);
	};

	/*
	* Public utility to format the time
	* format = string format of the time
	* time = a {}, not a Date() for timezones
	* options = essentially the regional[].. amNames, pmNames, ampm
	*/
	$.datepicker.formatTime = function(format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			timezone: 0
		}, time);

		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);

		if (hour &amp;gt; 11) {
			ampmName = options.pmNames[0];
		}

		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|('.*?'|".*?"))/g, function(match) {
		switch (match) {
			case 'HH':
				return ('0' + hour).slice(-2);
			case 'H':
				return hour;
			case 'hh':
				return ('0' + convert24to12(hour)).slice(-2);
			case 'h':
				return convert24to12(hour);
			case 'mm':
				return ('0' + time.minute).slice(-2);
			case 'm':
				return time.minute;
			case 'ss':
				return ('0' + time.second).slice(-2);
			case 's':
				return time.second;
			case 'l':
				return ('00' + time.millisec).slice(-3);
			case 'c':
				return ('00' + time.microsec).slice(-3);
			case 'z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, false);
			case 'Z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, true);
			case 'T': 
				return ampmName.charAt(0).toUpperCase();
			case 'TT': 
				return ampmName.toUpperCase();
			case 't':
				return ampmName.charAt(0).toLowerCase();
			case 'tt':
				return ampmName.toLowerCase();
			default:
				return match.replace(/\'/g, "") || "'";
			}
		});

		tmptime = $.trim(tmptime);
		return tmptime;
	};

	/*
	* the bad hack :/ override datepicker so it doesnt close on select
	// inspired: http://stackoverflow.com/questions/1252512/jquery-datepicker-prevent-closing-picker-when-clicking-a-date/1762378#1762378
	*/
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function(id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			tp_inst._limitMinMaxDateTime(inst, true);
			inst.inline = inst.stay_open = true;
			//This way the onSelect handler called from calendarpicker get the full dateTime
			this._base_selectDate(id, dateStr);
			inst.inline = inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst);
		} else {
			this._base_selectDate(id, dateStr);
		}
	};

	/*
	* second bad hack :/ override datepicker so it triggers an event when changing the input field
	* and does not redraw the datepicker on every selectDate event
	*/
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function(inst) {

		// don't popup the datepicker if there is another instance already opened
		var input = inst.input[0];
		if ($.datepicker._curInst &amp;amp;&amp;amp; $.datepicker._curInst != inst &amp;amp;&amp;amp; $.datepicker._datepickerShowing &amp;amp;&amp;amp; $.datepicker._lastInput != input) {
			return;
		}

		if (typeof(inst.stay_open) !== 'boolean' || inst.stay_open === false) {

			this._base_updateDatepicker(inst);

			// Reload the time control when changing something in the input text field.
			var tp_inst = this._get(inst, 'timepicker');
			if (tp_inst) {
				tp_inst._addTimePicker(inst);
			}
		}
	};

	/*
	* third bad hack :/ override datepicker so it allows spaces and colon in the input field
	*/
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if ($.datepicker._get(inst, 'constrainInput')) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null? tp_inst._defaults.showTimezone : tp_inst.support.timezone,					
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat')),
					datetimeChars = tp_inst._defaults.timeFormat.toString()
											.replace(/[hms]/g, '')
											.replace(/TT/g, ampm ? 'APM' : '')
											.replace(/Tt/g, ampm ? 'AaPpMm' : '')
											.replace(/tT/g, ampm ? 'AaPpMm' : '')
											.replace(/T/g, ampm ? 'AP' : '')
											.replace(/tt/g, ampm ? 'apm' : '')
											.replace(/t/g, ampm ? 'ap' : '') + 
											" " + tp_inst._defaults.separator + 
											tp_inst._defaults.timeSuffix + 
											(tz ? tp_inst._defaults.timezoneList.join('') : '') + 
											(tp_inst._defaults.amNames.join('')) + (tp_inst._defaults.pmNames.join('')) + 
											dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr &amp;lt; ' ' || !dateChars || datetimeChars.indexOf(chr) &amp;gt; -1);
			}
		}

		return $.datepicker._base_doKeyPress(event);
	};

	/*
	* Fourth bad hack :/ override _updateAlternate function used in inline mode to init altField
	*/
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	/* Update any alternate field to synchronise with the main field. */
	$.datepicker._updateAlternate = function(inst) {
		var tp_inst = this._get(inst, 'timepicker');
		if(tp_inst){
			var altField = tp_inst._defaults.altField;
			if (altField) { // update alternate field too
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = '', 
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator, 
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if(!tp_inst._defaults.timeOnly &amp;amp;&amp;amp; !tp_inst._defaults.altFieldTimeOnly &amp;amp;&amp;amp; date !== null){
					if(tp_inst._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime;
					}
					else{
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime;
					}
				}
				$(altField).val(altFormattedDateTime);
			}
		}
		else{
			$.datepicker._base_updateAlternate(inst);
		}
	};

	/*
	* Override key up event to sync manual input changes.
	*/
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst);
				} catch (err) {
					$.timepicker.log(err);
				}
			}
		}

		return $.datepicker._base_doKeyUp(event);
	};

	/*
	* override "Today" button to also grab the time.
	*/
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function(id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		this._base_gotoToday(id);
		var tp_inst = this._get(inst, 'timepicker');
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		$('.ui-datepicker-today', $dp).click();
	};

	/*
	* Disable &amp;amp; enable the Time in the datetimepicker
	*/
	$.datepicker._disableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst);
		}
	};

	$.datepicker._enableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst); // Could be disabled on page load
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create our own set time function
	*/
	$.datepicker._setTime = function(inst, date) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var defaults = tp_inst._defaults;

			// calling _setTime with no date sets time to defaults
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;

			//check if within min/max times.. 
			tp_inst._limitMinMaxDateTime(inst, true);

			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create new public method to set only time, callable as $().datepicker('setTime', date)
	*/
	$.datepicker._setTimeDatepicker = function(target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date == "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec);
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds());
				}
				if (tp_date.toString() == 'Invalid Date') {
					tp_date = undefined;
				}
				this._setTime(inst, tp_date);
			}
		}

	};

	/*
	* override setDate() to allow setting time too within Date object
	*/
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function(target, date) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		if(typeof(date) === 'string'){
			date = new Date(date);
			if(!date.getTime()){
				$.timepicker.log("Error creating Date object from string.");
			}
		}

		var tp_inst = this._get(inst, 'timepicker');
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds());
		} else {
			tp_date = date;
		}
		
		// This is important if you are using the timezone option, javascript's Date 
		// object will only return the timezone offset for the current locale, so we 
		// adjust it accordingly.  If not using timezone option this won't matter..
		// If a timezone is different in tp, keep the timezone as is
		if(tp_inst){
			// look out for DST if tz wasn't specified
			if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
				tp_inst.timezone = tp_date.getTimezoneOffset()*-1;
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone);
		}

		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true);
	};

	/*
	* override getDate() to allow getting time too within Date object
	*/
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function(target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			// if it hasn't yet been defined, grab from field
			if(inst.lastVal === undefined){
				this._setDateFromField(inst, noDefault);
			}

			var date = this._getDate(inst);
			if (date &amp;amp;&amp;amp; tp_inst._parseTime($(target).val(), tp_inst.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);

				// This is important if you are using the timezone option, javascript's Date 
				// object will only return the timezone offset for the current locale, so we 
				// adjust it accordingly.  If not using timezone option this won't matter..
				if(tp_inst.timezone != null){
					// look out for DST if tz wasn't specified
					if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
						tp_inst.timezone = date.getTimezoneOffset()*-1;
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
				}
			}
			return date;
		}
		return this._base_getDateDatepicker(target, noDefault);
	};

	/*
	* override parseDate() because UI 1.8.14 throws an error about "Extra characters"
	* An option in datapicker to ignore extra format characters would be nicer.
	*/
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function(format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings);
		} catch (err) {
			// Hack!  The error message ends with a colon, a space, and
			// the "extra" characters.  We rely on that instead of
			// attempting to perfectly reproduce the parsing algorithm.
			if (err.indexOf(":") &amp;gt;= 0) {
				date = this._base_parseDate(format, value.substring(0,value.length-(err.length-err.indexOf(':')-2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format);
			} else {
				throw err;
			}
		}
		return date;
	};

	/*
	* override formatDate to set date with time to the input
	*/
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function(inst, day, month, year) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val();
		}
		return this._base_formatDate(inst);
	};

	/*
	* override options setter to add time to maxDate(Time) and minDate(Time). MaxDate
	*/
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function(target, name, value) {
		var inst = this._getInst(target),
	        name_clone;
		if (!inst) {
			return null;
		}

		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop;
		    if (typeof name == 'string') { // if min/max was set with the string
		        if (name === 'minDate' || name === 'minDateTime') {
		            min = value;
		        } else if (name === 'maxDate' || name === 'maxDateTime') {
		            max = value;
		        } else if (name === 'onSelect') {
		            onselect = value;
		        } else if (overrides.hasOwnProperty(name)) {
		            if (typeof (value) === 'undefined') {
		                return overrides[name];
		            }
		            fns[name] = value;
		            name_clone = {}; //empty results in exiting function after overrides updated
		        }
		    } else if (typeof name == 'object') { //if min/max was set with the JSON
		        if (name.minDate) {
		            min = name.minDate;
		        } else if (name.minDateTime) {
		            min = name.minDateTime;
		        } else if (name.maxDate) {
		            max = name.maxDate;
		        } else if (name.maxDateTime) {
		            max = name.maxDateTime;
		        }
		        for (prop in overrides) {
		            if (overrides.hasOwnProperty(prop) &amp;amp;&amp;amp; name[prop]) {
		                fns[prop] = name[prop];
		            }
		        }
		    }
		    for (prop in fns) {
		        if (fns.hasOwnProperty(prop)) {
		            overrides[prop] = fns[prop];
		            if (!name_clone) { name_clone = $.extend({}, name);}
		            delete name_clone[prop];
		        }
		    }
		    if (name_clone &amp;amp;&amp;amp; isEmptyObject(name_clone)) { return; }
		    if (min) { //if min was set
		        if (min === 0) {
		            min = new Date();
		        } else {
		            min = new Date(min);
		        }
		        tp_inst._defaults.minDate = min;
		        tp_inst._defaults.minDateTime = min;
		    } else if (max) { //if max was set
		        if (max === 0) {
		            max = new Date();
		        } else {
		            max = new Date(max);
		        }
		        tp_inst._defaults.maxDate = max;
		        tp_inst._defaults.maxDateTime = max;
		    } else if (onselect) {
		        tp_inst._defaults.onSelect = onselect;
		    }
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name);
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
	};
	
	/*
	* jQuery isEmptyObject does not check hasOwnProperty - if someone has added to the object prototype,
	* it will return false for all objects
	*/
	var isEmptyObject = function(obj) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(obj)) {
				return false;
			}
		}
		return true;
	};

	/*
	* jQuery extend now ignores nulls!
	*/
	var extendRemove = function(target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] === null || props[name] === undefined) {
				target[name] = props[name];
			}
		}
		return target;
	};

	/*
	* Determine by the time format which units are supported
	* Returns an object of booleans for each unit
	*/
	var detectSupport = function(timeFormat){
		var tf = timeFormat.replace(/\'.*?\'/g,'').toLowerCase(), // removes literals
			isIn = function(f, t){ // does the format contain the token?
					return f.indexOf(t) !== -1? true:false; 
				};
		return {
				hour: isIn(tf,'h'),
				minute: isIn(tf,'m'),
				second: isIn(tf,'s'),
				millisec: isIn(tf,'l'),
				microsec: isIn(tf,'c'),
				timezone: isIn(tf,'z'),
				ampm: isIn(tf,'t') &amp;amp;&amp;amp; isIn(timeFormat,'h'),
				iso8601: isIn(timeFormat, 'Z')
			};
	};

	/*
	* Converts 24 hour format into 12 hour
	* Returns 12 hour without leading 0
	*/
	var convert24to12 = function(hour) {
		if (hour &amp;gt; 12) {
			hour = hour - 12;
		}

		if (hour === 0) {
			hour = 12;
		}

		return String(hour);
	};

	/*
	* Splits datetime string into date ans time substrings.
	* Throws exception when date can't be parsed
	* Returns [dateString, timeString]
	*/
	var splitDateTime = function(dateFormat, dateTimeString, dateSettings, timeSettings) {
		try {
			// The idea is to get the number separator occurances in datetime and the time format requested (since time has 
			// fewer unknowns, mostly numbers and am/pm). We will use the time pattern to split.
			var separator = timeSettings &amp;amp;&amp;amp; timeSettings.separator ? timeSettings.separator : $.timepicker._defaults.separator,
				format = timeSettings &amp;amp;&amp;amp; timeSettings.timeFormat ? timeSettings.timeFormat : $.timepicker._defaults.timeFormat,
				timeParts = format.split(separator), // how many occurances of separator may be in our format?
				timePartsLen = timeParts.length,
				allParts = dateTimeString.split(separator),
				allPartsLen = allParts.length;

			if (allPartsLen &amp;gt; 1) {
				return [
						allParts.splice(0,allPartsLen-timePartsLen).join(separator),
						allParts.splice(0,timePartsLen).join(separator)
					];
			}

		} catch (err) {
			$.timepicker.log('Could not split the date from the time. Please check the following datetimepicker options' +
					"\nthrown error: " + err +
					"\ndateTimeString" + dateTimeString +
					"\ndateFormat = " + dateFormat +
					"\nseparator = " + timeSettings.separator +
					"\ntimeFormat = " + timeSettings.timeFormat);

			if (err.indexOf(":") &amp;gt;= 0) {
				// Hack!  The error message ends with a colon, a space, and
				// the "extra" characters.  We rely on that instead of
				// attempting to perfectly reproduce the parsing algorithm.
				var dateStringLength = dateTimeString.length - (err.length - err.indexOf(':') - 2),
					timeString = dateTimeString.substring(dateStringLength);

				return [$.trim(dateTimeString.substring(0, dateStringLength)), $.trim(dateTimeString.substring(dateStringLength))];

			} else {
				throw err;
			}
		}
		return [dateTimeString, ''];
	};

	/*
	* Internal function to parse datetime interval
	* Returns: {date: Date, timeObj: Object}, where
	*   date - parsed date without time (type Date)
	*   timeObj = {hour: , minute: , second: , millisec: , microsec: } - parsed time. Optional
	*/
	var parseDateTimeInternal = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var date;
		var splitRes = splitDateTime(dateFormat, dateTimeString, dateSettings, timeSettings);
		date = $.datepicker._base_parseDate(dateFormat, splitRes[0], dateSettings);
		if (splitRes[1] !== '') {
			var timeString = splitRes[1],
				parsedTime = $.datepicker.parseTime(timeFormat, timeString, timeSettings);

			if (parsedTime === null) {
				throw 'Wrong time format';
			}
			return {
				date: date,
				timeObj: parsedTime
			};
		} else {
			return {
				date: date
			};
		}
	};

	/*
	* Internal function to set timezone_select to the local timezone
	*/
	var selectLocalTimezone = function(tp_inst, date) {
		if (tp_inst &amp;amp;&amp;amp; tp_inst.timezone_select) {
			var now = typeof date !== 'undefined' ? date : new Date();
			tp_inst.timezone_select.val(now.getTimezoneOffset()*-1);
		}
	};

	/*
	* Create a Singleton Insance
	*/
	$.timepicker = new Timepicker();

	/**
	 * Get the timezone offset as string from a date object (eg '+0530' for UTC+5.5)
	 * @@param  number if not a number this value is returned
	 * @@param boolean if true formats in accordance to iso8601 "+12:45"
	 * @@return string
	 */
	$.timepicker.timezoneOffsetString = function(tzMinutes, iso8601) {
		if(isNaN(tzMinutes) || tzMinutes &amp;gt; 840){
			return tzMinutes;
		}

		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601? ':':'',
			tz = (off &amp;gt;= 0 ? '+' : '-') + ('0' + (hours * 101).toString()).slice(-2) + iso + ('0' + (minutes * 101).toString()).slice(-2);
		
		if(tz == '+00:00'){
			return 'Z';
		}
		return tz;
	};

	/**
	 * Get the number in minutes that represents a timezone string
	 * @@param  string formated like "+0500", "-1245"
	 * @@return number
	 */
	$.timepicker.timezoneOffsetNumber = function(tzString) {
		tzString = tzString.toString().replace(':',''); // excuse any iso8601, end up with "+1245"

		if(tzString.toUpperCase() === 'Z'){ // if iso8601 with Z, its 0 minute offset
			return 0;
		}

		if(!/^(\-|\+)\d{4}$/.test(tzString)){ // possibly a user defined tz, so just give it back
			return tzString;
		}

		return ((tzString.substr(0,1) =='-'? -1 : 1) * // plus or minus
					((parseInt(tzString.substr(1,2),10)*60) + // hours (converted to minutes)
					parseInt(tzString.substr(3,2),10))); // minutes
	};

	/**
	 * No way to set timezone in js Date, so we must adjust the minutes to compensate. (think setDate, getDate)
	 * @@param  date
	 * @@param  string formated like "+0500", "-1245"
	 * @@return date
	 */
	$.timepicker.timezoneAdjust = function(date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if(!isNaN(toTz)){
			date.setMinutes(date.getMinutes()*1 + (date.getTimezoneOffset()*-1 - toTz*1) );
		}
		return date;
	};

	/**
	 * Calls `timepicker()` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * n.b. The input value must be correctly formatted (reformatting is not supported)
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the timepicker() call
	 * @@return jQuery
	 */
	$.timepicker.timeRange = function(startTime, endTime, options) {
		return $.timepicker.handleRange('timepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datetimepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@return jQuery
	 */
	$.timepicker.datetimeRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datetimepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.dateRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.handleRange = function(method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0, // min allowed interval in milliseconds
			maxInterval: 0, // max allowed interval in milliseconds
			start: {},      // options for start picker
			end: {}         // options for end picker
		}, options);

		$.fn[method].call(startTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), endTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), endTime, 'minDate');
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), startTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), startTime, 'maxDate');
			}
		}, options, options.end));

		checkDates(startTime, endTime);
		selected(startTime, endTime, 'minDate');
		selected(endTime, startTime, 'maxDate');

		function checkDates(changed, other) {
			var startdt = startTime[method]('getDate'),
				enddt = endTime[method]('getDate'),
				changeddt = changed[method]('getDate');

			if(startdt !== null){
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());

				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);

				if(options.minInterval &amp;gt; 0 &amp;amp;&amp;amp; minDate &amp;gt; enddt){ // minInterval check
					endTime[method]('setDate',minDate);
				}
				else if(options.maxInterval &amp;gt; 0 &amp;amp;&amp;amp; maxDate &amp;lt; enddt){ // max interval check
					endTime[method]('setDate',maxDate);
				}
				else if (startdt &amp;gt; enddt) {
					other[method]('setDate',changeddt);
				}
			}
		}

		function selected(changed, other, option) {
			if (!changed.val()) {
				return;
			}
			var date = changed[method].call(changed, 'getDate');
			if(date !== null &amp;amp;&amp;amp; options.minInterval &amp;gt; 0){
				if(option == 'minDate'){
					date.setMilliseconds(date.getMilliseconds() + options.minInterval); 
				}
				if(option == 'maxDate'){
					date.setMilliseconds(date.getMilliseconds() - options.minInterval);
				}
			}
			if (date.getTime) {
				other[method].call(other, 'option', option, date);
			}
		}
		return $([startTime.get(0), endTime.get(0)]);
	};

	/**
	 * Log error or data to the console during error or debugging
	 * @@param  Object err pass any type object to log to the console during error or debugging
	 * @@return void
	 */
	$.timepicker.log = function(err){
		if(window.console){
			console.log(err);
		}
	};

	/*
	* Microsecond support
	*/
	if(!Date.prototype.getMicroseconds){
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function(){ return this.microseconds; };
		Date.prototype.setMicroseconds = function(m){ 
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m/1000));
			this.microseconds = m%1000;
			return this;
		};
	}

	/*
	* Keep up with the version
	*/
	$.timepicker.version = "1.3.1";

})(jQuery);
jQuery.noConflict();
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;datetimepicker-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;e73a652e-09fc-4c71-8e7a-e2525a2d2a99&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
function replaceAllString(oriStr, strTarget, strSubString ){
   var strText = oriStr;
   var intIndexOfMatch = strText.indexOf( strTarget );
   while (intIndexOfMatch != -1){
      strText = strText.replace( strTarget, strSubString )
      intIndexOfMatch = strText.indexOf( strTarget );
   }
   return( strText );
}
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&amp;amp;]" + name + "=([^&amp;amp;#]*)"),
    results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
};


   var jobName= getParameterByName('job')
   var fromDate= getParameterByName('fromDate')
   var toDate= getParameterByName('toDate')
   var limit= getParameterByName('limit')
   var selectedIstIid = getParameterByName('IstIid')

  $("#jobname").ready(function(){
   $("#jobname").text(jobName)
   var convertedJobName = replaceAllString(jobName, ".", "_")
   $("#IstIid" + convertedJobName).ready(function(){
     $("#IstIid" + convertedJobName).css("display","block")
     $("#select_" + convertedJobName).ready(function(){
        $("#select_" + convertedJobName).val(selectedIstIid)
     });
   });
 });

  $("#fromDate").ready(function(){
   $("#from-date").val(fromDate)
 });

  $("#toDate").ready(function(){
   $("#to-date").val(toDate)
 });

  $("#limit").ready(function(){
   if(limit!=""){
    $("#limit").val(limit)
   }
 });
 // Get data with ajax
 function ajax_getData(jobName,fromDate,toDate,limit ){
       var convertedJobName = replaceAllString(jobName, ".", "_")
       var istIid = $("#select_" + convertedJobName).val()
       window.location="/xwiki/bin/view/WiperDog/WebHome?job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid="+istIid;
 			/*$.ajax({
			 type: "GET",
			 url:"/xwiki/bin/get/Sandbox/DescriptionForJob?outputSyntax=plain&amp;amp;job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid"+selectedIstIid,
			 success : function(result){
				$("#jobname").html(jobName)
				$("#display").text('[[]]' + result)
			 }
		   });*/
 }
	$("#treemenu2 a").click(function(){
		 var limit = 10
		 var fromDate=""
		 var toDate = ""
		 jobName= $(this).text()
                 $("#jobname").html(jobName)
                 var convertedJobName = replaceAllString(jobName, ".", "_")
                 $("#listIstIid &amp;gt; div").css("display","none")
                 $("#IstIid" + convertedJobName).css("display","block")
		 //ajax_getData(jobName,fromDate,toDate,limit )

	});

	$("#from-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
		dateFormat: 'yy-mm-dd',
	});
	$("#to-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
			dateFormat: 'yy-mm-dd',

	});
	 $("#get-data").on("click",function(){
		var fromDate = $("#from-date").val()
		var toDate =  $("#to-date").val()
		 if( toDate!= "" ){
			  if(fromDate != ""){
				  if($("#from-date").datepicker( "getDate" ) &amp;gt; $("#to-date").datepicker( "getDate" )){
				  alert("'From date' cannot start later than 'To date'")
				  return false
				  }
			  }
		 }
		 limit = $("#limit").val()
		 ajax_getData(jobName,fromDate,toDate,limit )
	});
$(document).ready(function(){
  var keys = $("#lstkey").text()
  //console.log('key == ' + keys);
  //console.log('livetableJson ==' + $("#livetableJson").text());
  
  var jsonObj = $.parseJSON($("#livetableJson").text()); 
  if(keys &amp;amp;&amp;amp; keys != '[ ]'){
    /** Subtyped **/    
    var newKeys = keys.replace('[',"");
    keys = newKeys.replace(']',"");
    var keyArr = (keys.indexOf(',') != -1)? keys.split(','):new Array(keys);
    //console.log('Key after replace: '+keys)       
    for(var i=0;i&amp;lt;keyArr.length;i++){
        var keyName = keyArr[i].trim().replace('',"").replace("\"","").replace('\"','');
        var subTypeJsonObjStr = jsonObj[keyName].replace('#livetablePager','#livetablePager_'+keyName)
        var subTypeJsonObj = $.parseJSON(subTypeJsonObjStr);
        $("#livetableList_"+keyName).jqGrid(subTypeJsonObj);
        $("#livetableList_"+keyName).jqGrid('navGrid', "#livetablePager_"+keyName, {
           edit : false,
           add : false,
           del : false,
           search:false
         });
    }
    
  }else{ /** Store**/        
      $("#livetableList").jqGrid(jsonObj);
      $("#livetableList").jqGrid('navGrid', "#livetablePager", {
           edit : false,
           add : false,
           del : false,
           search:false
           
       });
   }
});
        
jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;process&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;881686cc-1bfc-456e-b8ab-71334c4a45e5&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){

	$(function () {
		function drawLineChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerline' + container).highcharts({

				chart: {
					type:'line'
				},
				title: {
					text: chart_name
				},
				tooltip :{
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				xAxis: dataXAxis ,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				series: dataSeries
			});
		};

		function drawBarChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerbar' + container).highcharts({
				chart: {
					type: 'column'
				},
				title: {
					text: chart_name
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {

					column: {
						pointPadding: 0.2,
						borderWidth: 0
					}
				},
				series: dataSeries
			});
		}

		function drawAreaChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail
			$('#containerarea' + container).highcharts({
				chart: {
					type: 'area'
				},
				title: {
					text: chart_name
				},
				subtitle: {
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					},
					labels: {
						formatter: function() {
							return this.value / 1000;
						}
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {
					area: {
						stacking: 'normal',
						lineColor: '#666666',
						lineWidth: 1,
						marker: {
							lineWidth: 1,
							lineColor: '#666666'
						}
					}
				},
				series: dataSeries
			});
		};

		function drawPieChart(data, container, chartName){
			var dataPie = data
			$(document).ready(function () {
				// Build the chart
				$('#container' + container).highcharts({
					chart: {
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: chartName
					},
					tooltip: {
						pointFormat: '{series.name}: &amp;lt;b&amp;gt;{point.percentage:.1f}%&amp;lt;/b&amp;gt;'
					},
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							dataLabels: {
								enabled: true,
                                                                color: '#000000',
                                                                connectorColor: '#000000',
                                                                format: '&amp;lt;b&amp;gt;{point.name}&amp;lt;/b&amp;gt;: {point.percentage:.1f} %'
							},
							showInLegend: true
						}
					},
					series: dataPie
				});
			});
		}

		// LINE
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                     if(($("#jsons&amp;gt;#jsonline_" + finalKey)).length &amp;gt; 0) {
					var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonline_" + finalKey).val());
					var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerline_" + finalKey).val());
				        var lstContainer = [];
  				        var data_all = [];
                                        var chartSize = arrayAll.length

                                        for(var i=0;i&amp;lt;chartSize ;i++){
                                           data_all = arrayAll[i]
                                           lstContainer = arrayContainerAll[i]
				           if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					        // data to display on tooltip
					        var data_detail = data_all[0]
					        // draw Line chart
				        	for(var j=0;j&amp;lt;data_all.length;j++){
				        		if(data_all[j].series[0].name == null){
				        			data_all[j].series[0].name = lstContainer[j]
					        	}
                                                        chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					        	drawLineChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					        }
				         }
                                      }
                                  }
				}
			} else {
				var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonline").val());
				var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerline").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length

                                for(var i=0;i&amp;lt;chartSize ;i++){
                                   data_all = arrayAll[i]
                                   lstContainer = arrayContainerAll[i]
				   if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Line chart
					for(var j=0;j&amp;lt;data_all.length;j++){
						if(data_all[j].series[0].name == null){
							data_all[j].series[0].name = lstContainer[j]
						}
                                                chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
						drawLineChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
				   }
                                }
			}
		});

		// BAR
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
			             var finalKey = lstKey[eKey]
                                     if(($("#jsons&amp;gt;#jsonbar_" + finalKey)).length &amp;gt; 0) {
					var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonbar_" + finalKey).val());
					var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerbar_" + finalKey).val());
					var lstContainer = [];
					var data_all = [];
                                        var chartSize = arrayAll.length
					for(var i=0;i&amp;lt;chartSize ;i++){
					    data_all = arrayAll[i]
					    lstContainer = arrayContainerAll[i]
					    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw bar chart
						for(var j=0;j&amp;lt;data_all.length;j++){
							if(data_all[j].series[0].name == null){
								data_all[j].series[0].name = lstContainer[j]
							}
                                                        chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
							drawBarChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
						}
                                            }
					}
                                    }
				}
			} else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonbar").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerbar").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
				    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Bar chart
					for(var j=0;j&amp;lt;data_all.length;j++){
                                            if(data_all[j].series[0].name == null){
						data_all[j].series[0].name = lstContainer[j]
					    }
                                            chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					    drawBarChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
                                    }
				}
			}
		});

		// AREA
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
                        var arrayAll
                        var arrayContainerAll
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                        if(($("#jsons&amp;gt;#jsonarea_" + finalKey)).length &amp;gt; 0) {
                                           arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonarea_" + finalKey).val());
                                           arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerarea_" + finalKey).val());
					   var lstContainer = [];
					   var data_all = [];
                                           var chartSize = arrayAll.length
					   for(var i=0;i&amp;lt;chartSize ;i++){
					       data_all = arrayAll[i]
					       lstContainer = arrayContainerAll[i]
					       if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						   // data to display on tooltip
						   var data_detail = data_all[0]
						   // draw Line chart
						   for(var j=0;j&amp;lt;data_all.length;j++){
						      if(data_all[j].series[0].name == null){
						         data_all[j].series[0].name = lstContainer[j]
						       }
                                                       chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
						       drawAreaChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
						   }
					      }
				           }
                                        }
			          }
                        } else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonarea").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerarea").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
				    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw area chart
					for(var j=0;j&amp;lt;data_all.length;j++){
                                            if(data_all[j].series[0].name == null){
						data_all[j].series[0].name = lstContainer[j]
					    }
                                            chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					    drawAreaChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
                                    }
				}
			}
		});

		// PIE
		$(document ).ready(function(){
                        var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
                        var arrayAll
                        var arrayContainerAll
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                        if(($("#jsons&amp;gt;#jsonpie_" + finalKey)).length &amp;gt; 0) {
                                           arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonpie_" + finalKey).val());
                                           arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerpie_" + finalKey).val());
					   var lstContainer = [];
					   var data_all = [];
                                           var chartSize = arrayAll.length
					  for(var i=0;i&amp;lt;chartSize ;i++){
					       data_all = arrayAll[i]
console.log(data_all)
					       lstContainer = arrayContainerAll[i]
					       if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						   // draw Pie chart
						   for(var j=0;j&amp;lt;data_all.length;j++){
                                                       //chartName = data_all[j].chart_name
                                                       chartName  = data_all[j].name
						       drawPieChart(data_all, finalKey + "_" + lstContainer[j], chartName)
						   }
					      }
				           }
                                        }
			          }
			} else {
				var array = $("#jsons&amp;gt;.jsonpie");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerpie");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					// draw Pie Chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						var finalData = []
						finalData[0] = data_all[0][i]
						drawPieChart(finalData, lstContainer[0][i])
					}
				}
			}
		});
	});
	jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;d5873d92-b78b-42fc-9407-46d166204b88&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;/* css for timepicker */
.ui-timepicker-div .ui-widget-header { 
margin-bottom: 8px;
 }

.ui-timepicker-div dl { text-align: left; }
.ui-timepicker-div dl dt { height: 25px; margin-bottom: -25px; }
.ui-timepicker-div dl dd { margin: 0 10px 10px 65px; }
.ui-timepicker-div td { font-size: 90%; }
.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }

.ui-timepicker-rtl{ direction: rtl; }
.ui-timepicker-rtl dl { text-align: right; }
.ui-timepicker-rtl dl dd { margin: 0 65px 10px 10px; }
#ui-datepicker-div{
 position:relative;
 width:auto;
 height:auto
}
&lt;/code&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;datetimepicker -css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;1201fb1a-e9c1-4731-8c74-2ea8c0071959&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;.displayblock {
  border:2px solid;
  -webkit-border-radius:6px;
  background:gray;
  float: left;
  width:100%;
}

.displaypie {
  border:1px solid;
  -webkit-border-radius:6px;
  background:gray;
  width: 48%;
  float: left; 
  height: 300px;
}

.subtype {
  margin-top: 50px;
  font-size: 2em;
  color: red;
}&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;content&gt;{{include document="Lib.DataToDrawChart"/}}
{{include document="Lib.MongoDBConnection"/}}
{{velocity}}
$xwiki.jsx.use('Lib.JQueryUILib')
$xwiki.ssx.use('Lib.MenuGenerator')
$xwiki.jsx.use('Lib.MenuGenerator')
$xwiki.ssx.use('Lib.JQueryUILib')
$xwiki.jsx.use('Lib.JqGridLib')
$xwiki.ssx.use('Lib.JqGridLib') 
{{/velocity}}
{{include document="Lib.MenuGenerator"/}}
{{html wiki="true" clean="false"}}
&amp;lt;div id="viewer"&amp;gt;
&amp;lt;table style="text-align:left"  &amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th &amp;gt;Job name&amp;lt;/th&amp;gt;
  &amp;lt;td colspan=3&amp;gt;&amp;lt;div id="jobname"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
{{groovy}}
import org.xwiki.context.*

def ec = services.component.getInstance(Execution.class).getContext()
def mapJobIstIid = ec.getProperty("mapJobIstIid")

println '{{html clean="false" wiki="false"}}'
println '&amp;lt;tr&amp;gt;'
println '&amp;lt;th&amp;gt;IstIid&amp;lt;/th&amp;gt;'
println '&amp;lt;td colspan=3&amp;gt;'
mapJobIstIid.each{jobEntry-&amp;gt;
  def convertedJobKey = jobEntry.key.replaceAll("\\.","_")
  println "&amp;lt;div id='listIstIid'&amp;gt;"
  println "&amp;lt;div id=IstIid${convertedJobKey} style='display:none'&amp;gt;"
  println "&amp;lt;select id=select_${convertedJobKey}&amp;gt;"
  jobEntry.value.each{
     println "&amp;lt;option value=\"$it\"&amp;gt;$it&amp;lt;/option&amp;gt;"
  }
  println "&amp;lt;/select&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
}
println '&amp;lt;/td&amp;gt;'
println '&amp;lt;/tr&amp;gt;'
println '{{/html}}'
{{/groovy}}
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data monitor from&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="from-date" id="from-date"/&amp;gt;&amp;lt;/td&amp;gt;
  &amp;lt;th&amp;gt;Data monitor to&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="to-date" id="to-date"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data records limit &amp;lt;/th&amp;gt;
  &amp;lt;td &amp;gt;
     &amp;lt;select id="limit"&amp;gt;
       &amp;lt;option value=5&amp;gt;5&amp;lt;/option&amp;gt;
       &amp;lt;option value=10&amp;gt;10&amp;lt;/option&amp;gt;
       &amp;lt;option value=15&amp;gt;15&amp;lt;/option&amp;gt;
       &amp;lt;option value=20&amp;gt;20&amp;lt;/option&amp;gt;
     &amp;lt;/select&amp;gt;
  &amp;lt;/td&amp;gt;
  &amp;lt;td colspan=3 &amp;gt;&amp;lt;input type="button" value="View Data" id="get-data" class="button"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;&amp;lt;div id="display"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
  &amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
&amp;lt;/table&amp;gt;

&amp;lt;/div&amp;gt; 
   
 &amp;lt;/body&amp;gt;

{{/html}}
{{groovy}}
import groovy.json.*
xwiki.jsx.use("Lib.Highcharts")

if(request.xpage == "plain") {
	response.setContentType('text/plain')
}

def listData = []
def job = request.get("job")
def fromDate = request.get("fromDate")
def toDate = request.get("toDate")
def limit= (request.get("limit")!=null)?request.get("limit").toInteger():10
def istIid = request.get("IstIid")

def str= "No data to retrieved !"
def result = null
if(job != "" &amp;amp;&amp;amp; job != null &amp;amp;&amp;amp; istIid != null &amp;amp;&amp;amp; istIid != ""){
	MongoDBConnection.getConnection()
	if(fromDate != "" || toDate != ""){
		result = MongoDBConnection.getDataInPeriod(job,fromDate,toDate,limit,istIid)
	} else {
		result = MongoDBConnection.getDataAllFields(job,limit,istIid)
        }
MongoDBConnection.closeConnection()
} else {
   println "{{warning}}There are no selected job or IstIid{{/warning}}"
}
def listKey = []
if( (result != null) &amp;amp;&amp;amp; (result.size() &amp;gt; 0) &amp;amp;&amp;amp; (result[0].KEYEXPR != null)&amp;amp;&amp;amp;!(result[0].KEYEXPR instanceof List )){

if(result[0].type == "Subtyped") {
    println '{{html clean="false" wiki="true"}}'
    //println '&amp;lt;body&amp;gt;'
    def dataSubtype = DataToDrawChart.getDataToDrawSubtype(result)
    dataSubtype.each {key,value -&amp;gt;
        listKey.add(key)
    }
    def jsonkey = com.mongodb.util.JSON.serialize(listKey)
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$jsonkey&amp;lt;/textarea&amp;gt;"

    dataSubtype.each {key,value -&amp;gt;
            def dataLine = []
            def dataBar = []
            def dataPie = []
            def dataArea = []
            if(DataToDrawChart.getDataToDrawLine(value) != []) {
                dataLine = DataToDrawChart.getDataToDrawLine(value)
            }
            if(DataToDrawChart.getDataToDrawBar(value) != []) {
                dataBar = DataToDrawChart.getDataToDrawBar(value)
            }
            if(DataToDrawChart.getDataToDrawPie(value) != []) {
                dataPie = DataToDrawChart.getDataToDrawPie(value)
            }
            if(DataToDrawChart.getDataToDrawArea(value) != []) {
                dataArea = DataToDrawChart.getDataToDrawArea(value)
            }

		def chartColumnsLine = []
		def chartColumnsBar = []
		def chartColumnsArea = []
		def lstName

                dataLine.each {itemDataLine -&amp;gt;
                    if(itemDataLine.size() &amp;gt; 0 ){
		        chartColumnsLine.add(itemDataLine[0].chart_columns)
	            }
                }
                dataBar.each {itemDataBar -&amp;gt;
                    if(itemDataBar.size() &amp;gt; 0 ){
		        chartColumnsBar.add(itemDataBar[0].chart_columns)
	            }
                }
                dataArea.each {itemDataArea -&amp;gt;
                    if(itemDataArea.size() &amp;gt; 0 ){
		        chartColumnsArea.add(itemDataArea[0].chart_columns)
	            }
                }
		if(dataPie.size() &amp;gt; 0 ){
			lstName = dataPie['name']
		}
		def tmpListNameContainer = []
                
		if(lstName != null) {
                        def chartNumPie = 0
                        def tmpLst
                        for(def nameContainer in lstName){
                           tmpLst = []
			   for(def nameContainerItem in nameContainer ){
                                println "nameContainerItem :" + nameContainerItem 
				nameContainerItem = chartNumPie + "_" + nameContainerItem.replaceAll("\\.", "_")
                                //nameContainerItem = nameContainerItem.replaceAll("\\.", "_")
				tmpLst.add(nameContainerItem )
		            }
                            tmpListNameContainer.add(tmpLst)
                            chartNumPie++
                         }
		}
		def jsonPie
		def jsonLine
		def jsonBar
		def jsonArea
		if(dataPie != []) {
		    jsonPie = com.mongodb.util.JSON.serialize(dataPie)
		}
		if(dataLine != []) {
		    jsonLine = com.mongodb.util.JSON.serialize(dataLine)
		}
		if(dataBar != []) {
		    jsonBar = com.mongodb.util.JSON.serialize(dataBar)
		}
		if(dataArea != []) {
		    jsonArea = com.mongodb.util.JSON.serialize(dataArea)
		}
		def jsonContainerPie
		if(tmpListNameContainer != []) {
			jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
		}
		def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
		def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
		def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

		println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
		if(jsonLine != null) {
			println "&amp;lt;textarea id=\"jsonline_$key\" &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class=\"lstcontainerline_$key\" &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
		}
		if(jsonBar != null) {
			println "&amp;lt;textarea id=\"jsonbar_$key\"&amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerbar_$key' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
		}
		if(jsonPie != null &amp;amp;&amp;amp; jsonContainerPie != null) {
			println "&amp;lt;textarea id=\"jsonpie_$key\" &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerpie_$key' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
		}
		if(jsonArea != null) {
			println "&amp;lt;textarea id=\"jsonarea_$key\" &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerarea_$key' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
		}

        println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
        println "&amp;lt;input style=\"display:none\" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;"
        println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
        println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'
        println "&amp;lt;/div&amp;gt;"
          
        def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
        def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
          
        println "&amp;lt;div style='clear:both'&amp;gt;"
            def description = value.KEYEXPR._description[0][key]
            if(description != null) {
                println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +': ' + description +'&amp;lt;/div&amp;gt;'
            } else {
                println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +'&amp;lt;/div&amp;gt;'
            }
            println "-----"
            if(jsonPie != null) {
          println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
		chartNumPie = 0
          lstName.each{chartPieLst -&amp;gt;
		chartPieLst.each {
	            def tmp = chartNumPie + "_" + it.replaceAll("\\.", "_")
		    println " &amp;lt;div class=\"displaypie\" id=\"container${key}_${tmp}\" &amp;gt;&amp;lt;/div&amp;gt;"
          	}
		chartNumPie++
	  }	
          println "&amp;lt;/div&amp;gt;"
            }
            if(jsonLine != null) {
          	def chartLineComment = false
		def chartNumLine = 0
          	chartColumnsLine.each{chartColumnsLineItem -&amp;gt;
            		if(!chartLineComment){
               			println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
               			chartLineComment = true  
            		}
		chartColumnsLineItem.each{
              		println " &amp;lt;div class=\"displayblock\" id=\"containerline${key}_${chartNumLine}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          	}
		chartNumLine ++
	    }
          println "&amp;lt;/div&amp;gt;"
            }
            println "&amp;amp;nbsp;"

            if(jsonBar != null) {
          	def chartBarComment = false
  		def chartNumBar = 0
          	chartColumnsBar.each{chartColumnsBarItem -&amp;gt;
             		if(!chartBarComment){
                		println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
                		chartBarComment = true
              		}  
			chartColumnsBarItem.each{
             			println " &amp;lt;div class=\"displayblock\" id=\"containerbar${key}_${chartNumBar}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          		}
			chartNumBar++
		}
          	println "&amp;lt;/div&amp;gt;"
            }
            println "&amp;amp;nbsp;"

            if(jsonArea != null) {
          	def chartAreaComment = false
		def chartNumArea = 0
          	chartColumnsArea.each{chartColumnsAreaItem -&amp;gt;
          		if(!chartAreaComment){
            			println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
            			chartAreaComment = true
          		}
			chartColumnsAreaItem.each{
            			println " &amp;lt;div class=\"displayblock\" id=\"containerarea${key}_${chartNumArea}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          		}
          		chartNumArea++
            	}
        	println "&amp;lt;/div&amp;gt;"
	    }
        /** Statistic data table **/
        println "&amp;lt;center&amp;gt;"        
        println "&amp;lt;div id='livetblContent_"+key+"' style='width:100%;clear:both;align:middle;margin-top:10px'&amp;gt;"   
        println "Statistics data for "+key
        println "&amp;lt;table id='livetableList_"+key+"' style='width:100%;align:center'&amp;gt;&amp;lt;/table&amp;gt;"
        println "&amp;lt;div id='livetablePager_"+key+"' style='position:relative;width:100%'&amp;gt;&amp;lt;/div&amp;gt;"
        println "&amp;lt;/div&amp;gt;"
        println "&amp;lt;/center&amp;gt;"
        println "&amp;lt;script language='javascript'&amp;gt;console.log('Create live table for "+key+"');&amp;lt;/script&amp;gt;"
    }
    //println '&amp;lt;/body&amp;gt;'
    println '{{/html}}'
} else if(result[0].type == "Store") {
	// data store
	def dataLine = DataToDrawChart.getDataToDrawLine(result)
	def dataBar = DataToDrawChart.getDataToDrawBar(result)
	def dataPie = DataToDrawChart.getDataToDrawPie(result)
	def dataArea = DataToDrawChart.getDataToDrawArea(result)
	def chartColumnsLine = []
	def chartColumnsBar = []
	def chartColumnsArea = []
	def lstName

        dataLine.each {itemDataLine -&amp;gt;
            if(itemDataLine.size() &amp;gt; 0 ){
		chartColumnsLine.add(itemDataLine[0].chart_columns)
	    }
        }

        dataBar.each {itemDataBar -&amp;gt;
            if(itemDataBar.size() &amp;gt; 0 ){
		chartColumnsBar.add(itemDataBar[0].chart_columns)
	    }
        }

        dataArea.each {itemDataArea -&amp;gt;
            if(itemDataArea.size() &amp;gt; 0 ){
		chartColumnsArea.add(itemDataArea[0].chart_columns)
	    }
        }

	if(dataPie.size() &amp;gt; 0 ){
		lstName = dataPie['name']
	}

    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
  
    def tmpListNameContainer = []
    for(def nameContainer in lstName){
       println nameContainer 
       //nameContainer = nameContainer.replaceAll("\\.", "_")
       tmpListNameContainer.add(nameContainer)
    }
  
    def jsonPie = com.mongodb.util.JSON.serialize(dataPie)
    def jsonLine = com.mongodb.util.JSON.serialize(dataLine)
    def jsonBar = com.mongodb.util.JSON.serialize(dataBar)
    def jsonArea = com.mongodb.util.JSON.serialize(dataArea)

    def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
    def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
    def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
    def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

    def listEmpty = com.mongodb.util.JSON.serialize([])
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$listEmpty&amp;lt;/textarea&amp;gt;" 

    println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'

    println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
    println "&amp;lt;textarea class='jsonline' &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonbar' &amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonpie' &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonarea' &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"

    println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
  
    def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
    def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
  
    println "&amp;lt;div style='clear:both'&amp;gt;"
  
    def chartPieComment = false
    lstName.each{
        if(!chartPieComment) {
            println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
            chartPieComment = true
        }
        def tmp = it//.replaceAll("\\.", "_")
        println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    	def chartLineComment = false
	def chartNum = 0
    	chartColumnsLine.each{chartColumnsLineItem -&amp;gt;
	    	if(!chartLineComment){
	        	println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	        	chartLineComment = true  
	    	}
		chartColumnsLineItem.each{
	    		println " &amp;lt;div class=\"displayblock\" id=\"containerline${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	    	}
		chartNum++
	}	
    	println "&amp;lt;/div&amp;gt;"
    	println "&amp;amp;nbsp;"
    	def chartBarComment = false
	chartNum = 0
    	chartColumnsBar.each{chartColumnsBarItem -&amp;gt;
	        if(!chartBarComment){
	            println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	            chartBarComment = true
	        }  
		chartColumnsBarItem.each{
	    		println " &amp;lt;div class=\"displayblock\" id=\"containerbar${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  	}
		chartNum++
	}
  println "&amp;lt;/div&amp;gt;"
  println "&amp;amp;nbsp;"
  	def chartAreaComment = false
	chartNum = 0
  	chartColumnsArea.each{chartColumnsAreaItem -&amp;gt;
	  	if(!chartAreaComment){
	    		println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	    		chartAreaComment = true
	  	}
		chartColumnsAreaItem.each{
    			println " &amp;lt;div class=\"displayblock\" id=\"containerarea${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
		}
		chartNum++
  	}
  println "&amp;lt;/div&amp;gt;"
println "&amp;lt;/div&amp;gt;"

//println '&amp;lt;/body&amp;gt;'
println '{{/html}}'
}
}else{
    println 'There is no data for this job with criterias'
}
//--=============== Start build for livetable
def subTypeURLMap = [:]
def dataModel = []
def dataUrl = ""
result.find{rec-&amp;gt;				
    def subtractData = []
    
    //-- Parsing data and assign data to subtract list
    if(rec.type == "Store"){ //-- Store data type
        subtractData = rec['data']        
        subtractData.each{r2-&amp;gt;					
            if(dataModel != null &amp;amp;&amp;amp; dataModel.size() &amp;lt;=0){ 
                dataModel.add("Fetch At")
                dataModel.addAll(r2.keySet());					
            } 
        }        
        dataUrl = "/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job="+job +"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate + "&amp;amp;toDate=" + toDate + "&amp;amp;istIid="+istIid        
        //-- Building data model				
        def model = []
        def colSpec
        dataModel.each{name-&amp;gt;
            colSpec = [:]
            colSpec['name'] = name
            colSpec['index'] = name
            colSpec['width'] = "100"
            model.add(colSpec)
        }
        def dataModelStr = (new JsonBuilder(dataModel)).toPrettyString()
        def modelStr = (new JsonBuilder(model)).toPrettyString() 
        str = 
        "{\"url\":\""+dataUrl+"\",\"datatype\":\"json\","+
            "\"colNames\":"+ dataModelStr +
            ",\"colModel\":"+ modelStr +" ,\"rowList\":[10,20,30],"+
            "\"pager\":\"#livetablePager\", \"viewrecords\": true, \"sortname\": \"RECORD_SEQ\","+
            "\"sortorder\": \"asc\", \"caption\":\""+job+"\"}"
        println "{{html clean=\"false\" wiki=\"true\"}}"
        println "&amp;lt;div id='livetableJson' style = \"display:none\"&amp;gt;"
        //println "&amp;lt;div id='livetableJson'&amp;gt;"
        println str;
        println "&amp;lt;/div&amp;gt;"
        println "{{/html}}"
    }else{ //-- Subtype			
        def subData = rec['data']
        subData.each{key,value-&amp;gt;
            dataUrl = "/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job="+job +"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate + "&amp;amp;toDate=" + toDate + "&amp;amp;istIid="+istIid+"&amp;amp;subType="+key
            subtractData = value
            subtractData.each{r2-&amp;gt;					
                if(dataModel != null &amp;amp;&amp;amp; dataModel.size() &amp;lt;=0){ 
                    dataModel.add("Fetch At")
                    dataModel.addAll(r2.keySet());					
                } 			
            }
            //-- Building data model				
            def model = []
            def colSpec
            dataModel.each{name-&amp;gt;
                colSpec = [:]
                colSpec['name'] = name
                colSpec['index'] = name
                colSpec['width'] = "100"
                model.add(colSpec)
            }
            def dataModelStr = (new JsonBuilder(dataModel)).toPrettyString()
            def modelStr = (new JsonBuilder(model)).toPrettyString() 
            str = 
            "{\"url\":\""+dataUrl+"\",\"datatype\":\"json\","+
                "\"colNames\":"+ dataModelStr +
                ",\"colModel\":"+ modelStr +" ,\"rowList\":[10,20,30],"+
                "\"pager\":\"#livetablePager\", \"viewrecords\": true, \"sortname\": \"RECORD_SEQ\","+
                "\"sortorder\": \"asc\", \"caption\":\""+job+"\"}"
            subTypeURLMap[key] = str
        }
        def finalStr = (new JsonBuilder(subTypeURLMap)).toPrettyString()
        println "{{html clean=\"false\" wiki=\"true\"}}"
        println "&amp;lt;div id='livetableJson' style = \"display:none\"&amp;gt;"
        //println "&amp;lt;div id='livetableJson'&amp;gt;"
        println finalStr;
        println "&amp;lt;/div&amp;gt;"
        println "{{/html}}"
    }
    return true
}
 //--=============== END

if(listKey.size() &amp;lt;= 0){   
    println "{{html clean=\"false\" wiki=\"true\"}}"
    println "&amp;lt;center&amp;gt;"
    println "&amp;lt;div id=\"livetblContent\" style=\"width:100%;clear:both;align:middle;margin-top:10px\"&amp;gt;"   
    println "Statistics Data"
    println "&amp;lt;table id=\"livetableList\" style=\"width:100%;align:center\"&amp;gt;&amp;lt;/table&amp;gt;"    
    println "&amp;lt;div id=\"livetablePager\"&amp;gt;&amp;lt;/div&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
    println "&amp;lt;/center&amp;gt;"
    
    println "&amp;lt;div id=\"testDiv\"&amp;gt;&amp;amp;nbsp;&amp;lt;/div&amp;gt;"
    println "{{/html}}"
}
{{/groovy}}
&lt;/content&gt;&lt;/xwikidoc&gt;@


61.7
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376552028000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376552028000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.7&lt;/version&gt;
d3545 2
a3546 2
    //println '&amp;lt;body&amp;gt;'
  println "lstName" + lstName
d3549 1
@


61.6
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376551866000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376551866000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.6&lt;/version&gt;
d3549 1
a3549 1
       nameContainer = nameContainer.replaceAll("\\.", "_")
d3594 1
a3594 1
        def tmp = it.replaceAll("\\.", "_")
@


61.5
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376551648000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376551224000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.5&lt;/version&gt;
d3546 1
a3546 1
  
@


61.4
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376551224000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;61.4&lt;/version&gt;
d2758 1
d2780 1
d2815 2
a2816 1
					var finalKey = lstKey[eKey]
d2838 1
@


61.3
log
@@
text
@&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xwikidoc&gt;
&lt;web&gt;WiperDog&lt;/web&gt;
&lt;name&gt;WebHome&lt;/name&gt;
&lt;language&gt;&lt;/language&gt;
&lt;defaultLanguage&gt;en&lt;/defaultLanguage&gt;
&lt;translation&gt;0&lt;/translation&gt;
&lt;parent&gt;&lt;/parent&gt;
&lt;creator&gt;XWiki.Admin&lt;/creator&gt;
&lt;author&gt;XWiki.Admin&lt;/author&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;contentAuthor&gt;XWiki.Admin&lt;/contentAuthor&gt;
&lt;creationDate&gt;1376364375000&lt;/creationDate&gt;
&lt;date&gt;1376550662000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376550640000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.3&lt;/version&gt;
&lt;title&gt;WiperDog&lt;/title&gt;
&lt;defaultTemplate&gt;&lt;/defaultTemplate&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;comment&gt;&lt;/comment&gt;
&lt;minorEdit&gt;true&lt;/minorEdit&gt;
&lt;syntaxId&gt;xwiki/2.1&lt;/syntaxId&gt;
&lt;hidden&gt;false&lt;/hidden&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;047293a8-524d-45e4-af52-cd944523d5d0&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
/*
 * jQuery timepicker addon
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 1.3.1
 * Last Modified: 07/07/2013
 *
 * Copyright 2013 Trent Richardson
 * You may use this project under MIT or GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 */

/*jslint evil: true, white: false, undef: false, nomen: false */

(function($) {

	/*
	* Lets not redefine timepicker, Prevent "Uncaught RangeError: Maximum call stack size exceeded"
	*/
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return;
	}

	/*
	* Extend jQueryUI, get it started with our version number
	*/
	$.extend($.ui, {
		timepicker: {
			version: "1.3.1"
		}
	});

	/* 
	* Timepicker manager.
	* Use the singleton instance of this class, $.timepicker, to interact with the time picker.
	* Settings for (groups of) time pickers are maintained in an instance object,
	* allowing multiple different settings on the same page.
	*/
	var Timepicker = function() {
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[''] = { // Default regional settings
			currentText: 'Now',
			closeText: 'Done',
			amNames: ['AM', 'A'],
			pmNames: ['PM', 'P'],
			timeFormat: 'HH:mm',
			timeSuffix: '',
			timeOnlyTitle: 'Choose Time',
			timeText: 'Time',
			hourText: 'Hour',
			minuteText: 'Minute',
			secondText: 'Second',
			millisecText: 'Millisecond',
			microsecText: 'Microsecond',
			timezoneText: 'Time Zone',
			isRTL: false
		};
		this._defaults = { // Global defaults for all the datetime picker instances
			showButtonPanel: true,
			timeOnly: false,
			showHour: null,
			showMinute: null,
			showSecond: null,
			showMillisec: null,
			showMicrosec: null,
			showTimezone: null,
			showTime: true,
			stepHour: 1,
			stepMinute: 1,
			stepSecond: 1,
			stepMillisec: 1,
			stepMicrosec: 1,
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null,
			hourMin: 0,
			minuteMin: 0,
			secondMin: 0,
			millisecMin: 0,
			microsecMin: 0,
			hourMax: 23,
			minuteMax: 59,
			secondMax: 59,
			millisecMax: 999,
			microsecMax: 999,
			minDateTime: null,
			maxDateTime: null,
			onSelect: null,
			hourGrid: 0,
			minuteGrid: 0,
			secondGrid: 0,
			millisecGrid: 0,
			microsecGrid: 0,
			alwaysSetTime: true,
			separator: ' ',
			altFieldTimeOnly: true,
			altTimeFormat: null,
			altSeparator: null,
			altTimeSuffix: null,
			pickerTimeFormat: null,
			pickerTimeSuffix: null,
			showTimepicker: true,
			timezoneList: null,
			addSliderAccess: false,
			sliderAccessArgs: null,
			controlType: 'slider',
			defaultValue: null,
			parse: 'strict'
		};
		$.extend(this._defaults, this.regional['']);
	};

	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: '',
		formattedDate: '',
		formattedTime: '',
		formattedDateTime: '',
		timezoneList: null,
		units: ['hour','minute','second','millisec', 'microsec'],
		support: {},
		control: null,

		/* 
		* Override the default settings for all instances of the time picker.
		* @@param  settings  object - the new settings to use as defaults (anonymous object)
		* @@return the manager object
		*/
		setDefaults: function(settings) {
			extendRemove(this._defaults, settings || {});
			return this;
		},

		/*
		* Create a new Timepicker instance
		*/
		_newInst: function($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
            	fns = {},
		    	overrides, i;

			for (var attrName in this._defaults) {
				if(this._defaults.hasOwnProperty(attrName)){
					var attrValue = $input.attr('time:' + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue);
						} catch (err) {
							inlineSettings[attrName] = attrValue;
						}
					}
				}
			}

		    overrides = {
		        beforeShow: function (input, dp_inst) {
		            if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
		                return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst);
		            }
		        },
		        onChangeMonthYear: function (year, month, dp_inst) {
		            // Update the time as well : this prevents the time from disappearing from the $input field.
		            tp_inst._updateDateTime(dp_inst);
		            if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
		                tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst);
		            }
		        },
		        onClose: function (dateText, dp_inst) {
		            if (tp_inst.timeDefined === true &amp;amp;&amp;amp; $input.val() !== '') {
		                tp_inst._updateDateTime(dp_inst);
		            }
		            if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
		                tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst);
		            }
		        }
		    };
		    for (i in overrides) {
		        if (overrides.hasOwnProperty(i)) {
		            fns[i] = opts[i] || null;
		        }
		    }

		    tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
		        evnts:fns,
		        timepicker: tp_inst // add timepicker as a property of datepicker: $.datepicker._get(dp_inst, 'timepicker');
		    });
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function(val) {
				return val.toUpperCase();
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function(val) {
				return val.toUpperCase();
			});

			// detect which units are supported
			tp_inst.support = detectSupport(
					tp_inst._defaults.timeFormat + 
					(tp_inst._defaults.pickerTimeFormat? tp_inst._defaults.pickerTimeFormat:'') + 
					(tp_inst._defaults.altTimeFormat? tp_inst._defaults.altTimeFormat:''));

			// controlType is string - key to our this._controls
			if(typeof(tp_inst._defaults.controlType) === 'string'){
				if(tp_inst._defaults.controlType == 'slider' &amp;amp;&amp;amp; typeof(jQuery.ui.slider) === 'undefined'){
					tp_inst._defaults.controlType = 'select';
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType];
			}
			// controlType is an object and must implement create, options, value methods
			else{ 
				tp_inst.control = tp_inst._defaults.controlType;
			}

			// prep the timezone options
			var timezoneList = [-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,
					0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList;
			}
			var tzl=timezoneList.length,tzi=0,tzv=null;
			if (tzl &amp;gt; 0 &amp;amp;&amp;amp; typeof timezoneList[0] !== 'object') {
				for(; tzi&amp;lt;tzl; tzi++){
					tzv = timezoneList[tzi];
					timezoneList[tzi] = { value: tzv, label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601) };
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;

			// set the default units
			tp_inst.timezone = tp_inst._defaults.timezone !== null? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) : 
							((new Date()).getTimezoneOffset()*-1);
			tp_inst.hour = tp_inst._defaults.hour &amp;lt; tp_inst._defaults.hourMin? tp_inst._defaults.hourMin : 
							tp_inst._defaults.hour &amp;gt; tp_inst._defaults.hourMax? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute &amp;lt; tp_inst._defaults.minuteMin? tp_inst._defaults.minuteMin : 
							tp_inst._defaults.minute &amp;gt; tp_inst._defaults.minuteMax? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second &amp;lt; tp_inst._defaults.secondMin? tp_inst._defaults.secondMin : 
							tp_inst._defaults.second &amp;gt; tp_inst._defaults.secondMax? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec &amp;lt; tp_inst._defaults.millisecMin? tp_inst._defaults.millisecMin : 
							tp_inst._defaults.millisec &amp;gt; tp_inst._defaults.millisecMax? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec &amp;lt; tp_inst._defaults.microsecMin? tp_inst._defaults.microsecMin : 
							tp_inst._defaults.microsec &amp;gt; tp_inst._defaults.microsecMax? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = '';
			tp_inst.$input = $input;

			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField).css({
					cursor: 'pointer'
				}).focus(function() {
					$input.trigger("focus");
				});
			}

			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date();
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date();
			}

			// datepicker needs minDate/maxDate, timepicker needs minDateTime/maxDateTime..
			if (tp_inst._defaults.minDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime());
			}
			if (tp_inst._defaults.minDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime());
			}
			if (tp_inst._defaults.maxDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime());
			}
			if (tp_inst._defaults.maxDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime());
			}
			tp_inst.$input.bind('focus', function() {
				tp_inst._onFocus();
			});

			return tp_inst;
		},

		/*
		* add our sliders to the calendar
		*/
		_addTimePicker: function(dp_inst) {
			var currDT = (this.$altInput &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly) ? this.$input.val() + ' ' + this.$altInput.val() : this.$input.val();

			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
		},

		/*
		* parse the time string from input value or _setTime
		*/
		_parseTime: function(timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0]);
			}

			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, 'dateFormat');
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false;
					}
					$.extend(this, parseRes.timeObj);
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err +
									"\ndate/time string = " + timeString +
									"\ntimeFormat = " + this._defaults.timeFormat +
									"\ndateFormat = " + dp_dateFormat);
					return false;
				}
				return true;
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false;
				}
				$.extend(this, timeObj);
				return true;
			}
		},

		/*
		* generate and inject html for timepicker into ui datepicker
		*/
		_injectTimePicker: function() {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = '',
				uitem = '',
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i=0,
				l=0;

			// Prevent displaying twice
			if ($dp.find("div.ui-timepicker-div").length === 0 &amp;amp;&amp;amp; o.showTimepicker) {
				var noDisplay = ' style="display:none;"',
					html = '&amp;lt;div class="ui-timepicker-div'+ (o.isRTL? ' ui-timepicker-rtl' : '') +'"&amp;gt;&amp;lt;dl&amp;gt;' + '&amp;lt;dt class="ui_tpicker_time_label"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;' + o.timeText + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_time"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the markup
				for(i=0,l=this.units.length; i&amp;lt;l; i++){
					litem = this.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// Added by Peter Medeiros:
					// - Figure out what the hour/minute/second max should be based on the step values.
					// - Example: if stepMinute is 15, then minMax is 45.
					max[litem] = parseInt((o[litem+'Max'] - ((o[litem+'Max'] - o[litem+'Min']) % o['step'+uitem])), 10);
					gridSize[litem] = 0;

					html += '&amp;lt;dt class="ui_tpicker_'+ litem +'_label"' + (show ? '' : noDisplay) + '&amp;gt;' + o[litem +'Text'] + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_'+ litem +'"&amp;gt;&amp;lt;div class="ui_tpicker_'+ litem +'_slider"' + (show ? '' : noDisplay) + '&amp;gt;&amp;lt;/div&amp;gt;';

					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						html += '&amp;lt;div style="padding-left: 1px"&amp;gt;&amp;lt;table class="ui-tpicker-grid-label"&amp;gt;&amp;lt;tr&amp;gt;';

						if(litem == 'hour'){
							for (var h = o[litem+'Min']; h &amp;lt;= max[litem]; h += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm? 'hht':'HH', {hour:h}, o);									
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + tmph + '&amp;lt;/td&amp;gt;';
							}
						}
						else{
							for (var m = o[litem+'Min']; m &amp;lt;= max[litem]; m += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + ((m &amp;lt; 10) ? '0' : '') + m + '&amp;lt;/td&amp;gt;';
							}
						}

						html += '&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;&amp;lt;/div&amp;gt;';
					}
					html += '&amp;lt;/dd&amp;gt;';
				}
				
				// Timezone
				var showTz = o.showTimezone !== null? o.showTimezone : this.support.timezone;
				html += '&amp;lt;dt class="ui_tpicker_timezone_label"' + (showTz ? '' : noDisplay) + '&amp;gt;' + o.timezoneText + '&amp;lt;/dt&amp;gt;';
				html += '&amp;lt;dd class="ui_tpicker_timezone" ' + (showTz ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the elements from string
				html += '&amp;lt;/dl&amp;gt;&amp;lt;/div&amp;gt;';
				var $tp = $(html);

				// if we only want time picker...
				if (o.timeOnly === true) {
					$tp.prepend('&amp;lt;div class="ui-widget-header ui-helper-clearfix ui-corner-all"&amp;gt;' + '&amp;lt;div class="ui-datepicker-title"&amp;gt;' + o.timeOnlyTitle + '&amp;lt;/div&amp;gt;' + '&amp;lt;/div&amp;gt;');
					$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();
				}
				
				// add sliders, adjust grids, add events
				for(i=0,l=tp_inst.units.length; i&amp;lt;l; i++){
					litem = tp_inst.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// add the slider
					tp_inst[litem+'_slider'] = tp_inst.control.create(tp_inst, $tp.find('.ui_tpicker_'+litem+'_slider'), litem, tp_inst[litem], o[litem+'Min'], max[litem], o['step'+uitem]);

					// adjust the grid and add click event
					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						size = 100 * gridSize[litem] * o[litem+'Grid'] / (max[litem] - o[litem+'Min']);
						$tp.find('.ui_tpicker_'+litem+' table').css({
							width: size + "%",
							marginLeft: o.isRTL? '0' : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL? ((size / (-2 * gridSize[litem])) + "%") : '0',
							borderCollapse: 'collapse'
						}).find("td").click(function(e){
								var $t = $(this),
									h = $t.html(),
									n = parseInt(h.replace(/[^0-9]/g),10),
									ap = h.replace(/[^apm]/ig),
									f = $t.data('for'); // loses scope, so we use data-for

								if(f == 'hour'){
									if(ap.indexOf('p') !== -1 &amp;amp;&amp;amp; n &amp;lt; 12){
										n += 12;
									}
									else{
										if(ap.indexOf('a') !== -1 &amp;amp;&amp;amp; n === 12){
											n = 0;
										}
									}
								}
								
								tp_inst.control.value(tp_inst, tp_inst[f+'_slider'], litem, n);

								tp_inst._onTimeChange();
								tp_inst._onSelectHandler();
							}).css({
								cursor: 'pointer',
								width: (100 / gridSize[litem]) + '%',
								textAlign: 'center',
								overflow: 'hidden'
							});
					} // end if grid &amp;gt; 0
				} // end for loop

				// Add timezone options
				this.timezone_select = $tp.find('.ui_tpicker_timezone').append('&amp;lt;select&amp;gt;&amp;lt;/select&amp;gt;').find("select");
				$.fn.append.apply(this.timezone_select,
				$.map(o.timezoneList, function(val, idx) {
					return $("&amp;lt;option /&amp;gt;").val(typeof val == "object" ? val.value : val).text(typeof val == "object" ? val.label : val);
				}));
				if (typeof(this.timezone) != "undefined" &amp;amp;&amp;amp; this.timezone !== null &amp;amp;&amp;amp; this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset()*-1;
					if (local_timezone == this.timezone) {
						selectLocalTimezone(tp_inst);
					} else {
						this.timezone_select.val(this.timezone);
					}
				} else {
					if (typeof(this.hour) != "undefined" &amp;amp;&amp;amp; this.hour !== null &amp;amp;&amp;amp; this.hour !== "") {
						this.timezone_select.val(o.timezone);
					} else {
						selectLocalTimezone(tp_inst);
					}
				}
				this.timezone_select.change(function() {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
				});
				// End timezone options
				
				// inject timepicker into datepicker
				var $buttonPanel = $dp.find('.ui-datepicker-buttonpane');
				if ($buttonPanel.length) {
					$buttonPanel.before($tp);
				} else {
					$dp.append($tp);
				}

				this.$timeObj = $tp.find('.ui_tpicker_time');

				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined;
				}

				// slideAccess integration: http://trentrichardson.com/2011/11/11/jquery-ui-sliders-and-touch-accessibility/
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
						
					setTimeout(function() { // fix for inline mode
						if ($tp.find('.ui-slider-access').length === 0) {
							$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);

							// fix any grids since sliders are shorter
							var sliderAccessWidth = $tp.find('.ui-slider-access:eq(0)').outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find('table:visible').each(function() {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl? 'marginRight':'marginLeft').toString().replace('%', ''),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + '%',
										css = { width: newWidth, marginRight: 0, marginLeft: 0 };
									css[rtl? 'marginRight':'marginLeft'] = newMarginLeft;
									$g.css(css);
								});
							}
						}
					}, 10);
				}
				// end slideAccess integration

				tp_inst._limitMinMaxDateTime(this.inst, true);
			}
		},

		/*
		* This function tries to limit the ability to go outside the
		* min/max date range
		*/
		_limitMinMaxDateTime: function(dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);

			if (!this._defaults.showTimepicker) {
				return;
			} // No time so nothing to check here

			if ($.datepicker._get(dp_inst, 'minDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'minDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, 'minDateTime'),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin;
				}

				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour &amp;lt;= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute &amp;lt;= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second &amp;lt;= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if(this.millisec &amp;lt;= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;lt; this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin;
									}
									this._defaults.microsecMin = this.microsecMinOriginal;
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal;
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal;
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal;
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal;
				}
			}

			if ($.datepicker._get(dp_inst, 'maxDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'maxDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, 'maxDateTime'),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax;
				}

				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour &amp;gt;= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute &amp;gt;= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second &amp;gt;= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec &amp;gt;= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;gt; this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax;
									}
									this._defaults.microsecMax = this.microsecMaxOriginal;
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal;
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal;
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal;
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal;
				}
			}

			if (adjustSliders !== undefined &amp;amp;&amp;amp; adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10);
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);

				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, 'hour', { min: this._defaults.hourMin, max: hourMax });
					this.control.value(this, this.hour_slider, 'hour', this.hour - (this.hour % this._defaults.stepHour));
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, 'minute', { min: this._defaults.minuteMin, max: minMax });
					this.control.value(this, this.minute_slider, 'minute', this.minute - (this.minute % this._defaults.stepMinute));
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, 'second', { min: this._defaults.secondMin, max: secMax });
					this.control.value(this, this.second_slider, 'second', this.second - (this.second % this._defaults.stepSecond));
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, 'millisec', { min: this._defaults.millisecMin, max: millisecMax });
					this.control.value(this, this.millisec_slider, 'millisec', this.millisec - (this.millisec % this._defaults.stepMillisec));
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, 'microsec', { min: this._defaults.microsecMin, max: microsecMax });
					this.control.value(this, this.microsec_slider, 'microsec', this.microsec - (this.microsec % this._defaults.stepMicrosec));
				}
			}

		},

		/*
		* when a slider moves, set the internal time...
		* on time change is also called when the time is updated in the text field
		*/
		_onTimeChange: function() {
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, 'hour') : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, 'minute') : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, 'second') : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, 'millisec') : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, 'microsec') : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;

			if (typeof(hour) == 'object') {
				hour = false;
			}
			if (typeof(minute) == 'object') {
				minute = false;
			}
			if (typeof(second) == 'object') {
				second = false;
			}
			if (typeof(millisec) == 'object') {
				millisec = false;
			}
			if (typeof(microsec) == 'object') {
				microsec = false;
			}
			if (typeof(timezone) == 'object') {
				timezone = false;
			}

			if (hour !== false) {
				hour = parseInt(hour, 10);
			}
			if (minute !== false) {
				minute = parseInt(minute, 10);
			}
			if (second !== false) {
				second = parseInt(second, 10);
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10);
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10);
			}

			var ampm = o[hour &amp;lt; 12 ? 'amNames' : 'pmNames'][0];

			// If the update was done in the input field, the input field should not be updated.
			// If the update was done using the sliders, update the input field.
			var hasChanged = (hour != this.hour || minute != this.minute || second != this.second || millisec != this.millisec || microsec != this.microsec 
								|| (this.ampm.length &amp;gt; 0 &amp;amp;&amp;amp; (hour &amp;lt; 12) != ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) 
								|| (this.timezone !== null &amp;amp;&amp;amp; timezone != this.timezone));

			if (hasChanged) {

				if (hour !== false) {
					this.hour = hour;
				}
				if (minute !== false) {
					this.minute = minute;
				}
				if (second !== false) {
					this.second = second;
				}
				if (millisec !== false) {
					this.millisec = millisec;
				}
				if (microsec !== false) {
					this.microsec = microsec;
				}
				if (timezone !== false) {
					this.timezone = timezone;
				}

				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0]);
				}

				this._limitMinMaxDateTime(this.inst, true);
			}
			if (this.support.ampm) {
				this.ampm = ampm;
			}

			// Updates the time within the timepicker
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if(pickerTimeFormat === o.timeFormat){
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix);
				}
				else{
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix);
				}
			}

			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime();
			}
		},

		/*
		* call custom onSelect.
		* bind to sliders slidestop, and grid click.
		*/
		_onSelectHandler: function() {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect &amp;amp;&amp;amp; inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this]);
			}
		},

		/*
		* update our input with the new date time..
		*/
		_updateDateTime: function(dp_inst) {
			dp_inst = this.inst || dp_inst;
			//var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
			var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay)),
				dateFmt = $.datepicker._get(dp_inst, 'dateFormat'),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null &amp;amp;&amp;amp; this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			
			// if a slider was changed but datepicker doesn't have a value yet, set it
			if(dp_inst.lastVal===""){
                dp_inst.currentYear=dp_inst.selectedYear;
                dp_inst.currentMonth=dp_inst.selectedMonth;
                dp_inst.currentDay=dp_inst.selectedDay;
            }

			/*
			* remove following lines to force every changes in date picker to change the input value
			* Bug descriptions: when an input field has a default value, and click on the field to pop up the date picker. 
			* If the user manually empty the value in the input field, the date picker will never change selected value.
			*/
			//if (dp_inst.lastVal !== undefined &amp;amp;&amp;amp; (dp_inst.lastVal.length &amp;gt; 0 &amp;amp;&amp;amp; this.$input.val().length === 0)) {
			//	return;
			//}

			if (this._defaults.timeOnly === true) {
				formattedDateTime = this.formattedTime;
			} else if (this._defaults.timeOnly !== true &amp;amp;&amp;amp; (this._defaults.alwaysSetTime || timeAvailable)) {
				formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix;
			}

			this.formattedDateTime = formattedDateTime;

			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate);
			} else if (this.$altInput &amp;amp;&amp;amp; this._defaults.timeOnly === false &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly === true) {
				this.$altInput.val(this.formattedTime);
				this.$input.val(this.formattedDate);
			} else if (this.$altInput) {
				this.$input.val(formattedDateTime);
				var altFormattedDateTime = '',
					altSeparator = this._defaults.altSeparator ? this._defaults.altSeparator : this._defaults.separator,
					altTimeSuffix = this._defaults.altTimeSuffix ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
				
				if(!this._defaults.timeOnly){
					if (this._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg);
					}
					else{
						altFormattedDateTime = this.formattedDate;
					}

					if (altFormattedDateTime){
						altFormattedDateTime += altSeparator;
					}
				}

				if(this._defaults.altTimeFormat){
					altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix;
				}
				else{
					altFormattedDateTime += this.formattedTime + altTimeSuffix;
				}
				this.$altInput.val(altFormattedDateTime);
			} else {
				this.$input.val(formattedDateTime);
			}

			this.$input.trigger("change");
		},

		_onFocus: function() {
			if (!this.$input.val() &amp;amp;&amp;amp; this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, 'timepicker');
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst);
						} catch (err) {
							$.timepicker.log(err);
						}
					}
				}
			}
		},

		/*
		* Small abstraction to control types
		* We can add more, just be sure to follow the pattern: create, options, value
		*/
		_controls: {
			// slider methods
			slider: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var rtl = tp_inst._defaults.isRTL; // if rtl go -60-&amp;gt;0 instead of 0-&amp;gt;60
					return obj.prop('slide', null).slider({
						orientation: "horizontal",
						value: rtl? val*-1 : val,
						min: rtl? max*-1 : min,
						max: rtl? min*-1 : max,
						step: step,
						slide: function(event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl? ui.value*-1:ui.value);
							tp_inst._onTimeChange();
						},
						stop: function(event, ui) {
							tp_inst._onSelectHandler();
						}
					});	
				},
				options: function(tp_inst, obj, unit, opts, val){
					if(tp_inst._defaults.isRTL){
						if(typeof(opts) == 'string'){
							if(opts == 'min' || opts == 'max'){
								if(val !== undefined){
									return obj.slider(opts, val*-1);
								}
								return Math.abs(obj.slider(opts));
							}
							return obj.slider(opts);
						}
						var min = opts.min, 
							max = opts.max;
						opts.min = opts.max = null;
						if(min !== undefined){
							opts.max = min * -1;
						}
						if(max !== undefined){
							opts.min = max * -1;
						}
						return obj.slider(opts);
					}
					if(typeof(opts) == 'string' &amp;amp;&amp;amp; val !== undefined){
							return obj.slider(opts, val);
					}
					return obj.slider(opts);
				},
				value: function(tp_inst, obj, unit, val){
					if(tp_inst._defaults.isRTL){
						if(val !== undefined){
							return obj.slider('value', val*-1);
						}
						return Math.abs(obj.slider('value'));
					}
					if(val !== undefined){
						return obj.slider('value', val);
					}
					return obj.slider('value');
				}
			},
			// select methods
			select: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var sel = '&amp;lt;select class="ui-timepicker-select" data-unit="'+ unit +'" data-min="'+ min +'" data-max="'+ max +'" data-step="'+ step +'"&amp;gt;',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;

					for(var i=min; i&amp;lt;=max; i+=step){						
						sel += '&amp;lt;option value="'+ i +'"'+ (i==val? ' selected':'') +'&amp;gt;';
						if(unit == 'hour'){
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig,'')), {hour:i}, tp_inst._defaults);
						}
						else if(unit == 'millisec' || unit == 'microsec' || i &amp;gt;= 10){ sel += i; }
						else {sel += '0'+ i.toString(); }
						sel += '&amp;lt;/option&amp;gt;';
					}
					sel += '&amp;lt;/select&amp;gt;';

					obj.children('select').remove();

					$(sel).appendTo(obj).change(function(e){
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
					});

					return obj;
				},
				options: function(tp_inst, obj, unit, opts, val){
					var o = {},
						$t = obj.children('select');
					if(typeof(opts) == 'string'){
						if(val === undefined){
							return $t.data(opts);
						}
						o[opts] = val;	
					}
					else{ o = opts; }
					return tp_inst.control.create(tp_inst, obj, $t.data('unit'), $t.val(), o.min || $t.data('min'), o.max || $t.data('max'), o.step || $t.data('step'));
				},
				value: function(tp_inst, obj, unit, val){
					var $t = obj.children('select');
					if(val !== undefined){
						return $t.val(val);
					}
					return $t.val();
				}
			}
		} // end _controls

	});

	$.fn.extend({
		/*
		* shorthand just to use timepicker..
		*/
		timepicker: function(o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);

			if (typeof o == 'object') {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				});
			}

			return $(this).each(function() {
				$.fn.datetimepicker.apply($(this), tmp_args);
			});
		},

		/*
		* extend timepicker to datepicker
		*/
		datetimepicker: function(o) {
			o = o || {};
			var tmp_args = arguments;

			if (typeof(o) == 'string') {
				if (o == 'getDate') {
					return $.fn.datepicker.apply($(this[0]), tmp_args);
				} else {
					return this.each(function() {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args);
					});
				}
			} else {
				return this.each(function() {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults);
				});
			}
		}
	});

	/*
	* Public Utility to parse date and time
	*/
	$.datepicker.parseDateTime = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec);
		}

		return parseRes.date;
	};

	/*
	* Public utility to parse time
	*/
	$.datepicker.parseTime = function(timeFormat, timeString, options) {		
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g,'').indexOf('Z') !== -1);

		// Strict parse requires the timeString to match the timeFormat exactly
		var strictParse = function(f, s, o){

			// pattern for standard and localized AM/PM markers
			var getPatternAmpm = function(amNames, pmNames) {
				var markers = [];
				if (amNames) {
					$.merge(markers, amNames);
				}
				if (pmNames) {
					$.merge(markers, pmNames);
				}
				markers = $.map(markers, function(val) {
					return val.replace(/[.*+?|()\[\]{}\\]/g, '\\$&amp;amp;');
				});
				return '(' + markers.join('|') + ')?';
			};

			// figure out position of time elements.. cause js cant do named captures
			var getFormatPositions = function(timeFormat) {
				var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
					orders = {
						h: -1,
						m: -1,
						s: -1,
						l: -1,
						c: -1,
						t: -1,
						z: -1
					};

				if (finds) {
					for (var i = 0; i &amp;lt; finds.length; i++) {
						if (orders[finds[i].toString().charAt(0)] == -1) {
							orders[finds[i].toString().charAt(0)] = i + 1;
						}
					}
				}
				return orders;
			};

			var regstr = '^' + f.toString()
					.replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
							var ml = match.length;
							switch (match.charAt(0).toLowerCase()) {
								case 'h': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'm': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 's': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'l': return '(\\d?\\d?\\d)';
								case 'c': return '(\\d?\\d?\\d)';
								case 'z': return '(z|[-+]\\d\\d:?\\d\\d|\\S+)?';
								case 't': return getPatternAmpm(o.amNames, o.pmNames);
								default:    // literal escaped in quotes
									return '(' + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function (m) { return "\\" + m; }) + ')?';
							}
						})
					.replace(/\s/g, '\\s?') +
					o.timeSuffix + '$',
				order = getFormatPositions(f),
				ampm = '',
				treg;

			treg = s.match(new RegExp(regstr, 'i'));

			var resTime = {
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0
			};

			if (treg) {
				if (order.t !== -1) {
					if (treg[order.t] === undefined || treg[order.t].length === 0) {
						ampm = '';
						resTime.ampm = '';
					} else {
						ampm = $.inArray(treg[order.t].toUpperCase(), o.amNames) !== -1 ? 'AM' : 'PM';
						resTime.ampm = o[ampm == 'AM' ? 'amNames' : 'pmNames'][0];
					}
				}

				if (order.h !== -1) {
					if (ampm == 'AM' &amp;amp;&amp;amp; treg[order.h] == '12') {
						resTime.hour = 0; // 12am = 0 hour
					} else {
						if (ampm == 'PM' &amp;amp;&amp;amp; treg[order.h] != '12') {
							resTime.hour = parseInt(treg[order.h], 10) + 12; // 12pm = 12 hour, any other pm = hour + 12
						} else {
							resTime.hour = Number(treg[order.h]);
						}
					}
				}

				if (order.m !== -1) {
					resTime.minute = Number(treg[order.m]);
				}
				if (order.s !== -1) {
					resTime.second = Number(treg[order.s]);
				}
				if (order.l !== -1) {
					resTime.millisec = Number(treg[order.l]);
				}
				if (order.c !== -1) {
					resTime.microsec = Number(treg[order.c]);
				}
				if (order.z !== -1 &amp;amp;&amp;amp; treg[order.z] !== undefined) {
					resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z]);
				}


				return resTime;
			}
			return false;
		};// end strictParse

		// First try JS Date, if that fails, use strictParse
		var looseParse = function(f,s,o){
			try{
				var d = new Date('2012-01-01 '+ s);
				if(isNaN(d.getTime())){
					d = new Date('2012-01-01T'+ s);
					if(isNaN(d.getTime())){
						d = new Date('01/01/2012 '+ s);
						if(isNaN(d.getTime())){
							throw "Unable to parse time with native Date: "+ s;
						}
					}
				}

				return {
					hour: d.getHours(),
					minute: d.getMinutes(),
					second: d.getSeconds(),
					millisec: d.getMilliseconds(),
					microsec: d.getMicroseconds(),
					timezone: d.getTimezoneOffset()*-1
				};
			}
			catch(err){
				try{
					return strictParse(f,s,o);
				}
				catch(err2){
					$.timepicker.log("Unable to parse \ntimeString: "+ s +"\ntimeFormat: "+ f);
				}				
			}
			return false;
		}; // end looseParse
		
		if(typeof o.parse === "function"){
			return o.parse(timeFormat, timeString, o);
		}
		if(o.parse === 'loose'){
			return looseParse(timeFormat, timeString, o);
		}
		return strictParse(timeFormat, timeString, o);
	};

	/*
	* Public utility to format the time
	* format = string format of the time
	* time = a {}, not a Date() for timezones
	* options = essentially the regional[].. amNames, pmNames, ampm
	*/
	$.datepicker.formatTime = function(format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			timezone: 0
		}, time);

		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);

		if (hour &amp;gt; 11) {
			ampmName = options.pmNames[0];
		}

		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|('.*?'|".*?"))/g, function(match) {
		switch (match) {
			case 'HH':
				return ('0' + hour).slice(-2);
			case 'H':
				return hour;
			case 'hh':
				return ('0' + convert24to12(hour)).slice(-2);
			case 'h':
				return convert24to12(hour);
			case 'mm':
				return ('0' + time.minute).slice(-2);
			case 'm':
				return time.minute;
			case 'ss':
				return ('0' + time.second).slice(-2);
			case 's':
				return time.second;
			case 'l':
				return ('00' + time.millisec).slice(-3);
			case 'c':
				return ('00' + time.microsec).slice(-3);
			case 'z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, false);
			case 'Z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, true);
			case 'T': 
				return ampmName.charAt(0).toUpperCase();
			case 'TT': 
				return ampmName.toUpperCase();
			case 't':
				return ampmName.charAt(0).toLowerCase();
			case 'tt':
				return ampmName.toLowerCase();
			default:
				return match.replace(/\'/g, "") || "'";
			}
		});

		tmptime = $.trim(tmptime);
		return tmptime;
	};

	/*
	* the bad hack :/ override datepicker so it doesnt close on select
	// inspired: http://stackoverflow.com/questions/1252512/jquery-datepicker-prevent-closing-picker-when-clicking-a-date/1762378#1762378
	*/
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function(id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			tp_inst._limitMinMaxDateTime(inst, true);
			inst.inline = inst.stay_open = true;
			//This way the onSelect handler called from calendarpicker get the full dateTime
			this._base_selectDate(id, dateStr);
			inst.inline = inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst);
		} else {
			this._base_selectDate(id, dateStr);
		}
	};

	/*
	* second bad hack :/ override datepicker so it triggers an event when changing the input field
	* and does not redraw the datepicker on every selectDate event
	*/
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function(inst) {

		// don't popup the datepicker if there is another instance already opened
		var input = inst.input[0];
		if ($.datepicker._curInst &amp;amp;&amp;amp; $.datepicker._curInst != inst &amp;amp;&amp;amp; $.datepicker._datepickerShowing &amp;amp;&amp;amp; $.datepicker._lastInput != input) {
			return;
		}

		if (typeof(inst.stay_open) !== 'boolean' || inst.stay_open === false) {

			this._base_updateDatepicker(inst);

			// Reload the time control when changing something in the input text field.
			var tp_inst = this._get(inst, 'timepicker');
			if (tp_inst) {
				tp_inst._addTimePicker(inst);
			}
		}
	};

	/*
	* third bad hack :/ override datepicker so it allows spaces and colon in the input field
	*/
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if ($.datepicker._get(inst, 'constrainInput')) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null? tp_inst._defaults.showTimezone : tp_inst.support.timezone,					
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat')),
					datetimeChars = tp_inst._defaults.timeFormat.toString()
											.replace(/[hms]/g, '')
											.replace(/TT/g, ampm ? 'APM' : '')
											.replace(/Tt/g, ampm ? 'AaPpMm' : '')
											.replace(/tT/g, ampm ? 'AaPpMm' : '')
											.replace(/T/g, ampm ? 'AP' : '')
											.replace(/tt/g, ampm ? 'apm' : '')
											.replace(/t/g, ampm ? 'ap' : '') + 
											" " + tp_inst._defaults.separator + 
											tp_inst._defaults.timeSuffix + 
											(tz ? tp_inst._defaults.timezoneList.join('') : '') + 
											(tp_inst._defaults.amNames.join('')) + (tp_inst._defaults.pmNames.join('')) + 
											dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr &amp;lt; ' ' || !dateChars || datetimeChars.indexOf(chr) &amp;gt; -1);
			}
		}

		return $.datepicker._base_doKeyPress(event);
	};

	/*
	* Fourth bad hack :/ override _updateAlternate function used in inline mode to init altField
	*/
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	/* Update any alternate field to synchronise with the main field. */
	$.datepicker._updateAlternate = function(inst) {
		var tp_inst = this._get(inst, 'timepicker');
		if(tp_inst){
			var altField = tp_inst._defaults.altField;
			if (altField) { // update alternate field too
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = '', 
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator, 
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if(!tp_inst._defaults.timeOnly &amp;amp;&amp;amp; !tp_inst._defaults.altFieldTimeOnly &amp;amp;&amp;amp; date !== null){
					if(tp_inst._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime;
					}
					else{
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime;
					}
				}
				$(altField).val(altFormattedDateTime);
			}
		}
		else{
			$.datepicker._base_updateAlternate(inst);
		}
	};

	/*
	* Override key up event to sync manual input changes.
	*/
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst);
				} catch (err) {
					$.timepicker.log(err);
				}
			}
		}

		return $.datepicker._base_doKeyUp(event);
	};

	/*
	* override "Today" button to also grab the time.
	*/
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function(id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		this._base_gotoToday(id);
		var tp_inst = this._get(inst, 'timepicker');
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		$('.ui-datepicker-today', $dp).click();
	};

	/*
	* Disable &amp;amp; enable the Time in the datetimepicker
	*/
	$.datepicker._disableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst);
		}
	};

	$.datepicker._enableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst); // Could be disabled on page load
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create our own set time function
	*/
	$.datepicker._setTime = function(inst, date) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var defaults = tp_inst._defaults;

			// calling _setTime with no date sets time to defaults
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;

			//check if within min/max times.. 
			tp_inst._limitMinMaxDateTime(inst, true);

			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create new public method to set only time, callable as $().datepicker('setTime', date)
	*/
	$.datepicker._setTimeDatepicker = function(target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date == "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec);
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds());
				}
				if (tp_date.toString() == 'Invalid Date') {
					tp_date = undefined;
				}
				this._setTime(inst, tp_date);
			}
		}

	};

	/*
	* override setDate() to allow setting time too within Date object
	*/
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function(target, date) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		if(typeof(date) === 'string'){
			date = new Date(date);
			if(!date.getTime()){
				$.timepicker.log("Error creating Date object from string.");
			}
		}

		var tp_inst = this._get(inst, 'timepicker');
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds());
		} else {
			tp_date = date;
		}
		
		// This is important if you are using the timezone option, javascript's Date 
		// object will only return the timezone offset for the current locale, so we 
		// adjust it accordingly.  If not using timezone option this won't matter..
		// If a timezone is different in tp, keep the timezone as is
		if(tp_inst){
			// look out for DST if tz wasn't specified
			if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
				tp_inst.timezone = tp_date.getTimezoneOffset()*-1;
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone);
		}

		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true);
	};

	/*
	* override getDate() to allow getting time too within Date object
	*/
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function(target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			// if it hasn't yet been defined, grab from field
			if(inst.lastVal === undefined){
				this._setDateFromField(inst, noDefault);
			}

			var date = this._getDate(inst);
			if (date &amp;amp;&amp;amp; tp_inst._parseTime($(target).val(), tp_inst.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);

				// This is important if you are using the timezone option, javascript's Date 
				// object will only return the timezone offset for the current locale, so we 
				// adjust it accordingly.  If not using timezone option this won't matter..
				if(tp_inst.timezone != null){
					// look out for DST if tz wasn't specified
					if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
						tp_inst.timezone = date.getTimezoneOffset()*-1;
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
				}
			}
			return date;
		}
		return this._base_getDateDatepicker(target, noDefault);
	};

	/*
	* override parseDate() because UI 1.8.14 throws an error about "Extra characters"
	* An option in datapicker to ignore extra format characters would be nicer.
	*/
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function(format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings);
		} catch (err) {
			// Hack!  The error message ends with a colon, a space, and
			// the "extra" characters.  We rely on that instead of
			// attempting to perfectly reproduce the parsing algorithm.
			if (err.indexOf(":") &amp;gt;= 0) {
				date = this._base_parseDate(format, value.substring(0,value.length-(err.length-err.indexOf(':')-2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format);
			} else {
				throw err;
			}
		}
		return date;
	};

	/*
	* override formatDate to set date with time to the input
	*/
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function(inst, day, month, year) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val();
		}
		return this._base_formatDate(inst);
	};

	/*
	* override options setter to add time to maxDate(Time) and minDate(Time). MaxDate
	*/
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function(target, name, value) {
		var inst = this._getInst(target),
	        name_clone;
		if (!inst) {
			return null;
		}

		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop;
		    if (typeof name == 'string') { // if min/max was set with the string
		        if (name === 'minDate' || name === 'minDateTime') {
		            min = value;
		        } else if (name === 'maxDate' || name === 'maxDateTime') {
		            max = value;
		        } else if (name === 'onSelect') {
		            onselect = value;
		        } else if (overrides.hasOwnProperty(name)) {
		            if (typeof (value) === 'undefined') {
		                return overrides[name];
		            }
		            fns[name] = value;
		            name_clone = {}; //empty results in exiting function after overrides updated
		        }
		    } else if (typeof name == 'object') { //if min/max was set with the JSON
		        if (name.minDate) {
		            min = name.minDate;
		        } else if (name.minDateTime) {
		            min = name.minDateTime;
		        } else if (name.maxDate) {
		            max = name.maxDate;
		        } else if (name.maxDateTime) {
		            max = name.maxDateTime;
		        }
		        for (prop in overrides) {
		            if (overrides.hasOwnProperty(prop) &amp;amp;&amp;amp; name[prop]) {
		                fns[prop] = name[prop];
		            }
		        }
		    }
		    for (prop in fns) {
		        if (fns.hasOwnProperty(prop)) {
		            overrides[prop] = fns[prop];
		            if (!name_clone) { name_clone = $.extend({}, name);}
		            delete name_clone[prop];
		        }
		    }
		    if (name_clone &amp;amp;&amp;amp; isEmptyObject(name_clone)) { return; }
		    if (min) { //if min was set
		        if (min === 0) {
		            min = new Date();
		        } else {
		            min = new Date(min);
		        }
		        tp_inst._defaults.minDate = min;
		        tp_inst._defaults.minDateTime = min;
		    } else if (max) { //if max was set
		        if (max === 0) {
		            max = new Date();
		        } else {
		            max = new Date(max);
		        }
		        tp_inst._defaults.maxDate = max;
		        tp_inst._defaults.maxDateTime = max;
		    } else if (onselect) {
		        tp_inst._defaults.onSelect = onselect;
		    }
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name);
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
	};
	
	/*
	* jQuery isEmptyObject does not check hasOwnProperty - if someone has added to the object prototype,
	* it will return false for all objects
	*/
	var isEmptyObject = function(obj) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(obj)) {
				return false;
			}
		}
		return true;
	};

	/*
	* jQuery extend now ignores nulls!
	*/
	var extendRemove = function(target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] === null || props[name] === undefined) {
				target[name] = props[name];
			}
		}
		return target;
	};

	/*
	* Determine by the time format which units are supported
	* Returns an object of booleans for each unit
	*/
	var detectSupport = function(timeFormat){
		var tf = timeFormat.replace(/\'.*?\'/g,'').toLowerCase(), // removes literals
			isIn = function(f, t){ // does the format contain the token?
					return f.indexOf(t) !== -1? true:false; 
				};
		return {
				hour: isIn(tf,'h'),
				minute: isIn(tf,'m'),
				second: isIn(tf,'s'),
				millisec: isIn(tf,'l'),
				microsec: isIn(tf,'c'),
				timezone: isIn(tf,'z'),
				ampm: isIn(tf,'t') &amp;amp;&amp;amp; isIn(timeFormat,'h'),
				iso8601: isIn(timeFormat, 'Z')
			};
	};

	/*
	* Converts 24 hour format into 12 hour
	* Returns 12 hour without leading 0
	*/
	var convert24to12 = function(hour) {
		if (hour &amp;gt; 12) {
			hour = hour - 12;
		}

		if (hour === 0) {
			hour = 12;
		}

		return String(hour);
	};

	/*
	* Splits datetime string into date ans time substrings.
	* Throws exception when date can't be parsed
	* Returns [dateString, timeString]
	*/
	var splitDateTime = function(dateFormat, dateTimeString, dateSettings, timeSettings) {
		try {
			// The idea is to get the number separator occurances in datetime and the time format requested (since time has 
			// fewer unknowns, mostly numbers and am/pm). We will use the time pattern to split.
			var separator = timeSettings &amp;amp;&amp;amp; timeSettings.separator ? timeSettings.separator : $.timepicker._defaults.separator,
				format = timeSettings &amp;amp;&amp;amp; timeSettings.timeFormat ? timeSettings.timeFormat : $.timepicker._defaults.timeFormat,
				timeParts = format.split(separator), // how many occurances of separator may be in our format?
				timePartsLen = timeParts.length,
				allParts = dateTimeString.split(separator),
				allPartsLen = allParts.length;

			if (allPartsLen &amp;gt; 1) {
				return [
						allParts.splice(0,allPartsLen-timePartsLen).join(separator),
						allParts.splice(0,timePartsLen).join(separator)
					];
			}

		} catch (err) {
			$.timepicker.log('Could not split the date from the time. Please check the following datetimepicker options' +
					"\nthrown error: " + err +
					"\ndateTimeString" + dateTimeString +
					"\ndateFormat = " + dateFormat +
					"\nseparator = " + timeSettings.separator +
					"\ntimeFormat = " + timeSettings.timeFormat);

			if (err.indexOf(":") &amp;gt;= 0) {
				// Hack!  The error message ends with a colon, a space, and
				// the "extra" characters.  We rely on that instead of
				// attempting to perfectly reproduce the parsing algorithm.
				var dateStringLength = dateTimeString.length - (err.length - err.indexOf(':') - 2),
					timeString = dateTimeString.substring(dateStringLength);

				return [$.trim(dateTimeString.substring(0, dateStringLength)), $.trim(dateTimeString.substring(dateStringLength))];

			} else {
				throw err;
			}
		}
		return [dateTimeString, ''];
	};

	/*
	* Internal function to parse datetime interval
	* Returns: {date: Date, timeObj: Object}, where
	*   date - parsed date without time (type Date)
	*   timeObj = {hour: , minute: , second: , millisec: , microsec: } - parsed time. Optional
	*/
	var parseDateTimeInternal = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var date;
		var splitRes = splitDateTime(dateFormat, dateTimeString, dateSettings, timeSettings);
		date = $.datepicker._base_parseDate(dateFormat, splitRes[0], dateSettings);
		if (splitRes[1] !== '') {
			var timeString = splitRes[1],
				parsedTime = $.datepicker.parseTime(timeFormat, timeString, timeSettings);

			if (parsedTime === null) {
				throw 'Wrong time format';
			}
			return {
				date: date,
				timeObj: parsedTime
			};
		} else {
			return {
				date: date
			};
		}
	};

	/*
	* Internal function to set timezone_select to the local timezone
	*/
	var selectLocalTimezone = function(tp_inst, date) {
		if (tp_inst &amp;amp;&amp;amp; tp_inst.timezone_select) {
			var now = typeof date !== 'undefined' ? date : new Date();
			tp_inst.timezone_select.val(now.getTimezoneOffset()*-1);
		}
	};

	/*
	* Create a Singleton Insance
	*/
	$.timepicker = new Timepicker();

	/**
	 * Get the timezone offset as string from a date object (eg '+0530' for UTC+5.5)
	 * @@param  number if not a number this value is returned
	 * @@param boolean if true formats in accordance to iso8601 "+12:45"
	 * @@return string
	 */
	$.timepicker.timezoneOffsetString = function(tzMinutes, iso8601) {
		if(isNaN(tzMinutes) || tzMinutes &amp;gt; 840){
			return tzMinutes;
		}

		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601? ':':'',
			tz = (off &amp;gt;= 0 ? '+' : '-') + ('0' + (hours * 101).toString()).slice(-2) + iso + ('0' + (minutes * 101).toString()).slice(-2);
		
		if(tz == '+00:00'){
			return 'Z';
		}
		return tz;
	};

	/**
	 * Get the number in minutes that represents a timezone string
	 * @@param  string formated like "+0500", "-1245"
	 * @@return number
	 */
	$.timepicker.timezoneOffsetNumber = function(tzString) {
		tzString = tzString.toString().replace(':',''); // excuse any iso8601, end up with "+1245"

		if(tzString.toUpperCase() === 'Z'){ // if iso8601 with Z, its 0 minute offset
			return 0;
		}

		if(!/^(\-|\+)\d{4}$/.test(tzString)){ // possibly a user defined tz, so just give it back
			return tzString;
		}

		return ((tzString.substr(0,1) =='-'? -1 : 1) * // plus or minus
					((parseInt(tzString.substr(1,2),10)*60) + // hours (converted to minutes)
					parseInt(tzString.substr(3,2),10))); // minutes
	};

	/**
	 * No way to set timezone in js Date, so we must adjust the minutes to compensate. (think setDate, getDate)
	 * @@param  date
	 * @@param  string formated like "+0500", "-1245"
	 * @@return date
	 */
	$.timepicker.timezoneAdjust = function(date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if(!isNaN(toTz)){
			date.setMinutes(date.getMinutes()*1 + (date.getTimezoneOffset()*-1 - toTz*1) );
		}
		return date;
	};

	/**
	 * Calls `timepicker()` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * n.b. The input value must be correctly formatted (reformatting is not supported)
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the timepicker() call
	 * @@return jQuery
	 */
	$.timepicker.timeRange = function(startTime, endTime, options) {
		return $.timepicker.handleRange('timepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datetimepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@return jQuery
	 */
	$.timepicker.datetimeRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datetimepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.dateRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.handleRange = function(method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0, // min allowed interval in milliseconds
			maxInterval: 0, // max allowed interval in milliseconds
			start: {},      // options for start picker
			end: {}         // options for end picker
		}, options);

		$.fn[method].call(startTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), endTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), endTime, 'minDate');
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), startTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), startTime, 'maxDate');
			}
		}, options, options.end));

		checkDates(startTime, endTime);
		selected(startTime, endTime, 'minDate');
		selected(endTime, startTime, 'maxDate');

		function checkDates(changed, other) {
			var startdt = startTime[method]('getDate'),
				enddt = endTime[method]('getDate'),
				changeddt = changed[method]('getDate');

			if(startdt !== null){
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());

				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);

				if(options.minInterval &amp;gt; 0 &amp;amp;&amp;amp; minDate &amp;gt; enddt){ // minInterval check
					endTime[method]('setDate',minDate);
				}
				else if(options.maxInterval &amp;gt; 0 &amp;amp;&amp;amp; maxDate &amp;lt; enddt){ // max interval check
					endTime[method]('setDate',maxDate);
				}
				else if (startdt &amp;gt; enddt) {
					other[method]('setDate',changeddt);
				}
			}
		}

		function selected(changed, other, option) {
			if (!changed.val()) {
				return;
			}
			var date = changed[method].call(changed, 'getDate');
			if(date !== null &amp;amp;&amp;amp; options.minInterval &amp;gt; 0){
				if(option == 'minDate'){
					date.setMilliseconds(date.getMilliseconds() + options.minInterval); 
				}
				if(option == 'maxDate'){
					date.setMilliseconds(date.getMilliseconds() - options.minInterval);
				}
			}
			if (date.getTime) {
				other[method].call(other, 'option', option, date);
			}
		}
		return $([startTime.get(0), endTime.get(0)]);
	};

	/**
	 * Log error or data to the console during error or debugging
	 * @@param  Object err pass any type object to log to the console during error or debugging
	 * @@return void
	 */
	$.timepicker.log = function(err){
		if(window.console){
			console.log(err);
		}
	};

	/*
	* Microsecond support
	*/
	if(!Date.prototype.getMicroseconds){
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function(){ return this.microseconds; };
		Date.prototype.setMicroseconds = function(m){ 
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m/1000));
			this.microseconds = m%1000;
			return this;
		};
	}

	/*
	* Keep up with the version
	*/
	$.timepicker.version = "1.3.1";

})(jQuery);
jQuery.noConflict();
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;datetimepicker-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;e73a652e-09fc-4c71-8e7a-e2525a2d2a99&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
function replaceAllString(oriStr, strTarget, strSubString ){
   var strText = oriStr;
   var intIndexOfMatch = strText.indexOf( strTarget );
   while (intIndexOfMatch != -1){
      strText = strText.replace( strTarget, strSubString )
      intIndexOfMatch = strText.indexOf( strTarget );
   }
   return( strText );
}
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&amp;amp;]" + name + "=([^&amp;amp;#]*)"),
    results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
};


   var jobName= getParameterByName('job')
   var fromDate= getParameterByName('fromDate')
   var toDate= getParameterByName('toDate')
   var limit= getParameterByName('limit')
   var selectedIstIid = getParameterByName('IstIid')

  $("#jobname").ready(function(){
   $("#jobname").text(jobName)
   var convertedJobName = replaceAllString(jobName, ".", "_")
   $("#IstIid" + convertedJobName).ready(function(){
     $("#IstIid" + convertedJobName).css("display","block")
     $("#select_" + convertedJobName).ready(function(){
        $("#select_" + convertedJobName).val(selectedIstIid)
     });
   });
 });

  $("#fromDate").ready(function(){
   $("#from-date").val(fromDate)
 });

  $("#toDate").ready(function(){
   $("#to-date").val(toDate)
 });

  $("#limit").ready(function(){
   if(limit!=""){
    $("#limit").val(limit)
   }
 });
 // Get data with ajax
 function ajax_getData(jobName,fromDate,toDate,limit ){
       var convertedJobName = replaceAllString(jobName, ".", "_")
       var istIid = $("#select_" + convertedJobName).val()
       window.location="/xwiki/bin/view/WiperDog/WebHome?job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid="+istIid;
 			/*$.ajax({
			 type: "GET",
			 url:"/xwiki/bin/get/Sandbox/DescriptionForJob?outputSyntax=plain&amp;amp;job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid"+selectedIstIid,
			 success : function(result){
				$("#jobname").html(jobName)
				$("#display").text('[[]]' + result)
			 }
		   });*/
 }
	$("#treemenu2 a").click(function(){
		 var limit = 10
		 var fromDate=""
		 var toDate = ""
		 jobName= $(this).text()
                 $("#jobname").html(jobName)
                 var convertedJobName = replaceAllString(jobName, ".", "_")
                 $("#listIstIid &amp;gt; div").css("display","none")
                 $("#IstIid" + convertedJobName).css("display","block")
		 //ajax_getData(jobName,fromDate,toDate,limit )

	});

	$("#from-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
		dateFormat: 'yy-mm-dd',
	});
	$("#to-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
			dateFormat: 'yy-mm-dd',

	});
	 $("#get-data").on("click",function(){
		var fromDate = $("#from-date").val()
		var toDate =  $("#to-date").val()
		 if( toDate!= "" ){
			  if(fromDate != ""){
				  if($("#from-date").datepicker( "getDate" ) &amp;gt; $("#to-date").datepicker( "getDate" )){
				  alert("'From date' cannot start later than 'To date'")
				  return false
				  }
			  }
		 }
		 limit = $("#limit").val()
		 ajax_getData(jobName,fromDate,toDate,limit )
	});
$(document).ready(function(){
  var keys = $("#lstkey").text()
  //console.log('key == ' + keys);
  //console.log('livetableJson ==' + $("#livetableJson").text());
  
  var jsonObj = $.parseJSON($("#livetableJson").text()); 
  if(keys &amp;amp;&amp;amp; keys != '[ ]'){
    /** Subtyped **/    
    var newKeys = keys.replace('[',"");
    keys = newKeys.replace(']',"");
    var keyArr = (keys.indexOf(',') != -1)? keys.split(','):new Array(keys);
    //console.log('Key after replace: '+keys)       
    for(var i=0;i&amp;lt;keyArr.length;i++){
        var keyName = keyArr[i].trim().replace('',"").replace("\"","").replace('\"','');
        var subTypeJsonObjStr = jsonObj[keyName].replace('#livetablePager','#livetablePager_'+keyName)
        var subTypeJsonObj = $.parseJSON(subTypeJsonObjStr);
        $("#livetableList_"+keyName).jqGrid(subTypeJsonObj);
        $("#livetableList_"+keyName).jqGrid('navGrid', "#livetablePager_"+keyName, {
           edit : false,
           add : false,
           del : false,
           search:false
         });
    }
    
  }else{ /** Store**/        
      $("#livetableList").jqGrid(jsonObj);
      $("#livetableList").jqGrid('navGrid', "#livetablePager", {
           edit : false,
           add : false,
           del : false,
           search:false
           
       });
   }
});
        
jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;process&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;881686cc-1bfc-456e-b8ab-71334c4a45e5&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){

	$(function () {
		function drawLineChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerline' + container).highcharts({

				chart: {
					type:'line'
				},
				title: {
					text: chart_name
				},
				tooltip :{
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				xAxis: dataXAxis ,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				series: dataSeries
			});
		};

		function drawBarChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerbar' + container).highcharts({
				chart: {
					type: 'column'
				},
				title: {
					text: chart_name
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {

					column: {
						pointPadding: 0.2,
						borderWidth: 0
					}
				},
				series: dataSeries
			});
		}

		function drawAreaChart(xAxis, series, container, data_detail, chart_name){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail
			$('#containerarea' + container).highcharts({
				chart: {
					type: 'area'
				},
				title: {
					text: chart_name
				},
				subtitle: {
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					},
					labels: {
						formatter: function() {
							return this.value / 1000;
						}
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {
					area: {
						stacking: 'normal',
						lineColor: '#666666',
						lineWidth: 1,
						marker: {
							lineWidth: 1,
							lineColor: '#666666'
						}
					}
				},
				series: dataSeries
			});
		};

		function drawPieChart(data, container, chartName){
			var dataPie = data
			$(document).ready(function () {
				// Build the chart
				$('#container' + container).highcharts({
					chart: {
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: chartName
					},
					tooltip: {
						pointFormat: '{series.name}: &amp;lt;b&amp;gt;{point.percentage:.1f}%&amp;lt;/b&amp;gt;'
					},
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							dataLabels: {
								enabled: true,
                                                                color: '#000000',
                                                                connectorColor: '#000000',
                                                                format: '&amp;lt;b&amp;gt;{point.name}&amp;lt;/b&amp;gt;: {point.percentage:.1f} %'
							},
							showInLegend: true
						}
					},
					series: dataPie
				});
			});
		}

		// LINE
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonline_" + finalKey).val());
					var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerline_" + finalKey).val());
				        var lstContainer = [];
  				        var data_all = [];
                                        var chartSize = arrayAll.length

                                        for(var i=0;i&amp;lt;chartSize ;i++){
                                           data_all = arrayAll[i]
                                           lstContainer = arrayContainerAll[i]
				           if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					        // data to display on tooltip
					        var data_detail = data_all[0]
					        // draw Line chart
				        	for(var j=0;j&amp;lt;data_all.length;j++){
				        		if(data_all[j].series[0].name == null){
				        			data_all[j].series[0].name = lstContainer[j]
					        	}
                                                        chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					        	drawLineChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					        }
				         }
                                  }
				}
			} else {
				var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonline").val());
				var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerline").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length

                                for(var i=0;i&amp;lt;chartSize ;i++){
                                   data_all = arrayAll[i]
                                   lstContainer = arrayContainerAll[i]
				   if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Line chart
					for(var j=0;j&amp;lt;data_all.length;j++){
						if(data_all[j].series[0].name == null){
							data_all[j].series[0].name = lstContainer[j]
						}
                                                chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
						drawLineChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
				   }
                                }
			}
		});

		// BAR
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonbar_" + finalKey).val());
					var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerbar_" + finalKey).val());
					var lstContainer = [];
					var data_all = [];
                                        var chartSize = arrayAll.length
					for(var i=0;i&amp;lt;chartSize ;i++){
					    data_all = arrayAll[i]
					    lstContainer = arrayContainerAll[i]
					    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw bar chart
						for(var j=0;j&amp;lt;data_all.length;j++){
							if(data_all[j].series[0].name == null){
								data_all[j].series[0].name = lstContainer[j]
							}
                                                        chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
							drawBarChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
						}
                                            }
					}
				}
			} else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonbar").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerbar").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
				    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Bar chart
					for(var j=0;j&amp;lt;data_all.length;j++){
                                            if(data_all[j].series[0].name == null){
						data_all[j].series[0].name = lstContainer[j]
					    }
                                            chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					    drawBarChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
                                    }
				}
			}
		});

		// AREA
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
                        var arrayAll
                        var arrayContainerAll
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                        if(($("#jsons&amp;gt;#jsonarea_" + finalKey)).length &amp;gt; 0) {
                                           arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonarea_" + finalKey).val());
                                           arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerarea_" + finalKey).val());
					   var lstContainer = [];
					   var data_all = [];
                                           var chartSize = arrayAll.length
					   for(var i=0;i&amp;lt;chartSize ;i++){
					       data_all = arrayAll[i]
					       lstContainer = arrayContainerAll[i]
					       if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						   // data to display on tooltip
						   var data_detail = data_all[0]
						   // draw Line chart
						   for(var j=0;j&amp;lt;data_all.length;j++){
						      if(data_all[j].series[0].name == null){
						         data_all[j].series[0].name = lstContainer[j]
						       }
                                                       chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
						       drawAreaChart(data_all[j].xAxis, data_all[j].series, finalKey + "_" + i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
						   }
					      }
				           }
                                        }
			          }
                        } else {
                                var arrayAll = jQuery.parseJSON($("#jsons&amp;gt;.jsonarea").val());
                                var arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerarea").val());
				var lstContainer = [];
				var data_all = [];
                                var chartSize = arrayAll.length
				for(var i=0;i&amp;lt;chartSize ;i++){
				    data_all = arrayAll[i]
                                    lstContainer = arrayContainerAll[i]
				    if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw area chart
					for(var j=0;j&amp;lt;data_all.length;j++){
                                            if(data_all[j].series[0].name == null){
						data_all[j].series[0].name = lstContainer[j]
					    }
                                            chartName = data_all[j].chart_name + " ( " + data_all[j].chart_columns[j] + " )"
					    drawAreaChart(data_all[j].xAxis, data_all[j].series, i + "_" + lstContainer[j], data_all[j].detail_data, chartName)
					}
                                    }
				}
			}
		});

		// PIE
		$(document ).ready(function(){
                        var lstKey = jQuery.parseJSON($("#lstkey").val())
                        var chartName
                        var arrayAll
                        var arrayContainerAll
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
                                        if(($("#jsons&amp;gt;#jsonpie_" + finalKey)).length &amp;gt; 0) {
                                           arrayAll = jQuery.parseJSON($("#jsons&amp;gt;#jsonpie_" + finalKey).val());
                                           arrayContainerAll = jQuery.parseJSON($("#jsons&amp;gt;.lstcontainerpie_" + finalKey).val());
					   var lstContainer = [];
					   var data_all = [];
                                           var chartSize = arrayAll.length
					  for(var i=0;i&amp;lt;chartSize ;i++){
					       data_all = arrayAll[i]
console.log(data_all)
					       lstContainer = arrayContainerAll[i]
					       if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						   // draw Pie chart
						   for(var j=0;j&amp;lt;data_all.length;j++){
                                                       //chartName = data_all[j].chart_name
                                                       chartName  = data_all[j].name
						       drawPieChart(data_all, finalKey + "_" + lstContainer[j], chartName)
						   }
					      }
				           }
                                        }
			          }
			} else {
				var array = $("#jsons&amp;gt;.jsonpie");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerpie");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					// draw Pie Chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						var finalData = []
						finalData[0] = data_all[0][i]
						drawPieChart(finalData, lstContainer[0][i])
					}
				}
			}
		});
	});
	jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;d5873d92-b78b-42fc-9407-46d166204b88&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;/* css for timepicker */
.ui-timepicker-div .ui-widget-header { 
margin-bottom: 8px;
 }

.ui-timepicker-div dl { text-align: left; }
.ui-timepicker-div dl dt { height: 25px; margin-bottom: -25px; }
.ui-timepicker-div dl dd { margin: 0 10px 10px 65px; }
.ui-timepicker-div td { font-size: 90%; }
.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }

.ui-timepicker-rtl{ direction: rtl; }
.ui-timepicker-rtl dl { text-align: right; }
.ui-timepicker-rtl dl dd { margin: 0 65px 10px 10px; }
#ui-datepicker-div{
 position:relative;
 width:auto;
 height:auto
}
&lt;/code&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;datetimepicker -css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;1201fb1a-e9c1-4731-8c74-2ea8c0071959&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;.displayblock {
  border:2px solid;
  -webkit-border-radius:6px;
  background:gray;
  float: left;
  width:100%;
}

.displaypie {
  border:1px solid;
  -webkit-border-radius:6px;
  background:gray;
  width: 48%;
  float: left; 
  height: 300px;
}

.subtype {
  margin-top: 50px;
  font-size: 2em;
  color: red;
}&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;content&gt;{{include document="Lib.DataToDrawChart"/}}
{{include document="Lib.MongoDBConnection"/}}
{{velocity}}
$xwiki.jsx.use('Lib.JQueryUILib')
$xwiki.ssx.use('Lib.MenuGenerator')
$xwiki.jsx.use('Lib.MenuGenerator')
$xwiki.ssx.use('Lib.JQueryUILib')
$xwiki.jsx.use('Lib.JqGridLib')
$xwiki.ssx.use('Lib.JqGridLib') 
{{/velocity}}
{{include document="Lib.MenuGenerator"/}}
{{html wiki="true" clean="false"}}
&amp;lt;div id="viewer"&amp;gt;
&amp;lt;table style="text-align:left"  &amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th &amp;gt;Job name&amp;lt;/th&amp;gt;
  &amp;lt;td colspan=3&amp;gt;&amp;lt;div id="jobname"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
{{groovy}}
import org.xwiki.context.*

def ec = services.component.getInstance(Execution.class).getContext()
def mapJobIstIid = ec.getProperty("mapJobIstIid")

println '{{html clean="false" wiki="false"}}'
println '&amp;lt;tr&amp;gt;'
println '&amp;lt;th&amp;gt;IstIid&amp;lt;/th&amp;gt;'
println '&amp;lt;td colspan=3&amp;gt;'
mapJobIstIid.each{jobEntry-&amp;gt;
  def convertedJobKey = jobEntry.key.replaceAll("\\.","_")
  println "&amp;lt;div id='listIstIid'&amp;gt;"
  println "&amp;lt;div id=IstIid${convertedJobKey} style='display:none'&amp;gt;"
  println "&amp;lt;select id=select_${convertedJobKey}&amp;gt;"
  jobEntry.value.each{
     println "&amp;lt;option value=\"$it\"&amp;gt;$it&amp;lt;/option&amp;gt;"
  }
  println "&amp;lt;/select&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
}
println '&amp;lt;/td&amp;gt;'
println '&amp;lt;/tr&amp;gt;'
println '{{/html}}'
{{/groovy}}
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data monitor from&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="from-date" id="from-date"/&amp;gt;&amp;lt;/td&amp;gt;
  &amp;lt;th&amp;gt;Data monitor to&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="to-date" id="to-date"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data records limit &amp;lt;/th&amp;gt;
  &amp;lt;td &amp;gt;
     &amp;lt;select id="limit"&amp;gt;
       &amp;lt;option value=5&amp;gt;5&amp;lt;/option&amp;gt;
       &amp;lt;option value=10&amp;gt;10&amp;lt;/option&amp;gt;
       &amp;lt;option value=15&amp;gt;15&amp;lt;/option&amp;gt;
       &amp;lt;option value=20&amp;gt;20&amp;lt;/option&amp;gt;
     &amp;lt;/select&amp;gt;
  &amp;lt;/td&amp;gt;
  &amp;lt;td colspan=3 &amp;gt;&amp;lt;input type="button" value="View Data" id="get-data" class="button"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;&amp;lt;div id="display"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
  &amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
&amp;lt;/table&amp;gt;

&amp;lt;/div&amp;gt; 
   
 &amp;lt;/body&amp;gt;

{{/html}}
{{groovy}}
import groovy.json.*
xwiki.jsx.use("Lib.Highcharts")

if(request.xpage == "plain") {
	response.setContentType('text/plain')
}

def listData = []
def job = request.get("job")
def fromDate = request.get("fromDate")
def toDate = request.get("toDate")
def limit= (request.get("limit")!=null)?request.get("limit").toInteger():10
def istIid = request.get("IstIid")

def str= "No data to retrieved !"
def result = null
if(job != "" &amp;amp;&amp;amp; job != null &amp;amp;&amp;amp; istIid != null &amp;amp;&amp;amp; istIid != ""){
	MongoDBConnection.getConnection()
	if(fromDate != "" || toDate != ""){
		result = MongoDBConnection.getDataInPeriod(job,fromDate,toDate,limit,istIid)
	} else {
		result = MongoDBConnection.getDataAllFields(job,limit,istIid)
        }
MongoDBConnection.closeConnection()
} else {
   println "{{warning}}There are no selected job or IstIid{{/warning}}"
}
def listKey = []
if( (result != null) &amp;amp;&amp;amp; (result.size() &amp;gt; 0) &amp;amp;&amp;amp; (result[0].KEYEXPR != null)&amp;amp;&amp;amp;!(result[0].KEYEXPR instanceof List )){

if(result[0].type == "Subtyped") {
    println '{{html clean="false" wiki="true"}}'
    //println '&amp;lt;body&amp;gt;'
    def dataSubtype = DataToDrawChart.getDataToDrawSubtype(result)
    dataSubtype.each {key,value -&amp;gt;
        listKey.add(key)
    }
    def jsonkey = com.mongodb.util.JSON.serialize(listKey)
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$jsonkey&amp;lt;/textarea&amp;gt;"

    dataSubtype.each {key,value -&amp;gt;
            def dataLine = []
            def dataBar = []
            def dataPie = []
            def dataArea = []
            if(DataToDrawChart.getDataToDrawLine(value) != []) {
                dataLine = DataToDrawChart.getDataToDrawLine(value)
            }
            if(DataToDrawChart.getDataToDrawBar(value) != []) {
                dataBar = DataToDrawChart.getDataToDrawBar(value)
            }
            if(DataToDrawChart.getDataToDrawPie(value) != []) {
                dataPie = DataToDrawChart.getDataToDrawPie(value)
            }
            if(DataToDrawChart.getDataToDrawArea(value) != []) {
                dataArea = DataToDrawChart.getDataToDrawArea(value)
            }

		def chartColumnsLine = []
		def chartColumnsBar = []
		def chartColumnsArea = []
		def lstName

                dataLine.each {itemDataLine -&amp;gt;
                    if(itemDataLine.size() &amp;gt; 0 ){
		        chartColumnsLine.add(itemDataLine[0].chart_columns)
	            }
                }
                dataBar.each {itemDataBar -&amp;gt;
                    if(itemDataBar.size() &amp;gt; 0 ){
		        chartColumnsBar.add(itemDataBar[0].chart_columns)
	            }
                }
                dataArea.each {itemDataArea -&amp;gt;
                    if(itemDataArea.size() &amp;gt; 0 ){
		        chartColumnsArea.add(itemDataArea[0].chart_columns)
	            }
                }
		if(dataPie.size() &amp;gt; 0 ){
			lstName = dataPie['name']
		}
		def tmpListNameContainer = []
                
		if(lstName != null) {
                        def chartNumPie = 0
                        def tmpLst
                        for(def nameContainer in lstName){
                           tmpLst = []
			   for(def nameContainerItem in nameContainer ){
				nameContainerItem = chartNumPie + "_" + nameContainerItem.replaceAll("\\.", "_")
                                //nameContainerItem = nameContainerItem.replaceAll("\\.", "_")
				tmpLst.add(nameContainerItem )
		            }
                            tmpListNameContainer.add(tmpLst)
                            chartNumPie++
                         }
		}
		def jsonPie
		def jsonLine
		def jsonBar
		def jsonArea
		if(dataPie != []) {
		    jsonPie = com.mongodb.util.JSON.serialize(dataPie)
		}
		if(dataLine != []) {
		    jsonLine = com.mongodb.util.JSON.serialize(dataLine)
		}
		if(dataBar != []) {
		    jsonBar = com.mongodb.util.JSON.serialize(dataBar)
		}
		if(dataArea != []) {
		    jsonArea = com.mongodb.util.JSON.serialize(dataArea)
		}
		def jsonContainerPie
		if(tmpListNameContainer != []) {
			jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
		}
		def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
		def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
		def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

		println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
		if(jsonLine != null) {
			println "&amp;lt;textarea id=\"jsonline_$key\" &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class=\"lstcontainerline_$key\" &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
		}
		if(jsonBar != null) {
			println "&amp;lt;textarea id=\"jsonbar_$key\"&amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerbar_$key' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
		}
		if(jsonPie != null &amp;amp;&amp;amp; jsonContainerPie != null) {
			println "&amp;lt;textarea id=\"jsonpie_$key\" &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerpie_$key' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
		}
		if(jsonArea != null) {
			println "&amp;lt;textarea id=\"jsonarea_$key\" &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"
			println "&amp;lt;textarea class='lstcontainerarea_$key' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
		}

        println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
        println "&amp;lt;input style=\"display:none\" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;"
        println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
        println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'
        println "&amp;lt;/div&amp;gt;"
          
        def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
        def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
          
        println "&amp;lt;div style='clear:both'&amp;gt;"
            def description = value.KEYEXPR._description[0][key]
            if(description != null) {
                println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +': ' + description +'&amp;lt;/div&amp;gt;'
            } else {
                println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +'&amp;lt;/div&amp;gt;'
            }
            println "-----"
            if(jsonPie != null) {
          println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
		chartNumPie = 0
          lstName.each{chartPieLst -&amp;gt;
		chartPieLst.each {
	            def tmp = chartNumPie + "_" + it.replaceAll("\\.", "_")
		    println " &amp;lt;div class=\"displaypie\" id=\"container${key}_${tmp}\" &amp;gt;&amp;lt;/div&amp;gt;"
          	}
		chartNumPie++
	  }	
          println "&amp;lt;/div&amp;gt;"
            }
            if(jsonLine != null) {
          	def chartLineComment = false
		def chartNumLine = 0
          	chartColumnsLine.each{chartColumnsLineItem -&amp;gt;
            		if(!chartLineComment){
               			println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
               			chartLineComment = true  
            		}
		chartColumnsLineItem.each{
              		println " &amp;lt;div class=\"displayblock\" id=\"containerline${key}_${chartNumLine}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          	}
		chartNumLine ++
	    }
          println "&amp;lt;/div&amp;gt;"
            }
            println "&amp;amp;nbsp;"

            if(jsonBar != null) {
          	def chartBarComment = false
  		def chartNumBar = 0
          	chartColumnsBar.each{chartColumnsBarItem -&amp;gt;
             		if(!chartBarComment){
                		println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
                		chartBarComment = true
              		}  
			chartColumnsBarItem.each{
             			println " &amp;lt;div class=\"displayblock\" id=\"containerbar${key}_${chartNumBar}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          		}
			chartNumBar++
		}
          	println "&amp;lt;/div&amp;gt;"
            }
            println "&amp;amp;nbsp;"

            if(jsonArea != null) {
          	def chartAreaComment = false
		def chartNumArea = 0
          	chartColumnsArea.each{chartColumnsAreaItem -&amp;gt;
          		if(!chartAreaComment){
            			println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
            			chartAreaComment = true
          		}
			chartColumnsAreaItem.each{
            			println " &amp;lt;div class=\"displayblock\" id=\"containerarea${key}_${chartNumArea}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          		}
          		chartNumArea++
            	}
        	println "&amp;lt;/div&amp;gt;"
	    }
        /** Statistic data table **/
        println "&amp;lt;center&amp;gt;"        
        println "&amp;lt;div id='livetblContent_"+key+"' style='width:100%;clear:both;align:middle;margin-top:10px'&amp;gt;"   
        println "Statistics data for "+key
        println "&amp;lt;table id='livetableList_"+key+"' style='width:100%;align:center'&amp;gt;&amp;lt;/table&amp;gt;"
        println "&amp;lt;div id='livetablePager_"+key+"' style='position:relative;width:100%'&amp;gt;&amp;lt;/div&amp;gt;"
        println "&amp;lt;/div&amp;gt;"
        println "&amp;lt;/center&amp;gt;"
        println "&amp;lt;script language='javascript'&amp;gt;console.log('Create live table for "+key+"');&amp;lt;/script&amp;gt;"
    }
    //println '&amp;lt;/body&amp;gt;'
    println '{{/html}}'
} else if(result[0].type == "Store") {
	// data store
	def dataLine = DataToDrawChart.getDataToDrawLine(result)
	def dataBar = DataToDrawChart.getDataToDrawBar(result)
	def dataPie = DataToDrawChart.getDataToDrawPie(result)
	def dataArea = DataToDrawChart.getDataToDrawArea(result)
	def chartColumnsLine = []
	def chartColumnsBar = []
	def chartColumnsArea = []
	def lstName

        dataLine.each {itemDataLine -&amp;gt;
            if(itemDataLine.size() &amp;gt; 0 ){
		chartColumnsLine.add(itemDataLine[0].chart_columns)
	    }
        }

        dataBar.each {itemDataBar -&amp;gt;
            if(itemDataBar.size() &amp;gt; 0 ){
		chartColumnsBar.add(itemDataBar[0].chart_columns)
	    }
        }

        dataArea.each {itemDataArea -&amp;gt;
            if(itemDataArea.size() &amp;gt; 0 ){
		chartColumnsArea.add(itemDataArea[0].chart_columns)
	    }
        }

	if(dataPie.size() &amp;gt; 0 ){
		lstName = dataPie['name']
	}

    println '{{html clean="false" wiki="true"}}'
    //println '&amp;lt;body&amp;gt;'
  
    def tmpListNameContainer = []
    for(def nameContainer in lstName){
       nameContainer = nameContainer.replaceAll("\\.", "_")
       tmpListNameContainer.add(nameContainer)
    }
  
    def jsonPie = com.mongodb.util.JSON.serialize(dataPie)
    def jsonLine = com.mongodb.util.JSON.serialize(dataLine)
    def jsonBar = com.mongodb.util.JSON.serialize(dataBar)
    def jsonArea = com.mongodb.util.JSON.serialize(dataArea)

    def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
    def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
    def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
    def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

    def listEmpty = com.mongodb.util.JSON.serialize([])
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$listEmpty&amp;lt;/textarea&amp;gt;" 

    println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'

    println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
    println "&amp;lt;textarea class='jsonline' &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonbar' &amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonpie' &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonarea' &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"

    println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
  
    def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
    def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
  
    println "&amp;lt;div style='clear:both'&amp;gt;"
  
    def chartPieComment = false
    lstName.each{
        if(!chartPieComment) {
            println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
            chartPieComment = true
        }
        def tmp = it.replaceAll("\\.", "_")
        println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    	def chartLineComment = false
	def chartNum = 0
    	chartColumnsLine.each{chartColumnsLineItem -&amp;gt;
	    	if(!chartLineComment){
	        	println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	        	chartLineComment = true  
	    	}
		chartColumnsLineItem.each{
	    		println " &amp;lt;div class=\"displayblock\" id=\"containerline${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	    	}
		chartNum++
	}	
    	println "&amp;lt;/div&amp;gt;"
    	println "&amp;amp;nbsp;"
    	def chartBarComment = false
	chartNum = 0
    	chartColumnsBar.each{chartColumnsBarItem -&amp;gt;
	        if(!chartBarComment){
	            println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	            chartBarComment = true
	        }  
		chartColumnsBarItem.each{
	    		println " &amp;lt;div class=\"displayblock\" id=\"containerbar${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  	}
		chartNum++
	}
  println "&amp;lt;/div&amp;gt;"
  println "&amp;amp;nbsp;"
  	def chartAreaComment = false
	chartNum = 0
  	chartColumnsArea.each{chartColumnsAreaItem -&amp;gt;
	  	if(!chartAreaComment){
	    		println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	    		chartAreaComment = true
	  	}
		chartColumnsAreaItem.each{
    			println " &amp;lt;div class=\"displayblock\" id=\"containerarea${chartNum}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
		}
		chartNum++
  	}
  println "&amp;lt;/div&amp;gt;"
println "&amp;lt;/div&amp;gt;"

//println '&amp;lt;/body&amp;gt;'
println '{{/html}}'
}
}else{
    println 'There is no data for this job with criterias'
}
//--=============== Start build for livetable
def subTypeURLMap = [:]
def dataModel = []
def dataUrl = ""
result.find{rec-&amp;gt;				
    def subtractData = []
    
    //-- Parsing data and assign data to subtract list
    if(rec.type == "Store"){ //-- Store data type
        subtractData = rec['data']        
        subtractData.each{r2-&amp;gt;					
            if(dataModel != null &amp;amp;&amp;amp; dataModel.size() &amp;lt;=0){ 
                dataModel.add("Fetch At")
                dataModel.addAll(r2.keySet());					
            } 
        }        
        dataUrl = "/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job="+job +"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate + "&amp;amp;toDate=" + toDate + "&amp;amp;istIid="+istIid        
        //-- Building data model				
        def model = []
        def colSpec
        dataModel.each{name-&amp;gt;
            colSpec = [:]
            colSpec['name'] = name
            colSpec['index'] = name
            colSpec['width'] = "100"
            model.add(colSpec)
        }
        def dataModelStr = (new JsonBuilder(dataModel)).toPrettyString()
        def modelStr = (new JsonBuilder(model)).toPrettyString() 
        str = 
        "{\"url\":\""+dataUrl+"\",\"datatype\":\"json\","+
            "\"colNames\":"+ dataModelStr +
            ",\"colModel\":"+ modelStr +" ,\"rowList\":[10,20,30],"+
            "\"pager\":\"#livetablePager\", \"viewrecords\": true, \"sortname\": \"RECORD_SEQ\","+
            "\"sortorder\": \"asc\", \"caption\":\""+job+"\"}"
        println "{{html clean=\"false\" wiki=\"true\"}}"
        println "&amp;lt;div id='livetableJson' style = \"display:none\"&amp;gt;"
        //println "&amp;lt;div id='livetableJson'&amp;gt;"
        println str;
        println "&amp;lt;/div&amp;gt;"
        println "{{/html}}"
    }else{ //-- Subtype			
        def subData = rec['data']
        subData.each{key,value-&amp;gt;
            dataUrl = "/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job="+job +"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate + "&amp;amp;toDate=" + toDate + "&amp;amp;istIid="+istIid+"&amp;amp;subType="+key
            subtractData = value
            subtractData.each{r2-&amp;gt;					
                if(dataModel != null &amp;amp;&amp;amp; dataModel.size() &amp;lt;=0){ 
                    dataModel.add("Fetch At")
                    dataModel.addAll(r2.keySet());					
                } 			
            }
            //-- Building data model				
            def model = []
            def colSpec
            dataModel.each{name-&amp;gt;
                colSpec = [:]
                colSpec['name'] = name
                colSpec['index'] = name
                colSpec['width'] = "100"
                model.add(colSpec)
            }
            def dataModelStr = (new JsonBuilder(dataModel)).toPrettyString()
            def modelStr = (new JsonBuilder(model)).toPrettyString() 
            str = 
            "{\"url\":\""+dataUrl+"\",\"datatype\":\"json\","+
                "\"colNames\":"+ dataModelStr +
                ",\"colModel\":"+ modelStr +" ,\"rowList\":[10,20,30],"+
                "\"pager\":\"#livetablePager\", \"viewrecords\": true, \"sortname\": \"RECORD_SEQ\","+
                "\"sortorder\": \"asc\", \"caption\":\""+job+"\"}"
            subTypeURLMap[key] = str
        }
        def finalStr = (new JsonBuilder(subTypeURLMap)).toPrettyString()
        println "{{html clean=\"false\" wiki=\"true\"}}"
        println "&amp;lt;div id='livetableJson' style = \"display:none\"&amp;gt;"
        //println "&amp;lt;div id='livetableJson'&amp;gt;"
        println finalStr;
        println "&amp;lt;/div&amp;gt;"
        println "{{/html}}"
    }
    return true
}
 //--=============== END

if(listKey.size() &amp;lt;= 0){   
    println "{{html clean=\"false\" wiki=\"true\"}}"
    println "&amp;lt;center&amp;gt;"
    println "&amp;lt;div id=\"livetblContent\" style=\"width:100%;clear:both;align:middle;margin-top:10px\"&amp;gt;"   
    println "Statistics Data"
    println "&amp;lt;table id=\"livetableList\" style=\"width:100%;align:center\"&amp;gt;&amp;lt;/table&amp;gt;"    
    println "&amp;lt;div id=\"livetablePager\"&amp;gt;&amp;lt;/div&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
    println "&amp;lt;/center&amp;gt;"
    
    println "&amp;lt;div id=\"testDiv\"&amp;gt;&amp;amp;nbsp;&amp;lt;/div&amp;gt;"
    println "{{/html}}"
}
{{/groovy}}
&lt;/content&gt;&lt;/xwikidoc&gt;@


61.2
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376550640000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;61.2&lt;/version&gt;
d2556 5
a2560 5
$(function () {
    function drawLineChart(xAxis, series, container, data_detail){
        var dataXAxis = xAxis
        var dataSeries = series
        var detail = data_detail
d2568 1
a2568 1
					text: container
d2603 1
a2603 1
		function drawBarChart(xAxis, series, container, data_detail){
d2613 1
a2613 1
					text: container
d2655 1
a2655 1
		function drawAreaChart(xAxis, series, container, data_detail){
d2664 1
a2664 1
					text: container
d2717 1
a2717 1
		function drawPieChart(data, container){
d2728 1
a2728 1
						text: dataPie[0].name
d2738 4
a2741 1
								enabled: false
d2754 1
d2758 22
a2779 19
					var array = $("#jsons&amp;gt;#jsonline_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
d2782 2
a2783 2
				var array = $("#jsons&amp;gt;.jsonline");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
d2786 6
a2791 5
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
d2795 3
a2797 3
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						if(data_all[0][i].series[0].name == null){
							data_all[0][i].series[0].name = lstContainer[0][i]
d2799 2
a2800 1
						drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
d2802 2
a2803 1
				}
d2810 1
d2814 2
a2815 2
					var array = $("#jsons&amp;gt;#jsonbar_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
d2818 5
a2822 5
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
d2825 4
a2828 4
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
d2830 2
a2831 1
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
d2833 1
d2837 2
a2838 2
				var array = $("#jsons&amp;gt;.jsonbar");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
d2841 5
a2845 5
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
d2849 6
a2854 2
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						drawBarChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
d2856 1
d2864 3
d2870 43
a2912 7
					var array = $("#jsons&amp;gt;#jsonarea_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
d2914 1
a2914 11
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
d2916 33
d2950 2
a2951 2
				var array = $("#jsons&amp;gt;.jsonarea");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
d2958 8
a2965 5
				// data to display on tooltip
				var data_detail = data_all[0]
				// draw Area Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					drawAreaChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
a2968 23

		// PIE
		$("#piechart").ready(function(){

			var array = $("#jsons&amp;gt;.jsonpie");
			var arrayContainer = $("#jsons&amp;gt;.lstcontainerpie");
			var lstContainer = [];
			var data_all = [];
			for(var i=0;i&amp;lt;array.length;i++){
				data_all[i] = jQuery.parseJSON(array[i].value)
				lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)

			}
			if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
				// data to display on tooltip
				// draw Pie Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					var finalData = []
					finalData[0] = data_all[0][i]
					drawPieChart(finalData, lstContainer[0][i])
				}
			}
		});
@


61.1
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376475545000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376474745000&lt;/contentUpdateDate&gt;
&lt;version&gt;61.1&lt;/version&gt;
d21 1
a21 1
&lt;minorEdit&gt;false&lt;/minorEdit&gt;
d3275 4
a3278 16
            def chartColumnsLine
            def chartColumnsBar 
            def chartColumnsArea 
            def lstName
            if(dataLine.size() &amp;gt; 0 ){
                chartColumnsLine = dataLine[0].chart_columns
            }
            if(dataBar.size() &amp;gt; 0){
                chartColumnsBar = dataBar[0].chart_columns
            }
            if(dataArea.size() &amp;gt; 0 ){
                chartColumnsArea = dataArea[0].chart_columns
            }
            if(dataPie.size() &amp;gt; 0 ){
                lstName = dataPie['name']
            }
d3280 57
a3336 21
            def tmpListNameContainer = []
        for(def nameContainer in lstName){
           nameContainer = nameContainer.replaceAll("\\.", "_")
           tmpListNameContainer.add(nameContainer)
        }
            def jsonPie
            def jsonLine
            def jsonBar
            def jsonArea
            if(dataPie != []) {
            jsonPie = com.mongodb.util.JSON.serialize(dataPie)
            }
            if(dataLine != []) {
            jsonLine = com.mongodb.util.JSON.serialize(dataLine)
            }
            if(dataBar != []) {
                jsonBar = com.mongodb.util.JSON.serialize(dataBar)
            }
            if(dataArea != []) {
            jsonArea = com.mongodb.util.JSON.serialize(dataArea)
            }
d3338 17
a3354 4
        def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
        def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
        def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
        def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)
a3355 18
        println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
            if(jsonLine != null) {
            println "&amp;lt;textarea id=\"jsonline_$key\" &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
                println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;" 
            }
        if(jsonBar != null) {
                println "&amp;lt;textarea id=\"jsonbar_$key\"&amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
            }
            if(jsonPie != null) {
            println "&amp;lt;textarea id=\"jsonpie_$key\" &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
                println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
            }
            if(jsonArea != null) {
            println "&amp;lt;textarea id=\"jsonarea_$key\" &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
            }

d3375 8
a3382 4
          lstName.each{
            def tmp = it.replaceAll("\\.", "_")
            println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
          }
d3386 12
a3397 9
          def chartLineComment = false
          chartColumnsLine.each{
            if(!chartLineComment){
               println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
               chartLineComment = true  
            }

              println " &amp;lt;div class=\"displayblock\" id=\"containerline${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          }
d3403 13
a3415 10
          def chartBarComment = false
          chartColumnsBar.each{
             if(!chartBarComment){
                println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
                chartBarComment = true
              }  

             println " &amp;lt;div class=\"displayblock\" id=\"containerbar${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          }
          println "&amp;lt;/div&amp;gt;"
d3417 1
a3417 1
        println "&amp;amp;nbsp;"
d3420 14
a3433 11
          def chartAreaComment = false
          chartColumnsArea.each{
          if(!chartAreaComment){
            println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
            chartAreaComment = true
          }
            println " &amp;lt;div class=\"displayblock\" id=\"containerarea${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          }
          println "&amp;lt;/div&amp;gt;"
            }
        println "&amp;lt;/div&amp;gt;"
d3447 9
a3455 9
    // data store
    def dataLine = DataToDrawChart.getDataToDrawLine(result)
    def dataBar = DataToDrawChart.getDataToDrawBar(result)
    def dataPie = DataToDrawChart.getDataToDrawPie(result)
    def dataArea = DataToDrawChart.getDataToDrawArea(result)
    def chartColumnsLine 
    def chartColumnsBar 
    def chartColumnsArea 
    def lstName 
d3457 5
a3461 12
    if(dataLine.size() &amp;gt; 0 ){
        chartColumnsLine = dataLine[0].chart_columns
    }
    if(dataBar.size() &amp;gt; 0){
        chartColumnsBar = dataBar[0].chart_columns
    }
    if(dataArea.size() &amp;gt; 0 ){
        chartColumnsArea = dataArea[0].chart_columns
    }
    if(dataPie.size() &amp;gt; 0 ){
        lstName = dataPie['name']
    }
d3463 16
d3533 26
a3558 20
    def chartLineComment = false
    chartColumnsLine.each{
    if(!chartLineComment){
        println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
        chartLineComment = true  
    }

    println " &amp;lt;div class=\"displayblock\" id=\"containerline$it\"&amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    println "&amp;amp;nbsp;"
    def chartBarComment = false
    chartColumnsBar.each{
        if(!chartBarComment){
            println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
            chartBarComment = true
        }  

    println " &amp;lt;div class=\"displayblock\" id=\"containerbar$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
d3561 12
a3572 8
  def chartAreaComment = false
  chartColumnsArea.each{
  if(!chartAreaComment){
    println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
    chartAreaComment = true
  }
    println " &amp;lt;div class=\"displayblock\" id=\"containerarea$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
@


60.1
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376475333000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;60.1&lt;/version&gt;
d2434 1
a2434 1
    var keyArr = keys.indexOf(',')? keys.split(','):new Array(keys);
@


59.1
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376474864000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;59.1&lt;/version&gt;
d2434 1
a2434 1
    var keyArr = keys.contains(',')? keys.split(','):new Array(keys);
@


58.1
log
@@
text
@&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xwikidoc&gt;
&lt;web&gt;WiperDog&lt;/web&gt;
&lt;name&gt;WebHome&lt;/name&gt;
&lt;language&gt;&lt;/language&gt;
&lt;defaultLanguage&gt;en&lt;/defaultLanguage&gt;
&lt;translation&gt;0&lt;/translation&gt;
&lt;parent&gt;&lt;/parent&gt;
&lt;creator&gt;XWiki.Admin&lt;/creator&gt;
&lt;author&gt;XWiki.Admin&lt;/author&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;contentAuthor&gt;XWiki.Admin&lt;/contentAuthor&gt;
&lt;creationDate&gt;1376364375000&lt;/creationDate&gt;
&lt;date&gt;1376474834000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376474745000&lt;/contentUpdateDate&gt;
&lt;version&gt;58.1&lt;/version&gt;
&lt;title&gt;WiperDog&lt;/title&gt;
&lt;defaultTemplate&gt;&lt;/defaultTemplate&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;comment&gt;&lt;/comment&gt;
&lt;minorEdit&gt;false&lt;/minorEdit&gt;
&lt;syntaxId&gt;xwiki/2.1&lt;/syntaxId&gt;
&lt;hidden&gt;false&lt;/hidden&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;047293a8-524d-45e4-af52-cd944523d5d0&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
/*
 * jQuery timepicker addon
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 1.3.1
 * Last Modified: 07/07/2013
 *
 * Copyright 2013 Trent Richardson
 * You may use this project under MIT or GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 */

/*jslint evil: true, white: false, undef: false, nomen: false */

(function($) {

	/*
	* Lets not redefine timepicker, Prevent "Uncaught RangeError: Maximum call stack size exceeded"
	*/
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return;
	}

	/*
	* Extend jQueryUI, get it started with our version number
	*/
	$.extend($.ui, {
		timepicker: {
			version: "1.3.1"
		}
	});

	/* 
	* Timepicker manager.
	* Use the singleton instance of this class, $.timepicker, to interact with the time picker.
	* Settings for (groups of) time pickers are maintained in an instance object,
	* allowing multiple different settings on the same page.
	*/
	var Timepicker = function() {
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[''] = { // Default regional settings
			currentText: 'Now',
			closeText: 'Done',
			amNames: ['AM', 'A'],
			pmNames: ['PM', 'P'],
			timeFormat: 'HH:mm',
			timeSuffix: '',
			timeOnlyTitle: 'Choose Time',
			timeText: 'Time',
			hourText: 'Hour',
			minuteText: 'Minute',
			secondText: 'Second',
			millisecText: 'Millisecond',
			microsecText: 'Microsecond',
			timezoneText: 'Time Zone',
			isRTL: false
		};
		this._defaults = { // Global defaults for all the datetime picker instances
			showButtonPanel: true,
			timeOnly: false,
			showHour: null,
			showMinute: null,
			showSecond: null,
			showMillisec: null,
			showMicrosec: null,
			showTimezone: null,
			showTime: true,
			stepHour: 1,
			stepMinute: 1,
			stepSecond: 1,
			stepMillisec: 1,
			stepMicrosec: 1,
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null,
			hourMin: 0,
			minuteMin: 0,
			secondMin: 0,
			millisecMin: 0,
			microsecMin: 0,
			hourMax: 23,
			minuteMax: 59,
			secondMax: 59,
			millisecMax: 999,
			microsecMax: 999,
			minDateTime: null,
			maxDateTime: null,
			onSelect: null,
			hourGrid: 0,
			minuteGrid: 0,
			secondGrid: 0,
			millisecGrid: 0,
			microsecGrid: 0,
			alwaysSetTime: true,
			separator: ' ',
			altFieldTimeOnly: true,
			altTimeFormat: null,
			altSeparator: null,
			altTimeSuffix: null,
			pickerTimeFormat: null,
			pickerTimeSuffix: null,
			showTimepicker: true,
			timezoneList: null,
			addSliderAccess: false,
			sliderAccessArgs: null,
			controlType: 'slider',
			defaultValue: null,
			parse: 'strict'
		};
		$.extend(this._defaults, this.regional['']);
	};

	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: '',
		formattedDate: '',
		formattedTime: '',
		formattedDateTime: '',
		timezoneList: null,
		units: ['hour','minute','second','millisec', 'microsec'],
		support: {},
		control: null,

		/* 
		* Override the default settings for all instances of the time picker.
		* @@param  settings  object - the new settings to use as defaults (anonymous object)
		* @@return the manager object
		*/
		setDefaults: function(settings) {
			extendRemove(this._defaults, settings || {});
			return this;
		},

		/*
		* Create a new Timepicker instance
		*/
		_newInst: function($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
            	fns = {},
		    	overrides, i;

			for (var attrName in this._defaults) {
				if(this._defaults.hasOwnProperty(attrName)){
					var attrValue = $input.attr('time:' + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue);
						} catch (err) {
							inlineSettings[attrName] = attrValue;
						}
					}
				}
			}

		    overrides = {
		        beforeShow: function (input, dp_inst) {
		            if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
		                return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst);
		            }
		        },
		        onChangeMonthYear: function (year, month, dp_inst) {
		            // Update the time as well : this prevents the time from disappearing from the $input field.
		            tp_inst._updateDateTime(dp_inst);
		            if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
		                tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst);
		            }
		        },
		        onClose: function (dateText, dp_inst) {
		            if (tp_inst.timeDefined === true &amp;amp;&amp;amp; $input.val() !== '') {
		                tp_inst._updateDateTime(dp_inst);
		            }
		            if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
		                tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst);
		            }
		        }
		    };
		    for (i in overrides) {
		        if (overrides.hasOwnProperty(i)) {
		            fns[i] = opts[i] || null;
		        }
		    }

		    tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
		        evnts:fns,
		        timepicker: tp_inst // add timepicker as a property of datepicker: $.datepicker._get(dp_inst, 'timepicker');
		    });
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function(val) {
				return val.toUpperCase();
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function(val) {
				return val.toUpperCase();
			});

			// detect which units are supported
			tp_inst.support = detectSupport(
					tp_inst._defaults.timeFormat + 
					(tp_inst._defaults.pickerTimeFormat? tp_inst._defaults.pickerTimeFormat:'') + 
					(tp_inst._defaults.altTimeFormat? tp_inst._defaults.altTimeFormat:''));

			// controlType is string - key to our this._controls
			if(typeof(tp_inst._defaults.controlType) === 'string'){
				if(tp_inst._defaults.controlType == 'slider' &amp;amp;&amp;amp; typeof(jQuery.ui.slider) === 'undefined'){
					tp_inst._defaults.controlType = 'select';
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType];
			}
			// controlType is an object and must implement create, options, value methods
			else{ 
				tp_inst.control = tp_inst._defaults.controlType;
			}

			// prep the timezone options
			var timezoneList = [-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,
					0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList;
			}
			var tzl=timezoneList.length,tzi=0,tzv=null;
			if (tzl &amp;gt; 0 &amp;amp;&amp;amp; typeof timezoneList[0] !== 'object') {
				for(; tzi&amp;lt;tzl; tzi++){
					tzv = timezoneList[tzi];
					timezoneList[tzi] = { value: tzv, label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601) };
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;

			// set the default units
			tp_inst.timezone = tp_inst._defaults.timezone !== null? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) : 
							((new Date()).getTimezoneOffset()*-1);
			tp_inst.hour = tp_inst._defaults.hour &amp;lt; tp_inst._defaults.hourMin? tp_inst._defaults.hourMin : 
							tp_inst._defaults.hour &amp;gt; tp_inst._defaults.hourMax? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute &amp;lt; tp_inst._defaults.minuteMin? tp_inst._defaults.minuteMin : 
							tp_inst._defaults.minute &amp;gt; tp_inst._defaults.minuteMax? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second &amp;lt; tp_inst._defaults.secondMin? tp_inst._defaults.secondMin : 
							tp_inst._defaults.second &amp;gt; tp_inst._defaults.secondMax? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec &amp;lt; tp_inst._defaults.millisecMin? tp_inst._defaults.millisecMin : 
							tp_inst._defaults.millisec &amp;gt; tp_inst._defaults.millisecMax? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec &amp;lt; tp_inst._defaults.microsecMin? tp_inst._defaults.microsecMin : 
							tp_inst._defaults.microsec &amp;gt; tp_inst._defaults.microsecMax? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = '';
			tp_inst.$input = $input;

			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField).css({
					cursor: 'pointer'
				}).focus(function() {
					$input.trigger("focus");
				});
			}

			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date();
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date();
			}

			// datepicker needs minDate/maxDate, timepicker needs minDateTime/maxDateTime..
			if (tp_inst._defaults.minDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime());
			}
			if (tp_inst._defaults.minDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime());
			}
			if (tp_inst._defaults.maxDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime());
			}
			if (tp_inst._defaults.maxDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime());
			}
			tp_inst.$input.bind('focus', function() {
				tp_inst._onFocus();
			});

			return tp_inst;
		},

		/*
		* add our sliders to the calendar
		*/
		_addTimePicker: function(dp_inst) {
			var currDT = (this.$altInput &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly) ? this.$input.val() + ' ' + this.$altInput.val() : this.$input.val();

			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
		},

		/*
		* parse the time string from input value or _setTime
		*/
		_parseTime: function(timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0]);
			}

			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, 'dateFormat');
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false;
					}
					$.extend(this, parseRes.timeObj);
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err +
									"\ndate/time string = " + timeString +
									"\ntimeFormat = " + this._defaults.timeFormat +
									"\ndateFormat = " + dp_dateFormat);
					return false;
				}
				return true;
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false;
				}
				$.extend(this, timeObj);
				return true;
			}
		},

		/*
		* generate and inject html for timepicker into ui datepicker
		*/
		_injectTimePicker: function() {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = '',
				uitem = '',
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i=0,
				l=0;

			// Prevent displaying twice
			if ($dp.find("div.ui-timepicker-div").length === 0 &amp;amp;&amp;amp; o.showTimepicker) {
				var noDisplay = ' style="display:none;"',
					html = '&amp;lt;div class="ui-timepicker-div'+ (o.isRTL? ' ui-timepicker-rtl' : '') +'"&amp;gt;&amp;lt;dl&amp;gt;' + '&amp;lt;dt class="ui_tpicker_time_label"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;' + o.timeText + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_time"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the markup
				for(i=0,l=this.units.length; i&amp;lt;l; i++){
					litem = this.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// Added by Peter Medeiros:
					// - Figure out what the hour/minute/second max should be based on the step values.
					// - Example: if stepMinute is 15, then minMax is 45.
					max[litem] = parseInt((o[litem+'Max'] - ((o[litem+'Max'] - o[litem+'Min']) % o['step'+uitem])), 10);
					gridSize[litem] = 0;

					html += '&amp;lt;dt class="ui_tpicker_'+ litem +'_label"' + (show ? '' : noDisplay) + '&amp;gt;' + o[litem +'Text'] + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_'+ litem +'"&amp;gt;&amp;lt;div class="ui_tpicker_'+ litem +'_slider"' + (show ? '' : noDisplay) + '&amp;gt;&amp;lt;/div&amp;gt;';

					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						html += '&amp;lt;div style="padding-left: 1px"&amp;gt;&amp;lt;table class="ui-tpicker-grid-label"&amp;gt;&amp;lt;tr&amp;gt;';

						if(litem == 'hour'){
							for (var h = o[litem+'Min']; h &amp;lt;= max[litem]; h += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm? 'hht':'HH', {hour:h}, o);									
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + tmph + '&amp;lt;/td&amp;gt;';
							}
						}
						else{
							for (var m = o[litem+'Min']; m &amp;lt;= max[litem]; m += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + ((m &amp;lt; 10) ? '0' : '') + m + '&amp;lt;/td&amp;gt;';
							}
						}

						html += '&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;&amp;lt;/div&amp;gt;';
					}
					html += '&amp;lt;/dd&amp;gt;';
				}
				
				// Timezone
				var showTz = o.showTimezone !== null? o.showTimezone : this.support.timezone;
				html += '&amp;lt;dt class="ui_tpicker_timezone_label"' + (showTz ? '' : noDisplay) + '&amp;gt;' + o.timezoneText + '&amp;lt;/dt&amp;gt;';
				html += '&amp;lt;dd class="ui_tpicker_timezone" ' + (showTz ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the elements from string
				html += '&amp;lt;/dl&amp;gt;&amp;lt;/div&amp;gt;';
				var $tp = $(html);

				// if we only want time picker...
				if (o.timeOnly === true) {
					$tp.prepend('&amp;lt;div class="ui-widget-header ui-helper-clearfix ui-corner-all"&amp;gt;' + '&amp;lt;div class="ui-datepicker-title"&amp;gt;' + o.timeOnlyTitle + '&amp;lt;/div&amp;gt;' + '&amp;lt;/div&amp;gt;');
					$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();
				}
				
				// add sliders, adjust grids, add events
				for(i=0,l=tp_inst.units.length; i&amp;lt;l; i++){
					litem = tp_inst.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// add the slider
					tp_inst[litem+'_slider'] = tp_inst.control.create(tp_inst, $tp.find('.ui_tpicker_'+litem+'_slider'), litem, tp_inst[litem], o[litem+'Min'], max[litem], o['step'+uitem]);

					// adjust the grid and add click event
					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						size = 100 * gridSize[litem] * o[litem+'Grid'] / (max[litem] - o[litem+'Min']);
						$tp.find('.ui_tpicker_'+litem+' table').css({
							width: size + "%",
							marginLeft: o.isRTL? '0' : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL? ((size / (-2 * gridSize[litem])) + "%") : '0',
							borderCollapse: 'collapse'
						}).find("td").click(function(e){
								var $t = $(this),
									h = $t.html(),
									n = parseInt(h.replace(/[^0-9]/g),10),
									ap = h.replace(/[^apm]/ig),
									f = $t.data('for'); // loses scope, so we use data-for

								if(f == 'hour'){
									if(ap.indexOf('p') !== -1 &amp;amp;&amp;amp; n &amp;lt; 12){
										n += 12;
									}
									else{
										if(ap.indexOf('a') !== -1 &amp;amp;&amp;amp; n === 12){
											n = 0;
										}
									}
								}
								
								tp_inst.control.value(tp_inst, tp_inst[f+'_slider'], litem, n);

								tp_inst._onTimeChange();
								tp_inst._onSelectHandler();
							}).css({
								cursor: 'pointer',
								width: (100 / gridSize[litem]) + '%',
								textAlign: 'center',
								overflow: 'hidden'
							});
					} // end if grid &amp;gt; 0
				} // end for loop

				// Add timezone options
				this.timezone_select = $tp.find('.ui_tpicker_timezone').append('&amp;lt;select&amp;gt;&amp;lt;/select&amp;gt;').find("select");
				$.fn.append.apply(this.timezone_select,
				$.map(o.timezoneList, function(val, idx) {
					return $("&amp;lt;option /&amp;gt;").val(typeof val == "object" ? val.value : val).text(typeof val == "object" ? val.label : val);
				}));
				if (typeof(this.timezone) != "undefined" &amp;amp;&amp;amp; this.timezone !== null &amp;amp;&amp;amp; this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset()*-1;
					if (local_timezone == this.timezone) {
						selectLocalTimezone(tp_inst);
					} else {
						this.timezone_select.val(this.timezone);
					}
				} else {
					if (typeof(this.hour) != "undefined" &amp;amp;&amp;amp; this.hour !== null &amp;amp;&amp;amp; this.hour !== "") {
						this.timezone_select.val(o.timezone);
					} else {
						selectLocalTimezone(tp_inst);
					}
				}
				this.timezone_select.change(function() {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
				});
				// End timezone options
				
				// inject timepicker into datepicker
				var $buttonPanel = $dp.find('.ui-datepicker-buttonpane');
				if ($buttonPanel.length) {
					$buttonPanel.before($tp);
				} else {
					$dp.append($tp);
				}

				this.$timeObj = $tp.find('.ui_tpicker_time');

				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined;
				}

				// slideAccess integration: http://trentrichardson.com/2011/11/11/jquery-ui-sliders-and-touch-accessibility/
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
						
					setTimeout(function() { // fix for inline mode
						if ($tp.find('.ui-slider-access').length === 0) {
							$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);

							// fix any grids since sliders are shorter
							var sliderAccessWidth = $tp.find('.ui-slider-access:eq(0)').outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find('table:visible').each(function() {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl? 'marginRight':'marginLeft').toString().replace('%', ''),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + '%',
										css = { width: newWidth, marginRight: 0, marginLeft: 0 };
									css[rtl? 'marginRight':'marginLeft'] = newMarginLeft;
									$g.css(css);
								});
							}
						}
					}, 10);
				}
				// end slideAccess integration

				tp_inst._limitMinMaxDateTime(this.inst, true);
			}
		},

		/*
		* This function tries to limit the ability to go outside the
		* min/max date range
		*/
		_limitMinMaxDateTime: function(dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);

			if (!this._defaults.showTimepicker) {
				return;
			} // No time so nothing to check here

			if ($.datepicker._get(dp_inst, 'minDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'minDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, 'minDateTime'),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin;
				}

				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour &amp;lt;= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute &amp;lt;= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second &amp;lt;= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if(this.millisec &amp;lt;= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;lt; this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin;
									}
									this._defaults.microsecMin = this.microsecMinOriginal;
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal;
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal;
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal;
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal;
				}
			}

			if ($.datepicker._get(dp_inst, 'maxDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'maxDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, 'maxDateTime'),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax;
				}

				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour &amp;gt;= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute &amp;gt;= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second &amp;gt;= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec &amp;gt;= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;gt; this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax;
									}
									this._defaults.microsecMax = this.microsecMaxOriginal;
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal;
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal;
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal;
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal;
				}
			}

			if (adjustSliders !== undefined &amp;amp;&amp;amp; adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10);
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);

				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, 'hour', { min: this._defaults.hourMin, max: hourMax });
					this.control.value(this, this.hour_slider, 'hour', this.hour - (this.hour % this._defaults.stepHour));
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, 'minute', { min: this._defaults.minuteMin, max: minMax });
					this.control.value(this, this.minute_slider, 'minute', this.minute - (this.minute % this._defaults.stepMinute));
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, 'second', { min: this._defaults.secondMin, max: secMax });
					this.control.value(this, this.second_slider, 'second', this.second - (this.second % this._defaults.stepSecond));
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, 'millisec', { min: this._defaults.millisecMin, max: millisecMax });
					this.control.value(this, this.millisec_slider, 'millisec', this.millisec - (this.millisec % this._defaults.stepMillisec));
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, 'microsec', { min: this._defaults.microsecMin, max: microsecMax });
					this.control.value(this, this.microsec_slider, 'microsec', this.microsec - (this.microsec % this._defaults.stepMicrosec));
				}
			}

		},

		/*
		* when a slider moves, set the internal time...
		* on time change is also called when the time is updated in the text field
		*/
		_onTimeChange: function() {
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, 'hour') : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, 'minute') : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, 'second') : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, 'millisec') : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, 'microsec') : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;

			if (typeof(hour) == 'object') {
				hour = false;
			}
			if (typeof(minute) == 'object') {
				minute = false;
			}
			if (typeof(second) == 'object') {
				second = false;
			}
			if (typeof(millisec) == 'object') {
				millisec = false;
			}
			if (typeof(microsec) == 'object') {
				microsec = false;
			}
			if (typeof(timezone) == 'object') {
				timezone = false;
			}

			if (hour !== false) {
				hour = parseInt(hour, 10);
			}
			if (minute !== false) {
				minute = parseInt(minute, 10);
			}
			if (second !== false) {
				second = parseInt(second, 10);
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10);
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10);
			}

			var ampm = o[hour &amp;lt; 12 ? 'amNames' : 'pmNames'][0];

			// If the update was done in the input field, the input field should not be updated.
			// If the update was done using the sliders, update the input field.
			var hasChanged = (hour != this.hour || minute != this.minute || second != this.second || millisec != this.millisec || microsec != this.microsec 
								|| (this.ampm.length &amp;gt; 0 &amp;amp;&amp;amp; (hour &amp;lt; 12) != ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) 
								|| (this.timezone !== null &amp;amp;&amp;amp; timezone != this.timezone));

			if (hasChanged) {

				if (hour !== false) {
					this.hour = hour;
				}
				if (minute !== false) {
					this.minute = minute;
				}
				if (second !== false) {
					this.second = second;
				}
				if (millisec !== false) {
					this.millisec = millisec;
				}
				if (microsec !== false) {
					this.microsec = microsec;
				}
				if (timezone !== false) {
					this.timezone = timezone;
				}

				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0]);
				}

				this._limitMinMaxDateTime(this.inst, true);
			}
			if (this.support.ampm) {
				this.ampm = ampm;
			}

			// Updates the time within the timepicker
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if(pickerTimeFormat === o.timeFormat){
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix);
				}
				else{
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix);
				}
			}

			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime();
			}
		},

		/*
		* call custom onSelect.
		* bind to sliders slidestop, and grid click.
		*/
		_onSelectHandler: function() {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect &amp;amp;&amp;amp; inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this]);
			}
		},

		/*
		* update our input with the new date time..
		*/
		_updateDateTime: function(dp_inst) {
			dp_inst = this.inst || dp_inst;
			//var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
			var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay)),
				dateFmt = $.datepicker._get(dp_inst, 'dateFormat'),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null &amp;amp;&amp;amp; this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			
			// if a slider was changed but datepicker doesn't have a value yet, set it
			if(dp_inst.lastVal===""){
                dp_inst.currentYear=dp_inst.selectedYear;
                dp_inst.currentMonth=dp_inst.selectedMonth;
                dp_inst.currentDay=dp_inst.selectedDay;
            }

			/*
			* remove following lines to force every changes in date picker to change the input value
			* Bug descriptions: when an input field has a default value, and click on the field to pop up the date picker. 
			* If the user manually empty the value in the input field, the date picker will never change selected value.
			*/
			//if (dp_inst.lastVal !== undefined &amp;amp;&amp;amp; (dp_inst.lastVal.length &amp;gt; 0 &amp;amp;&amp;amp; this.$input.val().length === 0)) {
			//	return;
			//}

			if (this._defaults.timeOnly === true) {
				formattedDateTime = this.formattedTime;
			} else if (this._defaults.timeOnly !== true &amp;amp;&amp;amp; (this._defaults.alwaysSetTime || timeAvailable)) {
				formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix;
			}

			this.formattedDateTime = formattedDateTime;

			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate);
			} else if (this.$altInput &amp;amp;&amp;amp; this._defaults.timeOnly === false &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly === true) {
				this.$altInput.val(this.formattedTime);
				this.$input.val(this.formattedDate);
			} else if (this.$altInput) {
				this.$input.val(formattedDateTime);
				var altFormattedDateTime = '',
					altSeparator = this._defaults.altSeparator ? this._defaults.altSeparator : this._defaults.separator,
					altTimeSuffix = this._defaults.altTimeSuffix ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
				
				if(!this._defaults.timeOnly){
					if (this._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg);
					}
					else{
						altFormattedDateTime = this.formattedDate;
					}

					if (altFormattedDateTime){
						altFormattedDateTime += altSeparator;
					}
				}

				if(this._defaults.altTimeFormat){
					altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix;
				}
				else{
					altFormattedDateTime += this.formattedTime + altTimeSuffix;
				}
				this.$altInput.val(altFormattedDateTime);
			} else {
				this.$input.val(formattedDateTime);
			}

			this.$input.trigger("change");
		},

		_onFocus: function() {
			if (!this.$input.val() &amp;amp;&amp;amp; this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, 'timepicker');
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst);
						} catch (err) {
							$.timepicker.log(err);
						}
					}
				}
			}
		},

		/*
		* Small abstraction to control types
		* We can add more, just be sure to follow the pattern: create, options, value
		*/
		_controls: {
			// slider methods
			slider: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var rtl = tp_inst._defaults.isRTL; // if rtl go -60-&amp;gt;0 instead of 0-&amp;gt;60
					return obj.prop('slide', null).slider({
						orientation: "horizontal",
						value: rtl? val*-1 : val,
						min: rtl? max*-1 : min,
						max: rtl? min*-1 : max,
						step: step,
						slide: function(event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl? ui.value*-1:ui.value);
							tp_inst._onTimeChange();
						},
						stop: function(event, ui) {
							tp_inst._onSelectHandler();
						}
					});	
				},
				options: function(tp_inst, obj, unit, opts, val){
					if(tp_inst._defaults.isRTL){
						if(typeof(opts) == 'string'){
							if(opts == 'min' || opts == 'max'){
								if(val !== undefined){
									return obj.slider(opts, val*-1);
								}
								return Math.abs(obj.slider(opts));
							}
							return obj.slider(opts);
						}
						var min = opts.min, 
							max = opts.max;
						opts.min = opts.max = null;
						if(min !== undefined){
							opts.max = min * -1;
						}
						if(max !== undefined){
							opts.min = max * -1;
						}
						return obj.slider(opts);
					}
					if(typeof(opts) == 'string' &amp;amp;&amp;amp; val !== undefined){
							return obj.slider(opts, val);
					}
					return obj.slider(opts);
				},
				value: function(tp_inst, obj, unit, val){
					if(tp_inst._defaults.isRTL){
						if(val !== undefined){
							return obj.slider('value', val*-1);
						}
						return Math.abs(obj.slider('value'));
					}
					if(val !== undefined){
						return obj.slider('value', val);
					}
					return obj.slider('value');
				}
			},
			// select methods
			select: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var sel = '&amp;lt;select class="ui-timepicker-select" data-unit="'+ unit +'" data-min="'+ min +'" data-max="'+ max +'" data-step="'+ step +'"&amp;gt;',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;

					for(var i=min; i&amp;lt;=max; i+=step){						
						sel += '&amp;lt;option value="'+ i +'"'+ (i==val? ' selected':'') +'&amp;gt;';
						if(unit == 'hour'){
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig,'')), {hour:i}, tp_inst._defaults);
						}
						else if(unit == 'millisec' || unit == 'microsec' || i &amp;gt;= 10){ sel += i; }
						else {sel += '0'+ i.toString(); }
						sel += '&amp;lt;/option&amp;gt;';
					}
					sel += '&amp;lt;/select&amp;gt;';

					obj.children('select').remove();

					$(sel).appendTo(obj).change(function(e){
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
					});

					return obj;
				},
				options: function(tp_inst, obj, unit, opts, val){
					var o = {},
						$t = obj.children('select');
					if(typeof(opts) == 'string'){
						if(val === undefined){
							return $t.data(opts);
						}
						o[opts] = val;	
					}
					else{ o = opts; }
					return tp_inst.control.create(tp_inst, obj, $t.data('unit'), $t.val(), o.min || $t.data('min'), o.max || $t.data('max'), o.step || $t.data('step'));
				},
				value: function(tp_inst, obj, unit, val){
					var $t = obj.children('select');
					if(val !== undefined){
						return $t.val(val);
					}
					return $t.val();
				}
			}
		} // end _controls

	});

	$.fn.extend({
		/*
		* shorthand just to use timepicker..
		*/
		timepicker: function(o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);

			if (typeof o == 'object') {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				});
			}

			return $(this).each(function() {
				$.fn.datetimepicker.apply($(this), tmp_args);
			});
		},

		/*
		* extend timepicker to datepicker
		*/
		datetimepicker: function(o) {
			o = o || {};
			var tmp_args = arguments;

			if (typeof(o) == 'string') {
				if (o == 'getDate') {
					return $.fn.datepicker.apply($(this[0]), tmp_args);
				} else {
					return this.each(function() {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args);
					});
				}
			} else {
				return this.each(function() {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults);
				});
			}
		}
	});

	/*
	* Public Utility to parse date and time
	*/
	$.datepicker.parseDateTime = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec);
		}

		return parseRes.date;
	};

	/*
	* Public utility to parse time
	*/
	$.datepicker.parseTime = function(timeFormat, timeString, options) {		
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g,'').indexOf('Z') !== -1);

		// Strict parse requires the timeString to match the timeFormat exactly
		var strictParse = function(f, s, o){

			// pattern for standard and localized AM/PM markers
			var getPatternAmpm = function(amNames, pmNames) {
				var markers = [];
				if (amNames) {
					$.merge(markers, amNames);
				}
				if (pmNames) {
					$.merge(markers, pmNames);
				}
				markers = $.map(markers, function(val) {
					return val.replace(/[.*+?|()\[\]{}\\]/g, '\\$&amp;amp;');
				});
				return '(' + markers.join('|') + ')?';
			};

			// figure out position of time elements.. cause js cant do named captures
			var getFormatPositions = function(timeFormat) {
				var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
					orders = {
						h: -1,
						m: -1,
						s: -1,
						l: -1,
						c: -1,
						t: -1,
						z: -1
					};

				if (finds) {
					for (var i = 0; i &amp;lt; finds.length; i++) {
						if (orders[finds[i].toString().charAt(0)] == -1) {
							orders[finds[i].toString().charAt(0)] = i + 1;
						}
					}
				}
				return orders;
			};

			var regstr = '^' + f.toString()
					.replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
							var ml = match.length;
							switch (match.charAt(0).toLowerCase()) {
								case 'h': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'm': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 's': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'l': return '(\\d?\\d?\\d)';
								case 'c': return '(\\d?\\d?\\d)';
								case 'z': return '(z|[-+]\\d\\d:?\\d\\d|\\S+)?';
								case 't': return getPatternAmpm(o.amNames, o.pmNames);
								default:    // literal escaped in quotes
									return '(' + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function (m) { return "\\" + m; }) + ')?';
							}
						})
					.replace(/\s/g, '\\s?') +
					o.timeSuffix + '$',
				order = getFormatPositions(f),
				ampm = '',
				treg;

			treg = s.match(new RegExp(regstr, 'i'));

			var resTime = {
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0
			};

			if (treg) {
				if (order.t !== -1) {
					if (treg[order.t] === undefined || treg[order.t].length === 0) {
						ampm = '';
						resTime.ampm = '';
					} else {
						ampm = $.inArray(treg[order.t].toUpperCase(), o.amNames) !== -1 ? 'AM' : 'PM';
						resTime.ampm = o[ampm == 'AM' ? 'amNames' : 'pmNames'][0];
					}
				}

				if (order.h !== -1) {
					if (ampm == 'AM' &amp;amp;&amp;amp; treg[order.h] == '12') {
						resTime.hour = 0; // 12am = 0 hour
					} else {
						if (ampm == 'PM' &amp;amp;&amp;amp; treg[order.h] != '12') {
							resTime.hour = parseInt(treg[order.h], 10) + 12; // 12pm = 12 hour, any other pm = hour + 12
						} else {
							resTime.hour = Number(treg[order.h]);
						}
					}
				}

				if (order.m !== -1) {
					resTime.minute = Number(treg[order.m]);
				}
				if (order.s !== -1) {
					resTime.second = Number(treg[order.s]);
				}
				if (order.l !== -1) {
					resTime.millisec = Number(treg[order.l]);
				}
				if (order.c !== -1) {
					resTime.microsec = Number(treg[order.c]);
				}
				if (order.z !== -1 &amp;amp;&amp;amp; treg[order.z] !== undefined) {
					resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z]);
				}


				return resTime;
			}
			return false;
		};// end strictParse

		// First try JS Date, if that fails, use strictParse
		var looseParse = function(f,s,o){
			try{
				var d = new Date('2012-01-01 '+ s);
				if(isNaN(d.getTime())){
					d = new Date('2012-01-01T'+ s);
					if(isNaN(d.getTime())){
						d = new Date('01/01/2012 '+ s);
						if(isNaN(d.getTime())){
							throw "Unable to parse time with native Date: "+ s;
						}
					}
				}

				return {
					hour: d.getHours(),
					minute: d.getMinutes(),
					second: d.getSeconds(),
					millisec: d.getMilliseconds(),
					microsec: d.getMicroseconds(),
					timezone: d.getTimezoneOffset()*-1
				};
			}
			catch(err){
				try{
					return strictParse(f,s,o);
				}
				catch(err2){
					$.timepicker.log("Unable to parse \ntimeString: "+ s +"\ntimeFormat: "+ f);
				}				
			}
			return false;
		}; // end looseParse
		
		if(typeof o.parse === "function"){
			return o.parse(timeFormat, timeString, o);
		}
		if(o.parse === 'loose'){
			return looseParse(timeFormat, timeString, o);
		}
		return strictParse(timeFormat, timeString, o);
	};

	/*
	* Public utility to format the time
	* format = string format of the time
	* time = a {}, not a Date() for timezones
	* options = essentially the regional[].. amNames, pmNames, ampm
	*/
	$.datepicker.formatTime = function(format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			timezone: 0
		}, time);

		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);

		if (hour &amp;gt; 11) {
			ampmName = options.pmNames[0];
		}

		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|('.*?'|".*?"))/g, function(match) {
		switch (match) {
			case 'HH':
				return ('0' + hour).slice(-2);
			case 'H':
				return hour;
			case 'hh':
				return ('0' + convert24to12(hour)).slice(-2);
			case 'h':
				return convert24to12(hour);
			case 'mm':
				return ('0' + time.minute).slice(-2);
			case 'm':
				return time.minute;
			case 'ss':
				return ('0' + time.second).slice(-2);
			case 's':
				return time.second;
			case 'l':
				return ('00' + time.millisec).slice(-3);
			case 'c':
				return ('00' + time.microsec).slice(-3);
			case 'z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, false);
			case 'Z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, true);
			case 'T': 
				return ampmName.charAt(0).toUpperCase();
			case 'TT': 
				return ampmName.toUpperCase();
			case 't':
				return ampmName.charAt(0).toLowerCase();
			case 'tt':
				return ampmName.toLowerCase();
			default:
				return match.replace(/\'/g, "") || "'";
			}
		});

		tmptime = $.trim(tmptime);
		return tmptime;
	};

	/*
	* the bad hack :/ override datepicker so it doesnt close on select
	// inspired: http://stackoverflow.com/questions/1252512/jquery-datepicker-prevent-closing-picker-when-clicking-a-date/1762378#1762378
	*/
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function(id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			tp_inst._limitMinMaxDateTime(inst, true);
			inst.inline = inst.stay_open = true;
			//This way the onSelect handler called from calendarpicker get the full dateTime
			this._base_selectDate(id, dateStr);
			inst.inline = inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst);
		} else {
			this._base_selectDate(id, dateStr);
		}
	};

	/*
	* second bad hack :/ override datepicker so it triggers an event when changing the input field
	* and does not redraw the datepicker on every selectDate event
	*/
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function(inst) {

		// don't popup the datepicker if there is another instance already opened
		var input = inst.input[0];
		if ($.datepicker._curInst &amp;amp;&amp;amp; $.datepicker._curInst != inst &amp;amp;&amp;amp; $.datepicker._datepickerShowing &amp;amp;&amp;amp; $.datepicker._lastInput != input) {
			return;
		}

		if (typeof(inst.stay_open) !== 'boolean' || inst.stay_open === false) {

			this._base_updateDatepicker(inst);

			// Reload the time control when changing something in the input text field.
			var tp_inst = this._get(inst, 'timepicker');
			if (tp_inst) {
				tp_inst._addTimePicker(inst);
			}
		}
	};

	/*
	* third bad hack :/ override datepicker so it allows spaces and colon in the input field
	*/
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if ($.datepicker._get(inst, 'constrainInput')) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null? tp_inst._defaults.showTimezone : tp_inst.support.timezone,					
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat')),
					datetimeChars = tp_inst._defaults.timeFormat.toString()
											.replace(/[hms]/g, '')
											.replace(/TT/g, ampm ? 'APM' : '')
											.replace(/Tt/g, ampm ? 'AaPpMm' : '')
											.replace(/tT/g, ampm ? 'AaPpMm' : '')
											.replace(/T/g, ampm ? 'AP' : '')
											.replace(/tt/g, ampm ? 'apm' : '')
											.replace(/t/g, ampm ? 'ap' : '') + 
											" " + tp_inst._defaults.separator + 
											tp_inst._defaults.timeSuffix + 
											(tz ? tp_inst._defaults.timezoneList.join('') : '') + 
											(tp_inst._defaults.amNames.join('')) + (tp_inst._defaults.pmNames.join('')) + 
											dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr &amp;lt; ' ' || !dateChars || datetimeChars.indexOf(chr) &amp;gt; -1);
			}
		}

		return $.datepicker._base_doKeyPress(event);
	};

	/*
	* Fourth bad hack :/ override _updateAlternate function used in inline mode to init altField
	*/
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	/* Update any alternate field to synchronise with the main field. */
	$.datepicker._updateAlternate = function(inst) {
		var tp_inst = this._get(inst, 'timepicker');
		if(tp_inst){
			var altField = tp_inst._defaults.altField;
			if (altField) { // update alternate field too
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = '', 
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator, 
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if(!tp_inst._defaults.timeOnly &amp;amp;&amp;amp; !tp_inst._defaults.altFieldTimeOnly &amp;amp;&amp;amp; date !== null){
					if(tp_inst._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime;
					}
					else{
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime;
					}
				}
				$(altField).val(altFormattedDateTime);
			}
		}
		else{
			$.datepicker._base_updateAlternate(inst);
		}
	};

	/*
	* Override key up event to sync manual input changes.
	*/
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst);
				} catch (err) {
					$.timepicker.log(err);
				}
			}
		}

		return $.datepicker._base_doKeyUp(event);
	};

	/*
	* override "Today" button to also grab the time.
	*/
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function(id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		this._base_gotoToday(id);
		var tp_inst = this._get(inst, 'timepicker');
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		$('.ui-datepicker-today', $dp).click();
	};

	/*
	* Disable &amp;amp; enable the Time in the datetimepicker
	*/
	$.datepicker._disableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst);
		}
	};

	$.datepicker._enableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst); // Could be disabled on page load
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create our own set time function
	*/
	$.datepicker._setTime = function(inst, date) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var defaults = tp_inst._defaults;

			// calling _setTime with no date sets time to defaults
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;

			//check if within min/max times.. 
			tp_inst._limitMinMaxDateTime(inst, true);

			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create new public method to set only time, callable as $().datepicker('setTime', date)
	*/
	$.datepicker._setTimeDatepicker = function(target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date == "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec);
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds());
				}
				if (tp_date.toString() == 'Invalid Date') {
					tp_date = undefined;
				}
				this._setTime(inst, tp_date);
			}
		}

	};

	/*
	* override setDate() to allow setting time too within Date object
	*/
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function(target, date) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		if(typeof(date) === 'string'){
			date = new Date(date);
			if(!date.getTime()){
				$.timepicker.log("Error creating Date object from string.");
			}
		}

		var tp_inst = this._get(inst, 'timepicker');
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds());
		} else {
			tp_date = date;
		}
		
		// This is important if you are using the timezone option, javascript's Date 
		// object will only return the timezone offset for the current locale, so we 
		// adjust it accordingly.  If not using timezone option this won't matter..
		// If a timezone is different in tp, keep the timezone as is
		if(tp_inst){
			// look out for DST if tz wasn't specified
			if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
				tp_inst.timezone = tp_date.getTimezoneOffset()*-1;
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone);
		}

		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true);
	};

	/*
	* override getDate() to allow getting time too within Date object
	*/
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function(target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			// if it hasn't yet been defined, grab from field
			if(inst.lastVal === undefined){
				this._setDateFromField(inst, noDefault);
			}

			var date = this._getDate(inst);
			if (date &amp;amp;&amp;amp; tp_inst._parseTime($(target).val(), tp_inst.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);

				// This is important if you are using the timezone option, javascript's Date 
				// object will only return the timezone offset for the current locale, so we 
				// adjust it accordingly.  If not using timezone option this won't matter..
				if(tp_inst.timezone != null){
					// look out for DST if tz wasn't specified
					if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
						tp_inst.timezone = date.getTimezoneOffset()*-1;
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
				}
			}
			return date;
		}
		return this._base_getDateDatepicker(target, noDefault);
	};

	/*
	* override parseDate() because UI 1.8.14 throws an error about "Extra characters"
	* An option in datapicker to ignore extra format characters would be nicer.
	*/
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function(format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings);
		} catch (err) {
			// Hack!  The error message ends with a colon, a space, and
			// the "extra" characters.  We rely on that instead of
			// attempting to perfectly reproduce the parsing algorithm.
			if (err.indexOf(":") &amp;gt;= 0) {
				date = this._base_parseDate(format, value.substring(0,value.length-(err.length-err.indexOf(':')-2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format);
			} else {
				throw err;
			}
		}
		return date;
	};

	/*
	* override formatDate to set date with time to the input
	*/
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function(inst, day, month, year) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val();
		}
		return this._base_formatDate(inst);
	};

	/*
	* override options setter to add time to maxDate(Time) and minDate(Time). MaxDate
	*/
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function(target, name, value) {
		var inst = this._getInst(target),
	        name_clone;
		if (!inst) {
			return null;
		}

		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop;
		    if (typeof name == 'string') { // if min/max was set with the string
		        if (name === 'minDate' || name === 'minDateTime') {
		            min = value;
		        } else if (name === 'maxDate' || name === 'maxDateTime') {
		            max = value;
		        } else if (name === 'onSelect') {
		            onselect = value;
		        } else if (overrides.hasOwnProperty(name)) {
		            if (typeof (value) === 'undefined') {
		                return overrides[name];
		            }
		            fns[name] = value;
		            name_clone = {}; //empty results in exiting function after overrides updated
		        }
		    } else if (typeof name == 'object') { //if min/max was set with the JSON
		        if (name.minDate) {
		            min = name.minDate;
		        } else if (name.minDateTime) {
		            min = name.minDateTime;
		        } else if (name.maxDate) {
		            max = name.maxDate;
		        } else if (name.maxDateTime) {
		            max = name.maxDateTime;
		        }
		        for (prop in overrides) {
		            if (overrides.hasOwnProperty(prop) &amp;amp;&amp;amp; name[prop]) {
		                fns[prop] = name[prop];
		            }
		        }
		    }
		    for (prop in fns) {
		        if (fns.hasOwnProperty(prop)) {
		            overrides[prop] = fns[prop];
		            if (!name_clone) { name_clone = $.extend({}, name);}
		            delete name_clone[prop];
		        }
		    }
		    if (name_clone &amp;amp;&amp;amp; isEmptyObject(name_clone)) { return; }
		    if (min) { //if min was set
		        if (min === 0) {
		            min = new Date();
		        } else {
		            min = new Date(min);
		        }
		        tp_inst._defaults.minDate = min;
		        tp_inst._defaults.minDateTime = min;
		    } else if (max) { //if max was set
		        if (max === 0) {
		            max = new Date();
		        } else {
		            max = new Date(max);
		        }
		        tp_inst._defaults.maxDate = max;
		        tp_inst._defaults.maxDateTime = max;
		    } else if (onselect) {
		        tp_inst._defaults.onSelect = onselect;
		    }
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name);
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
	};
	
	/*
	* jQuery isEmptyObject does not check hasOwnProperty - if someone has added to the object prototype,
	* it will return false for all objects
	*/
	var isEmptyObject = function(obj) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(obj)) {
				return false;
			}
		}
		return true;
	};

	/*
	* jQuery extend now ignores nulls!
	*/
	var extendRemove = function(target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] === null || props[name] === undefined) {
				target[name] = props[name];
			}
		}
		return target;
	};

	/*
	* Determine by the time format which units are supported
	* Returns an object of booleans for each unit
	*/
	var detectSupport = function(timeFormat){
		var tf = timeFormat.replace(/\'.*?\'/g,'').toLowerCase(), // removes literals
			isIn = function(f, t){ // does the format contain the token?
					return f.indexOf(t) !== -1? true:false; 
				};
		return {
				hour: isIn(tf,'h'),
				minute: isIn(tf,'m'),
				second: isIn(tf,'s'),
				millisec: isIn(tf,'l'),
				microsec: isIn(tf,'c'),
				timezone: isIn(tf,'z'),
				ampm: isIn(tf,'t') &amp;amp;&amp;amp; isIn(timeFormat,'h'),
				iso8601: isIn(timeFormat, 'Z')
			};
	};

	/*
	* Converts 24 hour format into 12 hour
	* Returns 12 hour without leading 0
	*/
	var convert24to12 = function(hour) {
		if (hour &amp;gt; 12) {
			hour = hour - 12;
		}

		if (hour === 0) {
			hour = 12;
		}

		return String(hour);
	};

	/*
	* Splits datetime string into date ans time substrings.
	* Throws exception when date can't be parsed
	* Returns [dateString, timeString]
	*/
	var splitDateTime = function(dateFormat, dateTimeString, dateSettings, timeSettings) {
		try {
			// The idea is to get the number separator occurances in datetime and the time format requested (since time has 
			// fewer unknowns, mostly numbers and am/pm). We will use the time pattern to split.
			var separator = timeSettings &amp;amp;&amp;amp; timeSettings.separator ? timeSettings.separator : $.timepicker._defaults.separator,
				format = timeSettings &amp;amp;&amp;amp; timeSettings.timeFormat ? timeSettings.timeFormat : $.timepicker._defaults.timeFormat,
				timeParts = format.split(separator), // how many occurances of separator may be in our format?
				timePartsLen = timeParts.length,
				allParts = dateTimeString.split(separator),
				allPartsLen = allParts.length;

			if (allPartsLen &amp;gt; 1) {
				return [
						allParts.splice(0,allPartsLen-timePartsLen).join(separator),
						allParts.splice(0,timePartsLen).join(separator)
					];
			}

		} catch (err) {
			$.timepicker.log('Could not split the date from the time. Please check the following datetimepicker options' +
					"\nthrown error: " + err +
					"\ndateTimeString" + dateTimeString +
					"\ndateFormat = " + dateFormat +
					"\nseparator = " + timeSettings.separator +
					"\ntimeFormat = " + timeSettings.timeFormat);

			if (err.indexOf(":") &amp;gt;= 0) {
				// Hack!  The error message ends with a colon, a space, and
				// the "extra" characters.  We rely on that instead of
				// attempting to perfectly reproduce the parsing algorithm.
				var dateStringLength = dateTimeString.length - (err.length - err.indexOf(':') - 2),
					timeString = dateTimeString.substring(dateStringLength);

				return [$.trim(dateTimeString.substring(0, dateStringLength)), $.trim(dateTimeString.substring(dateStringLength))];

			} else {
				throw err;
			}
		}
		return [dateTimeString, ''];
	};

	/*
	* Internal function to parse datetime interval
	* Returns: {date: Date, timeObj: Object}, where
	*   date - parsed date without time (type Date)
	*   timeObj = {hour: , minute: , second: , millisec: , microsec: } - parsed time. Optional
	*/
	var parseDateTimeInternal = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var date;
		var splitRes = splitDateTime(dateFormat, dateTimeString, dateSettings, timeSettings);
		date = $.datepicker._base_parseDate(dateFormat, splitRes[0], dateSettings);
		if (splitRes[1] !== '') {
			var timeString = splitRes[1],
				parsedTime = $.datepicker.parseTime(timeFormat, timeString, timeSettings);

			if (parsedTime === null) {
				throw 'Wrong time format';
			}
			return {
				date: date,
				timeObj: parsedTime
			};
		} else {
			return {
				date: date
			};
		}
	};

	/*
	* Internal function to set timezone_select to the local timezone
	*/
	var selectLocalTimezone = function(tp_inst, date) {
		if (tp_inst &amp;amp;&amp;amp; tp_inst.timezone_select) {
			var now = typeof date !== 'undefined' ? date : new Date();
			tp_inst.timezone_select.val(now.getTimezoneOffset()*-1);
		}
	};

	/*
	* Create a Singleton Insance
	*/
	$.timepicker = new Timepicker();

	/**
	 * Get the timezone offset as string from a date object (eg '+0530' for UTC+5.5)
	 * @@param  number if not a number this value is returned
	 * @@param boolean if true formats in accordance to iso8601 "+12:45"
	 * @@return string
	 */
	$.timepicker.timezoneOffsetString = function(tzMinutes, iso8601) {
		if(isNaN(tzMinutes) || tzMinutes &amp;gt; 840){
			return tzMinutes;
		}

		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601? ':':'',
			tz = (off &amp;gt;= 0 ? '+' : '-') + ('0' + (hours * 101).toString()).slice(-2) + iso + ('0' + (minutes * 101).toString()).slice(-2);
		
		if(tz == '+00:00'){
			return 'Z';
		}
		return tz;
	};

	/**
	 * Get the number in minutes that represents a timezone string
	 * @@param  string formated like "+0500", "-1245"
	 * @@return number
	 */
	$.timepicker.timezoneOffsetNumber = function(tzString) {
		tzString = tzString.toString().replace(':',''); // excuse any iso8601, end up with "+1245"

		if(tzString.toUpperCase() === 'Z'){ // if iso8601 with Z, its 0 minute offset
			return 0;
		}

		if(!/^(\-|\+)\d{4}$/.test(tzString)){ // possibly a user defined tz, so just give it back
			return tzString;
		}

		return ((tzString.substr(0,1) =='-'? -1 : 1) * // plus or minus
					((parseInt(tzString.substr(1,2),10)*60) + // hours (converted to minutes)
					parseInt(tzString.substr(3,2),10))); // minutes
	};

	/**
	 * No way to set timezone in js Date, so we must adjust the minutes to compensate. (think setDate, getDate)
	 * @@param  date
	 * @@param  string formated like "+0500", "-1245"
	 * @@return date
	 */
	$.timepicker.timezoneAdjust = function(date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if(!isNaN(toTz)){
			date.setMinutes(date.getMinutes()*1 + (date.getTimezoneOffset()*-1 - toTz*1) );
		}
		return date;
	};

	/**
	 * Calls `timepicker()` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * n.b. The input value must be correctly formatted (reformatting is not supported)
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the timepicker() call
	 * @@return jQuery
	 */
	$.timepicker.timeRange = function(startTime, endTime, options) {
		return $.timepicker.handleRange('timepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datetimepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@return jQuery
	 */
	$.timepicker.datetimeRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datetimepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.dateRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.handleRange = function(method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0, // min allowed interval in milliseconds
			maxInterval: 0, // max allowed interval in milliseconds
			start: {},      // options for start picker
			end: {}         // options for end picker
		}, options);

		$.fn[method].call(startTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), endTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), endTime, 'minDate');
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), startTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), startTime, 'maxDate');
			}
		}, options, options.end));

		checkDates(startTime, endTime);
		selected(startTime, endTime, 'minDate');
		selected(endTime, startTime, 'maxDate');

		function checkDates(changed, other) {
			var startdt = startTime[method]('getDate'),
				enddt = endTime[method]('getDate'),
				changeddt = changed[method]('getDate');

			if(startdt !== null){
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());

				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);

				if(options.minInterval &amp;gt; 0 &amp;amp;&amp;amp; minDate &amp;gt; enddt){ // minInterval check
					endTime[method]('setDate',minDate);
				}
				else if(options.maxInterval &amp;gt; 0 &amp;amp;&amp;amp; maxDate &amp;lt; enddt){ // max interval check
					endTime[method]('setDate',maxDate);
				}
				else if (startdt &amp;gt; enddt) {
					other[method]('setDate',changeddt);
				}
			}
		}

		function selected(changed, other, option) {
			if (!changed.val()) {
				return;
			}
			var date = changed[method].call(changed, 'getDate');
			if(date !== null &amp;amp;&amp;amp; options.minInterval &amp;gt; 0){
				if(option == 'minDate'){
					date.setMilliseconds(date.getMilliseconds() + options.minInterval); 
				}
				if(option == 'maxDate'){
					date.setMilliseconds(date.getMilliseconds() - options.minInterval);
				}
			}
			if (date.getTime) {
				other[method].call(other, 'option', option, date);
			}
		}
		return $([startTime.get(0), endTime.get(0)]);
	};

	/**
	 * Log error or data to the console during error or debugging
	 * @@param  Object err pass any type object to log to the console during error or debugging
	 * @@return void
	 */
	$.timepicker.log = function(err){
		if(window.console){
			console.log(err);
		}
	};

	/*
	* Microsecond support
	*/
	if(!Date.prototype.getMicroseconds){
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function(){ return this.microseconds; };
		Date.prototype.setMicroseconds = function(m){ 
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m/1000));
			this.microseconds = m%1000;
			return this;
		};
	}

	/*
	* Keep up with the version
	*/
	$.timepicker.version = "1.3.1";

})(jQuery);
jQuery.noConflict();
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;datetimepicker-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;e73a652e-09fc-4c71-8e7a-e2525a2d2a99&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
function replaceAllString(oriStr, strTarget, strSubString ){
   var strText = oriStr;
   var intIndexOfMatch = strText.indexOf( strTarget );
   while (intIndexOfMatch != -1){
      strText = strText.replace( strTarget, strSubString )
      intIndexOfMatch = strText.indexOf( strTarget );
   }
   return( strText );
}
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&amp;amp;]" + name + "=([^&amp;amp;#]*)"),
    results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
};


   var jobName= getParameterByName('job')
   var fromDate= getParameterByName('fromDate')
   var toDate= getParameterByName('toDate')
   var limit= getParameterByName('limit')
   var selectedIstIid = getParameterByName('IstIid')

  $("#jobname").ready(function(){
   $("#jobname").text(jobName)
   var convertedJobName = replaceAllString(jobName, ".", "_")
   $("#IstIid" + convertedJobName).ready(function(){
     $("#IstIid" + convertedJobName).css("display","block")
     $("#select_" + convertedJobName).ready(function(){
        $("#select_" + convertedJobName).val(selectedIstIid)
     });
   });
 });

  $("#fromDate").ready(function(){
   $("#from-date").val(fromDate)
 });

  $("#toDate").ready(function(){
   $("#to-date").val(toDate)
 });

  $("#limit").ready(function(){
   if(limit!=""){
    $("#limit").val(limit)
   }
 });
 // Get data with ajax
 function ajax_getData(jobName,fromDate,toDate,limit ){
       var convertedJobName = replaceAllString(jobName, ".", "_")
       var istIid = $("#select_" + convertedJobName).val()
       window.location="/xwiki/bin/view/WiperDog/WebHome?job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid="+istIid;
 			/*$.ajax({
			 type: "GET",
			 url:"/xwiki/bin/get/Sandbox/DescriptionForJob?outputSyntax=plain&amp;amp;job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid"+selectedIstIid,
			 success : function(result){
				$("#jobname").html(jobName)
				$("#display").text('[[]]' + result)
			 }
		   });*/
 }
	$("#treemenu2 a").click(function(){
		 var limit = 10
		 var fromDate=""
		 var toDate = ""
		 jobName= $(this).text()
                 $("#jobname").html(jobName)
                 var convertedJobName = replaceAllString(jobName, ".", "_")
                 $("#listIstIid &amp;gt; div").css("display","none")
                 $("#IstIid" + convertedJobName).css("display","block")
		 //ajax_getData(jobName,fromDate,toDate,limit )

	});

	$("#from-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
		dateFormat: 'yy-mm-dd',
	});
	$("#to-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
			dateFormat: 'yy-mm-dd',

	});
	 $("#get-data").on("click",function(){
		var fromDate = $("#from-date").val()
		var toDate =  $("#to-date").val()
		 if( toDate!= "" ){
			  if(fromDate != ""){
				  if($("#from-date").datepicker( "getDate" ) &amp;gt; $("#to-date").datepicker( "getDate" )){
				  alert("'From date' cannot start later than 'To date'")
				  return false
				  }
			  }
		 }
		 limit = $("#limit").val()
		 ajax_getData(jobName,fromDate,toDate,limit )
	});
$(document).ready(function(){
  var keys = $("#lstkey").text()
  //console.log('key == ' + keys);
  //console.log('livetableJson ==' + $("#livetableJson").text());
  
  var jsonObj = $.parseJSON($("#livetableJson").text()); 
  if(keys &amp;amp;&amp;amp; keys != '[ ]'){
    /** Subtyped **/    
    var newKeys = keys.replace('[',"");
    keys = newKeys.replace(']',"");
    var keyArr = keys.contains(',')? keys.split(','):new Array(keys);
    //console.log('Key after replace: '+keys)       
    for(var i=0;i&amp;lt;keyArr.length;i++){
        var keyName = keyArr[i].trim().replace('',"").replace("\"","").replace('\"','');
        var subTypeJsonObjStr = jsonObj[keyName].replace('#livetablePager','#livetablePager_'+keyName)
        var subTypeJsonObj = $.parseJSON(subTypeJsonObjStr);
        $("#livetableList_"+keyName).jqGrid(subTypeJsonObj);
        $("#livetableList_"+keyName).jqGrid('navGrid', "#livetablePager_"+keyName, {
           edit : false,
           add : false,
           del : false,
           search:false
         });
    }
    
  }else{ /** Store**/        
      $("#livetableList").jqGrid(jsonObj);
      $("#livetableList").jqGrid('navGrid', "#livetablePager", {
           edit : false,
           add : false,
           del : false,
           search:false
           
       });
   }
});
        
jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;process&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;881686cc-1bfc-456e-b8ab-71334c4a45e5&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){

$(function () {
    function drawLineChart(xAxis, series, container, data_detail){
        var dataXAxis = xAxis
        var dataSeries = series
        var detail = data_detail

			$('#containerline' + container).highcharts({

				chart: {
					type:'line'
				},
				title: {
					text: container
				},
				tooltip :{
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				xAxis: dataXAxis ,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				series: dataSeries
			});
		};

		function drawBarChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerbar' + container).highcharts({
				chart: {
					type: 'column'
				},
				title: {
					text: container
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {

					column: {
						pointPadding: 0.2,
						borderWidth: 0
					}
				},
				series: dataSeries
			});
		}

		function drawAreaChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail
			$('#containerarea' + container).highcharts({
				chart: {
					type: 'area'
				},
				title: {
					text: container
				},
				subtitle: {
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					},
					labels: {
						formatter: function() {
							return this.value / 1000;
						}
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {
					area: {
						stacking: 'normal',
						lineColor: '#666666',
						lineWidth: 1,
						marker: {
							lineWidth: 1,
							lineColor: '#666666'
						}
					}
				},
				series: dataSeries
			});
		};

		function drawPieChart(data, container){
			var dataPie = data
			$(document).ready(function () {
				// Build the chart
				$('#container' + container).highcharts({
					chart: {
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: dataPie[0].name
					},
					tooltip: {
						pointFormat: '{series.name}: &amp;lt;b&amp;gt;{point.percentage:.1f}%&amp;lt;/b&amp;gt;'
					},
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							dataLabels: {
								enabled: false
							},
							showInLegend: true
						}
					},
					series: dataPie
				});
			});
		}

		// LINE
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonline_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonline");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Line chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						if(data_all[0][i].series[0].name == null){
							data_all[0][i].series[0].name = lstContainer[0][i]
						}
						drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
					}
				}
			}
		});

		// BAR
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonbar_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonbar");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Bar chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						drawBarChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
					}
				}
			}
		});

		// AREA
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonarea_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonarea");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				// data to display on tooltip
				var data_detail = data_all[0]
				// draw Area Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					drawAreaChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
				}
			}
		});

		// PIE
		$("#piechart").ready(function(){

			var array = $("#jsons&amp;gt;.jsonpie");
			var arrayContainer = $("#jsons&amp;gt;.lstcontainerpie");
			var lstContainer = [];
			var data_all = [];
			for(var i=0;i&amp;lt;array.length;i++){
				data_all[i] = jQuery.parseJSON(array[i].value)
				lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)

			}
			if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
				// data to display on tooltip
				// draw Pie Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					var finalData = []
					finalData[0] = data_all[0][i]
					drawPieChart(finalData, lstContainer[0][i])
				}
			}
		});
	});
	jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;d5873d92-b78b-42fc-9407-46d166204b88&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;/* css for timepicker */
.ui-timepicker-div .ui-widget-header { 
margin-bottom: 8px;
 }

.ui-timepicker-div dl { text-align: left; }
.ui-timepicker-div dl dt { height: 25px; margin-bottom: -25px; }
.ui-timepicker-div dl dd { margin: 0 10px 10px 65px; }
.ui-timepicker-div td { font-size: 90%; }
.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }

.ui-timepicker-rtl{ direction: rtl; }
.ui-timepicker-rtl dl { text-align: right; }
.ui-timepicker-rtl dl dd { margin: 0 65px 10px 10px; }
#ui-datepicker-div{
 position:relative;
 width:auto;
 height:auto
}
&lt;/code&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;datetimepicker -css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;1201fb1a-e9c1-4731-8c74-2ea8c0071959&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;.displayblock {
  border:2px solid;
  -webkit-border-radius:6px;
  background:gray;
  float: left;
  width:100%;
}

.displaypie {
  border:1px solid;
  -webkit-border-radius:6px;
  background:gray;
  width: 48%;
  float: left; 
  height: 300px;
}

.subtype {
  margin-top: 50px;
  font-size: 2em;
  color: red;
}&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;content&gt;{{include document="Lib.DataToDrawChart"/}}
{{include document="Lib.MongoDBConnection"/}}
{{velocity}}
$xwiki.jsx.use('Lib.JQueryUILib')
$xwiki.ssx.use('Lib.MenuGenerator')
$xwiki.jsx.use('Lib.MenuGenerator')
$xwiki.ssx.use('Lib.JQueryUILib')
$xwiki.jsx.use('Lib.JqGridLib')
$xwiki.ssx.use('Lib.JqGridLib') 
{{/velocity}}
{{include document="Lib.MenuGenerator"/}}
{{html wiki="true" clean="false"}}
&amp;lt;div id="viewer"&amp;gt;
&amp;lt;table style="text-align:left"  &amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th &amp;gt;Job name&amp;lt;/th&amp;gt;
  &amp;lt;td colspan=3&amp;gt;&amp;lt;div id="jobname"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
{{groovy}}
import org.xwiki.context.*

def ec = services.component.getInstance(Execution.class).getContext()
def mapJobIstIid = ec.getProperty("mapJobIstIid")

println '{{html clean="false" wiki="false"}}'
println '&amp;lt;tr&amp;gt;'
println '&amp;lt;th&amp;gt;IstIid&amp;lt;/th&amp;gt;'
println '&amp;lt;td colspan=3&amp;gt;'
mapJobIstIid.each{jobEntry-&amp;gt;
  def convertedJobKey = jobEntry.key.replaceAll("\\.","_")
  println "&amp;lt;div id='listIstIid'&amp;gt;"
  println "&amp;lt;div id=IstIid${convertedJobKey} style='display:none'&amp;gt;"
  println "&amp;lt;select id=select_${convertedJobKey}&amp;gt;"
  jobEntry.value.each{
     println "&amp;lt;option value=\"$it\"&amp;gt;$it&amp;lt;/option&amp;gt;"
  }
  println "&amp;lt;/select&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
}
println '&amp;lt;/td&amp;gt;'
println '&amp;lt;/tr&amp;gt;'
println '{{/html}}'
{{/groovy}}
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data monitor from&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="from-date" id="from-date"/&amp;gt;&amp;lt;/td&amp;gt;
  &amp;lt;th&amp;gt;Data monitor to&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="to-date" id="to-date"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data records limit &amp;lt;/th&amp;gt;
  &amp;lt;td &amp;gt;
     &amp;lt;select id="limit"&amp;gt;
       &amp;lt;option value=5&amp;gt;5&amp;lt;/option&amp;gt;
       &amp;lt;option value=10&amp;gt;10&amp;lt;/option&amp;gt;
       &amp;lt;option value=15&amp;gt;15&amp;lt;/option&amp;gt;
       &amp;lt;option value=20&amp;gt;20&amp;lt;/option&amp;gt;
     &amp;lt;/select&amp;gt;
  &amp;lt;/td&amp;gt;
  &amp;lt;td colspan=3 &amp;gt;&amp;lt;input type="button" value="View Data" id="get-data" class="button"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;&amp;lt;div id="display"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
  &amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
&amp;lt;/table&amp;gt;

&amp;lt;/div&amp;gt; 
   
 &amp;lt;/body&amp;gt;

{{/html}}
{{groovy}}
import groovy.json.*
xwiki.jsx.use("Lib.Highcharts")

if(request.xpage == "plain") {
	response.setContentType('text/plain')
}

def listData = []
def job = request.get("job")
def fromDate = request.get("fromDate")
def toDate = request.get("toDate")
def limit= (request.get("limit")!=null)?request.get("limit").toInteger():10
def istIid = request.get("IstIid")

def str= "No data to retrieved !"
def result = null
if(job != "" &amp;amp;&amp;amp; job != null &amp;amp;&amp;amp; istIid != null &amp;amp;&amp;amp; istIid != ""){
	MongoDBConnection.getConnection()
	if(fromDate != "" || toDate != ""){
		result = MongoDBConnection.getDataInPeriod(job,fromDate,toDate,limit,istIid)
	} else {
		result = MongoDBConnection.getDataAllFields(job,limit,istIid)
        }
MongoDBConnection.closeConnection()
} else {
   println "{{warning}}There are no selected job or IstIid{{/warning}}"
}
def listKey = []
if( (result != null) &amp;amp;&amp;amp; (result.size() &amp;gt; 0) &amp;amp;&amp;amp; (result[0].KEYEXPR != null)&amp;amp;&amp;amp;!(result[0].KEYEXPR instanceof List )){

if(result[0].type == "Subtyped") {
    println '{{html clean="false" wiki="true"}}'
    //println '&amp;lt;body&amp;gt;'
    def dataSubtype = DataToDrawChart.getDataToDrawSubtype(result)
    dataSubtype.each {key,value -&amp;gt;
        listKey.add(key)
    }
    def jsonkey = com.mongodb.util.JSON.serialize(listKey)
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$jsonkey&amp;lt;/textarea&amp;gt;"

    dataSubtype.each {key,value -&amp;gt;
            def dataLine = []
            def dataBar = []
            def dataPie = []
            def dataArea = []
            if(DataToDrawChart.getDataToDrawLine(value) != []) {
                dataLine = DataToDrawChart.getDataToDrawLine(value)
            }
            if(DataToDrawChart.getDataToDrawBar(value) != []) {
                dataBar = DataToDrawChart.getDataToDrawBar(value)
            }
            if(DataToDrawChart.getDataToDrawPie(value) != []) {
                dataPie = DataToDrawChart.getDataToDrawPie(value)
            }
            if(DataToDrawChart.getDataToDrawArea(value) != []) {
                dataArea = DataToDrawChart.getDataToDrawArea(value)
            }

            def chartColumnsLine
            def chartColumnsBar 
            def chartColumnsArea 
            def lstName
            if(dataLine.size() &amp;gt; 0 ){
                chartColumnsLine = dataLine[0].chart_columns
            }
            if(dataBar.size() &amp;gt; 0){
                chartColumnsBar = dataBar[0].chart_columns
            }
            if(dataArea.size() &amp;gt; 0 ){
                chartColumnsArea = dataArea[0].chart_columns
            }
            if(dataPie.size() &amp;gt; 0 ){
                lstName = dataPie['name']
            }

            def tmpListNameContainer = []
        for(def nameContainer in lstName){
           nameContainer = nameContainer.replaceAll("\\.", "_")
           tmpListNameContainer.add(nameContainer)
        }
            def jsonPie
            def jsonLine
            def jsonBar
            def jsonArea
            if(dataPie != []) {
            jsonPie = com.mongodb.util.JSON.serialize(dataPie)
            }
            if(dataLine != []) {
            jsonLine = com.mongodb.util.JSON.serialize(dataLine)
            }
            if(dataBar != []) {
                jsonBar = com.mongodb.util.JSON.serialize(dataBar)
            }
            if(dataArea != []) {
            jsonArea = com.mongodb.util.JSON.serialize(dataArea)
            }

        def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
        def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
        def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
        def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

        println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
            if(jsonLine != null) {
            println "&amp;lt;textarea id=\"jsonline_$key\" &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
                println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;" 
            }
        if(jsonBar != null) {
                println "&amp;lt;textarea id=\"jsonbar_$key\"&amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
            }
            if(jsonPie != null) {
            println "&amp;lt;textarea id=\"jsonpie_$key\" &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
                println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
            }
            if(jsonArea != null) {
            println "&amp;lt;textarea id=\"jsonarea_$key\" &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
            }

        println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
        println "&amp;lt;input style=\"display:none\" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;"
        println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
        println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'
        println "&amp;lt;/div&amp;gt;"
          
        def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
        def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
          
        println "&amp;lt;div style='clear:both'&amp;gt;"
            def description = value.KEYEXPR._description[0][key]
            if(description != null) {
                println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +': ' + description +'&amp;lt;/div&amp;gt;'
            } else {
                println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +'&amp;lt;/div&amp;gt;'
            }
            println "-----"
            if(jsonPie != null) {
          println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
          lstName.each{
            def tmp = it.replaceAll("\\.", "_")
            println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
          }
          println "&amp;lt;/div&amp;gt;"
            }
            if(jsonLine != null) {
          def chartLineComment = false
          chartColumnsLine.each{
            if(!chartLineComment){
               println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
               chartLineComment = true  
            }

              println " &amp;lt;div class=\"displayblock\" id=\"containerline${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          }
          println "&amp;lt;/div&amp;gt;"
            }
            println "&amp;amp;nbsp;"

            if(jsonBar != null) {
          def chartBarComment = false
          chartColumnsBar.each{
             if(!chartBarComment){
                println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
                chartBarComment = true
              }  

             println " &amp;lt;div class=\"displayblock\" id=\"containerbar${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          }
          println "&amp;lt;/div&amp;gt;"
            }
        println "&amp;amp;nbsp;"

            if(jsonArea != null) {
          def chartAreaComment = false
          chartColumnsArea.each{
          if(!chartAreaComment){
            println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
            chartAreaComment = true
          }
            println " &amp;lt;div class=\"displayblock\" id=\"containerarea${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
          }
          println "&amp;lt;/div&amp;gt;"
            }
        println "&amp;lt;/div&amp;gt;"
        /** Statistic data table **/
        println "&amp;lt;center&amp;gt;"        
        println "&amp;lt;div id='livetblContent_"+key+"' style='width:100%;clear:both;align:middle;margin-top:10px'&amp;gt;"   
        println "Statistics data for "+key
        println "&amp;lt;table id='livetableList_"+key+"' style='width:100%;align:center'&amp;gt;&amp;lt;/table&amp;gt;"
        println "&amp;lt;div id='livetablePager_"+key+"' style='position:relative;width:100%'&amp;gt;&amp;lt;/div&amp;gt;"
        println "&amp;lt;/div&amp;gt;"
        println "&amp;lt;/center&amp;gt;"
        println "&amp;lt;script language='javascript'&amp;gt;console.log('Create live table for "+key+"');&amp;lt;/script&amp;gt;"
    }
    //println '&amp;lt;/body&amp;gt;'
    println '{{/html}}'
} else if(result[0].type == "Store") {
    // data store
    def dataLine = DataToDrawChart.getDataToDrawLine(result)
    def dataBar = DataToDrawChart.getDataToDrawBar(result)
    def dataPie = DataToDrawChart.getDataToDrawPie(result)
    def dataArea = DataToDrawChart.getDataToDrawArea(result)
    def chartColumnsLine 
    def chartColumnsBar 
    def chartColumnsArea 
    def lstName 

    if(dataLine.size() &amp;gt; 0 ){
        chartColumnsLine = dataLine[0].chart_columns
    }
    if(dataBar.size() &amp;gt; 0){
        chartColumnsBar = dataBar[0].chart_columns
    }
    if(dataArea.size() &amp;gt; 0 ){
        chartColumnsArea = dataArea[0].chart_columns
    }
    if(dataPie.size() &amp;gt; 0 ){
        lstName = dataPie['name']
    }

    println '{{html clean="false" wiki="true"}}'
    //println '&amp;lt;body&amp;gt;'
  
    def tmpListNameContainer = []
    for(def nameContainer in lstName){
       nameContainer = nameContainer.replaceAll("\\.", "_")
       tmpListNameContainer.add(nameContainer)
    }
  
    def jsonPie = com.mongodb.util.JSON.serialize(dataPie)
    def jsonLine = com.mongodb.util.JSON.serialize(dataLine)
    def jsonBar = com.mongodb.util.JSON.serialize(dataBar)
    def jsonArea = com.mongodb.util.JSON.serialize(dataArea)

    def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
    def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
    def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
    def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

    def listEmpty = com.mongodb.util.JSON.serialize([])
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$listEmpty&amp;lt;/textarea&amp;gt;" 

    println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'

    println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
    println "&amp;lt;textarea class='jsonline' &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonbar' &amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonpie' &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonarea' &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"

    println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
  
    def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
    def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
  
    println "&amp;lt;div style='clear:both'&amp;gt;"
  
    def chartPieComment = false
    lstName.each{
        if(!chartPieComment) {
            println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
            chartPieComment = true
        }
        def tmp = it.replaceAll("\\.", "_")
        println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    def chartLineComment = false
    chartColumnsLine.each{
    if(!chartLineComment){
        println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
        chartLineComment = true  
    }

    println " &amp;lt;div class=\"displayblock\" id=\"containerline$it\"&amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    println "&amp;amp;nbsp;"
    def chartBarComment = false
    chartColumnsBar.each{
        if(!chartBarComment){
            println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
            chartBarComment = true
        }  

    println " &amp;lt;div class=\"displayblock\" id=\"containerbar$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
  println "&amp;lt;/div&amp;gt;"
  println "&amp;amp;nbsp;"
  def chartAreaComment = false
  chartColumnsArea.each{
  if(!chartAreaComment){
    println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
    chartAreaComment = true
  }
    println " &amp;lt;div class=\"displayblock\" id=\"containerarea$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
  println "&amp;lt;/div&amp;gt;"
println "&amp;lt;/div&amp;gt;"

//println '&amp;lt;/body&amp;gt;'
println '{{/html}}'
}
}else{
    println 'There is no data for this job with criterias'
}
//--=============== Start build for livetable
def subTypeURLMap = [:]
def dataModel = []
def dataUrl = ""
result.find{rec-&amp;gt;				
    def subtractData = []
    
    //-- Parsing data and assign data to subtract list
    if(rec.type == "Store"){ //-- Store data type
        subtractData = rec['data']        
        subtractData.each{r2-&amp;gt;					
            if(dataModel != null &amp;amp;&amp;amp; dataModel.size() &amp;lt;=0){ 
                dataModel.add("Fetch At")
                dataModel.addAll(r2.keySet());					
            } 
        }        
        dataUrl = "/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job="+job +"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate + "&amp;amp;toDate=" + toDate + "&amp;amp;istIid="+istIid        
        //-- Building data model				
        def model = []
        def colSpec
        dataModel.each{name-&amp;gt;
            colSpec = [:]
            colSpec['name'] = name
            colSpec['index'] = name
            colSpec['width'] = "100"
            model.add(colSpec)
        }
        def dataModelStr = (new JsonBuilder(dataModel)).toPrettyString()
        def modelStr = (new JsonBuilder(model)).toPrettyString() 
        str = 
        "{\"url\":\""+dataUrl+"\",\"datatype\":\"json\","+
            "\"colNames\":"+ dataModelStr +
            ",\"colModel\":"+ modelStr +" ,\"rowList\":[10,20,30],"+
            "\"pager\":\"#livetablePager\", \"viewrecords\": true, \"sortname\": \"RECORD_SEQ\","+
            "\"sortorder\": \"asc\", \"caption\":\""+job+"\"}"
        println "{{html clean=\"false\" wiki=\"true\"}}"
        println "&amp;lt;div id='livetableJson' style = \"display:none\"&amp;gt;"
        //println "&amp;lt;div id='livetableJson'&amp;gt;"
        println str;
        println "&amp;lt;/div&amp;gt;"
        println "{{/html}}"
    }else{ //-- Subtype			
        def subData = rec['data']
        subData.each{key,value-&amp;gt;
            dataUrl = "/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job="+job +"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate + "&amp;amp;toDate=" + toDate + "&amp;amp;istIid="+istIid+"&amp;amp;subType="+key
            subtractData = value
            subtractData.each{r2-&amp;gt;					
                if(dataModel != null &amp;amp;&amp;amp; dataModel.size() &amp;lt;=0){ 
                    dataModel.add("Fetch At")
                    dataModel.addAll(r2.keySet());					
                } 			
            }
            //-- Building data model				
            def model = []
            def colSpec
            dataModel.each{name-&amp;gt;
                colSpec = [:]
                colSpec['name'] = name
                colSpec['index'] = name
                colSpec['width'] = "100"
                model.add(colSpec)
            }
            def dataModelStr = (new JsonBuilder(dataModel)).toPrettyString()
            def modelStr = (new JsonBuilder(model)).toPrettyString() 
            str = 
            "{\"url\":\""+dataUrl+"\",\"datatype\":\"json\","+
                "\"colNames\":"+ dataModelStr +
                ",\"colModel\":"+ modelStr +" ,\"rowList\":[10,20,30],"+
                "\"pager\":\"#livetablePager\", \"viewrecords\": true, \"sortname\": \"RECORD_SEQ\","+
                "\"sortorder\": \"asc\", \"caption\":\""+job+"\"}"
            subTypeURLMap[key] = str
        }
        def finalStr = (new JsonBuilder(subTypeURLMap)).toPrettyString()
        println "{{html clean=\"false\" wiki=\"true\"}}"
        println "&amp;lt;div id='livetableJson' style = \"display:none\"&amp;gt;"
        //println "&amp;lt;div id='livetableJson'&amp;gt;"
        println finalStr;
        println "&amp;lt;/div&amp;gt;"
        println "{{/html}}"
    }
    return true
}
 //--=============== END

if(listKey.size() &amp;lt;= 0){   
    println "{{html clean=\"false\" wiki=\"true\"}}"
    println "&amp;lt;center&amp;gt;"
    println "&amp;lt;div id=\"livetblContent\" style=\"width:100%;clear:both;align:middle;margin-top:10px\"&amp;gt;"   
    println "Statistics Data"
    println "&amp;lt;table id=\"livetableList\" style=\"width:100%;align:center\"&amp;gt;&amp;lt;/table&amp;gt;"    
    println "&amp;lt;div id=\"livetablePager\"&amp;gt;&amp;lt;/div&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
    println "&amp;lt;/center&amp;gt;"
    
    println "&amp;lt;div id=\"testDiv\"&amp;gt;&amp;amp;nbsp;&amp;lt;/div&amp;gt;"
    println "{{/html}}"
}
{{/groovy}}
&lt;/content&gt;&lt;/xwikidoc&gt;@


57.1
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376474780000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;57.1&lt;/version&gt;
@


56.1
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376474779000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;56.1&lt;/version&gt;
@


55.1
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376474745000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;55.1&lt;/version&gt;
d2425 17
a2441 6

  var dataModelUrl = '/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job='+jobName+'&amp;amp;limit='
       +limit+'&amp;amp;fromDate='+fromDate + '&amp;amp;toDate='+toDate+'&amp;amp;pager=pager2&amp;amp;genp=1&amp;amp;istIid='+selectedIstIid 
       var jqxhr = $.getJSON(dataModelUrl, function(data) {
       $("#livetableList").jqGrid(data);
       $("#livetableList").jqGrid('navGrid', "#livetablePager", {
d2444 2
a2445 1
           del : false
d2447 12
a2458 1
       })
@


54.12
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376394137000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376394137000&lt;/contentUpdateDate&gt;
&lt;version&gt;54.12&lt;/version&gt;
d21 1
a21 1
&lt;minorEdit&gt;true&lt;/minorEdit&gt;
d3221 1
a3221 1

a3227 1
    def listKey = []
d3235 16
a3250 16
        def dataLine = []
        def dataBar = []
        def dataPie = []
        def dataArea = []
        if(DataToDrawChart.getDataToDrawLine(value) != []) {
            dataLine = DataToDrawChart.getDataToDrawLine(value)
        }
        if(DataToDrawChart.getDataToDrawBar(value) != []) {
            dataBar = DataToDrawChart.getDataToDrawBar(value)
        }
        if(DataToDrawChart.getDataToDrawPie(value) != []) {
            dataPie = DataToDrawChart.getDataToDrawPie(value)
        }
        if(DataToDrawChart.getDataToDrawArea(value) != []) {
            dataArea = DataToDrawChart.getDataToDrawArea(value)
        }
d3252 16
a3267 16
        def chartColumnsLine
        def chartColumnsBar 
        def chartColumnsArea 
        def lstName
        if(dataLine.size() &amp;gt; 0 ){
            chartColumnsLine = dataLine[0].chart_columns
        }
        if(dataBar.size() &amp;gt; 0){
            chartColumnsBar = dataBar[0].chart_columns
        }
        if(dataArea.size() &amp;gt; 0 ){
            chartColumnsArea = dataArea[0].chart_columns
        }
        if(dataPie.size() &amp;gt; 0 ){
            lstName = dataPie['name']
        }
d3269 4
a3272 11
        def tmpListNameContainer = []
	for(def nameContainer in lstName){
	   nameContainer = nameContainer.replaceAll("\\.", "_")
	   tmpListNameContainer.add(nameContainer)
	}
        def jsonPie
        def jsonLine
	def jsonBar
        def jsonArea
        if(dataPie != []) {
	    jsonPie = com.mongodb.util.JSON.serialize(dataPie)
d3274 16
a3289 9
        if(dataLine != []) {
	    jsonLine = com.mongodb.util.JSON.serialize(dataLine)
        }
        if(dataBar != []) {
            jsonBar = com.mongodb.util.JSON.serialize(dataBar)
        }
        if(dataArea != []) {
	    jsonArea = com.mongodb.util.JSON.serialize(dataArea)
        }
d3291 4
a3294 4
	def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
	def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
	def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
	def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)
d3296 17
a3312 17
	println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
        if(jsonLine != null) {
	    println "&amp;lt;textarea id=\"jsonline_$key\" &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;" 
        }
	if(jsonBar != null) {
            println "&amp;lt;textarea id=\"jsonbar_$key\"&amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
 	    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
        }
        if(jsonPie != null) {
	    println "&amp;lt;textarea id=\"jsonpie_$key\" &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
        }
        if(jsonArea != null) {
	    println "&amp;lt;textarea id=\"jsonarea_$key\" &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"
	    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
        }
d3314 32
a3345 32
	println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
	println "&amp;lt;input style=\"display:none\" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;"
	println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
	println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'
	println "&amp;lt;/div&amp;gt;"
	  
	def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
	def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
	  
	println "&amp;lt;div style='clear:both'&amp;gt;"
        def description = value.KEYEXPR._description[0][key]
        if(description != null) {
            println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +': ' + description +'&amp;lt;/div&amp;gt;'
        } else {
            println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +'&amp;lt;/div&amp;gt;'
        }
        println "-----"
        if(jsonPie != null) {
	  println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
	  lstName.each{
	    def tmp = it.replaceAll("\\.", "_")
	    println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
        if(jsonLine != null) {
	  def chartLineComment = false
	  chartColumnsLine.each{
	    if(!chartLineComment){
	       println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	       chartLineComment = true  
	    }
d3347 5
a3351 5
	      println " &amp;lt;div class=\"displayblock\" id=\"containerline${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
        println "&amp;amp;nbsp;"
d3353 7
a3359 7
        if(jsonBar != null) {
	  def chartBarComment = false
	  chartColumnsBar.each{
	     if(!chartBarComment){
	        println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	        chartBarComment = true
	      }  
d3361 5
a3365 5
	     println " &amp;lt;div class=\"displayblock\" id=\"containerbar${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
	println "&amp;amp;nbsp;"
d3367 21
a3387 13
        if(jsonArea != null) {
	  def chartAreaComment = false
	  chartColumnsArea.each{
	  if(!chartAreaComment){
	    println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	    chartAreaComment = true
	  }
	    println " &amp;lt;div class=\"displayblock\" id=\"containerarea${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
	println "&amp;lt;/div&amp;gt;"
        
d3389 1
a3389 1
    println '&amp;lt;/body&amp;gt;'
d3416 1
a3416 1
    println '&amp;lt;body&amp;gt;'
d3502 1
a3502 1
println '&amp;lt;/body&amp;gt;'
d3508 83
d3592 13
a3605 9
{{html wiki="true" clean="false"}}
&amp;lt;center&amp;gt;
&amp;lt;div id="livetblContent" style="width:100%;clear:both;align:middle;margin-top:10px"&amp;gt;   
    Statistics Data
    &amp;lt;table id="livetableList" style="width:100%;align:center"&amp;gt;&amp;lt;/table&amp;gt;
    &amp;lt;div id="livetablePager" style="position:relative;width:100%"&amp;gt;&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;/center&amp;gt;
{{/html}}
@


54.11
log
@@
text
@&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xwikidoc&gt;
&lt;web&gt;WiperDog&lt;/web&gt;
&lt;name&gt;WebHome&lt;/name&gt;
&lt;language&gt;&lt;/language&gt;
&lt;defaultLanguage&gt;en&lt;/defaultLanguage&gt;
&lt;translation&gt;0&lt;/translation&gt;
&lt;parent&gt;&lt;/parent&gt;
&lt;creator&gt;XWiki.Admin&lt;/creator&gt;
&lt;author&gt;XWiki.Admin&lt;/author&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;contentAuthor&gt;XWiki.Admin&lt;/contentAuthor&gt;
&lt;creationDate&gt;1376364375000&lt;/creationDate&gt;
&lt;date&gt;1376394071000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376394071000&lt;/contentUpdateDate&gt;
&lt;version&gt;54.11&lt;/version&gt;
&lt;title&gt;WiperDog&lt;/title&gt;
&lt;defaultTemplate&gt;&lt;/defaultTemplate&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;comment&gt;&lt;/comment&gt;
&lt;minorEdit&gt;true&lt;/minorEdit&gt;
&lt;syntaxId&gt;xwiki/2.1&lt;/syntaxId&gt;
&lt;hidden&gt;false&lt;/hidden&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;047293a8-524d-45e4-af52-cd944523d5d0&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
/*
 * jQuery timepicker addon
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 1.3.1
 * Last Modified: 07/07/2013
 *
 * Copyright 2013 Trent Richardson
 * You may use this project under MIT or GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 */

/*jslint evil: true, white: false, undef: false, nomen: false */

(function($) {

	/*
	* Lets not redefine timepicker, Prevent "Uncaught RangeError: Maximum call stack size exceeded"
	*/
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return;
	}

	/*
	* Extend jQueryUI, get it started with our version number
	*/
	$.extend($.ui, {
		timepicker: {
			version: "1.3.1"
		}
	});

	/* 
	* Timepicker manager.
	* Use the singleton instance of this class, $.timepicker, to interact with the time picker.
	* Settings for (groups of) time pickers are maintained in an instance object,
	* allowing multiple different settings on the same page.
	*/
	var Timepicker = function() {
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[''] = { // Default regional settings
			currentText: 'Now',
			closeText: 'Done',
			amNames: ['AM', 'A'],
			pmNames: ['PM', 'P'],
			timeFormat: 'HH:mm',
			timeSuffix: '',
			timeOnlyTitle: 'Choose Time',
			timeText: 'Time',
			hourText: 'Hour',
			minuteText: 'Minute',
			secondText: 'Second',
			millisecText: 'Millisecond',
			microsecText: 'Microsecond',
			timezoneText: 'Time Zone',
			isRTL: false
		};
		this._defaults = { // Global defaults for all the datetime picker instances
			showButtonPanel: true,
			timeOnly: false,
			showHour: null,
			showMinute: null,
			showSecond: null,
			showMillisec: null,
			showMicrosec: null,
			showTimezone: null,
			showTime: true,
			stepHour: 1,
			stepMinute: 1,
			stepSecond: 1,
			stepMillisec: 1,
			stepMicrosec: 1,
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null,
			hourMin: 0,
			minuteMin: 0,
			secondMin: 0,
			millisecMin: 0,
			microsecMin: 0,
			hourMax: 23,
			minuteMax: 59,
			secondMax: 59,
			millisecMax: 999,
			microsecMax: 999,
			minDateTime: null,
			maxDateTime: null,
			onSelect: null,
			hourGrid: 0,
			minuteGrid: 0,
			secondGrid: 0,
			millisecGrid: 0,
			microsecGrid: 0,
			alwaysSetTime: true,
			separator: ' ',
			altFieldTimeOnly: true,
			altTimeFormat: null,
			altSeparator: null,
			altTimeSuffix: null,
			pickerTimeFormat: null,
			pickerTimeSuffix: null,
			showTimepicker: true,
			timezoneList: null,
			addSliderAccess: false,
			sliderAccessArgs: null,
			controlType: 'slider',
			defaultValue: null,
			parse: 'strict'
		};
		$.extend(this._defaults, this.regional['']);
	};

	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: '',
		formattedDate: '',
		formattedTime: '',
		formattedDateTime: '',
		timezoneList: null,
		units: ['hour','minute','second','millisec', 'microsec'],
		support: {},
		control: null,

		/* 
		* Override the default settings for all instances of the time picker.
		* @@param  settings  object - the new settings to use as defaults (anonymous object)
		* @@return the manager object
		*/
		setDefaults: function(settings) {
			extendRemove(this._defaults, settings || {});
			return this;
		},

		/*
		* Create a new Timepicker instance
		*/
		_newInst: function($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
            	fns = {},
		    	overrides, i;

			for (var attrName in this._defaults) {
				if(this._defaults.hasOwnProperty(attrName)){
					var attrValue = $input.attr('time:' + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue);
						} catch (err) {
							inlineSettings[attrName] = attrValue;
						}
					}
				}
			}

		    overrides = {
		        beforeShow: function (input, dp_inst) {
		            if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
		                return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst);
		            }
		        },
		        onChangeMonthYear: function (year, month, dp_inst) {
		            // Update the time as well : this prevents the time from disappearing from the $input field.
		            tp_inst._updateDateTime(dp_inst);
		            if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
		                tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst);
		            }
		        },
		        onClose: function (dateText, dp_inst) {
		            if (tp_inst.timeDefined === true &amp;amp;&amp;amp; $input.val() !== '') {
		                tp_inst._updateDateTime(dp_inst);
		            }
		            if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
		                tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst);
		            }
		        }
		    };
		    for (i in overrides) {
		        if (overrides.hasOwnProperty(i)) {
		            fns[i] = opts[i] || null;
		        }
		    }

		    tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
		        evnts:fns,
		        timepicker: tp_inst // add timepicker as a property of datepicker: $.datepicker._get(dp_inst, 'timepicker');
		    });
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function(val) {
				return val.toUpperCase();
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function(val) {
				return val.toUpperCase();
			});

			// detect which units are supported
			tp_inst.support = detectSupport(
					tp_inst._defaults.timeFormat + 
					(tp_inst._defaults.pickerTimeFormat? tp_inst._defaults.pickerTimeFormat:'') + 
					(tp_inst._defaults.altTimeFormat? tp_inst._defaults.altTimeFormat:''));

			// controlType is string - key to our this._controls
			if(typeof(tp_inst._defaults.controlType) === 'string'){
				if(tp_inst._defaults.controlType == 'slider' &amp;amp;&amp;amp; typeof(jQuery.ui.slider) === 'undefined'){
					tp_inst._defaults.controlType = 'select';
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType];
			}
			// controlType is an object and must implement create, options, value methods
			else{ 
				tp_inst.control = tp_inst._defaults.controlType;
			}

			// prep the timezone options
			var timezoneList = [-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,
					0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList;
			}
			var tzl=timezoneList.length,tzi=0,tzv=null;
			if (tzl &amp;gt; 0 &amp;amp;&amp;amp; typeof timezoneList[0] !== 'object') {
				for(; tzi&amp;lt;tzl; tzi++){
					tzv = timezoneList[tzi];
					timezoneList[tzi] = { value: tzv, label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601) };
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;

			// set the default units
			tp_inst.timezone = tp_inst._defaults.timezone !== null? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) : 
							((new Date()).getTimezoneOffset()*-1);
			tp_inst.hour = tp_inst._defaults.hour &amp;lt; tp_inst._defaults.hourMin? tp_inst._defaults.hourMin : 
							tp_inst._defaults.hour &amp;gt; tp_inst._defaults.hourMax? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute &amp;lt; tp_inst._defaults.minuteMin? tp_inst._defaults.minuteMin : 
							tp_inst._defaults.minute &amp;gt; tp_inst._defaults.minuteMax? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second &amp;lt; tp_inst._defaults.secondMin? tp_inst._defaults.secondMin : 
							tp_inst._defaults.second &amp;gt; tp_inst._defaults.secondMax? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec &amp;lt; tp_inst._defaults.millisecMin? tp_inst._defaults.millisecMin : 
							tp_inst._defaults.millisec &amp;gt; tp_inst._defaults.millisecMax? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec &amp;lt; tp_inst._defaults.microsecMin? tp_inst._defaults.microsecMin : 
							tp_inst._defaults.microsec &amp;gt; tp_inst._defaults.microsecMax? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = '';
			tp_inst.$input = $input;

			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField).css({
					cursor: 'pointer'
				}).focus(function() {
					$input.trigger("focus");
				});
			}

			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date();
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date();
			}

			// datepicker needs minDate/maxDate, timepicker needs minDateTime/maxDateTime..
			if (tp_inst._defaults.minDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime());
			}
			if (tp_inst._defaults.minDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime());
			}
			if (tp_inst._defaults.maxDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime());
			}
			if (tp_inst._defaults.maxDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime());
			}
			tp_inst.$input.bind('focus', function() {
				tp_inst._onFocus();
			});

			return tp_inst;
		},

		/*
		* add our sliders to the calendar
		*/
		_addTimePicker: function(dp_inst) {
			var currDT = (this.$altInput &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly) ? this.$input.val() + ' ' + this.$altInput.val() : this.$input.val();

			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
		},

		/*
		* parse the time string from input value or _setTime
		*/
		_parseTime: function(timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0]);
			}

			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, 'dateFormat');
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false;
					}
					$.extend(this, parseRes.timeObj);
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err +
									"\ndate/time string = " + timeString +
									"\ntimeFormat = " + this._defaults.timeFormat +
									"\ndateFormat = " + dp_dateFormat);
					return false;
				}
				return true;
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false;
				}
				$.extend(this, timeObj);
				return true;
			}
		},

		/*
		* generate and inject html for timepicker into ui datepicker
		*/
		_injectTimePicker: function() {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = '',
				uitem = '',
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i=0,
				l=0;

			// Prevent displaying twice
			if ($dp.find("div.ui-timepicker-div").length === 0 &amp;amp;&amp;amp; o.showTimepicker) {
				var noDisplay = ' style="display:none;"',
					html = '&amp;lt;div class="ui-timepicker-div'+ (o.isRTL? ' ui-timepicker-rtl' : '') +'"&amp;gt;&amp;lt;dl&amp;gt;' + '&amp;lt;dt class="ui_tpicker_time_label"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;' + o.timeText + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_time"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the markup
				for(i=0,l=this.units.length; i&amp;lt;l; i++){
					litem = this.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// Added by Peter Medeiros:
					// - Figure out what the hour/minute/second max should be based on the step values.
					// - Example: if stepMinute is 15, then minMax is 45.
					max[litem] = parseInt((o[litem+'Max'] - ((o[litem+'Max'] - o[litem+'Min']) % o['step'+uitem])), 10);
					gridSize[litem] = 0;

					html += '&amp;lt;dt class="ui_tpicker_'+ litem +'_label"' + (show ? '' : noDisplay) + '&amp;gt;' + o[litem +'Text'] + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_'+ litem +'"&amp;gt;&amp;lt;div class="ui_tpicker_'+ litem +'_slider"' + (show ? '' : noDisplay) + '&amp;gt;&amp;lt;/div&amp;gt;';

					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						html += '&amp;lt;div style="padding-left: 1px"&amp;gt;&amp;lt;table class="ui-tpicker-grid-label"&amp;gt;&amp;lt;tr&amp;gt;';

						if(litem == 'hour'){
							for (var h = o[litem+'Min']; h &amp;lt;= max[litem]; h += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm? 'hht':'HH', {hour:h}, o);									
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + tmph + '&amp;lt;/td&amp;gt;';
							}
						}
						else{
							for (var m = o[litem+'Min']; m &amp;lt;= max[litem]; m += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + ((m &amp;lt; 10) ? '0' : '') + m + '&amp;lt;/td&amp;gt;';
							}
						}

						html += '&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;&amp;lt;/div&amp;gt;';
					}
					html += '&amp;lt;/dd&amp;gt;';
				}
				
				// Timezone
				var showTz = o.showTimezone !== null? o.showTimezone : this.support.timezone;
				html += '&amp;lt;dt class="ui_tpicker_timezone_label"' + (showTz ? '' : noDisplay) + '&amp;gt;' + o.timezoneText + '&amp;lt;/dt&amp;gt;';
				html += '&amp;lt;dd class="ui_tpicker_timezone" ' + (showTz ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the elements from string
				html += '&amp;lt;/dl&amp;gt;&amp;lt;/div&amp;gt;';
				var $tp = $(html);

				// if we only want time picker...
				if (o.timeOnly === true) {
					$tp.prepend('&amp;lt;div class="ui-widget-header ui-helper-clearfix ui-corner-all"&amp;gt;' + '&amp;lt;div class="ui-datepicker-title"&amp;gt;' + o.timeOnlyTitle + '&amp;lt;/div&amp;gt;' + '&amp;lt;/div&amp;gt;');
					$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();
				}
				
				// add sliders, adjust grids, add events
				for(i=0,l=tp_inst.units.length; i&amp;lt;l; i++){
					litem = tp_inst.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// add the slider
					tp_inst[litem+'_slider'] = tp_inst.control.create(tp_inst, $tp.find('.ui_tpicker_'+litem+'_slider'), litem, tp_inst[litem], o[litem+'Min'], max[litem], o['step'+uitem]);

					// adjust the grid and add click event
					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						size = 100 * gridSize[litem] * o[litem+'Grid'] / (max[litem] - o[litem+'Min']);
						$tp.find('.ui_tpicker_'+litem+' table').css({
							width: size + "%",
							marginLeft: o.isRTL? '0' : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL? ((size / (-2 * gridSize[litem])) + "%") : '0',
							borderCollapse: 'collapse'
						}).find("td").click(function(e){
								var $t = $(this),
									h = $t.html(),
									n = parseInt(h.replace(/[^0-9]/g),10),
									ap = h.replace(/[^apm]/ig),
									f = $t.data('for'); // loses scope, so we use data-for

								if(f == 'hour'){
									if(ap.indexOf('p') !== -1 &amp;amp;&amp;amp; n &amp;lt; 12){
										n += 12;
									}
									else{
										if(ap.indexOf('a') !== -1 &amp;amp;&amp;amp; n === 12){
											n = 0;
										}
									}
								}
								
								tp_inst.control.value(tp_inst, tp_inst[f+'_slider'], litem, n);

								tp_inst._onTimeChange();
								tp_inst._onSelectHandler();
							}).css({
								cursor: 'pointer',
								width: (100 / gridSize[litem]) + '%',
								textAlign: 'center',
								overflow: 'hidden'
							});
					} // end if grid &amp;gt; 0
				} // end for loop

				// Add timezone options
				this.timezone_select = $tp.find('.ui_tpicker_timezone').append('&amp;lt;select&amp;gt;&amp;lt;/select&amp;gt;').find("select");
				$.fn.append.apply(this.timezone_select,
				$.map(o.timezoneList, function(val, idx) {
					return $("&amp;lt;option /&amp;gt;").val(typeof val == "object" ? val.value : val).text(typeof val == "object" ? val.label : val);
				}));
				if (typeof(this.timezone) != "undefined" &amp;amp;&amp;amp; this.timezone !== null &amp;amp;&amp;amp; this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset()*-1;
					if (local_timezone == this.timezone) {
						selectLocalTimezone(tp_inst);
					} else {
						this.timezone_select.val(this.timezone);
					}
				} else {
					if (typeof(this.hour) != "undefined" &amp;amp;&amp;amp; this.hour !== null &amp;amp;&amp;amp; this.hour !== "") {
						this.timezone_select.val(o.timezone);
					} else {
						selectLocalTimezone(tp_inst);
					}
				}
				this.timezone_select.change(function() {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
				});
				// End timezone options
				
				// inject timepicker into datepicker
				var $buttonPanel = $dp.find('.ui-datepicker-buttonpane');
				if ($buttonPanel.length) {
					$buttonPanel.before($tp);
				} else {
					$dp.append($tp);
				}

				this.$timeObj = $tp.find('.ui_tpicker_time');

				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined;
				}

				// slideAccess integration: http://trentrichardson.com/2011/11/11/jquery-ui-sliders-and-touch-accessibility/
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
						
					setTimeout(function() { // fix for inline mode
						if ($tp.find('.ui-slider-access').length === 0) {
							$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);

							// fix any grids since sliders are shorter
							var sliderAccessWidth = $tp.find('.ui-slider-access:eq(0)').outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find('table:visible').each(function() {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl? 'marginRight':'marginLeft').toString().replace('%', ''),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + '%',
										css = { width: newWidth, marginRight: 0, marginLeft: 0 };
									css[rtl? 'marginRight':'marginLeft'] = newMarginLeft;
									$g.css(css);
								});
							}
						}
					}, 10);
				}
				// end slideAccess integration

				tp_inst._limitMinMaxDateTime(this.inst, true);
			}
		},

		/*
		* This function tries to limit the ability to go outside the
		* min/max date range
		*/
		_limitMinMaxDateTime: function(dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);

			if (!this._defaults.showTimepicker) {
				return;
			} // No time so nothing to check here

			if ($.datepicker._get(dp_inst, 'minDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'minDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, 'minDateTime'),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin;
				}

				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour &amp;lt;= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute &amp;lt;= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second &amp;lt;= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if(this.millisec &amp;lt;= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;lt; this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin;
									}
									this._defaults.microsecMin = this.microsecMinOriginal;
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal;
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal;
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal;
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal;
				}
			}

			if ($.datepicker._get(dp_inst, 'maxDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'maxDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, 'maxDateTime'),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax;
				}

				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour &amp;gt;= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute &amp;gt;= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second &amp;gt;= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec &amp;gt;= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;gt; this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax;
									}
									this._defaults.microsecMax = this.microsecMaxOriginal;
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal;
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal;
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal;
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal;
				}
			}

			if (adjustSliders !== undefined &amp;amp;&amp;amp; adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10);
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);

				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, 'hour', { min: this._defaults.hourMin, max: hourMax });
					this.control.value(this, this.hour_slider, 'hour', this.hour - (this.hour % this._defaults.stepHour));
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, 'minute', { min: this._defaults.minuteMin, max: minMax });
					this.control.value(this, this.minute_slider, 'minute', this.minute - (this.minute % this._defaults.stepMinute));
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, 'second', { min: this._defaults.secondMin, max: secMax });
					this.control.value(this, this.second_slider, 'second', this.second - (this.second % this._defaults.stepSecond));
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, 'millisec', { min: this._defaults.millisecMin, max: millisecMax });
					this.control.value(this, this.millisec_slider, 'millisec', this.millisec - (this.millisec % this._defaults.stepMillisec));
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, 'microsec', { min: this._defaults.microsecMin, max: microsecMax });
					this.control.value(this, this.microsec_slider, 'microsec', this.microsec - (this.microsec % this._defaults.stepMicrosec));
				}
			}

		},

		/*
		* when a slider moves, set the internal time...
		* on time change is also called when the time is updated in the text field
		*/
		_onTimeChange: function() {
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, 'hour') : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, 'minute') : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, 'second') : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, 'millisec') : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, 'microsec') : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;

			if (typeof(hour) == 'object') {
				hour = false;
			}
			if (typeof(minute) == 'object') {
				minute = false;
			}
			if (typeof(second) == 'object') {
				second = false;
			}
			if (typeof(millisec) == 'object') {
				millisec = false;
			}
			if (typeof(microsec) == 'object') {
				microsec = false;
			}
			if (typeof(timezone) == 'object') {
				timezone = false;
			}

			if (hour !== false) {
				hour = parseInt(hour, 10);
			}
			if (minute !== false) {
				minute = parseInt(minute, 10);
			}
			if (second !== false) {
				second = parseInt(second, 10);
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10);
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10);
			}

			var ampm = o[hour &amp;lt; 12 ? 'amNames' : 'pmNames'][0];

			// If the update was done in the input field, the input field should not be updated.
			// If the update was done using the sliders, update the input field.
			var hasChanged = (hour != this.hour || minute != this.minute || second != this.second || millisec != this.millisec || microsec != this.microsec 
								|| (this.ampm.length &amp;gt; 0 &amp;amp;&amp;amp; (hour &amp;lt; 12) != ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) 
								|| (this.timezone !== null &amp;amp;&amp;amp; timezone != this.timezone));

			if (hasChanged) {

				if (hour !== false) {
					this.hour = hour;
				}
				if (minute !== false) {
					this.minute = minute;
				}
				if (second !== false) {
					this.second = second;
				}
				if (millisec !== false) {
					this.millisec = millisec;
				}
				if (microsec !== false) {
					this.microsec = microsec;
				}
				if (timezone !== false) {
					this.timezone = timezone;
				}

				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0]);
				}

				this._limitMinMaxDateTime(this.inst, true);
			}
			if (this.support.ampm) {
				this.ampm = ampm;
			}

			// Updates the time within the timepicker
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if(pickerTimeFormat === o.timeFormat){
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix);
				}
				else{
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix);
				}
			}

			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime();
			}
		},

		/*
		* call custom onSelect.
		* bind to sliders slidestop, and grid click.
		*/
		_onSelectHandler: function() {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect &amp;amp;&amp;amp; inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this]);
			}
		},

		/*
		* update our input with the new date time..
		*/
		_updateDateTime: function(dp_inst) {
			dp_inst = this.inst || dp_inst;
			//var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
			var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay)),
				dateFmt = $.datepicker._get(dp_inst, 'dateFormat'),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null &amp;amp;&amp;amp; this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			
			// if a slider was changed but datepicker doesn't have a value yet, set it
			if(dp_inst.lastVal===""){
                dp_inst.currentYear=dp_inst.selectedYear;
                dp_inst.currentMonth=dp_inst.selectedMonth;
                dp_inst.currentDay=dp_inst.selectedDay;
            }

			/*
			* remove following lines to force every changes in date picker to change the input value
			* Bug descriptions: when an input field has a default value, and click on the field to pop up the date picker. 
			* If the user manually empty the value in the input field, the date picker will never change selected value.
			*/
			//if (dp_inst.lastVal !== undefined &amp;amp;&amp;amp; (dp_inst.lastVal.length &amp;gt; 0 &amp;amp;&amp;amp; this.$input.val().length === 0)) {
			//	return;
			//}

			if (this._defaults.timeOnly === true) {
				formattedDateTime = this.formattedTime;
			} else if (this._defaults.timeOnly !== true &amp;amp;&amp;amp; (this._defaults.alwaysSetTime || timeAvailable)) {
				formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix;
			}

			this.formattedDateTime = formattedDateTime;

			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate);
			} else if (this.$altInput &amp;amp;&amp;amp; this._defaults.timeOnly === false &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly === true) {
				this.$altInput.val(this.formattedTime);
				this.$input.val(this.formattedDate);
			} else if (this.$altInput) {
				this.$input.val(formattedDateTime);
				var altFormattedDateTime = '',
					altSeparator = this._defaults.altSeparator ? this._defaults.altSeparator : this._defaults.separator,
					altTimeSuffix = this._defaults.altTimeSuffix ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
				
				if(!this._defaults.timeOnly){
					if (this._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg);
					}
					else{
						altFormattedDateTime = this.formattedDate;
					}

					if (altFormattedDateTime){
						altFormattedDateTime += altSeparator;
					}
				}

				if(this._defaults.altTimeFormat){
					altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix;
				}
				else{
					altFormattedDateTime += this.formattedTime + altTimeSuffix;
				}
				this.$altInput.val(altFormattedDateTime);
			} else {
				this.$input.val(formattedDateTime);
			}

			this.$input.trigger("change");
		},

		_onFocus: function() {
			if (!this.$input.val() &amp;amp;&amp;amp; this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, 'timepicker');
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst);
						} catch (err) {
							$.timepicker.log(err);
						}
					}
				}
			}
		},

		/*
		* Small abstraction to control types
		* We can add more, just be sure to follow the pattern: create, options, value
		*/
		_controls: {
			// slider methods
			slider: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var rtl = tp_inst._defaults.isRTL; // if rtl go -60-&amp;gt;0 instead of 0-&amp;gt;60
					return obj.prop('slide', null).slider({
						orientation: "horizontal",
						value: rtl? val*-1 : val,
						min: rtl? max*-1 : min,
						max: rtl? min*-1 : max,
						step: step,
						slide: function(event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl? ui.value*-1:ui.value);
							tp_inst._onTimeChange();
						},
						stop: function(event, ui) {
							tp_inst._onSelectHandler();
						}
					});	
				},
				options: function(tp_inst, obj, unit, opts, val){
					if(tp_inst._defaults.isRTL){
						if(typeof(opts) == 'string'){
							if(opts == 'min' || opts == 'max'){
								if(val !== undefined){
									return obj.slider(opts, val*-1);
								}
								return Math.abs(obj.slider(opts));
							}
							return obj.slider(opts);
						}
						var min = opts.min, 
							max = opts.max;
						opts.min = opts.max = null;
						if(min !== undefined){
							opts.max = min * -1;
						}
						if(max !== undefined){
							opts.min = max * -1;
						}
						return obj.slider(opts);
					}
					if(typeof(opts) == 'string' &amp;amp;&amp;amp; val !== undefined){
							return obj.slider(opts, val);
					}
					return obj.slider(opts);
				},
				value: function(tp_inst, obj, unit, val){
					if(tp_inst._defaults.isRTL){
						if(val !== undefined){
							return obj.slider('value', val*-1);
						}
						return Math.abs(obj.slider('value'));
					}
					if(val !== undefined){
						return obj.slider('value', val);
					}
					return obj.slider('value');
				}
			},
			// select methods
			select: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var sel = '&amp;lt;select class="ui-timepicker-select" data-unit="'+ unit +'" data-min="'+ min +'" data-max="'+ max +'" data-step="'+ step +'"&amp;gt;',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;

					for(var i=min; i&amp;lt;=max; i+=step){						
						sel += '&amp;lt;option value="'+ i +'"'+ (i==val? ' selected':'') +'&amp;gt;';
						if(unit == 'hour'){
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig,'')), {hour:i}, tp_inst._defaults);
						}
						else if(unit == 'millisec' || unit == 'microsec' || i &amp;gt;= 10){ sel += i; }
						else {sel += '0'+ i.toString(); }
						sel += '&amp;lt;/option&amp;gt;';
					}
					sel += '&amp;lt;/select&amp;gt;';

					obj.children('select').remove();

					$(sel).appendTo(obj).change(function(e){
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
					});

					return obj;
				},
				options: function(tp_inst, obj, unit, opts, val){
					var o = {},
						$t = obj.children('select');
					if(typeof(opts) == 'string'){
						if(val === undefined){
							return $t.data(opts);
						}
						o[opts] = val;	
					}
					else{ o = opts; }
					return tp_inst.control.create(tp_inst, obj, $t.data('unit'), $t.val(), o.min || $t.data('min'), o.max || $t.data('max'), o.step || $t.data('step'));
				},
				value: function(tp_inst, obj, unit, val){
					var $t = obj.children('select');
					if(val !== undefined){
						return $t.val(val);
					}
					return $t.val();
				}
			}
		} // end _controls

	});

	$.fn.extend({
		/*
		* shorthand just to use timepicker..
		*/
		timepicker: function(o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);

			if (typeof o == 'object') {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				});
			}

			return $(this).each(function() {
				$.fn.datetimepicker.apply($(this), tmp_args);
			});
		},

		/*
		* extend timepicker to datepicker
		*/
		datetimepicker: function(o) {
			o = o || {};
			var tmp_args = arguments;

			if (typeof(o) == 'string') {
				if (o == 'getDate') {
					return $.fn.datepicker.apply($(this[0]), tmp_args);
				} else {
					return this.each(function() {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args);
					});
				}
			} else {
				return this.each(function() {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults);
				});
			}
		}
	});

	/*
	* Public Utility to parse date and time
	*/
	$.datepicker.parseDateTime = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec);
		}

		return parseRes.date;
	};

	/*
	* Public utility to parse time
	*/
	$.datepicker.parseTime = function(timeFormat, timeString, options) {		
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g,'').indexOf('Z') !== -1);

		// Strict parse requires the timeString to match the timeFormat exactly
		var strictParse = function(f, s, o){

			// pattern for standard and localized AM/PM markers
			var getPatternAmpm = function(amNames, pmNames) {
				var markers = [];
				if (amNames) {
					$.merge(markers, amNames);
				}
				if (pmNames) {
					$.merge(markers, pmNames);
				}
				markers = $.map(markers, function(val) {
					return val.replace(/[.*+?|()\[\]{}\\]/g, '\\$&amp;amp;');
				});
				return '(' + markers.join('|') + ')?';
			};

			// figure out position of time elements.. cause js cant do named captures
			var getFormatPositions = function(timeFormat) {
				var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
					orders = {
						h: -1,
						m: -1,
						s: -1,
						l: -1,
						c: -1,
						t: -1,
						z: -1
					};

				if (finds) {
					for (var i = 0; i &amp;lt; finds.length; i++) {
						if (orders[finds[i].toString().charAt(0)] == -1) {
							orders[finds[i].toString().charAt(0)] = i + 1;
						}
					}
				}
				return orders;
			};

			var regstr = '^' + f.toString()
					.replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
							var ml = match.length;
							switch (match.charAt(0).toLowerCase()) {
								case 'h': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'm': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 's': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'l': return '(\\d?\\d?\\d)';
								case 'c': return '(\\d?\\d?\\d)';
								case 'z': return '(z|[-+]\\d\\d:?\\d\\d|\\S+)?';
								case 't': return getPatternAmpm(o.amNames, o.pmNames);
								default:    // literal escaped in quotes
									return '(' + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function (m) { return "\\" + m; }) + ')?';
							}
						})
					.replace(/\s/g, '\\s?') +
					o.timeSuffix + '$',
				order = getFormatPositions(f),
				ampm = '',
				treg;

			treg = s.match(new RegExp(regstr, 'i'));

			var resTime = {
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0
			};

			if (treg) {
				if (order.t !== -1) {
					if (treg[order.t] === undefined || treg[order.t].length === 0) {
						ampm = '';
						resTime.ampm = '';
					} else {
						ampm = $.inArray(treg[order.t].toUpperCase(), o.amNames) !== -1 ? 'AM' : 'PM';
						resTime.ampm = o[ampm == 'AM' ? 'amNames' : 'pmNames'][0];
					}
				}

				if (order.h !== -1) {
					if (ampm == 'AM' &amp;amp;&amp;amp; treg[order.h] == '12') {
						resTime.hour = 0; // 12am = 0 hour
					} else {
						if (ampm == 'PM' &amp;amp;&amp;amp; treg[order.h] != '12') {
							resTime.hour = parseInt(treg[order.h], 10) + 12; // 12pm = 12 hour, any other pm = hour + 12
						} else {
							resTime.hour = Number(treg[order.h]);
						}
					}
				}

				if (order.m !== -1) {
					resTime.minute = Number(treg[order.m]);
				}
				if (order.s !== -1) {
					resTime.second = Number(treg[order.s]);
				}
				if (order.l !== -1) {
					resTime.millisec = Number(treg[order.l]);
				}
				if (order.c !== -1) {
					resTime.microsec = Number(treg[order.c]);
				}
				if (order.z !== -1 &amp;amp;&amp;amp; treg[order.z] !== undefined) {
					resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z]);
				}


				return resTime;
			}
			return false;
		};// end strictParse

		// First try JS Date, if that fails, use strictParse
		var looseParse = function(f,s,o){
			try{
				var d = new Date('2012-01-01 '+ s);
				if(isNaN(d.getTime())){
					d = new Date('2012-01-01T'+ s);
					if(isNaN(d.getTime())){
						d = new Date('01/01/2012 '+ s);
						if(isNaN(d.getTime())){
							throw "Unable to parse time with native Date: "+ s;
						}
					}
				}

				return {
					hour: d.getHours(),
					minute: d.getMinutes(),
					second: d.getSeconds(),
					millisec: d.getMilliseconds(),
					microsec: d.getMicroseconds(),
					timezone: d.getTimezoneOffset()*-1
				};
			}
			catch(err){
				try{
					return strictParse(f,s,o);
				}
				catch(err2){
					$.timepicker.log("Unable to parse \ntimeString: "+ s +"\ntimeFormat: "+ f);
				}				
			}
			return false;
		}; // end looseParse
		
		if(typeof o.parse === "function"){
			return o.parse(timeFormat, timeString, o);
		}
		if(o.parse === 'loose'){
			return looseParse(timeFormat, timeString, o);
		}
		return strictParse(timeFormat, timeString, o);
	};

	/*
	* Public utility to format the time
	* format = string format of the time
	* time = a {}, not a Date() for timezones
	* options = essentially the regional[].. amNames, pmNames, ampm
	*/
	$.datepicker.formatTime = function(format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			timezone: 0
		}, time);

		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);

		if (hour &amp;gt; 11) {
			ampmName = options.pmNames[0];
		}

		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|('.*?'|".*?"))/g, function(match) {
		switch (match) {
			case 'HH':
				return ('0' + hour).slice(-2);
			case 'H':
				return hour;
			case 'hh':
				return ('0' + convert24to12(hour)).slice(-2);
			case 'h':
				return convert24to12(hour);
			case 'mm':
				return ('0' + time.minute).slice(-2);
			case 'm':
				return time.minute;
			case 'ss':
				return ('0' + time.second).slice(-2);
			case 's':
				return time.second;
			case 'l':
				return ('00' + time.millisec).slice(-3);
			case 'c':
				return ('00' + time.microsec).slice(-3);
			case 'z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, false);
			case 'Z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, true);
			case 'T': 
				return ampmName.charAt(0).toUpperCase();
			case 'TT': 
				return ampmName.toUpperCase();
			case 't':
				return ampmName.charAt(0).toLowerCase();
			case 'tt':
				return ampmName.toLowerCase();
			default:
				return match.replace(/\'/g, "") || "'";
			}
		});

		tmptime = $.trim(tmptime);
		return tmptime;
	};

	/*
	* the bad hack :/ override datepicker so it doesnt close on select
	// inspired: http://stackoverflow.com/questions/1252512/jquery-datepicker-prevent-closing-picker-when-clicking-a-date/1762378#1762378
	*/
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function(id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			tp_inst._limitMinMaxDateTime(inst, true);
			inst.inline = inst.stay_open = true;
			//This way the onSelect handler called from calendarpicker get the full dateTime
			this._base_selectDate(id, dateStr);
			inst.inline = inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst);
		} else {
			this._base_selectDate(id, dateStr);
		}
	};

	/*
	* second bad hack :/ override datepicker so it triggers an event when changing the input field
	* and does not redraw the datepicker on every selectDate event
	*/
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function(inst) {

		// don't popup the datepicker if there is another instance already opened
		var input = inst.input[0];
		if ($.datepicker._curInst &amp;amp;&amp;amp; $.datepicker._curInst != inst &amp;amp;&amp;amp; $.datepicker._datepickerShowing &amp;amp;&amp;amp; $.datepicker._lastInput != input) {
			return;
		}

		if (typeof(inst.stay_open) !== 'boolean' || inst.stay_open === false) {

			this._base_updateDatepicker(inst);

			// Reload the time control when changing something in the input text field.
			var tp_inst = this._get(inst, 'timepicker');
			if (tp_inst) {
				tp_inst._addTimePicker(inst);
			}
		}
	};

	/*
	* third bad hack :/ override datepicker so it allows spaces and colon in the input field
	*/
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if ($.datepicker._get(inst, 'constrainInput')) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null? tp_inst._defaults.showTimezone : tp_inst.support.timezone,					
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat')),
					datetimeChars = tp_inst._defaults.timeFormat.toString()
											.replace(/[hms]/g, '')
											.replace(/TT/g, ampm ? 'APM' : '')
											.replace(/Tt/g, ampm ? 'AaPpMm' : '')
											.replace(/tT/g, ampm ? 'AaPpMm' : '')
											.replace(/T/g, ampm ? 'AP' : '')
											.replace(/tt/g, ampm ? 'apm' : '')
											.replace(/t/g, ampm ? 'ap' : '') + 
											" " + tp_inst._defaults.separator + 
											tp_inst._defaults.timeSuffix + 
											(tz ? tp_inst._defaults.timezoneList.join('') : '') + 
											(tp_inst._defaults.amNames.join('')) + (tp_inst._defaults.pmNames.join('')) + 
											dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr &amp;lt; ' ' || !dateChars || datetimeChars.indexOf(chr) &amp;gt; -1);
			}
		}

		return $.datepicker._base_doKeyPress(event);
	};

	/*
	* Fourth bad hack :/ override _updateAlternate function used in inline mode to init altField
	*/
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	/* Update any alternate field to synchronise with the main field. */
	$.datepicker._updateAlternate = function(inst) {
		var tp_inst = this._get(inst, 'timepicker');
		if(tp_inst){
			var altField = tp_inst._defaults.altField;
			if (altField) { // update alternate field too
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = '', 
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator, 
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if(!tp_inst._defaults.timeOnly &amp;amp;&amp;amp; !tp_inst._defaults.altFieldTimeOnly &amp;amp;&amp;amp; date !== null){
					if(tp_inst._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime;
					}
					else{
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime;
					}
				}
				$(altField).val(altFormattedDateTime);
			}
		}
		else{
			$.datepicker._base_updateAlternate(inst);
		}
	};

	/*
	* Override key up event to sync manual input changes.
	*/
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst);
				} catch (err) {
					$.timepicker.log(err);
				}
			}
		}

		return $.datepicker._base_doKeyUp(event);
	};

	/*
	* override "Today" button to also grab the time.
	*/
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function(id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		this._base_gotoToday(id);
		var tp_inst = this._get(inst, 'timepicker');
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		$('.ui-datepicker-today', $dp).click();
	};

	/*
	* Disable &amp;amp; enable the Time in the datetimepicker
	*/
	$.datepicker._disableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst);
		}
	};

	$.datepicker._enableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst); // Could be disabled on page load
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create our own set time function
	*/
	$.datepicker._setTime = function(inst, date) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var defaults = tp_inst._defaults;

			// calling _setTime with no date sets time to defaults
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;

			//check if within min/max times.. 
			tp_inst._limitMinMaxDateTime(inst, true);

			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create new public method to set only time, callable as $().datepicker('setTime', date)
	*/
	$.datepicker._setTimeDatepicker = function(target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date == "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec);
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds());
				}
				if (tp_date.toString() == 'Invalid Date') {
					tp_date = undefined;
				}
				this._setTime(inst, tp_date);
			}
		}

	};

	/*
	* override setDate() to allow setting time too within Date object
	*/
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function(target, date) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		if(typeof(date) === 'string'){
			date = new Date(date);
			if(!date.getTime()){
				$.timepicker.log("Error creating Date object from string.");
			}
		}

		var tp_inst = this._get(inst, 'timepicker');
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds());
		} else {
			tp_date = date;
		}
		
		// This is important if you are using the timezone option, javascript's Date 
		// object will only return the timezone offset for the current locale, so we 
		// adjust it accordingly.  If not using timezone option this won't matter..
		// If a timezone is different in tp, keep the timezone as is
		if(tp_inst){
			// look out for DST if tz wasn't specified
			if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
				tp_inst.timezone = tp_date.getTimezoneOffset()*-1;
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone);
		}

		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true);
	};

	/*
	* override getDate() to allow getting time too within Date object
	*/
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function(target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			// if it hasn't yet been defined, grab from field
			if(inst.lastVal === undefined){
				this._setDateFromField(inst, noDefault);
			}

			var date = this._getDate(inst);
			if (date &amp;amp;&amp;amp; tp_inst._parseTime($(target).val(), tp_inst.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);

				// This is important if you are using the timezone option, javascript's Date 
				// object will only return the timezone offset for the current locale, so we 
				// adjust it accordingly.  If not using timezone option this won't matter..
				if(tp_inst.timezone != null){
					// look out for DST if tz wasn't specified
					if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
						tp_inst.timezone = date.getTimezoneOffset()*-1;
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
				}
			}
			return date;
		}
		return this._base_getDateDatepicker(target, noDefault);
	};

	/*
	* override parseDate() because UI 1.8.14 throws an error about "Extra characters"
	* An option in datapicker to ignore extra format characters would be nicer.
	*/
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function(format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings);
		} catch (err) {
			// Hack!  The error message ends with a colon, a space, and
			// the "extra" characters.  We rely on that instead of
			// attempting to perfectly reproduce the parsing algorithm.
			if (err.indexOf(":") &amp;gt;= 0) {
				date = this._base_parseDate(format, value.substring(0,value.length-(err.length-err.indexOf(':')-2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format);
			} else {
				throw err;
			}
		}
		return date;
	};

	/*
	* override formatDate to set date with time to the input
	*/
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function(inst, day, month, year) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val();
		}
		return this._base_formatDate(inst);
	};

	/*
	* override options setter to add time to maxDate(Time) and minDate(Time). MaxDate
	*/
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function(target, name, value) {
		var inst = this._getInst(target),
	        name_clone;
		if (!inst) {
			return null;
		}

		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop;
		    if (typeof name == 'string') { // if min/max was set with the string
		        if (name === 'minDate' || name === 'minDateTime') {
		            min = value;
		        } else if (name === 'maxDate' || name === 'maxDateTime') {
		            max = value;
		        } else if (name === 'onSelect') {
		            onselect = value;
		        } else if (overrides.hasOwnProperty(name)) {
		            if (typeof (value) === 'undefined') {
		                return overrides[name];
		            }
		            fns[name] = value;
		            name_clone = {}; //empty results in exiting function after overrides updated
		        }
		    } else if (typeof name == 'object') { //if min/max was set with the JSON
		        if (name.minDate) {
		            min = name.minDate;
		        } else if (name.minDateTime) {
		            min = name.minDateTime;
		        } else if (name.maxDate) {
		            max = name.maxDate;
		        } else if (name.maxDateTime) {
		            max = name.maxDateTime;
		        }
		        for (prop in overrides) {
		            if (overrides.hasOwnProperty(prop) &amp;amp;&amp;amp; name[prop]) {
		                fns[prop] = name[prop];
		            }
		        }
		    }
		    for (prop in fns) {
		        if (fns.hasOwnProperty(prop)) {
		            overrides[prop] = fns[prop];
		            if (!name_clone) { name_clone = $.extend({}, name);}
		            delete name_clone[prop];
		        }
		    }
		    if (name_clone &amp;amp;&amp;amp; isEmptyObject(name_clone)) { return; }
		    if (min) { //if min was set
		        if (min === 0) {
		            min = new Date();
		        } else {
		            min = new Date(min);
		        }
		        tp_inst._defaults.minDate = min;
		        tp_inst._defaults.minDateTime = min;
		    } else if (max) { //if max was set
		        if (max === 0) {
		            max = new Date();
		        } else {
		            max = new Date(max);
		        }
		        tp_inst._defaults.maxDate = max;
		        tp_inst._defaults.maxDateTime = max;
		    } else if (onselect) {
		        tp_inst._defaults.onSelect = onselect;
		    }
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name);
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
	};
	
	/*
	* jQuery isEmptyObject does not check hasOwnProperty - if someone has added to the object prototype,
	* it will return false for all objects
	*/
	var isEmptyObject = function(obj) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(obj)) {
				return false;
			}
		}
		return true;
	};

	/*
	* jQuery extend now ignores nulls!
	*/
	var extendRemove = function(target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] === null || props[name] === undefined) {
				target[name] = props[name];
			}
		}
		return target;
	};

	/*
	* Determine by the time format which units are supported
	* Returns an object of booleans for each unit
	*/
	var detectSupport = function(timeFormat){
		var tf = timeFormat.replace(/\'.*?\'/g,'').toLowerCase(), // removes literals
			isIn = function(f, t){ // does the format contain the token?
					return f.indexOf(t) !== -1? true:false; 
				};
		return {
				hour: isIn(tf,'h'),
				minute: isIn(tf,'m'),
				second: isIn(tf,'s'),
				millisec: isIn(tf,'l'),
				microsec: isIn(tf,'c'),
				timezone: isIn(tf,'z'),
				ampm: isIn(tf,'t') &amp;amp;&amp;amp; isIn(timeFormat,'h'),
				iso8601: isIn(timeFormat, 'Z')
			};
	};

	/*
	* Converts 24 hour format into 12 hour
	* Returns 12 hour without leading 0
	*/
	var convert24to12 = function(hour) {
		if (hour &amp;gt; 12) {
			hour = hour - 12;
		}

		if (hour === 0) {
			hour = 12;
		}

		return String(hour);
	};

	/*
	* Splits datetime string into date ans time substrings.
	* Throws exception when date can't be parsed
	* Returns [dateString, timeString]
	*/
	var splitDateTime = function(dateFormat, dateTimeString, dateSettings, timeSettings) {
		try {
			// The idea is to get the number separator occurances in datetime and the time format requested (since time has 
			// fewer unknowns, mostly numbers and am/pm). We will use the time pattern to split.
			var separator = timeSettings &amp;amp;&amp;amp; timeSettings.separator ? timeSettings.separator : $.timepicker._defaults.separator,
				format = timeSettings &amp;amp;&amp;amp; timeSettings.timeFormat ? timeSettings.timeFormat : $.timepicker._defaults.timeFormat,
				timeParts = format.split(separator), // how many occurances of separator may be in our format?
				timePartsLen = timeParts.length,
				allParts = dateTimeString.split(separator),
				allPartsLen = allParts.length;

			if (allPartsLen &amp;gt; 1) {
				return [
						allParts.splice(0,allPartsLen-timePartsLen).join(separator),
						allParts.splice(0,timePartsLen).join(separator)
					];
			}

		} catch (err) {
			$.timepicker.log('Could not split the date from the time. Please check the following datetimepicker options' +
					"\nthrown error: " + err +
					"\ndateTimeString" + dateTimeString +
					"\ndateFormat = " + dateFormat +
					"\nseparator = " + timeSettings.separator +
					"\ntimeFormat = " + timeSettings.timeFormat);

			if (err.indexOf(":") &amp;gt;= 0) {
				// Hack!  The error message ends with a colon, a space, and
				// the "extra" characters.  We rely on that instead of
				// attempting to perfectly reproduce the parsing algorithm.
				var dateStringLength = dateTimeString.length - (err.length - err.indexOf(':') - 2),
					timeString = dateTimeString.substring(dateStringLength);

				return [$.trim(dateTimeString.substring(0, dateStringLength)), $.trim(dateTimeString.substring(dateStringLength))];

			} else {
				throw err;
			}
		}
		return [dateTimeString, ''];
	};

	/*
	* Internal function to parse datetime interval
	* Returns: {date: Date, timeObj: Object}, where
	*   date - parsed date without time (type Date)
	*   timeObj = {hour: , minute: , second: , millisec: , microsec: } - parsed time. Optional
	*/
	var parseDateTimeInternal = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var date;
		var splitRes = splitDateTime(dateFormat, dateTimeString, dateSettings, timeSettings);
		date = $.datepicker._base_parseDate(dateFormat, splitRes[0], dateSettings);
		if (splitRes[1] !== '') {
			var timeString = splitRes[1],
				parsedTime = $.datepicker.parseTime(timeFormat, timeString, timeSettings);

			if (parsedTime === null) {
				throw 'Wrong time format';
			}
			return {
				date: date,
				timeObj: parsedTime
			};
		} else {
			return {
				date: date
			};
		}
	};

	/*
	* Internal function to set timezone_select to the local timezone
	*/
	var selectLocalTimezone = function(tp_inst, date) {
		if (tp_inst &amp;amp;&amp;amp; tp_inst.timezone_select) {
			var now = typeof date !== 'undefined' ? date : new Date();
			tp_inst.timezone_select.val(now.getTimezoneOffset()*-1);
		}
	};

	/*
	* Create a Singleton Insance
	*/
	$.timepicker = new Timepicker();

	/**
	 * Get the timezone offset as string from a date object (eg '+0530' for UTC+5.5)
	 * @@param  number if not a number this value is returned
	 * @@param boolean if true formats in accordance to iso8601 "+12:45"
	 * @@return string
	 */
	$.timepicker.timezoneOffsetString = function(tzMinutes, iso8601) {
		if(isNaN(tzMinutes) || tzMinutes &amp;gt; 840){
			return tzMinutes;
		}

		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601? ':':'',
			tz = (off &amp;gt;= 0 ? '+' : '-') + ('0' + (hours * 101).toString()).slice(-2) + iso + ('0' + (minutes * 101).toString()).slice(-2);
		
		if(tz == '+00:00'){
			return 'Z';
		}
		return tz;
	};

	/**
	 * Get the number in minutes that represents a timezone string
	 * @@param  string formated like "+0500", "-1245"
	 * @@return number
	 */
	$.timepicker.timezoneOffsetNumber = function(tzString) {
		tzString = tzString.toString().replace(':',''); // excuse any iso8601, end up with "+1245"

		if(tzString.toUpperCase() === 'Z'){ // if iso8601 with Z, its 0 minute offset
			return 0;
		}

		if(!/^(\-|\+)\d{4}$/.test(tzString)){ // possibly a user defined tz, so just give it back
			return tzString;
		}

		return ((tzString.substr(0,1) =='-'? -1 : 1) * // plus or minus
					((parseInt(tzString.substr(1,2),10)*60) + // hours (converted to minutes)
					parseInt(tzString.substr(3,2),10))); // minutes
	};

	/**
	 * No way to set timezone in js Date, so we must adjust the minutes to compensate. (think setDate, getDate)
	 * @@param  date
	 * @@param  string formated like "+0500", "-1245"
	 * @@return date
	 */
	$.timepicker.timezoneAdjust = function(date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if(!isNaN(toTz)){
			date.setMinutes(date.getMinutes()*1 + (date.getTimezoneOffset()*-1 - toTz*1) );
		}
		return date;
	};

	/**
	 * Calls `timepicker()` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * n.b. The input value must be correctly formatted (reformatting is not supported)
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the timepicker() call
	 * @@return jQuery
	 */
	$.timepicker.timeRange = function(startTime, endTime, options) {
		return $.timepicker.handleRange('timepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datetimepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@return jQuery
	 */
	$.timepicker.datetimeRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datetimepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.dateRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.handleRange = function(method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0, // min allowed interval in milliseconds
			maxInterval: 0, // max allowed interval in milliseconds
			start: {},      // options for start picker
			end: {}         // options for end picker
		}, options);

		$.fn[method].call(startTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), endTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), endTime, 'minDate');
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), startTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), startTime, 'maxDate');
			}
		}, options, options.end));

		checkDates(startTime, endTime);
		selected(startTime, endTime, 'minDate');
		selected(endTime, startTime, 'maxDate');

		function checkDates(changed, other) {
			var startdt = startTime[method]('getDate'),
				enddt = endTime[method]('getDate'),
				changeddt = changed[method]('getDate');

			if(startdt !== null){
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());

				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);

				if(options.minInterval &amp;gt; 0 &amp;amp;&amp;amp; minDate &amp;gt; enddt){ // minInterval check
					endTime[method]('setDate',minDate);
				}
				else if(options.maxInterval &amp;gt; 0 &amp;amp;&amp;amp; maxDate &amp;lt; enddt){ // max interval check
					endTime[method]('setDate',maxDate);
				}
				else if (startdt &amp;gt; enddt) {
					other[method]('setDate',changeddt);
				}
			}
		}

		function selected(changed, other, option) {
			if (!changed.val()) {
				return;
			}
			var date = changed[method].call(changed, 'getDate');
			if(date !== null &amp;amp;&amp;amp; options.minInterval &amp;gt; 0){
				if(option == 'minDate'){
					date.setMilliseconds(date.getMilliseconds() + options.minInterval); 
				}
				if(option == 'maxDate'){
					date.setMilliseconds(date.getMilliseconds() - options.minInterval);
				}
			}
			if (date.getTime) {
				other[method].call(other, 'option', option, date);
			}
		}
		return $([startTime.get(0), endTime.get(0)]);
	};

	/**
	 * Log error or data to the console during error or debugging
	 * @@param  Object err pass any type object to log to the console during error or debugging
	 * @@return void
	 */
	$.timepicker.log = function(err){
		if(window.console){
			console.log(err);
		}
	};

	/*
	* Microsecond support
	*/
	if(!Date.prototype.getMicroseconds){
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function(){ return this.microseconds; };
		Date.prototype.setMicroseconds = function(m){ 
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m/1000));
			this.microseconds = m%1000;
			return this;
		};
	}

	/*
	* Keep up with the version
	*/
	$.timepicker.version = "1.3.1";

})(jQuery);
jQuery.noConflict();
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;datetimepicker-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;e73a652e-09fc-4c71-8e7a-e2525a2d2a99&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
function replaceAllString(oriStr, strTarget, strSubString ){
   var strText = oriStr;
   var intIndexOfMatch = strText.indexOf( strTarget );
   while (intIndexOfMatch != -1){
      strText = strText.replace( strTarget, strSubString )
      intIndexOfMatch = strText.indexOf( strTarget );
   }
   return( strText );
}
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&amp;amp;]" + name + "=([^&amp;amp;#]*)"),
    results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
};


   var jobName= getParameterByName('job')
   var fromDate= getParameterByName('fromDate')
   var toDate= getParameterByName('toDate')
   var limit= getParameterByName('limit')
   var selectedIstIid = getParameterByName('IstIid')

  $("#jobname").ready(function(){
   $("#jobname").text(jobName)
   var convertedJobName = replaceAllString(jobName, ".", "_")
   $("#IstIid" + convertedJobName).ready(function(){
     $("#IstIid" + convertedJobName).css("display","block")
     $("#select_" + convertedJobName).ready(function(){
        $("#select_" + convertedJobName).val(selectedIstIid)
     });
   });
 });

  $("#fromDate").ready(function(){
   $("#from-date").val(fromDate)
 });

  $("#toDate").ready(function(){
   $("#to-date").val(toDate)
 });

  $("#limit").ready(function(){
   if(limit!=""){
    $("#limit").val(limit)
   }
 });
 // Get data with ajax
 function ajax_getData(jobName,fromDate,toDate,limit ){
       var convertedJobName = replaceAllString(jobName, ".", "_")
       var istIid = $("#select_" + convertedJobName).val()
       window.location="/xwiki/bin/view/WiperDog/WebHome?job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid="+istIid;
 			/*$.ajax({
			 type: "GET",
			 url:"/xwiki/bin/get/Sandbox/DescriptionForJob?outputSyntax=plain&amp;amp;job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid"+selectedIstIid,
			 success : function(result){
				$("#jobname").html(jobName)
				$("#display").text('[[]]' + result)
			 }
		   });*/
 }
	$("#treemenu2 a").click(function(){
		 var limit = 10
		 var fromDate=""
		 var toDate = ""
		 jobName= $(this).text()
                 $("#jobname").html(jobName)
                 var convertedJobName = replaceAllString(jobName, ".", "_")
                 $("#listIstIid &amp;gt; div").css("display","none")
                 $("#IstIid" + convertedJobName).css("display","block")
		 //ajax_getData(jobName,fromDate,toDate,limit )

	});

	$("#from-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
		dateFormat: 'yy-mm-dd',
	});
	$("#to-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
			dateFormat: 'yy-mm-dd',

	});
	 $("#get-data").on("click",function(){
		var fromDate = $("#from-date").val()
		var toDate =  $("#to-date").val()
		 if( toDate!= "" ){
			  if(fromDate != ""){
				  if($("#from-date").datepicker( "getDate" ) &amp;gt; $("#to-date").datepicker( "getDate" )){
				  alert("'From date' cannot start later than 'To date'")
				  return false
				  }
			  }
		 }
		 limit = $("#limit").val()
		 ajax_getData(jobName,fromDate,toDate,limit )
	});
$(document).ready(function(){

  var dataModelUrl = '/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job='+jobName+'&amp;amp;limit='
       +limit+'&amp;amp;fromDate='+fromDate + '&amp;amp;toDate='+toDate+'&amp;amp;pager=pager2&amp;amp;genp=1&amp;amp;istIid='+selectedIstIid 
       var jqxhr = $.getJSON(dataModelUrl, function(data) {
       $("#livetableList").jqGrid(data);
       $("#livetableList").jqGrid('navGrid', "#livetablePager", {
           edit : false,
           add : false,
           del : false
         });
       })
});
        
jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;process&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;881686cc-1bfc-456e-b8ab-71334c4a45e5&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){

$(function () {
    function drawLineChart(xAxis, series, container, data_detail){
        var dataXAxis = xAxis
        var dataSeries = series
        var detail = data_detail

			$('#containerline' + container).highcharts({

				chart: {
					type:'line'
				},
				title: {
					text: container
				},
				tooltip :{
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				xAxis: dataXAxis ,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				series: dataSeries
			});
		};

		function drawBarChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerbar' + container).highcharts({
				chart: {
					type: 'column'
				},
				title: {
					text: container
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {

					column: {
						pointPadding: 0.2,
						borderWidth: 0
					}
				},
				series: dataSeries
			});
		}

		function drawAreaChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail
			$('#containerarea' + container).highcharts({
				chart: {
					type: 'area'
				},
				title: {
					text: container
				},
				subtitle: {
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					},
					labels: {
						formatter: function() {
							return this.value / 1000;
						}
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {
					area: {
						stacking: 'normal',
						lineColor: '#666666',
						lineWidth: 1,
						marker: {
							lineWidth: 1,
							lineColor: '#666666'
						}
					}
				},
				series: dataSeries
			});
		};

		function drawPieChart(data, container){
			var dataPie = data
			$(document).ready(function () {
				// Build the chart
				$('#container' + container).highcharts({
					chart: {
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: dataPie[0].name
					},
					tooltip: {
						pointFormat: '{series.name}: &amp;lt;b&amp;gt;{point.percentage:.1f}%&amp;lt;/b&amp;gt;'
					},
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							dataLabels: {
								enabled: false
							},
							showInLegend: true
						}
					},
					series: dataPie
				});
			});
		}

		// LINE
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonline_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonline");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Line chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						if(data_all[0][i].series[0].name == null){
							data_all[0][i].series[0].name = lstContainer[0][i]
						}
						drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
					}
				}
			}
		});

		// BAR
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonbar_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonbar");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Bar chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						drawBarChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
					}
				}
			}
		});

		// AREA
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonarea_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonarea");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				// data to display on tooltip
				var data_detail = data_all[0]
				// draw Area Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					drawAreaChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
				}
			}
		});

		// PIE
		$("#piechart").ready(function(){

			var array = $("#jsons&amp;gt;.jsonpie");
			var arrayContainer = $("#jsons&amp;gt;.lstcontainerpie");
			var lstContainer = [];
			var data_all = [];
			for(var i=0;i&amp;lt;array.length;i++){
				data_all[i] = jQuery.parseJSON(array[i].value)
				lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)

			}
			if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
				// data to display on tooltip
				// draw Pie Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					var finalData = []
					finalData[0] = data_all[0][i]
					drawPieChart(finalData, lstContainer[0][i])
				}
			}
		});
	});
	jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;d5873d92-b78b-42fc-9407-46d166204b88&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;/* css for timepicker */
.ui-timepicker-div .ui-widget-header { 
margin-bottom: 8px;
 }

.ui-timepicker-div dl { text-align: left; }
.ui-timepicker-div dl dt { height: 25px; margin-bottom: -25px; }
.ui-timepicker-div dl dd { margin: 0 10px 10px 65px; }
.ui-timepicker-div td { font-size: 90%; }
.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }

.ui-timepicker-rtl{ direction: rtl; }
.ui-timepicker-rtl dl { text-align: right; }
.ui-timepicker-rtl dl dd { margin: 0 65px 10px 10px; }
#ui-datepicker-div{
 position:relative;
 width:auto;
 height:auto
}
&lt;/code&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;datetimepicker -css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;1201fb1a-e9c1-4731-8c74-2ea8c0071959&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;.displayblock {
  border:2px solid;
  -webkit-border-radius:6px;
  background:gray;
  float: left;
  width:100%;
}

.displaypie {
  border:1px solid;
  -webkit-border-radius:6px;
  background:gray;
  width: 48%;
  float: left; 
  height: 300px;
}

.subtype {
  margin-top: 50px;
  font-size: 2em;
  color: red;
}&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;content&gt;{{include document="Lib.DataToDrawChart"/}}
{{include document="Lib.MongoDBConnection"/}}
{{velocity}}
$xwiki.jsx.use('Lib.JQueryUILib')
$xwiki.ssx.use('Lib.MenuGenerator')
$xwiki.jsx.use('Lib.MenuGenerator')
$xwiki.ssx.use('Lib.JQueryUILib')
$xwiki.jsx.use('Lib.JqGridLib')
$xwiki.ssx.use('Lib.JqGridLib') 
{{/velocity}}
{{include document="Lib.MenuGenerator"/}}
{{html wiki="true" clean="false"}}
&amp;lt;div id="viewer"&amp;gt;
&amp;lt;table style="text-align:left"  &amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th &amp;gt;Job name&amp;lt;/th&amp;gt;
  &amp;lt;td colspan=3&amp;gt;&amp;lt;div id="jobname"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
{{groovy}}
import org.xwiki.context.*

def ec = services.component.getInstance(Execution.class).getContext()
def mapJobIstIid = ec.getProperty("mapJobIstIid")

println '{{html clean="false" wiki="false"}}'
println '&amp;lt;tr&amp;gt;'
println '&amp;lt;th&amp;gt;IstIid&amp;lt;/th&amp;gt;'
println '&amp;lt;td colspan=3&amp;gt;'
mapJobIstIid.each{jobEntry-&amp;gt;
  def convertedJobKey = jobEntry.key.replaceAll("\\.","_")
  println "&amp;lt;div id='listIstIid'&amp;gt;"
  println "&amp;lt;div id=IstIid${convertedJobKey} style='display:none'&amp;gt;"
  println "&amp;lt;select id=select_${convertedJobKey}&amp;gt;"
  jobEntry.value.each{
     println "&amp;lt;option value=\"$it\"&amp;gt;$it&amp;lt;/option&amp;gt;"
  }
  println "&amp;lt;/select&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
}
println '&amp;lt;/td&amp;gt;'
println '&amp;lt;/tr&amp;gt;'
println '{{/html}}'
{{/groovy}}
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data monitor from&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="from-date" id="from-date"/&amp;gt;&amp;lt;/td&amp;gt;
  &amp;lt;th&amp;gt;Data monitor to&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="to-date" id="to-date"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data records limit &amp;lt;/th&amp;gt;
  &amp;lt;td &amp;gt;
     &amp;lt;select id="limit"&amp;gt;
       &amp;lt;option value=5&amp;gt;5&amp;lt;/option&amp;gt;
       &amp;lt;option value=10&amp;gt;10&amp;lt;/option&amp;gt;
       &amp;lt;option value=15&amp;gt;15&amp;lt;/option&amp;gt;
       &amp;lt;option value=20&amp;gt;20&amp;lt;/option&amp;gt;
     &amp;lt;/select&amp;gt;
  &amp;lt;/td&amp;gt;
  &amp;lt;td colspan=3 &amp;gt;&amp;lt;input type="button" value="View Data" id="get-data" class="button"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;&amp;lt;div id="display"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
  &amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
&amp;lt;/table&amp;gt;

&amp;lt;/div&amp;gt; 
   
 &amp;lt;/body&amp;gt;

{{/html}}
{{groovy}}
import groovy.json.*
xwiki.jsx.use("Lib.Highcharts")

if(request.xpage == "plain") {
	response.setContentType('text/plain')
}

def listData = []
def job = request.get("job")
def fromDate = request.get("fromDate")
def toDate = request.get("toDate")
def limit= (request.get("limit")!=null)?request.get("limit").toInteger():10
def istIid = request.get("IstIid")

def str= "No data to retrieved !"
def result = null
if(job != "" &amp;amp;&amp;amp; job != null &amp;amp;&amp;amp; istIid != null &amp;amp;&amp;amp; istIid != ""){
	MongoDBConnection.getConnection()
	if(fromDate != "" || toDate != ""){
		result = MongoDBConnection.getDataInPeriod(job,fromDate,toDate,limit,istIid)
	} else {
		result = MongoDBConnection.getDataAllFields(job,limit,istIid)
        }
MongoDBConnection.closeConnection()
} else {
   println "{{warning}}There are no selected job or IstIid{{/warning}}"
}

if( (result != null) &amp;amp;&amp;amp; (result.size() &amp;gt; 0) &amp;amp;&amp;amp; (result[0].KEYEXPR != null)&amp;amp;&amp;amp;!(result[0].KEYEXPR instanceof List )){

if(result[0].type == "Subtyped") {
    println '{{html clean="false" wiki="true"}}'
    //println '&amp;lt;body&amp;gt;'
    def dataSubtype = DataToDrawChart.getDataToDrawSubtype(result)
    def listKey = []
    dataSubtype.each {key,value -&amp;gt;
        listKey.add(key)
    }
    def jsonkey = com.mongodb.util.JSON.serialize(listKey)
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$jsonkey&amp;lt;/textarea&amp;gt;"

    dataSubtype.each {key,value -&amp;gt;
        def dataLine = []
        def dataBar = []
        def dataPie = []
        def dataArea = []
        if(DataToDrawChart.getDataToDrawLine(value) != []) {
            dataLine = DataToDrawChart.getDataToDrawLine(value)
        }
        if(DataToDrawChart.getDataToDrawBar(value) != []) {
            dataBar = DataToDrawChart.getDataToDrawBar(value)
        }
        if(DataToDrawChart.getDataToDrawPie(value) != []) {
            dataPie = DataToDrawChart.getDataToDrawPie(value)
        }
        if(DataToDrawChart.getDataToDrawArea(value) != []) {
            dataArea = DataToDrawChart.getDataToDrawArea(value)
        }

        def chartColumnsLine
        def chartColumnsBar 
        def chartColumnsArea 
        def lstName
        if(dataLine.size() &amp;gt; 0 ){
            chartColumnsLine = dataLine[0].chart_columns
        }
        if(dataBar.size() &amp;gt; 0){
            chartColumnsBar = dataBar[0].chart_columns
        }
        if(dataArea.size() &amp;gt; 0 ){
            chartColumnsArea = dataArea[0].chart_columns
        }
        if(dataPie.size() &amp;gt; 0 ){
            lstName = dataPie['name']
        }

        def tmpListNameContainer = []
	for(def nameContainer in lstName){
	   nameContainer = nameContainer.replaceAll("\\.", "_")
	   tmpListNameContainer.add(nameContainer)
	}
        def jsonPie
        def jsonLine
	def jsonBar
        def jsonArea
        if(dataPie != []) {
	    jsonPie = com.mongodb.util.JSON.serialize(dataPie)
        }
        if(dataLine != []) {
	    jsonLine = com.mongodb.util.JSON.serialize(dataLine)
        }
        if(dataBar != []) {
            jsonBar = com.mongodb.util.JSON.serialize(dataBar)
        }
        if(dataArea != []) {
	    jsonArea = com.mongodb.util.JSON.serialize(dataArea)
        }

	def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
	def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
	def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
	def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

	println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
        if(jsonLine != null) {
	    println "&amp;lt;textarea id=\"jsonline_$key\" &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;" 
        }
	if(jsonBar != null) {
            println "&amp;lt;textarea id=\"jsonbar_$key\"&amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
 	    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
        }
        if(jsonPie != null) {
	    println "&amp;lt;textarea id=\"jsonpie_$key\" &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
        }
        if(jsonArea != null) {
	    println "&amp;lt;textarea id=\"jsonarea_$key\" &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"
	    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
        }

	println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
	println "&amp;lt;input style=\"display:none\" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;"
	println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
	println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'
	println "&amp;lt;/div&amp;gt;"
	  
	def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
	def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
	  
	println "&amp;lt;div style='clear:both'&amp;gt;"
        def description = value.KEYEXPR._description[0][key]
        if(description != null) {
            println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +': ' + description +'&amp;lt;/div&amp;gt;'
        } else {
            println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +'&amp;lt;/div&amp;gt;'
        }
        println "-----"
        if(jsonPie != null) {
	  println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
	  lstName.each{
	    def tmp = it.replaceAll("\\.", "_")
	    println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
        if(jsonLine != null) {
	  def chartLineComment = false
	  chartColumnsLine.each{
	    if(!chartLineComment){
	       println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	       chartLineComment = true  
	    }

	      println " &amp;lt;div class=\"displayblock\" id=\"containerline${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
        println "&amp;amp;nbsp;"

        if(jsonBar != null) {
	  def chartBarComment = false
	  chartColumnsBar.each{
	     if(!chartBarComment){
	        println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	        chartBarComment = true
	      }  

	     println " &amp;lt;div class=\"displayblock\" id=\"containerbar${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
	println "&amp;amp;nbsp;"

        if(jsonArea != null) {
	  def chartAreaComment = false
	  chartColumnsArea.each{
	  if(!chartAreaComment){
	    println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	    chartAreaComment = true
	  }
	    println " &amp;lt;div class=\"displayblock\" id=\"containerarea${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
	println "&amp;lt;/div&amp;gt;"
        
    }
    println '&amp;lt;/body&amp;gt;'
    println '{{/html}}'
} else if(result[0].type == "Store") {
    // data store
    def dataLine = DataToDrawChart.getDataToDrawLine(result)
    def dataBar = DataToDrawChart.getDataToDrawBar(result)
    def dataPie = DataToDrawChart.getDataToDrawPie(result)
    def dataArea = DataToDrawChart.getDataToDrawArea(result)
    def chartColumnsLine 
    def chartColumnsBar 
    def chartColumnsArea 
    def lstName 

    if(dataLine.size() &amp;gt; 0 ){
        chartColumnsLine = dataLine[0].chart_columns
    }
    if(dataBar.size() &amp;gt; 0){
        chartColumnsBar = dataBar[0].chart_columns
    }
    if(dataArea.size() &amp;gt; 0 ){
        chartColumnsArea = dataArea[0].chart_columns
    }
    if(dataPie.size() &amp;gt; 0 ){
        lstName = dataPie['name']
    }

    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
  
    def tmpListNameContainer = []
    for(def nameContainer in lstName){
       nameContainer = nameContainer.replaceAll("\\.", "_")
       tmpListNameContainer.add(nameContainer)
    }
  
    def jsonPie = com.mongodb.util.JSON.serialize(dataPie)
    def jsonLine = com.mongodb.util.JSON.serialize(dataLine)
    def jsonBar = com.mongodb.util.JSON.serialize(dataBar)
    def jsonArea = com.mongodb.util.JSON.serialize(dataArea)

    def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
    def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
    def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
    def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

    def listEmpty = com.mongodb.util.JSON.serialize([])
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$listEmpty&amp;lt;/textarea&amp;gt;" 

    println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'

    println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
    println "&amp;lt;textarea class='jsonline' &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonbar' &amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonpie' &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonarea' &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"

    println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
  
    def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
    def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
  
    println "&amp;lt;div style='clear:both'&amp;gt;"
  
    def chartPieComment = false
    lstName.each{
        if(!chartPieComment) {
            println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
            chartPieComment = true
        }
        def tmp = it.replaceAll("\\.", "_")
        println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    def chartLineComment = false
    chartColumnsLine.each{
    if(!chartLineComment){
        println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
        chartLineComment = true  
    }

    println " &amp;lt;div class=\"displayblock\" id=\"containerline$it\"&amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    println "&amp;amp;nbsp;"
    def chartBarComment = false
    chartColumnsBar.each{
        if(!chartBarComment){
            println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
            chartBarComment = true
        }  

    println " &amp;lt;div class=\"displayblock\" id=\"containerbar$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
  println "&amp;lt;/div&amp;gt;"
  println "&amp;amp;nbsp;"
  def chartAreaComment = false
  chartColumnsArea.each{
  if(!chartAreaComment){
    println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
    chartAreaComment = true
  }
    println " &amp;lt;div class=\"displayblock\" id=\"containerarea$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
  println "&amp;lt;/div&amp;gt;"
println "&amp;lt;/div&amp;gt;"

println '&amp;lt;/body&amp;gt;'
println '{{/html}}'
}
}else{
    println 'There is no data for this job with criterias'
}

{{/groovy}}
{{html wiki="true" clean="false"}}
&amp;lt;center&amp;gt;
&amp;lt;div id="livetblContent" style="width:100%;clear:both;align:middle;margin-top:10px"&amp;gt;   
    &amp;lt;table id="livetableList" style="width:100%;align:center"&amp;gt;&amp;lt;/table&amp;gt;
    &amp;lt;div id="livetablePager" style="position:relative;width:100%"&amp;gt;&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;/center&amp;gt;
{{/html}}
&lt;/content&gt;&lt;/xwikidoc&gt;@


54.10
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376394053000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376394053000&lt;/contentUpdateDate&gt;
&lt;version&gt;54.10&lt;/version&gt;
d3505 1
a3505 1
&amp;lt;div id="livetblContent" style="width:100%;clear:both;align:middle;margin-top:125px"&amp;gt;   
@


54.9
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376394036000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376394036000&lt;/contentUpdateDate&gt;
&lt;version&gt;54.9&lt;/version&gt;
d3505 1
a3505 2
&amp;lt;div id="livetblContent" style="width:100%;clear:both;align:middle;margin-top:125px"&amp;gt;
    &amp;lt;!--table id="livetableList1" style="width:100%;align:center"&amp;gt;&amp;lt;tr&amp;gt;&amp;lt;td&amp;gt;&amp;amp;nbsp;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;lt;/table--&amp;gt;
@


54.8
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376393954000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376393954000&lt;/contentUpdateDate&gt;
&lt;version&gt;54.8&lt;/version&gt;
d3506 3
a3508 3
    &amp;lt;table id="livetableList1" style="width:100%;align:center"&amp;gt;&amp;lt;tr&amp;gt;&amp;lt;td&amp;gt;&amp;amp;nbsp;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;
        &amp;lt;table id="livetableList" style="width:100%;align:center"&amp;gt;&amp;lt;/table&amp;gt;
    &amp;lt;div id="livetablePager"&amp;gt;&amp;lt;/div&amp;gt;
@


54.7
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376393928000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376393928000&lt;/contentUpdateDate&gt;
&lt;version&gt;54.7&lt;/version&gt;
d3506 1
a3506 1
    &amp;lt;table id="livetableList1" style="width:100%;align:center"&amp;gt;&amp;lt;/table&amp;gt;
@


54.6
log
@@
text
@&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xwikidoc&gt;
&lt;web&gt;WiperDog&lt;/web&gt;
&lt;name&gt;WebHome&lt;/name&gt;
&lt;language&gt;&lt;/language&gt;
&lt;defaultLanguage&gt;en&lt;/defaultLanguage&gt;
&lt;translation&gt;0&lt;/translation&gt;
&lt;parent&gt;&lt;/parent&gt;
&lt;creator&gt;XWiki.Admin&lt;/creator&gt;
&lt;author&gt;XWiki.Admin&lt;/author&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;contentAuthor&gt;XWiki.Admin&lt;/contentAuthor&gt;
&lt;creationDate&gt;1376364375000&lt;/creationDate&gt;
&lt;date&gt;1376393857000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376393857000&lt;/contentUpdateDate&gt;
&lt;version&gt;54.6&lt;/version&gt;
&lt;title&gt;WiperDog&lt;/title&gt;
&lt;defaultTemplate&gt;&lt;/defaultTemplate&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;comment&gt;&lt;/comment&gt;
&lt;minorEdit&gt;true&lt;/minorEdit&gt;
&lt;syntaxId&gt;xwiki/2.1&lt;/syntaxId&gt;
&lt;hidden&gt;false&lt;/hidden&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;047293a8-524d-45e4-af52-cd944523d5d0&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
/*
 * jQuery timepicker addon
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 1.3.1
 * Last Modified: 07/07/2013
 *
 * Copyright 2013 Trent Richardson
 * You may use this project under MIT or GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 */

/*jslint evil: true, white: false, undef: false, nomen: false */

(function($) {

	/*
	* Lets not redefine timepicker, Prevent "Uncaught RangeError: Maximum call stack size exceeded"
	*/
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return;
	}

	/*
	* Extend jQueryUI, get it started with our version number
	*/
	$.extend($.ui, {
		timepicker: {
			version: "1.3.1"
		}
	});

	/* 
	* Timepicker manager.
	* Use the singleton instance of this class, $.timepicker, to interact with the time picker.
	* Settings for (groups of) time pickers are maintained in an instance object,
	* allowing multiple different settings on the same page.
	*/
	var Timepicker = function() {
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[''] = { // Default regional settings
			currentText: 'Now',
			closeText: 'Done',
			amNames: ['AM', 'A'],
			pmNames: ['PM', 'P'],
			timeFormat: 'HH:mm',
			timeSuffix: '',
			timeOnlyTitle: 'Choose Time',
			timeText: 'Time',
			hourText: 'Hour',
			minuteText: 'Minute',
			secondText: 'Second',
			millisecText: 'Millisecond',
			microsecText: 'Microsecond',
			timezoneText: 'Time Zone',
			isRTL: false
		};
		this._defaults = { // Global defaults for all the datetime picker instances
			showButtonPanel: true,
			timeOnly: false,
			showHour: null,
			showMinute: null,
			showSecond: null,
			showMillisec: null,
			showMicrosec: null,
			showTimezone: null,
			showTime: true,
			stepHour: 1,
			stepMinute: 1,
			stepSecond: 1,
			stepMillisec: 1,
			stepMicrosec: 1,
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null,
			hourMin: 0,
			minuteMin: 0,
			secondMin: 0,
			millisecMin: 0,
			microsecMin: 0,
			hourMax: 23,
			minuteMax: 59,
			secondMax: 59,
			millisecMax: 999,
			microsecMax: 999,
			minDateTime: null,
			maxDateTime: null,
			onSelect: null,
			hourGrid: 0,
			minuteGrid: 0,
			secondGrid: 0,
			millisecGrid: 0,
			microsecGrid: 0,
			alwaysSetTime: true,
			separator: ' ',
			altFieldTimeOnly: true,
			altTimeFormat: null,
			altSeparator: null,
			altTimeSuffix: null,
			pickerTimeFormat: null,
			pickerTimeSuffix: null,
			showTimepicker: true,
			timezoneList: null,
			addSliderAccess: false,
			sliderAccessArgs: null,
			controlType: 'slider',
			defaultValue: null,
			parse: 'strict'
		};
		$.extend(this._defaults, this.regional['']);
	};

	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: '',
		formattedDate: '',
		formattedTime: '',
		formattedDateTime: '',
		timezoneList: null,
		units: ['hour','minute','second','millisec', 'microsec'],
		support: {},
		control: null,

		/* 
		* Override the default settings for all instances of the time picker.
		* @@param  settings  object - the new settings to use as defaults (anonymous object)
		* @@return the manager object
		*/
		setDefaults: function(settings) {
			extendRemove(this._defaults, settings || {});
			return this;
		},

		/*
		* Create a new Timepicker instance
		*/
		_newInst: function($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
            	fns = {},
		    	overrides, i;

			for (var attrName in this._defaults) {
				if(this._defaults.hasOwnProperty(attrName)){
					var attrValue = $input.attr('time:' + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue);
						} catch (err) {
							inlineSettings[attrName] = attrValue;
						}
					}
				}
			}

		    overrides = {
		        beforeShow: function (input, dp_inst) {
		            if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
		                return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst);
		            }
		        },
		        onChangeMonthYear: function (year, month, dp_inst) {
		            // Update the time as well : this prevents the time from disappearing from the $input field.
		            tp_inst._updateDateTime(dp_inst);
		            if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
		                tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst);
		            }
		        },
		        onClose: function (dateText, dp_inst) {
		            if (tp_inst.timeDefined === true &amp;amp;&amp;amp; $input.val() !== '') {
		                tp_inst._updateDateTime(dp_inst);
		            }
		            if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
		                tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst);
		            }
		        }
		    };
		    for (i in overrides) {
		        if (overrides.hasOwnProperty(i)) {
		            fns[i] = opts[i] || null;
		        }
		    }

		    tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
		        evnts:fns,
		        timepicker: tp_inst // add timepicker as a property of datepicker: $.datepicker._get(dp_inst, 'timepicker');
		    });
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function(val) {
				return val.toUpperCase();
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function(val) {
				return val.toUpperCase();
			});

			// detect which units are supported
			tp_inst.support = detectSupport(
					tp_inst._defaults.timeFormat + 
					(tp_inst._defaults.pickerTimeFormat? tp_inst._defaults.pickerTimeFormat:'') + 
					(tp_inst._defaults.altTimeFormat? tp_inst._defaults.altTimeFormat:''));

			// controlType is string - key to our this._controls
			if(typeof(tp_inst._defaults.controlType) === 'string'){
				if(tp_inst._defaults.controlType == 'slider' &amp;amp;&amp;amp; typeof(jQuery.ui.slider) === 'undefined'){
					tp_inst._defaults.controlType = 'select';
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType];
			}
			// controlType is an object and must implement create, options, value methods
			else{ 
				tp_inst.control = tp_inst._defaults.controlType;
			}

			// prep the timezone options
			var timezoneList = [-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,
					0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList;
			}
			var tzl=timezoneList.length,tzi=0,tzv=null;
			if (tzl &amp;gt; 0 &amp;amp;&amp;amp; typeof timezoneList[0] !== 'object') {
				for(; tzi&amp;lt;tzl; tzi++){
					tzv = timezoneList[tzi];
					timezoneList[tzi] = { value: tzv, label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601) };
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;

			// set the default units
			tp_inst.timezone = tp_inst._defaults.timezone !== null? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) : 
							((new Date()).getTimezoneOffset()*-1);
			tp_inst.hour = tp_inst._defaults.hour &amp;lt; tp_inst._defaults.hourMin? tp_inst._defaults.hourMin : 
							tp_inst._defaults.hour &amp;gt; tp_inst._defaults.hourMax? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute &amp;lt; tp_inst._defaults.minuteMin? tp_inst._defaults.minuteMin : 
							tp_inst._defaults.minute &amp;gt; tp_inst._defaults.minuteMax? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second &amp;lt; tp_inst._defaults.secondMin? tp_inst._defaults.secondMin : 
							tp_inst._defaults.second &amp;gt; tp_inst._defaults.secondMax? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec &amp;lt; tp_inst._defaults.millisecMin? tp_inst._defaults.millisecMin : 
							tp_inst._defaults.millisec &amp;gt; tp_inst._defaults.millisecMax? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec &amp;lt; tp_inst._defaults.microsecMin? tp_inst._defaults.microsecMin : 
							tp_inst._defaults.microsec &amp;gt; tp_inst._defaults.microsecMax? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = '';
			tp_inst.$input = $input;

			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField).css({
					cursor: 'pointer'
				}).focus(function() {
					$input.trigger("focus");
				});
			}

			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date();
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date();
			}

			// datepicker needs minDate/maxDate, timepicker needs minDateTime/maxDateTime..
			if (tp_inst._defaults.minDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime());
			}
			if (tp_inst._defaults.minDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime());
			}
			if (tp_inst._defaults.maxDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime());
			}
			if (tp_inst._defaults.maxDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime());
			}
			tp_inst.$input.bind('focus', function() {
				tp_inst._onFocus();
			});

			return tp_inst;
		},

		/*
		* add our sliders to the calendar
		*/
		_addTimePicker: function(dp_inst) {
			var currDT = (this.$altInput &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly) ? this.$input.val() + ' ' + this.$altInput.val() : this.$input.val();

			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
		},

		/*
		* parse the time string from input value or _setTime
		*/
		_parseTime: function(timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0]);
			}

			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, 'dateFormat');
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false;
					}
					$.extend(this, parseRes.timeObj);
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err +
									"\ndate/time string = " + timeString +
									"\ntimeFormat = " + this._defaults.timeFormat +
									"\ndateFormat = " + dp_dateFormat);
					return false;
				}
				return true;
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false;
				}
				$.extend(this, timeObj);
				return true;
			}
		},

		/*
		* generate and inject html for timepicker into ui datepicker
		*/
		_injectTimePicker: function() {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = '',
				uitem = '',
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i=0,
				l=0;

			// Prevent displaying twice
			if ($dp.find("div.ui-timepicker-div").length === 0 &amp;amp;&amp;amp; o.showTimepicker) {
				var noDisplay = ' style="display:none;"',
					html = '&amp;lt;div class="ui-timepicker-div'+ (o.isRTL? ' ui-timepicker-rtl' : '') +'"&amp;gt;&amp;lt;dl&amp;gt;' + '&amp;lt;dt class="ui_tpicker_time_label"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;' + o.timeText + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_time"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the markup
				for(i=0,l=this.units.length; i&amp;lt;l; i++){
					litem = this.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// Added by Peter Medeiros:
					// - Figure out what the hour/minute/second max should be based on the step values.
					// - Example: if stepMinute is 15, then minMax is 45.
					max[litem] = parseInt((o[litem+'Max'] - ((o[litem+'Max'] - o[litem+'Min']) % o['step'+uitem])), 10);
					gridSize[litem] = 0;

					html += '&amp;lt;dt class="ui_tpicker_'+ litem +'_label"' + (show ? '' : noDisplay) + '&amp;gt;' + o[litem +'Text'] + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_'+ litem +'"&amp;gt;&amp;lt;div class="ui_tpicker_'+ litem +'_slider"' + (show ? '' : noDisplay) + '&amp;gt;&amp;lt;/div&amp;gt;';

					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						html += '&amp;lt;div style="padding-left: 1px"&amp;gt;&amp;lt;table class="ui-tpicker-grid-label"&amp;gt;&amp;lt;tr&amp;gt;';

						if(litem == 'hour'){
							for (var h = o[litem+'Min']; h &amp;lt;= max[litem]; h += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm? 'hht':'HH', {hour:h}, o);									
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + tmph + '&amp;lt;/td&amp;gt;';
							}
						}
						else{
							for (var m = o[litem+'Min']; m &amp;lt;= max[litem]; m += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + ((m &amp;lt; 10) ? '0' : '') + m + '&amp;lt;/td&amp;gt;';
							}
						}

						html += '&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;&amp;lt;/div&amp;gt;';
					}
					html += '&amp;lt;/dd&amp;gt;';
				}
				
				// Timezone
				var showTz = o.showTimezone !== null? o.showTimezone : this.support.timezone;
				html += '&amp;lt;dt class="ui_tpicker_timezone_label"' + (showTz ? '' : noDisplay) + '&amp;gt;' + o.timezoneText + '&amp;lt;/dt&amp;gt;';
				html += '&amp;lt;dd class="ui_tpicker_timezone" ' + (showTz ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the elements from string
				html += '&amp;lt;/dl&amp;gt;&amp;lt;/div&amp;gt;';
				var $tp = $(html);

				// if we only want time picker...
				if (o.timeOnly === true) {
					$tp.prepend('&amp;lt;div class="ui-widget-header ui-helper-clearfix ui-corner-all"&amp;gt;' + '&amp;lt;div class="ui-datepicker-title"&amp;gt;' + o.timeOnlyTitle + '&amp;lt;/div&amp;gt;' + '&amp;lt;/div&amp;gt;');
					$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();
				}
				
				// add sliders, adjust grids, add events
				for(i=0,l=tp_inst.units.length; i&amp;lt;l; i++){
					litem = tp_inst.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// add the slider
					tp_inst[litem+'_slider'] = tp_inst.control.create(tp_inst, $tp.find('.ui_tpicker_'+litem+'_slider'), litem, tp_inst[litem], o[litem+'Min'], max[litem], o['step'+uitem]);

					// adjust the grid and add click event
					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						size = 100 * gridSize[litem] * o[litem+'Grid'] / (max[litem] - o[litem+'Min']);
						$tp.find('.ui_tpicker_'+litem+' table').css({
							width: size + "%",
							marginLeft: o.isRTL? '0' : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL? ((size / (-2 * gridSize[litem])) + "%") : '0',
							borderCollapse: 'collapse'
						}).find("td").click(function(e){
								var $t = $(this),
									h = $t.html(),
									n = parseInt(h.replace(/[^0-9]/g),10),
									ap = h.replace(/[^apm]/ig),
									f = $t.data('for'); // loses scope, so we use data-for

								if(f == 'hour'){
									if(ap.indexOf('p') !== -1 &amp;amp;&amp;amp; n &amp;lt; 12){
										n += 12;
									}
									else{
										if(ap.indexOf('a') !== -1 &amp;amp;&amp;amp; n === 12){
											n = 0;
										}
									}
								}
								
								tp_inst.control.value(tp_inst, tp_inst[f+'_slider'], litem, n);

								tp_inst._onTimeChange();
								tp_inst._onSelectHandler();
							}).css({
								cursor: 'pointer',
								width: (100 / gridSize[litem]) + '%',
								textAlign: 'center',
								overflow: 'hidden'
							});
					} // end if grid &amp;gt; 0
				} // end for loop

				// Add timezone options
				this.timezone_select = $tp.find('.ui_tpicker_timezone').append('&amp;lt;select&amp;gt;&amp;lt;/select&amp;gt;').find("select");
				$.fn.append.apply(this.timezone_select,
				$.map(o.timezoneList, function(val, idx) {
					return $("&amp;lt;option /&amp;gt;").val(typeof val == "object" ? val.value : val).text(typeof val == "object" ? val.label : val);
				}));
				if (typeof(this.timezone) != "undefined" &amp;amp;&amp;amp; this.timezone !== null &amp;amp;&amp;amp; this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset()*-1;
					if (local_timezone == this.timezone) {
						selectLocalTimezone(tp_inst);
					} else {
						this.timezone_select.val(this.timezone);
					}
				} else {
					if (typeof(this.hour) != "undefined" &amp;amp;&amp;amp; this.hour !== null &amp;amp;&amp;amp; this.hour !== "") {
						this.timezone_select.val(o.timezone);
					} else {
						selectLocalTimezone(tp_inst);
					}
				}
				this.timezone_select.change(function() {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
				});
				// End timezone options
				
				// inject timepicker into datepicker
				var $buttonPanel = $dp.find('.ui-datepicker-buttonpane');
				if ($buttonPanel.length) {
					$buttonPanel.before($tp);
				} else {
					$dp.append($tp);
				}

				this.$timeObj = $tp.find('.ui_tpicker_time');

				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined;
				}

				// slideAccess integration: http://trentrichardson.com/2011/11/11/jquery-ui-sliders-and-touch-accessibility/
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
						
					setTimeout(function() { // fix for inline mode
						if ($tp.find('.ui-slider-access').length === 0) {
							$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);

							// fix any grids since sliders are shorter
							var sliderAccessWidth = $tp.find('.ui-slider-access:eq(0)').outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find('table:visible').each(function() {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl? 'marginRight':'marginLeft').toString().replace('%', ''),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + '%',
										css = { width: newWidth, marginRight: 0, marginLeft: 0 };
									css[rtl? 'marginRight':'marginLeft'] = newMarginLeft;
									$g.css(css);
								});
							}
						}
					}, 10);
				}
				// end slideAccess integration

				tp_inst._limitMinMaxDateTime(this.inst, true);
			}
		},

		/*
		* This function tries to limit the ability to go outside the
		* min/max date range
		*/
		_limitMinMaxDateTime: function(dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);

			if (!this._defaults.showTimepicker) {
				return;
			} // No time so nothing to check here

			if ($.datepicker._get(dp_inst, 'minDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'minDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, 'minDateTime'),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin;
				}

				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour &amp;lt;= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute &amp;lt;= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second &amp;lt;= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if(this.millisec &amp;lt;= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;lt; this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin;
									}
									this._defaults.microsecMin = this.microsecMinOriginal;
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal;
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal;
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal;
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal;
				}
			}

			if ($.datepicker._get(dp_inst, 'maxDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'maxDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, 'maxDateTime'),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax;
				}

				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour &amp;gt;= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute &amp;gt;= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second &amp;gt;= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec &amp;gt;= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;gt; this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax;
									}
									this._defaults.microsecMax = this.microsecMaxOriginal;
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal;
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal;
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal;
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal;
				}
			}

			if (adjustSliders !== undefined &amp;amp;&amp;amp; adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10);
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);

				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, 'hour', { min: this._defaults.hourMin, max: hourMax });
					this.control.value(this, this.hour_slider, 'hour', this.hour - (this.hour % this._defaults.stepHour));
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, 'minute', { min: this._defaults.minuteMin, max: minMax });
					this.control.value(this, this.minute_slider, 'minute', this.minute - (this.minute % this._defaults.stepMinute));
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, 'second', { min: this._defaults.secondMin, max: secMax });
					this.control.value(this, this.second_slider, 'second', this.second - (this.second % this._defaults.stepSecond));
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, 'millisec', { min: this._defaults.millisecMin, max: millisecMax });
					this.control.value(this, this.millisec_slider, 'millisec', this.millisec - (this.millisec % this._defaults.stepMillisec));
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, 'microsec', { min: this._defaults.microsecMin, max: microsecMax });
					this.control.value(this, this.microsec_slider, 'microsec', this.microsec - (this.microsec % this._defaults.stepMicrosec));
				}
			}

		},

		/*
		* when a slider moves, set the internal time...
		* on time change is also called when the time is updated in the text field
		*/
		_onTimeChange: function() {
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, 'hour') : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, 'minute') : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, 'second') : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, 'millisec') : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, 'microsec') : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;

			if (typeof(hour) == 'object') {
				hour = false;
			}
			if (typeof(minute) == 'object') {
				minute = false;
			}
			if (typeof(second) == 'object') {
				second = false;
			}
			if (typeof(millisec) == 'object') {
				millisec = false;
			}
			if (typeof(microsec) == 'object') {
				microsec = false;
			}
			if (typeof(timezone) == 'object') {
				timezone = false;
			}

			if (hour !== false) {
				hour = parseInt(hour, 10);
			}
			if (minute !== false) {
				minute = parseInt(minute, 10);
			}
			if (second !== false) {
				second = parseInt(second, 10);
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10);
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10);
			}

			var ampm = o[hour &amp;lt; 12 ? 'amNames' : 'pmNames'][0];

			// If the update was done in the input field, the input field should not be updated.
			// If the update was done using the sliders, update the input field.
			var hasChanged = (hour != this.hour || minute != this.minute || second != this.second || millisec != this.millisec || microsec != this.microsec 
								|| (this.ampm.length &amp;gt; 0 &amp;amp;&amp;amp; (hour &amp;lt; 12) != ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) 
								|| (this.timezone !== null &amp;amp;&amp;amp; timezone != this.timezone));

			if (hasChanged) {

				if (hour !== false) {
					this.hour = hour;
				}
				if (minute !== false) {
					this.minute = minute;
				}
				if (second !== false) {
					this.second = second;
				}
				if (millisec !== false) {
					this.millisec = millisec;
				}
				if (microsec !== false) {
					this.microsec = microsec;
				}
				if (timezone !== false) {
					this.timezone = timezone;
				}

				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0]);
				}

				this._limitMinMaxDateTime(this.inst, true);
			}
			if (this.support.ampm) {
				this.ampm = ampm;
			}

			// Updates the time within the timepicker
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if(pickerTimeFormat === o.timeFormat){
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix);
				}
				else{
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix);
				}
			}

			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime();
			}
		},

		/*
		* call custom onSelect.
		* bind to sliders slidestop, and grid click.
		*/
		_onSelectHandler: function() {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect &amp;amp;&amp;amp; inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this]);
			}
		},

		/*
		* update our input with the new date time..
		*/
		_updateDateTime: function(dp_inst) {
			dp_inst = this.inst || dp_inst;
			//var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
			var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay)),
				dateFmt = $.datepicker._get(dp_inst, 'dateFormat'),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null &amp;amp;&amp;amp; this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			
			// if a slider was changed but datepicker doesn't have a value yet, set it
			if(dp_inst.lastVal===""){
                dp_inst.currentYear=dp_inst.selectedYear;
                dp_inst.currentMonth=dp_inst.selectedMonth;
                dp_inst.currentDay=dp_inst.selectedDay;
            }

			/*
			* remove following lines to force every changes in date picker to change the input value
			* Bug descriptions: when an input field has a default value, and click on the field to pop up the date picker. 
			* If the user manually empty the value in the input field, the date picker will never change selected value.
			*/
			//if (dp_inst.lastVal !== undefined &amp;amp;&amp;amp; (dp_inst.lastVal.length &amp;gt; 0 &amp;amp;&amp;amp; this.$input.val().length === 0)) {
			//	return;
			//}

			if (this._defaults.timeOnly === true) {
				formattedDateTime = this.formattedTime;
			} else if (this._defaults.timeOnly !== true &amp;amp;&amp;amp; (this._defaults.alwaysSetTime || timeAvailable)) {
				formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix;
			}

			this.formattedDateTime = formattedDateTime;

			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate);
			} else if (this.$altInput &amp;amp;&amp;amp; this._defaults.timeOnly === false &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly === true) {
				this.$altInput.val(this.formattedTime);
				this.$input.val(this.formattedDate);
			} else if (this.$altInput) {
				this.$input.val(formattedDateTime);
				var altFormattedDateTime = '',
					altSeparator = this._defaults.altSeparator ? this._defaults.altSeparator : this._defaults.separator,
					altTimeSuffix = this._defaults.altTimeSuffix ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
				
				if(!this._defaults.timeOnly){
					if (this._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg);
					}
					else{
						altFormattedDateTime = this.formattedDate;
					}

					if (altFormattedDateTime){
						altFormattedDateTime += altSeparator;
					}
				}

				if(this._defaults.altTimeFormat){
					altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix;
				}
				else{
					altFormattedDateTime += this.formattedTime + altTimeSuffix;
				}
				this.$altInput.val(altFormattedDateTime);
			} else {
				this.$input.val(formattedDateTime);
			}

			this.$input.trigger("change");
		},

		_onFocus: function() {
			if (!this.$input.val() &amp;amp;&amp;amp; this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, 'timepicker');
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst);
						} catch (err) {
							$.timepicker.log(err);
						}
					}
				}
			}
		},

		/*
		* Small abstraction to control types
		* We can add more, just be sure to follow the pattern: create, options, value
		*/
		_controls: {
			// slider methods
			slider: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var rtl = tp_inst._defaults.isRTL; // if rtl go -60-&amp;gt;0 instead of 0-&amp;gt;60
					return obj.prop('slide', null).slider({
						orientation: "horizontal",
						value: rtl? val*-1 : val,
						min: rtl? max*-1 : min,
						max: rtl? min*-1 : max,
						step: step,
						slide: function(event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl? ui.value*-1:ui.value);
							tp_inst._onTimeChange();
						},
						stop: function(event, ui) {
							tp_inst._onSelectHandler();
						}
					});	
				},
				options: function(tp_inst, obj, unit, opts, val){
					if(tp_inst._defaults.isRTL){
						if(typeof(opts) == 'string'){
							if(opts == 'min' || opts == 'max'){
								if(val !== undefined){
									return obj.slider(opts, val*-1);
								}
								return Math.abs(obj.slider(opts));
							}
							return obj.slider(opts);
						}
						var min = opts.min, 
							max = opts.max;
						opts.min = opts.max = null;
						if(min !== undefined){
							opts.max = min * -1;
						}
						if(max !== undefined){
							opts.min = max * -1;
						}
						return obj.slider(opts);
					}
					if(typeof(opts) == 'string' &amp;amp;&amp;amp; val !== undefined){
							return obj.slider(opts, val);
					}
					return obj.slider(opts);
				},
				value: function(tp_inst, obj, unit, val){
					if(tp_inst._defaults.isRTL){
						if(val !== undefined){
							return obj.slider('value', val*-1);
						}
						return Math.abs(obj.slider('value'));
					}
					if(val !== undefined){
						return obj.slider('value', val);
					}
					return obj.slider('value');
				}
			},
			// select methods
			select: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var sel = '&amp;lt;select class="ui-timepicker-select" data-unit="'+ unit +'" data-min="'+ min +'" data-max="'+ max +'" data-step="'+ step +'"&amp;gt;',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;

					for(var i=min; i&amp;lt;=max; i+=step){						
						sel += '&amp;lt;option value="'+ i +'"'+ (i==val? ' selected':'') +'&amp;gt;';
						if(unit == 'hour'){
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig,'')), {hour:i}, tp_inst._defaults);
						}
						else if(unit == 'millisec' || unit == 'microsec' || i &amp;gt;= 10){ sel += i; }
						else {sel += '0'+ i.toString(); }
						sel += '&amp;lt;/option&amp;gt;';
					}
					sel += '&amp;lt;/select&amp;gt;';

					obj.children('select').remove();

					$(sel).appendTo(obj).change(function(e){
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
					});

					return obj;
				},
				options: function(tp_inst, obj, unit, opts, val){
					var o = {},
						$t = obj.children('select');
					if(typeof(opts) == 'string'){
						if(val === undefined){
							return $t.data(opts);
						}
						o[opts] = val;	
					}
					else{ o = opts; }
					return tp_inst.control.create(tp_inst, obj, $t.data('unit'), $t.val(), o.min || $t.data('min'), o.max || $t.data('max'), o.step || $t.data('step'));
				},
				value: function(tp_inst, obj, unit, val){
					var $t = obj.children('select');
					if(val !== undefined){
						return $t.val(val);
					}
					return $t.val();
				}
			}
		} // end _controls

	});

	$.fn.extend({
		/*
		* shorthand just to use timepicker..
		*/
		timepicker: function(o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);

			if (typeof o == 'object') {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				});
			}

			return $(this).each(function() {
				$.fn.datetimepicker.apply($(this), tmp_args);
			});
		},

		/*
		* extend timepicker to datepicker
		*/
		datetimepicker: function(o) {
			o = o || {};
			var tmp_args = arguments;

			if (typeof(o) == 'string') {
				if (o == 'getDate') {
					return $.fn.datepicker.apply($(this[0]), tmp_args);
				} else {
					return this.each(function() {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args);
					});
				}
			} else {
				return this.each(function() {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults);
				});
			}
		}
	});

	/*
	* Public Utility to parse date and time
	*/
	$.datepicker.parseDateTime = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec);
		}

		return parseRes.date;
	};

	/*
	* Public utility to parse time
	*/
	$.datepicker.parseTime = function(timeFormat, timeString, options) {		
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g,'').indexOf('Z') !== -1);

		// Strict parse requires the timeString to match the timeFormat exactly
		var strictParse = function(f, s, o){

			// pattern for standard and localized AM/PM markers
			var getPatternAmpm = function(amNames, pmNames) {
				var markers = [];
				if (amNames) {
					$.merge(markers, amNames);
				}
				if (pmNames) {
					$.merge(markers, pmNames);
				}
				markers = $.map(markers, function(val) {
					return val.replace(/[.*+?|()\[\]{}\\]/g, '\\$&amp;amp;');
				});
				return '(' + markers.join('|') + ')?';
			};

			// figure out position of time elements.. cause js cant do named captures
			var getFormatPositions = function(timeFormat) {
				var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
					orders = {
						h: -1,
						m: -1,
						s: -1,
						l: -1,
						c: -1,
						t: -1,
						z: -1
					};

				if (finds) {
					for (var i = 0; i &amp;lt; finds.length; i++) {
						if (orders[finds[i].toString().charAt(0)] == -1) {
							orders[finds[i].toString().charAt(0)] = i + 1;
						}
					}
				}
				return orders;
			};

			var regstr = '^' + f.toString()
					.replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
							var ml = match.length;
							switch (match.charAt(0).toLowerCase()) {
								case 'h': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'm': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 's': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'l': return '(\\d?\\d?\\d)';
								case 'c': return '(\\d?\\d?\\d)';
								case 'z': return '(z|[-+]\\d\\d:?\\d\\d|\\S+)?';
								case 't': return getPatternAmpm(o.amNames, o.pmNames);
								default:    // literal escaped in quotes
									return '(' + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function (m) { return "\\" + m; }) + ')?';
							}
						})
					.replace(/\s/g, '\\s?') +
					o.timeSuffix + '$',
				order = getFormatPositions(f),
				ampm = '',
				treg;

			treg = s.match(new RegExp(regstr, 'i'));

			var resTime = {
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0
			};

			if (treg) {
				if (order.t !== -1) {
					if (treg[order.t] === undefined || treg[order.t].length === 0) {
						ampm = '';
						resTime.ampm = '';
					} else {
						ampm = $.inArray(treg[order.t].toUpperCase(), o.amNames) !== -1 ? 'AM' : 'PM';
						resTime.ampm = o[ampm == 'AM' ? 'amNames' : 'pmNames'][0];
					}
				}

				if (order.h !== -1) {
					if (ampm == 'AM' &amp;amp;&amp;amp; treg[order.h] == '12') {
						resTime.hour = 0; // 12am = 0 hour
					} else {
						if (ampm == 'PM' &amp;amp;&amp;amp; treg[order.h] != '12') {
							resTime.hour = parseInt(treg[order.h], 10) + 12; // 12pm = 12 hour, any other pm = hour + 12
						} else {
							resTime.hour = Number(treg[order.h]);
						}
					}
				}

				if (order.m !== -1) {
					resTime.minute = Number(treg[order.m]);
				}
				if (order.s !== -1) {
					resTime.second = Number(treg[order.s]);
				}
				if (order.l !== -1) {
					resTime.millisec = Number(treg[order.l]);
				}
				if (order.c !== -1) {
					resTime.microsec = Number(treg[order.c]);
				}
				if (order.z !== -1 &amp;amp;&amp;amp; treg[order.z] !== undefined) {
					resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z]);
				}


				return resTime;
			}
			return false;
		};// end strictParse

		// First try JS Date, if that fails, use strictParse
		var looseParse = function(f,s,o){
			try{
				var d = new Date('2012-01-01 '+ s);
				if(isNaN(d.getTime())){
					d = new Date('2012-01-01T'+ s);
					if(isNaN(d.getTime())){
						d = new Date('01/01/2012 '+ s);
						if(isNaN(d.getTime())){
							throw "Unable to parse time with native Date: "+ s;
						}
					}
				}

				return {
					hour: d.getHours(),
					minute: d.getMinutes(),
					second: d.getSeconds(),
					millisec: d.getMilliseconds(),
					microsec: d.getMicroseconds(),
					timezone: d.getTimezoneOffset()*-1
				};
			}
			catch(err){
				try{
					return strictParse(f,s,o);
				}
				catch(err2){
					$.timepicker.log("Unable to parse \ntimeString: "+ s +"\ntimeFormat: "+ f);
				}				
			}
			return false;
		}; // end looseParse
		
		if(typeof o.parse === "function"){
			return o.parse(timeFormat, timeString, o);
		}
		if(o.parse === 'loose'){
			return looseParse(timeFormat, timeString, o);
		}
		return strictParse(timeFormat, timeString, o);
	};

	/*
	* Public utility to format the time
	* format = string format of the time
	* time = a {}, not a Date() for timezones
	* options = essentially the regional[].. amNames, pmNames, ampm
	*/
	$.datepicker.formatTime = function(format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			timezone: 0
		}, time);

		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);

		if (hour &amp;gt; 11) {
			ampmName = options.pmNames[0];
		}

		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|('.*?'|".*?"))/g, function(match) {
		switch (match) {
			case 'HH':
				return ('0' + hour).slice(-2);
			case 'H':
				return hour;
			case 'hh':
				return ('0' + convert24to12(hour)).slice(-2);
			case 'h':
				return convert24to12(hour);
			case 'mm':
				return ('0' + time.minute).slice(-2);
			case 'm':
				return time.minute;
			case 'ss':
				return ('0' + time.second).slice(-2);
			case 's':
				return time.second;
			case 'l':
				return ('00' + time.millisec).slice(-3);
			case 'c':
				return ('00' + time.microsec).slice(-3);
			case 'z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, false);
			case 'Z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, true);
			case 'T': 
				return ampmName.charAt(0).toUpperCase();
			case 'TT': 
				return ampmName.toUpperCase();
			case 't':
				return ampmName.charAt(0).toLowerCase();
			case 'tt':
				return ampmName.toLowerCase();
			default:
				return match.replace(/\'/g, "") || "'";
			}
		});

		tmptime = $.trim(tmptime);
		return tmptime;
	};

	/*
	* the bad hack :/ override datepicker so it doesnt close on select
	// inspired: http://stackoverflow.com/questions/1252512/jquery-datepicker-prevent-closing-picker-when-clicking-a-date/1762378#1762378
	*/
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function(id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			tp_inst._limitMinMaxDateTime(inst, true);
			inst.inline = inst.stay_open = true;
			//This way the onSelect handler called from calendarpicker get the full dateTime
			this._base_selectDate(id, dateStr);
			inst.inline = inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst);
		} else {
			this._base_selectDate(id, dateStr);
		}
	};

	/*
	* second bad hack :/ override datepicker so it triggers an event when changing the input field
	* and does not redraw the datepicker on every selectDate event
	*/
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function(inst) {

		// don't popup the datepicker if there is another instance already opened
		var input = inst.input[0];
		if ($.datepicker._curInst &amp;amp;&amp;amp; $.datepicker._curInst != inst &amp;amp;&amp;amp; $.datepicker._datepickerShowing &amp;amp;&amp;amp; $.datepicker._lastInput != input) {
			return;
		}

		if (typeof(inst.stay_open) !== 'boolean' || inst.stay_open === false) {

			this._base_updateDatepicker(inst);

			// Reload the time control when changing something in the input text field.
			var tp_inst = this._get(inst, 'timepicker');
			if (tp_inst) {
				tp_inst._addTimePicker(inst);
			}
		}
	};

	/*
	* third bad hack :/ override datepicker so it allows spaces and colon in the input field
	*/
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if ($.datepicker._get(inst, 'constrainInput')) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null? tp_inst._defaults.showTimezone : tp_inst.support.timezone,					
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat')),
					datetimeChars = tp_inst._defaults.timeFormat.toString()
											.replace(/[hms]/g, '')
											.replace(/TT/g, ampm ? 'APM' : '')
											.replace(/Tt/g, ampm ? 'AaPpMm' : '')
											.replace(/tT/g, ampm ? 'AaPpMm' : '')
											.replace(/T/g, ampm ? 'AP' : '')
											.replace(/tt/g, ampm ? 'apm' : '')
											.replace(/t/g, ampm ? 'ap' : '') + 
											" " + tp_inst._defaults.separator + 
											tp_inst._defaults.timeSuffix + 
											(tz ? tp_inst._defaults.timezoneList.join('') : '') + 
											(tp_inst._defaults.amNames.join('')) + (tp_inst._defaults.pmNames.join('')) + 
											dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr &amp;lt; ' ' || !dateChars || datetimeChars.indexOf(chr) &amp;gt; -1);
			}
		}

		return $.datepicker._base_doKeyPress(event);
	};

	/*
	* Fourth bad hack :/ override _updateAlternate function used in inline mode to init altField
	*/
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	/* Update any alternate field to synchronise with the main field. */
	$.datepicker._updateAlternate = function(inst) {
		var tp_inst = this._get(inst, 'timepicker');
		if(tp_inst){
			var altField = tp_inst._defaults.altField;
			if (altField) { // update alternate field too
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = '', 
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator, 
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if(!tp_inst._defaults.timeOnly &amp;amp;&amp;amp; !tp_inst._defaults.altFieldTimeOnly &amp;amp;&amp;amp; date !== null){
					if(tp_inst._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime;
					}
					else{
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime;
					}
				}
				$(altField).val(altFormattedDateTime);
			}
		}
		else{
			$.datepicker._base_updateAlternate(inst);
		}
	};

	/*
	* Override key up event to sync manual input changes.
	*/
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst);
				} catch (err) {
					$.timepicker.log(err);
				}
			}
		}

		return $.datepicker._base_doKeyUp(event);
	};

	/*
	* override "Today" button to also grab the time.
	*/
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function(id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		this._base_gotoToday(id);
		var tp_inst = this._get(inst, 'timepicker');
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		$('.ui-datepicker-today', $dp).click();
	};

	/*
	* Disable &amp;amp; enable the Time in the datetimepicker
	*/
	$.datepicker._disableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst);
		}
	};

	$.datepicker._enableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst); // Could be disabled on page load
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create our own set time function
	*/
	$.datepicker._setTime = function(inst, date) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var defaults = tp_inst._defaults;

			// calling _setTime with no date sets time to defaults
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;

			//check if within min/max times.. 
			tp_inst._limitMinMaxDateTime(inst, true);

			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create new public method to set only time, callable as $().datepicker('setTime', date)
	*/
	$.datepicker._setTimeDatepicker = function(target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date == "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec);
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds());
				}
				if (tp_date.toString() == 'Invalid Date') {
					tp_date = undefined;
				}
				this._setTime(inst, tp_date);
			}
		}

	};

	/*
	* override setDate() to allow setting time too within Date object
	*/
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function(target, date) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		if(typeof(date) === 'string'){
			date = new Date(date);
			if(!date.getTime()){
				$.timepicker.log("Error creating Date object from string.");
			}
		}

		var tp_inst = this._get(inst, 'timepicker');
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds());
		} else {
			tp_date = date;
		}
		
		// This is important if you are using the timezone option, javascript's Date 
		// object will only return the timezone offset for the current locale, so we 
		// adjust it accordingly.  If not using timezone option this won't matter..
		// If a timezone is different in tp, keep the timezone as is
		if(tp_inst){
			// look out for DST if tz wasn't specified
			if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
				tp_inst.timezone = tp_date.getTimezoneOffset()*-1;
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone);
		}

		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true);
	};

	/*
	* override getDate() to allow getting time too within Date object
	*/
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function(target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			// if it hasn't yet been defined, grab from field
			if(inst.lastVal === undefined){
				this._setDateFromField(inst, noDefault);
			}

			var date = this._getDate(inst);
			if (date &amp;amp;&amp;amp; tp_inst._parseTime($(target).val(), tp_inst.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);

				// This is important if you are using the timezone option, javascript's Date 
				// object will only return the timezone offset for the current locale, so we 
				// adjust it accordingly.  If not using timezone option this won't matter..
				if(tp_inst.timezone != null){
					// look out for DST if tz wasn't specified
					if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
						tp_inst.timezone = date.getTimezoneOffset()*-1;
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
				}
			}
			return date;
		}
		return this._base_getDateDatepicker(target, noDefault);
	};

	/*
	* override parseDate() because UI 1.8.14 throws an error about "Extra characters"
	* An option in datapicker to ignore extra format characters would be nicer.
	*/
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function(format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings);
		} catch (err) {
			// Hack!  The error message ends with a colon, a space, and
			// the "extra" characters.  We rely on that instead of
			// attempting to perfectly reproduce the parsing algorithm.
			if (err.indexOf(":") &amp;gt;= 0) {
				date = this._base_parseDate(format, value.substring(0,value.length-(err.length-err.indexOf(':')-2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format);
			} else {
				throw err;
			}
		}
		return date;
	};

	/*
	* override formatDate to set date with time to the input
	*/
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function(inst, day, month, year) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val();
		}
		return this._base_formatDate(inst);
	};

	/*
	* override options setter to add time to maxDate(Time) and minDate(Time). MaxDate
	*/
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function(target, name, value) {
		var inst = this._getInst(target),
	        name_clone;
		if (!inst) {
			return null;
		}

		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop;
		    if (typeof name == 'string') { // if min/max was set with the string
		        if (name === 'minDate' || name === 'minDateTime') {
		            min = value;
		        } else if (name === 'maxDate' || name === 'maxDateTime') {
		            max = value;
		        } else if (name === 'onSelect') {
		            onselect = value;
		        } else if (overrides.hasOwnProperty(name)) {
		            if (typeof (value) === 'undefined') {
		                return overrides[name];
		            }
		            fns[name] = value;
		            name_clone = {}; //empty results in exiting function after overrides updated
		        }
		    } else if (typeof name == 'object') { //if min/max was set with the JSON
		        if (name.minDate) {
		            min = name.minDate;
		        } else if (name.minDateTime) {
		            min = name.minDateTime;
		        } else if (name.maxDate) {
		            max = name.maxDate;
		        } else if (name.maxDateTime) {
		            max = name.maxDateTime;
		        }
		        for (prop in overrides) {
		            if (overrides.hasOwnProperty(prop) &amp;amp;&amp;amp; name[prop]) {
		                fns[prop] = name[prop];
		            }
		        }
		    }
		    for (prop in fns) {
		        if (fns.hasOwnProperty(prop)) {
		            overrides[prop] = fns[prop];
		            if (!name_clone) { name_clone = $.extend({}, name);}
		            delete name_clone[prop];
		        }
		    }
		    if (name_clone &amp;amp;&amp;amp; isEmptyObject(name_clone)) { return; }
		    if (min) { //if min was set
		        if (min === 0) {
		            min = new Date();
		        } else {
		            min = new Date(min);
		        }
		        tp_inst._defaults.minDate = min;
		        tp_inst._defaults.minDateTime = min;
		    } else if (max) { //if max was set
		        if (max === 0) {
		            max = new Date();
		        } else {
		            max = new Date(max);
		        }
		        tp_inst._defaults.maxDate = max;
		        tp_inst._defaults.maxDateTime = max;
		    } else if (onselect) {
		        tp_inst._defaults.onSelect = onselect;
		    }
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name);
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
	};
	
	/*
	* jQuery isEmptyObject does not check hasOwnProperty - if someone has added to the object prototype,
	* it will return false for all objects
	*/
	var isEmptyObject = function(obj) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(obj)) {
				return false;
			}
		}
		return true;
	};

	/*
	* jQuery extend now ignores nulls!
	*/
	var extendRemove = function(target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] === null || props[name] === undefined) {
				target[name] = props[name];
			}
		}
		return target;
	};

	/*
	* Determine by the time format which units are supported
	* Returns an object of booleans for each unit
	*/
	var detectSupport = function(timeFormat){
		var tf = timeFormat.replace(/\'.*?\'/g,'').toLowerCase(), // removes literals
			isIn = function(f, t){ // does the format contain the token?
					return f.indexOf(t) !== -1? true:false; 
				};
		return {
				hour: isIn(tf,'h'),
				minute: isIn(tf,'m'),
				second: isIn(tf,'s'),
				millisec: isIn(tf,'l'),
				microsec: isIn(tf,'c'),
				timezone: isIn(tf,'z'),
				ampm: isIn(tf,'t') &amp;amp;&amp;amp; isIn(timeFormat,'h'),
				iso8601: isIn(timeFormat, 'Z')
			};
	};

	/*
	* Converts 24 hour format into 12 hour
	* Returns 12 hour without leading 0
	*/
	var convert24to12 = function(hour) {
		if (hour &amp;gt; 12) {
			hour = hour - 12;
		}

		if (hour === 0) {
			hour = 12;
		}

		return String(hour);
	};

	/*
	* Splits datetime string into date ans time substrings.
	* Throws exception when date can't be parsed
	* Returns [dateString, timeString]
	*/
	var splitDateTime = function(dateFormat, dateTimeString, dateSettings, timeSettings) {
		try {
			// The idea is to get the number separator occurances in datetime and the time format requested (since time has 
			// fewer unknowns, mostly numbers and am/pm). We will use the time pattern to split.
			var separator = timeSettings &amp;amp;&amp;amp; timeSettings.separator ? timeSettings.separator : $.timepicker._defaults.separator,
				format = timeSettings &amp;amp;&amp;amp; timeSettings.timeFormat ? timeSettings.timeFormat : $.timepicker._defaults.timeFormat,
				timeParts = format.split(separator), // how many occurances of separator may be in our format?
				timePartsLen = timeParts.length,
				allParts = dateTimeString.split(separator),
				allPartsLen = allParts.length;

			if (allPartsLen &amp;gt; 1) {
				return [
						allParts.splice(0,allPartsLen-timePartsLen).join(separator),
						allParts.splice(0,timePartsLen).join(separator)
					];
			}

		} catch (err) {
			$.timepicker.log('Could not split the date from the time. Please check the following datetimepicker options' +
					"\nthrown error: " + err +
					"\ndateTimeString" + dateTimeString +
					"\ndateFormat = " + dateFormat +
					"\nseparator = " + timeSettings.separator +
					"\ntimeFormat = " + timeSettings.timeFormat);

			if (err.indexOf(":") &amp;gt;= 0) {
				// Hack!  The error message ends with a colon, a space, and
				// the "extra" characters.  We rely on that instead of
				// attempting to perfectly reproduce the parsing algorithm.
				var dateStringLength = dateTimeString.length - (err.length - err.indexOf(':') - 2),
					timeString = dateTimeString.substring(dateStringLength);

				return [$.trim(dateTimeString.substring(0, dateStringLength)), $.trim(dateTimeString.substring(dateStringLength))];

			} else {
				throw err;
			}
		}
		return [dateTimeString, ''];
	};

	/*
	* Internal function to parse datetime interval
	* Returns: {date: Date, timeObj: Object}, where
	*   date - parsed date without time (type Date)
	*   timeObj = {hour: , minute: , second: , millisec: , microsec: } - parsed time. Optional
	*/
	var parseDateTimeInternal = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var date;
		var splitRes = splitDateTime(dateFormat, dateTimeString, dateSettings, timeSettings);
		date = $.datepicker._base_parseDate(dateFormat, splitRes[0], dateSettings);
		if (splitRes[1] !== '') {
			var timeString = splitRes[1],
				parsedTime = $.datepicker.parseTime(timeFormat, timeString, timeSettings);

			if (parsedTime === null) {
				throw 'Wrong time format';
			}
			return {
				date: date,
				timeObj: parsedTime
			};
		} else {
			return {
				date: date
			};
		}
	};

	/*
	* Internal function to set timezone_select to the local timezone
	*/
	var selectLocalTimezone = function(tp_inst, date) {
		if (tp_inst &amp;amp;&amp;amp; tp_inst.timezone_select) {
			var now = typeof date !== 'undefined' ? date : new Date();
			tp_inst.timezone_select.val(now.getTimezoneOffset()*-1);
		}
	};

	/*
	* Create a Singleton Insance
	*/
	$.timepicker = new Timepicker();

	/**
	 * Get the timezone offset as string from a date object (eg '+0530' for UTC+5.5)
	 * @@param  number if not a number this value is returned
	 * @@param boolean if true formats in accordance to iso8601 "+12:45"
	 * @@return string
	 */
	$.timepicker.timezoneOffsetString = function(tzMinutes, iso8601) {
		if(isNaN(tzMinutes) || tzMinutes &amp;gt; 840){
			return tzMinutes;
		}

		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601? ':':'',
			tz = (off &amp;gt;= 0 ? '+' : '-') + ('0' + (hours * 101).toString()).slice(-2) + iso + ('0' + (minutes * 101).toString()).slice(-2);
		
		if(tz == '+00:00'){
			return 'Z';
		}
		return tz;
	};

	/**
	 * Get the number in minutes that represents a timezone string
	 * @@param  string formated like "+0500", "-1245"
	 * @@return number
	 */
	$.timepicker.timezoneOffsetNumber = function(tzString) {
		tzString = tzString.toString().replace(':',''); // excuse any iso8601, end up with "+1245"

		if(tzString.toUpperCase() === 'Z'){ // if iso8601 with Z, its 0 minute offset
			return 0;
		}

		if(!/^(\-|\+)\d{4}$/.test(tzString)){ // possibly a user defined tz, so just give it back
			return tzString;
		}

		return ((tzString.substr(0,1) =='-'? -1 : 1) * // plus or minus
					((parseInt(tzString.substr(1,2),10)*60) + // hours (converted to minutes)
					parseInt(tzString.substr(3,2),10))); // minutes
	};

	/**
	 * No way to set timezone in js Date, so we must adjust the minutes to compensate. (think setDate, getDate)
	 * @@param  date
	 * @@param  string formated like "+0500", "-1245"
	 * @@return date
	 */
	$.timepicker.timezoneAdjust = function(date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if(!isNaN(toTz)){
			date.setMinutes(date.getMinutes()*1 + (date.getTimezoneOffset()*-1 - toTz*1) );
		}
		return date;
	};

	/**
	 * Calls `timepicker()` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * n.b. The input value must be correctly formatted (reformatting is not supported)
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the timepicker() call
	 * @@return jQuery
	 */
	$.timepicker.timeRange = function(startTime, endTime, options) {
		return $.timepicker.handleRange('timepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datetimepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@return jQuery
	 */
	$.timepicker.datetimeRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datetimepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.dateRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.handleRange = function(method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0, // min allowed interval in milliseconds
			maxInterval: 0, // max allowed interval in milliseconds
			start: {},      // options for start picker
			end: {}         // options for end picker
		}, options);

		$.fn[method].call(startTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), endTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), endTime, 'minDate');
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), startTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), startTime, 'maxDate');
			}
		}, options, options.end));

		checkDates(startTime, endTime);
		selected(startTime, endTime, 'minDate');
		selected(endTime, startTime, 'maxDate');

		function checkDates(changed, other) {
			var startdt = startTime[method]('getDate'),
				enddt = endTime[method]('getDate'),
				changeddt = changed[method]('getDate');

			if(startdt !== null){
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());

				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);

				if(options.minInterval &amp;gt; 0 &amp;amp;&amp;amp; minDate &amp;gt; enddt){ // minInterval check
					endTime[method]('setDate',minDate);
				}
				else if(options.maxInterval &amp;gt; 0 &amp;amp;&amp;amp; maxDate &amp;lt; enddt){ // max interval check
					endTime[method]('setDate',maxDate);
				}
				else if (startdt &amp;gt; enddt) {
					other[method]('setDate',changeddt);
				}
			}
		}

		function selected(changed, other, option) {
			if (!changed.val()) {
				return;
			}
			var date = changed[method].call(changed, 'getDate');
			if(date !== null &amp;amp;&amp;amp; options.minInterval &amp;gt; 0){
				if(option == 'minDate'){
					date.setMilliseconds(date.getMilliseconds() + options.minInterval); 
				}
				if(option == 'maxDate'){
					date.setMilliseconds(date.getMilliseconds() - options.minInterval);
				}
			}
			if (date.getTime) {
				other[method].call(other, 'option', option, date);
			}
		}
		return $([startTime.get(0), endTime.get(0)]);
	};

	/**
	 * Log error or data to the console during error or debugging
	 * @@param  Object err pass any type object to log to the console during error or debugging
	 * @@return void
	 */
	$.timepicker.log = function(err){
		if(window.console){
			console.log(err);
		}
	};

	/*
	* Microsecond support
	*/
	if(!Date.prototype.getMicroseconds){
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function(){ return this.microseconds; };
		Date.prototype.setMicroseconds = function(m){ 
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m/1000));
			this.microseconds = m%1000;
			return this;
		};
	}

	/*
	* Keep up with the version
	*/
	$.timepicker.version = "1.3.1";

})(jQuery);
jQuery.noConflict();
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;datetimepicker-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;e73a652e-09fc-4c71-8e7a-e2525a2d2a99&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
function replaceAllString(oriStr, strTarget, strSubString ){
   var strText = oriStr;
   var intIndexOfMatch = strText.indexOf( strTarget );
   while (intIndexOfMatch != -1){
      strText = strText.replace( strTarget, strSubString )
      intIndexOfMatch = strText.indexOf( strTarget );
   }
   return( strText );
}
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&amp;amp;]" + name + "=([^&amp;amp;#]*)"),
    results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
};


   var jobName= getParameterByName('job')
   var fromDate= getParameterByName('fromDate')
   var toDate= getParameterByName('toDate')
   var limit= getParameterByName('limit')
   var selectedIstIid = getParameterByName('IstIid')

  $("#jobname").ready(function(){
   $("#jobname").text(jobName)
   var convertedJobName = replaceAllString(jobName, ".", "_")
   $("#IstIid" + convertedJobName).ready(function(){
     $("#IstIid" + convertedJobName).css("display","block")
     $("#select_" + convertedJobName).ready(function(){
        $("#select_" + convertedJobName).val(selectedIstIid)
     });
   });
 });

  $("#fromDate").ready(function(){
   $("#from-date").val(fromDate)
 });

  $("#toDate").ready(function(){
   $("#to-date").val(toDate)
 });

  $("#limit").ready(function(){
   if(limit!=""){
    $("#limit").val(limit)
   }
 });
 // Get data with ajax
 function ajax_getData(jobName,fromDate,toDate,limit ){
       var convertedJobName = replaceAllString(jobName, ".", "_")
       var istIid = $("#select_" + convertedJobName).val()
       window.location="/xwiki/bin/view/WiperDog/WebHome?job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid="+istIid;
 			/*$.ajax({
			 type: "GET",
			 url:"/xwiki/bin/get/Sandbox/DescriptionForJob?outputSyntax=plain&amp;amp;job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid"+selectedIstIid,
			 success : function(result){
				$("#jobname").html(jobName)
				$("#display").text('[[]]' + result)
			 }
		   });*/
 }
	$("#treemenu2 a").click(function(){
		 var limit = 10
		 var fromDate=""
		 var toDate = ""
		 jobName= $(this).text()
                 $("#jobname").html(jobName)
                 var convertedJobName = replaceAllString(jobName, ".", "_")
                 $("#listIstIid &amp;gt; div").css("display","none")
                 $("#IstIid" + convertedJobName).css("display","block")
		 //ajax_getData(jobName,fromDate,toDate,limit )

	});

	$("#from-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
		dateFormat: 'yy-mm-dd',
	});
	$("#to-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
			dateFormat: 'yy-mm-dd',

	});
	 $("#get-data").on("click",function(){
		var fromDate = $("#from-date").val()
		var toDate =  $("#to-date").val()
		 if( toDate!= "" ){
			  if(fromDate != ""){
				  if($("#from-date").datepicker( "getDate" ) &amp;gt; $("#to-date").datepicker( "getDate" )){
				  alert("'From date' cannot start later than 'To date'")
				  return false
				  }
			  }
		 }
		 limit = $("#limit").val()
		 ajax_getData(jobName,fromDate,toDate,limit )
	});
$(document).ready(function(){

  var dataModelUrl = '/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job='+jobName+'&amp;amp;limit='
       +limit+'&amp;amp;fromDate='+fromDate + '&amp;amp;toDate='+toDate+'&amp;amp;pager=pager2&amp;amp;genp=1&amp;amp;istIid='+selectedIstIid 
       var jqxhr = $.getJSON(dataModelUrl, function(data) {
       $("#livetableList").jqGrid(data);
       $("#livetableList").jqGrid('navGrid', "#livetablePager", {
           edit : false,
           add : false,
           del : false
         });
       })
});
        
jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;process&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;881686cc-1bfc-456e-b8ab-71334c4a45e5&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){

$(function () {
    function drawLineChart(xAxis, series, container, data_detail){
        var dataXAxis = xAxis
        var dataSeries = series
        var detail = data_detail

			$('#containerline' + container).highcharts({

				chart: {
					type:'line'
				},
				title: {
					text: container
				},
				tooltip :{
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				xAxis: dataXAxis ,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				series: dataSeries
			});
		};

		function drawBarChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerbar' + container).highcharts({
				chart: {
					type: 'column'
				},
				title: {
					text: container
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {

					column: {
						pointPadding: 0.2,
						borderWidth: 0
					}
				},
				series: dataSeries
			});
		}

		function drawAreaChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail
			$('#containerarea' + container).highcharts({
				chart: {
					type: 'area'
				},
				title: {
					text: container
				},
				subtitle: {
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					},
					labels: {
						formatter: function() {
							return this.value / 1000;
						}
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {
					area: {
						stacking: 'normal',
						lineColor: '#666666',
						lineWidth: 1,
						marker: {
							lineWidth: 1,
							lineColor: '#666666'
						}
					}
				},
				series: dataSeries
			});
		};

		function drawPieChart(data, container){
			var dataPie = data
			$(document).ready(function () {
				// Build the chart
				$('#container' + container).highcharts({
					chart: {
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: dataPie[0].name
					},
					tooltip: {
						pointFormat: '{series.name}: &amp;lt;b&amp;gt;{point.percentage:.1f}%&amp;lt;/b&amp;gt;'
					},
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							dataLabels: {
								enabled: false
							},
							showInLegend: true
						}
					},
					series: dataPie
				});
			});
		}

		// LINE
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonline_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonline");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Line chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						if(data_all[0][i].series[0].name == null){
							data_all[0][i].series[0].name = lstContainer[0][i]
						}
						drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
					}
				}
			}
		});

		// BAR
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonbar_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonbar");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Bar chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						drawBarChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
					}
				}
			}
		});

		// AREA
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonarea_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonarea");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				// data to display on tooltip
				var data_detail = data_all[0]
				// draw Area Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					drawAreaChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
				}
			}
		});

		// PIE
		$("#piechart").ready(function(){

			var array = $("#jsons&amp;gt;.jsonpie");
			var arrayContainer = $("#jsons&amp;gt;.lstcontainerpie");
			var lstContainer = [];
			var data_all = [];
			for(var i=0;i&amp;lt;array.length;i++){
				data_all[i] = jQuery.parseJSON(array[i].value)
				lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)

			}
			if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
				// data to display on tooltip
				// draw Pie Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					var finalData = []
					finalData[0] = data_all[0][i]
					drawPieChart(finalData, lstContainer[0][i])
				}
			}
		});
	});
	jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;d5873d92-b78b-42fc-9407-46d166204b88&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;/* css for timepicker */
.ui-timepicker-div .ui-widget-header { 
margin-bottom: 8px;
 }

.ui-timepicker-div dl { text-align: left; }
.ui-timepicker-div dl dt { height: 25px; margin-bottom: -25px; }
.ui-timepicker-div dl dd { margin: 0 10px 10px 65px; }
.ui-timepicker-div td { font-size: 90%; }
.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }

.ui-timepicker-rtl{ direction: rtl; }
.ui-timepicker-rtl dl { text-align: right; }
.ui-timepicker-rtl dl dd { margin: 0 65px 10px 10px; }
#ui-datepicker-div{
 position:relative;
 width:auto;
 height:auto
}
&lt;/code&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;datetimepicker -css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;1201fb1a-e9c1-4731-8c74-2ea8c0071959&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;.displayblock {
  border:2px solid;
  -webkit-border-radius:6px;
  background:gray;
  float: left;
  width:100%;
}

.displaypie {
  border:1px solid;
  -webkit-border-radius:6px;
  background:gray;
  width: 48%;
  float: left; 
  height: 300px;
}

.subtype {
  margin-top: 50px;
  font-size: 2em;
  color: red;
}&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;content&gt;{{include document="Lib.DataToDrawChart"/}}
{{include document="Lib.MongoDBConnection"/}}
{{velocity}}
$xwiki.jsx.use('Lib.JQueryUILib')
$xwiki.ssx.use('Lib.MenuGenerator')
$xwiki.jsx.use('Lib.MenuGenerator')
$xwiki.ssx.use('Lib.JQueryUILib')
$xwiki.jsx.use('Lib.JqGridLib')
$xwiki.ssx.use('Lib.JqGridLib') 
{{/velocity}}
{{include document="Lib.MenuGenerator"/}}
{{html wiki="true" clean="false"}}
&amp;lt;div id="viewer"&amp;gt;
&amp;lt;table style="text-align:left"  &amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th &amp;gt;Job name&amp;lt;/th&amp;gt;
  &amp;lt;td colspan=3&amp;gt;&amp;lt;div id="jobname"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
{{groovy}}
import org.xwiki.context.*

def ec = services.component.getInstance(Execution.class).getContext()
def mapJobIstIid = ec.getProperty("mapJobIstIid")

println '{{html clean="false" wiki="false"}}'
println '&amp;lt;tr&amp;gt;'
println '&amp;lt;th&amp;gt;IstIid&amp;lt;/th&amp;gt;'
println '&amp;lt;td colspan=3&amp;gt;'
mapJobIstIid.each{jobEntry-&amp;gt;
  def convertedJobKey = jobEntry.key.replaceAll("\\.","_")
  println "&amp;lt;div id='listIstIid'&amp;gt;"
  println "&amp;lt;div id=IstIid${convertedJobKey} style='display:none'&amp;gt;"
  println "&amp;lt;select id=select_${convertedJobKey}&amp;gt;"
  jobEntry.value.each{
     println "&amp;lt;option value=\"$it\"&amp;gt;$it&amp;lt;/option&amp;gt;"
  }
  println "&amp;lt;/select&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
}
println '&amp;lt;/td&amp;gt;'
println '&amp;lt;/tr&amp;gt;'
println '{{/html}}'
{{/groovy}}
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data monitor from&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="from-date" id="from-date"/&amp;gt;&amp;lt;/td&amp;gt;
  &amp;lt;th&amp;gt;Data monitor to&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="to-date" id="to-date"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data records limit &amp;lt;/th&amp;gt;
  &amp;lt;td &amp;gt;
     &amp;lt;select id="limit"&amp;gt;
       &amp;lt;option value=5&amp;gt;5&amp;lt;/option&amp;gt;
       &amp;lt;option value=10&amp;gt;10&amp;lt;/option&amp;gt;
       &amp;lt;option value=15&amp;gt;15&amp;lt;/option&amp;gt;
       &amp;lt;option value=20&amp;gt;20&amp;lt;/option&amp;gt;
     &amp;lt;/select&amp;gt;
  &amp;lt;/td&amp;gt;
  &amp;lt;td colspan=3 &amp;gt;&amp;lt;input type="button" value="View Data" id="get-data" class="button"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;&amp;lt;div id="display"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
  &amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
&amp;lt;/table&amp;gt;

&amp;lt;/div&amp;gt; 
   
 &amp;lt;/body&amp;gt;

{{/html}}
{{groovy}}
import groovy.json.*
xwiki.jsx.use("Lib.Highcharts")

if(request.xpage == "plain") {
	response.setContentType('text/plain')
}

def listData = []
def job = request.get("job")
def fromDate = request.get("fromDate")
def toDate = request.get("toDate")
def limit= (request.get("limit")!=null)?request.get("limit").toInteger():10
def istIid = request.get("IstIid")

def str= "No data to retrieved !"
def result = null
if(job != "" &amp;amp;&amp;amp; job != null &amp;amp;&amp;amp; istIid != null &amp;amp;&amp;amp; istIid != ""){
	MongoDBConnection.getConnection()
	if(fromDate != "" || toDate != ""){
		result = MongoDBConnection.getDataInPeriod(job,fromDate,toDate,limit,istIid)
	} else {
		result = MongoDBConnection.getDataAllFields(job,limit,istIid)
        }
MongoDBConnection.closeConnection()
} else {
   println "{{warning}}There are no selected job or IstIid{{/warning}}"
}

if( (result != null) &amp;amp;&amp;amp; (result.size() &amp;gt; 0) &amp;amp;&amp;amp; (result[0].KEYEXPR != null)&amp;amp;&amp;amp;!(result[0].KEYEXPR instanceof List )){

if(result[0].type == "Subtyped") {
    println '{{html clean="false" wiki="true"}}'
    //println '&amp;lt;body&amp;gt;'
    def dataSubtype = DataToDrawChart.getDataToDrawSubtype(result)
    def listKey = []
    dataSubtype.each {key,value -&amp;gt;
        listKey.add(key)
    }
    def jsonkey = com.mongodb.util.JSON.serialize(listKey)
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$jsonkey&amp;lt;/textarea&amp;gt;"

    dataSubtype.each {key,value -&amp;gt;
        def dataLine = []
        def dataBar = []
        def dataPie = []
        def dataArea = []
        if(DataToDrawChart.getDataToDrawLine(value) != []) {
            dataLine = DataToDrawChart.getDataToDrawLine(value)
        }
        if(DataToDrawChart.getDataToDrawBar(value) != []) {
            dataBar = DataToDrawChart.getDataToDrawBar(value)
        }
        if(DataToDrawChart.getDataToDrawPie(value) != []) {
            dataPie = DataToDrawChart.getDataToDrawPie(value)
        }
        if(DataToDrawChart.getDataToDrawArea(value) != []) {
            dataArea = DataToDrawChart.getDataToDrawArea(value)
        }

        def chartColumnsLine
        def chartColumnsBar 
        def chartColumnsArea 
        def lstName
        if(dataLine.size() &amp;gt; 0 ){
            chartColumnsLine = dataLine[0].chart_columns
        }
        if(dataBar.size() &amp;gt; 0){
            chartColumnsBar = dataBar[0].chart_columns
        }
        if(dataArea.size() &amp;gt; 0 ){
            chartColumnsArea = dataArea[0].chart_columns
        }
        if(dataPie.size() &amp;gt; 0 ){
            lstName = dataPie['name']
        }

        def tmpListNameContainer = []
	for(def nameContainer in lstName){
	   nameContainer = nameContainer.replaceAll("\\.", "_")
	   tmpListNameContainer.add(nameContainer)
	}
        def jsonPie
        def jsonLine
	def jsonBar
        def jsonArea
        if(dataPie != []) {
	    jsonPie = com.mongodb.util.JSON.serialize(dataPie)
        }
        if(dataLine != []) {
	    jsonLine = com.mongodb.util.JSON.serialize(dataLine)
        }
        if(dataBar != []) {
            jsonBar = com.mongodb.util.JSON.serialize(dataBar)
        }
        if(dataArea != []) {
	    jsonArea = com.mongodb.util.JSON.serialize(dataArea)
        }

	def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
	def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
	def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
	def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

	println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
        if(jsonLine != null) {
	    println "&amp;lt;textarea id=\"jsonline_$key\" &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;" 
        }
	if(jsonBar != null) {
            println "&amp;lt;textarea id=\"jsonbar_$key\"&amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
 	    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
        }
        if(jsonPie != null) {
	    println "&amp;lt;textarea id=\"jsonpie_$key\" &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
        }
        if(jsonArea != null) {
	    println "&amp;lt;textarea id=\"jsonarea_$key\" &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"
	    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
        }

	println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
	println "&amp;lt;input style=\"display:none\" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;"
	println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
	println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'
	println "&amp;lt;/div&amp;gt;"
	  
	def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
	def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
	  
	println "&amp;lt;div style='clear:both'&amp;gt;"
        def description = value.KEYEXPR._description[0][key]
        if(description != null) {
            println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +': ' + description +'&amp;lt;/div&amp;gt;'
        } else {
            println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +'&amp;lt;/div&amp;gt;'
        }
        println "-----"
        if(jsonPie != null) {
	  println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
	  lstName.each{
	    def tmp = it.replaceAll("\\.", "_")
	    println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
        if(jsonLine != null) {
	  def chartLineComment = false
	  chartColumnsLine.each{
	    if(!chartLineComment){
	       println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	       chartLineComment = true  
	    }

	      println " &amp;lt;div class=\"displayblock\" id=\"containerline${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
        println "&amp;amp;nbsp;"

        if(jsonBar != null) {
	  def chartBarComment = false
	  chartColumnsBar.each{
	     if(!chartBarComment){
	        println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	        chartBarComment = true
	      }  

	     println " &amp;lt;div class=\"displayblock\" id=\"containerbar${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
	println "&amp;amp;nbsp;"

        if(jsonArea != null) {
	  def chartAreaComment = false
	  chartColumnsArea.each{
	  if(!chartAreaComment){
	    println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	    chartAreaComment = true
	  }
	    println " &amp;lt;div class=\"displayblock\" id=\"containerarea${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
	println "&amp;lt;/div&amp;gt;"
        
    }
    println '&amp;lt;/body&amp;gt;'
    println '{{/html}}'
} else if(result[0].type == "Store") {
    // data store
    def dataLine = DataToDrawChart.getDataToDrawLine(result)
    def dataBar = DataToDrawChart.getDataToDrawBar(result)
    def dataPie = DataToDrawChart.getDataToDrawPie(result)
    def dataArea = DataToDrawChart.getDataToDrawArea(result)
    def chartColumnsLine 
    def chartColumnsBar 
    def chartColumnsArea 
    def lstName 

    if(dataLine.size() &amp;gt; 0 ){
        chartColumnsLine = dataLine[0].chart_columns
    }
    if(dataBar.size() &amp;gt; 0){
        chartColumnsBar = dataBar[0].chart_columns
    }
    if(dataArea.size() &amp;gt; 0 ){
        chartColumnsArea = dataArea[0].chart_columns
    }
    if(dataPie.size() &amp;gt; 0 ){
        lstName = dataPie['name']
    }

    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
  
    def tmpListNameContainer = []
    for(def nameContainer in lstName){
       nameContainer = nameContainer.replaceAll("\\.", "_")
       tmpListNameContainer.add(nameContainer)
    }
  
    def jsonPie = com.mongodb.util.JSON.serialize(dataPie)
    def jsonLine = com.mongodb.util.JSON.serialize(dataLine)
    def jsonBar = com.mongodb.util.JSON.serialize(dataBar)
    def jsonArea = com.mongodb.util.JSON.serialize(dataArea)

    def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
    def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
    def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
    def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

    def listEmpty = com.mongodb.util.JSON.serialize([])
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$listEmpty&amp;lt;/textarea&amp;gt;" 

    println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'

    println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
    println "&amp;lt;textarea class='jsonline' &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonbar' &amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonpie' &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonarea' &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"

    println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
  
    def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
    def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
  
    println "&amp;lt;div style='clear:both'&amp;gt;"
  
    def chartPieComment = false
    lstName.each{
        if(!chartPieComment) {
            println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
            chartPieComment = true
        }
        def tmp = it.replaceAll("\\.", "_")
        println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    def chartLineComment = false
    chartColumnsLine.each{
    if(!chartLineComment){
        println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
        chartLineComment = true  
    }

    println " &amp;lt;div class=\"displayblock\" id=\"containerline$it\"&amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    println "&amp;amp;nbsp;"
    def chartBarComment = false
    chartColumnsBar.each{
        if(!chartBarComment){
            println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
            chartBarComment = true
        }  

    println " &amp;lt;div class=\"displayblock\" id=\"containerbar$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
  println "&amp;lt;/div&amp;gt;"
  println "&amp;amp;nbsp;"
  def chartAreaComment = false
  chartColumnsArea.each{
  if(!chartAreaComment){
    println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
    chartAreaComment = true
  }
    println " &amp;lt;div class=\"displayblock\" id=\"containerarea$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
  println "&amp;lt;/div&amp;gt;"
println "&amp;lt;/div&amp;gt;"

println '&amp;lt;/body&amp;gt;'
println '{{/html}}'
}
}else{
    println 'There is no data for this job with criterias'
}

{{/groovy}}
{{html wiki="true" clean="false"}}
&amp;lt;center&amp;gt;
&amp;lt;div id="livetblContent" style="width:100%;clear:both;align:middle;margin-top:125px"&amp;gt;
    &amp;lt;table id="livetableList" width="100%" align="center"&amp;gt;&amp;lt;/table&amp;gt;
    &amp;lt;div id="livetablePager"&amp;gt;&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;/center&amp;gt;
{{/html}}
&lt;/content&gt;&lt;/xwikidoc&gt;@


54.5
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376393805000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376393805000&lt;/contentUpdateDate&gt;
&lt;version&gt;54.5&lt;/version&gt;
d3505 1
a3505 1
&amp;lt;div id="livetblContent" style="clear:both;align:middle;margin-top:15px"&amp;gt;
@


54.4
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376393760000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376393760000&lt;/contentUpdateDate&gt;
&lt;version&gt;54.4&lt;/version&gt;
d3504 2
a3505 2
&amp;amp;nbsp;&amp;lt;br/&amp;gt;
&amp;lt;div id="livetblContent" style="clear:both;align:middle"&amp;gt;
d3509 1
@


54.3
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376393728000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376393728000&lt;/contentUpdateDate&gt;
&lt;version&gt;54.3&lt;/version&gt;
d3504 1
a3504 1
&amp;amp;nbsp;
@


54.2
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376393708000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376393708000&lt;/contentUpdateDate&gt;
&lt;version&gt;54.2&lt;/version&gt;
d3504 1
@


54.1
log
@@
text
@&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xwikidoc&gt;
&lt;web&gt;WiperDog&lt;/web&gt;
&lt;name&gt;WebHome&lt;/name&gt;
&lt;language&gt;&lt;/language&gt;
&lt;defaultLanguage&gt;en&lt;/defaultLanguage&gt;
&lt;translation&gt;0&lt;/translation&gt;
&lt;parent&gt;&lt;/parent&gt;
&lt;creator&gt;XWiki.Admin&lt;/creator&gt;
&lt;author&gt;XWiki.Admin&lt;/author&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;contentAuthor&gt;XWiki.Admin&lt;/contentAuthor&gt;
&lt;creationDate&gt;1376364375000&lt;/creationDate&gt;
&lt;date&gt;1376393590000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376393584000&lt;/contentUpdateDate&gt;
&lt;version&gt;54.1&lt;/version&gt;
&lt;title&gt;WiperDog&lt;/title&gt;
&lt;defaultTemplate&gt;&lt;/defaultTemplate&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;comment&gt;&lt;/comment&gt;
&lt;minorEdit&gt;false&lt;/minorEdit&gt;
&lt;syntaxId&gt;xwiki/2.1&lt;/syntaxId&gt;
&lt;hidden&gt;false&lt;/hidden&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;047293a8-524d-45e4-af52-cd944523d5d0&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
/*
 * jQuery timepicker addon
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 1.3.1
 * Last Modified: 07/07/2013
 *
 * Copyright 2013 Trent Richardson
 * You may use this project under MIT or GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 */

/*jslint evil: true, white: false, undef: false, nomen: false */

(function($) {

	/*
	* Lets not redefine timepicker, Prevent "Uncaught RangeError: Maximum call stack size exceeded"
	*/
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return;
	}

	/*
	* Extend jQueryUI, get it started with our version number
	*/
	$.extend($.ui, {
		timepicker: {
			version: "1.3.1"
		}
	});

	/* 
	* Timepicker manager.
	* Use the singleton instance of this class, $.timepicker, to interact with the time picker.
	* Settings for (groups of) time pickers are maintained in an instance object,
	* allowing multiple different settings on the same page.
	*/
	var Timepicker = function() {
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[''] = { // Default regional settings
			currentText: 'Now',
			closeText: 'Done',
			amNames: ['AM', 'A'],
			pmNames: ['PM', 'P'],
			timeFormat: 'HH:mm',
			timeSuffix: '',
			timeOnlyTitle: 'Choose Time',
			timeText: 'Time',
			hourText: 'Hour',
			minuteText: 'Minute',
			secondText: 'Second',
			millisecText: 'Millisecond',
			microsecText: 'Microsecond',
			timezoneText: 'Time Zone',
			isRTL: false
		};
		this._defaults = { // Global defaults for all the datetime picker instances
			showButtonPanel: true,
			timeOnly: false,
			showHour: null,
			showMinute: null,
			showSecond: null,
			showMillisec: null,
			showMicrosec: null,
			showTimezone: null,
			showTime: true,
			stepHour: 1,
			stepMinute: 1,
			stepSecond: 1,
			stepMillisec: 1,
			stepMicrosec: 1,
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null,
			hourMin: 0,
			minuteMin: 0,
			secondMin: 0,
			millisecMin: 0,
			microsecMin: 0,
			hourMax: 23,
			minuteMax: 59,
			secondMax: 59,
			millisecMax: 999,
			microsecMax: 999,
			minDateTime: null,
			maxDateTime: null,
			onSelect: null,
			hourGrid: 0,
			minuteGrid: 0,
			secondGrid: 0,
			millisecGrid: 0,
			microsecGrid: 0,
			alwaysSetTime: true,
			separator: ' ',
			altFieldTimeOnly: true,
			altTimeFormat: null,
			altSeparator: null,
			altTimeSuffix: null,
			pickerTimeFormat: null,
			pickerTimeSuffix: null,
			showTimepicker: true,
			timezoneList: null,
			addSliderAccess: false,
			sliderAccessArgs: null,
			controlType: 'slider',
			defaultValue: null,
			parse: 'strict'
		};
		$.extend(this._defaults, this.regional['']);
	};

	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: '',
		formattedDate: '',
		formattedTime: '',
		formattedDateTime: '',
		timezoneList: null,
		units: ['hour','minute','second','millisec', 'microsec'],
		support: {},
		control: null,

		/* 
		* Override the default settings for all instances of the time picker.
		* @@param  settings  object - the new settings to use as defaults (anonymous object)
		* @@return the manager object
		*/
		setDefaults: function(settings) {
			extendRemove(this._defaults, settings || {});
			return this;
		},

		/*
		* Create a new Timepicker instance
		*/
		_newInst: function($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
            	fns = {},
		    	overrides, i;

			for (var attrName in this._defaults) {
				if(this._defaults.hasOwnProperty(attrName)){
					var attrValue = $input.attr('time:' + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue);
						} catch (err) {
							inlineSettings[attrName] = attrValue;
						}
					}
				}
			}

		    overrides = {
		        beforeShow: function (input, dp_inst) {
		            if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
		                return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst);
		            }
		        },
		        onChangeMonthYear: function (year, month, dp_inst) {
		            // Update the time as well : this prevents the time from disappearing from the $input field.
		            tp_inst._updateDateTime(dp_inst);
		            if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
		                tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst);
		            }
		        },
		        onClose: function (dateText, dp_inst) {
		            if (tp_inst.timeDefined === true &amp;amp;&amp;amp; $input.val() !== '') {
		                tp_inst._updateDateTime(dp_inst);
		            }
		            if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
		                tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst);
		            }
		        }
		    };
		    for (i in overrides) {
		        if (overrides.hasOwnProperty(i)) {
		            fns[i] = opts[i] || null;
		        }
		    }

		    tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
		        evnts:fns,
		        timepicker: tp_inst // add timepicker as a property of datepicker: $.datepicker._get(dp_inst, 'timepicker');
		    });
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function(val) {
				return val.toUpperCase();
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function(val) {
				return val.toUpperCase();
			});

			// detect which units are supported
			tp_inst.support = detectSupport(
					tp_inst._defaults.timeFormat + 
					(tp_inst._defaults.pickerTimeFormat? tp_inst._defaults.pickerTimeFormat:'') + 
					(tp_inst._defaults.altTimeFormat? tp_inst._defaults.altTimeFormat:''));

			// controlType is string - key to our this._controls
			if(typeof(tp_inst._defaults.controlType) === 'string'){
				if(tp_inst._defaults.controlType == 'slider' &amp;amp;&amp;amp; typeof(jQuery.ui.slider) === 'undefined'){
					tp_inst._defaults.controlType = 'select';
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType];
			}
			// controlType is an object and must implement create, options, value methods
			else{ 
				tp_inst.control = tp_inst._defaults.controlType;
			}

			// prep the timezone options
			var timezoneList = [-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,
					0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList;
			}
			var tzl=timezoneList.length,tzi=0,tzv=null;
			if (tzl &amp;gt; 0 &amp;amp;&amp;amp; typeof timezoneList[0] !== 'object') {
				for(; tzi&amp;lt;tzl; tzi++){
					tzv = timezoneList[tzi];
					timezoneList[tzi] = { value: tzv, label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601) };
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;

			// set the default units
			tp_inst.timezone = tp_inst._defaults.timezone !== null? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) : 
							((new Date()).getTimezoneOffset()*-1);
			tp_inst.hour = tp_inst._defaults.hour &amp;lt; tp_inst._defaults.hourMin? tp_inst._defaults.hourMin : 
							tp_inst._defaults.hour &amp;gt; tp_inst._defaults.hourMax? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute &amp;lt; tp_inst._defaults.minuteMin? tp_inst._defaults.minuteMin : 
							tp_inst._defaults.minute &amp;gt; tp_inst._defaults.minuteMax? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second &amp;lt; tp_inst._defaults.secondMin? tp_inst._defaults.secondMin : 
							tp_inst._defaults.second &amp;gt; tp_inst._defaults.secondMax? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec &amp;lt; tp_inst._defaults.millisecMin? tp_inst._defaults.millisecMin : 
							tp_inst._defaults.millisec &amp;gt; tp_inst._defaults.millisecMax? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec &amp;lt; tp_inst._defaults.microsecMin? tp_inst._defaults.microsecMin : 
							tp_inst._defaults.microsec &amp;gt; tp_inst._defaults.microsecMax? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = '';
			tp_inst.$input = $input;

			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField).css({
					cursor: 'pointer'
				}).focus(function() {
					$input.trigger("focus");
				});
			}

			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date();
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date();
			}

			// datepicker needs minDate/maxDate, timepicker needs minDateTime/maxDateTime..
			if (tp_inst._defaults.minDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime());
			}
			if (tp_inst._defaults.minDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime());
			}
			if (tp_inst._defaults.maxDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime());
			}
			if (tp_inst._defaults.maxDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime());
			}
			tp_inst.$input.bind('focus', function() {
				tp_inst._onFocus();
			});

			return tp_inst;
		},

		/*
		* add our sliders to the calendar
		*/
		_addTimePicker: function(dp_inst) {
			var currDT = (this.$altInput &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly) ? this.$input.val() + ' ' + this.$altInput.val() : this.$input.val();

			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
		},

		/*
		* parse the time string from input value or _setTime
		*/
		_parseTime: function(timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0]);
			}

			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, 'dateFormat');
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false;
					}
					$.extend(this, parseRes.timeObj);
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err +
									"\ndate/time string = " + timeString +
									"\ntimeFormat = " + this._defaults.timeFormat +
									"\ndateFormat = " + dp_dateFormat);
					return false;
				}
				return true;
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false;
				}
				$.extend(this, timeObj);
				return true;
			}
		},

		/*
		* generate and inject html for timepicker into ui datepicker
		*/
		_injectTimePicker: function() {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = '',
				uitem = '',
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i=0,
				l=0;

			// Prevent displaying twice
			if ($dp.find("div.ui-timepicker-div").length === 0 &amp;amp;&amp;amp; o.showTimepicker) {
				var noDisplay = ' style="display:none;"',
					html = '&amp;lt;div class="ui-timepicker-div'+ (o.isRTL? ' ui-timepicker-rtl' : '') +'"&amp;gt;&amp;lt;dl&amp;gt;' + '&amp;lt;dt class="ui_tpicker_time_label"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;' + o.timeText + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_time"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the markup
				for(i=0,l=this.units.length; i&amp;lt;l; i++){
					litem = this.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// Added by Peter Medeiros:
					// - Figure out what the hour/minute/second max should be based on the step values.
					// - Example: if stepMinute is 15, then minMax is 45.
					max[litem] = parseInt((o[litem+'Max'] - ((o[litem+'Max'] - o[litem+'Min']) % o['step'+uitem])), 10);
					gridSize[litem] = 0;

					html += '&amp;lt;dt class="ui_tpicker_'+ litem +'_label"' + (show ? '' : noDisplay) + '&amp;gt;' + o[litem +'Text'] + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_'+ litem +'"&amp;gt;&amp;lt;div class="ui_tpicker_'+ litem +'_slider"' + (show ? '' : noDisplay) + '&amp;gt;&amp;lt;/div&amp;gt;';

					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						html += '&amp;lt;div style="padding-left: 1px"&amp;gt;&amp;lt;table class="ui-tpicker-grid-label"&amp;gt;&amp;lt;tr&amp;gt;';

						if(litem == 'hour'){
							for (var h = o[litem+'Min']; h &amp;lt;= max[litem]; h += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm? 'hht':'HH', {hour:h}, o);									
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + tmph + '&amp;lt;/td&amp;gt;';
							}
						}
						else{
							for (var m = o[litem+'Min']; m &amp;lt;= max[litem]; m += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + ((m &amp;lt; 10) ? '0' : '') + m + '&amp;lt;/td&amp;gt;';
							}
						}

						html += '&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;&amp;lt;/div&amp;gt;';
					}
					html += '&amp;lt;/dd&amp;gt;';
				}
				
				// Timezone
				var showTz = o.showTimezone !== null? o.showTimezone : this.support.timezone;
				html += '&amp;lt;dt class="ui_tpicker_timezone_label"' + (showTz ? '' : noDisplay) + '&amp;gt;' + o.timezoneText + '&amp;lt;/dt&amp;gt;';
				html += '&amp;lt;dd class="ui_tpicker_timezone" ' + (showTz ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the elements from string
				html += '&amp;lt;/dl&amp;gt;&amp;lt;/div&amp;gt;';
				var $tp = $(html);

				// if we only want time picker...
				if (o.timeOnly === true) {
					$tp.prepend('&amp;lt;div class="ui-widget-header ui-helper-clearfix ui-corner-all"&amp;gt;' + '&amp;lt;div class="ui-datepicker-title"&amp;gt;' + o.timeOnlyTitle + '&amp;lt;/div&amp;gt;' + '&amp;lt;/div&amp;gt;');
					$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();
				}
				
				// add sliders, adjust grids, add events
				for(i=0,l=tp_inst.units.length; i&amp;lt;l; i++){
					litem = tp_inst.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// add the slider
					tp_inst[litem+'_slider'] = tp_inst.control.create(tp_inst, $tp.find('.ui_tpicker_'+litem+'_slider'), litem, tp_inst[litem], o[litem+'Min'], max[litem], o['step'+uitem]);

					// adjust the grid and add click event
					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						size = 100 * gridSize[litem] * o[litem+'Grid'] / (max[litem] - o[litem+'Min']);
						$tp.find('.ui_tpicker_'+litem+' table').css({
							width: size + "%",
							marginLeft: o.isRTL? '0' : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL? ((size / (-2 * gridSize[litem])) + "%") : '0',
							borderCollapse: 'collapse'
						}).find("td").click(function(e){
								var $t = $(this),
									h = $t.html(),
									n = parseInt(h.replace(/[^0-9]/g),10),
									ap = h.replace(/[^apm]/ig),
									f = $t.data('for'); // loses scope, so we use data-for

								if(f == 'hour'){
									if(ap.indexOf('p') !== -1 &amp;amp;&amp;amp; n &amp;lt; 12){
										n += 12;
									}
									else{
										if(ap.indexOf('a') !== -1 &amp;amp;&amp;amp; n === 12){
											n = 0;
										}
									}
								}
								
								tp_inst.control.value(tp_inst, tp_inst[f+'_slider'], litem, n);

								tp_inst._onTimeChange();
								tp_inst._onSelectHandler();
							}).css({
								cursor: 'pointer',
								width: (100 / gridSize[litem]) + '%',
								textAlign: 'center',
								overflow: 'hidden'
							});
					} // end if grid &amp;gt; 0
				} // end for loop

				// Add timezone options
				this.timezone_select = $tp.find('.ui_tpicker_timezone').append('&amp;lt;select&amp;gt;&amp;lt;/select&amp;gt;').find("select");
				$.fn.append.apply(this.timezone_select,
				$.map(o.timezoneList, function(val, idx) {
					return $("&amp;lt;option /&amp;gt;").val(typeof val == "object" ? val.value : val).text(typeof val == "object" ? val.label : val);
				}));
				if (typeof(this.timezone) != "undefined" &amp;amp;&amp;amp; this.timezone !== null &amp;amp;&amp;amp; this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset()*-1;
					if (local_timezone == this.timezone) {
						selectLocalTimezone(tp_inst);
					} else {
						this.timezone_select.val(this.timezone);
					}
				} else {
					if (typeof(this.hour) != "undefined" &amp;amp;&amp;amp; this.hour !== null &amp;amp;&amp;amp; this.hour !== "") {
						this.timezone_select.val(o.timezone);
					} else {
						selectLocalTimezone(tp_inst);
					}
				}
				this.timezone_select.change(function() {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
				});
				// End timezone options
				
				// inject timepicker into datepicker
				var $buttonPanel = $dp.find('.ui-datepicker-buttonpane');
				if ($buttonPanel.length) {
					$buttonPanel.before($tp);
				} else {
					$dp.append($tp);
				}

				this.$timeObj = $tp.find('.ui_tpicker_time');

				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined;
				}

				// slideAccess integration: http://trentrichardson.com/2011/11/11/jquery-ui-sliders-and-touch-accessibility/
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
						
					setTimeout(function() { // fix for inline mode
						if ($tp.find('.ui-slider-access').length === 0) {
							$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);

							// fix any grids since sliders are shorter
							var sliderAccessWidth = $tp.find('.ui-slider-access:eq(0)').outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find('table:visible').each(function() {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl? 'marginRight':'marginLeft').toString().replace('%', ''),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + '%',
										css = { width: newWidth, marginRight: 0, marginLeft: 0 };
									css[rtl? 'marginRight':'marginLeft'] = newMarginLeft;
									$g.css(css);
								});
							}
						}
					}, 10);
				}
				// end slideAccess integration

				tp_inst._limitMinMaxDateTime(this.inst, true);
			}
		},

		/*
		* This function tries to limit the ability to go outside the
		* min/max date range
		*/
		_limitMinMaxDateTime: function(dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);

			if (!this._defaults.showTimepicker) {
				return;
			} // No time so nothing to check here

			if ($.datepicker._get(dp_inst, 'minDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'minDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, 'minDateTime'),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin;
				}

				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour &amp;lt;= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute &amp;lt;= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second &amp;lt;= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if(this.millisec &amp;lt;= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;lt; this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin;
									}
									this._defaults.microsecMin = this.microsecMinOriginal;
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal;
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal;
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal;
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal;
				}
			}

			if ($.datepicker._get(dp_inst, 'maxDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'maxDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, 'maxDateTime'),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax;
				}

				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour &amp;gt;= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute &amp;gt;= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second &amp;gt;= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec &amp;gt;= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;gt; this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax;
									}
									this._defaults.microsecMax = this.microsecMaxOriginal;
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal;
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal;
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal;
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal;
				}
			}

			if (adjustSliders !== undefined &amp;amp;&amp;amp; adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10);
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);

				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, 'hour', { min: this._defaults.hourMin, max: hourMax });
					this.control.value(this, this.hour_slider, 'hour', this.hour - (this.hour % this._defaults.stepHour));
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, 'minute', { min: this._defaults.minuteMin, max: minMax });
					this.control.value(this, this.minute_slider, 'minute', this.minute - (this.minute % this._defaults.stepMinute));
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, 'second', { min: this._defaults.secondMin, max: secMax });
					this.control.value(this, this.second_slider, 'second', this.second - (this.second % this._defaults.stepSecond));
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, 'millisec', { min: this._defaults.millisecMin, max: millisecMax });
					this.control.value(this, this.millisec_slider, 'millisec', this.millisec - (this.millisec % this._defaults.stepMillisec));
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, 'microsec', { min: this._defaults.microsecMin, max: microsecMax });
					this.control.value(this, this.microsec_slider, 'microsec', this.microsec - (this.microsec % this._defaults.stepMicrosec));
				}
			}

		},

		/*
		* when a slider moves, set the internal time...
		* on time change is also called when the time is updated in the text field
		*/
		_onTimeChange: function() {
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, 'hour') : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, 'minute') : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, 'second') : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, 'millisec') : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, 'microsec') : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;

			if (typeof(hour) == 'object') {
				hour = false;
			}
			if (typeof(minute) == 'object') {
				minute = false;
			}
			if (typeof(second) == 'object') {
				second = false;
			}
			if (typeof(millisec) == 'object') {
				millisec = false;
			}
			if (typeof(microsec) == 'object') {
				microsec = false;
			}
			if (typeof(timezone) == 'object') {
				timezone = false;
			}

			if (hour !== false) {
				hour = parseInt(hour, 10);
			}
			if (minute !== false) {
				minute = parseInt(minute, 10);
			}
			if (second !== false) {
				second = parseInt(second, 10);
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10);
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10);
			}

			var ampm = o[hour &amp;lt; 12 ? 'amNames' : 'pmNames'][0];

			// If the update was done in the input field, the input field should not be updated.
			// If the update was done using the sliders, update the input field.
			var hasChanged = (hour != this.hour || minute != this.minute || second != this.second || millisec != this.millisec || microsec != this.microsec 
								|| (this.ampm.length &amp;gt; 0 &amp;amp;&amp;amp; (hour &amp;lt; 12) != ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) 
								|| (this.timezone !== null &amp;amp;&amp;amp; timezone != this.timezone));

			if (hasChanged) {

				if (hour !== false) {
					this.hour = hour;
				}
				if (minute !== false) {
					this.minute = minute;
				}
				if (second !== false) {
					this.second = second;
				}
				if (millisec !== false) {
					this.millisec = millisec;
				}
				if (microsec !== false) {
					this.microsec = microsec;
				}
				if (timezone !== false) {
					this.timezone = timezone;
				}

				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0]);
				}

				this._limitMinMaxDateTime(this.inst, true);
			}
			if (this.support.ampm) {
				this.ampm = ampm;
			}

			// Updates the time within the timepicker
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if(pickerTimeFormat === o.timeFormat){
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix);
				}
				else{
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix);
				}
			}

			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime();
			}
		},

		/*
		* call custom onSelect.
		* bind to sliders slidestop, and grid click.
		*/
		_onSelectHandler: function() {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect &amp;amp;&amp;amp; inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this]);
			}
		},

		/*
		* update our input with the new date time..
		*/
		_updateDateTime: function(dp_inst) {
			dp_inst = this.inst || dp_inst;
			//var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
			var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay)),
				dateFmt = $.datepicker._get(dp_inst, 'dateFormat'),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null &amp;amp;&amp;amp; this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			
			// if a slider was changed but datepicker doesn't have a value yet, set it
			if(dp_inst.lastVal===""){
                dp_inst.currentYear=dp_inst.selectedYear;
                dp_inst.currentMonth=dp_inst.selectedMonth;
                dp_inst.currentDay=dp_inst.selectedDay;
            }

			/*
			* remove following lines to force every changes in date picker to change the input value
			* Bug descriptions: when an input field has a default value, and click on the field to pop up the date picker. 
			* If the user manually empty the value in the input field, the date picker will never change selected value.
			*/
			//if (dp_inst.lastVal !== undefined &amp;amp;&amp;amp; (dp_inst.lastVal.length &amp;gt; 0 &amp;amp;&amp;amp; this.$input.val().length === 0)) {
			//	return;
			//}

			if (this._defaults.timeOnly === true) {
				formattedDateTime = this.formattedTime;
			} else if (this._defaults.timeOnly !== true &amp;amp;&amp;amp; (this._defaults.alwaysSetTime || timeAvailable)) {
				formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix;
			}

			this.formattedDateTime = formattedDateTime;

			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate);
			} else if (this.$altInput &amp;amp;&amp;amp; this._defaults.timeOnly === false &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly === true) {
				this.$altInput.val(this.formattedTime);
				this.$input.val(this.formattedDate);
			} else if (this.$altInput) {
				this.$input.val(formattedDateTime);
				var altFormattedDateTime = '',
					altSeparator = this._defaults.altSeparator ? this._defaults.altSeparator : this._defaults.separator,
					altTimeSuffix = this._defaults.altTimeSuffix ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
				
				if(!this._defaults.timeOnly){
					if (this._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg);
					}
					else{
						altFormattedDateTime = this.formattedDate;
					}

					if (altFormattedDateTime){
						altFormattedDateTime += altSeparator;
					}
				}

				if(this._defaults.altTimeFormat){
					altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix;
				}
				else{
					altFormattedDateTime += this.formattedTime + altTimeSuffix;
				}
				this.$altInput.val(altFormattedDateTime);
			} else {
				this.$input.val(formattedDateTime);
			}

			this.$input.trigger("change");
		},

		_onFocus: function() {
			if (!this.$input.val() &amp;amp;&amp;amp; this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, 'timepicker');
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst);
						} catch (err) {
							$.timepicker.log(err);
						}
					}
				}
			}
		},

		/*
		* Small abstraction to control types
		* We can add more, just be sure to follow the pattern: create, options, value
		*/
		_controls: {
			// slider methods
			slider: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var rtl = tp_inst._defaults.isRTL; // if rtl go -60-&amp;gt;0 instead of 0-&amp;gt;60
					return obj.prop('slide', null).slider({
						orientation: "horizontal",
						value: rtl? val*-1 : val,
						min: rtl? max*-1 : min,
						max: rtl? min*-1 : max,
						step: step,
						slide: function(event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl? ui.value*-1:ui.value);
							tp_inst._onTimeChange();
						},
						stop: function(event, ui) {
							tp_inst._onSelectHandler();
						}
					});	
				},
				options: function(tp_inst, obj, unit, opts, val){
					if(tp_inst._defaults.isRTL){
						if(typeof(opts) == 'string'){
							if(opts == 'min' || opts == 'max'){
								if(val !== undefined){
									return obj.slider(opts, val*-1);
								}
								return Math.abs(obj.slider(opts));
							}
							return obj.slider(opts);
						}
						var min = opts.min, 
							max = opts.max;
						opts.min = opts.max = null;
						if(min !== undefined){
							opts.max = min * -1;
						}
						if(max !== undefined){
							opts.min = max * -1;
						}
						return obj.slider(opts);
					}
					if(typeof(opts) == 'string' &amp;amp;&amp;amp; val !== undefined){
							return obj.slider(opts, val);
					}
					return obj.slider(opts);
				},
				value: function(tp_inst, obj, unit, val){
					if(tp_inst._defaults.isRTL){
						if(val !== undefined){
							return obj.slider('value', val*-1);
						}
						return Math.abs(obj.slider('value'));
					}
					if(val !== undefined){
						return obj.slider('value', val);
					}
					return obj.slider('value');
				}
			},
			// select methods
			select: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var sel = '&amp;lt;select class="ui-timepicker-select" data-unit="'+ unit +'" data-min="'+ min +'" data-max="'+ max +'" data-step="'+ step +'"&amp;gt;',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;

					for(var i=min; i&amp;lt;=max; i+=step){						
						sel += '&amp;lt;option value="'+ i +'"'+ (i==val? ' selected':'') +'&amp;gt;';
						if(unit == 'hour'){
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig,'')), {hour:i}, tp_inst._defaults);
						}
						else if(unit == 'millisec' || unit == 'microsec' || i &amp;gt;= 10){ sel += i; }
						else {sel += '0'+ i.toString(); }
						sel += '&amp;lt;/option&amp;gt;';
					}
					sel += '&amp;lt;/select&amp;gt;';

					obj.children('select').remove();

					$(sel).appendTo(obj).change(function(e){
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
					});

					return obj;
				},
				options: function(tp_inst, obj, unit, opts, val){
					var o = {},
						$t = obj.children('select');
					if(typeof(opts) == 'string'){
						if(val === undefined){
							return $t.data(opts);
						}
						o[opts] = val;	
					}
					else{ o = opts; }
					return tp_inst.control.create(tp_inst, obj, $t.data('unit'), $t.val(), o.min || $t.data('min'), o.max || $t.data('max'), o.step || $t.data('step'));
				},
				value: function(tp_inst, obj, unit, val){
					var $t = obj.children('select');
					if(val !== undefined){
						return $t.val(val);
					}
					return $t.val();
				}
			}
		} // end _controls

	});

	$.fn.extend({
		/*
		* shorthand just to use timepicker..
		*/
		timepicker: function(o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);

			if (typeof o == 'object') {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				});
			}

			return $(this).each(function() {
				$.fn.datetimepicker.apply($(this), tmp_args);
			});
		},

		/*
		* extend timepicker to datepicker
		*/
		datetimepicker: function(o) {
			o = o || {};
			var tmp_args = arguments;

			if (typeof(o) == 'string') {
				if (o == 'getDate') {
					return $.fn.datepicker.apply($(this[0]), tmp_args);
				} else {
					return this.each(function() {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args);
					});
				}
			} else {
				return this.each(function() {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults);
				});
			}
		}
	});

	/*
	* Public Utility to parse date and time
	*/
	$.datepicker.parseDateTime = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec);
		}

		return parseRes.date;
	};

	/*
	* Public utility to parse time
	*/
	$.datepicker.parseTime = function(timeFormat, timeString, options) {		
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g,'').indexOf('Z') !== -1);

		// Strict parse requires the timeString to match the timeFormat exactly
		var strictParse = function(f, s, o){

			// pattern for standard and localized AM/PM markers
			var getPatternAmpm = function(amNames, pmNames) {
				var markers = [];
				if (amNames) {
					$.merge(markers, amNames);
				}
				if (pmNames) {
					$.merge(markers, pmNames);
				}
				markers = $.map(markers, function(val) {
					return val.replace(/[.*+?|()\[\]{}\\]/g, '\\$&amp;amp;');
				});
				return '(' + markers.join('|') + ')?';
			};

			// figure out position of time elements.. cause js cant do named captures
			var getFormatPositions = function(timeFormat) {
				var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
					orders = {
						h: -1,
						m: -1,
						s: -1,
						l: -1,
						c: -1,
						t: -1,
						z: -1
					};

				if (finds) {
					for (var i = 0; i &amp;lt; finds.length; i++) {
						if (orders[finds[i].toString().charAt(0)] == -1) {
							orders[finds[i].toString().charAt(0)] = i + 1;
						}
					}
				}
				return orders;
			};

			var regstr = '^' + f.toString()
					.replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
							var ml = match.length;
							switch (match.charAt(0).toLowerCase()) {
								case 'h': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'm': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 's': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'l': return '(\\d?\\d?\\d)';
								case 'c': return '(\\d?\\d?\\d)';
								case 'z': return '(z|[-+]\\d\\d:?\\d\\d|\\S+)?';
								case 't': return getPatternAmpm(o.amNames, o.pmNames);
								default:    // literal escaped in quotes
									return '(' + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function (m) { return "\\" + m; }) + ')?';
							}
						})
					.replace(/\s/g, '\\s?') +
					o.timeSuffix + '$',
				order = getFormatPositions(f),
				ampm = '',
				treg;

			treg = s.match(new RegExp(regstr, 'i'));

			var resTime = {
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0
			};

			if (treg) {
				if (order.t !== -1) {
					if (treg[order.t] === undefined || treg[order.t].length === 0) {
						ampm = '';
						resTime.ampm = '';
					} else {
						ampm = $.inArray(treg[order.t].toUpperCase(), o.amNames) !== -1 ? 'AM' : 'PM';
						resTime.ampm = o[ampm == 'AM' ? 'amNames' : 'pmNames'][0];
					}
				}

				if (order.h !== -1) {
					if (ampm == 'AM' &amp;amp;&amp;amp; treg[order.h] == '12') {
						resTime.hour = 0; // 12am = 0 hour
					} else {
						if (ampm == 'PM' &amp;amp;&amp;amp; treg[order.h] != '12') {
							resTime.hour = parseInt(treg[order.h], 10) + 12; // 12pm = 12 hour, any other pm = hour + 12
						} else {
							resTime.hour = Number(treg[order.h]);
						}
					}
				}

				if (order.m !== -1) {
					resTime.minute = Number(treg[order.m]);
				}
				if (order.s !== -1) {
					resTime.second = Number(treg[order.s]);
				}
				if (order.l !== -1) {
					resTime.millisec = Number(treg[order.l]);
				}
				if (order.c !== -1) {
					resTime.microsec = Number(treg[order.c]);
				}
				if (order.z !== -1 &amp;amp;&amp;amp; treg[order.z] !== undefined) {
					resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z]);
				}


				return resTime;
			}
			return false;
		};// end strictParse

		// First try JS Date, if that fails, use strictParse
		var looseParse = function(f,s,o){
			try{
				var d = new Date('2012-01-01 '+ s);
				if(isNaN(d.getTime())){
					d = new Date('2012-01-01T'+ s);
					if(isNaN(d.getTime())){
						d = new Date('01/01/2012 '+ s);
						if(isNaN(d.getTime())){
							throw "Unable to parse time with native Date: "+ s;
						}
					}
				}

				return {
					hour: d.getHours(),
					minute: d.getMinutes(),
					second: d.getSeconds(),
					millisec: d.getMilliseconds(),
					microsec: d.getMicroseconds(),
					timezone: d.getTimezoneOffset()*-1
				};
			}
			catch(err){
				try{
					return strictParse(f,s,o);
				}
				catch(err2){
					$.timepicker.log("Unable to parse \ntimeString: "+ s +"\ntimeFormat: "+ f);
				}				
			}
			return false;
		}; // end looseParse
		
		if(typeof o.parse === "function"){
			return o.parse(timeFormat, timeString, o);
		}
		if(o.parse === 'loose'){
			return looseParse(timeFormat, timeString, o);
		}
		return strictParse(timeFormat, timeString, o);
	};

	/*
	* Public utility to format the time
	* format = string format of the time
	* time = a {}, not a Date() for timezones
	* options = essentially the regional[].. amNames, pmNames, ampm
	*/
	$.datepicker.formatTime = function(format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			timezone: 0
		}, time);

		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);

		if (hour &amp;gt; 11) {
			ampmName = options.pmNames[0];
		}

		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|('.*?'|".*?"))/g, function(match) {
		switch (match) {
			case 'HH':
				return ('0' + hour).slice(-2);
			case 'H':
				return hour;
			case 'hh':
				return ('0' + convert24to12(hour)).slice(-2);
			case 'h':
				return convert24to12(hour);
			case 'mm':
				return ('0' + time.minute).slice(-2);
			case 'm':
				return time.minute;
			case 'ss':
				return ('0' + time.second).slice(-2);
			case 's':
				return time.second;
			case 'l':
				return ('00' + time.millisec).slice(-3);
			case 'c':
				return ('00' + time.microsec).slice(-3);
			case 'z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, false);
			case 'Z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, true);
			case 'T': 
				return ampmName.charAt(0).toUpperCase();
			case 'TT': 
				return ampmName.toUpperCase();
			case 't':
				return ampmName.charAt(0).toLowerCase();
			case 'tt':
				return ampmName.toLowerCase();
			default:
				return match.replace(/\'/g, "") || "'";
			}
		});

		tmptime = $.trim(tmptime);
		return tmptime;
	};

	/*
	* the bad hack :/ override datepicker so it doesnt close on select
	// inspired: http://stackoverflow.com/questions/1252512/jquery-datepicker-prevent-closing-picker-when-clicking-a-date/1762378#1762378
	*/
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function(id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			tp_inst._limitMinMaxDateTime(inst, true);
			inst.inline = inst.stay_open = true;
			//This way the onSelect handler called from calendarpicker get the full dateTime
			this._base_selectDate(id, dateStr);
			inst.inline = inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst);
		} else {
			this._base_selectDate(id, dateStr);
		}
	};

	/*
	* second bad hack :/ override datepicker so it triggers an event when changing the input field
	* and does not redraw the datepicker on every selectDate event
	*/
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function(inst) {

		// don't popup the datepicker if there is another instance already opened
		var input = inst.input[0];
		if ($.datepicker._curInst &amp;amp;&amp;amp; $.datepicker._curInst != inst &amp;amp;&amp;amp; $.datepicker._datepickerShowing &amp;amp;&amp;amp; $.datepicker._lastInput != input) {
			return;
		}

		if (typeof(inst.stay_open) !== 'boolean' || inst.stay_open === false) {

			this._base_updateDatepicker(inst);

			// Reload the time control when changing something in the input text field.
			var tp_inst = this._get(inst, 'timepicker');
			if (tp_inst) {
				tp_inst._addTimePicker(inst);
			}
		}
	};

	/*
	* third bad hack :/ override datepicker so it allows spaces and colon in the input field
	*/
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if ($.datepicker._get(inst, 'constrainInput')) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null? tp_inst._defaults.showTimezone : tp_inst.support.timezone,					
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat')),
					datetimeChars = tp_inst._defaults.timeFormat.toString()
											.replace(/[hms]/g, '')
											.replace(/TT/g, ampm ? 'APM' : '')
											.replace(/Tt/g, ampm ? 'AaPpMm' : '')
											.replace(/tT/g, ampm ? 'AaPpMm' : '')
											.replace(/T/g, ampm ? 'AP' : '')
											.replace(/tt/g, ampm ? 'apm' : '')
											.replace(/t/g, ampm ? 'ap' : '') + 
											" " + tp_inst._defaults.separator + 
											tp_inst._defaults.timeSuffix + 
											(tz ? tp_inst._defaults.timezoneList.join('') : '') + 
											(tp_inst._defaults.amNames.join('')) + (tp_inst._defaults.pmNames.join('')) + 
											dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr &amp;lt; ' ' || !dateChars || datetimeChars.indexOf(chr) &amp;gt; -1);
			}
		}

		return $.datepicker._base_doKeyPress(event);
	};

	/*
	* Fourth bad hack :/ override _updateAlternate function used in inline mode to init altField
	*/
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	/* Update any alternate field to synchronise with the main field. */
	$.datepicker._updateAlternate = function(inst) {
		var tp_inst = this._get(inst, 'timepicker');
		if(tp_inst){
			var altField = tp_inst._defaults.altField;
			if (altField) { // update alternate field too
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = '', 
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator, 
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if(!tp_inst._defaults.timeOnly &amp;amp;&amp;amp; !tp_inst._defaults.altFieldTimeOnly &amp;amp;&amp;amp; date !== null){
					if(tp_inst._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime;
					}
					else{
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime;
					}
				}
				$(altField).val(altFormattedDateTime);
			}
		}
		else{
			$.datepicker._base_updateAlternate(inst);
		}
	};

	/*
	* Override key up event to sync manual input changes.
	*/
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst);
				} catch (err) {
					$.timepicker.log(err);
				}
			}
		}

		return $.datepicker._base_doKeyUp(event);
	};

	/*
	* override "Today" button to also grab the time.
	*/
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function(id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		this._base_gotoToday(id);
		var tp_inst = this._get(inst, 'timepicker');
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		$('.ui-datepicker-today', $dp).click();
	};

	/*
	* Disable &amp;amp; enable the Time in the datetimepicker
	*/
	$.datepicker._disableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst);
		}
	};

	$.datepicker._enableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst); // Could be disabled on page load
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create our own set time function
	*/
	$.datepicker._setTime = function(inst, date) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var defaults = tp_inst._defaults;

			// calling _setTime with no date sets time to defaults
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;

			//check if within min/max times.. 
			tp_inst._limitMinMaxDateTime(inst, true);

			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create new public method to set only time, callable as $().datepicker('setTime', date)
	*/
	$.datepicker._setTimeDatepicker = function(target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date == "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec);
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds());
				}
				if (tp_date.toString() == 'Invalid Date') {
					tp_date = undefined;
				}
				this._setTime(inst, tp_date);
			}
		}

	};

	/*
	* override setDate() to allow setting time too within Date object
	*/
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function(target, date) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		if(typeof(date) === 'string'){
			date = new Date(date);
			if(!date.getTime()){
				$.timepicker.log("Error creating Date object from string.");
			}
		}

		var tp_inst = this._get(inst, 'timepicker');
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds());
		} else {
			tp_date = date;
		}
		
		// This is important if you are using the timezone option, javascript's Date 
		// object will only return the timezone offset for the current locale, so we 
		// adjust it accordingly.  If not using timezone option this won't matter..
		// If a timezone is different in tp, keep the timezone as is
		if(tp_inst){
			// look out for DST if tz wasn't specified
			if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
				tp_inst.timezone = tp_date.getTimezoneOffset()*-1;
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone);
		}

		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true);
	};

	/*
	* override getDate() to allow getting time too within Date object
	*/
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function(target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			// if it hasn't yet been defined, grab from field
			if(inst.lastVal === undefined){
				this._setDateFromField(inst, noDefault);
			}

			var date = this._getDate(inst);
			if (date &amp;amp;&amp;amp; tp_inst._parseTime($(target).val(), tp_inst.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);

				// This is important if you are using the timezone option, javascript's Date 
				// object will only return the timezone offset for the current locale, so we 
				// adjust it accordingly.  If not using timezone option this won't matter..
				if(tp_inst.timezone != null){
					// look out for DST if tz wasn't specified
					if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
						tp_inst.timezone = date.getTimezoneOffset()*-1;
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
				}
			}
			return date;
		}
		return this._base_getDateDatepicker(target, noDefault);
	};

	/*
	* override parseDate() because UI 1.8.14 throws an error about "Extra characters"
	* An option in datapicker to ignore extra format characters would be nicer.
	*/
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function(format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings);
		} catch (err) {
			// Hack!  The error message ends with a colon, a space, and
			// the "extra" characters.  We rely on that instead of
			// attempting to perfectly reproduce the parsing algorithm.
			if (err.indexOf(":") &amp;gt;= 0) {
				date = this._base_parseDate(format, value.substring(0,value.length-(err.length-err.indexOf(':')-2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format);
			} else {
				throw err;
			}
		}
		return date;
	};

	/*
	* override formatDate to set date with time to the input
	*/
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function(inst, day, month, year) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val();
		}
		return this._base_formatDate(inst);
	};

	/*
	* override options setter to add time to maxDate(Time) and minDate(Time). MaxDate
	*/
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function(target, name, value) {
		var inst = this._getInst(target),
	        name_clone;
		if (!inst) {
			return null;
		}

		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop;
		    if (typeof name == 'string') { // if min/max was set with the string
		        if (name === 'minDate' || name === 'minDateTime') {
		            min = value;
		        } else if (name === 'maxDate' || name === 'maxDateTime') {
		            max = value;
		        } else if (name === 'onSelect') {
		            onselect = value;
		        } else if (overrides.hasOwnProperty(name)) {
		            if (typeof (value) === 'undefined') {
		                return overrides[name];
		            }
		            fns[name] = value;
		            name_clone = {}; //empty results in exiting function after overrides updated
		        }
		    } else if (typeof name == 'object') { //if min/max was set with the JSON
		        if (name.minDate) {
		            min = name.minDate;
		        } else if (name.minDateTime) {
		            min = name.minDateTime;
		        } else if (name.maxDate) {
		            max = name.maxDate;
		        } else if (name.maxDateTime) {
		            max = name.maxDateTime;
		        }
		        for (prop in overrides) {
		            if (overrides.hasOwnProperty(prop) &amp;amp;&amp;amp; name[prop]) {
		                fns[prop] = name[prop];
		            }
		        }
		    }
		    for (prop in fns) {
		        if (fns.hasOwnProperty(prop)) {
		            overrides[prop] = fns[prop];
		            if (!name_clone) { name_clone = $.extend({}, name);}
		            delete name_clone[prop];
		        }
		    }
		    if (name_clone &amp;amp;&amp;amp; isEmptyObject(name_clone)) { return; }
		    if (min) { //if min was set
		        if (min === 0) {
		            min = new Date();
		        } else {
		            min = new Date(min);
		        }
		        tp_inst._defaults.minDate = min;
		        tp_inst._defaults.minDateTime = min;
		    } else if (max) { //if max was set
		        if (max === 0) {
		            max = new Date();
		        } else {
		            max = new Date(max);
		        }
		        tp_inst._defaults.maxDate = max;
		        tp_inst._defaults.maxDateTime = max;
		    } else if (onselect) {
		        tp_inst._defaults.onSelect = onselect;
		    }
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name);
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
	};
	
	/*
	* jQuery isEmptyObject does not check hasOwnProperty - if someone has added to the object prototype,
	* it will return false for all objects
	*/
	var isEmptyObject = function(obj) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(obj)) {
				return false;
			}
		}
		return true;
	};

	/*
	* jQuery extend now ignores nulls!
	*/
	var extendRemove = function(target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] === null || props[name] === undefined) {
				target[name] = props[name];
			}
		}
		return target;
	};

	/*
	* Determine by the time format which units are supported
	* Returns an object of booleans for each unit
	*/
	var detectSupport = function(timeFormat){
		var tf = timeFormat.replace(/\'.*?\'/g,'').toLowerCase(), // removes literals
			isIn = function(f, t){ // does the format contain the token?
					return f.indexOf(t) !== -1? true:false; 
				};
		return {
				hour: isIn(tf,'h'),
				minute: isIn(tf,'m'),
				second: isIn(tf,'s'),
				millisec: isIn(tf,'l'),
				microsec: isIn(tf,'c'),
				timezone: isIn(tf,'z'),
				ampm: isIn(tf,'t') &amp;amp;&amp;amp; isIn(timeFormat,'h'),
				iso8601: isIn(timeFormat, 'Z')
			};
	};

	/*
	* Converts 24 hour format into 12 hour
	* Returns 12 hour without leading 0
	*/
	var convert24to12 = function(hour) {
		if (hour &amp;gt; 12) {
			hour = hour - 12;
		}

		if (hour === 0) {
			hour = 12;
		}

		return String(hour);
	};

	/*
	* Splits datetime string into date ans time substrings.
	* Throws exception when date can't be parsed
	* Returns [dateString, timeString]
	*/
	var splitDateTime = function(dateFormat, dateTimeString, dateSettings, timeSettings) {
		try {
			// The idea is to get the number separator occurances in datetime and the time format requested (since time has 
			// fewer unknowns, mostly numbers and am/pm). We will use the time pattern to split.
			var separator = timeSettings &amp;amp;&amp;amp; timeSettings.separator ? timeSettings.separator : $.timepicker._defaults.separator,
				format = timeSettings &amp;amp;&amp;amp; timeSettings.timeFormat ? timeSettings.timeFormat : $.timepicker._defaults.timeFormat,
				timeParts = format.split(separator), // how many occurances of separator may be in our format?
				timePartsLen = timeParts.length,
				allParts = dateTimeString.split(separator),
				allPartsLen = allParts.length;

			if (allPartsLen &amp;gt; 1) {
				return [
						allParts.splice(0,allPartsLen-timePartsLen).join(separator),
						allParts.splice(0,timePartsLen).join(separator)
					];
			}

		} catch (err) {
			$.timepicker.log('Could not split the date from the time. Please check the following datetimepicker options' +
					"\nthrown error: " + err +
					"\ndateTimeString" + dateTimeString +
					"\ndateFormat = " + dateFormat +
					"\nseparator = " + timeSettings.separator +
					"\ntimeFormat = " + timeSettings.timeFormat);

			if (err.indexOf(":") &amp;gt;= 0) {
				// Hack!  The error message ends with a colon, a space, and
				// the "extra" characters.  We rely on that instead of
				// attempting to perfectly reproduce the parsing algorithm.
				var dateStringLength = dateTimeString.length - (err.length - err.indexOf(':') - 2),
					timeString = dateTimeString.substring(dateStringLength);

				return [$.trim(dateTimeString.substring(0, dateStringLength)), $.trim(dateTimeString.substring(dateStringLength))];

			} else {
				throw err;
			}
		}
		return [dateTimeString, ''];
	};

	/*
	* Internal function to parse datetime interval
	* Returns: {date: Date, timeObj: Object}, where
	*   date - parsed date without time (type Date)
	*   timeObj = {hour: , minute: , second: , millisec: , microsec: } - parsed time. Optional
	*/
	var parseDateTimeInternal = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var date;
		var splitRes = splitDateTime(dateFormat, dateTimeString, dateSettings, timeSettings);
		date = $.datepicker._base_parseDate(dateFormat, splitRes[0], dateSettings);
		if (splitRes[1] !== '') {
			var timeString = splitRes[1],
				parsedTime = $.datepicker.parseTime(timeFormat, timeString, timeSettings);

			if (parsedTime === null) {
				throw 'Wrong time format';
			}
			return {
				date: date,
				timeObj: parsedTime
			};
		} else {
			return {
				date: date
			};
		}
	};

	/*
	* Internal function to set timezone_select to the local timezone
	*/
	var selectLocalTimezone = function(tp_inst, date) {
		if (tp_inst &amp;amp;&amp;amp; tp_inst.timezone_select) {
			var now = typeof date !== 'undefined' ? date : new Date();
			tp_inst.timezone_select.val(now.getTimezoneOffset()*-1);
		}
	};

	/*
	* Create a Singleton Insance
	*/
	$.timepicker = new Timepicker();

	/**
	 * Get the timezone offset as string from a date object (eg '+0530' for UTC+5.5)
	 * @@param  number if not a number this value is returned
	 * @@param boolean if true formats in accordance to iso8601 "+12:45"
	 * @@return string
	 */
	$.timepicker.timezoneOffsetString = function(tzMinutes, iso8601) {
		if(isNaN(tzMinutes) || tzMinutes &amp;gt; 840){
			return tzMinutes;
		}

		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601? ':':'',
			tz = (off &amp;gt;= 0 ? '+' : '-') + ('0' + (hours * 101).toString()).slice(-2) + iso + ('0' + (minutes * 101).toString()).slice(-2);
		
		if(tz == '+00:00'){
			return 'Z';
		}
		return tz;
	};

	/**
	 * Get the number in minutes that represents a timezone string
	 * @@param  string formated like "+0500", "-1245"
	 * @@return number
	 */
	$.timepicker.timezoneOffsetNumber = function(tzString) {
		tzString = tzString.toString().replace(':',''); // excuse any iso8601, end up with "+1245"

		if(tzString.toUpperCase() === 'Z'){ // if iso8601 with Z, its 0 minute offset
			return 0;
		}

		if(!/^(\-|\+)\d{4}$/.test(tzString)){ // possibly a user defined tz, so just give it back
			return tzString;
		}

		return ((tzString.substr(0,1) =='-'? -1 : 1) * // plus or minus
					((parseInt(tzString.substr(1,2),10)*60) + // hours (converted to minutes)
					parseInt(tzString.substr(3,2),10))); // minutes
	};

	/**
	 * No way to set timezone in js Date, so we must adjust the minutes to compensate. (think setDate, getDate)
	 * @@param  date
	 * @@param  string formated like "+0500", "-1245"
	 * @@return date
	 */
	$.timepicker.timezoneAdjust = function(date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if(!isNaN(toTz)){
			date.setMinutes(date.getMinutes()*1 + (date.getTimezoneOffset()*-1 - toTz*1) );
		}
		return date;
	};

	/**
	 * Calls `timepicker()` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * n.b. The input value must be correctly formatted (reformatting is not supported)
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the timepicker() call
	 * @@return jQuery
	 */
	$.timepicker.timeRange = function(startTime, endTime, options) {
		return $.timepicker.handleRange('timepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datetimepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@return jQuery
	 */
	$.timepicker.datetimeRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datetimepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.dateRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.handleRange = function(method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0, // min allowed interval in milliseconds
			maxInterval: 0, // max allowed interval in milliseconds
			start: {},      // options for start picker
			end: {}         // options for end picker
		}, options);

		$.fn[method].call(startTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), endTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), endTime, 'minDate');
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), startTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), startTime, 'maxDate');
			}
		}, options, options.end));

		checkDates(startTime, endTime);
		selected(startTime, endTime, 'minDate');
		selected(endTime, startTime, 'maxDate');

		function checkDates(changed, other) {
			var startdt = startTime[method]('getDate'),
				enddt = endTime[method]('getDate'),
				changeddt = changed[method]('getDate');

			if(startdt !== null){
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());

				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);

				if(options.minInterval &amp;gt; 0 &amp;amp;&amp;amp; minDate &amp;gt; enddt){ // minInterval check
					endTime[method]('setDate',minDate);
				}
				else if(options.maxInterval &amp;gt; 0 &amp;amp;&amp;amp; maxDate &amp;lt; enddt){ // max interval check
					endTime[method]('setDate',maxDate);
				}
				else if (startdt &amp;gt; enddt) {
					other[method]('setDate',changeddt);
				}
			}
		}

		function selected(changed, other, option) {
			if (!changed.val()) {
				return;
			}
			var date = changed[method].call(changed, 'getDate');
			if(date !== null &amp;amp;&amp;amp; options.minInterval &amp;gt; 0){
				if(option == 'minDate'){
					date.setMilliseconds(date.getMilliseconds() + options.minInterval); 
				}
				if(option == 'maxDate'){
					date.setMilliseconds(date.getMilliseconds() - options.minInterval);
				}
			}
			if (date.getTime) {
				other[method].call(other, 'option', option, date);
			}
		}
		return $([startTime.get(0), endTime.get(0)]);
	};

	/**
	 * Log error or data to the console during error or debugging
	 * @@param  Object err pass any type object to log to the console during error or debugging
	 * @@return void
	 */
	$.timepicker.log = function(err){
		if(window.console){
			console.log(err);
		}
	};

	/*
	* Microsecond support
	*/
	if(!Date.prototype.getMicroseconds){
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function(){ return this.microseconds; };
		Date.prototype.setMicroseconds = function(m){ 
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m/1000));
			this.microseconds = m%1000;
			return this;
		};
	}

	/*
	* Keep up with the version
	*/
	$.timepicker.version = "1.3.1";

})(jQuery);
jQuery.noConflict();
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;datetimepicker-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;e73a652e-09fc-4c71-8e7a-e2525a2d2a99&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
function replaceAllString(oriStr, strTarget, strSubString ){
   var strText = oriStr;
   var intIndexOfMatch = strText.indexOf( strTarget );
   while (intIndexOfMatch != -1){
      strText = strText.replace( strTarget, strSubString )
      intIndexOfMatch = strText.indexOf( strTarget );
   }
   return( strText );
}
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&amp;amp;]" + name + "=([^&amp;amp;#]*)"),
    results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
};


   var jobName= getParameterByName('job')
   var fromDate= getParameterByName('fromDate')
   var toDate= getParameterByName('toDate')
   var limit= getParameterByName('limit')
   var selectedIstIid = getParameterByName('IstIid')

  $("#jobname").ready(function(){
   $("#jobname").text(jobName)
   var convertedJobName = replaceAllString(jobName, ".", "_")
   $("#IstIid" + convertedJobName).ready(function(){
     $("#IstIid" + convertedJobName).css("display","block")
     $("#select_" + convertedJobName).ready(function(){
        $("#select_" + convertedJobName).val(selectedIstIid)
     });
   });
 });

  $("#fromDate").ready(function(){
   $("#from-date").val(fromDate)
 });

  $("#toDate").ready(function(){
   $("#to-date").val(toDate)
 });

  $("#limit").ready(function(){
   if(limit!=""){
    $("#limit").val(limit)
   }
 });
 // Get data with ajax
 function ajax_getData(jobName,fromDate,toDate,limit ){
       var convertedJobName = replaceAllString(jobName, ".", "_")
       var istIid = $("#select_" + convertedJobName).val()
       window.location="/xwiki/bin/view/WiperDog/WebHome?job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid="+istIid;
 			/*$.ajax({
			 type: "GET",
			 url:"/xwiki/bin/get/Sandbox/DescriptionForJob?outputSyntax=plain&amp;amp;job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid"+selectedIstIid,
			 success : function(result){
				$("#jobname").html(jobName)
				$("#display").text('[[]]' + result)
			 }
		   });*/
 }
	$("#treemenu2 a").click(function(){
		 var limit = 10
		 var fromDate=""
		 var toDate = ""
		 jobName= $(this).text()
                 $("#jobname").html(jobName)
                 var convertedJobName = replaceAllString(jobName, ".", "_")
                 $("#listIstIid &amp;gt; div").css("display","none")
                 $("#IstIid" + convertedJobName).css("display","block")
		 //ajax_getData(jobName,fromDate,toDate,limit )

	});

	$("#from-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
		dateFormat: 'yy-mm-dd',
	});
	$("#to-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
			dateFormat: 'yy-mm-dd',

	});
	 $("#get-data").on("click",function(){
		var fromDate = $("#from-date").val()
		var toDate =  $("#to-date").val()
		 if( toDate!= "" ){
			  if(fromDate != ""){
				  if($("#from-date").datepicker( "getDate" ) &amp;gt; $("#to-date").datepicker( "getDate" )){
				  alert("'From date' cannot start later than 'To date'")
				  return false
				  }
			  }
		 }
		 limit = $("#limit").val()
		 ajax_getData(jobName,fromDate,toDate,limit )
	});
$(document).ready(function(){

  var dataModelUrl = '/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job='+jobName+'&amp;amp;limit='
       +limit+'&amp;amp;fromDate='+fromDate + '&amp;amp;toDate='+toDate+'&amp;amp;pager=pager2&amp;amp;genp=1&amp;amp;istIid='+selectedIstIid 
       var jqxhr = $.getJSON(dataModelUrl, function(data) {
       $("#livetableList").jqGrid(data);
       $("#livetableList").jqGrid('navGrid', "#livetablePager", {
           edit : false,
           add : false,
           del : false
         });
       })
});
        
jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;process&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;881686cc-1bfc-456e-b8ab-71334c4a45e5&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){

$(function () {
    function drawLineChart(xAxis, series, container, data_detail){
        var dataXAxis = xAxis
        var dataSeries = series
        var detail = data_detail

			$('#containerline' + container).highcharts({

				chart: {
					type:'line'
				},
				title: {
					text: container
				},
				tooltip :{
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				xAxis: dataXAxis ,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				series: dataSeries
			});
		};

		function drawBarChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerbar' + container).highcharts({
				chart: {
					type: 'column'
				},
				title: {
					text: container
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {

					column: {
						pointPadding: 0.2,
						borderWidth: 0
					}
				},
				series: dataSeries
			});
		}

		function drawAreaChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail
			$('#containerarea' + container).highcharts({
				chart: {
					type: 'area'
				},
				title: {
					text: container
				},
				subtitle: {
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					},
					labels: {
						formatter: function() {
							return this.value / 1000;
						}
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {
					area: {
						stacking: 'normal',
						lineColor: '#666666',
						lineWidth: 1,
						marker: {
							lineWidth: 1,
							lineColor: '#666666'
						}
					}
				},
				series: dataSeries
			});
		};

		function drawPieChart(data, container){
			var dataPie = data
			$(document).ready(function () {
				// Build the chart
				$('#container' + container).highcharts({
					chart: {
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: dataPie[0].name
					},
					tooltip: {
						pointFormat: '{series.name}: &amp;lt;b&amp;gt;{point.percentage:.1f}%&amp;lt;/b&amp;gt;'
					},
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							dataLabels: {
								enabled: false
							},
							showInLegend: true
						}
					},
					series: dataPie
				});
			});
		}

		// LINE
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonline_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonline");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Line chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						if(data_all[0][i].series[0].name == null){
							data_all[0][i].series[0].name = lstContainer[0][i]
						}
						drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
					}
				}
			}
		});

		// BAR
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonbar_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonbar");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Bar chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						drawBarChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
					}
				}
			}
		});

		// AREA
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonarea_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonarea");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				// data to display on tooltip
				var data_detail = data_all[0]
				// draw Area Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					drawAreaChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
				}
			}
		});

		// PIE
		$("#piechart").ready(function(){

			var array = $("#jsons&amp;gt;.jsonpie");
			var arrayContainer = $("#jsons&amp;gt;.lstcontainerpie");
			var lstContainer = [];
			var data_all = [];
			for(var i=0;i&amp;lt;array.length;i++){
				data_all[i] = jQuery.parseJSON(array[i].value)
				lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)

			}
			if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
				// data to display on tooltip
				// draw Pie Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					var finalData = []
					finalData[0] = data_all[0][i]
					drawPieChart(finalData, lstContainer[0][i])
				}
			}
		});
	});
	jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;d5873d92-b78b-42fc-9407-46d166204b88&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;/* css for timepicker */
.ui-timepicker-div .ui-widget-header { 
margin-bottom: 8px;
 }

.ui-timepicker-div dl { text-align: left; }
.ui-timepicker-div dl dt { height: 25px; margin-bottom: -25px; }
.ui-timepicker-div dl dd { margin: 0 10px 10px 65px; }
.ui-timepicker-div td { font-size: 90%; }
.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }

.ui-timepicker-rtl{ direction: rtl; }
.ui-timepicker-rtl dl { text-align: right; }
.ui-timepicker-rtl dl dd { margin: 0 65px 10px 10px; }
#ui-datepicker-div{
 position:relative;
 width:auto;
 height:auto
}
&lt;/code&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;datetimepicker -css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;1201fb1a-e9c1-4731-8c74-2ea8c0071959&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;.displayblock {
  border:2px solid;
  -webkit-border-radius:6px;
  background:gray;
  float: left;
  width:100%;
}

.displaypie {
  border:1px solid;
  -webkit-border-radius:6px;
  background:gray;
  width: 48%;
  float: left; 
  height: 300px;
}

.subtype {
  margin-top: 50px;
  font-size: 2em;
  color: red;
}&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;content&gt;{{include document="Lib.DataToDrawChart"/}}
{{include document="Lib.MongoDBConnection"/}}
{{velocity}}
$xwiki.jsx.use('Lib.JQueryUILib')
$xwiki.ssx.use('Lib.MenuGenerator')
$xwiki.jsx.use('Lib.MenuGenerator')
$xwiki.ssx.use('Lib.JQueryUILib')
$xwiki.jsx.use('Lib.JqGridLib')
$xwiki.ssx.use('Lib.JqGridLib') 
{{/velocity}}
{{include document="Lib.MenuGenerator"/}}
{{html wiki="true" clean="false"}}
&amp;lt;div id="viewer"&amp;gt;
&amp;lt;table style="text-align:left"  &amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th &amp;gt;Job name&amp;lt;/th&amp;gt;
  &amp;lt;td colspan=3&amp;gt;&amp;lt;div id="jobname"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
{{groovy}}
import org.xwiki.context.*

def ec = services.component.getInstance(Execution.class).getContext()
def mapJobIstIid = ec.getProperty("mapJobIstIid")

println '{{html clean="false" wiki="false"}}'
println '&amp;lt;tr&amp;gt;'
println '&amp;lt;th&amp;gt;IstIid&amp;lt;/th&amp;gt;'
println '&amp;lt;td colspan=3&amp;gt;'
mapJobIstIid.each{jobEntry-&amp;gt;
  def convertedJobKey = jobEntry.key.replaceAll("\\.","_")
  println "&amp;lt;div id='listIstIid'&amp;gt;"
  println "&amp;lt;div id=IstIid${convertedJobKey} style='display:none'&amp;gt;"
  println "&amp;lt;select id=select_${convertedJobKey}&amp;gt;"
  jobEntry.value.each{
     println "&amp;lt;option value=\"$it\"&amp;gt;$it&amp;lt;/option&amp;gt;"
  }
  println "&amp;lt;/select&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
}
println '&amp;lt;/td&amp;gt;'
println '&amp;lt;/tr&amp;gt;'
println '{{/html}}'
{{/groovy}}
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data monitor from&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="from-date" id="from-date"/&amp;gt;&amp;lt;/td&amp;gt;
  &amp;lt;th&amp;gt;Data monitor to&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="to-date" id="to-date"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data records limit &amp;lt;/th&amp;gt;
  &amp;lt;td &amp;gt;
     &amp;lt;select id="limit"&amp;gt;
       &amp;lt;option value=5&amp;gt;5&amp;lt;/option&amp;gt;
       &amp;lt;option value=10&amp;gt;10&amp;lt;/option&amp;gt;
       &amp;lt;option value=15&amp;gt;15&amp;lt;/option&amp;gt;
       &amp;lt;option value=20&amp;gt;20&amp;lt;/option&amp;gt;
     &amp;lt;/select&amp;gt;
  &amp;lt;/td&amp;gt;
  &amp;lt;td colspan=3 &amp;gt;&amp;lt;input type="button" value="View Data" id="get-data" class="button"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;&amp;lt;div id="display"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
  &amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
&amp;lt;/table&amp;gt;

&amp;lt;/div&amp;gt; 
   
 &amp;lt;/body&amp;gt;

{{/html}}
{{groovy}}
import groovy.json.*
xwiki.jsx.use("Lib.Highcharts")

if(request.xpage == "plain") {
	response.setContentType('text/plain')
}

def listData = []
def job = request.get("job")
def fromDate = request.get("fromDate")
def toDate = request.get("toDate")
def limit= (request.get("limit")!=null)?request.get("limit").toInteger():10
def istIid = request.get("IstIid")

def str= "No data to retrieved !"
def result = null
if(job != "" &amp;amp;&amp;amp; job != null &amp;amp;&amp;amp; istIid != null &amp;amp;&amp;amp; istIid != ""){
	MongoDBConnection.getConnection()
	if(fromDate != "" || toDate != ""){
		result = MongoDBConnection.getDataInPeriod(job,fromDate,toDate,limit,istIid)
	} else {
		result = MongoDBConnection.getDataAllFields(job,limit,istIid)
        }
MongoDBConnection.closeConnection()
} else {
   println "{{warning}}There are no selected job or IstIid{{/warning}}"
}

if( (result != null) &amp;amp;&amp;amp; (result.size() &amp;gt; 0) &amp;amp;&amp;amp; (result[0].KEYEXPR != null)&amp;amp;&amp;amp;!(result[0].KEYEXPR instanceof List )){

if(result[0].type == "Subtyped") {
    println '{{html clean="false" wiki="true"}}'
    //println '&amp;lt;body&amp;gt;'
    def dataSubtype = DataToDrawChart.getDataToDrawSubtype(result)
    def listKey = []
    dataSubtype.each {key,value -&amp;gt;
        listKey.add(key)
    }
    def jsonkey = com.mongodb.util.JSON.serialize(listKey)
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$jsonkey&amp;lt;/textarea&amp;gt;"

    dataSubtype.each {key,value -&amp;gt;
        def dataLine = []
        def dataBar = []
        def dataPie = []
        def dataArea = []
        if(DataToDrawChart.getDataToDrawLine(value) != []) {
            dataLine = DataToDrawChart.getDataToDrawLine(value)
        }
        if(DataToDrawChart.getDataToDrawBar(value) != []) {
            dataBar = DataToDrawChart.getDataToDrawBar(value)
        }
        if(DataToDrawChart.getDataToDrawPie(value) != []) {
            dataPie = DataToDrawChart.getDataToDrawPie(value)
        }
        if(DataToDrawChart.getDataToDrawArea(value) != []) {
            dataArea = DataToDrawChart.getDataToDrawArea(value)
        }

        def chartColumnsLine
        def chartColumnsBar 
        def chartColumnsArea 
        def lstName
        if(dataLine.size() &amp;gt; 0 ){
            chartColumnsLine = dataLine[0].chart_columns
        }
        if(dataBar.size() &amp;gt; 0){
            chartColumnsBar = dataBar[0].chart_columns
        }
        if(dataArea.size() &amp;gt; 0 ){
            chartColumnsArea = dataArea[0].chart_columns
        }
        if(dataPie.size() &amp;gt; 0 ){
            lstName = dataPie['name']
        }

        def tmpListNameContainer = []
	for(def nameContainer in lstName){
	   nameContainer = nameContainer.replaceAll("\\.", "_")
	   tmpListNameContainer.add(nameContainer)
	}
        def jsonPie
        def jsonLine
	def jsonBar
        def jsonArea
        if(dataPie != []) {
	    jsonPie = com.mongodb.util.JSON.serialize(dataPie)
        }
        if(dataLine != []) {
	    jsonLine = com.mongodb.util.JSON.serialize(dataLine)
        }
        if(dataBar != []) {
            jsonBar = com.mongodb.util.JSON.serialize(dataBar)
        }
        if(dataArea != []) {
	    jsonArea = com.mongodb.util.JSON.serialize(dataArea)
        }

	def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
	def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
	def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
	def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

	println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
        if(jsonLine != null) {
	    println "&amp;lt;textarea id=\"jsonline_$key\" &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;" 
        }
	if(jsonBar != null) {
            println "&amp;lt;textarea id=\"jsonbar_$key\"&amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
 	    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
        }
        if(jsonPie != null) {
	    println "&amp;lt;textarea id=\"jsonpie_$key\" &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
        }
        if(jsonArea != null) {
	    println "&amp;lt;textarea id=\"jsonarea_$key\" &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"
	    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
        }

	println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
	println "&amp;lt;input style=\"display:none\" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;"
	println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
	println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'
	println "&amp;lt;/div&amp;gt;"
	  
	def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
	def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
	  
	println "&amp;lt;div style='clear:both'&amp;gt;"
        def description = value.KEYEXPR._description[0][key]
        if(description != null) {
            println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +': ' + description +'&amp;lt;/div&amp;gt;'
        } else {
            println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +'&amp;lt;/div&amp;gt;'
        }
        println "-----"
        if(jsonPie != null) {
	  println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
	  lstName.each{
	    def tmp = it.replaceAll("\\.", "_")
	    println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
        if(jsonLine != null) {
	  def chartLineComment = false
	  chartColumnsLine.each{
	    if(!chartLineComment){
	       println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	       chartLineComment = true  
	    }

	      println " &amp;lt;div class=\"displayblock\" id=\"containerline${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
        println "&amp;amp;nbsp;"

        if(jsonBar != null) {
	  def chartBarComment = false
	  chartColumnsBar.each{
	     if(!chartBarComment){
	        println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	        chartBarComment = true
	      }  

	     println " &amp;lt;div class=\"displayblock\" id=\"containerbar${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
	println "&amp;amp;nbsp;"

        if(jsonArea != null) {
	  def chartAreaComment = false
	  chartColumnsArea.each{
	  if(!chartAreaComment){
	    println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	    chartAreaComment = true
	  }
	    println " &amp;lt;div class=\"displayblock\" id=\"containerarea${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
	println "&amp;lt;/div&amp;gt;"
        
    }
    println '&amp;lt;/body&amp;gt;'
    println '{{/html}}'
} else if(result[0].type == "Store") {
    // data store
    def dataLine = DataToDrawChart.getDataToDrawLine(result)
    def dataBar = DataToDrawChart.getDataToDrawBar(result)
    def dataPie = DataToDrawChart.getDataToDrawPie(result)
    def dataArea = DataToDrawChart.getDataToDrawArea(result)
    def chartColumnsLine 
    def chartColumnsBar 
    def chartColumnsArea 
    def lstName 

    if(dataLine.size() &amp;gt; 0 ){
        chartColumnsLine = dataLine[0].chart_columns
    }
    if(dataBar.size() &amp;gt; 0){
        chartColumnsBar = dataBar[0].chart_columns
    }
    if(dataArea.size() &amp;gt; 0 ){
        chartColumnsArea = dataArea[0].chart_columns
    }
    if(dataPie.size() &amp;gt; 0 ){
        lstName = dataPie['name']
    }

    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
  
    def tmpListNameContainer = []
    for(def nameContainer in lstName){
       nameContainer = nameContainer.replaceAll("\\.", "_")
       tmpListNameContainer.add(nameContainer)
    }
  
    def jsonPie = com.mongodb.util.JSON.serialize(dataPie)
    def jsonLine = com.mongodb.util.JSON.serialize(dataLine)
    def jsonBar = com.mongodb.util.JSON.serialize(dataBar)
    def jsonArea = com.mongodb.util.JSON.serialize(dataArea)

    def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
    def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
    def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
    def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

    def listEmpty = com.mongodb.util.JSON.serialize([])
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$listEmpty&amp;lt;/textarea&amp;gt;" 

    println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'

    println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
    println "&amp;lt;textarea class='jsonline' &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonbar' &amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonpie' &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonarea' &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"

    println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
  
    def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
    def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
  
    println "&amp;lt;div style='clear:both'&amp;gt;"
  
    def chartPieComment = false
    lstName.each{
        if(!chartPieComment) {
            println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
            chartPieComment = true
        }
        def tmp = it.replaceAll("\\.", "_")
        println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    def chartLineComment = false
    chartColumnsLine.each{
    if(!chartLineComment){
        println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
        chartLineComment = true  
    }

    println " &amp;lt;div class=\"displayblock\" id=\"containerline$it\"&amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    println "&amp;amp;nbsp;"
    def chartBarComment = false
    chartColumnsBar.each{
        if(!chartBarComment){
            println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
            chartBarComment = true
        }  

    println " &amp;lt;div class=\"displayblock\" id=\"containerbar$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
  println "&amp;lt;/div&amp;gt;"
  println "&amp;amp;nbsp;"
  def chartAreaComment = false
  chartColumnsArea.each{
  if(!chartAreaComment){
    println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
    chartAreaComment = true
  }
    println " &amp;lt;div class=\"displayblock\" id=\"containerarea$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
  println "&amp;lt;/div&amp;gt;"
println "&amp;lt;/div&amp;gt;"

println '&amp;lt;/body&amp;gt;'
println '{{/html}}'
}
}else{
    println 'There is no data for this job with criterias'
}

{{/groovy}}
{{html wiki="true" clean="false"}}
&amp;lt;div id="livetblContent" style="clear:both;align:middle"&amp;gt;
    &amp;lt;table id="livetableList"&amp;gt;&amp;lt;/table&amp;gt;
    &amp;lt;div id="livetablePager"&amp;gt;&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
{{/html}}
&lt;/content&gt;&lt;/xwikidoc&gt;@


53.2
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376393584000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;53.2&lt;/version&gt;
d21 1
a21 1
&lt;minorEdit&gt;true&lt;/minorEdit&gt;
@


53.1
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376392911000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376392812000&lt;/contentUpdateDate&gt;
&lt;version&gt;53.1&lt;/version&gt;
d21 1
a21 1
&lt;minorEdit&gt;false&lt;/minorEdit&gt;
d3504 4
a3507 2
&amp;lt;table id="livetableList"&amp;gt;&amp;lt;/table&amp;gt;
&amp;lt;div id="livetablePager"&amp;gt;&amp;lt;/div&amp;gt;
@


52.1
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376392812000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;52.1&lt;/version&gt;
a2428 1
       alert('Data: ' + data)
@


51.1
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376392669000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376392566000&lt;/contentUpdateDate&gt;
&lt;version&gt;51.1&lt;/version&gt;
d3184 1
a3184 4
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;
    &amp;lt;table id="livetableList"&amp;gt;&amp;lt;tr&amp;gt;&amp;lt;td&amp;gt;livetableList&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;
    &amp;lt;div id="livetablePager"&amp;gt;livetablePager&amp;lt;/div&amp;gt;
&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
d3186 1
d3190 1
d3224 1
d3227 1
a3227 1
    println '&amp;lt;body&amp;gt;'
d3502 1
d3505 2
a3506 2
    &amp;lt;table id="livetableList"&amp;gt;&amp;lt;/table&amp;gt;
    &amp;lt;div id="livetablePager"&amp;gt;&amp;lt;/div&amp;gt;
@


50.3
log
@@
text
@&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xwikidoc&gt;
&lt;web&gt;WiperDog&lt;/web&gt;
&lt;name&gt;WebHome&lt;/name&gt;
&lt;language&gt;&lt;/language&gt;
&lt;defaultLanguage&gt;en&lt;/defaultLanguage&gt;
&lt;translation&gt;0&lt;/translation&gt;
&lt;parent&gt;&lt;/parent&gt;
&lt;creator&gt;XWiki.Admin&lt;/creator&gt;
&lt;author&gt;XWiki.Admin&lt;/author&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;contentAuthor&gt;XWiki.Admin&lt;/contentAuthor&gt;
&lt;creationDate&gt;1376364375000&lt;/creationDate&gt;
&lt;date&gt;1376392598000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376392566000&lt;/contentUpdateDate&gt;
&lt;version&gt;50.3&lt;/version&gt;
&lt;title&gt;WiperDog&lt;/title&gt;
&lt;defaultTemplate&gt;&lt;/defaultTemplate&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;comment&gt;&lt;/comment&gt;
&lt;minorEdit&gt;true&lt;/minorEdit&gt;
&lt;syntaxId&gt;xwiki/2.1&lt;/syntaxId&gt;
&lt;hidden&gt;false&lt;/hidden&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;047293a8-524d-45e4-af52-cd944523d5d0&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
/*
 * jQuery timepicker addon
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 1.3.1
 * Last Modified: 07/07/2013
 *
 * Copyright 2013 Trent Richardson
 * You may use this project under MIT or GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 */

/*jslint evil: true, white: false, undef: false, nomen: false */

(function($) {

	/*
	* Lets not redefine timepicker, Prevent "Uncaught RangeError: Maximum call stack size exceeded"
	*/
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return;
	}

	/*
	* Extend jQueryUI, get it started with our version number
	*/
	$.extend($.ui, {
		timepicker: {
			version: "1.3.1"
		}
	});

	/* 
	* Timepicker manager.
	* Use the singleton instance of this class, $.timepicker, to interact with the time picker.
	* Settings for (groups of) time pickers are maintained in an instance object,
	* allowing multiple different settings on the same page.
	*/
	var Timepicker = function() {
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[''] = { // Default regional settings
			currentText: 'Now',
			closeText: 'Done',
			amNames: ['AM', 'A'],
			pmNames: ['PM', 'P'],
			timeFormat: 'HH:mm',
			timeSuffix: '',
			timeOnlyTitle: 'Choose Time',
			timeText: 'Time',
			hourText: 'Hour',
			minuteText: 'Minute',
			secondText: 'Second',
			millisecText: 'Millisecond',
			microsecText: 'Microsecond',
			timezoneText: 'Time Zone',
			isRTL: false
		};
		this._defaults = { // Global defaults for all the datetime picker instances
			showButtonPanel: true,
			timeOnly: false,
			showHour: null,
			showMinute: null,
			showSecond: null,
			showMillisec: null,
			showMicrosec: null,
			showTimezone: null,
			showTime: true,
			stepHour: 1,
			stepMinute: 1,
			stepSecond: 1,
			stepMillisec: 1,
			stepMicrosec: 1,
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null,
			hourMin: 0,
			minuteMin: 0,
			secondMin: 0,
			millisecMin: 0,
			microsecMin: 0,
			hourMax: 23,
			minuteMax: 59,
			secondMax: 59,
			millisecMax: 999,
			microsecMax: 999,
			minDateTime: null,
			maxDateTime: null,
			onSelect: null,
			hourGrid: 0,
			minuteGrid: 0,
			secondGrid: 0,
			millisecGrid: 0,
			microsecGrid: 0,
			alwaysSetTime: true,
			separator: ' ',
			altFieldTimeOnly: true,
			altTimeFormat: null,
			altSeparator: null,
			altTimeSuffix: null,
			pickerTimeFormat: null,
			pickerTimeSuffix: null,
			showTimepicker: true,
			timezoneList: null,
			addSliderAccess: false,
			sliderAccessArgs: null,
			controlType: 'slider',
			defaultValue: null,
			parse: 'strict'
		};
		$.extend(this._defaults, this.regional['']);
	};

	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: '',
		formattedDate: '',
		formattedTime: '',
		formattedDateTime: '',
		timezoneList: null,
		units: ['hour','minute','second','millisec', 'microsec'],
		support: {},
		control: null,

		/* 
		* Override the default settings for all instances of the time picker.
		* @@param  settings  object - the new settings to use as defaults (anonymous object)
		* @@return the manager object
		*/
		setDefaults: function(settings) {
			extendRemove(this._defaults, settings || {});
			return this;
		},

		/*
		* Create a new Timepicker instance
		*/
		_newInst: function($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
            	fns = {},
		    	overrides, i;

			for (var attrName in this._defaults) {
				if(this._defaults.hasOwnProperty(attrName)){
					var attrValue = $input.attr('time:' + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue);
						} catch (err) {
							inlineSettings[attrName] = attrValue;
						}
					}
				}
			}

		    overrides = {
		        beforeShow: function (input, dp_inst) {
		            if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
		                return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst);
		            }
		        },
		        onChangeMonthYear: function (year, month, dp_inst) {
		            // Update the time as well : this prevents the time from disappearing from the $input field.
		            tp_inst._updateDateTime(dp_inst);
		            if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
		                tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst);
		            }
		        },
		        onClose: function (dateText, dp_inst) {
		            if (tp_inst.timeDefined === true &amp;amp;&amp;amp; $input.val() !== '') {
		                tp_inst._updateDateTime(dp_inst);
		            }
		            if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
		                tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst);
		            }
		        }
		    };
		    for (i in overrides) {
		        if (overrides.hasOwnProperty(i)) {
		            fns[i] = opts[i] || null;
		        }
		    }

		    tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
		        evnts:fns,
		        timepicker: tp_inst // add timepicker as a property of datepicker: $.datepicker._get(dp_inst, 'timepicker');
		    });
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function(val) {
				return val.toUpperCase();
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function(val) {
				return val.toUpperCase();
			});

			// detect which units are supported
			tp_inst.support = detectSupport(
					tp_inst._defaults.timeFormat + 
					(tp_inst._defaults.pickerTimeFormat? tp_inst._defaults.pickerTimeFormat:'') + 
					(tp_inst._defaults.altTimeFormat? tp_inst._defaults.altTimeFormat:''));

			// controlType is string - key to our this._controls
			if(typeof(tp_inst._defaults.controlType) === 'string'){
				if(tp_inst._defaults.controlType == 'slider' &amp;amp;&amp;amp; typeof(jQuery.ui.slider) === 'undefined'){
					tp_inst._defaults.controlType = 'select';
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType];
			}
			// controlType is an object and must implement create, options, value methods
			else{ 
				tp_inst.control = tp_inst._defaults.controlType;
			}

			// prep the timezone options
			var timezoneList = [-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,
					0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList;
			}
			var tzl=timezoneList.length,tzi=0,tzv=null;
			if (tzl &amp;gt; 0 &amp;amp;&amp;amp; typeof timezoneList[0] !== 'object') {
				for(; tzi&amp;lt;tzl; tzi++){
					tzv = timezoneList[tzi];
					timezoneList[tzi] = { value: tzv, label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601) };
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;

			// set the default units
			tp_inst.timezone = tp_inst._defaults.timezone !== null? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) : 
							((new Date()).getTimezoneOffset()*-1);
			tp_inst.hour = tp_inst._defaults.hour &amp;lt; tp_inst._defaults.hourMin? tp_inst._defaults.hourMin : 
							tp_inst._defaults.hour &amp;gt; tp_inst._defaults.hourMax? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute &amp;lt; tp_inst._defaults.minuteMin? tp_inst._defaults.minuteMin : 
							tp_inst._defaults.minute &amp;gt; tp_inst._defaults.minuteMax? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second &amp;lt; tp_inst._defaults.secondMin? tp_inst._defaults.secondMin : 
							tp_inst._defaults.second &amp;gt; tp_inst._defaults.secondMax? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec &amp;lt; tp_inst._defaults.millisecMin? tp_inst._defaults.millisecMin : 
							tp_inst._defaults.millisec &amp;gt; tp_inst._defaults.millisecMax? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec &amp;lt; tp_inst._defaults.microsecMin? tp_inst._defaults.microsecMin : 
							tp_inst._defaults.microsec &amp;gt; tp_inst._defaults.microsecMax? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = '';
			tp_inst.$input = $input;

			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField).css({
					cursor: 'pointer'
				}).focus(function() {
					$input.trigger("focus");
				});
			}

			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date();
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date();
			}

			// datepicker needs minDate/maxDate, timepicker needs minDateTime/maxDateTime..
			if (tp_inst._defaults.minDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime());
			}
			if (tp_inst._defaults.minDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime());
			}
			if (tp_inst._defaults.maxDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime());
			}
			if (tp_inst._defaults.maxDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime());
			}
			tp_inst.$input.bind('focus', function() {
				tp_inst._onFocus();
			});

			return tp_inst;
		},

		/*
		* add our sliders to the calendar
		*/
		_addTimePicker: function(dp_inst) {
			var currDT = (this.$altInput &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly) ? this.$input.val() + ' ' + this.$altInput.val() : this.$input.val();

			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
		},

		/*
		* parse the time string from input value or _setTime
		*/
		_parseTime: function(timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0]);
			}

			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, 'dateFormat');
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false;
					}
					$.extend(this, parseRes.timeObj);
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err +
									"\ndate/time string = " + timeString +
									"\ntimeFormat = " + this._defaults.timeFormat +
									"\ndateFormat = " + dp_dateFormat);
					return false;
				}
				return true;
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false;
				}
				$.extend(this, timeObj);
				return true;
			}
		},

		/*
		* generate and inject html for timepicker into ui datepicker
		*/
		_injectTimePicker: function() {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = '',
				uitem = '',
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i=0,
				l=0;

			// Prevent displaying twice
			if ($dp.find("div.ui-timepicker-div").length === 0 &amp;amp;&amp;amp; o.showTimepicker) {
				var noDisplay = ' style="display:none;"',
					html = '&amp;lt;div class="ui-timepicker-div'+ (o.isRTL? ' ui-timepicker-rtl' : '') +'"&amp;gt;&amp;lt;dl&amp;gt;' + '&amp;lt;dt class="ui_tpicker_time_label"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;' + o.timeText + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_time"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the markup
				for(i=0,l=this.units.length; i&amp;lt;l; i++){
					litem = this.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// Added by Peter Medeiros:
					// - Figure out what the hour/minute/second max should be based on the step values.
					// - Example: if stepMinute is 15, then minMax is 45.
					max[litem] = parseInt((o[litem+'Max'] - ((o[litem+'Max'] - o[litem+'Min']) % o['step'+uitem])), 10);
					gridSize[litem] = 0;

					html += '&amp;lt;dt class="ui_tpicker_'+ litem +'_label"' + (show ? '' : noDisplay) + '&amp;gt;' + o[litem +'Text'] + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_'+ litem +'"&amp;gt;&amp;lt;div class="ui_tpicker_'+ litem +'_slider"' + (show ? '' : noDisplay) + '&amp;gt;&amp;lt;/div&amp;gt;';

					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						html += '&amp;lt;div style="padding-left: 1px"&amp;gt;&amp;lt;table class="ui-tpicker-grid-label"&amp;gt;&amp;lt;tr&amp;gt;';

						if(litem == 'hour'){
							for (var h = o[litem+'Min']; h &amp;lt;= max[litem]; h += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm? 'hht':'HH', {hour:h}, o);									
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + tmph + '&amp;lt;/td&amp;gt;';
							}
						}
						else{
							for (var m = o[litem+'Min']; m &amp;lt;= max[litem]; m += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + ((m &amp;lt; 10) ? '0' : '') + m + '&amp;lt;/td&amp;gt;';
							}
						}

						html += '&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;&amp;lt;/div&amp;gt;';
					}
					html += '&amp;lt;/dd&amp;gt;';
				}
				
				// Timezone
				var showTz = o.showTimezone !== null? o.showTimezone : this.support.timezone;
				html += '&amp;lt;dt class="ui_tpicker_timezone_label"' + (showTz ? '' : noDisplay) + '&amp;gt;' + o.timezoneText + '&amp;lt;/dt&amp;gt;';
				html += '&amp;lt;dd class="ui_tpicker_timezone" ' + (showTz ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the elements from string
				html += '&amp;lt;/dl&amp;gt;&amp;lt;/div&amp;gt;';
				var $tp = $(html);

				// if we only want time picker...
				if (o.timeOnly === true) {
					$tp.prepend('&amp;lt;div class="ui-widget-header ui-helper-clearfix ui-corner-all"&amp;gt;' + '&amp;lt;div class="ui-datepicker-title"&amp;gt;' + o.timeOnlyTitle + '&amp;lt;/div&amp;gt;' + '&amp;lt;/div&amp;gt;');
					$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();
				}
				
				// add sliders, adjust grids, add events
				for(i=0,l=tp_inst.units.length; i&amp;lt;l; i++){
					litem = tp_inst.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// add the slider
					tp_inst[litem+'_slider'] = tp_inst.control.create(tp_inst, $tp.find('.ui_tpicker_'+litem+'_slider'), litem, tp_inst[litem], o[litem+'Min'], max[litem], o['step'+uitem]);

					// adjust the grid and add click event
					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						size = 100 * gridSize[litem] * o[litem+'Grid'] / (max[litem] - o[litem+'Min']);
						$tp.find('.ui_tpicker_'+litem+' table').css({
							width: size + "%",
							marginLeft: o.isRTL? '0' : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL? ((size / (-2 * gridSize[litem])) + "%") : '0',
							borderCollapse: 'collapse'
						}).find("td").click(function(e){
								var $t = $(this),
									h = $t.html(),
									n = parseInt(h.replace(/[^0-9]/g),10),
									ap = h.replace(/[^apm]/ig),
									f = $t.data('for'); // loses scope, so we use data-for

								if(f == 'hour'){
									if(ap.indexOf('p') !== -1 &amp;amp;&amp;amp; n &amp;lt; 12){
										n += 12;
									}
									else{
										if(ap.indexOf('a') !== -1 &amp;amp;&amp;amp; n === 12){
											n = 0;
										}
									}
								}
								
								tp_inst.control.value(tp_inst, tp_inst[f+'_slider'], litem, n);

								tp_inst._onTimeChange();
								tp_inst._onSelectHandler();
							}).css({
								cursor: 'pointer',
								width: (100 / gridSize[litem]) + '%',
								textAlign: 'center',
								overflow: 'hidden'
							});
					} // end if grid &amp;gt; 0
				} // end for loop

				// Add timezone options
				this.timezone_select = $tp.find('.ui_tpicker_timezone').append('&amp;lt;select&amp;gt;&amp;lt;/select&amp;gt;').find("select");
				$.fn.append.apply(this.timezone_select,
				$.map(o.timezoneList, function(val, idx) {
					return $("&amp;lt;option /&amp;gt;").val(typeof val == "object" ? val.value : val).text(typeof val == "object" ? val.label : val);
				}));
				if (typeof(this.timezone) != "undefined" &amp;amp;&amp;amp; this.timezone !== null &amp;amp;&amp;amp; this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset()*-1;
					if (local_timezone == this.timezone) {
						selectLocalTimezone(tp_inst);
					} else {
						this.timezone_select.val(this.timezone);
					}
				} else {
					if (typeof(this.hour) != "undefined" &amp;amp;&amp;amp; this.hour !== null &amp;amp;&amp;amp; this.hour !== "") {
						this.timezone_select.val(o.timezone);
					} else {
						selectLocalTimezone(tp_inst);
					}
				}
				this.timezone_select.change(function() {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
				});
				// End timezone options
				
				// inject timepicker into datepicker
				var $buttonPanel = $dp.find('.ui-datepicker-buttonpane');
				if ($buttonPanel.length) {
					$buttonPanel.before($tp);
				} else {
					$dp.append($tp);
				}

				this.$timeObj = $tp.find('.ui_tpicker_time');

				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined;
				}

				// slideAccess integration: http://trentrichardson.com/2011/11/11/jquery-ui-sliders-and-touch-accessibility/
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
						
					setTimeout(function() { // fix for inline mode
						if ($tp.find('.ui-slider-access').length === 0) {
							$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);

							// fix any grids since sliders are shorter
							var sliderAccessWidth = $tp.find('.ui-slider-access:eq(0)').outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find('table:visible').each(function() {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl? 'marginRight':'marginLeft').toString().replace('%', ''),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + '%',
										css = { width: newWidth, marginRight: 0, marginLeft: 0 };
									css[rtl? 'marginRight':'marginLeft'] = newMarginLeft;
									$g.css(css);
								});
							}
						}
					}, 10);
				}
				// end slideAccess integration

				tp_inst._limitMinMaxDateTime(this.inst, true);
			}
		},

		/*
		* This function tries to limit the ability to go outside the
		* min/max date range
		*/
		_limitMinMaxDateTime: function(dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);

			if (!this._defaults.showTimepicker) {
				return;
			} // No time so nothing to check here

			if ($.datepicker._get(dp_inst, 'minDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'minDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, 'minDateTime'),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin;
				}

				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour &amp;lt;= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute &amp;lt;= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second &amp;lt;= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if(this.millisec &amp;lt;= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;lt; this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin;
									}
									this._defaults.microsecMin = this.microsecMinOriginal;
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal;
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal;
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal;
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal;
				}
			}

			if ($.datepicker._get(dp_inst, 'maxDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'maxDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, 'maxDateTime'),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax;
				}

				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour &amp;gt;= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute &amp;gt;= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second &amp;gt;= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec &amp;gt;= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;gt; this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax;
									}
									this._defaults.microsecMax = this.microsecMaxOriginal;
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal;
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal;
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal;
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal;
				}
			}

			if (adjustSliders !== undefined &amp;amp;&amp;amp; adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10);
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);

				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, 'hour', { min: this._defaults.hourMin, max: hourMax });
					this.control.value(this, this.hour_slider, 'hour', this.hour - (this.hour % this._defaults.stepHour));
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, 'minute', { min: this._defaults.minuteMin, max: minMax });
					this.control.value(this, this.minute_slider, 'minute', this.minute - (this.minute % this._defaults.stepMinute));
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, 'second', { min: this._defaults.secondMin, max: secMax });
					this.control.value(this, this.second_slider, 'second', this.second - (this.second % this._defaults.stepSecond));
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, 'millisec', { min: this._defaults.millisecMin, max: millisecMax });
					this.control.value(this, this.millisec_slider, 'millisec', this.millisec - (this.millisec % this._defaults.stepMillisec));
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, 'microsec', { min: this._defaults.microsecMin, max: microsecMax });
					this.control.value(this, this.microsec_slider, 'microsec', this.microsec - (this.microsec % this._defaults.stepMicrosec));
				}
			}

		},

		/*
		* when a slider moves, set the internal time...
		* on time change is also called when the time is updated in the text field
		*/
		_onTimeChange: function() {
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, 'hour') : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, 'minute') : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, 'second') : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, 'millisec') : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, 'microsec') : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;

			if (typeof(hour) == 'object') {
				hour = false;
			}
			if (typeof(minute) == 'object') {
				minute = false;
			}
			if (typeof(second) == 'object') {
				second = false;
			}
			if (typeof(millisec) == 'object') {
				millisec = false;
			}
			if (typeof(microsec) == 'object') {
				microsec = false;
			}
			if (typeof(timezone) == 'object') {
				timezone = false;
			}

			if (hour !== false) {
				hour = parseInt(hour, 10);
			}
			if (minute !== false) {
				minute = parseInt(minute, 10);
			}
			if (second !== false) {
				second = parseInt(second, 10);
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10);
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10);
			}

			var ampm = o[hour &amp;lt; 12 ? 'amNames' : 'pmNames'][0];

			// If the update was done in the input field, the input field should not be updated.
			// If the update was done using the sliders, update the input field.
			var hasChanged = (hour != this.hour || minute != this.minute || second != this.second || millisec != this.millisec || microsec != this.microsec 
								|| (this.ampm.length &amp;gt; 0 &amp;amp;&amp;amp; (hour &amp;lt; 12) != ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) 
								|| (this.timezone !== null &amp;amp;&amp;amp; timezone != this.timezone));

			if (hasChanged) {

				if (hour !== false) {
					this.hour = hour;
				}
				if (minute !== false) {
					this.minute = minute;
				}
				if (second !== false) {
					this.second = second;
				}
				if (millisec !== false) {
					this.millisec = millisec;
				}
				if (microsec !== false) {
					this.microsec = microsec;
				}
				if (timezone !== false) {
					this.timezone = timezone;
				}

				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0]);
				}

				this._limitMinMaxDateTime(this.inst, true);
			}
			if (this.support.ampm) {
				this.ampm = ampm;
			}

			// Updates the time within the timepicker
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if(pickerTimeFormat === o.timeFormat){
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix);
				}
				else{
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix);
				}
			}

			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime();
			}
		},

		/*
		* call custom onSelect.
		* bind to sliders slidestop, and grid click.
		*/
		_onSelectHandler: function() {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect &amp;amp;&amp;amp; inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this]);
			}
		},

		/*
		* update our input with the new date time..
		*/
		_updateDateTime: function(dp_inst) {
			dp_inst = this.inst || dp_inst;
			//var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
			var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay)),
				dateFmt = $.datepicker._get(dp_inst, 'dateFormat'),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null &amp;amp;&amp;amp; this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			
			// if a slider was changed but datepicker doesn't have a value yet, set it
			if(dp_inst.lastVal===""){
                dp_inst.currentYear=dp_inst.selectedYear;
                dp_inst.currentMonth=dp_inst.selectedMonth;
                dp_inst.currentDay=dp_inst.selectedDay;
            }

			/*
			* remove following lines to force every changes in date picker to change the input value
			* Bug descriptions: when an input field has a default value, and click on the field to pop up the date picker. 
			* If the user manually empty the value in the input field, the date picker will never change selected value.
			*/
			//if (dp_inst.lastVal !== undefined &amp;amp;&amp;amp; (dp_inst.lastVal.length &amp;gt; 0 &amp;amp;&amp;amp; this.$input.val().length === 0)) {
			//	return;
			//}

			if (this._defaults.timeOnly === true) {
				formattedDateTime = this.formattedTime;
			} else if (this._defaults.timeOnly !== true &amp;amp;&amp;amp; (this._defaults.alwaysSetTime || timeAvailable)) {
				formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix;
			}

			this.formattedDateTime = formattedDateTime;

			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate);
			} else if (this.$altInput &amp;amp;&amp;amp; this._defaults.timeOnly === false &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly === true) {
				this.$altInput.val(this.formattedTime);
				this.$input.val(this.formattedDate);
			} else if (this.$altInput) {
				this.$input.val(formattedDateTime);
				var altFormattedDateTime = '',
					altSeparator = this._defaults.altSeparator ? this._defaults.altSeparator : this._defaults.separator,
					altTimeSuffix = this._defaults.altTimeSuffix ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
				
				if(!this._defaults.timeOnly){
					if (this._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg);
					}
					else{
						altFormattedDateTime = this.formattedDate;
					}

					if (altFormattedDateTime){
						altFormattedDateTime += altSeparator;
					}
				}

				if(this._defaults.altTimeFormat){
					altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix;
				}
				else{
					altFormattedDateTime += this.formattedTime + altTimeSuffix;
				}
				this.$altInput.val(altFormattedDateTime);
			} else {
				this.$input.val(formattedDateTime);
			}

			this.$input.trigger("change");
		},

		_onFocus: function() {
			if (!this.$input.val() &amp;amp;&amp;amp; this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, 'timepicker');
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst);
						} catch (err) {
							$.timepicker.log(err);
						}
					}
				}
			}
		},

		/*
		* Small abstraction to control types
		* We can add more, just be sure to follow the pattern: create, options, value
		*/
		_controls: {
			// slider methods
			slider: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var rtl = tp_inst._defaults.isRTL; // if rtl go -60-&amp;gt;0 instead of 0-&amp;gt;60
					return obj.prop('slide', null).slider({
						orientation: "horizontal",
						value: rtl? val*-1 : val,
						min: rtl? max*-1 : min,
						max: rtl? min*-1 : max,
						step: step,
						slide: function(event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl? ui.value*-1:ui.value);
							tp_inst._onTimeChange();
						},
						stop: function(event, ui) {
							tp_inst._onSelectHandler();
						}
					});	
				},
				options: function(tp_inst, obj, unit, opts, val){
					if(tp_inst._defaults.isRTL){
						if(typeof(opts) == 'string'){
							if(opts == 'min' || opts == 'max'){
								if(val !== undefined){
									return obj.slider(opts, val*-1);
								}
								return Math.abs(obj.slider(opts));
							}
							return obj.slider(opts);
						}
						var min = opts.min, 
							max = opts.max;
						opts.min = opts.max = null;
						if(min !== undefined){
							opts.max = min * -1;
						}
						if(max !== undefined){
							opts.min = max * -1;
						}
						return obj.slider(opts);
					}
					if(typeof(opts) == 'string' &amp;amp;&amp;amp; val !== undefined){
							return obj.slider(opts, val);
					}
					return obj.slider(opts);
				},
				value: function(tp_inst, obj, unit, val){
					if(tp_inst._defaults.isRTL){
						if(val !== undefined){
							return obj.slider('value', val*-1);
						}
						return Math.abs(obj.slider('value'));
					}
					if(val !== undefined){
						return obj.slider('value', val);
					}
					return obj.slider('value');
				}
			},
			// select methods
			select: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var sel = '&amp;lt;select class="ui-timepicker-select" data-unit="'+ unit +'" data-min="'+ min +'" data-max="'+ max +'" data-step="'+ step +'"&amp;gt;',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;

					for(var i=min; i&amp;lt;=max; i+=step){						
						sel += '&amp;lt;option value="'+ i +'"'+ (i==val? ' selected':'') +'&amp;gt;';
						if(unit == 'hour'){
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig,'')), {hour:i}, tp_inst._defaults);
						}
						else if(unit == 'millisec' || unit == 'microsec' || i &amp;gt;= 10){ sel += i; }
						else {sel += '0'+ i.toString(); }
						sel += '&amp;lt;/option&amp;gt;';
					}
					sel += '&amp;lt;/select&amp;gt;';

					obj.children('select').remove();

					$(sel).appendTo(obj).change(function(e){
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
					});

					return obj;
				},
				options: function(tp_inst, obj, unit, opts, val){
					var o = {},
						$t = obj.children('select');
					if(typeof(opts) == 'string'){
						if(val === undefined){
							return $t.data(opts);
						}
						o[opts] = val;	
					}
					else{ o = opts; }
					return tp_inst.control.create(tp_inst, obj, $t.data('unit'), $t.val(), o.min || $t.data('min'), o.max || $t.data('max'), o.step || $t.data('step'));
				},
				value: function(tp_inst, obj, unit, val){
					var $t = obj.children('select');
					if(val !== undefined){
						return $t.val(val);
					}
					return $t.val();
				}
			}
		} // end _controls

	});

	$.fn.extend({
		/*
		* shorthand just to use timepicker..
		*/
		timepicker: function(o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);

			if (typeof o == 'object') {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				});
			}

			return $(this).each(function() {
				$.fn.datetimepicker.apply($(this), tmp_args);
			});
		},

		/*
		* extend timepicker to datepicker
		*/
		datetimepicker: function(o) {
			o = o || {};
			var tmp_args = arguments;

			if (typeof(o) == 'string') {
				if (o == 'getDate') {
					return $.fn.datepicker.apply($(this[0]), tmp_args);
				} else {
					return this.each(function() {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args);
					});
				}
			} else {
				return this.each(function() {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults);
				});
			}
		}
	});

	/*
	* Public Utility to parse date and time
	*/
	$.datepicker.parseDateTime = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec);
		}

		return parseRes.date;
	};

	/*
	* Public utility to parse time
	*/
	$.datepicker.parseTime = function(timeFormat, timeString, options) {		
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g,'').indexOf('Z') !== -1);

		// Strict parse requires the timeString to match the timeFormat exactly
		var strictParse = function(f, s, o){

			// pattern for standard and localized AM/PM markers
			var getPatternAmpm = function(amNames, pmNames) {
				var markers = [];
				if (amNames) {
					$.merge(markers, amNames);
				}
				if (pmNames) {
					$.merge(markers, pmNames);
				}
				markers = $.map(markers, function(val) {
					return val.replace(/[.*+?|()\[\]{}\\]/g, '\\$&amp;amp;');
				});
				return '(' + markers.join('|') + ')?';
			};

			// figure out position of time elements.. cause js cant do named captures
			var getFormatPositions = function(timeFormat) {
				var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
					orders = {
						h: -1,
						m: -1,
						s: -1,
						l: -1,
						c: -1,
						t: -1,
						z: -1
					};

				if (finds) {
					for (var i = 0; i &amp;lt; finds.length; i++) {
						if (orders[finds[i].toString().charAt(0)] == -1) {
							orders[finds[i].toString().charAt(0)] = i + 1;
						}
					}
				}
				return orders;
			};

			var regstr = '^' + f.toString()
					.replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
							var ml = match.length;
							switch (match.charAt(0).toLowerCase()) {
								case 'h': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'm': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 's': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'l': return '(\\d?\\d?\\d)';
								case 'c': return '(\\d?\\d?\\d)';
								case 'z': return '(z|[-+]\\d\\d:?\\d\\d|\\S+)?';
								case 't': return getPatternAmpm(o.amNames, o.pmNames);
								default:    // literal escaped in quotes
									return '(' + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function (m) { return "\\" + m; }) + ')?';
							}
						})
					.replace(/\s/g, '\\s?') +
					o.timeSuffix + '$',
				order = getFormatPositions(f),
				ampm = '',
				treg;

			treg = s.match(new RegExp(regstr, 'i'));

			var resTime = {
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0
			};

			if (treg) {
				if (order.t !== -1) {
					if (treg[order.t] === undefined || treg[order.t].length === 0) {
						ampm = '';
						resTime.ampm = '';
					} else {
						ampm = $.inArray(treg[order.t].toUpperCase(), o.amNames) !== -1 ? 'AM' : 'PM';
						resTime.ampm = o[ampm == 'AM' ? 'amNames' : 'pmNames'][0];
					}
				}

				if (order.h !== -1) {
					if (ampm == 'AM' &amp;amp;&amp;amp; treg[order.h] == '12') {
						resTime.hour = 0; // 12am = 0 hour
					} else {
						if (ampm == 'PM' &amp;amp;&amp;amp; treg[order.h] != '12') {
							resTime.hour = parseInt(treg[order.h], 10) + 12; // 12pm = 12 hour, any other pm = hour + 12
						} else {
							resTime.hour = Number(treg[order.h]);
						}
					}
				}

				if (order.m !== -1) {
					resTime.minute = Number(treg[order.m]);
				}
				if (order.s !== -1) {
					resTime.second = Number(treg[order.s]);
				}
				if (order.l !== -1) {
					resTime.millisec = Number(treg[order.l]);
				}
				if (order.c !== -1) {
					resTime.microsec = Number(treg[order.c]);
				}
				if (order.z !== -1 &amp;amp;&amp;amp; treg[order.z] !== undefined) {
					resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z]);
				}


				return resTime;
			}
			return false;
		};// end strictParse

		// First try JS Date, if that fails, use strictParse
		var looseParse = function(f,s,o){
			try{
				var d = new Date('2012-01-01 '+ s);
				if(isNaN(d.getTime())){
					d = new Date('2012-01-01T'+ s);
					if(isNaN(d.getTime())){
						d = new Date('01/01/2012 '+ s);
						if(isNaN(d.getTime())){
							throw "Unable to parse time with native Date: "+ s;
						}
					}
				}

				return {
					hour: d.getHours(),
					minute: d.getMinutes(),
					second: d.getSeconds(),
					millisec: d.getMilliseconds(),
					microsec: d.getMicroseconds(),
					timezone: d.getTimezoneOffset()*-1
				};
			}
			catch(err){
				try{
					return strictParse(f,s,o);
				}
				catch(err2){
					$.timepicker.log("Unable to parse \ntimeString: "+ s +"\ntimeFormat: "+ f);
				}				
			}
			return false;
		}; // end looseParse
		
		if(typeof o.parse === "function"){
			return o.parse(timeFormat, timeString, o);
		}
		if(o.parse === 'loose'){
			return looseParse(timeFormat, timeString, o);
		}
		return strictParse(timeFormat, timeString, o);
	};

	/*
	* Public utility to format the time
	* format = string format of the time
	* time = a {}, not a Date() for timezones
	* options = essentially the regional[].. amNames, pmNames, ampm
	*/
	$.datepicker.formatTime = function(format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			timezone: 0
		}, time);

		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);

		if (hour &amp;gt; 11) {
			ampmName = options.pmNames[0];
		}

		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|('.*?'|".*?"))/g, function(match) {
		switch (match) {
			case 'HH':
				return ('0' + hour).slice(-2);
			case 'H':
				return hour;
			case 'hh':
				return ('0' + convert24to12(hour)).slice(-2);
			case 'h':
				return convert24to12(hour);
			case 'mm':
				return ('0' + time.minute).slice(-2);
			case 'm':
				return time.minute;
			case 'ss':
				return ('0' + time.second).slice(-2);
			case 's':
				return time.second;
			case 'l':
				return ('00' + time.millisec).slice(-3);
			case 'c':
				return ('00' + time.microsec).slice(-3);
			case 'z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, false);
			case 'Z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, true);
			case 'T': 
				return ampmName.charAt(0).toUpperCase();
			case 'TT': 
				return ampmName.toUpperCase();
			case 't':
				return ampmName.charAt(0).toLowerCase();
			case 'tt':
				return ampmName.toLowerCase();
			default:
				return match.replace(/\'/g, "") || "'";
			}
		});

		tmptime = $.trim(tmptime);
		return tmptime;
	};

	/*
	* the bad hack :/ override datepicker so it doesnt close on select
	// inspired: http://stackoverflow.com/questions/1252512/jquery-datepicker-prevent-closing-picker-when-clicking-a-date/1762378#1762378
	*/
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function(id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			tp_inst._limitMinMaxDateTime(inst, true);
			inst.inline = inst.stay_open = true;
			//This way the onSelect handler called from calendarpicker get the full dateTime
			this._base_selectDate(id, dateStr);
			inst.inline = inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst);
		} else {
			this._base_selectDate(id, dateStr);
		}
	};

	/*
	* second bad hack :/ override datepicker so it triggers an event when changing the input field
	* and does not redraw the datepicker on every selectDate event
	*/
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function(inst) {

		// don't popup the datepicker if there is another instance already opened
		var input = inst.input[0];
		if ($.datepicker._curInst &amp;amp;&amp;amp; $.datepicker._curInst != inst &amp;amp;&amp;amp; $.datepicker._datepickerShowing &amp;amp;&amp;amp; $.datepicker._lastInput != input) {
			return;
		}

		if (typeof(inst.stay_open) !== 'boolean' || inst.stay_open === false) {

			this._base_updateDatepicker(inst);

			// Reload the time control when changing something in the input text field.
			var tp_inst = this._get(inst, 'timepicker');
			if (tp_inst) {
				tp_inst._addTimePicker(inst);
			}
		}
	};

	/*
	* third bad hack :/ override datepicker so it allows spaces and colon in the input field
	*/
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if ($.datepicker._get(inst, 'constrainInput')) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null? tp_inst._defaults.showTimezone : tp_inst.support.timezone,					
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat')),
					datetimeChars = tp_inst._defaults.timeFormat.toString()
											.replace(/[hms]/g, '')
											.replace(/TT/g, ampm ? 'APM' : '')
											.replace(/Tt/g, ampm ? 'AaPpMm' : '')
											.replace(/tT/g, ampm ? 'AaPpMm' : '')
											.replace(/T/g, ampm ? 'AP' : '')
											.replace(/tt/g, ampm ? 'apm' : '')
											.replace(/t/g, ampm ? 'ap' : '') + 
											" " + tp_inst._defaults.separator + 
											tp_inst._defaults.timeSuffix + 
											(tz ? tp_inst._defaults.timezoneList.join('') : '') + 
											(tp_inst._defaults.amNames.join('')) + (tp_inst._defaults.pmNames.join('')) + 
											dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr &amp;lt; ' ' || !dateChars || datetimeChars.indexOf(chr) &amp;gt; -1);
			}
		}

		return $.datepicker._base_doKeyPress(event);
	};

	/*
	* Fourth bad hack :/ override _updateAlternate function used in inline mode to init altField
	*/
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	/* Update any alternate field to synchronise with the main field. */
	$.datepicker._updateAlternate = function(inst) {
		var tp_inst = this._get(inst, 'timepicker');
		if(tp_inst){
			var altField = tp_inst._defaults.altField;
			if (altField) { // update alternate field too
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = '', 
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator, 
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if(!tp_inst._defaults.timeOnly &amp;amp;&amp;amp; !tp_inst._defaults.altFieldTimeOnly &amp;amp;&amp;amp; date !== null){
					if(tp_inst._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime;
					}
					else{
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime;
					}
				}
				$(altField).val(altFormattedDateTime);
			}
		}
		else{
			$.datepicker._base_updateAlternate(inst);
		}
	};

	/*
	* Override key up event to sync manual input changes.
	*/
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst);
				} catch (err) {
					$.timepicker.log(err);
				}
			}
		}

		return $.datepicker._base_doKeyUp(event);
	};

	/*
	* override "Today" button to also grab the time.
	*/
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function(id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		this._base_gotoToday(id);
		var tp_inst = this._get(inst, 'timepicker');
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		$('.ui-datepicker-today', $dp).click();
	};

	/*
	* Disable &amp;amp; enable the Time in the datetimepicker
	*/
	$.datepicker._disableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst);
		}
	};

	$.datepicker._enableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst); // Could be disabled on page load
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create our own set time function
	*/
	$.datepicker._setTime = function(inst, date) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var defaults = tp_inst._defaults;

			// calling _setTime with no date sets time to defaults
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;

			//check if within min/max times.. 
			tp_inst._limitMinMaxDateTime(inst, true);

			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create new public method to set only time, callable as $().datepicker('setTime', date)
	*/
	$.datepicker._setTimeDatepicker = function(target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date == "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec);
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds());
				}
				if (tp_date.toString() == 'Invalid Date') {
					tp_date = undefined;
				}
				this._setTime(inst, tp_date);
			}
		}

	};

	/*
	* override setDate() to allow setting time too within Date object
	*/
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function(target, date) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		if(typeof(date) === 'string'){
			date = new Date(date);
			if(!date.getTime()){
				$.timepicker.log("Error creating Date object from string.");
			}
		}

		var tp_inst = this._get(inst, 'timepicker');
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds());
		} else {
			tp_date = date;
		}
		
		// This is important if you are using the timezone option, javascript's Date 
		// object will only return the timezone offset for the current locale, so we 
		// adjust it accordingly.  If not using timezone option this won't matter..
		// If a timezone is different in tp, keep the timezone as is
		if(tp_inst){
			// look out for DST if tz wasn't specified
			if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
				tp_inst.timezone = tp_date.getTimezoneOffset()*-1;
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone);
		}

		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true);
	};

	/*
	* override getDate() to allow getting time too within Date object
	*/
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function(target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			// if it hasn't yet been defined, grab from field
			if(inst.lastVal === undefined){
				this._setDateFromField(inst, noDefault);
			}

			var date = this._getDate(inst);
			if (date &amp;amp;&amp;amp; tp_inst._parseTime($(target).val(), tp_inst.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);

				// This is important if you are using the timezone option, javascript's Date 
				// object will only return the timezone offset for the current locale, so we 
				// adjust it accordingly.  If not using timezone option this won't matter..
				if(tp_inst.timezone != null){
					// look out for DST if tz wasn't specified
					if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
						tp_inst.timezone = date.getTimezoneOffset()*-1;
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
				}
			}
			return date;
		}
		return this._base_getDateDatepicker(target, noDefault);
	};

	/*
	* override parseDate() because UI 1.8.14 throws an error about "Extra characters"
	* An option in datapicker to ignore extra format characters would be nicer.
	*/
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function(format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings);
		} catch (err) {
			// Hack!  The error message ends with a colon, a space, and
			// the "extra" characters.  We rely on that instead of
			// attempting to perfectly reproduce the parsing algorithm.
			if (err.indexOf(":") &amp;gt;= 0) {
				date = this._base_parseDate(format, value.substring(0,value.length-(err.length-err.indexOf(':')-2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format);
			} else {
				throw err;
			}
		}
		return date;
	};

	/*
	* override formatDate to set date with time to the input
	*/
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function(inst, day, month, year) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val();
		}
		return this._base_formatDate(inst);
	};

	/*
	* override options setter to add time to maxDate(Time) and minDate(Time). MaxDate
	*/
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function(target, name, value) {
		var inst = this._getInst(target),
	        name_clone;
		if (!inst) {
			return null;
		}

		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop;
		    if (typeof name == 'string') { // if min/max was set with the string
		        if (name === 'minDate' || name === 'minDateTime') {
		            min = value;
		        } else if (name === 'maxDate' || name === 'maxDateTime') {
		            max = value;
		        } else if (name === 'onSelect') {
		            onselect = value;
		        } else if (overrides.hasOwnProperty(name)) {
		            if (typeof (value) === 'undefined') {
		                return overrides[name];
		            }
		            fns[name] = value;
		            name_clone = {}; //empty results in exiting function after overrides updated
		        }
		    } else if (typeof name == 'object') { //if min/max was set with the JSON
		        if (name.minDate) {
		            min = name.minDate;
		        } else if (name.minDateTime) {
		            min = name.minDateTime;
		        } else if (name.maxDate) {
		            max = name.maxDate;
		        } else if (name.maxDateTime) {
		            max = name.maxDateTime;
		        }
		        for (prop in overrides) {
		            if (overrides.hasOwnProperty(prop) &amp;amp;&amp;amp; name[prop]) {
		                fns[prop] = name[prop];
		            }
		        }
		    }
		    for (prop in fns) {
		        if (fns.hasOwnProperty(prop)) {
		            overrides[prop] = fns[prop];
		            if (!name_clone) { name_clone = $.extend({}, name);}
		            delete name_clone[prop];
		        }
		    }
		    if (name_clone &amp;amp;&amp;amp; isEmptyObject(name_clone)) { return; }
		    if (min) { //if min was set
		        if (min === 0) {
		            min = new Date();
		        } else {
		            min = new Date(min);
		        }
		        tp_inst._defaults.minDate = min;
		        tp_inst._defaults.minDateTime = min;
		    } else if (max) { //if max was set
		        if (max === 0) {
		            max = new Date();
		        } else {
		            max = new Date(max);
		        }
		        tp_inst._defaults.maxDate = max;
		        tp_inst._defaults.maxDateTime = max;
		    } else if (onselect) {
		        tp_inst._defaults.onSelect = onselect;
		    }
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name);
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
	};
	
	/*
	* jQuery isEmptyObject does not check hasOwnProperty - if someone has added to the object prototype,
	* it will return false for all objects
	*/
	var isEmptyObject = function(obj) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(obj)) {
				return false;
			}
		}
		return true;
	};

	/*
	* jQuery extend now ignores nulls!
	*/
	var extendRemove = function(target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] === null || props[name] === undefined) {
				target[name] = props[name];
			}
		}
		return target;
	};

	/*
	* Determine by the time format which units are supported
	* Returns an object of booleans for each unit
	*/
	var detectSupport = function(timeFormat){
		var tf = timeFormat.replace(/\'.*?\'/g,'').toLowerCase(), // removes literals
			isIn = function(f, t){ // does the format contain the token?
					return f.indexOf(t) !== -1? true:false; 
				};
		return {
				hour: isIn(tf,'h'),
				minute: isIn(tf,'m'),
				second: isIn(tf,'s'),
				millisec: isIn(tf,'l'),
				microsec: isIn(tf,'c'),
				timezone: isIn(tf,'z'),
				ampm: isIn(tf,'t') &amp;amp;&amp;amp; isIn(timeFormat,'h'),
				iso8601: isIn(timeFormat, 'Z')
			};
	};

	/*
	* Converts 24 hour format into 12 hour
	* Returns 12 hour without leading 0
	*/
	var convert24to12 = function(hour) {
		if (hour &amp;gt; 12) {
			hour = hour - 12;
		}

		if (hour === 0) {
			hour = 12;
		}

		return String(hour);
	};

	/*
	* Splits datetime string into date ans time substrings.
	* Throws exception when date can't be parsed
	* Returns [dateString, timeString]
	*/
	var splitDateTime = function(dateFormat, dateTimeString, dateSettings, timeSettings) {
		try {
			// The idea is to get the number separator occurances in datetime and the time format requested (since time has 
			// fewer unknowns, mostly numbers and am/pm). We will use the time pattern to split.
			var separator = timeSettings &amp;amp;&amp;amp; timeSettings.separator ? timeSettings.separator : $.timepicker._defaults.separator,
				format = timeSettings &amp;amp;&amp;amp; timeSettings.timeFormat ? timeSettings.timeFormat : $.timepicker._defaults.timeFormat,
				timeParts = format.split(separator), // how many occurances of separator may be in our format?
				timePartsLen = timeParts.length,
				allParts = dateTimeString.split(separator),
				allPartsLen = allParts.length;

			if (allPartsLen &amp;gt; 1) {
				return [
						allParts.splice(0,allPartsLen-timePartsLen).join(separator),
						allParts.splice(0,timePartsLen).join(separator)
					];
			}

		} catch (err) {
			$.timepicker.log('Could not split the date from the time. Please check the following datetimepicker options' +
					"\nthrown error: " + err +
					"\ndateTimeString" + dateTimeString +
					"\ndateFormat = " + dateFormat +
					"\nseparator = " + timeSettings.separator +
					"\ntimeFormat = " + timeSettings.timeFormat);

			if (err.indexOf(":") &amp;gt;= 0) {
				// Hack!  The error message ends with a colon, a space, and
				// the "extra" characters.  We rely on that instead of
				// attempting to perfectly reproduce the parsing algorithm.
				var dateStringLength = dateTimeString.length - (err.length - err.indexOf(':') - 2),
					timeString = dateTimeString.substring(dateStringLength);

				return [$.trim(dateTimeString.substring(0, dateStringLength)), $.trim(dateTimeString.substring(dateStringLength))];

			} else {
				throw err;
			}
		}
		return [dateTimeString, ''];
	};

	/*
	* Internal function to parse datetime interval
	* Returns: {date: Date, timeObj: Object}, where
	*   date - parsed date without time (type Date)
	*   timeObj = {hour: , minute: , second: , millisec: , microsec: } - parsed time. Optional
	*/
	var parseDateTimeInternal = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var date;
		var splitRes = splitDateTime(dateFormat, dateTimeString, dateSettings, timeSettings);
		date = $.datepicker._base_parseDate(dateFormat, splitRes[0], dateSettings);
		if (splitRes[1] !== '') {
			var timeString = splitRes[1],
				parsedTime = $.datepicker.parseTime(timeFormat, timeString, timeSettings);

			if (parsedTime === null) {
				throw 'Wrong time format';
			}
			return {
				date: date,
				timeObj: parsedTime
			};
		} else {
			return {
				date: date
			};
		}
	};

	/*
	* Internal function to set timezone_select to the local timezone
	*/
	var selectLocalTimezone = function(tp_inst, date) {
		if (tp_inst &amp;amp;&amp;amp; tp_inst.timezone_select) {
			var now = typeof date !== 'undefined' ? date : new Date();
			tp_inst.timezone_select.val(now.getTimezoneOffset()*-1);
		}
	};

	/*
	* Create a Singleton Insance
	*/
	$.timepicker = new Timepicker();

	/**
	 * Get the timezone offset as string from a date object (eg '+0530' for UTC+5.5)
	 * @@param  number if not a number this value is returned
	 * @@param boolean if true formats in accordance to iso8601 "+12:45"
	 * @@return string
	 */
	$.timepicker.timezoneOffsetString = function(tzMinutes, iso8601) {
		if(isNaN(tzMinutes) || tzMinutes &amp;gt; 840){
			return tzMinutes;
		}

		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601? ':':'',
			tz = (off &amp;gt;= 0 ? '+' : '-') + ('0' + (hours * 101).toString()).slice(-2) + iso + ('0' + (minutes * 101).toString()).slice(-2);
		
		if(tz == '+00:00'){
			return 'Z';
		}
		return tz;
	};

	/**
	 * Get the number in minutes that represents a timezone string
	 * @@param  string formated like "+0500", "-1245"
	 * @@return number
	 */
	$.timepicker.timezoneOffsetNumber = function(tzString) {
		tzString = tzString.toString().replace(':',''); // excuse any iso8601, end up with "+1245"

		if(tzString.toUpperCase() === 'Z'){ // if iso8601 with Z, its 0 minute offset
			return 0;
		}

		if(!/^(\-|\+)\d{4}$/.test(tzString)){ // possibly a user defined tz, so just give it back
			return tzString;
		}

		return ((tzString.substr(0,1) =='-'? -1 : 1) * // plus or minus
					((parseInt(tzString.substr(1,2),10)*60) + // hours (converted to minutes)
					parseInt(tzString.substr(3,2),10))); // minutes
	};

	/**
	 * No way to set timezone in js Date, so we must adjust the minutes to compensate. (think setDate, getDate)
	 * @@param  date
	 * @@param  string formated like "+0500", "-1245"
	 * @@return date
	 */
	$.timepicker.timezoneAdjust = function(date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if(!isNaN(toTz)){
			date.setMinutes(date.getMinutes()*1 + (date.getTimezoneOffset()*-1 - toTz*1) );
		}
		return date;
	};

	/**
	 * Calls `timepicker()` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * n.b. The input value must be correctly formatted (reformatting is not supported)
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the timepicker() call
	 * @@return jQuery
	 */
	$.timepicker.timeRange = function(startTime, endTime, options) {
		return $.timepicker.handleRange('timepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datetimepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@return jQuery
	 */
	$.timepicker.datetimeRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datetimepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.dateRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.handleRange = function(method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0, // min allowed interval in milliseconds
			maxInterval: 0, // max allowed interval in milliseconds
			start: {},      // options for start picker
			end: {}         // options for end picker
		}, options);

		$.fn[method].call(startTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), endTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), endTime, 'minDate');
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), startTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), startTime, 'maxDate');
			}
		}, options, options.end));

		checkDates(startTime, endTime);
		selected(startTime, endTime, 'minDate');
		selected(endTime, startTime, 'maxDate');

		function checkDates(changed, other) {
			var startdt = startTime[method]('getDate'),
				enddt = endTime[method]('getDate'),
				changeddt = changed[method]('getDate');

			if(startdt !== null){
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());

				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);

				if(options.minInterval &amp;gt; 0 &amp;amp;&amp;amp; minDate &amp;gt; enddt){ // minInterval check
					endTime[method]('setDate',minDate);
				}
				else if(options.maxInterval &amp;gt; 0 &amp;amp;&amp;amp; maxDate &amp;lt; enddt){ // max interval check
					endTime[method]('setDate',maxDate);
				}
				else if (startdt &amp;gt; enddt) {
					other[method]('setDate',changeddt);
				}
			}
		}

		function selected(changed, other, option) {
			if (!changed.val()) {
				return;
			}
			var date = changed[method].call(changed, 'getDate');
			if(date !== null &amp;amp;&amp;amp; options.minInterval &amp;gt; 0){
				if(option == 'minDate'){
					date.setMilliseconds(date.getMilliseconds() + options.minInterval); 
				}
				if(option == 'maxDate'){
					date.setMilliseconds(date.getMilliseconds() - options.minInterval);
				}
			}
			if (date.getTime) {
				other[method].call(other, 'option', option, date);
			}
		}
		return $([startTime.get(0), endTime.get(0)]);
	};

	/**
	 * Log error or data to the console during error or debugging
	 * @@param  Object err pass any type object to log to the console during error or debugging
	 * @@return void
	 */
	$.timepicker.log = function(err){
		if(window.console){
			console.log(err);
		}
	};

	/*
	* Microsecond support
	*/
	if(!Date.prototype.getMicroseconds){
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function(){ return this.microseconds; };
		Date.prototype.setMicroseconds = function(m){ 
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m/1000));
			this.microseconds = m%1000;
			return this;
		};
	}

	/*
	* Keep up with the version
	*/
	$.timepicker.version = "1.3.1";

})(jQuery);
jQuery.noConflict();
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;datetimepicker-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;e73a652e-09fc-4c71-8e7a-e2525a2d2a99&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
function replaceAllString(oriStr, strTarget, strSubString ){
   var strText = oriStr;
   var intIndexOfMatch = strText.indexOf( strTarget );
   while (intIndexOfMatch != -1){
      strText = strText.replace( strTarget, strSubString )
      intIndexOfMatch = strText.indexOf( strTarget );
   }
   return( strText );
}
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&amp;amp;]" + name + "=([^&amp;amp;#]*)"),
    results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
};


   var jobName= getParameterByName('job')
   var fromDate= getParameterByName('fromDate')
   var toDate= getParameterByName('toDate')
   var limit= getParameterByName('limit')
   var selectedIstIid = getParameterByName('IstIid')

  $("#jobname").ready(function(){
   $("#jobname").text(jobName)
   var convertedJobName = replaceAllString(jobName, ".", "_")
   $("#IstIid" + convertedJobName).ready(function(){
     $("#IstIid" + convertedJobName).css("display","block")
     $("#select_" + convertedJobName).ready(function(){
        $("#select_" + convertedJobName).val(selectedIstIid)
     });
   });
 });

  $("#fromDate").ready(function(){
   $("#from-date").val(fromDate)
 });

  $("#toDate").ready(function(){
   $("#to-date").val(toDate)
 });

  $("#limit").ready(function(){
   if(limit!=""){
    $("#limit").val(limit)
   }
 });
 // Get data with ajax
 function ajax_getData(jobName,fromDate,toDate,limit ){
       var convertedJobName = replaceAllString(jobName, ".", "_")
       var istIid = $("#select_" + convertedJobName).val()
       window.location="/xwiki/bin/view/WiperDog/WebHome?job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid="+istIid;
 			/*$.ajax({
			 type: "GET",
			 url:"/xwiki/bin/get/Sandbox/DescriptionForJob?outputSyntax=plain&amp;amp;job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid"+selectedIstIid,
			 success : function(result){
				$("#jobname").html(jobName)
				$("#display").text('[[]]' + result)
			 }
		   });*/
 }
	$("#treemenu2 a").click(function(){
		 var limit = 10
		 var fromDate=""
		 var toDate = ""
		 jobName= $(this).text()
                 $("#jobname").html(jobName)
                 var convertedJobName = replaceAllString(jobName, ".", "_")
                 $("#listIstIid &amp;gt; div").css("display","none")
                 $("#IstIid" + convertedJobName).css("display","block")
		 //ajax_getData(jobName,fromDate,toDate,limit )

	});

	$("#from-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
		dateFormat: 'yy-mm-dd',
	});
	$("#to-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
			dateFormat: 'yy-mm-dd',

	});
	 $("#get-data").on("click",function(){
		var fromDate = $("#from-date").val()
		var toDate =  $("#to-date").val()
		 if( toDate!= "" ){
			  if(fromDate != ""){
				  if($("#from-date").datepicker( "getDate" ) &amp;gt; $("#to-date").datepicker( "getDate" )){
				  alert("'From date' cannot start later than 'To date'")
				  return false
				  }
			  }
		 }
		 limit = $("#limit").val()
		 ajax_getData(jobName,fromDate,toDate,limit )
	});
$(document).ready(function(){

  var dataModelUrl = '/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job='+jobName+'&amp;amp;limit='
       +limit+'&amp;amp;fromDate='+fromDate + '&amp;amp;toDate='+toDate+'&amp;amp;pager=pager2&amp;amp;genp=1&amp;amp;istIid='+selectedIstIid 
       var jqxhr = $.getJSON(dataModelUrl, function(data) {
//       alert('Data: ' + data)
       $("#livetableList").jqGrid(data);
       $("#livetableList").jqGrid('navGrid', "#livetablePager", {
           edit : false,
           add : false,
           del : false
         });
       })
});
        
jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;process&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;881686cc-1bfc-456e-b8ab-71334c4a45e5&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){

$(function () {
    function drawLineChart(xAxis, series, container, data_detail){
        var dataXAxis = xAxis
        var dataSeries = series
        var detail = data_detail

			$('#containerline' + container).highcharts({

				chart: {
					type:'line'
				},
				title: {
					text: container
				},
				tooltip :{
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				xAxis: dataXAxis ,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				series: dataSeries
			});
		};

		function drawBarChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerbar' + container).highcharts({
				chart: {
					type: 'column'
				},
				title: {
					text: container
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {

					column: {
						pointPadding: 0.2,
						borderWidth: 0
					}
				},
				series: dataSeries
			});
		}

		function drawAreaChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail
			$('#containerarea' + container).highcharts({
				chart: {
					type: 'area'
				},
				title: {
					text: container
				},
				subtitle: {
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					},
					labels: {
						formatter: function() {
							return this.value / 1000;
						}
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {
					area: {
						stacking: 'normal',
						lineColor: '#666666',
						lineWidth: 1,
						marker: {
							lineWidth: 1,
							lineColor: '#666666'
						}
					}
				},
				series: dataSeries
			});
		};

		function drawPieChart(data, container){
			var dataPie = data
			$(document).ready(function () {
				// Build the chart
				$('#container' + container).highcharts({
					chart: {
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: dataPie[0].name
					},
					tooltip: {
						pointFormat: '{series.name}: &amp;lt;b&amp;gt;{point.percentage:.1f}%&amp;lt;/b&amp;gt;'
					},
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							dataLabels: {
								enabled: false
							},
							showInLegend: true
						}
					},
					series: dataPie
				});
			});
		}

		// LINE
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonline_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonline");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Line chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						if(data_all[0][i].series[0].name == null){
							data_all[0][i].series[0].name = lstContainer[0][i]
						}
						drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
					}
				}
			}
		});

		// BAR
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonbar_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonbar");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Bar chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						drawBarChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
					}
				}
			}
		});

		// AREA
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonarea_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonarea");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				// data to display on tooltip
				var data_detail = data_all[0]
				// draw Area Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					drawAreaChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
				}
			}
		});

		// PIE
		$("#piechart").ready(function(){

			var array = $("#jsons&amp;gt;.jsonpie");
			var arrayContainer = $("#jsons&amp;gt;.lstcontainerpie");
			var lstContainer = [];
			var data_all = [];
			for(var i=0;i&amp;lt;array.length;i++){
				data_all[i] = jQuery.parseJSON(array[i].value)
				lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)

			}
			if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
				// data to display on tooltip
				// draw Pie Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					var finalData = []
					finalData[0] = data_all[0][i]
					drawPieChart(finalData, lstContainer[0][i])
				}
			}
		});
	});
	jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;d5873d92-b78b-42fc-9407-46d166204b88&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;/* css for timepicker */
.ui-timepicker-div .ui-widget-header { 
margin-bottom: 8px;
 }

.ui-timepicker-div dl { text-align: left; }
.ui-timepicker-div dl dt { height: 25px; margin-bottom: -25px; }
.ui-timepicker-div dl dd { margin: 0 10px 10px 65px; }
.ui-timepicker-div td { font-size: 90%; }
.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }

.ui-timepicker-rtl{ direction: rtl; }
.ui-timepicker-rtl dl { text-align: right; }
.ui-timepicker-rtl dl dd { margin: 0 65px 10px 10px; }
#ui-datepicker-div{
 position:relative;
 width:auto;
 height:auto
}
&lt;/code&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;datetimepicker -css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;1201fb1a-e9c1-4731-8c74-2ea8c0071959&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;.displayblock {
  border:2px solid;
  -webkit-border-radius:6px;
  background:gray;
  float: left;
  width:100%;
}

.displaypie {
  border:1px solid;
  -webkit-border-radius:6px;
  background:gray;
  width: 48%;
  float: left; 
  height: 300px;
}

.subtype {
  margin-top: 50px;
  font-size: 2em;
  color: red;
}&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;content&gt;{{include document="Lib.DataToDrawChart"/}}
{{include document="Lib.MongoDBConnection"/}}
{{velocity}}
$xwiki.jsx.use('Lib.JQueryUILib')
$xwiki.ssx.use('Lib.MenuGenerator')
$xwiki.jsx.use('Lib.MenuGenerator')
$xwiki.ssx.use('Lib.JQueryUILib')
$xwiki.jsx.use('Lib.JqGridLib')
$xwiki.ssx.use('Lib.JqGridLib') 
{{/velocity}}
{{include document="Lib.MenuGenerator"/}}
{{html wiki="true" clean="false"}}
&amp;lt;div id="viewer"&amp;gt;
&amp;lt;table style="text-align:left"  &amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th &amp;gt;Job name&amp;lt;/th&amp;gt;
  &amp;lt;td colspan=3&amp;gt;&amp;lt;div id="jobname"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
{{groovy}}
import org.xwiki.context.*

def ec = services.component.getInstance(Execution.class).getContext()
def mapJobIstIid = ec.getProperty("mapJobIstIid")

println '{{html clean="false" wiki="false"}}'
println '&amp;lt;tr&amp;gt;'
println '&amp;lt;th&amp;gt;IstIid&amp;lt;/th&amp;gt;'
println '&amp;lt;td colspan=3&amp;gt;'
mapJobIstIid.each{jobEntry-&amp;gt;
  def convertedJobKey = jobEntry.key.replaceAll("\\.","_")
  println "&amp;lt;div id='listIstIid'&amp;gt;"
  println "&amp;lt;div id=IstIid${convertedJobKey} style='display:none'&amp;gt;"
  println "&amp;lt;select id=select_${convertedJobKey}&amp;gt;"
  jobEntry.value.each{
     println "&amp;lt;option value=\"$it\"&amp;gt;$it&amp;lt;/option&amp;gt;"
  }
  println "&amp;lt;/select&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
}
println '&amp;lt;/td&amp;gt;'
println '&amp;lt;/tr&amp;gt;'
println '{{/html}}'
{{/groovy}}
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data monitor from&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="from-date" id="from-date"/&amp;gt;&amp;lt;/td&amp;gt;
  &amp;lt;th&amp;gt;Data monitor to&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="to-date" id="to-date"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data records limit &amp;lt;/th&amp;gt;
  &amp;lt;td &amp;gt;
     &amp;lt;select id="limit"&amp;gt;
       &amp;lt;option value=5&amp;gt;5&amp;lt;/option&amp;gt;
       &amp;lt;option value=10&amp;gt;10&amp;lt;/option&amp;gt;
       &amp;lt;option value=15&amp;gt;15&amp;lt;/option&amp;gt;
       &amp;lt;option value=20&amp;gt;20&amp;lt;/option&amp;gt;
     &amp;lt;/select&amp;gt;
  &amp;lt;/td&amp;gt;
  &amp;lt;td colspan=3 &amp;gt;&amp;lt;input type="button" value="View Data" id="get-data" class="button"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;
    &amp;lt;table id="livetableList"&amp;gt;&amp;lt;tr&amp;gt;&amp;lt;td&amp;gt;livetableList&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;
    &amp;lt;div id="livetablePager"&amp;gt;livetablePager&amp;lt;/div&amp;gt;
&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;&amp;lt;div id="display"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
&amp;lt;/table&amp;gt;

&amp;lt;/div&amp;gt; 
 &amp;lt;/body&amp;gt;

{{/html}}
{{groovy}}
import groovy.json.*
xwiki.jsx.use("Lib.Highcharts")

if(request.xpage == "plain") {
	response.setContentType('text/plain')
}

def listData = []
def job = request.get("job")
def fromDate = request.get("fromDate")
def toDate = request.get("toDate")
def limit= (request.get("limit")!=null)?request.get("limit").toInteger():10
def istIid = request.get("IstIid")

def str= "No data to retrieved !"
def result = null
if(job != "" &amp;amp;&amp;amp; job != null &amp;amp;&amp;amp; istIid != null &amp;amp;&amp;amp; istIid != ""){
	MongoDBConnection.getConnection()
	if(fromDate != "" || toDate != ""){
		result = MongoDBConnection.getDataInPeriod(job,fromDate,toDate,limit,istIid)
	} else {
		result = MongoDBConnection.getDataAllFields(job,limit,istIid)
        }
MongoDBConnection.closeConnection()
} else {
   println "{{warning}}There are no selected job or IstIid{{/warning}}"
}

if( (result != null) &amp;amp;&amp;amp; (result.size() &amp;gt; 0) &amp;amp;&amp;amp; (result[0].KEYEXPR != null)&amp;amp;&amp;amp;!(result[0].KEYEXPR instanceof List )){
if(result[0].type == "Subtyped") {
    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
    def dataSubtype = DataToDrawChart.getDataToDrawSubtype(result)
    def listKey = []
    dataSubtype.each {key,value -&amp;gt;
        listKey.add(key)
    }
    def jsonkey = com.mongodb.util.JSON.serialize(listKey)
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$jsonkey&amp;lt;/textarea&amp;gt;"

    dataSubtype.each {key,value -&amp;gt;
        def dataLine = []
        def dataBar = []
        def dataPie = []
        def dataArea = []
        if(DataToDrawChart.getDataToDrawLine(value) != []) {
            dataLine = DataToDrawChart.getDataToDrawLine(value)
        }
        if(DataToDrawChart.getDataToDrawBar(value) != []) {
            dataBar = DataToDrawChart.getDataToDrawBar(value)
        }
        if(DataToDrawChart.getDataToDrawPie(value) != []) {
            dataPie = DataToDrawChart.getDataToDrawPie(value)
        }
        if(DataToDrawChart.getDataToDrawArea(value) != []) {
            dataArea = DataToDrawChart.getDataToDrawArea(value)
        }

        def chartColumnsLine
        def chartColumnsBar 
        def chartColumnsArea 
        def lstName
        if(dataLine.size() &amp;gt; 0 ){
            chartColumnsLine = dataLine[0].chart_columns
        }
        if(dataBar.size() &amp;gt; 0){
            chartColumnsBar = dataBar[0].chart_columns
        }
        if(dataArea.size() &amp;gt; 0 ){
            chartColumnsArea = dataArea[0].chart_columns
        }
        if(dataPie.size() &amp;gt; 0 ){
            lstName = dataPie['name']
        }

        def tmpListNameContainer = []
	for(def nameContainer in lstName){
	   nameContainer = nameContainer.replaceAll("\\.", "_")
	   tmpListNameContainer.add(nameContainer)
	}
        def jsonPie
        def jsonLine
	def jsonBar
        def jsonArea
        if(dataPie != []) {
	    jsonPie = com.mongodb.util.JSON.serialize(dataPie)
        }
        if(dataLine != []) {
	    jsonLine = com.mongodb.util.JSON.serialize(dataLine)
        }
        if(dataBar != []) {
            jsonBar = com.mongodb.util.JSON.serialize(dataBar)
        }
        if(dataArea != []) {
	    jsonArea = com.mongodb.util.JSON.serialize(dataArea)
        }

	def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
	def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
	def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
	def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

	println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
        if(jsonLine != null) {
	    println "&amp;lt;textarea id=\"jsonline_$key\" &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;" 
        }
	if(jsonBar != null) {
            println "&amp;lt;textarea id=\"jsonbar_$key\"&amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
 	    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
        }
        if(jsonPie != null) {
	    println "&amp;lt;textarea id=\"jsonpie_$key\" &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
        }
        if(jsonArea != null) {
	    println "&amp;lt;textarea id=\"jsonarea_$key\" &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"
	    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
        }

	println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
	println "&amp;lt;input style=\"display:none\" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;"
	println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
	println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'
	println "&amp;lt;/div&amp;gt;"
	  
	def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
	def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
	  
	println "&amp;lt;div style='clear:both'&amp;gt;"
        def description = value.KEYEXPR._description[0][key]
        if(description != null) {
            println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +': ' + description +'&amp;lt;/div&amp;gt;'
        } else {
            println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +'&amp;lt;/div&amp;gt;'
        }
        println "-----"
        if(jsonPie != null) {
	  println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
	  lstName.each{
	    def tmp = it.replaceAll("\\.", "_")
	    println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
        if(jsonLine != null) {
	  def chartLineComment = false
	  chartColumnsLine.each{
	    if(!chartLineComment){
	       println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	       chartLineComment = true  
	    }

	      println " &amp;lt;div class=\"displayblock\" id=\"containerline${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
        println "&amp;amp;nbsp;"

        if(jsonBar != null) {
	  def chartBarComment = false
	  chartColumnsBar.each{
	     if(!chartBarComment){
	        println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	        chartBarComment = true
	      }  

	     println " &amp;lt;div class=\"displayblock\" id=\"containerbar${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
	println "&amp;amp;nbsp;"

        if(jsonArea != null) {
	  def chartAreaComment = false
	  chartColumnsArea.each{
	  if(!chartAreaComment){
	    println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	    chartAreaComment = true
	  }
	    println " &amp;lt;div class=\"displayblock\" id=\"containerarea${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
	println "&amp;lt;/div&amp;gt;"
        
    }
    println '&amp;lt;/body&amp;gt;'
    println '{{/html}}'
} else if(result[0].type == "Store") {
    // data store
    def dataLine = DataToDrawChart.getDataToDrawLine(result)
    def dataBar = DataToDrawChart.getDataToDrawBar(result)
    def dataPie = DataToDrawChart.getDataToDrawPie(result)
    def dataArea = DataToDrawChart.getDataToDrawArea(result)
    def chartColumnsLine 
    def chartColumnsBar 
    def chartColumnsArea 
    def lstName 

    if(dataLine.size() &amp;gt; 0 ){
        chartColumnsLine = dataLine[0].chart_columns
    }
    if(dataBar.size() &amp;gt; 0){
        chartColumnsBar = dataBar[0].chart_columns
    }
    if(dataArea.size() &amp;gt; 0 ){
        chartColumnsArea = dataArea[0].chart_columns
    }
    if(dataPie.size() &amp;gt; 0 ){
        lstName = dataPie['name']
    }

    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
  
    def tmpListNameContainer = []
    for(def nameContainer in lstName){
       nameContainer = nameContainer.replaceAll("\\.", "_")
       tmpListNameContainer.add(nameContainer)
    }
  
    def jsonPie = com.mongodb.util.JSON.serialize(dataPie)
    def jsonLine = com.mongodb.util.JSON.serialize(dataLine)
    def jsonBar = com.mongodb.util.JSON.serialize(dataBar)
    def jsonArea = com.mongodb.util.JSON.serialize(dataArea)

    def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
    def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
    def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
    def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

    def listEmpty = com.mongodb.util.JSON.serialize([])
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$listEmpty&amp;lt;/textarea&amp;gt;" 

    println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'

    println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
    println "&amp;lt;textarea class='jsonline' &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonbar' &amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonpie' &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonarea' &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"

    println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
  
    def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
    def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
  
    println "&amp;lt;div style='clear:both'&amp;gt;"
  
    def chartPieComment = false
    lstName.each{
        if(!chartPieComment) {
            println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
            chartPieComment = true
        }
        def tmp = it.replaceAll("\\.", "_")
        println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    def chartLineComment = false
    chartColumnsLine.each{
    if(!chartLineComment){
        println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
        chartLineComment = true  
    }

    println " &amp;lt;div class=\"displayblock\" id=\"containerline$it\"&amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    println "&amp;amp;nbsp;"
    def chartBarComment = false
    chartColumnsBar.each{
        if(!chartBarComment){
            println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
            chartBarComment = true
        }  

    println " &amp;lt;div class=\"displayblock\" id=\"containerbar$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
  println "&amp;lt;/div&amp;gt;"
  println "&amp;amp;nbsp;"
  def chartAreaComment = false
  chartColumnsArea.each{
  if(!chartAreaComment){
    println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
    chartAreaComment = true
  }
    println " &amp;lt;div class=\"displayblock\" id=\"containerarea$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
  println "&amp;lt;/div&amp;gt;"
println "&amp;lt;/div&amp;gt;"

println '&amp;lt;/body&amp;gt;'
println '{{/html}}'
}
}else{
    println 'There is no data for this job with criterias'
}
{{/groovy}}
{{html wiki="true" clean="false"}}
    &amp;lt;table id="livetableList"&amp;gt;&amp;lt;/table&amp;gt;
    &amp;lt;div id="livetablePager"&amp;gt;&amp;lt;/div&amp;gt;
{{/html}}
&lt;/content&gt;&lt;/xwikidoc&gt;@


50.2
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376392566000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;50.2&lt;/version&gt;
@


50.1
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376392436000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376392436000&lt;/contentUpdateDate&gt;
&lt;version&gt;50.1&lt;/version&gt;
d21 1
a21 1
&lt;minorEdit&gt;false&lt;/minorEdit&gt;
d3504 2
a3505 4
&amp;lt;div id="livetableContainer"&amp;gt;
&amp;lt;table id="livetableList"&amp;gt;&amp;lt;/table&amp;gt;
&amp;lt;div id="livetablePager"&amp;gt;&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
@


49.1
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376392091000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376391742000&lt;/contentUpdateDate&gt;
&lt;version&gt;49.1&lt;/version&gt;
d3504 1
d3507 1
@


48.1
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376391742000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;48.1&lt;/version&gt;
@


47.1
log
@@
text
@&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xwikidoc&gt;
&lt;web&gt;WiperDog&lt;/web&gt;
&lt;name&gt;WebHome&lt;/name&gt;
&lt;language&gt;&lt;/language&gt;
&lt;defaultLanguage&gt;en&lt;/defaultLanguage&gt;
&lt;translation&gt;0&lt;/translation&gt;
&lt;parent&gt;&lt;/parent&gt;
&lt;creator&gt;XWiki.Admin&lt;/creator&gt;
&lt;author&gt;XWiki.Admin&lt;/author&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;contentAuthor&gt;XWiki.Admin&lt;/contentAuthor&gt;
&lt;creationDate&gt;1376364375000&lt;/creationDate&gt;
&lt;date&gt;1376391684000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376391526000&lt;/contentUpdateDate&gt;
&lt;version&gt;47.1&lt;/version&gt;
&lt;title&gt;WiperDog&lt;/title&gt;
&lt;defaultTemplate&gt;&lt;/defaultTemplate&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;comment&gt;&lt;/comment&gt;
&lt;minorEdit&gt;false&lt;/minorEdit&gt;
&lt;syntaxId&gt;xwiki/2.1&lt;/syntaxId&gt;
&lt;hidden&gt;false&lt;/hidden&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;047293a8-524d-45e4-af52-cd944523d5d0&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
/*
 * jQuery timepicker addon
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 1.3.1
 * Last Modified: 07/07/2013
 *
 * Copyright 2013 Trent Richardson
 * You may use this project under MIT or GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 */

/*jslint evil: true, white: false, undef: false, nomen: false */

(function($) {

	/*
	* Lets not redefine timepicker, Prevent "Uncaught RangeError: Maximum call stack size exceeded"
	*/
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return;
	}

	/*
	* Extend jQueryUI, get it started with our version number
	*/
	$.extend($.ui, {
		timepicker: {
			version: "1.3.1"
		}
	});

	/* 
	* Timepicker manager.
	* Use the singleton instance of this class, $.timepicker, to interact with the time picker.
	* Settings for (groups of) time pickers are maintained in an instance object,
	* allowing multiple different settings on the same page.
	*/
	var Timepicker = function() {
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[''] = { // Default regional settings
			currentText: 'Now',
			closeText: 'Done',
			amNames: ['AM', 'A'],
			pmNames: ['PM', 'P'],
			timeFormat: 'HH:mm',
			timeSuffix: '',
			timeOnlyTitle: 'Choose Time',
			timeText: 'Time',
			hourText: 'Hour',
			minuteText: 'Minute',
			secondText: 'Second',
			millisecText: 'Millisecond',
			microsecText: 'Microsecond',
			timezoneText: 'Time Zone',
			isRTL: false
		};
		this._defaults = { // Global defaults for all the datetime picker instances
			showButtonPanel: true,
			timeOnly: false,
			showHour: null,
			showMinute: null,
			showSecond: null,
			showMillisec: null,
			showMicrosec: null,
			showTimezone: null,
			showTime: true,
			stepHour: 1,
			stepMinute: 1,
			stepSecond: 1,
			stepMillisec: 1,
			stepMicrosec: 1,
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null,
			hourMin: 0,
			minuteMin: 0,
			secondMin: 0,
			millisecMin: 0,
			microsecMin: 0,
			hourMax: 23,
			minuteMax: 59,
			secondMax: 59,
			millisecMax: 999,
			microsecMax: 999,
			minDateTime: null,
			maxDateTime: null,
			onSelect: null,
			hourGrid: 0,
			minuteGrid: 0,
			secondGrid: 0,
			millisecGrid: 0,
			microsecGrid: 0,
			alwaysSetTime: true,
			separator: ' ',
			altFieldTimeOnly: true,
			altTimeFormat: null,
			altSeparator: null,
			altTimeSuffix: null,
			pickerTimeFormat: null,
			pickerTimeSuffix: null,
			showTimepicker: true,
			timezoneList: null,
			addSliderAccess: false,
			sliderAccessArgs: null,
			controlType: 'slider',
			defaultValue: null,
			parse: 'strict'
		};
		$.extend(this._defaults, this.regional['']);
	};

	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: '',
		formattedDate: '',
		formattedTime: '',
		formattedDateTime: '',
		timezoneList: null,
		units: ['hour','minute','second','millisec', 'microsec'],
		support: {},
		control: null,

		/* 
		* Override the default settings for all instances of the time picker.
		* @@param  settings  object - the new settings to use as defaults (anonymous object)
		* @@return the manager object
		*/
		setDefaults: function(settings) {
			extendRemove(this._defaults, settings || {});
			return this;
		},

		/*
		* Create a new Timepicker instance
		*/
		_newInst: function($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
            	fns = {},
		    	overrides, i;

			for (var attrName in this._defaults) {
				if(this._defaults.hasOwnProperty(attrName)){
					var attrValue = $input.attr('time:' + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue);
						} catch (err) {
							inlineSettings[attrName] = attrValue;
						}
					}
				}
			}

		    overrides = {
		        beforeShow: function (input, dp_inst) {
		            if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
		                return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst);
		            }
		        },
		        onChangeMonthYear: function (year, month, dp_inst) {
		            // Update the time as well : this prevents the time from disappearing from the $input field.
		            tp_inst._updateDateTime(dp_inst);
		            if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
		                tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst);
		            }
		        },
		        onClose: function (dateText, dp_inst) {
		            if (tp_inst.timeDefined === true &amp;amp;&amp;amp; $input.val() !== '') {
		                tp_inst._updateDateTime(dp_inst);
		            }
		            if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
		                tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst);
		            }
		        }
		    };
		    for (i in overrides) {
		        if (overrides.hasOwnProperty(i)) {
		            fns[i] = opts[i] || null;
		        }
		    }

		    tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
		        evnts:fns,
		        timepicker: tp_inst // add timepicker as a property of datepicker: $.datepicker._get(dp_inst, 'timepicker');
		    });
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function(val) {
				return val.toUpperCase();
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function(val) {
				return val.toUpperCase();
			});

			// detect which units are supported
			tp_inst.support = detectSupport(
					tp_inst._defaults.timeFormat + 
					(tp_inst._defaults.pickerTimeFormat? tp_inst._defaults.pickerTimeFormat:'') + 
					(tp_inst._defaults.altTimeFormat? tp_inst._defaults.altTimeFormat:''));

			// controlType is string - key to our this._controls
			if(typeof(tp_inst._defaults.controlType) === 'string'){
				if(tp_inst._defaults.controlType == 'slider' &amp;amp;&amp;amp; typeof(jQuery.ui.slider) === 'undefined'){
					tp_inst._defaults.controlType = 'select';
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType];
			}
			// controlType is an object and must implement create, options, value methods
			else{ 
				tp_inst.control = tp_inst._defaults.controlType;
			}

			// prep the timezone options
			var timezoneList = [-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,
					0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList;
			}
			var tzl=timezoneList.length,tzi=0,tzv=null;
			if (tzl &amp;gt; 0 &amp;amp;&amp;amp; typeof timezoneList[0] !== 'object') {
				for(; tzi&amp;lt;tzl; tzi++){
					tzv = timezoneList[tzi];
					timezoneList[tzi] = { value: tzv, label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601) };
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;

			// set the default units
			tp_inst.timezone = tp_inst._defaults.timezone !== null? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) : 
							((new Date()).getTimezoneOffset()*-1);
			tp_inst.hour = tp_inst._defaults.hour &amp;lt; tp_inst._defaults.hourMin? tp_inst._defaults.hourMin : 
							tp_inst._defaults.hour &amp;gt; tp_inst._defaults.hourMax? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute &amp;lt; tp_inst._defaults.minuteMin? tp_inst._defaults.minuteMin : 
							tp_inst._defaults.minute &amp;gt; tp_inst._defaults.minuteMax? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second &amp;lt; tp_inst._defaults.secondMin? tp_inst._defaults.secondMin : 
							tp_inst._defaults.second &amp;gt; tp_inst._defaults.secondMax? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec &amp;lt; tp_inst._defaults.millisecMin? tp_inst._defaults.millisecMin : 
							tp_inst._defaults.millisec &amp;gt; tp_inst._defaults.millisecMax? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec &amp;lt; tp_inst._defaults.microsecMin? tp_inst._defaults.microsecMin : 
							tp_inst._defaults.microsec &amp;gt; tp_inst._defaults.microsecMax? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = '';
			tp_inst.$input = $input;

			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField).css({
					cursor: 'pointer'
				}).focus(function() {
					$input.trigger("focus");
				});
			}

			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date();
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date();
			}

			// datepicker needs minDate/maxDate, timepicker needs minDateTime/maxDateTime..
			if (tp_inst._defaults.minDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime());
			}
			if (tp_inst._defaults.minDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime());
			}
			if (tp_inst._defaults.maxDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime());
			}
			if (tp_inst._defaults.maxDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime());
			}
			tp_inst.$input.bind('focus', function() {
				tp_inst._onFocus();
			});

			return tp_inst;
		},

		/*
		* add our sliders to the calendar
		*/
		_addTimePicker: function(dp_inst) {
			var currDT = (this.$altInput &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly) ? this.$input.val() + ' ' + this.$altInput.val() : this.$input.val();

			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
		},

		/*
		* parse the time string from input value or _setTime
		*/
		_parseTime: function(timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0]);
			}

			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, 'dateFormat');
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false;
					}
					$.extend(this, parseRes.timeObj);
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err +
									"\ndate/time string = " + timeString +
									"\ntimeFormat = " + this._defaults.timeFormat +
									"\ndateFormat = " + dp_dateFormat);
					return false;
				}
				return true;
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false;
				}
				$.extend(this, timeObj);
				return true;
			}
		},

		/*
		* generate and inject html for timepicker into ui datepicker
		*/
		_injectTimePicker: function() {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = '',
				uitem = '',
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i=0,
				l=0;

			// Prevent displaying twice
			if ($dp.find("div.ui-timepicker-div").length === 0 &amp;amp;&amp;amp; o.showTimepicker) {
				var noDisplay = ' style="display:none;"',
					html = '&amp;lt;div class="ui-timepicker-div'+ (o.isRTL? ' ui-timepicker-rtl' : '') +'"&amp;gt;&amp;lt;dl&amp;gt;' + '&amp;lt;dt class="ui_tpicker_time_label"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;' + o.timeText + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_time"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the markup
				for(i=0,l=this.units.length; i&amp;lt;l; i++){
					litem = this.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// Added by Peter Medeiros:
					// - Figure out what the hour/minute/second max should be based on the step values.
					// - Example: if stepMinute is 15, then minMax is 45.
					max[litem] = parseInt((o[litem+'Max'] - ((o[litem+'Max'] - o[litem+'Min']) % o['step'+uitem])), 10);
					gridSize[litem] = 0;

					html += '&amp;lt;dt class="ui_tpicker_'+ litem +'_label"' + (show ? '' : noDisplay) + '&amp;gt;' + o[litem +'Text'] + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_'+ litem +'"&amp;gt;&amp;lt;div class="ui_tpicker_'+ litem +'_slider"' + (show ? '' : noDisplay) + '&amp;gt;&amp;lt;/div&amp;gt;';

					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						html += '&amp;lt;div style="padding-left: 1px"&amp;gt;&amp;lt;table class="ui-tpicker-grid-label"&amp;gt;&amp;lt;tr&amp;gt;';

						if(litem == 'hour'){
							for (var h = o[litem+'Min']; h &amp;lt;= max[litem]; h += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm? 'hht':'HH', {hour:h}, o);									
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + tmph + '&amp;lt;/td&amp;gt;';
							}
						}
						else{
							for (var m = o[litem+'Min']; m &amp;lt;= max[litem]; m += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + ((m &amp;lt; 10) ? '0' : '') + m + '&amp;lt;/td&amp;gt;';
							}
						}

						html += '&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;&amp;lt;/div&amp;gt;';
					}
					html += '&amp;lt;/dd&amp;gt;';
				}
				
				// Timezone
				var showTz = o.showTimezone !== null? o.showTimezone : this.support.timezone;
				html += '&amp;lt;dt class="ui_tpicker_timezone_label"' + (showTz ? '' : noDisplay) + '&amp;gt;' + o.timezoneText + '&amp;lt;/dt&amp;gt;';
				html += '&amp;lt;dd class="ui_tpicker_timezone" ' + (showTz ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the elements from string
				html += '&amp;lt;/dl&amp;gt;&amp;lt;/div&amp;gt;';
				var $tp = $(html);

				// if we only want time picker...
				if (o.timeOnly === true) {
					$tp.prepend('&amp;lt;div class="ui-widget-header ui-helper-clearfix ui-corner-all"&amp;gt;' + '&amp;lt;div class="ui-datepicker-title"&amp;gt;' + o.timeOnlyTitle + '&amp;lt;/div&amp;gt;' + '&amp;lt;/div&amp;gt;');
					$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();
				}
				
				// add sliders, adjust grids, add events
				for(i=0,l=tp_inst.units.length; i&amp;lt;l; i++){
					litem = tp_inst.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// add the slider
					tp_inst[litem+'_slider'] = tp_inst.control.create(tp_inst, $tp.find('.ui_tpicker_'+litem+'_slider'), litem, tp_inst[litem], o[litem+'Min'], max[litem], o['step'+uitem]);

					// adjust the grid and add click event
					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						size = 100 * gridSize[litem] * o[litem+'Grid'] / (max[litem] - o[litem+'Min']);
						$tp.find('.ui_tpicker_'+litem+' table').css({
							width: size + "%",
							marginLeft: o.isRTL? '0' : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL? ((size / (-2 * gridSize[litem])) + "%") : '0',
							borderCollapse: 'collapse'
						}).find("td").click(function(e){
								var $t = $(this),
									h = $t.html(),
									n = parseInt(h.replace(/[^0-9]/g),10),
									ap = h.replace(/[^apm]/ig),
									f = $t.data('for'); // loses scope, so we use data-for

								if(f == 'hour'){
									if(ap.indexOf('p') !== -1 &amp;amp;&amp;amp; n &amp;lt; 12){
										n += 12;
									}
									else{
										if(ap.indexOf('a') !== -1 &amp;amp;&amp;amp; n === 12){
											n = 0;
										}
									}
								}
								
								tp_inst.control.value(tp_inst, tp_inst[f+'_slider'], litem, n);

								tp_inst._onTimeChange();
								tp_inst._onSelectHandler();
							}).css({
								cursor: 'pointer',
								width: (100 / gridSize[litem]) + '%',
								textAlign: 'center',
								overflow: 'hidden'
							});
					} // end if grid &amp;gt; 0
				} // end for loop

				// Add timezone options
				this.timezone_select = $tp.find('.ui_tpicker_timezone').append('&amp;lt;select&amp;gt;&amp;lt;/select&amp;gt;').find("select");
				$.fn.append.apply(this.timezone_select,
				$.map(o.timezoneList, function(val, idx) {
					return $("&amp;lt;option /&amp;gt;").val(typeof val == "object" ? val.value : val).text(typeof val == "object" ? val.label : val);
				}));
				if (typeof(this.timezone) != "undefined" &amp;amp;&amp;amp; this.timezone !== null &amp;amp;&amp;amp; this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset()*-1;
					if (local_timezone == this.timezone) {
						selectLocalTimezone(tp_inst);
					} else {
						this.timezone_select.val(this.timezone);
					}
				} else {
					if (typeof(this.hour) != "undefined" &amp;amp;&amp;amp; this.hour !== null &amp;amp;&amp;amp; this.hour !== "") {
						this.timezone_select.val(o.timezone);
					} else {
						selectLocalTimezone(tp_inst);
					}
				}
				this.timezone_select.change(function() {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
				});
				// End timezone options
				
				// inject timepicker into datepicker
				var $buttonPanel = $dp.find('.ui-datepicker-buttonpane');
				if ($buttonPanel.length) {
					$buttonPanel.before($tp);
				} else {
					$dp.append($tp);
				}

				this.$timeObj = $tp.find('.ui_tpicker_time');

				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined;
				}

				// slideAccess integration: http://trentrichardson.com/2011/11/11/jquery-ui-sliders-and-touch-accessibility/
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
						
					setTimeout(function() { // fix for inline mode
						if ($tp.find('.ui-slider-access').length === 0) {
							$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);

							// fix any grids since sliders are shorter
							var sliderAccessWidth = $tp.find('.ui-slider-access:eq(0)').outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find('table:visible').each(function() {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl? 'marginRight':'marginLeft').toString().replace('%', ''),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + '%',
										css = { width: newWidth, marginRight: 0, marginLeft: 0 };
									css[rtl? 'marginRight':'marginLeft'] = newMarginLeft;
									$g.css(css);
								});
							}
						}
					}, 10);
				}
				// end slideAccess integration

				tp_inst._limitMinMaxDateTime(this.inst, true);
			}
		},

		/*
		* This function tries to limit the ability to go outside the
		* min/max date range
		*/
		_limitMinMaxDateTime: function(dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);

			if (!this._defaults.showTimepicker) {
				return;
			} // No time so nothing to check here

			if ($.datepicker._get(dp_inst, 'minDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'minDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, 'minDateTime'),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin;
				}

				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour &amp;lt;= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute &amp;lt;= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second &amp;lt;= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if(this.millisec &amp;lt;= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;lt; this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin;
									}
									this._defaults.microsecMin = this.microsecMinOriginal;
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal;
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal;
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal;
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal;
				}
			}

			if ($.datepicker._get(dp_inst, 'maxDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'maxDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, 'maxDateTime'),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax;
				}

				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour &amp;gt;= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute &amp;gt;= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second &amp;gt;= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec &amp;gt;= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;gt; this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax;
									}
									this._defaults.microsecMax = this.microsecMaxOriginal;
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal;
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal;
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal;
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal;
				}
			}

			if (adjustSliders !== undefined &amp;amp;&amp;amp; adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10);
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);

				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, 'hour', { min: this._defaults.hourMin, max: hourMax });
					this.control.value(this, this.hour_slider, 'hour', this.hour - (this.hour % this._defaults.stepHour));
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, 'minute', { min: this._defaults.minuteMin, max: minMax });
					this.control.value(this, this.minute_slider, 'minute', this.minute - (this.minute % this._defaults.stepMinute));
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, 'second', { min: this._defaults.secondMin, max: secMax });
					this.control.value(this, this.second_slider, 'second', this.second - (this.second % this._defaults.stepSecond));
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, 'millisec', { min: this._defaults.millisecMin, max: millisecMax });
					this.control.value(this, this.millisec_slider, 'millisec', this.millisec - (this.millisec % this._defaults.stepMillisec));
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, 'microsec', { min: this._defaults.microsecMin, max: microsecMax });
					this.control.value(this, this.microsec_slider, 'microsec', this.microsec - (this.microsec % this._defaults.stepMicrosec));
				}
			}

		},

		/*
		* when a slider moves, set the internal time...
		* on time change is also called when the time is updated in the text field
		*/
		_onTimeChange: function() {
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, 'hour') : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, 'minute') : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, 'second') : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, 'millisec') : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, 'microsec') : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;

			if (typeof(hour) == 'object') {
				hour = false;
			}
			if (typeof(minute) == 'object') {
				minute = false;
			}
			if (typeof(second) == 'object') {
				second = false;
			}
			if (typeof(millisec) == 'object') {
				millisec = false;
			}
			if (typeof(microsec) == 'object') {
				microsec = false;
			}
			if (typeof(timezone) == 'object') {
				timezone = false;
			}

			if (hour !== false) {
				hour = parseInt(hour, 10);
			}
			if (minute !== false) {
				minute = parseInt(minute, 10);
			}
			if (second !== false) {
				second = parseInt(second, 10);
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10);
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10);
			}

			var ampm = o[hour &amp;lt; 12 ? 'amNames' : 'pmNames'][0];

			// If the update was done in the input field, the input field should not be updated.
			// If the update was done using the sliders, update the input field.
			var hasChanged = (hour != this.hour || minute != this.minute || second != this.second || millisec != this.millisec || microsec != this.microsec 
								|| (this.ampm.length &amp;gt; 0 &amp;amp;&amp;amp; (hour &amp;lt; 12) != ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) 
								|| (this.timezone !== null &amp;amp;&amp;amp; timezone != this.timezone));

			if (hasChanged) {

				if (hour !== false) {
					this.hour = hour;
				}
				if (minute !== false) {
					this.minute = minute;
				}
				if (second !== false) {
					this.second = second;
				}
				if (millisec !== false) {
					this.millisec = millisec;
				}
				if (microsec !== false) {
					this.microsec = microsec;
				}
				if (timezone !== false) {
					this.timezone = timezone;
				}

				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0]);
				}

				this._limitMinMaxDateTime(this.inst, true);
			}
			if (this.support.ampm) {
				this.ampm = ampm;
			}

			// Updates the time within the timepicker
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if(pickerTimeFormat === o.timeFormat){
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix);
				}
				else{
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix);
				}
			}

			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime();
			}
		},

		/*
		* call custom onSelect.
		* bind to sliders slidestop, and grid click.
		*/
		_onSelectHandler: function() {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect &amp;amp;&amp;amp; inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this]);
			}
		},

		/*
		* update our input with the new date time..
		*/
		_updateDateTime: function(dp_inst) {
			dp_inst = this.inst || dp_inst;
			//var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
			var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay)),
				dateFmt = $.datepicker._get(dp_inst, 'dateFormat'),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null &amp;amp;&amp;amp; this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			
			// if a slider was changed but datepicker doesn't have a value yet, set it
			if(dp_inst.lastVal===""){
                dp_inst.currentYear=dp_inst.selectedYear;
                dp_inst.currentMonth=dp_inst.selectedMonth;
                dp_inst.currentDay=dp_inst.selectedDay;
            }

			/*
			* remove following lines to force every changes in date picker to change the input value
			* Bug descriptions: when an input field has a default value, and click on the field to pop up the date picker. 
			* If the user manually empty the value in the input field, the date picker will never change selected value.
			*/
			//if (dp_inst.lastVal !== undefined &amp;amp;&amp;amp; (dp_inst.lastVal.length &amp;gt; 0 &amp;amp;&amp;amp; this.$input.val().length === 0)) {
			//	return;
			//}

			if (this._defaults.timeOnly === true) {
				formattedDateTime = this.formattedTime;
			} else if (this._defaults.timeOnly !== true &amp;amp;&amp;amp; (this._defaults.alwaysSetTime || timeAvailable)) {
				formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix;
			}

			this.formattedDateTime = formattedDateTime;

			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate);
			} else if (this.$altInput &amp;amp;&amp;amp; this._defaults.timeOnly === false &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly === true) {
				this.$altInput.val(this.formattedTime);
				this.$input.val(this.formattedDate);
			} else if (this.$altInput) {
				this.$input.val(formattedDateTime);
				var altFormattedDateTime = '',
					altSeparator = this._defaults.altSeparator ? this._defaults.altSeparator : this._defaults.separator,
					altTimeSuffix = this._defaults.altTimeSuffix ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
				
				if(!this._defaults.timeOnly){
					if (this._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg);
					}
					else{
						altFormattedDateTime = this.formattedDate;
					}

					if (altFormattedDateTime){
						altFormattedDateTime += altSeparator;
					}
				}

				if(this._defaults.altTimeFormat){
					altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix;
				}
				else{
					altFormattedDateTime += this.formattedTime + altTimeSuffix;
				}
				this.$altInput.val(altFormattedDateTime);
			} else {
				this.$input.val(formattedDateTime);
			}

			this.$input.trigger("change");
		},

		_onFocus: function() {
			if (!this.$input.val() &amp;amp;&amp;amp; this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, 'timepicker');
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst);
						} catch (err) {
							$.timepicker.log(err);
						}
					}
				}
			}
		},

		/*
		* Small abstraction to control types
		* We can add more, just be sure to follow the pattern: create, options, value
		*/
		_controls: {
			// slider methods
			slider: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var rtl = tp_inst._defaults.isRTL; // if rtl go -60-&amp;gt;0 instead of 0-&amp;gt;60
					return obj.prop('slide', null).slider({
						orientation: "horizontal",
						value: rtl? val*-1 : val,
						min: rtl? max*-1 : min,
						max: rtl? min*-1 : max,
						step: step,
						slide: function(event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl? ui.value*-1:ui.value);
							tp_inst._onTimeChange();
						},
						stop: function(event, ui) {
							tp_inst._onSelectHandler();
						}
					});	
				},
				options: function(tp_inst, obj, unit, opts, val){
					if(tp_inst._defaults.isRTL){
						if(typeof(opts) == 'string'){
							if(opts == 'min' || opts == 'max'){
								if(val !== undefined){
									return obj.slider(opts, val*-1);
								}
								return Math.abs(obj.slider(opts));
							}
							return obj.slider(opts);
						}
						var min = opts.min, 
							max = opts.max;
						opts.min = opts.max = null;
						if(min !== undefined){
							opts.max = min * -1;
						}
						if(max !== undefined){
							opts.min = max * -1;
						}
						return obj.slider(opts);
					}
					if(typeof(opts) == 'string' &amp;amp;&amp;amp; val !== undefined){
							return obj.slider(opts, val);
					}
					return obj.slider(opts);
				},
				value: function(tp_inst, obj, unit, val){
					if(tp_inst._defaults.isRTL){
						if(val !== undefined){
							return obj.slider('value', val*-1);
						}
						return Math.abs(obj.slider('value'));
					}
					if(val !== undefined){
						return obj.slider('value', val);
					}
					return obj.slider('value');
				}
			},
			// select methods
			select: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var sel = '&amp;lt;select class="ui-timepicker-select" data-unit="'+ unit +'" data-min="'+ min +'" data-max="'+ max +'" data-step="'+ step +'"&amp;gt;',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;

					for(var i=min; i&amp;lt;=max; i+=step){						
						sel += '&amp;lt;option value="'+ i +'"'+ (i==val? ' selected':'') +'&amp;gt;';
						if(unit == 'hour'){
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig,'')), {hour:i}, tp_inst._defaults);
						}
						else if(unit == 'millisec' || unit == 'microsec' || i &amp;gt;= 10){ sel += i; }
						else {sel += '0'+ i.toString(); }
						sel += '&amp;lt;/option&amp;gt;';
					}
					sel += '&amp;lt;/select&amp;gt;';

					obj.children('select').remove();

					$(sel).appendTo(obj).change(function(e){
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
					});

					return obj;
				},
				options: function(tp_inst, obj, unit, opts, val){
					var o = {},
						$t = obj.children('select');
					if(typeof(opts) == 'string'){
						if(val === undefined){
							return $t.data(opts);
						}
						o[opts] = val;	
					}
					else{ o = opts; }
					return tp_inst.control.create(tp_inst, obj, $t.data('unit'), $t.val(), o.min || $t.data('min'), o.max || $t.data('max'), o.step || $t.data('step'));
				},
				value: function(tp_inst, obj, unit, val){
					var $t = obj.children('select');
					if(val !== undefined){
						return $t.val(val);
					}
					return $t.val();
				}
			}
		} // end _controls

	});

	$.fn.extend({
		/*
		* shorthand just to use timepicker..
		*/
		timepicker: function(o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);

			if (typeof o == 'object') {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				});
			}

			return $(this).each(function() {
				$.fn.datetimepicker.apply($(this), tmp_args);
			});
		},

		/*
		* extend timepicker to datepicker
		*/
		datetimepicker: function(o) {
			o = o || {};
			var tmp_args = arguments;

			if (typeof(o) == 'string') {
				if (o == 'getDate') {
					return $.fn.datepicker.apply($(this[0]), tmp_args);
				} else {
					return this.each(function() {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args);
					});
				}
			} else {
				return this.each(function() {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults);
				});
			}
		}
	});

	/*
	* Public Utility to parse date and time
	*/
	$.datepicker.parseDateTime = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec);
		}

		return parseRes.date;
	};

	/*
	* Public utility to parse time
	*/
	$.datepicker.parseTime = function(timeFormat, timeString, options) {		
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g,'').indexOf('Z') !== -1);

		// Strict parse requires the timeString to match the timeFormat exactly
		var strictParse = function(f, s, o){

			// pattern for standard and localized AM/PM markers
			var getPatternAmpm = function(amNames, pmNames) {
				var markers = [];
				if (amNames) {
					$.merge(markers, amNames);
				}
				if (pmNames) {
					$.merge(markers, pmNames);
				}
				markers = $.map(markers, function(val) {
					return val.replace(/[.*+?|()\[\]{}\\]/g, '\\$&amp;amp;');
				});
				return '(' + markers.join('|') + ')?';
			};

			// figure out position of time elements.. cause js cant do named captures
			var getFormatPositions = function(timeFormat) {
				var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
					orders = {
						h: -1,
						m: -1,
						s: -1,
						l: -1,
						c: -1,
						t: -1,
						z: -1
					};

				if (finds) {
					for (var i = 0; i &amp;lt; finds.length; i++) {
						if (orders[finds[i].toString().charAt(0)] == -1) {
							orders[finds[i].toString().charAt(0)] = i + 1;
						}
					}
				}
				return orders;
			};

			var regstr = '^' + f.toString()
					.replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
							var ml = match.length;
							switch (match.charAt(0).toLowerCase()) {
								case 'h': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'm': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 's': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'l': return '(\\d?\\d?\\d)';
								case 'c': return '(\\d?\\d?\\d)';
								case 'z': return '(z|[-+]\\d\\d:?\\d\\d|\\S+)?';
								case 't': return getPatternAmpm(o.amNames, o.pmNames);
								default:    // literal escaped in quotes
									return '(' + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function (m) { return "\\" + m; }) + ')?';
							}
						})
					.replace(/\s/g, '\\s?') +
					o.timeSuffix + '$',
				order = getFormatPositions(f),
				ampm = '',
				treg;

			treg = s.match(new RegExp(regstr, 'i'));

			var resTime = {
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0
			};

			if (treg) {
				if (order.t !== -1) {
					if (treg[order.t] === undefined || treg[order.t].length === 0) {
						ampm = '';
						resTime.ampm = '';
					} else {
						ampm = $.inArray(treg[order.t].toUpperCase(), o.amNames) !== -1 ? 'AM' : 'PM';
						resTime.ampm = o[ampm == 'AM' ? 'amNames' : 'pmNames'][0];
					}
				}

				if (order.h !== -1) {
					if (ampm == 'AM' &amp;amp;&amp;amp; treg[order.h] == '12') {
						resTime.hour = 0; // 12am = 0 hour
					} else {
						if (ampm == 'PM' &amp;amp;&amp;amp; treg[order.h] != '12') {
							resTime.hour = parseInt(treg[order.h], 10) + 12; // 12pm = 12 hour, any other pm = hour + 12
						} else {
							resTime.hour = Number(treg[order.h]);
						}
					}
				}

				if (order.m !== -1) {
					resTime.minute = Number(treg[order.m]);
				}
				if (order.s !== -1) {
					resTime.second = Number(treg[order.s]);
				}
				if (order.l !== -1) {
					resTime.millisec = Number(treg[order.l]);
				}
				if (order.c !== -1) {
					resTime.microsec = Number(treg[order.c]);
				}
				if (order.z !== -1 &amp;amp;&amp;amp; treg[order.z] !== undefined) {
					resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z]);
				}


				return resTime;
			}
			return false;
		};// end strictParse

		// First try JS Date, if that fails, use strictParse
		var looseParse = function(f,s,o){
			try{
				var d = new Date('2012-01-01 '+ s);
				if(isNaN(d.getTime())){
					d = new Date('2012-01-01T'+ s);
					if(isNaN(d.getTime())){
						d = new Date('01/01/2012 '+ s);
						if(isNaN(d.getTime())){
							throw "Unable to parse time with native Date: "+ s;
						}
					}
				}

				return {
					hour: d.getHours(),
					minute: d.getMinutes(),
					second: d.getSeconds(),
					millisec: d.getMilliseconds(),
					microsec: d.getMicroseconds(),
					timezone: d.getTimezoneOffset()*-1
				};
			}
			catch(err){
				try{
					return strictParse(f,s,o);
				}
				catch(err2){
					$.timepicker.log("Unable to parse \ntimeString: "+ s +"\ntimeFormat: "+ f);
				}				
			}
			return false;
		}; // end looseParse
		
		if(typeof o.parse === "function"){
			return o.parse(timeFormat, timeString, o);
		}
		if(o.parse === 'loose'){
			return looseParse(timeFormat, timeString, o);
		}
		return strictParse(timeFormat, timeString, o);
	};

	/*
	* Public utility to format the time
	* format = string format of the time
	* time = a {}, not a Date() for timezones
	* options = essentially the regional[].. amNames, pmNames, ampm
	*/
	$.datepicker.formatTime = function(format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			timezone: 0
		}, time);

		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);

		if (hour &amp;gt; 11) {
			ampmName = options.pmNames[0];
		}

		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|('.*?'|".*?"))/g, function(match) {
		switch (match) {
			case 'HH':
				return ('0' + hour).slice(-2);
			case 'H':
				return hour;
			case 'hh':
				return ('0' + convert24to12(hour)).slice(-2);
			case 'h':
				return convert24to12(hour);
			case 'mm':
				return ('0' + time.minute).slice(-2);
			case 'm':
				return time.minute;
			case 'ss':
				return ('0' + time.second).slice(-2);
			case 's':
				return time.second;
			case 'l':
				return ('00' + time.millisec).slice(-3);
			case 'c':
				return ('00' + time.microsec).slice(-3);
			case 'z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, false);
			case 'Z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, true);
			case 'T': 
				return ampmName.charAt(0).toUpperCase();
			case 'TT': 
				return ampmName.toUpperCase();
			case 't':
				return ampmName.charAt(0).toLowerCase();
			case 'tt':
				return ampmName.toLowerCase();
			default:
				return match.replace(/\'/g, "") || "'";
			}
		});

		tmptime = $.trim(tmptime);
		return tmptime;
	};

	/*
	* the bad hack :/ override datepicker so it doesnt close on select
	// inspired: http://stackoverflow.com/questions/1252512/jquery-datepicker-prevent-closing-picker-when-clicking-a-date/1762378#1762378
	*/
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function(id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			tp_inst._limitMinMaxDateTime(inst, true);
			inst.inline = inst.stay_open = true;
			//This way the onSelect handler called from calendarpicker get the full dateTime
			this._base_selectDate(id, dateStr);
			inst.inline = inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst);
		} else {
			this._base_selectDate(id, dateStr);
		}
	};

	/*
	* second bad hack :/ override datepicker so it triggers an event when changing the input field
	* and does not redraw the datepicker on every selectDate event
	*/
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function(inst) {

		// don't popup the datepicker if there is another instance already opened
		var input = inst.input[0];
		if ($.datepicker._curInst &amp;amp;&amp;amp; $.datepicker._curInst != inst &amp;amp;&amp;amp; $.datepicker._datepickerShowing &amp;amp;&amp;amp; $.datepicker._lastInput != input) {
			return;
		}

		if (typeof(inst.stay_open) !== 'boolean' || inst.stay_open === false) {

			this._base_updateDatepicker(inst);

			// Reload the time control when changing something in the input text field.
			var tp_inst = this._get(inst, 'timepicker');
			if (tp_inst) {
				tp_inst._addTimePicker(inst);
			}
		}
	};

	/*
	* third bad hack :/ override datepicker so it allows spaces and colon in the input field
	*/
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if ($.datepicker._get(inst, 'constrainInput')) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null? tp_inst._defaults.showTimezone : tp_inst.support.timezone,					
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat')),
					datetimeChars = tp_inst._defaults.timeFormat.toString()
											.replace(/[hms]/g, '')
											.replace(/TT/g, ampm ? 'APM' : '')
											.replace(/Tt/g, ampm ? 'AaPpMm' : '')
											.replace(/tT/g, ampm ? 'AaPpMm' : '')
											.replace(/T/g, ampm ? 'AP' : '')
											.replace(/tt/g, ampm ? 'apm' : '')
											.replace(/t/g, ampm ? 'ap' : '') + 
											" " + tp_inst._defaults.separator + 
											tp_inst._defaults.timeSuffix + 
											(tz ? tp_inst._defaults.timezoneList.join('') : '') + 
											(tp_inst._defaults.amNames.join('')) + (tp_inst._defaults.pmNames.join('')) + 
											dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr &amp;lt; ' ' || !dateChars || datetimeChars.indexOf(chr) &amp;gt; -1);
			}
		}

		return $.datepicker._base_doKeyPress(event);
	};

	/*
	* Fourth bad hack :/ override _updateAlternate function used in inline mode to init altField
	*/
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	/* Update any alternate field to synchronise with the main field. */
	$.datepicker._updateAlternate = function(inst) {
		var tp_inst = this._get(inst, 'timepicker');
		if(tp_inst){
			var altField = tp_inst._defaults.altField;
			if (altField) { // update alternate field too
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = '', 
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator, 
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if(!tp_inst._defaults.timeOnly &amp;amp;&amp;amp; !tp_inst._defaults.altFieldTimeOnly &amp;amp;&amp;amp; date !== null){
					if(tp_inst._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime;
					}
					else{
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime;
					}
				}
				$(altField).val(altFormattedDateTime);
			}
		}
		else{
			$.datepicker._base_updateAlternate(inst);
		}
	};

	/*
	* Override key up event to sync manual input changes.
	*/
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst);
				} catch (err) {
					$.timepicker.log(err);
				}
			}
		}

		return $.datepicker._base_doKeyUp(event);
	};

	/*
	* override "Today" button to also grab the time.
	*/
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function(id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		this._base_gotoToday(id);
		var tp_inst = this._get(inst, 'timepicker');
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		$('.ui-datepicker-today', $dp).click();
	};

	/*
	* Disable &amp;amp; enable the Time in the datetimepicker
	*/
	$.datepicker._disableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst);
		}
	};

	$.datepicker._enableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst); // Could be disabled on page load
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create our own set time function
	*/
	$.datepicker._setTime = function(inst, date) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var defaults = tp_inst._defaults;

			// calling _setTime with no date sets time to defaults
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;

			//check if within min/max times.. 
			tp_inst._limitMinMaxDateTime(inst, true);

			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create new public method to set only time, callable as $().datepicker('setTime', date)
	*/
	$.datepicker._setTimeDatepicker = function(target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date == "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec);
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds());
				}
				if (tp_date.toString() == 'Invalid Date') {
					tp_date = undefined;
				}
				this._setTime(inst, tp_date);
			}
		}

	};

	/*
	* override setDate() to allow setting time too within Date object
	*/
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function(target, date) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		if(typeof(date) === 'string'){
			date = new Date(date);
			if(!date.getTime()){
				$.timepicker.log("Error creating Date object from string.");
			}
		}

		var tp_inst = this._get(inst, 'timepicker');
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds());
		} else {
			tp_date = date;
		}
		
		// This is important if you are using the timezone option, javascript's Date 
		// object will only return the timezone offset for the current locale, so we 
		// adjust it accordingly.  If not using timezone option this won't matter..
		// If a timezone is different in tp, keep the timezone as is
		if(tp_inst){
			// look out for DST if tz wasn't specified
			if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
				tp_inst.timezone = tp_date.getTimezoneOffset()*-1;
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone);
		}

		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true);
	};

	/*
	* override getDate() to allow getting time too within Date object
	*/
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function(target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			// if it hasn't yet been defined, grab from field
			if(inst.lastVal === undefined){
				this._setDateFromField(inst, noDefault);
			}

			var date = this._getDate(inst);
			if (date &amp;amp;&amp;amp; tp_inst._parseTime($(target).val(), tp_inst.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);

				// This is important if you are using the timezone option, javascript's Date 
				// object will only return the timezone offset for the current locale, so we 
				// adjust it accordingly.  If not using timezone option this won't matter..
				if(tp_inst.timezone != null){
					// look out for DST if tz wasn't specified
					if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
						tp_inst.timezone = date.getTimezoneOffset()*-1;
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
				}
			}
			return date;
		}
		return this._base_getDateDatepicker(target, noDefault);
	};

	/*
	* override parseDate() because UI 1.8.14 throws an error about "Extra characters"
	* An option in datapicker to ignore extra format characters would be nicer.
	*/
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function(format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings);
		} catch (err) {
			// Hack!  The error message ends with a colon, a space, and
			// the "extra" characters.  We rely on that instead of
			// attempting to perfectly reproduce the parsing algorithm.
			if (err.indexOf(":") &amp;gt;= 0) {
				date = this._base_parseDate(format, value.substring(0,value.length-(err.length-err.indexOf(':')-2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format);
			} else {
				throw err;
			}
		}
		return date;
	};

	/*
	* override formatDate to set date with time to the input
	*/
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function(inst, day, month, year) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val();
		}
		return this._base_formatDate(inst);
	};

	/*
	* override options setter to add time to maxDate(Time) and minDate(Time). MaxDate
	*/
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function(target, name, value) {
		var inst = this._getInst(target),
	        name_clone;
		if (!inst) {
			return null;
		}

		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop;
		    if (typeof name == 'string') { // if min/max was set with the string
		        if (name === 'minDate' || name === 'minDateTime') {
		            min = value;
		        } else if (name === 'maxDate' || name === 'maxDateTime') {
		            max = value;
		        } else if (name === 'onSelect') {
		            onselect = value;
		        } else if (overrides.hasOwnProperty(name)) {
		            if (typeof (value) === 'undefined') {
		                return overrides[name];
		            }
		            fns[name] = value;
		            name_clone = {}; //empty results in exiting function after overrides updated
		        }
		    } else if (typeof name == 'object') { //if min/max was set with the JSON
		        if (name.minDate) {
		            min = name.minDate;
		        } else if (name.minDateTime) {
		            min = name.minDateTime;
		        } else if (name.maxDate) {
		            max = name.maxDate;
		        } else if (name.maxDateTime) {
		            max = name.maxDateTime;
		        }
		        for (prop in overrides) {
		            if (overrides.hasOwnProperty(prop) &amp;amp;&amp;amp; name[prop]) {
		                fns[prop] = name[prop];
		            }
		        }
		    }
		    for (prop in fns) {
		        if (fns.hasOwnProperty(prop)) {
		            overrides[prop] = fns[prop];
		            if (!name_clone) { name_clone = $.extend({}, name);}
		            delete name_clone[prop];
		        }
		    }
		    if (name_clone &amp;amp;&amp;amp; isEmptyObject(name_clone)) { return; }
		    if (min) { //if min was set
		        if (min === 0) {
		            min = new Date();
		        } else {
		            min = new Date(min);
		        }
		        tp_inst._defaults.minDate = min;
		        tp_inst._defaults.minDateTime = min;
		    } else if (max) { //if max was set
		        if (max === 0) {
		            max = new Date();
		        } else {
		            max = new Date(max);
		        }
		        tp_inst._defaults.maxDate = max;
		        tp_inst._defaults.maxDateTime = max;
		    } else if (onselect) {
		        tp_inst._defaults.onSelect = onselect;
		    }
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name);
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
	};
	
	/*
	* jQuery isEmptyObject does not check hasOwnProperty - if someone has added to the object prototype,
	* it will return false for all objects
	*/
	var isEmptyObject = function(obj) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(obj)) {
				return false;
			}
		}
		return true;
	};

	/*
	* jQuery extend now ignores nulls!
	*/
	var extendRemove = function(target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] === null || props[name] === undefined) {
				target[name] = props[name];
			}
		}
		return target;
	};

	/*
	* Determine by the time format which units are supported
	* Returns an object of booleans for each unit
	*/
	var detectSupport = function(timeFormat){
		var tf = timeFormat.replace(/\'.*?\'/g,'').toLowerCase(), // removes literals
			isIn = function(f, t){ // does the format contain the token?
					return f.indexOf(t) !== -1? true:false; 
				};
		return {
				hour: isIn(tf,'h'),
				minute: isIn(tf,'m'),
				second: isIn(tf,'s'),
				millisec: isIn(tf,'l'),
				microsec: isIn(tf,'c'),
				timezone: isIn(tf,'z'),
				ampm: isIn(tf,'t') &amp;amp;&amp;amp; isIn(timeFormat,'h'),
				iso8601: isIn(timeFormat, 'Z')
			};
	};

	/*
	* Converts 24 hour format into 12 hour
	* Returns 12 hour without leading 0
	*/
	var convert24to12 = function(hour) {
		if (hour &amp;gt; 12) {
			hour = hour - 12;
		}

		if (hour === 0) {
			hour = 12;
		}

		return String(hour);
	};

	/*
	* Splits datetime string into date ans time substrings.
	* Throws exception when date can't be parsed
	* Returns [dateString, timeString]
	*/
	var splitDateTime = function(dateFormat, dateTimeString, dateSettings, timeSettings) {
		try {
			// The idea is to get the number separator occurances in datetime and the time format requested (since time has 
			// fewer unknowns, mostly numbers and am/pm). We will use the time pattern to split.
			var separator = timeSettings &amp;amp;&amp;amp; timeSettings.separator ? timeSettings.separator : $.timepicker._defaults.separator,
				format = timeSettings &amp;amp;&amp;amp; timeSettings.timeFormat ? timeSettings.timeFormat : $.timepicker._defaults.timeFormat,
				timeParts = format.split(separator), // how many occurances of separator may be in our format?
				timePartsLen = timeParts.length,
				allParts = dateTimeString.split(separator),
				allPartsLen = allParts.length;

			if (allPartsLen &amp;gt; 1) {
				return [
						allParts.splice(0,allPartsLen-timePartsLen).join(separator),
						allParts.splice(0,timePartsLen).join(separator)
					];
			}

		} catch (err) {
			$.timepicker.log('Could not split the date from the time. Please check the following datetimepicker options' +
					"\nthrown error: " + err +
					"\ndateTimeString" + dateTimeString +
					"\ndateFormat = " + dateFormat +
					"\nseparator = " + timeSettings.separator +
					"\ntimeFormat = " + timeSettings.timeFormat);

			if (err.indexOf(":") &amp;gt;= 0) {
				// Hack!  The error message ends with a colon, a space, and
				// the "extra" characters.  We rely on that instead of
				// attempting to perfectly reproduce the parsing algorithm.
				var dateStringLength = dateTimeString.length - (err.length - err.indexOf(':') - 2),
					timeString = dateTimeString.substring(dateStringLength);

				return [$.trim(dateTimeString.substring(0, dateStringLength)), $.trim(dateTimeString.substring(dateStringLength))];

			} else {
				throw err;
			}
		}
		return [dateTimeString, ''];
	};

	/*
	* Internal function to parse datetime interval
	* Returns: {date: Date, timeObj: Object}, where
	*   date - parsed date without time (type Date)
	*   timeObj = {hour: , minute: , second: , millisec: , microsec: } - parsed time. Optional
	*/
	var parseDateTimeInternal = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var date;
		var splitRes = splitDateTime(dateFormat, dateTimeString, dateSettings, timeSettings);
		date = $.datepicker._base_parseDate(dateFormat, splitRes[0], dateSettings);
		if (splitRes[1] !== '') {
			var timeString = splitRes[1],
				parsedTime = $.datepicker.parseTime(timeFormat, timeString, timeSettings);

			if (parsedTime === null) {
				throw 'Wrong time format';
			}
			return {
				date: date,
				timeObj: parsedTime
			};
		} else {
			return {
				date: date
			};
		}
	};

	/*
	* Internal function to set timezone_select to the local timezone
	*/
	var selectLocalTimezone = function(tp_inst, date) {
		if (tp_inst &amp;amp;&amp;amp; tp_inst.timezone_select) {
			var now = typeof date !== 'undefined' ? date : new Date();
			tp_inst.timezone_select.val(now.getTimezoneOffset()*-1);
		}
	};

	/*
	* Create a Singleton Insance
	*/
	$.timepicker = new Timepicker();

	/**
	 * Get the timezone offset as string from a date object (eg '+0530' for UTC+5.5)
	 * @@param  number if not a number this value is returned
	 * @@param boolean if true formats in accordance to iso8601 "+12:45"
	 * @@return string
	 */
	$.timepicker.timezoneOffsetString = function(tzMinutes, iso8601) {
		if(isNaN(tzMinutes) || tzMinutes &amp;gt; 840){
			return tzMinutes;
		}

		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601? ':':'',
			tz = (off &amp;gt;= 0 ? '+' : '-') + ('0' + (hours * 101).toString()).slice(-2) + iso + ('0' + (minutes * 101).toString()).slice(-2);
		
		if(tz == '+00:00'){
			return 'Z';
		}
		return tz;
	};

	/**
	 * Get the number in minutes that represents a timezone string
	 * @@param  string formated like "+0500", "-1245"
	 * @@return number
	 */
	$.timepicker.timezoneOffsetNumber = function(tzString) {
		tzString = tzString.toString().replace(':',''); // excuse any iso8601, end up with "+1245"

		if(tzString.toUpperCase() === 'Z'){ // if iso8601 with Z, its 0 minute offset
			return 0;
		}

		if(!/^(\-|\+)\d{4}$/.test(tzString)){ // possibly a user defined tz, so just give it back
			return tzString;
		}

		return ((tzString.substr(0,1) =='-'? -1 : 1) * // plus or minus
					((parseInt(tzString.substr(1,2),10)*60) + // hours (converted to minutes)
					parseInt(tzString.substr(3,2),10))); // minutes
	};

	/**
	 * No way to set timezone in js Date, so we must adjust the minutes to compensate. (think setDate, getDate)
	 * @@param  date
	 * @@param  string formated like "+0500", "-1245"
	 * @@return date
	 */
	$.timepicker.timezoneAdjust = function(date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if(!isNaN(toTz)){
			date.setMinutes(date.getMinutes()*1 + (date.getTimezoneOffset()*-1 - toTz*1) );
		}
		return date;
	};

	/**
	 * Calls `timepicker()` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * n.b. The input value must be correctly formatted (reformatting is not supported)
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the timepicker() call
	 * @@return jQuery
	 */
	$.timepicker.timeRange = function(startTime, endTime, options) {
		return $.timepicker.handleRange('timepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datetimepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@return jQuery
	 */
	$.timepicker.datetimeRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datetimepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.dateRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.handleRange = function(method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0, // min allowed interval in milliseconds
			maxInterval: 0, // max allowed interval in milliseconds
			start: {},      // options for start picker
			end: {}         // options for end picker
		}, options);

		$.fn[method].call(startTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), endTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), endTime, 'minDate');
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), startTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), startTime, 'maxDate');
			}
		}, options, options.end));

		checkDates(startTime, endTime);
		selected(startTime, endTime, 'minDate');
		selected(endTime, startTime, 'maxDate');

		function checkDates(changed, other) {
			var startdt = startTime[method]('getDate'),
				enddt = endTime[method]('getDate'),
				changeddt = changed[method]('getDate');

			if(startdt !== null){
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());

				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);

				if(options.minInterval &amp;gt; 0 &amp;amp;&amp;amp; minDate &amp;gt; enddt){ // minInterval check
					endTime[method]('setDate',minDate);
				}
				else if(options.maxInterval &amp;gt; 0 &amp;amp;&amp;amp; maxDate &amp;lt; enddt){ // max interval check
					endTime[method]('setDate',maxDate);
				}
				else if (startdt &amp;gt; enddt) {
					other[method]('setDate',changeddt);
				}
			}
		}

		function selected(changed, other, option) {
			if (!changed.val()) {
				return;
			}
			var date = changed[method].call(changed, 'getDate');
			if(date !== null &amp;amp;&amp;amp; options.minInterval &amp;gt; 0){
				if(option == 'minDate'){
					date.setMilliseconds(date.getMilliseconds() + options.minInterval); 
				}
				if(option == 'maxDate'){
					date.setMilliseconds(date.getMilliseconds() - options.minInterval);
				}
			}
			if (date.getTime) {
				other[method].call(other, 'option', option, date);
			}
		}
		return $([startTime.get(0), endTime.get(0)]);
	};

	/**
	 * Log error or data to the console during error or debugging
	 * @@param  Object err pass any type object to log to the console during error or debugging
	 * @@return void
	 */
	$.timepicker.log = function(err){
		if(window.console){
			console.log(err);
		}
	};

	/*
	* Microsecond support
	*/
	if(!Date.prototype.getMicroseconds){
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function(){ return this.microseconds; };
		Date.prototype.setMicroseconds = function(m){ 
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m/1000));
			this.microseconds = m%1000;
			return this;
		};
	}

	/*
	* Keep up with the version
	*/
	$.timepicker.version = "1.3.1";

})(jQuery);
jQuery.noConflict();
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;datetimepicker-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;e73a652e-09fc-4c71-8e7a-e2525a2d2a99&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
function replaceAllString(oriStr, strTarget, strSubString ){
   var strText = oriStr;
   var intIndexOfMatch = strText.indexOf( strTarget );
   while (intIndexOfMatch != -1){
      strText = strText.replace( strTarget, strSubString )
      intIndexOfMatch = strText.indexOf( strTarget );
   }
   return( strText );
}
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&amp;amp;]" + name + "=([^&amp;amp;#]*)"),
    results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
};


   var jobName= getParameterByName('job')
   var fromDate= getParameterByName('fromDate')
   var toDate= getParameterByName('toDate')
   var limit= getParameterByName('limit')
   var selectedIstIid = getParameterByName('IstIid')

  $("#jobname").ready(function(){
   $("#jobname").text(jobName)
   var convertedJobName = replaceAllString(jobName, ".", "_")
   $("#IstIid" + convertedJobName).ready(function(){
     $("#IstIid" + convertedJobName).css("display","block")
     $("#select_" + convertedJobName).ready(function(){
        $("#select_" + convertedJobName).val(selectedIstIid)
     });
   });
 });

  $("#fromDate").ready(function(){
   $("#from-date").val(fromDate)
 });

  $("#toDate").ready(function(){
   $("#to-date").val(toDate)
 });

  $("#limit").ready(function(){
   if(limit!=""){
    $("#limit").val(limit)
   }
 });
 // Get data with ajax
 function ajax_getData(jobName,fromDate,toDate,limit ){
       var convertedJobName = replaceAllString(jobName, ".", "_")
       var istIid = $("#select_" + convertedJobName).val()
       window.location="/xwiki/bin/view/WiperDog/WebHome?job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid="+istIid;
 			/*$.ajax({
			 type: "GET",
			 url:"/xwiki/bin/get/Sandbox/DescriptionForJob?outputSyntax=plain&amp;amp;job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid"+selectedIstIid,
			 success : function(result){
				$("#jobname").html(jobName)
				$("#display").text('[[]]' + result)
			 }
		   });*/
 }
	$("#treemenu2 a").click(function(){
		 var limit = 10
		 var fromDate=""
		 var toDate = ""
		 jobName= $(this).text()
                 $("#jobname").html(jobName)
                 var convertedJobName = replaceAllString(jobName, ".", "_")
                 $("#listIstIid &amp;gt; div").css("display","none")
                 $("#IstIid" + convertedJobName).css("display","block")
		 //ajax_getData(jobName,fromDate,toDate,limit )

	});

	$("#from-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
		dateFormat: 'yy-mm-dd',
	});
	$("#to-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
			dateFormat: 'yy-mm-dd',

	});
	 $("#get-data").on("click",function(){
		var fromDate = $("#from-date").val()
		var toDate =  $("#to-date").val()
		 if( toDate!= "" ){
			  if(fromDate != ""){
				  if($("#from-date").datepicker( "getDate" ) &amp;gt; $("#to-date").datepicker( "getDate" )){
				  alert("'From date' cannot start later than 'To date'")
				  return false
				  }
			  }
		 }
		 limit = $("#limit").val()
		 ajax_getData(jobName,fromDate,toDate,limit )
	});
$(document).ready(function(){

  var dataModelUrl = '/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job='+jobName+'&amp;amp;limit='
       +limit+'&amp;amp;fromDate='+fromDate + '&amp;amp;toDate='+toDate+'&amp;amp;pager=pager2&amp;amp;genp=1&amp;amp;istIid='+selectedIstIid 
       var jqxhr = $.getJSON(dataModelUrl, function(data) {
//       alert('Data: ' + data)
       $("#livetableList").jqGrid(data);
       $("#livetableList").jqGrid('navGrid', "#livetablePager", {
           edit : false,
           add : false,
           del : false
         });
       })
});
        
jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;process&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;881686cc-1bfc-456e-b8ab-71334c4a45e5&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){

$(function () {
    function drawLineChart(xAxis, series, container, data_detail){
        var dataXAxis = xAxis
        var dataSeries = series
        var detail = data_detail

			$('#containerline' + container).highcharts({

				chart: {
					type:'line'
				},
				title: {
					text: container
				},
				tooltip :{
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				xAxis: dataXAxis ,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				series: dataSeries
			});
		};

		function drawBarChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerbar' + container).highcharts({
				chart: {
					type: 'column'
				},
				title: {
					text: container
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {

					column: {
						pointPadding: 0.2,
						borderWidth: 0
					}
				},
				series: dataSeries
			});
		}

		function drawAreaChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail
			$('#containerarea' + container).highcharts({
				chart: {
					type: 'area'
				},
				title: {
					text: container
				},
				subtitle: {
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					},
					labels: {
						formatter: function() {
							return this.value / 1000;
						}
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {
					area: {
						stacking: 'normal',
						lineColor: '#666666',
						lineWidth: 1,
						marker: {
							lineWidth: 1,
							lineColor: '#666666'
						}
					}
				},
				series: dataSeries
			});
		};

		function drawPieChart(data, container){
			var dataPie = data
			$(document).ready(function () {
				// Build the chart
				$('#container' + container).highcharts({
					chart: {
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: dataPie[0].name
					},
					tooltip: {
						pointFormat: '{series.name}: &amp;lt;b&amp;gt;{point.percentage:.1f}%&amp;lt;/b&amp;gt;'
					},
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							dataLabels: {
								enabled: false
							},
							showInLegend: true
						}
					},
					series: dataPie
				});
			});
		}

		// LINE
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonline_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonline");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Line chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						if(data_all[0][i].series[0].name == null){
							data_all[0][i].series[0].name = lstContainer[0][i]
						}
						drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
					}
				}
			}
		});

		// BAR
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonbar_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonbar");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Bar chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						drawBarChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
					}
				}
			}
		});

		// AREA
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonarea_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonarea");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				// data to display on tooltip
				var data_detail = data_all[0]
				// draw Area Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					drawAreaChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
				}
			}
		});

		// PIE
		$("#piechart").ready(function(){

			var array = $("#jsons&amp;gt;.jsonpie");
			var arrayContainer = $("#jsons&amp;gt;.lstcontainerpie");
			var lstContainer = [];
			var data_all = [];
			for(var i=0;i&amp;lt;array.length;i++){
				data_all[i] = jQuery.parseJSON(array[i].value)
				lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)

			}
			if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
				// data to display on tooltip
				// draw Pie Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					var finalData = []
					finalData[0] = data_all[0][i]
					drawPieChart(finalData, lstContainer[0][i])
				}
			}
		});
	});
	jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;d5873d92-b78b-42fc-9407-46d166204b88&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;/* css for timepicker */
.ui-timepicker-div .ui-widget-header { 
margin-bottom: 8px;
 }

.ui-timepicker-div dl { text-align: left; }
.ui-timepicker-div dl dt { height: 25px; margin-bottom: -25px; }
.ui-timepicker-div dl dd { margin: 0 10px 10px 65px; }
.ui-timepicker-div td { font-size: 90%; }
.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }

.ui-timepicker-rtl{ direction: rtl; }
.ui-timepicker-rtl dl { text-align: right; }
.ui-timepicker-rtl dl dd { margin: 0 65px 10px 10px; }
#ui-datepicker-div{
 position:relative;
 width:auto;
 height:auto
}
&lt;/code&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;datetimepicker -css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;1201fb1a-e9c1-4731-8c74-2ea8c0071959&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;.displayblock {
  border:2px solid;
  -webkit-border-radius:6px;
  background:gray;
  float: left;
  width:100%;
}

.displaypie {
  border:1px solid;
  -webkit-border-radius:6px;
  background:gray;
  width: 48%;
  float: left; 
  height: 300px;
}

.subtype {
  margin-top: 50px;
  font-size: 2em;
  color: red;
}&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;content&gt;{{include document="Lib.DataToDrawChart"/}}
{{include document="Lib.MongoDBConnection"/}}
{{velocity}}
$xwiki.jsx.use('Lib.JQueryUILib')
$xwiki.ssx.use('Lib.MenuGenerator')
$xwiki.jsx.use('Lib.MenuGenerator')
$xwiki.ssx.use('Lib.JQueryUILib')
{{/velocity}}
{{include document="Lib.MenuGenerator"/}}
{{html wiki="true" clean="false"}}
&amp;lt;div id="viewer"&amp;gt;
&amp;lt;table style="text-align:left"  &amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th &amp;gt;Job name&amp;lt;/th&amp;gt;
  &amp;lt;td colspan=3&amp;gt;&amp;lt;div id="jobname"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
{{groovy}}
import org.xwiki.context.*

def ec = services.component.getInstance(Execution.class).getContext()
def mapJobIstIid = ec.getProperty("mapJobIstIid")

println '{{html clean="false" wiki="false"}}'
println '&amp;lt;tr&amp;gt;'
println '&amp;lt;th&amp;gt;IstIid&amp;lt;/th&amp;gt;'
println '&amp;lt;td colspan=3&amp;gt;'
mapJobIstIid.each{jobEntry-&amp;gt;
  def convertedJobKey = jobEntry.key.replaceAll("\\.","_")
  println "&amp;lt;div id='listIstIid'&amp;gt;"
  println "&amp;lt;div id=IstIid${convertedJobKey} style='display:none'&amp;gt;"
  println "&amp;lt;select id=select_${convertedJobKey}&amp;gt;"
  jobEntry.value.each{
     println "&amp;lt;option value=\"$it\"&amp;gt;$it&amp;lt;/option&amp;gt;"
  }
  println "&amp;lt;/select&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
}
println '&amp;lt;/td&amp;gt;'
println '&amp;lt;/tr&amp;gt;'
println '{{/html}}'
{{/groovy}}
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data monitor from&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="from-date" id="from-date"/&amp;gt;&amp;lt;/td&amp;gt;
  &amp;lt;th&amp;gt;Data monitor to&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="to-date" id="to-date"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data records limit &amp;lt;/th&amp;gt;
  &amp;lt;td &amp;gt;
     &amp;lt;select id="limit"&amp;gt;
       &amp;lt;option value=5&amp;gt;5&amp;lt;/option&amp;gt;
       &amp;lt;option value=10&amp;gt;10&amp;lt;/option&amp;gt;
       &amp;lt;option value=15&amp;gt;15&amp;lt;/option&amp;gt;
       &amp;lt;option value=20&amp;gt;20&amp;lt;/option&amp;gt;
     &amp;lt;/select&amp;gt;
  &amp;lt;/td&amp;gt;
  &amp;lt;td colspan=3 &amp;gt;&amp;lt;input type="button" value="View Data" id="get-data" class="button"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;
    &amp;lt;table id="livetableList"&amp;gt;&amp;lt;tr&amp;gt;&amp;lt;td&amp;gt;livetableList&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;
    &amp;lt;div id="livetablePager"&amp;gt;livetablePager&amp;lt;/div&amp;gt;
&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;&amp;lt;div id="display"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
&amp;lt;/table&amp;gt;

&amp;lt;/div&amp;gt; 
 &amp;lt;/body&amp;gt;

{{/html}}
{{groovy}}
import groovy.json.*
xwiki.jsx.use("Lib.Highcharts")

if(request.xpage == "plain") {
	response.setContentType('text/plain')
}

def listData = []
def job = request.get("job")
def fromDate = request.get("fromDate")
def toDate = request.get("toDate")
def limit= (request.get("limit")!=null)?request.get("limit").toInteger():10
def istIid = request.get("IstIid")

def str= "No data to retrieved !"
def result = null
if(job != "" &amp;amp;&amp;amp; job != null &amp;amp;&amp;amp; istIid != null &amp;amp;&amp;amp; istIid != ""){
	MongoDBConnection.getConnection()
	if(fromDate != "" || toDate != ""){
		result = MongoDBConnection.getDataInPeriod(job,fromDate,toDate,limit,istIid)
	} else {
		result = MongoDBConnection.getDataAllFields(job,limit,istIid)
        }
MongoDBConnection.closeConnection()
} else {
   println "{{warning}}There are no selected job or IstIid{{/warning}}"
}

if( (result != null) &amp;amp;&amp;amp; (result.size() &amp;gt; 0) &amp;amp;&amp;amp; (result[0].KEYEXPR != null)&amp;amp;&amp;amp;!(result[0].KEYEXPR instanceof List )){
if(result[0].type == "Subtyped") {
    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
    def dataSubtype = DataToDrawChart.getDataToDrawSubtype(result)
    def listKey = []
    dataSubtype.each {key,value -&amp;gt;
        listKey.add(key)
    }
    def jsonkey = com.mongodb.util.JSON.serialize(listKey)
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$jsonkey&amp;lt;/textarea&amp;gt;"

    dataSubtype.each {key,value -&amp;gt;
        def dataLine = []
        def dataBar = []
        def dataPie = []
        def dataArea = []
        if(DataToDrawChart.getDataToDrawLine(value) != []) {
            dataLine = DataToDrawChart.getDataToDrawLine(value)
        }
        if(DataToDrawChart.getDataToDrawBar(value) != []) {
            dataBar = DataToDrawChart.getDataToDrawBar(value)
        }
        if(DataToDrawChart.getDataToDrawPie(value) != []) {
            dataPie = DataToDrawChart.getDataToDrawPie(value)
        }
        if(DataToDrawChart.getDataToDrawArea(value) != []) {
            dataArea = DataToDrawChart.getDataToDrawArea(value)
        }

        def chartColumnsLine
        def chartColumnsBar 
        def chartColumnsArea 
        def lstName
        if(dataLine.size() &amp;gt; 0 ){
            chartColumnsLine = dataLine[0].chart_columns
        }
        if(dataBar.size() &amp;gt; 0){
            chartColumnsBar = dataBar[0].chart_columns
        }
        if(dataArea.size() &amp;gt; 0 ){
            chartColumnsArea = dataArea[0].chart_columns
        }
        if(dataPie.size() &amp;gt; 0 ){
            lstName = dataPie['name']
        }

        def tmpListNameContainer = []
	for(def nameContainer in lstName){
	   nameContainer = nameContainer.replaceAll("\\.", "_")
	   tmpListNameContainer.add(nameContainer)
	}
        def jsonPie
        def jsonLine
	def jsonBar
        def jsonArea
        if(dataPie != []) {
	    jsonPie = com.mongodb.util.JSON.serialize(dataPie)
        }
        if(dataLine != []) {
	    jsonLine = com.mongodb.util.JSON.serialize(dataLine)
        }
        if(dataBar != []) {
            jsonBar = com.mongodb.util.JSON.serialize(dataBar)
        }
        if(dataArea != []) {
	    jsonArea = com.mongodb.util.JSON.serialize(dataArea)
        }

	def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
	def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
	def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
	def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

	println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
        if(jsonLine != null) {
	    println "&amp;lt;textarea id=\"jsonline_$key\" &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;" 
        }
	if(jsonBar != null) {
            println "&amp;lt;textarea id=\"jsonbar_$key\"&amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
 	    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
        }
        if(jsonPie != null) {
	    println "&amp;lt;textarea id=\"jsonpie_$key\" &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
        }
        if(jsonArea != null) {
	    println "&amp;lt;textarea id=\"jsonarea_$key\" &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"
	    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
        }

	println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
	println "&amp;lt;input style=\"display:none\" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;"
	println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
	println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'
	println "&amp;lt;/div&amp;gt;"
	  
	def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
	def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
	  
	println "&amp;lt;div style='clear:both'&amp;gt;"
        def description = value.KEYEXPR._description[0][key]
        if(description != null) {
            println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +': ' + description +'&amp;lt;/div&amp;gt;'
        } else {
            println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +'&amp;lt;/div&amp;gt;'
        }
        println "-----"
        if(jsonPie != null) {
	  println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
	  lstName.each{
	    def tmp = it.replaceAll("\\.", "_")
	    println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
        if(jsonLine != null) {
	  def chartLineComment = false
	  chartColumnsLine.each{
	    if(!chartLineComment){
	       println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	       chartLineComment = true  
	    }

	      println " &amp;lt;div class=\"displayblock\" id=\"containerline${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
        println "&amp;amp;nbsp;"

        if(jsonBar != null) {
	  def chartBarComment = false
	  chartColumnsBar.each{
	     if(!chartBarComment){
	        println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	        chartBarComment = true
	      }  

	     println " &amp;lt;div class=\"displayblock\" id=\"containerbar${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
	println "&amp;amp;nbsp;"

        if(jsonArea != null) {
	  def chartAreaComment = false
	  chartColumnsArea.each{
	  if(!chartAreaComment){
	    println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	    chartAreaComment = true
	  }
	    println " &amp;lt;div class=\"displayblock\" id=\"containerarea${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
	println "&amp;lt;/div&amp;gt;"
        
    }
    println '&amp;lt;/body&amp;gt;'
    println '{{/html}}'
} else if(result[0].type == "Store") {
    // data store
    def dataLine = DataToDrawChart.getDataToDrawLine(result)
    def dataBar = DataToDrawChart.getDataToDrawBar(result)
    def dataPie = DataToDrawChart.getDataToDrawPie(result)
    def dataArea = DataToDrawChart.getDataToDrawArea(result)
    def chartColumnsLine 
    def chartColumnsBar 
    def chartColumnsArea 
    def lstName 

    if(dataLine.size() &amp;gt; 0 ){
        chartColumnsLine = dataLine[0].chart_columns
    }
    if(dataBar.size() &amp;gt; 0){
        chartColumnsBar = dataBar[0].chart_columns
    }
    if(dataArea.size() &amp;gt; 0 ){
        chartColumnsArea = dataArea[0].chart_columns
    }
    if(dataPie.size() &amp;gt; 0 ){
        lstName = dataPie['name']
    }

    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
  
    def tmpListNameContainer = []
    for(def nameContainer in lstName){
       nameContainer = nameContainer.replaceAll("\\.", "_")
       tmpListNameContainer.add(nameContainer)
    }
  
    def jsonPie = com.mongodb.util.JSON.serialize(dataPie)
    def jsonLine = com.mongodb.util.JSON.serialize(dataLine)
    def jsonBar = com.mongodb.util.JSON.serialize(dataBar)
    def jsonArea = com.mongodb.util.JSON.serialize(dataArea)

    def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
    def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
    def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
    def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

    def listEmpty = com.mongodb.util.JSON.serialize([])
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$listEmpty&amp;lt;/textarea&amp;gt;" 

    println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'

    println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
    println "&amp;lt;textarea class='jsonline' &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonbar' &amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonpie' &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonarea' &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"

    println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
  
    def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
    def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
  
    println "&amp;lt;div style='clear:both'&amp;gt;"
  
    def chartPieComment = false
    lstName.each{
        if(!chartPieComment) {
            println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
            chartPieComment = true
        }
        def tmp = it.replaceAll("\\.", "_")
        println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    def chartLineComment = false
    chartColumnsLine.each{
    if(!chartLineComment){
        println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
        chartLineComment = true  
    }

    println " &amp;lt;div class=\"displayblock\" id=\"containerline$it\"&amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    println "&amp;amp;nbsp;"
    def chartBarComment = false
    chartColumnsBar.each{
        if(!chartBarComment){
            println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
            chartBarComment = true
        }  

    println " &amp;lt;div class=\"displayblock\" id=\"containerbar$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
  println "&amp;lt;/div&amp;gt;"
  println "&amp;amp;nbsp;"
  def chartAreaComment = false
  chartColumnsArea.each{
  if(!chartAreaComment){
    println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
    chartAreaComment = true
  }
    println " &amp;lt;div class=\"displayblock\" id=\"containerarea$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
  println "&amp;lt;/div&amp;gt;"
println "&amp;lt;/div&amp;gt;"

println '&amp;lt;/body&amp;gt;'
println '{{/html}}'
}
}else{
    println 'There is no data for this job with criterias'
}
{{/groovy}}
{{html wiki="true" clean="false"}}
&amp;lt;table id="livetableList"&amp;gt;&amp;lt;/table&amp;gt;
&amp;lt;div id="livetablePager"&amp;gt;&amp;lt;/div&amp;gt;
{{/html}}
&lt;/content&gt;&lt;/xwikidoc&gt;@


46.1
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376391632000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;46.1&lt;/version&gt;
d2429 1
a2429 1
       alert('Data: ' + data)
@


45.1
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376391526000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;45.1&lt;/version&gt;
@


44.1
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376391479000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376380949000&lt;/contentUpdateDate&gt;
&lt;version&gt;44.1&lt;/version&gt;
d3500 6
a3505 1
{{/groovy}}&lt;/content&gt;&lt;/xwikidoc&gt;
@


43.1
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376382048000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;43.1&lt;/version&gt;
a2422 14
                 
                 /** Get livetable data */
                 //alert('job = ' + $("#jobname").text() + ',   istIid  = '+ selectedIstIid)
                 var dataModelUrl = '/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job='+$("#jobname").text()+'&amp;amp;limit='
                     +$("#limit").text()+'&amp;amp;fromDate='
	             +fromDate + '&amp;amp;toDate=' + toDate +   '&amp;amp;pager=pager2&amp;amp;genp=1&amp;amp;istIid='+selectedIstIid
		 var jqxhr = $.getJSON(dataModelUrl, function(data) {
				$("#livetableList").jqGrid(data);
				$("#livetableList").jqGrid('navGrid', "#livetablePager", {
				    edit : false,
				    add : false,
				    del : false
				});
			})
d2424 14
@


42.5
log
@@
text
@&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xwikidoc&gt;
&lt;web&gt;WiperDog&lt;/web&gt;
&lt;name&gt;WebHome&lt;/name&gt;
&lt;language&gt;&lt;/language&gt;
&lt;defaultLanguage&gt;en&lt;/defaultLanguage&gt;
&lt;translation&gt;0&lt;/translation&gt;
&lt;parent&gt;&lt;/parent&gt;
&lt;creator&gt;XWiki.Admin&lt;/creator&gt;
&lt;author&gt;XWiki.Admin&lt;/author&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;contentAuthor&gt;XWiki.Admin&lt;/contentAuthor&gt;
&lt;creationDate&gt;1376364375000&lt;/creationDate&gt;
&lt;date&gt;1376380949000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376380949000&lt;/contentUpdateDate&gt;
&lt;version&gt;42.5&lt;/version&gt;
&lt;title&gt;WiperDog&lt;/title&gt;
&lt;defaultTemplate&gt;&lt;/defaultTemplate&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;comment&gt;&lt;/comment&gt;
&lt;minorEdit&gt;true&lt;/minorEdit&gt;
&lt;syntaxId&gt;xwiki/2.1&lt;/syntaxId&gt;
&lt;hidden&gt;false&lt;/hidden&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;047293a8-524d-45e4-af52-cd944523d5d0&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
/*
 * jQuery timepicker addon
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 1.3.1
 * Last Modified: 07/07/2013
 *
 * Copyright 2013 Trent Richardson
 * You may use this project under MIT or GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 */

/*jslint evil: true, white: false, undef: false, nomen: false */

(function($) {

	/*
	* Lets not redefine timepicker, Prevent "Uncaught RangeError: Maximum call stack size exceeded"
	*/
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return;
	}

	/*
	* Extend jQueryUI, get it started with our version number
	*/
	$.extend($.ui, {
		timepicker: {
			version: "1.3.1"
		}
	});

	/* 
	* Timepicker manager.
	* Use the singleton instance of this class, $.timepicker, to interact with the time picker.
	* Settings for (groups of) time pickers are maintained in an instance object,
	* allowing multiple different settings on the same page.
	*/
	var Timepicker = function() {
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[''] = { // Default regional settings
			currentText: 'Now',
			closeText: 'Done',
			amNames: ['AM', 'A'],
			pmNames: ['PM', 'P'],
			timeFormat: 'HH:mm',
			timeSuffix: '',
			timeOnlyTitle: 'Choose Time',
			timeText: 'Time',
			hourText: 'Hour',
			minuteText: 'Minute',
			secondText: 'Second',
			millisecText: 'Millisecond',
			microsecText: 'Microsecond',
			timezoneText: 'Time Zone',
			isRTL: false
		};
		this._defaults = { // Global defaults for all the datetime picker instances
			showButtonPanel: true,
			timeOnly: false,
			showHour: null,
			showMinute: null,
			showSecond: null,
			showMillisec: null,
			showMicrosec: null,
			showTimezone: null,
			showTime: true,
			stepHour: 1,
			stepMinute: 1,
			stepSecond: 1,
			stepMillisec: 1,
			stepMicrosec: 1,
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null,
			hourMin: 0,
			minuteMin: 0,
			secondMin: 0,
			millisecMin: 0,
			microsecMin: 0,
			hourMax: 23,
			minuteMax: 59,
			secondMax: 59,
			millisecMax: 999,
			microsecMax: 999,
			minDateTime: null,
			maxDateTime: null,
			onSelect: null,
			hourGrid: 0,
			minuteGrid: 0,
			secondGrid: 0,
			millisecGrid: 0,
			microsecGrid: 0,
			alwaysSetTime: true,
			separator: ' ',
			altFieldTimeOnly: true,
			altTimeFormat: null,
			altSeparator: null,
			altTimeSuffix: null,
			pickerTimeFormat: null,
			pickerTimeSuffix: null,
			showTimepicker: true,
			timezoneList: null,
			addSliderAccess: false,
			sliderAccessArgs: null,
			controlType: 'slider',
			defaultValue: null,
			parse: 'strict'
		};
		$.extend(this._defaults, this.regional['']);
	};

	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: '',
		formattedDate: '',
		formattedTime: '',
		formattedDateTime: '',
		timezoneList: null,
		units: ['hour','minute','second','millisec', 'microsec'],
		support: {},
		control: null,

		/* 
		* Override the default settings for all instances of the time picker.
		* @@param  settings  object - the new settings to use as defaults (anonymous object)
		* @@return the manager object
		*/
		setDefaults: function(settings) {
			extendRemove(this._defaults, settings || {});
			return this;
		},

		/*
		* Create a new Timepicker instance
		*/
		_newInst: function($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
            	fns = {},
		    	overrides, i;

			for (var attrName in this._defaults) {
				if(this._defaults.hasOwnProperty(attrName)){
					var attrValue = $input.attr('time:' + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue);
						} catch (err) {
							inlineSettings[attrName] = attrValue;
						}
					}
				}
			}

		    overrides = {
		        beforeShow: function (input, dp_inst) {
		            if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
		                return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst);
		            }
		        },
		        onChangeMonthYear: function (year, month, dp_inst) {
		            // Update the time as well : this prevents the time from disappearing from the $input field.
		            tp_inst._updateDateTime(dp_inst);
		            if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
		                tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst);
		            }
		        },
		        onClose: function (dateText, dp_inst) {
		            if (tp_inst.timeDefined === true &amp;amp;&amp;amp; $input.val() !== '') {
		                tp_inst._updateDateTime(dp_inst);
		            }
		            if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
		                tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst);
		            }
		        }
		    };
		    for (i in overrides) {
		        if (overrides.hasOwnProperty(i)) {
		            fns[i] = opts[i] || null;
		        }
		    }

		    tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
		        evnts:fns,
		        timepicker: tp_inst // add timepicker as a property of datepicker: $.datepicker._get(dp_inst, 'timepicker');
		    });
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function(val) {
				return val.toUpperCase();
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function(val) {
				return val.toUpperCase();
			});

			// detect which units are supported
			tp_inst.support = detectSupport(
					tp_inst._defaults.timeFormat + 
					(tp_inst._defaults.pickerTimeFormat? tp_inst._defaults.pickerTimeFormat:'') + 
					(tp_inst._defaults.altTimeFormat? tp_inst._defaults.altTimeFormat:''));

			// controlType is string - key to our this._controls
			if(typeof(tp_inst._defaults.controlType) === 'string'){
				if(tp_inst._defaults.controlType == 'slider' &amp;amp;&amp;amp; typeof(jQuery.ui.slider) === 'undefined'){
					tp_inst._defaults.controlType = 'select';
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType];
			}
			// controlType is an object and must implement create, options, value methods
			else{ 
				tp_inst.control = tp_inst._defaults.controlType;
			}

			// prep the timezone options
			var timezoneList = [-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,
					0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList;
			}
			var tzl=timezoneList.length,tzi=0,tzv=null;
			if (tzl &amp;gt; 0 &amp;amp;&amp;amp; typeof timezoneList[0] !== 'object') {
				for(; tzi&amp;lt;tzl; tzi++){
					tzv = timezoneList[tzi];
					timezoneList[tzi] = { value: tzv, label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601) };
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;

			// set the default units
			tp_inst.timezone = tp_inst._defaults.timezone !== null? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) : 
							((new Date()).getTimezoneOffset()*-1);
			tp_inst.hour = tp_inst._defaults.hour &amp;lt; tp_inst._defaults.hourMin? tp_inst._defaults.hourMin : 
							tp_inst._defaults.hour &amp;gt; tp_inst._defaults.hourMax? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute &amp;lt; tp_inst._defaults.minuteMin? tp_inst._defaults.minuteMin : 
							tp_inst._defaults.minute &amp;gt; tp_inst._defaults.minuteMax? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second &amp;lt; tp_inst._defaults.secondMin? tp_inst._defaults.secondMin : 
							tp_inst._defaults.second &amp;gt; tp_inst._defaults.secondMax? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec &amp;lt; tp_inst._defaults.millisecMin? tp_inst._defaults.millisecMin : 
							tp_inst._defaults.millisec &amp;gt; tp_inst._defaults.millisecMax? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec &amp;lt; tp_inst._defaults.microsecMin? tp_inst._defaults.microsecMin : 
							tp_inst._defaults.microsec &amp;gt; tp_inst._defaults.microsecMax? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = '';
			tp_inst.$input = $input;

			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField).css({
					cursor: 'pointer'
				}).focus(function() {
					$input.trigger("focus");
				});
			}

			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date();
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date();
			}

			// datepicker needs minDate/maxDate, timepicker needs minDateTime/maxDateTime..
			if (tp_inst._defaults.minDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime());
			}
			if (tp_inst._defaults.minDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime());
			}
			if (tp_inst._defaults.maxDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime());
			}
			if (tp_inst._defaults.maxDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime());
			}
			tp_inst.$input.bind('focus', function() {
				tp_inst._onFocus();
			});

			return tp_inst;
		},

		/*
		* add our sliders to the calendar
		*/
		_addTimePicker: function(dp_inst) {
			var currDT = (this.$altInput &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly) ? this.$input.val() + ' ' + this.$altInput.val() : this.$input.val();

			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
		},

		/*
		* parse the time string from input value or _setTime
		*/
		_parseTime: function(timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0]);
			}

			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, 'dateFormat');
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false;
					}
					$.extend(this, parseRes.timeObj);
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err +
									"\ndate/time string = " + timeString +
									"\ntimeFormat = " + this._defaults.timeFormat +
									"\ndateFormat = " + dp_dateFormat);
					return false;
				}
				return true;
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false;
				}
				$.extend(this, timeObj);
				return true;
			}
		},

		/*
		* generate and inject html for timepicker into ui datepicker
		*/
		_injectTimePicker: function() {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = '',
				uitem = '',
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i=0,
				l=0;

			// Prevent displaying twice
			if ($dp.find("div.ui-timepicker-div").length === 0 &amp;amp;&amp;amp; o.showTimepicker) {
				var noDisplay = ' style="display:none;"',
					html = '&amp;lt;div class="ui-timepicker-div'+ (o.isRTL? ' ui-timepicker-rtl' : '') +'"&amp;gt;&amp;lt;dl&amp;gt;' + '&amp;lt;dt class="ui_tpicker_time_label"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;' + o.timeText + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_time"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the markup
				for(i=0,l=this.units.length; i&amp;lt;l; i++){
					litem = this.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// Added by Peter Medeiros:
					// - Figure out what the hour/minute/second max should be based on the step values.
					// - Example: if stepMinute is 15, then minMax is 45.
					max[litem] = parseInt((o[litem+'Max'] - ((o[litem+'Max'] - o[litem+'Min']) % o['step'+uitem])), 10);
					gridSize[litem] = 0;

					html += '&amp;lt;dt class="ui_tpicker_'+ litem +'_label"' + (show ? '' : noDisplay) + '&amp;gt;' + o[litem +'Text'] + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_'+ litem +'"&amp;gt;&amp;lt;div class="ui_tpicker_'+ litem +'_slider"' + (show ? '' : noDisplay) + '&amp;gt;&amp;lt;/div&amp;gt;';

					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						html += '&amp;lt;div style="padding-left: 1px"&amp;gt;&amp;lt;table class="ui-tpicker-grid-label"&amp;gt;&amp;lt;tr&amp;gt;';

						if(litem == 'hour'){
							for (var h = o[litem+'Min']; h &amp;lt;= max[litem]; h += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm? 'hht':'HH', {hour:h}, o);									
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + tmph + '&amp;lt;/td&amp;gt;';
							}
						}
						else{
							for (var m = o[litem+'Min']; m &amp;lt;= max[litem]; m += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + ((m &amp;lt; 10) ? '0' : '') + m + '&amp;lt;/td&amp;gt;';
							}
						}

						html += '&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;&amp;lt;/div&amp;gt;';
					}
					html += '&amp;lt;/dd&amp;gt;';
				}
				
				// Timezone
				var showTz = o.showTimezone !== null? o.showTimezone : this.support.timezone;
				html += '&amp;lt;dt class="ui_tpicker_timezone_label"' + (showTz ? '' : noDisplay) + '&amp;gt;' + o.timezoneText + '&amp;lt;/dt&amp;gt;';
				html += '&amp;lt;dd class="ui_tpicker_timezone" ' + (showTz ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the elements from string
				html += '&amp;lt;/dl&amp;gt;&amp;lt;/div&amp;gt;';
				var $tp = $(html);

				// if we only want time picker...
				if (o.timeOnly === true) {
					$tp.prepend('&amp;lt;div class="ui-widget-header ui-helper-clearfix ui-corner-all"&amp;gt;' + '&amp;lt;div class="ui-datepicker-title"&amp;gt;' + o.timeOnlyTitle + '&amp;lt;/div&amp;gt;' + '&amp;lt;/div&amp;gt;');
					$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();
				}
				
				// add sliders, adjust grids, add events
				for(i=0,l=tp_inst.units.length; i&amp;lt;l; i++){
					litem = tp_inst.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// add the slider
					tp_inst[litem+'_slider'] = tp_inst.control.create(tp_inst, $tp.find('.ui_tpicker_'+litem+'_slider'), litem, tp_inst[litem], o[litem+'Min'], max[litem], o['step'+uitem]);

					// adjust the grid and add click event
					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						size = 100 * gridSize[litem] * o[litem+'Grid'] / (max[litem] - o[litem+'Min']);
						$tp.find('.ui_tpicker_'+litem+' table').css({
							width: size + "%",
							marginLeft: o.isRTL? '0' : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL? ((size / (-2 * gridSize[litem])) + "%") : '0',
							borderCollapse: 'collapse'
						}).find("td").click(function(e){
								var $t = $(this),
									h = $t.html(),
									n = parseInt(h.replace(/[^0-9]/g),10),
									ap = h.replace(/[^apm]/ig),
									f = $t.data('for'); // loses scope, so we use data-for

								if(f == 'hour'){
									if(ap.indexOf('p') !== -1 &amp;amp;&amp;amp; n &amp;lt; 12){
										n += 12;
									}
									else{
										if(ap.indexOf('a') !== -1 &amp;amp;&amp;amp; n === 12){
											n = 0;
										}
									}
								}
								
								tp_inst.control.value(tp_inst, tp_inst[f+'_slider'], litem, n);

								tp_inst._onTimeChange();
								tp_inst._onSelectHandler();
							}).css({
								cursor: 'pointer',
								width: (100 / gridSize[litem]) + '%',
								textAlign: 'center',
								overflow: 'hidden'
							});
					} // end if grid &amp;gt; 0
				} // end for loop

				// Add timezone options
				this.timezone_select = $tp.find('.ui_tpicker_timezone').append('&amp;lt;select&amp;gt;&amp;lt;/select&amp;gt;').find("select");
				$.fn.append.apply(this.timezone_select,
				$.map(o.timezoneList, function(val, idx) {
					return $("&amp;lt;option /&amp;gt;").val(typeof val == "object" ? val.value : val).text(typeof val == "object" ? val.label : val);
				}));
				if (typeof(this.timezone) != "undefined" &amp;amp;&amp;amp; this.timezone !== null &amp;amp;&amp;amp; this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset()*-1;
					if (local_timezone == this.timezone) {
						selectLocalTimezone(tp_inst);
					} else {
						this.timezone_select.val(this.timezone);
					}
				} else {
					if (typeof(this.hour) != "undefined" &amp;amp;&amp;amp; this.hour !== null &amp;amp;&amp;amp; this.hour !== "") {
						this.timezone_select.val(o.timezone);
					} else {
						selectLocalTimezone(tp_inst);
					}
				}
				this.timezone_select.change(function() {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
				});
				// End timezone options
				
				// inject timepicker into datepicker
				var $buttonPanel = $dp.find('.ui-datepicker-buttonpane');
				if ($buttonPanel.length) {
					$buttonPanel.before($tp);
				} else {
					$dp.append($tp);
				}

				this.$timeObj = $tp.find('.ui_tpicker_time');

				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined;
				}

				// slideAccess integration: http://trentrichardson.com/2011/11/11/jquery-ui-sliders-and-touch-accessibility/
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
						
					setTimeout(function() { // fix for inline mode
						if ($tp.find('.ui-slider-access').length === 0) {
							$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);

							// fix any grids since sliders are shorter
							var sliderAccessWidth = $tp.find('.ui-slider-access:eq(0)').outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find('table:visible').each(function() {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl? 'marginRight':'marginLeft').toString().replace('%', ''),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + '%',
										css = { width: newWidth, marginRight: 0, marginLeft: 0 };
									css[rtl? 'marginRight':'marginLeft'] = newMarginLeft;
									$g.css(css);
								});
							}
						}
					}, 10);
				}
				// end slideAccess integration

				tp_inst._limitMinMaxDateTime(this.inst, true);
			}
		},

		/*
		* This function tries to limit the ability to go outside the
		* min/max date range
		*/
		_limitMinMaxDateTime: function(dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);

			if (!this._defaults.showTimepicker) {
				return;
			} // No time so nothing to check here

			if ($.datepicker._get(dp_inst, 'minDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'minDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, 'minDateTime'),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin;
				}

				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour &amp;lt;= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute &amp;lt;= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second &amp;lt;= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if(this.millisec &amp;lt;= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;lt; this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin;
									}
									this._defaults.microsecMin = this.microsecMinOriginal;
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal;
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal;
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal;
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal;
				}
			}

			if ($.datepicker._get(dp_inst, 'maxDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'maxDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, 'maxDateTime'),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax;
				}

				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour &amp;gt;= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute &amp;gt;= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second &amp;gt;= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec &amp;gt;= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;gt; this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax;
									}
									this._defaults.microsecMax = this.microsecMaxOriginal;
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal;
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal;
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal;
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal;
				}
			}

			if (adjustSliders !== undefined &amp;amp;&amp;amp; adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10);
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);

				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, 'hour', { min: this._defaults.hourMin, max: hourMax });
					this.control.value(this, this.hour_slider, 'hour', this.hour - (this.hour % this._defaults.stepHour));
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, 'minute', { min: this._defaults.minuteMin, max: minMax });
					this.control.value(this, this.minute_slider, 'minute', this.minute - (this.minute % this._defaults.stepMinute));
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, 'second', { min: this._defaults.secondMin, max: secMax });
					this.control.value(this, this.second_slider, 'second', this.second - (this.second % this._defaults.stepSecond));
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, 'millisec', { min: this._defaults.millisecMin, max: millisecMax });
					this.control.value(this, this.millisec_slider, 'millisec', this.millisec - (this.millisec % this._defaults.stepMillisec));
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, 'microsec', { min: this._defaults.microsecMin, max: microsecMax });
					this.control.value(this, this.microsec_slider, 'microsec', this.microsec - (this.microsec % this._defaults.stepMicrosec));
				}
			}

		},

		/*
		* when a slider moves, set the internal time...
		* on time change is also called when the time is updated in the text field
		*/
		_onTimeChange: function() {
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, 'hour') : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, 'minute') : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, 'second') : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, 'millisec') : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, 'microsec') : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;

			if (typeof(hour) == 'object') {
				hour = false;
			}
			if (typeof(minute) == 'object') {
				minute = false;
			}
			if (typeof(second) == 'object') {
				second = false;
			}
			if (typeof(millisec) == 'object') {
				millisec = false;
			}
			if (typeof(microsec) == 'object') {
				microsec = false;
			}
			if (typeof(timezone) == 'object') {
				timezone = false;
			}

			if (hour !== false) {
				hour = parseInt(hour, 10);
			}
			if (minute !== false) {
				minute = parseInt(minute, 10);
			}
			if (second !== false) {
				second = parseInt(second, 10);
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10);
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10);
			}

			var ampm = o[hour &amp;lt; 12 ? 'amNames' : 'pmNames'][0];

			// If the update was done in the input field, the input field should not be updated.
			// If the update was done using the sliders, update the input field.
			var hasChanged = (hour != this.hour || minute != this.minute || second != this.second || millisec != this.millisec || microsec != this.microsec 
								|| (this.ampm.length &amp;gt; 0 &amp;amp;&amp;amp; (hour &amp;lt; 12) != ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) 
								|| (this.timezone !== null &amp;amp;&amp;amp; timezone != this.timezone));

			if (hasChanged) {

				if (hour !== false) {
					this.hour = hour;
				}
				if (minute !== false) {
					this.minute = minute;
				}
				if (second !== false) {
					this.second = second;
				}
				if (millisec !== false) {
					this.millisec = millisec;
				}
				if (microsec !== false) {
					this.microsec = microsec;
				}
				if (timezone !== false) {
					this.timezone = timezone;
				}

				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0]);
				}

				this._limitMinMaxDateTime(this.inst, true);
			}
			if (this.support.ampm) {
				this.ampm = ampm;
			}

			// Updates the time within the timepicker
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if(pickerTimeFormat === o.timeFormat){
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix);
				}
				else{
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix);
				}
			}

			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime();
			}
		},

		/*
		* call custom onSelect.
		* bind to sliders slidestop, and grid click.
		*/
		_onSelectHandler: function() {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect &amp;amp;&amp;amp; inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this]);
			}
		},

		/*
		* update our input with the new date time..
		*/
		_updateDateTime: function(dp_inst) {
			dp_inst = this.inst || dp_inst;
			//var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
			var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay)),
				dateFmt = $.datepicker._get(dp_inst, 'dateFormat'),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null &amp;amp;&amp;amp; this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			
			// if a slider was changed but datepicker doesn't have a value yet, set it
			if(dp_inst.lastVal===""){
                dp_inst.currentYear=dp_inst.selectedYear;
                dp_inst.currentMonth=dp_inst.selectedMonth;
                dp_inst.currentDay=dp_inst.selectedDay;
            }

			/*
			* remove following lines to force every changes in date picker to change the input value
			* Bug descriptions: when an input field has a default value, and click on the field to pop up the date picker. 
			* If the user manually empty the value in the input field, the date picker will never change selected value.
			*/
			//if (dp_inst.lastVal !== undefined &amp;amp;&amp;amp; (dp_inst.lastVal.length &amp;gt; 0 &amp;amp;&amp;amp; this.$input.val().length === 0)) {
			//	return;
			//}

			if (this._defaults.timeOnly === true) {
				formattedDateTime = this.formattedTime;
			} else if (this._defaults.timeOnly !== true &amp;amp;&amp;amp; (this._defaults.alwaysSetTime || timeAvailable)) {
				formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix;
			}

			this.formattedDateTime = formattedDateTime;

			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate);
			} else if (this.$altInput &amp;amp;&amp;amp; this._defaults.timeOnly === false &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly === true) {
				this.$altInput.val(this.formattedTime);
				this.$input.val(this.formattedDate);
			} else if (this.$altInput) {
				this.$input.val(formattedDateTime);
				var altFormattedDateTime = '',
					altSeparator = this._defaults.altSeparator ? this._defaults.altSeparator : this._defaults.separator,
					altTimeSuffix = this._defaults.altTimeSuffix ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
				
				if(!this._defaults.timeOnly){
					if (this._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg);
					}
					else{
						altFormattedDateTime = this.formattedDate;
					}

					if (altFormattedDateTime){
						altFormattedDateTime += altSeparator;
					}
				}

				if(this._defaults.altTimeFormat){
					altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix;
				}
				else{
					altFormattedDateTime += this.formattedTime + altTimeSuffix;
				}
				this.$altInput.val(altFormattedDateTime);
			} else {
				this.$input.val(formattedDateTime);
			}

			this.$input.trigger("change");
		},

		_onFocus: function() {
			if (!this.$input.val() &amp;amp;&amp;amp; this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, 'timepicker');
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst);
						} catch (err) {
							$.timepicker.log(err);
						}
					}
				}
			}
		},

		/*
		* Small abstraction to control types
		* We can add more, just be sure to follow the pattern: create, options, value
		*/
		_controls: {
			// slider methods
			slider: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var rtl = tp_inst._defaults.isRTL; // if rtl go -60-&amp;gt;0 instead of 0-&amp;gt;60
					return obj.prop('slide', null).slider({
						orientation: "horizontal",
						value: rtl? val*-1 : val,
						min: rtl? max*-1 : min,
						max: rtl? min*-1 : max,
						step: step,
						slide: function(event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl? ui.value*-1:ui.value);
							tp_inst._onTimeChange();
						},
						stop: function(event, ui) {
							tp_inst._onSelectHandler();
						}
					});	
				},
				options: function(tp_inst, obj, unit, opts, val){
					if(tp_inst._defaults.isRTL){
						if(typeof(opts) == 'string'){
							if(opts == 'min' || opts == 'max'){
								if(val !== undefined){
									return obj.slider(opts, val*-1);
								}
								return Math.abs(obj.slider(opts));
							}
							return obj.slider(opts);
						}
						var min = opts.min, 
							max = opts.max;
						opts.min = opts.max = null;
						if(min !== undefined){
							opts.max = min * -1;
						}
						if(max !== undefined){
							opts.min = max * -1;
						}
						return obj.slider(opts);
					}
					if(typeof(opts) == 'string' &amp;amp;&amp;amp; val !== undefined){
							return obj.slider(opts, val);
					}
					return obj.slider(opts);
				},
				value: function(tp_inst, obj, unit, val){
					if(tp_inst._defaults.isRTL){
						if(val !== undefined){
							return obj.slider('value', val*-1);
						}
						return Math.abs(obj.slider('value'));
					}
					if(val !== undefined){
						return obj.slider('value', val);
					}
					return obj.slider('value');
				}
			},
			// select methods
			select: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var sel = '&amp;lt;select class="ui-timepicker-select" data-unit="'+ unit +'" data-min="'+ min +'" data-max="'+ max +'" data-step="'+ step +'"&amp;gt;',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;

					for(var i=min; i&amp;lt;=max; i+=step){						
						sel += '&amp;lt;option value="'+ i +'"'+ (i==val? ' selected':'') +'&amp;gt;';
						if(unit == 'hour'){
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig,'')), {hour:i}, tp_inst._defaults);
						}
						else if(unit == 'millisec' || unit == 'microsec' || i &amp;gt;= 10){ sel += i; }
						else {sel += '0'+ i.toString(); }
						sel += '&amp;lt;/option&amp;gt;';
					}
					sel += '&amp;lt;/select&amp;gt;';

					obj.children('select').remove();

					$(sel).appendTo(obj).change(function(e){
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
					});

					return obj;
				},
				options: function(tp_inst, obj, unit, opts, val){
					var o = {},
						$t = obj.children('select');
					if(typeof(opts) == 'string'){
						if(val === undefined){
							return $t.data(opts);
						}
						o[opts] = val;	
					}
					else{ o = opts; }
					return tp_inst.control.create(tp_inst, obj, $t.data('unit'), $t.val(), o.min || $t.data('min'), o.max || $t.data('max'), o.step || $t.data('step'));
				},
				value: function(tp_inst, obj, unit, val){
					var $t = obj.children('select');
					if(val !== undefined){
						return $t.val(val);
					}
					return $t.val();
				}
			}
		} // end _controls

	});

	$.fn.extend({
		/*
		* shorthand just to use timepicker..
		*/
		timepicker: function(o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);

			if (typeof o == 'object') {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				});
			}

			return $(this).each(function() {
				$.fn.datetimepicker.apply($(this), tmp_args);
			});
		},

		/*
		* extend timepicker to datepicker
		*/
		datetimepicker: function(o) {
			o = o || {};
			var tmp_args = arguments;

			if (typeof(o) == 'string') {
				if (o == 'getDate') {
					return $.fn.datepicker.apply($(this[0]), tmp_args);
				} else {
					return this.each(function() {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args);
					});
				}
			} else {
				return this.each(function() {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults);
				});
			}
		}
	});

	/*
	* Public Utility to parse date and time
	*/
	$.datepicker.parseDateTime = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec);
		}

		return parseRes.date;
	};

	/*
	* Public utility to parse time
	*/
	$.datepicker.parseTime = function(timeFormat, timeString, options) {		
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g,'').indexOf('Z') !== -1);

		// Strict parse requires the timeString to match the timeFormat exactly
		var strictParse = function(f, s, o){

			// pattern for standard and localized AM/PM markers
			var getPatternAmpm = function(amNames, pmNames) {
				var markers = [];
				if (amNames) {
					$.merge(markers, amNames);
				}
				if (pmNames) {
					$.merge(markers, pmNames);
				}
				markers = $.map(markers, function(val) {
					return val.replace(/[.*+?|()\[\]{}\\]/g, '\\$&amp;amp;');
				});
				return '(' + markers.join('|') + ')?';
			};

			// figure out position of time elements.. cause js cant do named captures
			var getFormatPositions = function(timeFormat) {
				var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
					orders = {
						h: -1,
						m: -1,
						s: -1,
						l: -1,
						c: -1,
						t: -1,
						z: -1
					};

				if (finds) {
					for (var i = 0; i &amp;lt; finds.length; i++) {
						if (orders[finds[i].toString().charAt(0)] == -1) {
							orders[finds[i].toString().charAt(0)] = i + 1;
						}
					}
				}
				return orders;
			};

			var regstr = '^' + f.toString()
					.replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
							var ml = match.length;
							switch (match.charAt(0).toLowerCase()) {
								case 'h': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'm': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 's': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'l': return '(\\d?\\d?\\d)';
								case 'c': return '(\\d?\\d?\\d)';
								case 'z': return '(z|[-+]\\d\\d:?\\d\\d|\\S+)?';
								case 't': return getPatternAmpm(o.amNames, o.pmNames);
								default:    // literal escaped in quotes
									return '(' + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function (m) { return "\\" + m; }) + ')?';
							}
						})
					.replace(/\s/g, '\\s?') +
					o.timeSuffix + '$',
				order = getFormatPositions(f),
				ampm = '',
				treg;

			treg = s.match(new RegExp(regstr, 'i'));

			var resTime = {
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0
			};

			if (treg) {
				if (order.t !== -1) {
					if (treg[order.t] === undefined || treg[order.t].length === 0) {
						ampm = '';
						resTime.ampm = '';
					} else {
						ampm = $.inArray(treg[order.t].toUpperCase(), o.amNames) !== -1 ? 'AM' : 'PM';
						resTime.ampm = o[ampm == 'AM' ? 'amNames' : 'pmNames'][0];
					}
				}

				if (order.h !== -1) {
					if (ampm == 'AM' &amp;amp;&amp;amp; treg[order.h] == '12') {
						resTime.hour = 0; // 12am = 0 hour
					} else {
						if (ampm == 'PM' &amp;amp;&amp;amp; treg[order.h] != '12') {
							resTime.hour = parseInt(treg[order.h], 10) + 12; // 12pm = 12 hour, any other pm = hour + 12
						} else {
							resTime.hour = Number(treg[order.h]);
						}
					}
				}

				if (order.m !== -1) {
					resTime.minute = Number(treg[order.m]);
				}
				if (order.s !== -1) {
					resTime.second = Number(treg[order.s]);
				}
				if (order.l !== -1) {
					resTime.millisec = Number(treg[order.l]);
				}
				if (order.c !== -1) {
					resTime.microsec = Number(treg[order.c]);
				}
				if (order.z !== -1 &amp;amp;&amp;amp; treg[order.z] !== undefined) {
					resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z]);
				}


				return resTime;
			}
			return false;
		};// end strictParse

		// First try JS Date, if that fails, use strictParse
		var looseParse = function(f,s,o){
			try{
				var d = new Date('2012-01-01 '+ s);
				if(isNaN(d.getTime())){
					d = new Date('2012-01-01T'+ s);
					if(isNaN(d.getTime())){
						d = new Date('01/01/2012 '+ s);
						if(isNaN(d.getTime())){
							throw "Unable to parse time with native Date: "+ s;
						}
					}
				}

				return {
					hour: d.getHours(),
					minute: d.getMinutes(),
					second: d.getSeconds(),
					millisec: d.getMilliseconds(),
					microsec: d.getMicroseconds(),
					timezone: d.getTimezoneOffset()*-1
				};
			}
			catch(err){
				try{
					return strictParse(f,s,o);
				}
				catch(err2){
					$.timepicker.log("Unable to parse \ntimeString: "+ s +"\ntimeFormat: "+ f);
				}				
			}
			return false;
		}; // end looseParse
		
		if(typeof o.parse === "function"){
			return o.parse(timeFormat, timeString, o);
		}
		if(o.parse === 'loose'){
			return looseParse(timeFormat, timeString, o);
		}
		return strictParse(timeFormat, timeString, o);
	};

	/*
	* Public utility to format the time
	* format = string format of the time
	* time = a {}, not a Date() for timezones
	* options = essentially the regional[].. amNames, pmNames, ampm
	*/
	$.datepicker.formatTime = function(format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			timezone: 0
		}, time);

		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);

		if (hour &amp;gt; 11) {
			ampmName = options.pmNames[0];
		}

		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|('.*?'|".*?"))/g, function(match) {
		switch (match) {
			case 'HH':
				return ('0' + hour).slice(-2);
			case 'H':
				return hour;
			case 'hh':
				return ('0' + convert24to12(hour)).slice(-2);
			case 'h':
				return convert24to12(hour);
			case 'mm':
				return ('0' + time.minute).slice(-2);
			case 'm':
				return time.minute;
			case 'ss':
				return ('0' + time.second).slice(-2);
			case 's':
				return time.second;
			case 'l':
				return ('00' + time.millisec).slice(-3);
			case 'c':
				return ('00' + time.microsec).slice(-3);
			case 'z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, false);
			case 'Z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, true);
			case 'T': 
				return ampmName.charAt(0).toUpperCase();
			case 'TT': 
				return ampmName.toUpperCase();
			case 't':
				return ampmName.charAt(0).toLowerCase();
			case 'tt':
				return ampmName.toLowerCase();
			default:
				return match.replace(/\'/g, "") || "'";
			}
		});

		tmptime = $.trim(tmptime);
		return tmptime;
	};

	/*
	* the bad hack :/ override datepicker so it doesnt close on select
	// inspired: http://stackoverflow.com/questions/1252512/jquery-datepicker-prevent-closing-picker-when-clicking-a-date/1762378#1762378
	*/
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function(id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			tp_inst._limitMinMaxDateTime(inst, true);
			inst.inline = inst.stay_open = true;
			//This way the onSelect handler called from calendarpicker get the full dateTime
			this._base_selectDate(id, dateStr);
			inst.inline = inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst);
		} else {
			this._base_selectDate(id, dateStr);
		}
	};

	/*
	* second bad hack :/ override datepicker so it triggers an event when changing the input field
	* and does not redraw the datepicker on every selectDate event
	*/
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function(inst) {

		// don't popup the datepicker if there is another instance already opened
		var input = inst.input[0];
		if ($.datepicker._curInst &amp;amp;&amp;amp; $.datepicker._curInst != inst &amp;amp;&amp;amp; $.datepicker._datepickerShowing &amp;amp;&amp;amp; $.datepicker._lastInput != input) {
			return;
		}

		if (typeof(inst.stay_open) !== 'boolean' || inst.stay_open === false) {

			this._base_updateDatepicker(inst);

			// Reload the time control when changing something in the input text field.
			var tp_inst = this._get(inst, 'timepicker');
			if (tp_inst) {
				tp_inst._addTimePicker(inst);
			}
		}
	};

	/*
	* third bad hack :/ override datepicker so it allows spaces and colon in the input field
	*/
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if ($.datepicker._get(inst, 'constrainInput')) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null? tp_inst._defaults.showTimezone : tp_inst.support.timezone,					
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat')),
					datetimeChars = tp_inst._defaults.timeFormat.toString()
											.replace(/[hms]/g, '')
											.replace(/TT/g, ampm ? 'APM' : '')
											.replace(/Tt/g, ampm ? 'AaPpMm' : '')
											.replace(/tT/g, ampm ? 'AaPpMm' : '')
											.replace(/T/g, ampm ? 'AP' : '')
											.replace(/tt/g, ampm ? 'apm' : '')
											.replace(/t/g, ampm ? 'ap' : '') + 
											" " + tp_inst._defaults.separator + 
											tp_inst._defaults.timeSuffix + 
											(tz ? tp_inst._defaults.timezoneList.join('') : '') + 
											(tp_inst._defaults.amNames.join('')) + (tp_inst._defaults.pmNames.join('')) + 
											dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr &amp;lt; ' ' || !dateChars || datetimeChars.indexOf(chr) &amp;gt; -1);
			}
		}

		return $.datepicker._base_doKeyPress(event);
	};

	/*
	* Fourth bad hack :/ override _updateAlternate function used in inline mode to init altField
	*/
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	/* Update any alternate field to synchronise with the main field. */
	$.datepicker._updateAlternate = function(inst) {
		var tp_inst = this._get(inst, 'timepicker');
		if(tp_inst){
			var altField = tp_inst._defaults.altField;
			if (altField) { // update alternate field too
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = '', 
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator, 
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if(!tp_inst._defaults.timeOnly &amp;amp;&amp;amp; !tp_inst._defaults.altFieldTimeOnly &amp;amp;&amp;amp; date !== null){
					if(tp_inst._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime;
					}
					else{
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime;
					}
				}
				$(altField).val(altFormattedDateTime);
			}
		}
		else{
			$.datepicker._base_updateAlternate(inst);
		}
	};

	/*
	* Override key up event to sync manual input changes.
	*/
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst);
				} catch (err) {
					$.timepicker.log(err);
				}
			}
		}

		return $.datepicker._base_doKeyUp(event);
	};

	/*
	* override "Today" button to also grab the time.
	*/
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function(id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		this._base_gotoToday(id);
		var tp_inst = this._get(inst, 'timepicker');
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		$('.ui-datepicker-today', $dp).click();
	};

	/*
	* Disable &amp;amp; enable the Time in the datetimepicker
	*/
	$.datepicker._disableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst);
		}
	};

	$.datepicker._enableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst); // Could be disabled on page load
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create our own set time function
	*/
	$.datepicker._setTime = function(inst, date) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var defaults = tp_inst._defaults;

			// calling _setTime with no date sets time to defaults
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;

			//check if within min/max times.. 
			tp_inst._limitMinMaxDateTime(inst, true);

			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create new public method to set only time, callable as $().datepicker('setTime', date)
	*/
	$.datepicker._setTimeDatepicker = function(target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date == "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec);
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds());
				}
				if (tp_date.toString() == 'Invalid Date') {
					tp_date = undefined;
				}
				this._setTime(inst, tp_date);
			}
		}

	};

	/*
	* override setDate() to allow setting time too within Date object
	*/
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function(target, date) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		if(typeof(date) === 'string'){
			date = new Date(date);
			if(!date.getTime()){
				$.timepicker.log("Error creating Date object from string.");
			}
		}

		var tp_inst = this._get(inst, 'timepicker');
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds());
		} else {
			tp_date = date;
		}
		
		// This is important if you are using the timezone option, javascript's Date 
		// object will only return the timezone offset for the current locale, so we 
		// adjust it accordingly.  If not using timezone option this won't matter..
		// If a timezone is different in tp, keep the timezone as is
		if(tp_inst){
			// look out for DST if tz wasn't specified
			if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
				tp_inst.timezone = tp_date.getTimezoneOffset()*-1;
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone);
		}

		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true);
	};

	/*
	* override getDate() to allow getting time too within Date object
	*/
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function(target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			// if it hasn't yet been defined, grab from field
			if(inst.lastVal === undefined){
				this._setDateFromField(inst, noDefault);
			}

			var date = this._getDate(inst);
			if (date &amp;amp;&amp;amp; tp_inst._parseTime($(target).val(), tp_inst.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);

				// This is important if you are using the timezone option, javascript's Date 
				// object will only return the timezone offset for the current locale, so we 
				// adjust it accordingly.  If not using timezone option this won't matter..
				if(tp_inst.timezone != null){
					// look out for DST if tz wasn't specified
					if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
						tp_inst.timezone = date.getTimezoneOffset()*-1;
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
				}
			}
			return date;
		}
		return this._base_getDateDatepicker(target, noDefault);
	};

	/*
	* override parseDate() because UI 1.8.14 throws an error about "Extra characters"
	* An option in datapicker to ignore extra format characters would be nicer.
	*/
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function(format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings);
		} catch (err) {
			// Hack!  The error message ends with a colon, a space, and
			// the "extra" characters.  We rely on that instead of
			// attempting to perfectly reproduce the parsing algorithm.
			if (err.indexOf(":") &amp;gt;= 0) {
				date = this._base_parseDate(format, value.substring(0,value.length-(err.length-err.indexOf(':')-2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format);
			} else {
				throw err;
			}
		}
		return date;
	};

	/*
	* override formatDate to set date with time to the input
	*/
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function(inst, day, month, year) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val();
		}
		return this._base_formatDate(inst);
	};

	/*
	* override options setter to add time to maxDate(Time) and minDate(Time). MaxDate
	*/
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function(target, name, value) {
		var inst = this._getInst(target),
	        name_clone;
		if (!inst) {
			return null;
		}

		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop;
		    if (typeof name == 'string') { // if min/max was set with the string
		        if (name === 'minDate' || name === 'minDateTime') {
		            min = value;
		        } else if (name === 'maxDate' || name === 'maxDateTime') {
		            max = value;
		        } else if (name === 'onSelect') {
		            onselect = value;
		        } else if (overrides.hasOwnProperty(name)) {
		            if (typeof (value) === 'undefined') {
		                return overrides[name];
		            }
		            fns[name] = value;
		            name_clone = {}; //empty results in exiting function after overrides updated
		        }
		    } else if (typeof name == 'object') { //if min/max was set with the JSON
		        if (name.minDate) {
		            min = name.minDate;
		        } else if (name.minDateTime) {
		            min = name.minDateTime;
		        } else if (name.maxDate) {
		            max = name.maxDate;
		        } else if (name.maxDateTime) {
		            max = name.maxDateTime;
		        }
		        for (prop in overrides) {
		            if (overrides.hasOwnProperty(prop) &amp;amp;&amp;amp; name[prop]) {
		                fns[prop] = name[prop];
		            }
		        }
		    }
		    for (prop in fns) {
		        if (fns.hasOwnProperty(prop)) {
		            overrides[prop] = fns[prop];
		            if (!name_clone) { name_clone = $.extend({}, name);}
		            delete name_clone[prop];
		        }
		    }
		    if (name_clone &amp;amp;&amp;amp; isEmptyObject(name_clone)) { return; }
		    if (min) { //if min was set
		        if (min === 0) {
		            min = new Date();
		        } else {
		            min = new Date(min);
		        }
		        tp_inst._defaults.minDate = min;
		        tp_inst._defaults.minDateTime = min;
		    } else if (max) { //if max was set
		        if (max === 0) {
		            max = new Date();
		        } else {
		            max = new Date(max);
		        }
		        tp_inst._defaults.maxDate = max;
		        tp_inst._defaults.maxDateTime = max;
		    } else if (onselect) {
		        tp_inst._defaults.onSelect = onselect;
		    }
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name);
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
	};
	
	/*
	* jQuery isEmptyObject does not check hasOwnProperty - if someone has added to the object prototype,
	* it will return false for all objects
	*/
	var isEmptyObject = function(obj) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(obj)) {
				return false;
			}
		}
		return true;
	};

	/*
	* jQuery extend now ignores nulls!
	*/
	var extendRemove = function(target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] === null || props[name] === undefined) {
				target[name] = props[name];
			}
		}
		return target;
	};

	/*
	* Determine by the time format which units are supported
	* Returns an object of booleans for each unit
	*/
	var detectSupport = function(timeFormat){
		var tf = timeFormat.replace(/\'.*?\'/g,'').toLowerCase(), // removes literals
			isIn = function(f, t){ // does the format contain the token?
					return f.indexOf(t) !== -1? true:false; 
				};
		return {
				hour: isIn(tf,'h'),
				minute: isIn(tf,'m'),
				second: isIn(tf,'s'),
				millisec: isIn(tf,'l'),
				microsec: isIn(tf,'c'),
				timezone: isIn(tf,'z'),
				ampm: isIn(tf,'t') &amp;amp;&amp;amp; isIn(timeFormat,'h'),
				iso8601: isIn(timeFormat, 'Z')
			};
	};

	/*
	* Converts 24 hour format into 12 hour
	* Returns 12 hour without leading 0
	*/
	var convert24to12 = function(hour) {
		if (hour &amp;gt; 12) {
			hour = hour - 12;
		}

		if (hour === 0) {
			hour = 12;
		}

		return String(hour);
	};

	/*
	* Splits datetime string into date ans time substrings.
	* Throws exception when date can't be parsed
	* Returns [dateString, timeString]
	*/
	var splitDateTime = function(dateFormat, dateTimeString, dateSettings, timeSettings) {
		try {
			// The idea is to get the number separator occurances in datetime and the time format requested (since time has 
			// fewer unknowns, mostly numbers and am/pm). We will use the time pattern to split.
			var separator = timeSettings &amp;amp;&amp;amp; timeSettings.separator ? timeSettings.separator : $.timepicker._defaults.separator,
				format = timeSettings &amp;amp;&amp;amp; timeSettings.timeFormat ? timeSettings.timeFormat : $.timepicker._defaults.timeFormat,
				timeParts = format.split(separator), // how many occurances of separator may be in our format?
				timePartsLen = timeParts.length,
				allParts = dateTimeString.split(separator),
				allPartsLen = allParts.length;

			if (allPartsLen &amp;gt; 1) {
				return [
						allParts.splice(0,allPartsLen-timePartsLen).join(separator),
						allParts.splice(0,timePartsLen).join(separator)
					];
			}

		} catch (err) {
			$.timepicker.log('Could not split the date from the time. Please check the following datetimepicker options' +
					"\nthrown error: " + err +
					"\ndateTimeString" + dateTimeString +
					"\ndateFormat = " + dateFormat +
					"\nseparator = " + timeSettings.separator +
					"\ntimeFormat = " + timeSettings.timeFormat);

			if (err.indexOf(":") &amp;gt;= 0) {
				// Hack!  The error message ends with a colon, a space, and
				// the "extra" characters.  We rely on that instead of
				// attempting to perfectly reproduce the parsing algorithm.
				var dateStringLength = dateTimeString.length - (err.length - err.indexOf(':') - 2),
					timeString = dateTimeString.substring(dateStringLength);

				return [$.trim(dateTimeString.substring(0, dateStringLength)), $.trim(dateTimeString.substring(dateStringLength))];

			} else {
				throw err;
			}
		}
		return [dateTimeString, ''];
	};

	/*
	* Internal function to parse datetime interval
	* Returns: {date: Date, timeObj: Object}, where
	*   date - parsed date without time (type Date)
	*   timeObj = {hour: , minute: , second: , millisec: , microsec: } - parsed time. Optional
	*/
	var parseDateTimeInternal = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var date;
		var splitRes = splitDateTime(dateFormat, dateTimeString, dateSettings, timeSettings);
		date = $.datepicker._base_parseDate(dateFormat, splitRes[0], dateSettings);
		if (splitRes[1] !== '') {
			var timeString = splitRes[1],
				parsedTime = $.datepicker.parseTime(timeFormat, timeString, timeSettings);

			if (parsedTime === null) {
				throw 'Wrong time format';
			}
			return {
				date: date,
				timeObj: parsedTime
			};
		} else {
			return {
				date: date
			};
		}
	};

	/*
	* Internal function to set timezone_select to the local timezone
	*/
	var selectLocalTimezone = function(tp_inst, date) {
		if (tp_inst &amp;amp;&amp;amp; tp_inst.timezone_select) {
			var now = typeof date !== 'undefined' ? date : new Date();
			tp_inst.timezone_select.val(now.getTimezoneOffset()*-1);
		}
	};

	/*
	* Create a Singleton Insance
	*/
	$.timepicker = new Timepicker();

	/**
	 * Get the timezone offset as string from a date object (eg '+0530' for UTC+5.5)
	 * @@param  number if not a number this value is returned
	 * @@param boolean if true formats in accordance to iso8601 "+12:45"
	 * @@return string
	 */
	$.timepicker.timezoneOffsetString = function(tzMinutes, iso8601) {
		if(isNaN(tzMinutes) || tzMinutes &amp;gt; 840){
			return tzMinutes;
		}

		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601? ':':'',
			tz = (off &amp;gt;= 0 ? '+' : '-') + ('0' + (hours * 101).toString()).slice(-2) + iso + ('0' + (minutes * 101).toString()).slice(-2);
		
		if(tz == '+00:00'){
			return 'Z';
		}
		return tz;
	};

	/**
	 * Get the number in minutes that represents a timezone string
	 * @@param  string formated like "+0500", "-1245"
	 * @@return number
	 */
	$.timepicker.timezoneOffsetNumber = function(tzString) {
		tzString = tzString.toString().replace(':',''); // excuse any iso8601, end up with "+1245"

		if(tzString.toUpperCase() === 'Z'){ // if iso8601 with Z, its 0 minute offset
			return 0;
		}

		if(!/^(\-|\+)\d{4}$/.test(tzString)){ // possibly a user defined tz, so just give it back
			return tzString;
		}

		return ((tzString.substr(0,1) =='-'? -1 : 1) * // plus or minus
					((parseInt(tzString.substr(1,2),10)*60) + // hours (converted to minutes)
					parseInt(tzString.substr(3,2),10))); // minutes
	};

	/**
	 * No way to set timezone in js Date, so we must adjust the minutes to compensate. (think setDate, getDate)
	 * @@param  date
	 * @@param  string formated like "+0500", "-1245"
	 * @@return date
	 */
	$.timepicker.timezoneAdjust = function(date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if(!isNaN(toTz)){
			date.setMinutes(date.getMinutes()*1 + (date.getTimezoneOffset()*-1 - toTz*1) );
		}
		return date;
	};

	/**
	 * Calls `timepicker()` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * n.b. The input value must be correctly formatted (reformatting is not supported)
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the timepicker() call
	 * @@return jQuery
	 */
	$.timepicker.timeRange = function(startTime, endTime, options) {
		return $.timepicker.handleRange('timepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datetimepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@return jQuery
	 */
	$.timepicker.datetimeRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datetimepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.dateRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.handleRange = function(method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0, // min allowed interval in milliseconds
			maxInterval: 0, // max allowed interval in milliseconds
			start: {},      // options for start picker
			end: {}         // options for end picker
		}, options);

		$.fn[method].call(startTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), endTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), endTime, 'minDate');
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), startTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), startTime, 'maxDate');
			}
		}, options, options.end));

		checkDates(startTime, endTime);
		selected(startTime, endTime, 'minDate');
		selected(endTime, startTime, 'maxDate');

		function checkDates(changed, other) {
			var startdt = startTime[method]('getDate'),
				enddt = endTime[method]('getDate'),
				changeddt = changed[method]('getDate');

			if(startdt !== null){
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());

				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);

				if(options.minInterval &amp;gt; 0 &amp;amp;&amp;amp; minDate &amp;gt; enddt){ // minInterval check
					endTime[method]('setDate',minDate);
				}
				else if(options.maxInterval &amp;gt; 0 &amp;amp;&amp;amp; maxDate &amp;lt; enddt){ // max interval check
					endTime[method]('setDate',maxDate);
				}
				else if (startdt &amp;gt; enddt) {
					other[method]('setDate',changeddt);
				}
			}
		}

		function selected(changed, other, option) {
			if (!changed.val()) {
				return;
			}
			var date = changed[method].call(changed, 'getDate');
			if(date !== null &amp;amp;&amp;amp; options.minInterval &amp;gt; 0){
				if(option == 'minDate'){
					date.setMilliseconds(date.getMilliseconds() + options.minInterval); 
				}
				if(option == 'maxDate'){
					date.setMilliseconds(date.getMilliseconds() - options.minInterval);
				}
			}
			if (date.getTime) {
				other[method].call(other, 'option', option, date);
			}
		}
		return $([startTime.get(0), endTime.get(0)]);
	};

	/**
	 * Log error or data to the console during error or debugging
	 * @@param  Object err pass any type object to log to the console during error or debugging
	 * @@return void
	 */
	$.timepicker.log = function(err){
		if(window.console){
			console.log(err);
		}
	};

	/*
	* Microsecond support
	*/
	if(!Date.prototype.getMicroseconds){
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function(){ return this.microseconds; };
		Date.prototype.setMicroseconds = function(m){ 
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m/1000));
			this.microseconds = m%1000;
			return this;
		};
	}

	/*
	* Keep up with the version
	*/
	$.timepicker.version = "1.3.1";

})(jQuery);
jQuery.noConflict();
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;datetimepicker-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;e73a652e-09fc-4c71-8e7a-e2525a2d2a99&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
function replaceAllString(oriStr, strTarget, strSubString ){
   var strText = oriStr;
   var intIndexOfMatch = strText.indexOf( strTarget );
   while (intIndexOfMatch != -1){
      strText = strText.replace( strTarget, strSubString )
      intIndexOfMatch = strText.indexOf( strTarget );
   }
   return( strText );
}
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&amp;amp;]" + name + "=([^&amp;amp;#]*)"),
    results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
};


   var jobName= getParameterByName('job')
   var fromDate= getParameterByName('fromDate')
   var toDate= getParameterByName('toDate')
   var limit= getParameterByName('limit')
   var selectedIstIid = getParameterByName('IstIid')

  $("#jobname").ready(function(){
   $("#jobname").text(jobName)
   var convertedJobName = replaceAllString(jobName, ".", "_")
   $("#IstIid" + convertedJobName).ready(function(){
     $("#IstIid" + convertedJobName).css("display","block")
     $("#select_" + convertedJobName).ready(function(){
        $("#select_" + convertedJobName).val(selectedIstIid)
     });
   });
 });

  $("#fromDate").ready(function(){
   $("#from-date").val(fromDate)
 });

  $("#toDate").ready(function(){
   $("#to-date").val(toDate)
 });

  $("#limit").ready(function(){
   if(limit!=""){
    $("#limit").val(limit)
   }
 });
 // Get data with ajax
 function ajax_getData(jobName,fromDate,toDate,limit ){
       var convertedJobName = replaceAllString(jobName, ".", "_")
       var istIid = $("#select_" + convertedJobName).val()
       window.location="/xwiki/bin/view/WiperDog/WebHome?job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid="+istIid;
 			/*$.ajax({
			 type: "GET",
			 url:"/xwiki/bin/get/Sandbox/DescriptionForJob?outputSyntax=plain&amp;amp;job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid"+selectedIstIid,
			 success : function(result){
				$("#jobname").html(jobName)
				$("#display").text('[[]]' + result)
			 }
		   });*/
 }
	$("#treemenu2 a").click(function(){
		 var limit = 10
		 var fromDate=""
		 var toDate = ""
		 jobName= $(this).text()
                 $("#jobname").html(jobName)
                 var convertedJobName = replaceAllString(jobName, ".", "_")
                 $("#listIstIid &amp;gt; div").css("display","none")
                 $("#IstIid" + convertedJobName).css("display","block")
		 //ajax_getData(jobName,fromDate,toDate,limit )

	});

	$("#from-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
		dateFormat: 'yy-mm-dd',
	});
	$("#to-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
			dateFormat: 'yy-mm-dd',

	});
	 $("#get-data").on("click",function(){
		var fromDate = $("#from-date").val()
		var toDate =  $("#to-date").val()
		 if( toDate!= "" ){
			  if(fromDate != ""){
				  if($("#from-date").datepicker( "getDate" ) &amp;gt; $("#to-date").datepicker( "getDate" )){
				  alert("'From date' cannot start later than 'To date'")
				  return false
				  }
			  }
		 }
		 limit = $("#limit").val()
		 ajax_getData(jobName,fromDate,toDate,limit )
                 
                 /** Get livetable data */
                 //alert('job = ' + $("#jobname").text() + ',   istIid  = '+ selectedIstIid)
                 var dataModelUrl = '/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job='+$("#jobname").text()+'&amp;amp;limit='
                     +$("#limit").text()+'&amp;amp;fromDate='
	             +fromDate + '&amp;amp;toDate=' + toDate +   '&amp;amp;pager=pager2&amp;amp;genp=1&amp;amp;istIid='+selectedIstIid
		 var jqxhr = $.getJSON(dataModelUrl, function(data) {
				$("#livetableList").jqGrid(data);
				$("#livetableList").jqGrid('navGrid', "#livetablePager", {
				    edit : false,
				    add : false,
				    del : false
				});
			})
	});
        
jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;process&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;881686cc-1bfc-456e-b8ab-71334c4a45e5&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){

$(function () {
    function drawLineChart(xAxis, series, container, data_detail){
        var dataXAxis = xAxis
        var dataSeries = series
        var detail = data_detail

			$('#containerline' + container).highcharts({

				chart: {
					type:'line'
				},
				title: {
					text: container
				},
				tooltip :{
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				xAxis: dataXAxis ,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				series: dataSeries
			});
		};

		function drawBarChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerbar' + container).highcharts({
				chart: {
					type: 'column'
				},
				title: {
					text: container
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {

					column: {
						pointPadding: 0.2,
						borderWidth: 0
					}
				},
				series: dataSeries
			});
		}

		function drawAreaChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail
			$('#containerarea' + container).highcharts({
				chart: {
					type: 'area'
				},
				title: {
					text: container
				},
				subtitle: {
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					},
					labels: {
						formatter: function() {
							return this.value / 1000;
						}
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {
					area: {
						stacking: 'normal',
						lineColor: '#666666',
						lineWidth: 1,
						marker: {
							lineWidth: 1,
							lineColor: '#666666'
						}
					}
				},
				series: dataSeries
			});
		};

		function drawPieChart(data, container){
			var dataPie = data
			$(document).ready(function () {
				// Build the chart
				$('#container' + container).highcharts({
					chart: {
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: dataPie[0].name
					},
					tooltip: {
						pointFormat: '{series.name}: &amp;lt;b&amp;gt;{point.percentage:.1f}%&amp;lt;/b&amp;gt;'
					},
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							dataLabels: {
								enabled: false
							},
							showInLegend: true
						}
					},
					series: dataPie
				});
			});
		}

		// LINE
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonline_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonline");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Line chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						if(data_all[0][i].series[0].name == null){
							data_all[0][i].series[0].name = lstContainer[0][i]
						}
						drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
					}
				}
			}
		});

		// BAR
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonbar_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonbar");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Bar chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						drawBarChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
					}
				}
			}
		});

		// AREA
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonarea_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonarea");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				// data to display on tooltip
				var data_detail = data_all[0]
				// draw Area Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					drawAreaChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
				}
			}
		});

		// PIE
		$("#piechart").ready(function(){

			var array = $("#jsons&amp;gt;.jsonpie");
			var arrayContainer = $("#jsons&amp;gt;.lstcontainerpie");
			var lstContainer = [];
			var data_all = [];
			for(var i=0;i&amp;lt;array.length;i++){
				data_all[i] = jQuery.parseJSON(array[i].value)
				lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)

			}
			if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
				// data to display on tooltip
				// draw Pie Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					var finalData = []
					finalData[0] = data_all[0][i]
					drawPieChart(finalData, lstContainer[0][i])
				}
			}
		});
	});
	jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;d5873d92-b78b-42fc-9407-46d166204b88&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;/* css for timepicker */
.ui-timepicker-div .ui-widget-header { 
margin-bottom: 8px;
 }

.ui-timepicker-div dl { text-align: left; }
.ui-timepicker-div dl dt { height: 25px; margin-bottom: -25px; }
.ui-timepicker-div dl dd { margin: 0 10px 10px 65px; }
.ui-timepicker-div td { font-size: 90%; }
.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }

.ui-timepicker-rtl{ direction: rtl; }
.ui-timepicker-rtl dl { text-align: right; }
.ui-timepicker-rtl dl dd { margin: 0 65px 10px 10px; }
#ui-datepicker-div{
 position:relative;
 width:auto;
 height:auto
}
&lt;/code&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;datetimepicker -css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;1201fb1a-e9c1-4731-8c74-2ea8c0071959&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;.displayblock {
  border:2px solid;
  -webkit-border-radius:6px;
  background:gray;
  float: left;
  width:100%;
}

.displaypie {
  border:1px solid;
  -webkit-border-radius:6px;
  background:gray;
  width: 48%;
  float: left; 
  height: 300px;
}

.subtype {
  margin-top: 50px;
  font-size: 2em;
  color: red;
}&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;content&gt;{{include document="Lib.DataToDrawChart"/}}
{{include document="Lib.MongoDBConnection"/}}
{{velocity}}
$xwiki.jsx.use('Lib.JQueryUILib')
$xwiki.ssx.use('Lib.MenuGenerator')
$xwiki.jsx.use('Lib.MenuGenerator')
$xwiki.ssx.use('Lib.JQueryUILib')
{{/velocity}}
{{include document="Lib.MenuGenerator"/}}
{{html wiki="true" clean="false"}}
&amp;lt;div id="viewer"&amp;gt;
&amp;lt;table style="text-align:left"  &amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th &amp;gt;Job name&amp;lt;/th&amp;gt;
  &amp;lt;td colspan=3&amp;gt;&amp;lt;div id="jobname"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
{{groovy}}
import org.xwiki.context.*

def ec = services.component.getInstance(Execution.class).getContext()
def mapJobIstIid = ec.getProperty("mapJobIstIid")

println '{{html clean="false" wiki="false"}}'
println '&amp;lt;tr&amp;gt;'
println '&amp;lt;th&amp;gt;IstIid&amp;lt;/th&amp;gt;'
println '&amp;lt;td colspan=3&amp;gt;'
mapJobIstIid.each{jobEntry-&amp;gt;
  def convertedJobKey = jobEntry.key.replaceAll("\\.","_")
  println "&amp;lt;div id='listIstIid'&amp;gt;"
  println "&amp;lt;div id=IstIid${convertedJobKey} style='display:none'&amp;gt;"
  println "&amp;lt;select id=select_${convertedJobKey}&amp;gt;"
  jobEntry.value.each{
     println "&amp;lt;option value=\"$it\"&amp;gt;$it&amp;lt;/option&amp;gt;"
  }
  println "&amp;lt;/select&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
}
println '&amp;lt;/td&amp;gt;'
println '&amp;lt;/tr&amp;gt;'
println '{{/html}}'
{{/groovy}}
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data monitor from&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="from-date" id="from-date"/&amp;gt;&amp;lt;/td&amp;gt;
  &amp;lt;th&amp;gt;Data monitor to&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="to-date" id="to-date"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data records limit &amp;lt;/th&amp;gt;
  &amp;lt;td &amp;gt;
     &amp;lt;select id="limit"&amp;gt;
       &amp;lt;option value=5&amp;gt;5&amp;lt;/option&amp;gt;
       &amp;lt;option value=10&amp;gt;10&amp;lt;/option&amp;gt;
       &amp;lt;option value=15&amp;gt;15&amp;lt;/option&amp;gt;
       &amp;lt;option value=20&amp;gt;20&amp;lt;/option&amp;gt;
     &amp;lt;/select&amp;gt;
  &amp;lt;/td&amp;gt;
  &amp;lt;td colspan=3 &amp;gt;&amp;lt;input type="button" value="View Data" id="get-data" class="button"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;
    &amp;lt;table id="livetableList"&amp;gt;&amp;lt;tr&amp;gt;&amp;lt;td&amp;gt;livetableList&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;
    &amp;lt;div id="livetablePager"&amp;gt;livetablePager&amp;lt;/div&amp;gt;
&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;&amp;lt;div id="display"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
&amp;lt;/table&amp;gt;

&amp;lt;/div&amp;gt; 
 &amp;lt;/body&amp;gt;

{{/html}}
{{groovy}}
import groovy.json.*
xwiki.jsx.use("Lib.Highcharts")

if(request.xpage == "plain") {
	response.setContentType('text/plain')
}

def listData = []
def job = request.get("job")
def fromDate = request.get("fromDate")
def toDate = request.get("toDate")
def limit= (request.get("limit")!=null)?request.get("limit").toInteger():10
def istIid = request.get("IstIid")

def str= "No data to retrieved !"
def result = null
if(job != "" &amp;amp;&amp;amp; job != null &amp;amp;&amp;amp; istIid != null &amp;amp;&amp;amp; istIid != ""){
	MongoDBConnection.getConnection()
	if(fromDate != "" || toDate != ""){
		result = MongoDBConnection.getDataInPeriod(job,fromDate,toDate,limit,istIid)
	} else {
		result = MongoDBConnection.getDataAllFields(job,limit,istIid)
        }
MongoDBConnection.closeConnection()
} else {
   println "{{warning}}There are no selected job or IstIid{{/warning}}"
}

if( (result != null) &amp;amp;&amp;amp; (result.size() &amp;gt; 0) &amp;amp;&amp;amp; (result[0].KEYEXPR != null)&amp;amp;&amp;amp;!(result[0].KEYEXPR instanceof List )){
if(result[0].type == "Subtyped") {
    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
    def dataSubtype = DataToDrawChart.getDataToDrawSubtype(result)
    def listKey = []
    dataSubtype.each {key,value -&amp;gt;
        listKey.add(key)
    }
    def jsonkey = com.mongodb.util.JSON.serialize(listKey)
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$jsonkey&amp;lt;/textarea&amp;gt;"

    dataSubtype.each {key,value -&amp;gt;
        def dataLine = []
        def dataBar = []
        def dataPie = []
        def dataArea = []
        if(DataToDrawChart.getDataToDrawLine(value) != []) {
            dataLine = DataToDrawChart.getDataToDrawLine(value)
        }
        if(DataToDrawChart.getDataToDrawBar(value) != []) {
            dataBar = DataToDrawChart.getDataToDrawBar(value)
        }
        if(DataToDrawChart.getDataToDrawPie(value) != []) {
            dataPie = DataToDrawChart.getDataToDrawPie(value)
        }
        if(DataToDrawChart.getDataToDrawArea(value) != []) {
            dataArea = DataToDrawChart.getDataToDrawArea(value)
        }

        def chartColumnsLine
        def chartColumnsBar 
        def chartColumnsArea 
        def lstName
        if(dataLine.size() &amp;gt; 0 ){
            chartColumnsLine = dataLine[0].chart_columns
        }
        if(dataBar.size() &amp;gt; 0){
            chartColumnsBar = dataBar[0].chart_columns
        }
        if(dataArea.size() &amp;gt; 0 ){
            chartColumnsArea = dataArea[0].chart_columns
        }
        if(dataPie.size() &amp;gt; 0 ){
            lstName = dataPie['name']
        }

        def tmpListNameContainer = []
	for(def nameContainer in lstName){
	   nameContainer = nameContainer.replaceAll("\\.", "_")
	   tmpListNameContainer.add(nameContainer)
	}
        def jsonPie
        def jsonLine
	def jsonBar
        def jsonArea
        if(dataPie != []) {
	    jsonPie = com.mongodb.util.JSON.serialize(dataPie)
        }
        if(dataLine != []) {
	    jsonLine = com.mongodb.util.JSON.serialize(dataLine)
        }
        if(dataBar != []) {
            jsonBar = com.mongodb.util.JSON.serialize(dataBar)
        }
        if(dataArea != []) {
	    jsonArea = com.mongodb.util.JSON.serialize(dataArea)
        }

	def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
	def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
	def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
	def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

	println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
        if(jsonLine != null) {
	    println "&amp;lt;textarea id=\"jsonline_$key\" &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;" 
        }
	if(jsonBar != null) {
            println "&amp;lt;textarea id=\"jsonbar_$key\"&amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
 	    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
        }
        if(jsonPie != null) {
	    println "&amp;lt;textarea id=\"jsonpie_$key\" &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
        }
        if(jsonArea != null) {
	    println "&amp;lt;textarea id=\"jsonarea_$key\" &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"
	    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
        }

	println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
	println "&amp;lt;input style=\"display:none\" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;"
	println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
	println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'
	println "&amp;lt;/div&amp;gt;"
	  
	def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
	def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
	  
	println "&amp;lt;div style='clear:both'&amp;gt;"
        def description = value.KEYEXPR._description[0][key]
        if(description != null) {
            println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +': ' + description +'&amp;lt;/div&amp;gt;'
        } else {
            println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +'&amp;lt;/div&amp;gt;'
        }
        println "-----"
        if(jsonPie != null) {
	  println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
	  lstName.each{
	    def tmp = it.replaceAll("\\.", "_")
	    println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
        if(jsonLine != null) {
	  def chartLineComment = false
	  chartColumnsLine.each{
	    if(!chartLineComment){
	       println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	       chartLineComment = true  
	    }

	      println " &amp;lt;div class=\"displayblock\" id=\"containerline${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
        println "&amp;amp;nbsp;"

        if(jsonBar != null) {
	  def chartBarComment = false
	  chartColumnsBar.each{
	     if(!chartBarComment){
	        println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	        chartBarComment = true
	      }  

	     println " &amp;lt;div class=\"displayblock\" id=\"containerbar${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
	println "&amp;amp;nbsp;"

        if(jsonArea != null) {
	  def chartAreaComment = false
	  chartColumnsArea.each{
	  if(!chartAreaComment){
	    println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	    chartAreaComment = true
	  }
	    println " &amp;lt;div class=\"displayblock\" id=\"containerarea${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
	println "&amp;lt;/div&amp;gt;"
        
    }
    println '&amp;lt;/body&amp;gt;'
    println '{{/html}}'
} else if(result[0].type == "Store") {
    // data store
    def dataLine = DataToDrawChart.getDataToDrawLine(result)
    def dataBar = DataToDrawChart.getDataToDrawBar(result)
    def dataPie = DataToDrawChart.getDataToDrawPie(result)
    def dataArea = DataToDrawChart.getDataToDrawArea(result)
    def chartColumnsLine 
    def chartColumnsBar 
    def chartColumnsArea 
    def lstName 

    if(dataLine.size() &amp;gt; 0 ){
        chartColumnsLine = dataLine[0].chart_columns
    }
    if(dataBar.size() &amp;gt; 0){
        chartColumnsBar = dataBar[0].chart_columns
    }
    if(dataArea.size() &amp;gt; 0 ){
        chartColumnsArea = dataArea[0].chart_columns
    }
    if(dataPie.size() &amp;gt; 0 ){
        lstName = dataPie['name']
    }

    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
  
    def tmpListNameContainer = []
    for(def nameContainer in lstName){
       nameContainer = nameContainer.replaceAll("\\.", "_")
       tmpListNameContainer.add(nameContainer)
    }
  
    def jsonPie = com.mongodb.util.JSON.serialize(dataPie)
    def jsonLine = com.mongodb.util.JSON.serialize(dataLine)
    def jsonBar = com.mongodb.util.JSON.serialize(dataBar)
    def jsonArea = com.mongodb.util.JSON.serialize(dataArea)

    def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
    def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
    def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
    def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

    def listEmpty = com.mongodb.util.JSON.serialize([])
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$listEmpty&amp;lt;/textarea&amp;gt;" 

    println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'

    println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
    println "&amp;lt;textarea class='jsonline' &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonbar' &amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonpie' &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonarea' &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"

    println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
  
    def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
    def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
  
    println "&amp;lt;div style='clear:both'&amp;gt;"
  
    def chartPieComment = false
    lstName.each{
        if(!chartPieComment) {
            println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
            chartPieComment = true
        }
        def tmp = it.replaceAll("\\.", "_")
        println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    def chartLineComment = false
    chartColumnsLine.each{
    if(!chartLineComment){
        println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
        chartLineComment = true  
    }

    println " &amp;lt;div class=\"displayblock\" id=\"containerline$it\"&amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    println "&amp;amp;nbsp;"
    def chartBarComment = false
    chartColumnsBar.each{
        if(!chartBarComment){
            println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
            chartBarComment = true
        }  

    println " &amp;lt;div class=\"displayblock\" id=\"containerbar$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
  println "&amp;lt;/div&amp;gt;"
  println "&amp;amp;nbsp;"
  def chartAreaComment = false
  chartColumnsArea.each{
  if(!chartAreaComment){
    println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
    chartAreaComment = true
  }
    println " &amp;lt;div class=\"displayblock\" id=\"containerarea$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
  println "&amp;lt;/div&amp;gt;"
println "&amp;lt;/div&amp;gt;"

println '&amp;lt;/body&amp;gt;'
println '{{/html}}'
}
}else{
    println 'There is no data for this job with criterias'
}
{{/groovy}}&lt;/content&gt;&lt;/xwikidoc&gt;
@


42.4
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376380918000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376380918000&lt;/contentUpdateDate&gt;
&lt;version&gt;42.4&lt;/version&gt;
d3330 1
@


42.3
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376380902000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376380902000&lt;/contentUpdateDate&gt;
&lt;version&gt;42.3&lt;/version&gt;
a3234 7
        def description = value.KEYEXPR._description[0][key]
        if(description != null) {
            println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +': ' + description +'&amp;lt;/div&amp;gt;'
        } else {
            println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +'&amp;lt;/div&amp;gt;'
        }
        println "-----"
@


42.2
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376380811000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376380811000&lt;/contentUpdateDate&gt;
&lt;version&gt;42.2&lt;/version&gt;
d3331 6
@


42.1
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376376955000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376376948000&lt;/contentUpdateDate&gt;
&lt;version&gt;42.1&lt;/version&gt;
d21 1
a21 1
&lt;minorEdit&gt;false&lt;/minorEdit&gt;
d3235 6
a3240 1
        println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +'&amp;lt;/div&amp;gt;'
@


41.2
log
@@
text
@&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xwikidoc&gt;
&lt;web&gt;WiperDog&lt;/web&gt;
&lt;name&gt;WebHome&lt;/name&gt;
&lt;language&gt;&lt;/language&gt;
&lt;defaultLanguage&gt;en&lt;/defaultLanguage&gt;
&lt;translation&gt;0&lt;/translation&gt;
&lt;parent&gt;&lt;/parent&gt;
&lt;creator&gt;XWiki.Admin&lt;/creator&gt;
&lt;author&gt;XWiki.Admin&lt;/author&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;contentAuthor&gt;XWiki.Admin&lt;/contentAuthor&gt;
&lt;creationDate&gt;1376364375000&lt;/creationDate&gt;
&lt;date&gt;1376376948000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376376948000&lt;/contentUpdateDate&gt;
&lt;version&gt;41.2&lt;/version&gt;
&lt;title&gt;WiperDog&lt;/title&gt;
&lt;defaultTemplate&gt;&lt;/defaultTemplate&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;comment&gt;&lt;/comment&gt;
&lt;minorEdit&gt;true&lt;/minorEdit&gt;
&lt;syntaxId&gt;xwiki/2.1&lt;/syntaxId&gt;
&lt;hidden&gt;false&lt;/hidden&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;047293a8-524d-45e4-af52-cd944523d5d0&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
/*
 * jQuery timepicker addon
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 1.3.1
 * Last Modified: 07/07/2013
 *
 * Copyright 2013 Trent Richardson
 * You may use this project under MIT or GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 */

/*jslint evil: true, white: false, undef: false, nomen: false */

(function($) {

	/*
	* Lets not redefine timepicker, Prevent "Uncaught RangeError: Maximum call stack size exceeded"
	*/
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return;
	}

	/*
	* Extend jQueryUI, get it started with our version number
	*/
	$.extend($.ui, {
		timepicker: {
			version: "1.3.1"
		}
	});

	/* 
	* Timepicker manager.
	* Use the singleton instance of this class, $.timepicker, to interact with the time picker.
	* Settings for (groups of) time pickers are maintained in an instance object,
	* allowing multiple different settings on the same page.
	*/
	var Timepicker = function() {
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[''] = { // Default regional settings
			currentText: 'Now',
			closeText: 'Done',
			amNames: ['AM', 'A'],
			pmNames: ['PM', 'P'],
			timeFormat: 'HH:mm',
			timeSuffix: '',
			timeOnlyTitle: 'Choose Time',
			timeText: 'Time',
			hourText: 'Hour',
			minuteText: 'Minute',
			secondText: 'Second',
			millisecText: 'Millisecond',
			microsecText: 'Microsecond',
			timezoneText: 'Time Zone',
			isRTL: false
		};
		this._defaults = { // Global defaults for all the datetime picker instances
			showButtonPanel: true,
			timeOnly: false,
			showHour: null,
			showMinute: null,
			showSecond: null,
			showMillisec: null,
			showMicrosec: null,
			showTimezone: null,
			showTime: true,
			stepHour: 1,
			stepMinute: 1,
			stepSecond: 1,
			stepMillisec: 1,
			stepMicrosec: 1,
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null,
			hourMin: 0,
			minuteMin: 0,
			secondMin: 0,
			millisecMin: 0,
			microsecMin: 0,
			hourMax: 23,
			minuteMax: 59,
			secondMax: 59,
			millisecMax: 999,
			microsecMax: 999,
			minDateTime: null,
			maxDateTime: null,
			onSelect: null,
			hourGrid: 0,
			minuteGrid: 0,
			secondGrid: 0,
			millisecGrid: 0,
			microsecGrid: 0,
			alwaysSetTime: true,
			separator: ' ',
			altFieldTimeOnly: true,
			altTimeFormat: null,
			altSeparator: null,
			altTimeSuffix: null,
			pickerTimeFormat: null,
			pickerTimeSuffix: null,
			showTimepicker: true,
			timezoneList: null,
			addSliderAccess: false,
			sliderAccessArgs: null,
			controlType: 'slider',
			defaultValue: null,
			parse: 'strict'
		};
		$.extend(this._defaults, this.regional['']);
	};

	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: '',
		formattedDate: '',
		formattedTime: '',
		formattedDateTime: '',
		timezoneList: null,
		units: ['hour','minute','second','millisec', 'microsec'],
		support: {},
		control: null,

		/* 
		* Override the default settings for all instances of the time picker.
		* @@param  settings  object - the new settings to use as defaults (anonymous object)
		* @@return the manager object
		*/
		setDefaults: function(settings) {
			extendRemove(this._defaults, settings || {});
			return this;
		},

		/*
		* Create a new Timepicker instance
		*/
		_newInst: function($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
            	fns = {},
		    	overrides, i;

			for (var attrName in this._defaults) {
				if(this._defaults.hasOwnProperty(attrName)){
					var attrValue = $input.attr('time:' + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue);
						} catch (err) {
							inlineSettings[attrName] = attrValue;
						}
					}
				}
			}

		    overrides = {
		        beforeShow: function (input, dp_inst) {
		            if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
		                return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst);
		            }
		        },
		        onChangeMonthYear: function (year, month, dp_inst) {
		            // Update the time as well : this prevents the time from disappearing from the $input field.
		            tp_inst._updateDateTime(dp_inst);
		            if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
		                tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst);
		            }
		        },
		        onClose: function (dateText, dp_inst) {
		            if (tp_inst.timeDefined === true &amp;amp;&amp;amp; $input.val() !== '') {
		                tp_inst._updateDateTime(dp_inst);
		            }
		            if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
		                tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst);
		            }
		        }
		    };
		    for (i in overrides) {
		        if (overrides.hasOwnProperty(i)) {
		            fns[i] = opts[i] || null;
		        }
		    }

		    tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
		        evnts:fns,
		        timepicker: tp_inst // add timepicker as a property of datepicker: $.datepicker._get(dp_inst, 'timepicker');
		    });
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function(val) {
				return val.toUpperCase();
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function(val) {
				return val.toUpperCase();
			});

			// detect which units are supported
			tp_inst.support = detectSupport(
					tp_inst._defaults.timeFormat + 
					(tp_inst._defaults.pickerTimeFormat? tp_inst._defaults.pickerTimeFormat:'') + 
					(tp_inst._defaults.altTimeFormat? tp_inst._defaults.altTimeFormat:''));

			// controlType is string - key to our this._controls
			if(typeof(tp_inst._defaults.controlType) === 'string'){
				if(tp_inst._defaults.controlType == 'slider' &amp;amp;&amp;amp; typeof(jQuery.ui.slider) === 'undefined'){
					tp_inst._defaults.controlType = 'select';
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType];
			}
			// controlType is an object and must implement create, options, value methods
			else{ 
				tp_inst.control = tp_inst._defaults.controlType;
			}

			// prep the timezone options
			var timezoneList = [-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,
					0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList;
			}
			var tzl=timezoneList.length,tzi=0,tzv=null;
			if (tzl &amp;gt; 0 &amp;amp;&amp;amp; typeof timezoneList[0] !== 'object') {
				for(; tzi&amp;lt;tzl; tzi++){
					tzv = timezoneList[tzi];
					timezoneList[tzi] = { value: tzv, label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601) };
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;

			// set the default units
			tp_inst.timezone = tp_inst._defaults.timezone !== null? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) : 
							((new Date()).getTimezoneOffset()*-1);
			tp_inst.hour = tp_inst._defaults.hour &amp;lt; tp_inst._defaults.hourMin? tp_inst._defaults.hourMin : 
							tp_inst._defaults.hour &amp;gt; tp_inst._defaults.hourMax? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute &amp;lt; tp_inst._defaults.minuteMin? tp_inst._defaults.minuteMin : 
							tp_inst._defaults.minute &amp;gt; tp_inst._defaults.minuteMax? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second &amp;lt; tp_inst._defaults.secondMin? tp_inst._defaults.secondMin : 
							tp_inst._defaults.second &amp;gt; tp_inst._defaults.secondMax? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec &amp;lt; tp_inst._defaults.millisecMin? tp_inst._defaults.millisecMin : 
							tp_inst._defaults.millisec &amp;gt; tp_inst._defaults.millisecMax? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec &amp;lt; tp_inst._defaults.microsecMin? tp_inst._defaults.microsecMin : 
							tp_inst._defaults.microsec &amp;gt; tp_inst._defaults.microsecMax? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = '';
			tp_inst.$input = $input;

			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField).css({
					cursor: 'pointer'
				}).focus(function() {
					$input.trigger("focus");
				});
			}

			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date();
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date();
			}

			// datepicker needs minDate/maxDate, timepicker needs minDateTime/maxDateTime..
			if (tp_inst._defaults.minDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime());
			}
			if (tp_inst._defaults.minDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime());
			}
			if (tp_inst._defaults.maxDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime());
			}
			if (tp_inst._defaults.maxDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime());
			}
			tp_inst.$input.bind('focus', function() {
				tp_inst._onFocus();
			});

			return tp_inst;
		},

		/*
		* add our sliders to the calendar
		*/
		_addTimePicker: function(dp_inst) {
			var currDT = (this.$altInput &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly) ? this.$input.val() + ' ' + this.$altInput.val() : this.$input.val();

			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
		},

		/*
		* parse the time string from input value or _setTime
		*/
		_parseTime: function(timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0]);
			}

			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, 'dateFormat');
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false;
					}
					$.extend(this, parseRes.timeObj);
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err +
									"\ndate/time string = " + timeString +
									"\ntimeFormat = " + this._defaults.timeFormat +
									"\ndateFormat = " + dp_dateFormat);
					return false;
				}
				return true;
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false;
				}
				$.extend(this, timeObj);
				return true;
			}
		},

		/*
		* generate and inject html for timepicker into ui datepicker
		*/
		_injectTimePicker: function() {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = '',
				uitem = '',
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i=0,
				l=0;

			// Prevent displaying twice
			if ($dp.find("div.ui-timepicker-div").length === 0 &amp;amp;&amp;amp; o.showTimepicker) {
				var noDisplay = ' style="display:none;"',
					html = '&amp;lt;div class="ui-timepicker-div'+ (o.isRTL? ' ui-timepicker-rtl' : '') +'"&amp;gt;&amp;lt;dl&amp;gt;' + '&amp;lt;dt class="ui_tpicker_time_label"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;' + o.timeText + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_time"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the markup
				for(i=0,l=this.units.length; i&amp;lt;l; i++){
					litem = this.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// Added by Peter Medeiros:
					// - Figure out what the hour/minute/second max should be based on the step values.
					// - Example: if stepMinute is 15, then minMax is 45.
					max[litem] = parseInt((o[litem+'Max'] - ((o[litem+'Max'] - o[litem+'Min']) % o['step'+uitem])), 10);
					gridSize[litem] = 0;

					html += '&amp;lt;dt class="ui_tpicker_'+ litem +'_label"' + (show ? '' : noDisplay) + '&amp;gt;' + o[litem +'Text'] + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_'+ litem +'"&amp;gt;&amp;lt;div class="ui_tpicker_'+ litem +'_slider"' + (show ? '' : noDisplay) + '&amp;gt;&amp;lt;/div&amp;gt;';

					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						html += '&amp;lt;div style="padding-left: 1px"&amp;gt;&amp;lt;table class="ui-tpicker-grid-label"&amp;gt;&amp;lt;tr&amp;gt;';

						if(litem == 'hour'){
							for (var h = o[litem+'Min']; h &amp;lt;= max[litem]; h += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm? 'hht':'HH', {hour:h}, o);									
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + tmph + '&amp;lt;/td&amp;gt;';
							}
						}
						else{
							for (var m = o[litem+'Min']; m &amp;lt;= max[litem]; m += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + ((m &amp;lt; 10) ? '0' : '') + m + '&amp;lt;/td&amp;gt;';
							}
						}

						html += '&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;&amp;lt;/div&amp;gt;';
					}
					html += '&amp;lt;/dd&amp;gt;';
				}
				
				// Timezone
				var showTz = o.showTimezone !== null? o.showTimezone : this.support.timezone;
				html += '&amp;lt;dt class="ui_tpicker_timezone_label"' + (showTz ? '' : noDisplay) + '&amp;gt;' + o.timezoneText + '&amp;lt;/dt&amp;gt;';
				html += '&amp;lt;dd class="ui_tpicker_timezone" ' + (showTz ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the elements from string
				html += '&amp;lt;/dl&amp;gt;&amp;lt;/div&amp;gt;';
				var $tp = $(html);

				// if we only want time picker...
				if (o.timeOnly === true) {
					$tp.prepend('&amp;lt;div class="ui-widget-header ui-helper-clearfix ui-corner-all"&amp;gt;' + '&amp;lt;div class="ui-datepicker-title"&amp;gt;' + o.timeOnlyTitle + '&amp;lt;/div&amp;gt;' + '&amp;lt;/div&amp;gt;');
					$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();
				}
				
				// add sliders, adjust grids, add events
				for(i=0,l=tp_inst.units.length; i&amp;lt;l; i++){
					litem = tp_inst.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// add the slider
					tp_inst[litem+'_slider'] = tp_inst.control.create(tp_inst, $tp.find('.ui_tpicker_'+litem+'_slider'), litem, tp_inst[litem], o[litem+'Min'], max[litem], o['step'+uitem]);

					// adjust the grid and add click event
					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						size = 100 * gridSize[litem] * o[litem+'Grid'] / (max[litem] - o[litem+'Min']);
						$tp.find('.ui_tpicker_'+litem+' table').css({
							width: size + "%",
							marginLeft: o.isRTL? '0' : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL? ((size / (-2 * gridSize[litem])) + "%") : '0',
							borderCollapse: 'collapse'
						}).find("td").click(function(e){
								var $t = $(this),
									h = $t.html(),
									n = parseInt(h.replace(/[^0-9]/g),10),
									ap = h.replace(/[^apm]/ig),
									f = $t.data('for'); // loses scope, so we use data-for

								if(f == 'hour'){
									if(ap.indexOf('p') !== -1 &amp;amp;&amp;amp; n &amp;lt; 12){
										n += 12;
									}
									else{
										if(ap.indexOf('a') !== -1 &amp;amp;&amp;amp; n === 12){
											n = 0;
										}
									}
								}
								
								tp_inst.control.value(tp_inst, tp_inst[f+'_slider'], litem, n);

								tp_inst._onTimeChange();
								tp_inst._onSelectHandler();
							}).css({
								cursor: 'pointer',
								width: (100 / gridSize[litem]) + '%',
								textAlign: 'center',
								overflow: 'hidden'
							});
					} // end if grid &amp;gt; 0
				} // end for loop

				// Add timezone options
				this.timezone_select = $tp.find('.ui_tpicker_timezone').append('&amp;lt;select&amp;gt;&amp;lt;/select&amp;gt;').find("select");
				$.fn.append.apply(this.timezone_select,
				$.map(o.timezoneList, function(val, idx) {
					return $("&amp;lt;option /&amp;gt;").val(typeof val == "object" ? val.value : val).text(typeof val == "object" ? val.label : val);
				}));
				if (typeof(this.timezone) != "undefined" &amp;amp;&amp;amp; this.timezone !== null &amp;amp;&amp;amp; this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset()*-1;
					if (local_timezone == this.timezone) {
						selectLocalTimezone(tp_inst);
					} else {
						this.timezone_select.val(this.timezone);
					}
				} else {
					if (typeof(this.hour) != "undefined" &amp;amp;&amp;amp; this.hour !== null &amp;amp;&amp;amp; this.hour !== "") {
						this.timezone_select.val(o.timezone);
					} else {
						selectLocalTimezone(tp_inst);
					}
				}
				this.timezone_select.change(function() {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
				});
				// End timezone options
				
				// inject timepicker into datepicker
				var $buttonPanel = $dp.find('.ui-datepicker-buttonpane');
				if ($buttonPanel.length) {
					$buttonPanel.before($tp);
				} else {
					$dp.append($tp);
				}

				this.$timeObj = $tp.find('.ui_tpicker_time');

				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined;
				}

				// slideAccess integration: http://trentrichardson.com/2011/11/11/jquery-ui-sliders-and-touch-accessibility/
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
						
					setTimeout(function() { // fix for inline mode
						if ($tp.find('.ui-slider-access').length === 0) {
							$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);

							// fix any grids since sliders are shorter
							var sliderAccessWidth = $tp.find('.ui-slider-access:eq(0)').outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find('table:visible').each(function() {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl? 'marginRight':'marginLeft').toString().replace('%', ''),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + '%',
										css = { width: newWidth, marginRight: 0, marginLeft: 0 };
									css[rtl? 'marginRight':'marginLeft'] = newMarginLeft;
									$g.css(css);
								});
							}
						}
					}, 10);
				}
				// end slideAccess integration

				tp_inst._limitMinMaxDateTime(this.inst, true);
			}
		},

		/*
		* This function tries to limit the ability to go outside the
		* min/max date range
		*/
		_limitMinMaxDateTime: function(dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);

			if (!this._defaults.showTimepicker) {
				return;
			} // No time so nothing to check here

			if ($.datepicker._get(dp_inst, 'minDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'minDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, 'minDateTime'),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin;
				}

				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour &amp;lt;= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute &amp;lt;= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second &amp;lt;= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if(this.millisec &amp;lt;= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;lt; this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin;
									}
									this._defaults.microsecMin = this.microsecMinOriginal;
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal;
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal;
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal;
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal;
				}
			}

			if ($.datepicker._get(dp_inst, 'maxDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'maxDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, 'maxDateTime'),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax;
				}

				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour &amp;gt;= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute &amp;gt;= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second &amp;gt;= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec &amp;gt;= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;gt; this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax;
									}
									this._defaults.microsecMax = this.microsecMaxOriginal;
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal;
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal;
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal;
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal;
				}
			}

			if (adjustSliders !== undefined &amp;amp;&amp;amp; adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10);
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);

				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, 'hour', { min: this._defaults.hourMin, max: hourMax });
					this.control.value(this, this.hour_slider, 'hour', this.hour - (this.hour % this._defaults.stepHour));
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, 'minute', { min: this._defaults.minuteMin, max: minMax });
					this.control.value(this, this.minute_slider, 'minute', this.minute - (this.minute % this._defaults.stepMinute));
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, 'second', { min: this._defaults.secondMin, max: secMax });
					this.control.value(this, this.second_slider, 'second', this.second - (this.second % this._defaults.stepSecond));
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, 'millisec', { min: this._defaults.millisecMin, max: millisecMax });
					this.control.value(this, this.millisec_slider, 'millisec', this.millisec - (this.millisec % this._defaults.stepMillisec));
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, 'microsec', { min: this._defaults.microsecMin, max: microsecMax });
					this.control.value(this, this.microsec_slider, 'microsec', this.microsec - (this.microsec % this._defaults.stepMicrosec));
				}
			}

		},

		/*
		* when a slider moves, set the internal time...
		* on time change is also called when the time is updated in the text field
		*/
		_onTimeChange: function() {
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, 'hour') : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, 'minute') : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, 'second') : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, 'millisec') : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, 'microsec') : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;

			if (typeof(hour) == 'object') {
				hour = false;
			}
			if (typeof(minute) == 'object') {
				minute = false;
			}
			if (typeof(second) == 'object') {
				second = false;
			}
			if (typeof(millisec) == 'object') {
				millisec = false;
			}
			if (typeof(microsec) == 'object') {
				microsec = false;
			}
			if (typeof(timezone) == 'object') {
				timezone = false;
			}

			if (hour !== false) {
				hour = parseInt(hour, 10);
			}
			if (minute !== false) {
				minute = parseInt(minute, 10);
			}
			if (second !== false) {
				second = parseInt(second, 10);
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10);
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10);
			}

			var ampm = o[hour &amp;lt; 12 ? 'amNames' : 'pmNames'][0];

			// If the update was done in the input field, the input field should not be updated.
			// If the update was done using the sliders, update the input field.
			var hasChanged = (hour != this.hour || minute != this.minute || second != this.second || millisec != this.millisec || microsec != this.microsec 
								|| (this.ampm.length &amp;gt; 0 &amp;amp;&amp;amp; (hour &amp;lt; 12) != ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) 
								|| (this.timezone !== null &amp;amp;&amp;amp; timezone != this.timezone));

			if (hasChanged) {

				if (hour !== false) {
					this.hour = hour;
				}
				if (minute !== false) {
					this.minute = minute;
				}
				if (second !== false) {
					this.second = second;
				}
				if (millisec !== false) {
					this.millisec = millisec;
				}
				if (microsec !== false) {
					this.microsec = microsec;
				}
				if (timezone !== false) {
					this.timezone = timezone;
				}

				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0]);
				}

				this._limitMinMaxDateTime(this.inst, true);
			}
			if (this.support.ampm) {
				this.ampm = ampm;
			}

			// Updates the time within the timepicker
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if(pickerTimeFormat === o.timeFormat){
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix);
				}
				else{
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix);
				}
			}

			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime();
			}
		},

		/*
		* call custom onSelect.
		* bind to sliders slidestop, and grid click.
		*/
		_onSelectHandler: function() {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect &amp;amp;&amp;amp; inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this]);
			}
		},

		/*
		* update our input with the new date time..
		*/
		_updateDateTime: function(dp_inst) {
			dp_inst = this.inst || dp_inst;
			//var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
			var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay)),
				dateFmt = $.datepicker._get(dp_inst, 'dateFormat'),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null &amp;amp;&amp;amp; this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			
			// if a slider was changed but datepicker doesn't have a value yet, set it
			if(dp_inst.lastVal===""){
                dp_inst.currentYear=dp_inst.selectedYear;
                dp_inst.currentMonth=dp_inst.selectedMonth;
                dp_inst.currentDay=dp_inst.selectedDay;
            }

			/*
			* remove following lines to force every changes in date picker to change the input value
			* Bug descriptions: when an input field has a default value, and click on the field to pop up the date picker. 
			* If the user manually empty the value in the input field, the date picker will never change selected value.
			*/
			//if (dp_inst.lastVal !== undefined &amp;amp;&amp;amp; (dp_inst.lastVal.length &amp;gt; 0 &amp;amp;&amp;amp; this.$input.val().length === 0)) {
			//	return;
			//}

			if (this._defaults.timeOnly === true) {
				formattedDateTime = this.formattedTime;
			} else if (this._defaults.timeOnly !== true &amp;amp;&amp;amp; (this._defaults.alwaysSetTime || timeAvailable)) {
				formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix;
			}

			this.formattedDateTime = formattedDateTime;

			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate);
			} else if (this.$altInput &amp;amp;&amp;amp; this._defaults.timeOnly === false &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly === true) {
				this.$altInput.val(this.formattedTime);
				this.$input.val(this.formattedDate);
			} else if (this.$altInput) {
				this.$input.val(formattedDateTime);
				var altFormattedDateTime = '',
					altSeparator = this._defaults.altSeparator ? this._defaults.altSeparator : this._defaults.separator,
					altTimeSuffix = this._defaults.altTimeSuffix ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
				
				if(!this._defaults.timeOnly){
					if (this._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg);
					}
					else{
						altFormattedDateTime = this.formattedDate;
					}

					if (altFormattedDateTime){
						altFormattedDateTime += altSeparator;
					}
				}

				if(this._defaults.altTimeFormat){
					altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix;
				}
				else{
					altFormattedDateTime += this.formattedTime + altTimeSuffix;
				}
				this.$altInput.val(altFormattedDateTime);
			} else {
				this.$input.val(formattedDateTime);
			}

			this.$input.trigger("change");
		},

		_onFocus: function() {
			if (!this.$input.val() &amp;amp;&amp;amp; this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, 'timepicker');
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst);
						} catch (err) {
							$.timepicker.log(err);
						}
					}
				}
			}
		},

		/*
		* Small abstraction to control types
		* We can add more, just be sure to follow the pattern: create, options, value
		*/
		_controls: {
			// slider methods
			slider: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var rtl = tp_inst._defaults.isRTL; // if rtl go -60-&amp;gt;0 instead of 0-&amp;gt;60
					return obj.prop('slide', null).slider({
						orientation: "horizontal",
						value: rtl? val*-1 : val,
						min: rtl? max*-1 : min,
						max: rtl? min*-1 : max,
						step: step,
						slide: function(event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl? ui.value*-1:ui.value);
							tp_inst._onTimeChange();
						},
						stop: function(event, ui) {
							tp_inst._onSelectHandler();
						}
					});	
				},
				options: function(tp_inst, obj, unit, opts, val){
					if(tp_inst._defaults.isRTL){
						if(typeof(opts) == 'string'){
							if(opts == 'min' || opts == 'max'){
								if(val !== undefined){
									return obj.slider(opts, val*-1);
								}
								return Math.abs(obj.slider(opts));
							}
							return obj.slider(opts);
						}
						var min = opts.min, 
							max = opts.max;
						opts.min = opts.max = null;
						if(min !== undefined){
							opts.max = min * -1;
						}
						if(max !== undefined){
							opts.min = max * -1;
						}
						return obj.slider(opts);
					}
					if(typeof(opts) == 'string' &amp;amp;&amp;amp; val !== undefined){
							return obj.slider(opts, val);
					}
					return obj.slider(opts);
				},
				value: function(tp_inst, obj, unit, val){
					if(tp_inst._defaults.isRTL){
						if(val !== undefined){
							return obj.slider('value', val*-1);
						}
						return Math.abs(obj.slider('value'));
					}
					if(val !== undefined){
						return obj.slider('value', val);
					}
					return obj.slider('value');
				}
			},
			// select methods
			select: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var sel = '&amp;lt;select class="ui-timepicker-select" data-unit="'+ unit +'" data-min="'+ min +'" data-max="'+ max +'" data-step="'+ step +'"&amp;gt;',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;

					for(var i=min; i&amp;lt;=max; i+=step){						
						sel += '&amp;lt;option value="'+ i +'"'+ (i==val? ' selected':'') +'&amp;gt;';
						if(unit == 'hour'){
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig,'')), {hour:i}, tp_inst._defaults);
						}
						else if(unit == 'millisec' || unit == 'microsec' || i &amp;gt;= 10){ sel += i; }
						else {sel += '0'+ i.toString(); }
						sel += '&amp;lt;/option&amp;gt;';
					}
					sel += '&amp;lt;/select&amp;gt;';

					obj.children('select').remove();

					$(sel).appendTo(obj).change(function(e){
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
					});

					return obj;
				},
				options: function(tp_inst, obj, unit, opts, val){
					var o = {},
						$t = obj.children('select');
					if(typeof(opts) == 'string'){
						if(val === undefined){
							return $t.data(opts);
						}
						o[opts] = val;	
					}
					else{ o = opts; }
					return tp_inst.control.create(tp_inst, obj, $t.data('unit'), $t.val(), o.min || $t.data('min'), o.max || $t.data('max'), o.step || $t.data('step'));
				},
				value: function(tp_inst, obj, unit, val){
					var $t = obj.children('select');
					if(val !== undefined){
						return $t.val(val);
					}
					return $t.val();
				}
			}
		} // end _controls

	});

	$.fn.extend({
		/*
		* shorthand just to use timepicker..
		*/
		timepicker: function(o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);

			if (typeof o == 'object') {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				});
			}

			return $(this).each(function() {
				$.fn.datetimepicker.apply($(this), tmp_args);
			});
		},

		/*
		* extend timepicker to datepicker
		*/
		datetimepicker: function(o) {
			o = o || {};
			var tmp_args = arguments;

			if (typeof(o) == 'string') {
				if (o == 'getDate') {
					return $.fn.datepicker.apply($(this[0]), tmp_args);
				} else {
					return this.each(function() {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args);
					});
				}
			} else {
				return this.each(function() {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults);
				});
			}
		}
	});

	/*
	* Public Utility to parse date and time
	*/
	$.datepicker.parseDateTime = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec);
		}

		return parseRes.date;
	};

	/*
	* Public utility to parse time
	*/
	$.datepicker.parseTime = function(timeFormat, timeString, options) {		
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g,'').indexOf('Z') !== -1);

		// Strict parse requires the timeString to match the timeFormat exactly
		var strictParse = function(f, s, o){

			// pattern for standard and localized AM/PM markers
			var getPatternAmpm = function(amNames, pmNames) {
				var markers = [];
				if (amNames) {
					$.merge(markers, amNames);
				}
				if (pmNames) {
					$.merge(markers, pmNames);
				}
				markers = $.map(markers, function(val) {
					return val.replace(/[.*+?|()\[\]{}\\]/g, '\\$&amp;amp;');
				});
				return '(' + markers.join('|') + ')?';
			};

			// figure out position of time elements.. cause js cant do named captures
			var getFormatPositions = function(timeFormat) {
				var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
					orders = {
						h: -1,
						m: -1,
						s: -1,
						l: -1,
						c: -1,
						t: -1,
						z: -1
					};

				if (finds) {
					for (var i = 0; i &amp;lt; finds.length; i++) {
						if (orders[finds[i].toString().charAt(0)] == -1) {
							orders[finds[i].toString().charAt(0)] = i + 1;
						}
					}
				}
				return orders;
			};

			var regstr = '^' + f.toString()
					.replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
							var ml = match.length;
							switch (match.charAt(0).toLowerCase()) {
								case 'h': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'm': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 's': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'l': return '(\\d?\\d?\\d)';
								case 'c': return '(\\d?\\d?\\d)';
								case 'z': return '(z|[-+]\\d\\d:?\\d\\d|\\S+)?';
								case 't': return getPatternAmpm(o.amNames, o.pmNames);
								default:    // literal escaped in quotes
									return '(' + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function (m) { return "\\" + m; }) + ')?';
							}
						})
					.replace(/\s/g, '\\s?') +
					o.timeSuffix + '$',
				order = getFormatPositions(f),
				ampm = '',
				treg;

			treg = s.match(new RegExp(regstr, 'i'));

			var resTime = {
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0
			};

			if (treg) {
				if (order.t !== -1) {
					if (treg[order.t] === undefined || treg[order.t].length === 0) {
						ampm = '';
						resTime.ampm = '';
					} else {
						ampm = $.inArray(treg[order.t].toUpperCase(), o.amNames) !== -1 ? 'AM' : 'PM';
						resTime.ampm = o[ampm == 'AM' ? 'amNames' : 'pmNames'][0];
					}
				}

				if (order.h !== -1) {
					if (ampm == 'AM' &amp;amp;&amp;amp; treg[order.h] == '12') {
						resTime.hour = 0; // 12am = 0 hour
					} else {
						if (ampm == 'PM' &amp;amp;&amp;amp; treg[order.h] != '12') {
							resTime.hour = parseInt(treg[order.h], 10) + 12; // 12pm = 12 hour, any other pm = hour + 12
						} else {
							resTime.hour = Number(treg[order.h]);
						}
					}
				}

				if (order.m !== -1) {
					resTime.minute = Number(treg[order.m]);
				}
				if (order.s !== -1) {
					resTime.second = Number(treg[order.s]);
				}
				if (order.l !== -1) {
					resTime.millisec = Number(treg[order.l]);
				}
				if (order.c !== -1) {
					resTime.microsec = Number(treg[order.c]);
				}
				if (order.z !== -1 &amp;amp;&amp;amp; treg[order.z] !== undefined) {
					resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z]);
				}


				return resTime;
			}
			return false;
		};// end strictParse

		// First try JS Date, if that fails, use strictParse
		var looseParse = function(f,s,o){
			try{
				var d = new Date('2012-01-01 '+ s);
				if(isNaN(d.getTime())){
					d = new Date('2012-01-01T'+ s);
					if(isNaN(d.getTime())){
						d = new Date('01/01/2012 '+ s);
						if(isNaN(d.getTime())){
							throw "Unable to parse time with native Date: "+ s;
						}
					}
				}

				return {
					hour: d.getHours(),
					minute: d.getMinutes(),
					second: d.getSeconds(),
					millisec: d.getMilliseconds(),
					microsec: d.getMicroseconds(),
					timezone: d.getTimezoneOffset()*-1
				};
			}
			catch(err){
				try{
					return strictParse(f,s,o);
				}
				catch(err2){
					$.timepicker.log("Unable to parse \ntimeString: "+ s +"\ntimeFormat: "+ f);
				}				
			}
			return false;
		}; // end looseParse
		
		if(typeof o.parse === "function"){
			return o.parse(timeFormat, timeString, o);
		}
		if(o.parse === 'loose'){
			return looseParse(timeFormat, timeString, o);
		}
		return strictParse(timeFormat, timeString, o);
	};

	/*
	* Public utility to format the time
	* format = string format of the time
	* time = a {}, not a Date() for timezones
	* options = essentially the regional[].. amNames, pmNames, ampm
	*/
	$.datepicker.formatTime = function(format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			timezone: 0
		}, time);

		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);

		if (hour &amp;gt; 11) {
			ampmName = options.pmNames[0];
		}

		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|('.*?'|".*?"))/g, function(match) {
		switch (match) {
			case 'HH':
				return ('0' + hour).slice(-2);
			case 'H':
				return hour;
			case 'hh':
				return ('0' + convert24to12(hour)).slice(-2);
			case 'h':
				return convert24to12(hour);
			case 'mm':
				return ('0' + time.minute).slice(-2);
			case 'm':
				return time.minute;
			case 'ss':
				return ('0' + time.second).slice(-2);
			case 's':
				return time.second;
			case 'l':
				return ('00' + time.millisec).slice(-3);
			case 'c':
				return ('00' + time.microsec).slice(-3);
			case 'z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, false);
			case 'Z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, true);
			case 'T': 
				return ampmName.charAt(0).toUpperCase();
			case 'TT': 
				return ampmName.toUpperCase();
			case 't':
				return ampmName.charAt(0).toLowerCase();
			case 'tt':
				return ampmName.toLowerCase();
			default:
				return match.replace(/\'/g, "") || "'";
			}
		});

		tmptime = $.trim(tmptime);
		return tmptime;
	};

	/*
	* the bad hack :/ override datepicker so it doesnt close on select
	// inspired: http://stackoverflow.com/questions/1252512/jquery-datepicker-prevent-closing-picker-when-clicking-a-date/1762378#1762378
	*/
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function(id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			tp_inst._limitMinMaxDateTime(inst, true);
			inst.inline = inst.stay_open = true;
			//This way the onSelect handler called from calendarpicker get the full dateTime
			this._base_selectDate(id, dateStr);
			inst.inline = inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst);
		} else {
			this._base_selectDate(id, dateStr);
		}
	};

	/*
	* second bad hack :/ override datepicker so it triggers an event when changing the input field
	* and does not redraw the datepicker on every selectDate event
	*/
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function(inst) {

		// don't popup the datepicker if there is another instance already opened
		var input = inst.input[0];
		if ($.datepicker._curInst &amp;amp;&amp;amp; $.datepicker._curInst != inst &amp;amp;&amp;amp; $.datepicker._datepickerShowing &amp;amp;&amp;amp; $.datepicker._lastInput != input) {
			return;
		}

		if (typeof(inst.stay_open) !== 'boolean' || inst.stay_open === false) {

			this._base_updateDatepicker(inst);

			// Reload the time control when changing something in the input text field.
			var tp_inst = this._get(inst, 'timepicker');
			if (tp_inst) {
				tp_inst._addTimePicker(inst);
			}
		}
	};

	/*
	* third bad hack :/ override datepicker so it allows spaces and colon in the input field
	*/
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if ($.datepicker._get(inst, 'constrainInput')) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null? tp_inst._defaults.showTimezone : tp_inst.support.timezone,					
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat')),
					datetimeChars = tp_inst._defaults.timeFormat.toString()
											.replace(/[hms]/g, '')
											.replace(/TT/g, ampm ? 'APM' : '')
											.replace(/Tt/g, ampm ? 'AaPpMm' : '')
											.replace(/tT/g, ampm ? 'AaPpMm' : '')
											.replace(/T/g, ampm ? 'AP' : '')
											.replace(/tt/g, ampm ? 'apm' : '')
											.replace(/t/g, ampm ? 'ap' : '') + 
											" " + tp_inst._defaults.separator + 
											tp_inst._defaults.timeSuffix + 
											(tz ? tp_inst._defaults.timezoneList.join('') : '') + 
											(tp_inst._defaults.amNames.join('')) + (tp_inst._defaults.pmNames.join('')) + 
											dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr &amp;lt; ' ' || !dateChars || datetimeChars.indexOf(chr) &amp;gt; -1);
			}
		}

		return $.datepicker._base_doKeyPress(event);
	};

	/*
	* Fourth bad hack :/ override _updateAlternate function used in inline mode to init altField
	*/
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	/* Update any alternate field to synchronise with the main field. */
	$.datepicker._updateAlternate = function(inst) {
		var tp_inst = this._get(inst, 'timepicker');
		if(tp_inst){
			var altField = tp_inst._defaults.altField;
			if (altField) { // update alternate field too
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = '', 
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator, 
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if(!tp_inst._defaults.timeOnly &amp;amp;&amp;amp; !tp_inst._defaults.altFieldTimeOnly &amp;amp;&amp;amp; date !== null){
					if(tp_inst._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime;
					}
					else{
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime;
					}
				}
				$(altField).val(altFormattedDateTime);
			}
		}
		else{
			$.datepicker._base_updateAlternate(inst);
		}
	};

	/*
	* Override key up event to sync manual input changes.
	*/
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst);
				} catch (err) {
					$.timepicker.log(err);
				}
			}
		}

		return $.datepicker._base_doKeyUp(event);
	};

	/*
	* override "Today" button to also grab the time.
	*/
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function(id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		this._base_gotoToday(id);
		var tp_inst = this._get(inst, 'timepicker');
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		$('.ui-datepicker-today', $dp).click();
	};

	/*
	* Disable &amp;amp; enable the Time in the datetimepicker
	*/
	$.datepicker._disableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst);
		}
	};

	$.datepicker._enableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst); // Could be disabled on page load
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create our own set time function
	*/
	$.datepicker._setTime = function(inst, date) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var defaults = tp_inst._defaults;

			// calling _setTime with no date sets time to defaults
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;

			//check if within min/max times.. 
			tp_inst._limitMinMaxDateTime(inst, true);

			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create new public method to set only time, callable as $().datepicker('setTime', date)
	*/
	$.datepicker._setTimeDatepicker = function(target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date == "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec);
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds());
				}
				if (tp_date.toString() == 'Invalid Date') {
					tp_date = undefined;
				}
				this._setTime(inst, tp_date);
			}
		}

	};

	/*
	* override setDate() to allow setting time too within Date object
	*/
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function(target, date) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		if(typeof(date) === 'string'){
			date = new Date(date);
			if(!date.getTime()){
				$.timepicker.log("Error creating Date object from string.");
			}
		}

		var tp_inst = this._get(inst, 'timepicker');
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds());
		} else {
			tp_date = date;
		}
		
		// This is important if you are using the timezone option, javascript's Date 
		// object will only return the timezone offset for the current locale, so we 
		// adjust it accordingly.  If not using timezone option this won't matter..
		// If a timezone is different in tp, keep the timezone as is
		if(tp_inst){
			// look out for DST if tz wasn't specified
			if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
				tp_inst.timezone = tp_date.getTimezoneOffset()*-1;
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone);
		}

		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true);
	};

	/*
	* override getDate() to allow getting time too within Date object
	*/
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function(target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			// if it hasn't yet been defined, grab from field
			if(inst.lastVal === undefined){
				this._setDateFromField(inst, noDefault);
			}

			var date = this._getDate(inst);
			if (date &amp;amp;&amp;amp; tp_inst._parseTime($(target).val(), tp_inst.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);

				// This is important if you are using the timezone option, javascript's Date 
				// object will only return the timezone offset for the current locale, so we 
				// adjust it accordingly.  If not using timezone option this won't matter..
				if(tp_inst.timezone != null){
					// look out for DST if tz wasn't specified
					if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
						tp_inst.timezone = date.getTimezoneOffset()*-1;
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
				}
			}
			return date;
		}
		return this._base_getDateDatepicker(target, noDefault);
	};

	/*
	* override parseDate() because UI 1.8.14 throws an error about "Extra characters"
	* An option in datapicker to ignore extra format characters would be nicer.
	*/
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function(format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings);
		} catch (err) {
			// Hack!  The error message ends with a colon, a space, and
			// the "extra" characters.  We rely on that instead of
			// attempting to perfectly reproduce the parsing algorithm.
			if (err.indexOf(":") &amp;gt;= 0) {
				date = this._base_parseDate(format, value.substring(0,value.length-(err.length-err.indexOf(':')-2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format);
			} else {
				throw err;
			}
		}
		return date;
	};

	/*
	* override formatDate to set date with time to the input
	*/
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function(inst, day, month, year) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val();
		}
		return this._base_formatDate(inst);
	};

	/*
	* override options setter to add time to maxDate(Time) and minDate(Time). MaxDate
	*/
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function(target, name, value) {
		var inst = this._getInst(target),
	        name_clone;
		if (!inst) {
			return null;
		}

		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop;
		    if (typeof name == 'string') { // if min/max was set with the string
		        if (name === 'minDate' || name === 'minDateTime') {
		            min = value;
		        } else if (name === 'maxDate' || name === 'maxDateTime') {
		            max = value;
		        } else if (name === 'onSelect') {
		            onselect = value;
		        } else if (overrides.hasOwnProperty(name)) {
		            if (typeof (value) === 'undefined') {
		                return overrides[name];
		            }
		            fns[name] = value;
		            name_clone = {}; //empty results in exiting function after overrides updated
		        }
		    } else if (typeof name == 'object') { //if min/max was set with the JSON
		        if (name.minDate) {
		            min = name.minDate;
		        } else if (name.minDateTime) {
		            min = name.minDateTime;
		        } else if (name.maxDate) {
		            max = name.maxDate;
		        } else if (name.maxDateTime) {
		            max = name.maxDateTime;
		        }
		        for (prop in overrides) {
		            if (overrides.hasOwnProperty(prop) &amp;amp;&amp;amp; name[prop]) {
		                fns[prop] = name[prop];
		            }
		        }
		    }
		    for (prop in fns) {
		        if (fns.hasOwnProperty(prop)) {
		            overrides[prop] = fns[prop];
		            if (!name_clone) { name_clone = $.extend({}, name);}
		            delete name_clone[prop];
		        }
		    }
		    if (name_clone &amp;amp;&amp;amp; isEmptyObject(name_clone)) { return; }
		    if (min) { //if min was set
		        if (min === 0) {
		            min = new Date();
		        } else {
		            min = new Date(min);
		        }
		        tp_inst._defaults.minDate = min;
		        tp_inst._defaults.minDateTime = min;
		    } else if (max) { //if max was set
		        if (max === 0) {
		            max = new Date();
		        } else {
		            max = new Date(max);
		        }
		        tp_inst._defaults.maxDate = max;
		        tp_inst._defaults.maxDateTime = max;
		    } else if (onselect) {
		        tp_inst._defaults.onSelect = onselect;
		    }
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name);
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
	};
	
	/*
	* jQuery isEmptyObject does not check hasOwnProperty - if someone has added to the object prototype,
	* it will return false for all objects
	*/
	var isEmptyObject = function(obj) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(obj)) {
				return false;
			}
		}
		return true;
	};

	/*
	* jQuery extend now ignores nulls!
	*/
	var extendRemove = function(target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] === null || props[name] === undefined) {
				target[name] = props[name];
			}
		}
		return target;
	};

	/*
	* Determine by the time format which units are supported
	* Returns an object of booleans for each unit
	*/
	var detectSupport = function(timeFormat){
		var tf = timeFormat.replace(/\'.*?\'/g,'').toLowerCase(), // removes literals
			isIn = function(f, t){ // does the format contain the token?
					return f.indexOf(t) !== -1? true:false; 
				};
		return {
				hour: isIn(tf,'h'),
				minute: isIn(tf,'m'),
				second: isIn(tf,'s'),
				millisec: isIn(tf,'l'),
				microsec: isIn(tf,'c'),
				timezone: isIn(tf,'z'),
				ampm: isIn(tf,'t') &amp;amp;&amp;amp; isIn(timeFormat,'h'),
				iso8601: isIn(timeFormat, 'Z')
			};
	};

	/*
	* Converts 24 hour format into 12 hour
	* Returns 12 hour without leading 0
	*/
	var convert24to12 = function(hour) {
		if (hour &amp;gt; 12) {
			hour = hour - 12;
		}

		if (hour === 0) {
			hour = 12;
		}

		return String(hour);
	};

	/*
	* Splits datetime string into date ans time substrings.
	* Throws exception when date can't be parsed
	* Returns [dateString, timeString]
	*/
	var splitDateTime = function(dateFormat, dateTimeString, dateSettings, timeSettings) {
		try {
			// The idea is to get the number separator occurances in datetime and the time format requested (since time has 
			// fewer unknowns, mostly numbers and am/pm). We will use the time pattern to split.
			var separator = timeSettings &amp;amp;&amp;amp; timeSettings.separator ? timeSettings.separator : $.timepicker._defaults.separator,
				format = timeSettings &amp;amp;&amp;amp; timeSettings.timeFormat ? timeSettings.timeFormat : $.timepicker._defaults.timeFormat,
				timeParts = format.split(separator), // how many occurances of separator may be in our format?
				timePartsLen = timeParts.length,
				allParts = dateTimeString.split(separator),
				allPartsLen = allParts.length;

			if (allPartsLen &amp;gt; 1) {
				return [
						allParts.splice(0,allPartsLen-timePartsLen).join(separator),
						allParts.splice(0,timePartsLen).join(separator)
					];
			}

		} catch (err) {
			$.timepicker.log('Could not split the date from the time. Please check the following datetimepicker options' +
					"\nthrown error: " + err +
					"\ndateTimeString" + dateTimeString +
					"\ndateFormat = " + dateFormat +
					"\nseparator = " + timeSettings.separator +
					"\ntimeFormat = " + timeSettings.timeFormat);

			if (err.indexOf(":") &amp;gt;= 0) {
				// Hack!  The error message ends with a colon, a space, and
				// the "extra" characters.  We rely on that instead of
				// attempting to perfectly reproduce the parsing algorithm.
				var dateStringLength = dateTimeString.length - (err.length - err.indexOf(':') - 2),
					timeString = dateTimeString.substring(dateStringLength);

				return [$.trim(dateTimeString.substring(0, dateStringLength)), $.trim(dateTimeString.substring(dateStringLength))];

			} else {
				throw err;
			}
		}
		return [dateTimeString, ''];
	};

	/*
	* Internal function to parse datetime interval
	* Returns: {date: Date, timeObj: Object}, where
	*   date - parsed date without time (type Date)
	*   timeObj = {hour: , minute: , second: , millisec: , microsec: } - parsed time. Optional
	*/
	var parseDateTimeInternal = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var date;
		var splitRes = splitDateTime(dateFormat, dateTimeString, dateSettings, timeSettings);
		date = $.datepicker._base_parseDate(dateFormat, splitRes[0], dateSettings);
		if (splitRes[1] !== '') {
			var timeString = splitRes[1],
				parsedTime = $.datepicker.parseTime(timeFormat, timeString, timeSettings);

			if (parsedTime === null) {
				throw 'Wrong time format';
			}
			return {
				date: date,
				timeObj: parsedTime
			};
		} else {
			return {
				date: date
			};
		}
	};

	/*
	* Internal function to set timezone_select to the local timezone
	*/
	var selectLocalTimezone = function(tp_inst, date) {
		if (tp_inst &amp;amp;&amp;amp; tp_inst.timezone_select) {
			var now = typeof date !== 'undefined' ? date : new Date();
			tp_inst.timezone_select.val(now.getTimezoneOffset()*-1);
		}
	};

	/*
	* Create a Singleton Insance
	*/
	$.timepicker = new Timepicker();

	/**
	 * Get the timezone offset as string from a date object (eg '+0530' for UTC+5.5)
	 * @@param  number if not a number this value is returned
	 * @@param boolean if true formats in accordance to iso8601 "+12:45"
	 * @@return string
	 */
	$.timepicker.timezoneOffsetString = function(tzMinutes, iso8601) {
		if(isNaN(tzMinutes) || tzMinutes &amp;gt; 840){
			return tzMinutes;
		}

		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601? ':':'',
			tz = (off &amp;gt;= 0 ? '+' : '-') + ('0' + (hours * 101).toString()).slice(-2) + iso + ('0' + (minutes * 101).toString()).slice(-2);
		
		if(tz == '+00:00'){
			return 'Z';
		}
		return tz;
	};

	/**
	 * Get the number in minutes that represents a timezone string
	 * @@param  string formated like "+0500", "-1245"
	 * @@return number
	 */
	$.timepicker.timezoneOffsetNumber = function(tzString) {
		tzString = tzString.toString().replace(':',''); // excuse any iso8601, end up with "+1245"

		if(tzString.toUpperCase() === 'Z'){ // if iso8601 with Z, its 0 minute offset
			return 0;
		}

		if(!/^(\-|\+)\d{4}$/.test(tzString)){ // possibly a user defined tz, so just give it back
			return tzString;
		}

		return ((tzString.substr(0,1) =='-'? -1 : 1) * // plus or minus
					((parseInt(tzString.substr(1,2),10)*60) + // hours (converted to minutes)
					parseInt(tzString.substr(3,2),10))); // minutes
	};

	/**
	 * No way to set timezone in js Date, so we must adjust the minutes to compensate. (think setDate, getDate)
	 * @@param  date
	 * @@param  string formated like "+0500", "-1245"
	 * @@return date
	 */
	$.timepicker.timezoneAdjust = function(date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if(!isNaN(toTz)){
			date.setMinutes(date.getMinutes()*1 + (date.getTimezoneOffset()*-1 - toTz*1) );
		}
		return date;
	};

	/**
	 * Calls `timepicker()` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * n.b. The input value must be correctly formatted (reformatting is not supported)
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the timepicker() call
	 * @@return jQuery
	 */
	$.timepicker.timeRange = function(startTime, endTime, options) {
		return $.timepicker.handleRange('timepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datetimepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@return jQuery
	 */
	$.timepicker.datetimeRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datetimepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.dateRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.handleRange = function(method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0, // min allowed interval in milliseconds
			maxInterval: 0, // max allowed interval in milliseconds
			start: {},      // options for start picker
			end: {}         // options for end picker
		}, options);

		$.fn[method].call(startTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), endTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), endTime, 'minDate');
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), startTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), startTime, 'maxDate');
			}
		}, options, options.end));

		checkDates(startTime, endTime);
		selected(startTime, endTime, 'minDate');
		selected(endTime, startTime, 'maxDate');

		function checkDates(changed, other) {
			var startdt = startTime[method]('getDate'),
				enddt = endTime[method]('getDate'),
				changeddt = changed[method]('getDate');

			if(startdt !== null){
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());

				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);

				if(options.minInterval &amp;gt; 0 &amp;amp;&amp;amp; minDate &amp;gt; enddt){ // minInterval check
					endTime[method]('setDate',minDate);
				}
				else if(options.maxInterval &amp;gt; 0 &amp;amp;&amp;amp; maxDate &amp;lt; enddt){ // max interval check
					endTime[method]('setDate',maxDate);
				}
				else if (startdt &amp;gt; enddt) {
					other[method]('setDate',changeddt);
				}
			}
		}

		function selected(changed, other, option) {
			if (!changed.val()) {
				return;
			}
			var date = changed[method].call(changed, 'getDate');
			if(date !== null &amp;amp;&amp;amp; options.minInterval &amp;gt; 0){
				if(option == 'minDate'){
					date.setMilliseconds(date.getMilliseconds() + options.minInterval); 
				}
				if(option == 'maxDate'){
					date.setMilliseconds(date.getMilliseconds() - options.minInterval);
				}
			}
			if (date.getTime) {
				other[method].call(other, 'option', option, date);
			}
		}
		return $([startTime.get(0), endTime.get(0)]);
	};

	/**
	 * Log error or data to the console during error or debugging
	 * @@param  Object err pass any type object to log to the console during error or debugging
	 * @@return void
	 */
	$.timepicker.log = function(err){
		if(window.console){
			console.log(err);
		}
	};

	/*
	* Microsecond support
	*/
	if(!Date.prototype.getMicroseconds){
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function(){ return this.microseconds; };
		Date.prototype.setMicroseconds = function(m){ 
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m/1000));
			this.microseconds = m%1000;
			return this;
		};
	}

	/*
	* Keep up with the version
	*/
	$.timepicker.version = "1.3.1";

})(jQuery);
jQuery.noConflict();
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;datetimepicker-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;e73a652e-09fc-4c71-8e7a-e2525a2d2a99&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
function replaceAllString(oriStr, strTarget, strSubString ){
   var strText = oriStr;
   var intIndexOfMatch = strText.indexOf( strTarget );
   while (intIndexOfMatch != -1){
      strText = strText.replace( strTarget, strSubString )
      intIndexOfMatch = strText.indexOf( strTarget );
   }
   return( strText );
}
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&amp;amp;]" + name + "=([^&amp;amp;#]*)"),
    results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
};


   var jobName= getParameterByName('job')
   var fromDate= getParameterByName('fromDate')
   var toDate= getParameterByName('toDate')
   var limit= getParameterByName('limit')
   var selectedIstIid = getParameterByName('IstIid')

  $("#jobname").ready(function(){
   $("#jobname").text(jobName)
   var convertedJobName = replaceAllString(jobName, ".", "_")
   $("#IstIid" + convertedJobName).ready(function(){
     $("#IstIid" + convertedJobName).css("display","block")
     $("#select_" + convertedJobName).ready(function(){
        $("#select_" + convertedJobName).val(selectedIstIid)
     });
   });
 });

  $("#fromDate").ready(function(){
   $("#from-date").val(fromDate)
 });

  $("#toDate").ready(function(){
   $("#to-date").val(toDate)
 });

  $("#limit").ready(function(){
   if(limit!=""){
    $("#limit").val(limit)
   }
 });
 // Get data with ajax
 function ajax_getData(jobName,fromDate,toDate,limit ){
       var convertedJobName = replaceAllString(jobName, ".", "_")
       var istIid = $("#select_" + convertedJobName).val()
       window.location="/xwiki/bin/view/WiperDog/WebHome?job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid="+istIid;
 			/*$.ajax({
			 type: "GET",
			 url:"/xwiki/bin/get/Sandbox/DescriptionForJob?outputSyntax=plain&amp;amp;job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid"+selectedIstIid,
			 success : function(result){
				$("#jobname").html(jobName)
				$("#display").text('[[]]' + result)
			 }
		   });*/
 }
	$("#treemenu2 a").click(function(){
		 var limit = 10
		 var fromDate=""
		 var toDate = ""
		 jobName= $(this).text()
                 $("#jobname").html(jobName)
                 var convertedJobName = replaceAllString(jobName, ".", "_")
                 $("#listIstIid &amp;gt; div").css("display","none")
                 $("#IstIid" + convertedJobName).css("display","block")
		 //ajax_getData(jobName,fromDate,toDate,limit )

	});

	$("#from-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
		dateFormat: 'yy-mm-dd',
	});
	$("#to-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
			dateFormat: 'yy-mm-dd',

	});
	 $("#get-data").on("click",function(){
		var fromDate = $("#from-date").val()
		var toDate =  $("#to-date").val()
		 if( toDate!= "" ){
			  if(fromDate != ""){
				  if($("#from-date").datepicker( "getDate" ) &amp;gt; $("#to-date").datepicker( "getDate" )){
				  alert("'From date' cannot start later than 'To date'")
				  return false
				  }
			  }
		 }
		 limit = $("#limit").val()
		 ajax_getData(jobName,fromDate,toDate,limit )
                 
                 /** Get livetable data */
                 //alert('job = ' + $("#jobname").text() + ',   istIid  = '+ selectedIstIid)
                 var dataModelUrl = '/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job='+$("#jobname").text()+'&amp;amp;limit='
                     +$("#limit").text()+'&amp;amp;fromDate='
	             +fromDate + '&amp;amp;toDate=' + toDate +   '&amp;amp;pager=pager2&amp;amp;genp=1&amp;amp;istIid='+selectedIstIid
		 var jqxhr = $.getJSON(dataModelUrl, function(data) {
				$("#livetableList").jqGrid(data);
				$("#livetableList").jqGrid('navGrid', "#livetablePager", {
				    edit : false,
				    add : false,
				    del : false
				});
			})
	});
        
jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;process&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;881686cc-1bfc-456e-b8ab-71334c4a45e5&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){

$(function () {
    function drawLineChart(xAxis, series, container, data_detail){
        var dataXAxis = xAxis
        var dataSeries = series
        var detail = data_detail

			$('#containerline' + container).highcharts({

				chart: {
					type:'line'
				},
				title: {
					text: container
				},
				tooltip :{
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				xAxis: dataXAxis ,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				series: dataSeries
			});
		};

		function drawBarChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerbar' + container).highcharts({
				chart: {
					type: 'column'
				},
				title: {
					text: container
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {

					column: {
						pointPadding: 0.2,
						borderWidth: 0
					}
				},
				series: dataSeries
			});
		}

		function drawAreaChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail
			$('#containerarea' + container).highcharts({
				chart: {
					type: 'area'
				},
				title: {
					text: container
				},
				subtitle: {
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					},
					labels: {
						formatter: function() {
							return this.value / 1000;
						}
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {
					area: {
						stacking: 'normal',
						lineColor: '#666666',
						lineWidth: 1,
						marker: {
							lineWidth: 1,
							lineColor: '#666666'
						}
					}
				},
				series: dataSeries
			});
		};

		function drawPieChart(data, container){
			var dataPie = data
			$(document).ready(function () {
				// Build the chart
				$('#container' + container).highcharts({
					chart: {
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: dataPie[0].name
					},
					tooltip: {
						pointFormat: '{series.name}: &amp;lt;b&amp;gt;{point.percentage:.1f}%&amp;lt;/b&amp;gt;'
					},
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							dataLabels: {
								enabled: false
							},
							showInLegend: true
						}
					},
					series: dataPie
				});
			});
		}

		// LINE
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonline_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonline");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Line chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						if(data_all[0][i].series[0].name == null){
							data_all[0][i].series[0].name = lstContainer[0][i]
						}
						drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
					}
				}
			}
		});

		// BAR
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonbar_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonbar");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Bar chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						drawBarChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
					}
				}
			}
		});

		// AREA
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonarea_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonarea");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				// data to display on tooltip
				var data_detail = data_all[0]
				// draw Area Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					drawAreaChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
				}
			}
		});

		// PIE
		$("#piechart").ready(function(){

			var array = $("#jsons&amp;gt;.jsonpie");
			var arrayContainer = $("#jsons&amp;gt;.lstcontainerpie");
			var lstContainer = [];
			var data_all = [];
			for(var i=0;i&amp;lt;array.length;i++){
				data_all[i] = jQuery.parseJSON(array[i].value)
				lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)

			}
			if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
				// data to display on tooltip
				// draw Pie Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					var finalData = []
					finalData[0] = data_all[0][i]
					drawPieChart(finalData, lstContainer[0][i])
				}
			}
		});
	});
	jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;d5873d92-b78b-42fc-9407-46d166204b88&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;/* css for timepicker */
.ui-timepicker-div .ui-widget-header { 
margin-bottom: 8px;
 }

.ui-timepicker-div dl { text-align: left; }
.ui-timepicker-div dl dt { height: 25px; margin-bottom: -25px; }
.ui-timepicker-div dl dd { margin: 0 10px 10px 65px; }
.ui-timepicker-div td { font-size: 90%; }
.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }

.ui-timepicker-rtl{ direction: rtl; }
.ui-timepicker-rtl dl { text-align: right; }
.ui-timepicker-rtl dl dd { margin: 0 65px 10px 10px; }
#ui-datepicker-div{
 position:relative;
 width:auto;
 height:auto
}
&lt;/code&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;datetimepicker -css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;1201fb1a-e9c1-4731-8c74-2ea8c0071959&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;.displayblock {
  border:2px solid;
  -webkit-border-radius:6px;
  background:gray;
  float: left;
  width:100%;
}

.displaypie {
  border:1px solid;
  -webkit-border-radius:6px;
  background:gray;
  width: 48%;
  float: left; 
  height: 300px;
}

.subtype {
  margin-top: 50px;
  font-size: 2em;
  color: red;
}&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;content&gt;{{include document="Lib.DataToDrawChart"/}}
{{include document="Lib.MongoDBConnection"/}}
{{velocity}}
$xwiki.jsx.use('Lib.JQueryUILib')
$xwiki.ssx.use('Lib.MenuGenerator')
$xwiki.jsx.use('Lib.MenuGenerator')
$xwiki.ssx.use('Lib.JQueryUILib')
{{/velocity}}
{{include document="Lib.MenuGenerator"/}}
{{html wiki="true" clean="false"}}
&amp;lt;div id="viewer"&amp;gt;
&amp;lt;table style="text-align:left"  &amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th &amp;gt;Job name&amp;lt;/th&amp;gt;
  &amp;lt;td colspan=3&amp;gt;&amp;lt;div id="jobname"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
{{groovy}}
import org.xwiki.context.*

def ec = services.component.getInstance(Execution.class).getContext()
def mapJobIstIid = ec.getProperty("mapJobIstIid")

println '{{html clean="false" wiki="false"}}'
println '&amp;lt;tr&amp;gt;'
println '&amp;lt;th&amp;gt;IstIid&amp;lt;/th&amp;gt;'
println '&amp;lt;td colspan=3&amp;gt;'
mapJobIstIid.each{jobEntry-&amp;gt;
  def convertedJobKey = jobEntry.key.replaceAll("\\.","_")
  println "&amp;lt;div id='listIstIid'&amp;gt;"
  println "&amp;lt;div id=IstIid${convertedJobKey} style='display:none'&amp;gt;"
  println "&amp;lt;select id=select_${convertedJobKey}&amp;gt;"
  jobEntry.value.each{
     println "&amp;lt;option value=\"$it\"&amp;gt;$it&amp;lt;/option&amp;gt;"
  }
  println "&amp;lt;/select&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
}
println '&amp;lt;/td&amp;gt;'
println '&amp;lt;/tr&amp;gt;'
println '{{/html}}'
{{/groovy}}
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data monitor from&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="from-date" id="from-date"/&amp;gt;&amp;lt;/td&amp;gt;
  &amp;lt;th&amp;gt;Data monitor to&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="to-date" id="to-date"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data records limit &amp;lt;/th&amp;gt;
  &amp;lt;td &amp;gt;
     &amp;lt;select id="limit"&amp;gt;
       &amp;lt;option value=5&amp;gt;5&amp;lt;/option&amp;gt;
       &amp;lt;option value=10&amp;gt;10&amp;lt;/option&amp;gt;
       &amp;lt;option value=15&amp;gt;15&amp;lt;/option&amp;gt;
       &amp;lt;option value=20&amp;gt;20&amp;lt;/option&amp;gt;
     &amp;lt;/select&amp;gt;
  &amp;lt;/td&amp;gt;
  &amp;lt;td colspan=3 &amp;gt;&amp;lt;input type="button" value="View Data" id="get-data" class="button"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;
    &amp;lt;table id="livetableList"&amp;gt;&amp;lt;tr&amp;gt;&amp;lt;td&amp;gt;livetableList&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;
    &amp;lt;div id="livetablePager"&amp;gt;livetablePager&amp;lt;/div&amp;gt;
&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;&amp;lt;div id="display"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
&amp;lt;/table&amp;gt;

&amp;lt;/div&amp;gt; 
 &amp;lt;/body&amp;gt;

{{/html}}
{{groovy}}
import groovy.json.*
xwiki.jsx.use("Lib.Highcharts")

if(request.xpage == "plain") {
	response.setContentType('text/plain')
}

def listData = []
def job = request.get("job")
def fromDate = request.get("fromDate")
def toDate = request.get("toDate")
def limit= (request.get("limit")!=null)?request.get("limit").toInteger():10
def istIid = request.get("IstIid")

def str= "No data to retrieved !"
def result = null
if(job != "" &amp;amp;&amp;amp; job != null &amp;amp;&amp;amp; istIid != null &amp;amp;&amp;amp; istIid != ""){
	MongoDBConnection.getConnection()
	if(fromDate != "" || toDate != ""){
		result = MongoDBConnection.getDataInPeriod(job,fromDate,toDate,limit,istIid)
	} else {
		result = MongoDBConnection.getDataAllFields(job,limit,istIid)
        }
MongoDBConnection.closeConnection()
} else {
   println "{{warning}}There are no selected job or IstIid{{/warning}}"
}

if( (result != null) &amp;amp;&amp;amp; (result.size() &amp;gt; 0) &amp;amp;&amp;amp; (result[0].KEYEXPR != null)&amp;amp;&amp;amp;!(result[0].KEYEXPR instanceof List )){
if(result[0].type == "Subtyped") {
    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
    def dataSubtype = DataToDrawChart.getDataToDrawSubtype(result)
    def listKey = []
    dataSubtype.each {key,value -&amp;gt;
        listKey.add(key)
    }
    def jsonkey = com.mongodb.util.JSON.serialize(listKey)
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$jsonkey&amp;lt;/textarea&amp;gt;"

    dataSubtype.each {key,value -&amp;gt;
        println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +'&amp;lt;/div&amp;gt;'
        println "-----"
        def dataLine = []
        def dataBar = []
        def dataPie = []
        def dataArea = []
        if(DataToDrawChart.getDataToDrawLine(value) != []) {
            dataLine = DataToDrawChart.getDataToDrawLine(value)
        }
        if(DataToDrawChart.getDataToDrawBar(value) != []) {
            dataBar = DataToDrawChart.getDataToDrawBar(value)
        }
        if(DataToDrawChart.getDataToDrawPie(value) != []) {
            dataPie = DataToDrawChart.getDataToDrawPie(value)
        }
        if(DataToDrawChart.getDataToDrawArea(value) != []) {
            dataArea = DataToDrawChart.getDataToDrawArea(value)
        }

        def chartColumnsLine
        def chartColumnsBar 
        def chartColumnsArea 
        def lstName
        if(dataLine.size() &amp;gt; 0 ){
            chartColumnsLine = dataLine[0].chart_columns
        }
        if(dataBar.size() &amp;gt; 0){
            chartColumnsBar = dataBar[0].chart_columns
        }
        if(dataArea.size() &amp;gt; 0 ){
            chartColumnsArea = dataArea[0].chart_columns
        }
        if(dataPie.size() &amp;gt; 0 ){
            lstName = dataPie['name']
        }

        def tmpListNameContainer = []
	for(def nameContainer in lstName){
	   nameContainer = nameContainer.replaceAll("\\.", "_")
	   tmpListNameContainer.add(nameContainer)
	}
        def jsonPie
        def jsonLine
	def jsonBar
        def jsonArea
        if(dataPie != []) {
	    jsonPie = com.mongodb.util.JSON.serialize(dataPie)
        }
        if(dataLine != []) {
	    jsonLine = com.mongodb.util.JSON.serialize(dataLine)
        }
        if(dataBar != []) {
            jsonBar = com.mongodb.util.JSON.serialize(dataBar)
        }
        if(dataArea != []) {
	    jsonArea = com.mongodb.util.JSON.serialize(dataArea)
        }

	def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
	def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
	def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
	def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

	println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
        if(jsonLine != null) {
	    println "&amp;lt;textarea id=\"jsonline_$key\" &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;" 
        }
	if(jsonBar != null) {
            println "&amp;lt;textarea id=\"jsonbar_$key\"&amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
 	    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
        }
        if(jsonPie != null) {
	    println "&amp;lt;textarea id=\"jsonpie_$key\" &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
        }
        if(jsonArea != null) {
	    println "&amp;lt;textarea id=\"jsonarea_$key\" &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"
	    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
        }

	println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
	println "&amp;lt;input style=\"display:none\" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;"
	println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
	println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'
	println "&amp;lt;/div&amp;gt;"
	  
	def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
	def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
	  
	println "&amp;lt;div style='clear:both'&amp;gt;"
        if(jsonPie != null) {
	  println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
	  lstName.each{
	    def tmp = it.replaceAll("\\.", "_")
	    println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
        if(jsonLine != null) {
	  def chartLineComment = false
	  chartColumnsLine.each{
	    if(!chartLineComment){
	       println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	       chartLineComment = true  
	    }

	      println " &amp;lt;div class=\"displayblock\" id=\"containerline${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
        println "&amp;amp;nbsp;"

        if(jsonBar != null) {
	  def chartBarComment = false
	  chartColumnsBar.each{
	     if(!chartBarComment){
	        println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	        chartBarComment = true
	      }  

	     println " &amp;lt;div class=\"displayblock\" id=\"containerbar${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
	println "&amp;amp;nbsp;"

        if(jsonArea != null) {
	  def chartAreaComment = false
	  chartColumnsArea.each{
	  if(!chartAreaComment){
	    println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	    chartAreaComment = true
	  }
	    println " &amp;lt;div class=\"displayblock\" id=\"containerarea${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
	println "&amp;lt;/div&amp;gt;"
        
    }
    println '&amp;lt;/body&amp;gt;'
    println '{{/html}}'
} else if(result[0].type == "Store") {
    // data store
    def dataLine = DataToDrawChart.getDataToDrawLine(result)
    def dataBar = DataToDrawChart.getDataToDrawBar(result)
    def dataPie = DataToDrawChart.getDataToDrawPie(result)
    def dataArea = DataToDrawChart.getDataToDrawArea(result)
    def chartColumnsLine 
    def chartColumnsBar 
    def chartColumnsArea 
    def lstName 

    if(dataLine.size() &amp;gt; 0 ){
        chartColumnsLine = dataLine[0].chart_columns
    }
    if(dataBar.size() &amp;gt; 0){
        chartColumnsBar = dataBar[0].chart_columns
    }
    if(dataArea.size() &amp;gt; 0 ){
        chartColumnsArea = dataArea[0].chart_columns
    }
    if(dataPie.size() &amp;gt; 0 ){
        lstName = dataPie['name']
    }

    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
  
    def tmpListNameContainer = []
    for(def nameContainer in lstName){
       nameContainer = nameContainer.replaceAll("\\.", "_")
       tmpListNameContainer.add(nameContainer)
    }
  
    def jsonPie = com.mongodb.util.JSON.serialize(dataPie)
    def jsonLine = com.mongodb.util.JSON.serialize(dataLine)
    def jsonBar = com.mongodb.util.JSON.serialize(dataBar)
    def jsonArea = com.mongodb.util.JSON.serialize(dataArea)

    def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
    def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
    def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
    def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

    def listEmpty = com.mongodb.util.JSON.serialize([])
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$listEmpty&amp;lt;/textarea&amp;gt;" 

    println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'

    println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
    println "&amp;lt;textarea class='jsonline' &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonbar' &amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonpie' &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonarea' &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"

    println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
  
    def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
    def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
  
    println "&amp;lt;div style='clear:both'&amp;gt;"
  
    def chartPieComment = false
    lstName.each{
        if(!chartPieComment) {
            println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
            chartPieComment = true
        }
        def tmp = it.replaceAll("\\.", "_")
        println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    def chartLineComment = false
    chartColumnsLine.each{
    if(!chartLineComment){
        println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
        chartLineComment = true  
    }

    println " &amp;lt;div class=\"displayblock\" id=\"containerline$it\"&amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    println "&amp;amp;nbsp;"
    def chartBarComment = false
    chartColumnsBar.each{
        if(!chartBarComment){
            println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
            chartBarComment = true
        }  

    println " &amp;lt;div class=\"displayblock\" id=\"containerbar$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
  println "&amp;lt;/div&amp;gt;"
  println "&amp;amp;nbsp;"
  def chartAreaComment = false
  chartColumnsArea.each{
  if(!chartAreaComment){
    println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
    chartAreaComment = true
  }
    println " &amp;lt;div class=\"displayblock\" id=\"containerarea$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
  println "&amp;lt;/div&amp;gt;"
println "&amp;lt;/div&amp;gt;"

println '&amp;lt;/body&amp;gt;'
println '{{/html}}'
}
}else{
    println 'There is no data for this job with criterias'
}
{{/groovy}}&lt;/content&gt;&lt;/xwikidoc&gt;
@


41.1
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376376872000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376376858000&lt;/contentUpdateDate&gt;
&lt;version&gt;41.1&lt;/version&gt;
d21 1
a21 1
&lt;minorEdit&gt;false&lt;/minorEdit&gt;
d3183 2
a3184 2
    &amp;lt;table id="livetableList"&amp;gt;&amp;lt;/table&amp;gt;
    &amp;lt;div id="livetablePager"&amp;gt;&amp;lt;/div&amp;gt;
@


40.3
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376376858000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;40.3&lt;/version&gt;
d21 1
a21 1
&lt;minorEdit&gt;true&lt;/minorEdit&gt;
@


40.2
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376376776000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376376776000&lt;/contentUpdateDate&gt;
&lt;version&gt;40.2&lt;/version&gt;
d3182 4
a3185 1
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;&amp;lt;div id="livetableData"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
@


40.1
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376376537000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376376537000&lt;/contentUpdateDate&gt;
&lt;version&gt;40.1&lt;/version&gt;
d21 1
a21 1
&lt;minorEdit&gt;false&lt;/minorEdit&gt;
d3124 16
d3141 2
a3142 1
(((
d3144 349
a3492 5
{{velocity}}$xwiki.jsx.use('Lib.JQueryUILib')
$xwiki.ssx.use('Lib.MenuGenerator')
$xwiki.jsx.use('Lib.MenuGenerator')
$xwiki.ssx.use('Lib.JQueryUILib'){{/velocity}}
{{include document="Lib.MenuGenerator"/}}&lt;/content&gt;&lt;/xwikidoc&gt;
@


39.1
log
@@
text
@&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xwikidoc&gt;
&lt;web&gt;WiperDog&lt;/web&gt;
&lt;name&gt;WebHome&lt;/name&gt;
&lt;language&gt;&lt;/language&gt;
&lt;defaultLanguage&gt;en&lt;/defaultLanguage&gt;
&lt;translation&gt;0&lt;/translation&gt;
&lt;parent&gt;&lt;/parent&gt;
&lt;creator&gt;XWiki.Admin&lt;/creator&gt;
&lt;author&gt;XWiki.Admin&lt;/author&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;contentAuthor&gt;XWiki.Admin&lt;/contentAuthor&gt;
&lt;creationDate&gt;1376364375000&lt;/creationDate&gt;
&lt;date&gt;1376376484000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376375518000&lt;/contentUpdateDate&gt;
&lt;version&gt;39.1&lt;/version&gt;
&lt;title&gt;WiperDog&lt;/title&gt;
&lt;defaultTemplate&gt;&lt;/defaultTemplate&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;comment&gt;&lt;/comment&gt;
&lt;minorEdit&gt;false&lt;/minorEdit&gt;
&lt;syntaxId&gt;xwiki/2.1&lt;/syntaxId&gt;
&lt;hidden&gt;false&lt;/hidden&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;047293a8-524d-45e4-af52-cd944523d5d0&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
/*
 * jQuery timepicker addon
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 1.3.1
 * Last Modified: 07/07/2013
 *
 * Copyright 2013 Trent Richardson
 * You may use this project under MIT or GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 */

/*jslint evil: true, white: false, undef: false, nomen: false */

(function($) {

	/*
	* Lets not redefine timepicker, Prevent "Uncaught RangeError: Maximum call stack size exceeded"
	*/
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return;
	}

	/*
	* Extend jQueryUI, get it started with our version number
	*/
	$.extend($.ui, {
		timepicker: {
			version: "1.3.1"
		}
	});

	/* 
	* Timepicker manager.
	* Use the singleton instance of this class, $.timepicker, to interact with the time picker.
	* Settings for (groups of) time pickers are maintained in an instance object,
	* allowing multiple different settings on the same page.
	*/
	var Timepicker = function() {
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[''] = { // Default regional settings
			currentText: 'Now',
			closeText: 'Done',
			amNames: ['AM', 'A'],
			pmNames: ['PM', 'P'],
			timeFormat: 'HH:mm',
			timeSuffix: '',
			timeOnlyTitle: 'Choose Time',
			timeText: 'Time',
			hourText: 'Hour',
			minuteText: 'Minute',
			secondText: 'Second',
			millisecText: 'Millisecond',
			microsecText: 'Microsecond',
			timezoneText: 'Time Zone',
			isRTL: false
		};
		this._defaults = { // Global defaults for all the datetime picker instances
			showButtonPanel: true,
			timeOnly: false,
			showHour: null,
			showMinute: null,
			showSecond: null,
			showMillisec: null,
			showMicrosec: null,
			showTimezone: null,
			showTime: true,
			stepHour: 1,
			stepMinute: 1,
			stepSecond: 1,
			stepMillisec: 1,
			stepMicrosec: 1,
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null,
			hourMin: 0,
			minuteMin: 0,
			secondMin: 0,
			millisecMin: 0,
			microsecMin: 0,
			hourMax: 23,
			minuteMax: 59,
			secondMax: 59,
			millisecMax: 999,
			microsecMax: 999,
			minDateTime: null,
			maxDateTime: null,
			onSelect: null,
			hourGrid: 0,
			minuteGrid: 0,
			secondGrid: 0,
			millisecGrid: 0,
			microsecGrid: 0,
			alwaysSetTime: true,
			separator: ' ',
			altFieldTimeOnly: true,
			altTimeFormat: null,
			altSeparator: null,
			altTimeSuffix: null,
			pickerTimeFormat: null,
			pickerTimeSuffix: null,
			showTimepicker: true,
			timezoneList: null,
			addSliderAccess: false,
			sliderAccessArgs: null,
			controlType: 'slider',
			defaultValue: null,
			parse: 'strict'
		};
		$.extend(this._defaults, this.regional['']);
	};

	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: '',
		formattedDate: '',
		formattedTime: '',
		formattedDateTime: '',
		timezoneList: null,
		units: ['hour','minute','second','millisec', 'microsec'],
		support: {},
		control: null,

		/* 
		* Override the default settings for all instances of the time picker.
		* @@param  settings  object - the new settings to use as defaults (anonymous object)
		* @@return the manager object
		*/
		setDefaults: function(settings) {
			extendRemove(this._defaults, settings || {});
			return this;
		},

		/*
		* Create a new Timepicker instance
		*/
		_newInst: function($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
            	fns = {},
		    	overrides, i;

			for (var attrName in this._defaults) {
				if(this._defaults.hasOwnProperty(attrName)){
					var attrValue = $input.attr('time:' + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue);
						} catch (err) {
							inlineSettings[attrName] = attrValue;
						}
					}
				}
			}

		    overrides = {
		        beforeShow: function (input, dp_inst) {
		            if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
		                return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst);
		            }
		        },
		        onChangeMonthYear: function (year, month, dp_inst) {
		            // Update the time as well : this prevents the time from disappearing from the $input field.
		            tp_inst._updateDateTime(dp_inst);
		            if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
		                tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst);
		            }
		        },
		        onClose: function (dateText, dp_inst) {
		            if (tp_inst.timeDefined === true &amp;amp;&amp;amp; $input.val() !== '') {
		                tp_inst._updateDateTime(dp_inst);
		            }
		            if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
		                tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst);
		            }
		        }
		    };
		    for (i in overrides) {
		        if (overrides.hasOwnProperty(i)) {
		            fns[i] = opts[i] || null;
		        }
		    }

		    tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
		        evnts:fns,
		        timepicker: tp_inst // add timepicker as a property of datepicker: $.datepicker._get(dp_inst, 'timepicker');
		    });
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function(val) {
				return val.toUpperCase();
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function(val) {
				return val.toUpperCase();
			});

			// detect which units are supported
			tp_inst.support = detectSupport(
					tp_inst._defaults.timeFormat + 
					(tp_inst._defaults.pickerTimeFormat? tp_inst._defaults.pickerTimeFormat:'') + 
					(tp_inst._defaults.altTimeFormat? tp_inst._defaults.altTimeFormat:''));

			// controlType is string - key to our this._controls
			if(typeof(tp_inst._defaults.controlType) === 'string'){
				if(tp_inst._defaults.controlType == 'slider' &amp;amp;&amp;amp; typeof(jQuery.ui.slider) === 'undefined'){
					tp_inst._defaults.controlType = 'select';
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType];
			}
			// controlType is an object and must implement create, options, value methods
			else{ 
				tp_inst.control = tp_inst._defaults.controlType;
			}

			// prep the timezone options
			var timezoneList = [-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,
					0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList;
			}
			var tzl=timezoneList.length,tzi=0,tzv=null;
			if (tzl &amp;gt; 0 &amp;amp;&amp;amp; typeof timezoneList[0] !== 'object') {
				for(; tzi&amp;lt;tzl; tzi++){
					tzv = timezoneList[tzi];
					timezoneList[tzi] = { value: tzv, label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601) };
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;

			// set the default units
			tp_inst.timezone = tp_inst._defaults.timezone !== null? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) : 
							((new Date()).getTimezoneOffset()*-1);
			tp_inst.hour = tp_inst._defaults.hour &amp;lt; tp_inst._defaults.hourMin? tp_inst._defaults.hourMin : 
							tp_inst._defaults.hour &amp;gt; tp_inst._defaults.hourMax? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute &amp;lt; tp_inst._defaults.minuteMin? tp_inst._defaults.minuteMin : 
							tp_inst._defaults.minute &amp;gt; tp_inst._defaults.minuteMax? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second &amp;lt; tp_inst._defaults.secondMin? tp_inst._defaults.secondMin : 
							tp_inst._defaults.second &amp;gt; tp_inst._defaults.secondMax? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec &amp;lt; tp_inst._defaults.millisecMin? tp_inst._defaults.millisecMin : 
							tp_inst._defaults.millisec &amp;gt; tp_inst._defaults.millisecMax? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec &amp;lt; tp_inst._defaults.microsecMin? tp_inst._defaults.microsecMin : 
							tp_inst._defaults.microsec &amp;gt; tp_inst._defaults.microsecMax? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = '';
			tp_inst.$input = $input;

			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField).css({
					cursor: 'pointer'
				}).focus(function() {
					$input.trigger("focus");
				});
			}

			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date();
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date();
			}

			// datepicker needs minDate/maxDate, timepicker needs minDateTime/maxDateTime..
			if (tp_inst._defaults.minDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime());
			}
			if (tp_inst._defaults.minDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime());
			}
			if (tp_inst._defaults.maxDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime());
			}
			if (tp_inst._defaults.maxDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime());
			}
			tp_inst.$input.bind('focus', function() {
				tp_inst._onFocus();
			});

			return tp_inst;
		},

		/*
		* add our sliders to the calendar
		*/
		_addTimePicker: function(dp_inst) {
			var currDT = (this.$altInput &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly) ? this.$input.val() + ' ' + this.$altInput.val() : this.$input.val();

			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
		},

		/*
		* parse the time string from input value or _setTime
		*/
		_parseTime: function(timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0]);
			}

			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, 'dateFormat');
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false;
					}
					$.extend(this, parseRes.timeObj);
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err +
									"\ndate/time string = " + timeString +
									"\ntimeFormat = " + this._defaults.timeFormat +
									"\ndateFormat = " + dp_dateFormat);
					return false;
				}
				return true;
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false;
				}
				$.extend(this, timeObj);
				return true;
			}
		},

		/*
		* generate and inject html for timepicker into ui datepicker
		*/
		_injectTimePicker: function() {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = '',
				uitem = '',
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i=0,
				l=0;

			// Prevent displaying twice
			if ($dp.find("div.ui-timepicker-div").length === 0 &amp;amp;&amp;amp; o.showTimepicker) {
				var noDisplay = ' style="display:none;"',
					html = '&amp;lt;div class="ui-timepicker-div'+ (o.isRTL? ' ui-timepicker-rtl' : '') +'"&amp;gt;&amp;lt;dl&amp;gt;' + '&amp;lt;dt class="ui_tpicker_time_label"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;' + o.timeText + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_time"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the markup
				for(i=0,l=this.units.length; i&amp;lt;l; i++){
					litem = this.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// Added by Peter Medeiros:
					// - Figure out what the hour/minute/second max should be based on the step values.
					// - Example: if stepMinute is 15, then minMax is 45.
					max[litem] = parseInt((o[litem+'Max'] - ((o[litem+'Max'] - o[litem+'Min']) % o['step'+uitem])), 10);
					gridSize[litem] = 0;

					html += '&amp;lt;dt class="ui_tpicker_'+ litem +'_label"' + (show ? '' : noDisplay) + '&amp;gt;' + o[litem +'Text'] + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_'+ litem +'"&amp;gt;&amp;lt;div class="ui_tpicker_'+ litem +'_slider"' + (show ? '' : noDisplay) + '&amp;gt;&amp;lt;/div&amp;gt;';

					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						html += '&amp;lt;div style="padding-left: 1px"&amp;gt;&amp;lt;table class="ui-tpicker-grid-label"&amp;gt;&amp;lt;tr&amp;gt;';

						if(litem == 'hour'){
							for (var h = o[litem+'Min']; h &amp;lt;= max[litem]; h += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm? 'hht':'HH', {hour:h}, o);									
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + tmph + '&amp;lt;/td&amp;gt;';
							}
						}
						else{
							for (var m = o[litem+'Min']; m &amp;lt;= max[litem]; m += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + ((m &amp;lt; 10) ? '0' : '') + m + '&amp;lt;/td&amp;gt;';
							}
						}

						html += '&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;&amp;lt;/div&amp;gt;';
					}
					html += '&amp;lt;/dd&amp;gt;';
				}
				
				// Timezone
				var showTz = o.showTimezone !== null? o.showTimezone : this.support.timezone;
				html += '&amp;lt;dt class="ui_tpicker_timezone_label"' + (showTz ? '' : noDisplay) + '&amp;gt;' + o.timezoneText + '&amp;lt;/dt&amp;gt;';
				html += '&amp;lt;dd class="ui_tpicker_timezone" ' + (showTz ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the elements from string
				html += '&amp;lt;/dl&amp;gt;&amp;lt;/div&amp;gt;';
				var $tp = $(html);

				// if we only want time picker...
				if (o.timeOnly === true) {
					$tp.prepend('&amp;lt;div class="ui-widget-header ui-helper-clearfix ui-corner-all"&amp;gt;' + '&amp;lt;div class="ui-datepicker-title"&amp;gt;' + o.timeOnlyTitle + '&amp;lt;/div&amp;gt;' + '&amp;lt;/div&amp;gt;');
					$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();
				}
				
				// add sliders, adjust grids, add events
				for(i=0,l=tp_inst.units.length; i&amp;lt;l; i++){
					litem = tp_inst.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// add the slider
					tp_inst[litem+'_slider'] = tp_inst.control.create(tp_inst, $tp.find('.ui_tpicker_'+litem+'_slider'), litem, tp_inst[litem], o[litem+'Min'], max[litem], o['step'+uitem]);

					// adjust the grid and add click event
					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						size = 100 * gridSize[litem] * o[litem+'Grid'] / (max[litem] - o[litem+'Min']);
						$tp.find('.ui_tpicker_'+litem+' table').css({
							width: size + "%",
							marginLeft: o.isRTL? '0' : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL? ((size / (-2 * gridSize[litem])) + "%") : '0',
							borderCollapse: 'collapse'
						}).find("td").click(function(e){
								var $t = $(this),
									h = $t.html(),
									n = parseInt(h.replace(/[^0-9]/g),10),
									ap = h.replace(/[^apm]/ig),
									f = $t.data('for'); // loses scope, so we use data-for

								if(f == 'hour'){
									if(ap.indexOf('p') !== -1 &amp;amp;&amp;amp; n &amp;lt; 12){
										n += 12;
									}
									else{
										if(ap.indexOf('a') !== -1 &amp;amp;&amp;amp; n === 12){
											n = 0;
										}
									}
								}
								
								tp_inst.control.value(tp_inst, tp_inst[f+'_slider'], litem, n);

								tp_inst._onTimeChange();
								tp_inst._onSelectHandler();
							}).css({
								cursor: 'pointer',
								width: (100 / gridSize[litem]) + '%',
								textAlign: 'center',
								overflow: 'hidden'
							});
					} // end if grid &amp;gt; 0
				} // end for loop

				// Add timezone options
				this.timezone_select = $tp.find('.ui_tpicker_timezone').append('&amp;lt;select&amp;gt;&amp;lt;/select&amp;gt;').find("select");
				$.fn.append.apply(this.timezone_select,
				$.map(o.timezoneList, function(val, idx) {
					return $("&amp;lt;option /&amp;gt;").val(typeof val == "object" ? val.value : val).text(typeof val == "object" ? val.label : val);
				}));
				if (typeof(this.timezone) != "undefined" &amp;amp;&amp;amp; this.timezone !== null &amp;amp;&amp;amp; this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset()*-1;
					if (local_timezone == this.timezone) {
						selectLocalTimezone(tp_inst);
					} else {
						this.timezone_select.val(this.timezone);
					}
				} else {
					if (typeof(this.hour) != "undefined" &amp;amp;&amp;amp; this.hour !== null &amp;amp;&amp;amp; this.hour !== "") {
						this.timezone_select.val(o.timezone);
					} else {
						selectLocalTimezone(tp_inst);
					}
				}
				this.timezone_select.change(function() {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
				});
				// End timezone options
				
				// inject timepicker into datepicker
				var $buttonPanel = $dp.find('.ui-datepicker-buttonpane');
				if ($buttonPanel.length) {
					$buttonPanel.before($tp);
				} else {
					$dp.append($tp);
				}

				this.$timeObj = $tp.find('.ui_tpicker_time');

				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined;
				}

				// slideAccess integration: http://trentrichardson.com/2011/11/11/jquery-ui-sliders-and-touch-accessibility/
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
						
					setTimeout(function() { // fix for inline mode
						if ($tp.find('.ui-slider-access').length === 0) {
							$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);

							// fix any grids since sliders are shorter
							var sliderAccessWidth = $tp.find('.ui-slider-access:eq(0)').outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find('table:visible').each(function() {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl? 'marginRight':'marginLeft').toString().replace('%', ''),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + '%',
										css = { width: newWidth, marginRight: 0, marginLeft: 0 };
									css[rtl? 'marginRight':'marginLeft'] = newMarginLeft;
									$g.css(css);
								});
							}
						}
					}, 10);
				}
				// end slideAccess integration

				tp_inst._limitMinMaxDateTime(this.inst, true);
			}
		},

		/*
		* This function tries to limit the ability to go outside the
		* min/max date range
		*/
		_limitMinMaxDateTime: function(dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);

			if (!this._defaults.showTimepicker) {
				return;
			} // No time so nothing to check here

			if ($.datepicker._get(dp_inst, 'minDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'minDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, 'minDateTime'),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin;
				}

				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour &amp;lt;= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute &amp;lt;= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second &amp;lt;= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if(this.millisec &amp;lt;= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;lt; this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin;
									}
									this._defaults.microsecMin = this.microsecMinOriginal;
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal;
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal;
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal;
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal;
				}
			}

			if ($.datepicker._get(dp_inst, 'maxDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'maxDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, 'maxDateTime'),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax;
				}

				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour &amp;gt;= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute &amp;gt;= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second &amp;gt;= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec &amp;gt;= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;gt; this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax;
									}
									this._defaults.microsecMax = this.microsecMaxOriginal;
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal;
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal;
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal;
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal;
				}
			}

			if (adjustSliders !== undefined &amp;amp;&amp;amp; adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10);
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);

				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, 'hour', { min: this._defaults.hourMin, max: hourMax });
					this.control.value(this, this.hour_slider, 'hour', this.hour - (this.hour % this._defaults.stepHour));
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, 'minute', { min: this._defaults.minuteMin, max: minMax });
					this.control.value(this, this.minute_slider, 'minute', this.minute - (this.minute % this._defaults.stepMinute));
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, 'second', { min: this._defaults.secondMin, max: secMax });
					this.control.value(this, this.second_slider, 'second', this.second - (this.second % this._defaults.stepSecond));
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, 'millisec', { min: this._defaults.millisecMin, max: millisecMax });
					this.control.value(this, this.millisec_slider, 'millisec', this.millisec - (this.millisec % this._defaults.stepMillisec));
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, 'microsec', { min: this._defaults.microsecMin, max: microsecMax });
					this.control.value(this, this.microsec_slider, 'microsec', this.microsec - (this.microsec % this._defaults.stepMicrosec));
				}
			}

		},

		/*
		* when a slider moves, set the internal time...
		* on time change is also called when the time is updated in the text field
		*/
		_onTimeChange: function() {
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, 'hour') : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, 'minute') : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, 'second') : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, 'millisec') : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, 'microsec') : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;

			if (typeof(hour) == 'object') {
				hour = false;
			}
			if (typeof(minute) == 'object') {
				minute = false;
			}
			if (typeof(second) == 'object') {
				second = false;
			}
			if (typeof(millisec) == 'object') {
				millisec = false;
			}
			if (typeof(microsec) == 'object') {
				microsec = false;
			}
			if (typeof(timezone) == 'object') {
				timezone = false;
			}

			if (hour !== false) {
				hour = parseInt(hour, 10);
			}
			if (minute !== false) {
				minute = parseInt(minute, 10);
			}
			if (second !== false) {
				second = parseInt(second, 10);
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10);
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10);
			}

			var ampm = o[hour &amp;lt; 12 ? 'amNames' : 'pmNames'][0];

			// If the update was done in the input field, the input field should not be updated.
			// If the update was done using the sliders, update the input field.
			var hasChanged = (hour != this.hour || minute != this.minute || second != this.second || millisec != this.millisec || microsec != this.microsec 
								|| (this.ampm.length &amp;gt; 0 &amp;amp;&amp;amp; (hour &amp;lt; 12) != ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) 
								|| (this.timezone !== null &amp;amp;&amp;amp; timezone != this.timezone));

			if (hasChanged) {

				if (hour !== false) {
					this.hour = hour;
				}
				if (minute !== false) {
					this.minute = minute;
				}
				if (second !== false) {
					this.second = second;
				}
				if (millisec !== false) {
					this.millisec = millisec;
				}
				if (microsec !== false) {
					this.microsec = microsec;
				}
				if (timezone !== false) {
					this.timezone = timezone;
				}

				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0]);
				}

				this._limitMinMaxDateTime(this.inst, true);
			}
			if (this.support.ampm) {
				this.ampm = ampm;
			}

			// Updates the time within the timepicker
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if(pickerTimeFormat === o.timeFormat){
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix);
				}
				else{
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix);
				}
			}

			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime();
			}
		},

		/*
		* call custom onSelect.
		* bind to sliders slidestop, and grid click.
		*/
		_onSelectHandler: function() {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect &amp;amp;&amp;amp; inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this]);
			}
		},

		/*
		* update our input with the new date time..
		*/
		_updateDateTime: function(dp_inst) {
			dp_inst = this.inst || dp_inst;
			//var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
			var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay)),
				dateFmt = $.datepicker._get(dp_inst, 'dateFormat'),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null &amp;amp;&amp;amp; this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			
			// if a slider was changed but datepicker doesn't have a value yet, set it
			if(dp_inst.lastVal===""){
                dp_inst.currentYear=dp_inst.selectedYear;
                dp_inst.currentMonth=dp_inst.selectedMonth;
                dp_inst.currentDay=dp_inst.selectedDay;
            }

			/*
			* remove following lines to force every changes in date picker to change the input value
			* Bug descriptions: when an input field has a default value, and click on the field to pop up the date picker. 
			* If the user manually empty the value in the input field, the date picker will never change selected value.
			*/
			//if (dp_inst.lastVal !== undefined &amp;amp;&amp;amp; (dp_inst.lastVal.length &amp;gt; 0 &amp;amp;&amp;amp; this.$input.val().length === 0)) {
			//	return;
			//}

			if (this._defaults.timeOnly === true) {
				formattedDateTime = this.formattedTime;
			} else if (this._defaults.timeOnly !== true &amp;amp;&amp;amp; (this._defaults.alwaysSetTime || timeAvailable)) {
				formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix;
			}

			this.formattedDateTime = formattedDateTime;

			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate);
			} else if (this.$altInput &amp;amp;&amp;amp; this._defaults.timeOnly === false &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly === true) {
				this.$altInput.val(this.formattedTime);
				this.$input.val(this.formattedDate);
			} else if (this.$altInput) {
				this.$input.val(formattedDateTime);
				var altFormattedDateTime = '',
					altSeparator = this._defaults.altSeparator ? this._defaults.altSeparator : this._defaults.separator,
					altTimeSuffix = this._defaults.altTimeSuffix ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
				
				if(!this._defaults.timeOnly){
					if (this._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg);
					}
					else{
						altFormattedDateTime = this.formattedDate;
					}

					if (altFormattedDateTime){
						altFormattedDateTime += altSeparator;
					}
				}

				if(this._defaults.altTimeFormat){
					altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix;
				}
				else{
					altFormattedDateTime += this.formattedTime + altTimeSuffix;
				}
				this.$altInput.val(altFormattedDateTime);
			} else {
				this.$input.val(formattedDateTime);
			}

			this.$input.trigger("change");
		},

		_onFocus: function() {
			if (!this.$input.val() &amp;amp;&amp;amp; this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, 'timepicker');
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst);
						} catch (err) {
							$.timepicker.log(err);
						}
					}
				}
			}
		},

		/*
		* Small abstraction to control types
		* We can add more, just be sure to follow the pattern: create, options, value
		*/
		_controls: {
			// slider methods
			slider: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var rtl = tp_inst._defaults.isRTL; // if rtl go -60-&amp;gt;0 instead of 0-&amp;gt;60
					return obj.prop('slide', null).slider({
						orientation: "horizontal",
						value: rtl? val*-1 : val,
						min: rtl? max*-1 : min,
						max: rtl? min*-1 : max,
						step: step,
						slide: function(event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl? ui.value*-1:ui.value);
							tp_inst._onTimeChange();
						},
						stop: function(event, ui) {
							tp_inst._onSelectHandler();
						}
					});	
				},
				options: function(tp_inst, obj, unit, opts, val){
					if(tp_inst._defaults.isRTL){
						if(typeof(opts) == 'string'){
							if(opts == 'min' || opts == 'max'){
								if(val !== undefined){
									return obj.slider(opts, val*-1);
								}
								return Math.abs(obj.slider(opts));
							}
							return obj.slider(opts);
						}
						var min = opts.min, 
							max = opts.max;
						opts.min = opts.max = null;
						if(min !== undefined){
							opts.max = min * -1;
						}
						if(max !== undefined){
							opts.min = max * -1;
						}
						return obj.slider(opts);
					}
					if(typeof(opts) == 'string' &amp;amp;&amp;amp; val !== undefined){
							return obj.slider(opts, val);
					}
					return obj.slider(opts);
				},
				value: function(tp_inst, obj, unit, val){
					if(tp_inst._defaults.isRTL){
						if(val !== undefined){
							return obj.slider('value', val*-1);
						}
						return Math.abs(obj.slider('value'));
					}
					if(val !== undefined){
						return obj.slider('value', val);
					}
					return obj.slider('value');
				}
			},
			// select methods
			select: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var sel = '&amp;lt;select class="ui-timepicker-select" data-unit="'+ unit +'" data-min="'+ min +'" data-max="'+ max +'" data-step="'+ step +'"&amp;gt;',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;

					for(var i=min; i&amp;lt;=max; i+=step){						
						sel += '&amp;lt;option value="'+ i +'"'+ (i==val? ' selected':'') +'&amp;gt;';
						if(unit == 'hour'){
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig,'')), {hour:i}, tp_inst._defaults);
						}
						else if(unit == 'millisec' || unit == 'microsec' || i &amp;gt;= 10){ sel += i; }
						else {sel += '0'+ i.toString(); }
						sel += '&amp;lt;/option&amp;gt;';
					}
					sel += '&amp;lt;/select&amp;gt;';

					obj.children('select').remove();

					$(sel).appendTo(obj).change(function(e){
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
					});

					return obj;
				},
				options: function(tp_inst, obj, unit, opts, val){
					var o = {},
						$t = obj.children('select');
					if(typeof(opts) == 'string'){
						if(val === undefined){
							return $t.data(opts);
						}
						o[opts] = val;	
					}
					else{ o = opts; }
					return tp_inst.control.create(tp_inst, obj, $t.data('unit'), $t.val(), o.min || $t.data('min'), o.max || $t.data('max'), o.step || $t.data('step'));
				},
				value: function(tp_inst, obj, unit, val){
					var $t = obj.children('select');
					if(val !== undefined){
						return $t.val(val);
					}
					return $t.val();
				}
			}
		} // end _controls

	});

	$.fn.extend({
		/*
		* shorthand just to use timepicker..
		*/
		timepicker: function(o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);

			if (typeof o == 'object') {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				});
			}

			return $(this).each(function() {
				$.fn.datetimepicker.apply($(this), tmp_args);
			});
		},

		/*
		* extend timepicker to datepicker
		*/
		datetimepicker: function(o) {
			o = o || {};
			var tmp_args = arguments;

			if (typeof(o) == 'string') {
				if (o == 'getDate') {
					return $.fn.datepicker.apply($(this[0]), tmp_args);
				} else {
					return this.each(function() {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args);
					});
				}
			} else {
				return this.each(function() {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults);
				});
			}
		}
	});

	/*
	* Public Utility to parse date and time
	*/
	$.datepicker.parseDateTime = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec);
		}

		return parseRes.date;
	};

	/*
	* Public utility to parse time
	*/
	$.datepicker.parseTime = function(timeFormat, timeString, options) {		
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g,'').indexOf('Z') !== -1);

		// Strict parse requires the timeString to match the timeFormat exactly
		var strictParse = function(f, s, o){

			// pattern for standard and localized AM/PM markers
			var getPatternAmpm = function(amNames, pmNames) {
				var markers = [];
				if (amNames) {
					$.merge(markers, amNames);
				}
				if (pmNames) {
					$.merge(markers, pmNames);
				}
				markers = $.map(markers, function(val) {
					return val.replace(/[.*+?|()\[\]{}\\]/g, '\\$&amp;amp;');
				});
				return '(' + markers.join('|') + ')?';
			};

			// figure out position of time elements.. cause js cant do named captures
			var getFormatPositions = function(timeFormat) {
				var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
					orders = {
						h: -1,
						m: -1,
						s: -1,
						l: -1,
						c: -1,
						t: -1,
						z: -1
					};

				if (finds) {
					for (var i = 0; i &amp;lt; finds.length; i++) {
						if (orders[finds[i].toString().charAt(0)] == -1) {
							orders[finds[i].toString().charAt(0)] = i + 1;
						}
					}
				}
				return orders;
			};

			var regstr = '^' + f.toString()
					.replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
							var ml = match.length;
							switch (match.charAt(0).toLowerCase()) {
								case 'h': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'm': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 's': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'l': return '(\\d?\\d?\\d)';
								case 'c': return '(\\d?\\d?\\d)';
								case 'z': return '(z|[-+]\\d\\d:?\\d\\d|\\S+)?';
								case 't': return getPatternAmpm(o.amNames, o.pmNames);
								default:    // literal escaped in quotes
									return '(' + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function (m) { return "\\" + m; }) + ')?';
							}
						})
					.replace(/\s/g, '\\s?') +
					o.timeSuffix + '$',
				order = getFormatPositions(f),
				ampm = '',
				treg;

			treg = s.match(new RegExp(regstr, 'i'));

			var resTime = {
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0
			};

			if (treg) {
				if (order.t !== -1) {
					if (treg[order.t] === undefined || treg[order.t].length === 0) {
						ampm = '';
						resTime.ampm = '';
					} else {
						ampm = $.inArray(treg[order.t].toUpperCase(), o.amNames) !== -1 ? 'AM' : 'PM';
						resTime.ampm = o[ampm == 'AM' ? 'amNames' : 'pmNames'][0];
					}
				}

				if (order.h !== -1) {
					if (ampm == 'AM' &amp;amp;&amp;amp; treg[order.h] == '12') {
						resTime.hour = 0; // 12am = 0 hour
					} else {
						if (ampm == 'PM' &amp;amp;&amp;amp; treg[order.h] != '12') {
							resTime.hour = parseInt(treg[order.h], 10) + 12; // 12pm = 12 hour, any other pm = hour + 12
						} else {
							resTime.hour = Number(treg[order.h]);
						}
					}
				}

				if (order.m !== -1) {
					resTime.minute = Number(treg[order.m]);
				}
				if (order.s !== -1) {
					resTime.second = Number(treg[order.s]);
				}
				if (order.l !== -1) {
					resTime.millisec = Number(treg[order.l]);
				}
				if (order.c !== -1) {
					resTime.microsec = Number(treg[order.c]);
				}
				if (order.z !== -1 &amp;amp;&amp;amp; treg[order.z] !== undefined) {
					resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z]);
				}


				return resTime;
			}
			return false;
		};// end strictParse

		// First try JS Date, if that fails, use strictParse
		var looseParse = function(f,s,o){
			try{
				var d = new Date('2012-01-01 '+ s);
				if(isNaN(d.getTime())){
					d = new Date('2012-01-01T'+ s);
					if(isNaN(d.getTime())){
						d = new Date('01/01/2012 '+ s);
						if(isNaN(d.getTime())){
							throw "Unable to parse time with native Date: "+ s;
						}
					}
				}

				return {
					hour: d.getHours(),
					minute: d.getMinutes(),
					second: d.getSeconds(),
					millisec: d.getMilliseconds(),
					microsec: d.getMicroseconds(),
					timezone: d.getTimezoneOffset()*-1
				};
			}
			catch(err){
				try{
					return strictParse(f,s,o);
				}
				catch(err2){
					$.timepicker.log("Unable to parse \ntimeString: "+ s +"\ntimeFormat: "+ f);
				}				
			}
			return false;
		}; // end looseParse
		
		if(typeof o.parse === "function"){
			return o.parse(timeFormat, timeString, o);
		}
		if(o.parse === 'loose'){
			return looseParse(timeFormat, timeString, o);
		}
		return strictParse(timeFormat, timeString, o);
	};

	/*
	* Public utility to format the time
	* format = string format of the time
	* time = a {}, not a Date() for timezones
	* options = essentially the regional[].. amNames, pmNames, ampm
	*/
	$.datepicker.formatTime = function(format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			timezone: 0
		}, time);

		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);

		if (hour &amp;gt; 11) {
			ampmName = options.pmNames[0];
		}

		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|('.*?'|".*?"))/g, function(match) {
		switch (match) {
			case 'HH':
				return ('0' + hour).slice(-2);
			case 'H':
				return hour;
			case 'hh':
				return ('0' + convert24to12(hour)).slice(-2);
			case 'h':
				return convert24to12(hour);
			case 'mm':
				return ('0' + time.minute).slice(-2);
			case 'm':
				return time.minute;
			case 'ss':
				return ('0' + time.second).slice(-2);
			case 's':
				return time.second;
			case 'l':
				return ('00' + time.millisec).slice(-3);
			case 'c':
				return ('00' + time.microsec).slice(-3);
			case 'z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, false);
			case 'Z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, true);
			case 'T': 
				return ampmName.charAt(0).toUpperCase();
			case 'TT': 
				return ampmName.toUpperCase();
			case 't':
				return ampmName.charAt(0).toLowerCase();
			case 'tt':
				return ampmName.toLowerCase();
			default:
				return match.replace(/\'/g, "") || "'";
			}
		});

		tmptime = $.trim(tmptime);
		return tmptime;
	};

	/*
	* the bad hack :/ override datepicker so it doesnt close on select
	// inspired: http://stackoverflow.com/questions/1252512/jquery-datepicker-prevent-closing-picker-when-clicking-a-date/1762378#1762378
	*/
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function(id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			tp_inst._limitMinMaxDateTime(inst, true);
			inst.inline = inst.stay_open = true;
			//This way the onSelect handler called from calendarpicker get the full dateTime
			this._base_selectDate(id, dateStr);
			inst.inline = inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst);
		} else {
			this._base_selectDate(id, dateStr);
		}
	};

	/*
	* second bad hack :/ override datepicker so it triggers an event when changing the input field
	* and does not redraw the datepicker on every selectDate event
	*/
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function(inst) {

		// don't popup the datepicker if there is another instance already opened
		var input = inst.input[0];
		if ($.datepicker._curInst &amp;amp;&amp;amp; $.datepicker._curInst != inst &amp;amp;&amp;amp; $.datepicker._datepickerShowing &amp;amp;&amp;amp; $.datepicker._lastInput != input) {
			return;
		}

		if (typeof(inst.stay_open) !== 'boolean' || inst.stay_open === false) {

			this._base_updateDatepicker(inst);

			// Reload the time control when changing something in the input text field.
			var tp_inst = this._get(inst, 'timepicker');
			if (tp_inst) {
				tp_inst._addTimePicker(inst);
			}
		}
	};

	/*
	* third bad hack :/ override datepicker so it allows spaces and colon in the input field
	*/
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if ($.datepicker._get(inst, 'constrainInput')) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null? tp_inst._defaults.showTimezone : tp_inst.support.timezone,					
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat')),
					datetimeChars = tp_inst._defaults.timeFormat.toString()
											.replace(/[hms]/g, '')
											.replace(/TT/g, ampm ? 'APM' : '')
											.replace(/Tt/g, ampm ? 'AaPpMm' : '')
											.replace(/tT/g, ampm ? 'AaPpMm' : '')
											.replace(/T/g, ampm ? 'AP' : '')
											.replace(/tt/g, ampm ? 'apm' : '')
											.replace(/t/g, ampm ? 'ap' : '') + 
											" " + tp_inst._defaults.separator + 
											tp_inst._defaults.timeSuffix + 
											(tz ? tp_inst._defaults.timezoneList.join('') : '') + 
											(tp_inst._defaults.amNames.join('')) + (tp_inst._defaults.pmNames.join('')) + 
											dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr &amp;lt; ' ' || !dateChars || datetimeChars.indexOf(chr) &amp;gt; -1);
			}
		}

		return $.datepicker._base_doKeyPress(event);
	};

	/*
	* Fourth bad hack :/ override _updateAlternate function used in inline mode to init altField
	*/
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	/* Update any alternate field to synchronise with the main field. */
	$.datepicker._updateAlternate = function(inst) {
		var tp_inst = this._get(inst, 'timepicker');
		if(tp_inst){
			var altField = tp_inst._defaults.altField;
			if (altField) { // update alternate field too
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = '', 
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator, 
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if(!tp_inst._defaults.timeOnly &amp;amp;&amp;amp; !tp_inst._defaults.altFieldTimeOnly &amp;amp;&amp;amp; date !== null){
					if(tp_inst._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime;
					}
					else{
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime;
					}
				}
				$(altField).val(altFormattedDateTime);
			}
		}
		else{
			$.datepicker._base_updateAlternate(inst);
		}
	};

	/*
	* Override key up event to sync manual input changes.
	*/
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst);
				} catch (err) {
					$.timepicker.log(err);
				}
			}
		}

		return $.datepicker._base_doKeyUp(event);
	};

	/*
	* override "Today" button to also grab the time.
	*/
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function(id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		this._base_gotoToday(id);
		var tp_inst = this._get(inst, 'timepicker');
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		$('.ui-datepicker-today', $dp).click();
	};

	/*
	* Disable &amp;amp; enable the Time in the datetimepicker
	*/
	$.datepicker._disableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst);
		}
	};

	$.datepicker._enableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst); // Could be disabled on page load
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create our own set time function
	*/
	$.datepicker._setTime = function(inst, date) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var defaults = tp_inst._defaults;

			// calling _setTime with no date sets time to defaults
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;

			//check if within min/max times.. 
			tp_inst._limitMinMaxDateTime(inst, true);

			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create new public method to set only time, callable as $().datepicker('setTime', date)
	*/
	$.datepicker._setTimeDatepicker = function(target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date == "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec);
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds());
				}
				if (tp_date.toString() == 'Invalid Date') {
					tp_date = undefined;
				}
				this._setTime(inst, tp_date);
			}
		}

	};

	/*
	* override setDate() to allow setting time too within Date object
	*/
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function(target, date) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		if(typeof(date) === 'string'){
			date = new Date(date);
			if(!date.getTime()){
				$.timepicker.log("Error creating Date object from string.");
			}
		}

		var tp_inst = this._get(inst, 'timepicker');
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds());
		} else {
			tp_date = date;
		}
		
		// This is important if you are using the timezone option, javascript's Date 
		// object will only return the timezone offset for the current locale, so we 
		// adjust it accordingly.  If not using timezone option this won't matter..
		// If a timezone is different in tp, keep the timezone as is
		if(tp_inst){
			// look out for DST if tz wasn't specified
			if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
				tp_inst.timezone = tp_date.getTimezoneOffset()*-1;
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone);
		}

		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true);
	};

	/*
	* override getDate() to allow getting time too within Date object
	*/
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function(target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			// if it hasn't yet been defined, grab from field
			if(inst.lastVal === undefined){
				this._setDateFromField(inst, noDefault);
			}

			var date = this._getDate(inst);
			if (date &amp;amp;&amp;amp; tp_inst._parseTime($(target).val(), tp_inst.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);

				// This is important if you are using the timezone option, javascript's Date 
				// object will only return the timezone offset for the current locale, so we 
				// adjust it accordingly.  If not using timezone option this won't matter..
				if(tp_inst.timezone != null){
					// look out for DST if tz wasn't specified
					if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
						tp_inst.timezone = date.getTimezoneOffset()*-1;
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
				}
			}
			return date;
		}
		return this._base_getDateDatepicker(target, noDefault);
	};

	/*
	* override parseDate() because UI 1.8.14 throws an error about "Extra characters"
	* An option in datapicker to ignore extra format characters would be nicer.
	*/
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function(format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings);
		} catch (err) {
			// Hack!  The error message ends with a colon, a space, and
			// the "extra" characters.  We rely on that instead of
			// attempting to perfectly reproduce the parsing algorithm.
			if (err.indexOf(":") &amp;gt;= 0) {
				date = this._base_parseDate(format, value.substring(0,value.length-(err.length-err.indexOf(':')-2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format);
			} else {
				throw err;
			}
		}
		return date;
	};

	/*
	* override formatDate to set date with time to the input
	*/
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function(inst, day, month, year) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val();
		}
		return this._base_formatDate(inst);
	};

	/*
	* override options setter to add time to maxDate(Time) and minDate(Time). MaxDate
	*/
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function(target, name, value) {
		var inst = this._getInst(target),
	        name_clone;
		if (!inst) {
			return null;
		}

		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop;
		    if (typeof name == 'string') { // if min/max was set with the string
		        if (name === 'minDate' || name === 'minDateTime') {
		            min = value;
		        } else if (name === 'maxDate' || name === 'maxDateTime') {
		            max = value;
		        } else if (name === 'onSelect') {
		            onselect = value;
		        } else if (overrides.hasOwnProperty(name)) {
		            if (typeof (value) === 'undefined') {
		                return overrides[name];
		            }
		            fns[name] = value;
		            name_clone = {}; //empty results in exiting function after overrides updated
		        }
		    } else if (typeof name == 'object') { //if min/max was set with the JSON
		        if (name.minDate) {
		            min = name.minDate;
		        } else if (name.minDateTime) {
		            min = name.minDateTime;
		        } else if (name.maxDate) {
		            max = name.maxDate;
		        } else if (name.maxDateTime) {
		            max = name.maxDateTime;
		        }
		        for (prop in overrides) {
		            if (overrides.hasOwnProperty(prop) &amp;amp;&amp;amp; name[prop]) {
		                fns[prop] = name[prop];
		            }
		        }
		    }
		    for (prop in fns) {
		        if (fns.hasOwnProperty(prop)) {
		            overrides[prop] = fns[prop];
		            if (!name_clone) { name_clone = $.extend({}, name);}
		            delete name_clone[prop];
		        }
		    }
		    if (name_clone &amp;amp;&amp;amp; isEmptyObject(name_clone)) { return; }
		    if (min) { //if min was set
		        if (min === 0) {
		            min = new Date();
		        } else {
		            min = new Date(min);
		        }
		        tp_inst._defaults.minDate = min;
		        tp_inst._defaults.minDateTime = min;
		    } else if (max) { //if max was set
		        if (max === 0) {
		            max = new Date();
		        } else {
		            max = new Date(max);
		        }
		        tp_inst._defaults.maxDate = max;
		        tp_inst._defaults.maxDateTime = max;
		    } else if (onselect) {
		        tp_inst._defaults.onSelect = onselect;
		    }
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name);
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
	};
	
	/*
	* jQuery isEmptyObject does not check hasOwnProperty - if someone has added to the object prototype,
	* it will return false for all objects
	*/
	var isEmptyObject = function(obj) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(obj)) {
				return false;
			}
		}
		return true;
	};

	/*
	* jQuery extend now ignores nulls!
	*/
	var extendRemove = function(target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] === null || props[name] === undefined) {
				target[name] = props[name];
			}
		}
		return target;
	};

	/*
	* Determine by the time format which units are supported
	* Returns an object of booleans for each unit
	*/
	var detectSupport = function(timeFormat){
		var tf = timeFormat.replace(/\'.*?\'/g,'').toLowerCase(), // removes literals
			isIn = function(f, t){ // does the format contain the token?
					return f.indexOf(t) !== -1? true:false; 
				};
		return {
				hour: isIn(tf,'h'),
				minute: isIn(tf,'m'),
				second: isIn(tf,'s'),
				millisec: isIn(tf,'l'),
				microsec: isIn(tf,'c'),
				timezone: isIn(tf,'z'),
				ampm: isIn(tf,'t') &amp;amp;&amp;amp; isIn(timeFormat,'h'),
				iso8601: isIn(timeFormat, 'Z')
			};
	};

	/*
	* Converts 24 hour format into 12 hour
	* Returns 12 hour without leading 0
	*/
	var convert24to12 = function(hour) {
		if (hour &amp;gt; 12) {
			hour = hour - 12;
		}

		if (hour === 0) {
			hour = 12;
		}

		return String(hour);
	};

	/*
	* Splits datetime string into date ans time substrings.
	* Throws exception when date can't be parsed
	* Returns [dateString, timeString]
	*/
	var splitDateTime = function(dateFormat, dateTimeString, dateSettings, timeSettings) {
		try {
			// The idea is to get the number separator occurances in datetime and the time format requested (since time has 
			// fewer unknowns, mostly numbers and am/pm). We will use the time pattern to split.
			var separator = timeSettings &amp;amp;&amp;amp; timeSettings.separator ? timeSettings.separator : $.timepicker._defaults.separator,
				format = timeSettings &amp;amp;&amp;amp; timeSettings.timeFormat ? timeSettings.timeFormat : $.timepicker._defaults.timeFormat,
				timeParts = format.split(separator), // how many occurances of separator may be in our format?
				timePartsLen = timeParts.length,
				allParts = dateTimeString.split(separator),
				allPartsLen = allParts.length;

			if (allPartsLen &amp;gt; 1) {
				return [
						allParts.splice(0,allPartsLen-timePartsLen).join(separator),
						allParts.splice(0,timePartsLen).join(separator)
					];
			}

		} catch (err) {
			$.timepicker.log('Could not split the date from the time. Please check the following datetimepicker options' +
					"\nthrown error: " + err +
					"\ndateTimeString" + dateTimeString +
					"\ndateFormat = " + dateFormat +
					"\nseparator = " + timeSettings.separator +
					"\ntimeFormat = " + timeSettings.timeFormat);

			if (err.indexOf(":") &amp;gt;= 0) {
				// Hack!  The error message ends with a colon, a space, and
				// the "extra" characters.  We rely on that instead of
				// attempting to perfectly reproduce the parsing algorithm.
				var dateStringLength = dateTimeString.length - (err.length - err.indexOf(':') - 2),
					timeString = dateTimeString.substring(dateStringLength);

				return [$.trim(dateTimeString.substring(0, dateStringLength)), $.trim(dateTimeString.substring(dateStringLength))];

			} else {
				throw err;
			}
		}
		return [dateTimeString, ''];
	};

	/*
	* Internal function to parse datetime interval
	* Returns: {date: Date, timeObj: Object}, where
	*   date - parsed date without time (type Date)
	*   timeObj = {hour: , minute: , second: , millisec: , microsec: } - parsed time. Optional
	*/
	var parseDateTimeInternal = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var date;
		var splitRes = splitDateTime(dateFormat, dateTimeString, dateSettings, timeSettings);
		date = $.datepicker._base_parseDate(dateFormat, splitRes[0], dateSettings);
		if (splitRes[1] !== '') {
			var timeString = splitRes[1],
				parsedTime = $.datepicker.parseTime(timeFormat, timeString, timeSettings);

			if (parsedTime === null) {
				throw 'Wrong time format';
			}
			return {
				date: date,
				timeObj: parsedTime
			};
		} else {
			return {
				date: date
			};
		}
	};

	/*
	* Internal function to set timezone_select to the local timezone
	*/
	var selectLocalTimezone = function(tp_inst, date) {
		if (tp_inst &amp;amp;&amp;amp; tp_inst.timezone_select) {
			var now = typeof date !== 'undefined' ? date : new Date();
			tp_inst.timezone_select.val(now.getTimezoneOffset()*-1);
		}
	};

	/*
	* Create a Singleton Insance
	*/
	$.timepicker = new Timepicker();

	/**
	 * Get the timezone offset as string from a date object (eg '+0530' for UTC+5.5)
	 * @@param  number if not a number this value is returned
	 * @@param boolean if true formats in accordance to iso8601 "+12:45"
	 * @@return string
	 */
	$.timepicker.timezoneOffsetString = function(tzMinutes, iso8601) {
		if(isNaN(tzMinutes) || tzMinutes &amp;gt; 840){
			return tzMinutes;
		}

		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601? ':':'',
			tz = (off &amp;gt;= 0 ? '+' : '-') + ('0' + (hours * 101).toString()).slice(-2) + iso + ('0' + (minutes * 101).toString()).slice(-2);
		
		if(tz == '+00:00'){
			return 'Z';
		}
		return tz;
	};

	/**
	 * Get the number in minutes that represents a timezone string
	 * @@param  string formated like "+0500", "-1245"
	 * @@return number
	 */
	$.timepicker.timezoneOffsetNumber = function(tzString) {
		tzString = tzString.toString().replace(':',''); // excuse any iso8601, end up with "+1245"

		if(tzString.toUpperCase() === 'Z'){ // if iso8601 with Z, its 0 minute offset
			return 0;
		}

		if(!/^(\-|\+)\d{4}$/.test(tzString)){ // possibly a user defined tz, so just give it back
			return tzString;
		}

		return ((tzString.substr(0,1) =='-'? -1 : 1) * // plus or minus
					((parseInt(tzString.substr(1,2),10)*60) + // hours (converted to minutes)
					parseInt(tzString.substr(3,2),10))); // minutes
	};

	/**
	 * No way to set timezone in js Date, so we must adjust the minutes to compensate. (think setDate, getDate)
	 * @@param  date
	 * @@param  string formated like "+0500", "-1245"
	 * @@return date
	 */
	$.timepicker.timezoneAdjust = function(date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if(!isNaN(toTz)){
			date.setMinutes(date.getMinutes()*1 + (date.getTimezoneOffset()*-1 - toTz*1) );
		}
		return date;
	};

	/**
	 * Calls `timepicker()` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * n.b. The input value must be correctly formatted (reformatting is not supported)
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the timepicker() call
	 * @@return jQuery
	 */
	$.timepicker.timeRange = function(startTime, endTime, options) {
		return $.timepicker.handleRange('timepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datetimepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@return jQuery
	 */
	$.timepicker.datetimeRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datetimepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.dateRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.handleRange = function(method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0, // min allowed interval in milliseconds
			maxInterval: 0, // max allowed interval in milliseconds
			start: {},      // options for start picker
			end: {}         // options for end picker
		}, options);

		$.fn[method].call(startTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), endTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), endTime, 'minDate');
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), startTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), startTime, 'maxDate');
			}
		}, options, options.end));

		checkDates(startTime, endTime);
		selected(startTime, endTime, 'minDate');
		selected(endTime, startTime, 'maxDate');

		function checkDates(changed, other) {
			var startdt = startTime[method]('getDate'),
				enddt = endTime[method]('getDate'),
				changeddt = changed[method]('getDate');

			if(startdt !== null){
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());

				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);

				if(options.minInterval &amp;gt; 0 &amp;amp;&amp;amp; minDate &amp;gt; enddt){ // minInterval check
					endTime[method]('setDate',minDate);
				}
				else if(options.maxInterval &amp;gt; 0 &amp;amp;&amp;amp; maxDate &amp;lt; enddt){ // max interval check
					endTime[method]('setDate',maxDate);
				}
				else if (startdt &amp;gt; enddt) {
					other[method]('setDate',changeddt);
				}
			}
		}

		function selected(changed, other, option) {
			if (!changed.val()) {
				return;
			}
			var date = changed[method].call(changed, 'getDate');
			if(date !== null &amp;amp;&amp;amp; options.minInterval &amp;gt; 0){
				if(option == 'minDate'){
					date.setMilliseconds(date.getMilliseconds() + options.minInterval); 
				}
				if(option == 'maxDate'){
					date.setMilliseconds(date.getMilliseconds() - options.minInterval);
				}
			}
			if (date.getTime) {
				other[method].call(other, 'option', option, date);
			}
		}
		return $([startTime.get(0), endTime.get(0)]);
	};

	/**
	 * Log error or data to the console during error or debugging
	 * @@param  Object err pass any type object to log to the console during error or debugging
	 * @@return void
	 */
	$.timepicker.log = function(err){
		if(window.console){
			console.log(err);
		}
	};

	/*
	* Microsecond support
	*/
	if(!Date.prototype.getMicroseconds){
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function(){ return this.microseconds; };
		Date.prototype.setMicroseconds = function(m){ 
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m/1000));
			this.microseconds = m%1000;
			return this;
		};
	}

	/*
	* Keep up with the version
	*/
	$.timepicker.version = "1.3.1";

})(jQuery);
jQuery.noConflict();
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;datetimepicker-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;e73a652e-09fc-4c71-8e7a-e2525a2d2a99&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
function replaceAllString(oriStr, strTarget, strSubString ){
   var strText = oriStr;
   var intIndexOfMatch = strText.indexOf( strTarget );
   while (intIndexOfMatch != -1){
      strText = strText.replace( strTarget, strSubString )
      intIndexOfMatch = strText.indexOf( strTarget );
   }
   return( strText );
}
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&amp;amp;]" + name + "=([^&amp;amp;#]*)"),
    results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
};


   var jobName= getParameterByName('job')
   var fromDate= getParameterByName('fromDate')
   var toDate= getParameterByName('toDate')
   var limit= getParameterByName('limit')
   var selectedIstIid = getParameterByName('IstIid')

  $("#jobname").ready(function(){
   $("#jobname").text(jobName)
   var convertedJobName = replaceAllString(jobName, ".", "_")
   $("#IstIid" + convertedJobName).ready(function(){
     $("#IstIid" + convertedJobName).css("display","block")
     $("#select_" + convertedJobName).ready(function(){
        $("#select_" + convertedJobName).val(selectedIstIid)
     });
   });
 });

  $("#fromDate").ready(function(){
   $("#from-date").val(fromDate)
 });

  $("#toDate").ready(function(){
   $("#to-date").val(toDate)
 });

  $("#limit").ready(function(){
   if(limit!=""){
    $("#limit").val(limit)
   }
 });
 // Get data with ajax
 function ajax_getData(jobName,fromDate,toDate,limit ){
       var convertedJobName = replaceAllString(jobName, ".", "_")
       var istIid = $("#select_" + convertedJobName).val()
       window.location="/xwiki/bin/view/WiperDog/WebHome?job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid="+istIid;
 			/*$.ajax({
			 type: "GET",
			 url:"/xwiki/bin/get/Sandbox/DescriptionForJob?outputSyntax=plain&amp;amp;job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid"+selectedIstIid,
			 success : function(result){
				$("#jobname").html(jobName)
				$("#display").text('[[]]' + result)
			 }
		   });*/
 }
	$("#treemenu2 a").click(function(){
		 var limit = 10
		 var fromDate=""
		 var toDate = ""
		 jobName= $(this).text()
                 $("#jobname").html(jobName)
                 var convertedJobName = replaceAllString(jobName, ".", "_")
                 $("#listIstIid &amp;gt; div").css("display","none")
                 $("#IstIid" + convertedJobName).css("display","block")
		 //ajax_getData(jobName,fromDate,toDate,limit )

	});

	$("#from-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
		dateFormat: 'yy-mm-dd',
	});
	$("#to-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
			dateFormat: 'yy-mm-dd',

	});
	 $("#get-data").on("click",function(){
		var fromDate = $("#from-date").val()
		var toDate =  $("#to-date").val()
		 if( toDate!= "" ){
			  if(fromDate != ""){
				  if($("#from-date").datepicker( "getDate" ) &amp;gt; $("#to-date").datepicker( "getDate" )){
				  alert("'From date' cannot start later than 'To date'")
				  return false
				  }
			  }
		 }
		 limit = $("#limit").val()
		 ajax_getData(jobName,fromDate,toDate,limit )
                 
                 /** Get livetable data */
                 //alert('job = ' + $("#jobname").text() + ',   istIid  = '+ selectedIstIid)
                 var dataModelUrl = '/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job='+$("#jobname").text()+'&amp;amp;limit='
                     +$("#limit").text()+'&amp;amp;fromDate='
	             +fromDate + '&amp;amp;toDate=' + toDate +   '&amp;amp;pager=pager2&amp;amp;genp=1&amp;amp;istIid='+selectedIstIid
		 var jqxhr = $.getJSON(dataModelUrl, function(data) {
				$("#livetableList").jqGrid(data);
				$("#livetableList").jqGrid('navGrid', "#livetablePager", {
				    edit : false,
				    add : false,
				    del : false
				});
			})
	});
        
jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;process&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;881686cc-1bfc-456e-b8ab-71334c4a45e5&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){

$(function () {
    function drawLineChart(xAxis, series, container, data_detail){
        var dataXAxis = xAxis
        var dataSeries = series
        var detail = data_detail

			$('#containerline' + container).highcharts({

				chart: {
					type:'line'
				},
				title: {
					text: container
				},
				tooltip :{
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				xAxis: dataXAxis ,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				series: dataSeries
			});
		};

		function drawBarChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerbar' + container).highcharts({
				chart: {
					type: 'column'
				},
				title: {
					text: container
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {

					column: {
						pointPadding: 0.2,
						borderWidth: 0
					}
				},
				series: dataSeries
			});
		}

		function drawAreaChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail
			$('#containerarea' + container).highcharts({
				chart: {
					type: 'area'
				},
				title: {
					text: container
				},
				subtitle: {
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					},
					labels: {
						formatter: function() {
							return this.value / 1000;
						}
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {
					area: {
						stacking: 'normal',
						lineColor: '#666666',
						lineWidth: 1,
						marker: {
							lineWidth: 1,
							lineColor: '#666666'
						}
					}
				},
				series: dataSeries
			});
		};

		function drawPieChart(data, container){
			var dataPie = data
			$(document).ready(function () {
				// Build the chart
				$('#container' + container).highcharts({
					chart: {
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: dataPie[0].name
					},
					tooltip: {
						pointFormat: '{series.name}: &amp;lt;b&amp;gt;{point.percentage:.1f}%&amp;lt;/b&amp;gt;'
					},
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							dataLabels: {
								enabled: false
							},
							showInLegend: true
						}
					},
					series: dataPie
				});
			});
		}

		// LINE
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonline_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonline");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Line chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						if(data_all[0][i].series[0].name == null){
							data_all[0][i].series[0].name = lstContainer[0][i]
						}
						drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
					}
				}
			}
		});

		// BAR
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonbar_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonbar");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Bar chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						drawBarChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
					}
				}
			}
		});

		// AREA
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonarea_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonarea");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				// data to display on tooltip
				var data_detail = data_all[0]
				// draw Area Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					drawAreaChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
				}
			}
		});

		// PIE
		$("#piechart").ready(function(){

			var array = $("#jsons&amp;gt;.jsonpie");
			var arrayContainer = $("#jsons&amp;gt;.lstcontainerpie");
			var lstContainer = [];
			var data_all = [];
			for(var i=0;i&amp;lt;array.length;i++){
				data_all[i] = jQuery.parseJSON(array[i].value)
				lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)

			}
			if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
				// data to display on tooltip
				// draw Pie Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					var finalData = []
					finalData[0] = data_all[0][i]
					drawPieChart(finalData, lstContainer[0][i])
				}
			}
		});
	});
	jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;d5873d92-b78b-42fc-9407-46d166204b88&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;/* css for timepicker */
.ui-timepicker-div .ui-widget-header { 
margin-bottom: 8px;
 }

.ui-timepicker-div dl { text-align: left; }
.ui-timepicker-div dl dt { height: 25px; margin-bottom: -25px; }
.ui-timepicker-div dl dd { margin: 0 10px 10px 65px; }
.ui-timepicker-div td { font-size: 90%; }
.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }

.ui-timepicker-rtl{ direction: rtl; }
.ui-timepicker-rtl dl { text-align: right; }
.ui-timepicker-rtl dl dd { margin: 0 65px 10px 10px; }
#ui-datepicker-div{
 position:relative;
 width:auto;
 height:auto
}
&lt;/code&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;datetimepicker -css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;1201fb1a-e9c1-4731-8c74-2ea8c0071959&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;.displayblock {
  border:2px solid;
  -webkit-border-radius:6px;
  background:gray;
  float: left;
  width:100%;
}

.displaypie {
  border:1px solid;
  -webkit-border-radius:6px;
  background:gray;
  width: 48%;
  float: left; 
  height: 300px;
}

.subtype {
  margin-top: 50px;
  font-size: 2em;
  color: red;
}&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;content&gt;{{include document="Lib.DataToDrawChart"/}}
{{include document="Lib.MongoDBConnection"/}}
{{velocity}}
$xwiki.jsx.use('Lib.JQueryUILib')
$xwiki.ssx.use('Lib.MenuGenerator')
$xwiki.jsx.use('Lib.MenuGenerator')
$xwiki.ssx.use('Lib.JQueryUILib')
{{/velocity}}
{{include document="Lib.MenuGenerator"/}}
{{html wiki="true" clean="false"}}
&amp;lt;div id="viewer"&amp;gt;
&amp;lt;table style="text-align:left"  &amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th &amp;gt;Job name&amp;lt;/th&amp;gt;
  &amp;lt;td colspan=3&amp;gt;&amp;lt;div id="jobname"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
{{groovy}}
import org.xwiki.context.*

def ec = services.component.getInstance(Execution.class).getContext()
def mapJobIstIid = ec.getProperty("mapJobIstIid")

println '{{html clean="false" wiki="false"}}'
println '&amp;lt;tr&amp;gt;'
println '&amp;lt;th&amp;gt;IstIid&amp;lt;/th&amp;gt;'
println '&amp;lt;td colspan=3&amp;gt;'
mapJobIstIid.each{jobEntry-&amp;gt;
  def convertedJobKey = jobEntry.key.replaceAll("\\.","_")
  println "&amp;lt;div id='listIstIid'&amp;gt;"
  println "&amp;lt;div id=IstIid${convertedJobKey} style='display:none'&amp;gt;"
  println "&amp;lt;select id=select_${convertedJobKey}&amp;gt;"
  jobEntry.value.each{
     println "&amp;lt;option value=\"$it\"&amp;gt;$it&amp;lt;/option&amp;gt;"
  }
  println "&amp;lt;/select&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
}
println '&amp;lt;/td&amp;gt;'
println '&amp;lt;/tr&amp;gt;'
println '{{/html}}'
{{/groovy}}
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data monitor from&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="from-date" id="from-date"/&amp;gt;&amp;lt;/td&amp;gt;
  &amp;lt;th&amp;gt;Data monitor to&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="to-date" id="to-date"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data records limit &amp;lt;/th&amp;gt;
  &amp;lt;td &amp;gt;
     &amp;lt;select id="limit"&amp;gt;
       &amp;lt;option value=5&amp;gt;5&amp;lt;/option&amp;gt;
       &amp;lt;option value=10&amp;gt;10&amp;lt;/option&amp;gt;
       &amp;lt;option value=15&amp;gt;15&amp;lt;/option&amp;gt;
       &amp;lt;option value=20&amp;gt;20&amp;lt;/option&amp;gt;
     &amp;lt;/select&amp;gt;
  &amp;lt;/td&amp;gt;
  &amp;lt;td colspan=3 &amp;gt;&amp;lt;input type="button" value="View Data" id="get-data" class="button"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt; 
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;&amp;lt;div id="display"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
&amp;lt;/table&amp;gt;

&amp;lt;/div&amp;gt; 
 &amp;lt;table style="text-align:left"  &amp;gt;
	&amp;lt;tr&amp;gt;
		&amp;lt;td&amp;gt;
 			Begin livetable
 		&amp;lt;/td&amp;gt;
 		&amp;lt;td&amp;gt;
 			&amp;lt;table id="livetableList"&amp;gt;&amp;lt;/table&amp;gt;
 			&amp;lt;div id="livetablePager"&amp;gt;Begin livetable&amp;lt;/div&amp;gt;
 		&amp;lt;/td&amp;gt; 	
 	&amp;lt;/tr&amp;gt;
 &amp;lt;/table&amp;gt;
 &amp;lt;/body&amp;gt;
{{/html}}
{{groovy}}
import groovy.json.*
xwiki.jsx.use("Lib.Highcharts")

if(request.xpage == "plain") {
	response.setContentType('text/plain')
}

def listData = []
def job = request.get("job")
def fromDate = request.get("fromDate")
def toDate = request.get("toDate")
def limit= (request.get("limit")!=null)?request.get("limit").toInteger():10
def istIid = request.get("IstIid")

def str= "No data to retrieved !"
def result = null
if(job != "" &amp;amp;&amp;amp; job != null &amp;amp;&amp;amp; istIid != null &amp;amp;&amp;amp; istIid != ""){
	MongoDBConnection.getConnection()
	if(fromDate != "" || toDate != ""){
		result = MongoDBConnection.getDataInPeriod(job,fromDate,toDate,limit,istIid)
	} else {
		result = MongoDBConnection.getDataAllFields(job,limit,istIid)
        }
MongoDBConnection.closeConnection()
} else {
   println "{{warning}}There are no selected job or IstIid{{/warning}}"
}

if( (result != null) &amp;amp;&amp;amp; (result.size() &amp;gt; 0) &amp;amp;&amp;amp; (result[0].KEYEXPR != null)&amp;amp;&amp;amp;!(result[0].KEYEXPR instanceof List )){
if(result[0].type == "Subtyped") {
    println '{{html clean="false" wiki="true"}}'
    //println '&amp;lt;body&amp;gt;'
    def dataSubtype = DataToDrawChart.getDataToDrawSubtype(result)
    def listKey = []
    dataSubtype.each {key,value -&amp;gt;
        listKey.add(key)
    }
    def jsonkey = com.mongodb.util.JSON.serialize(listKey)
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$jsonkey&amp;lt;/textarea&amp;gt;"

    dataSubtype.each {key,value -&amp;gt;
        println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +'&amp;lt;/div&amp;gt;'
        println "-----"
        def dataLine = []
        def dataBar = []
        def dataPie = []
        def dataArea = []
        if(DataToDrawChart.getDataToDrawLine(value) != []) {
            dataLine = DataToDrawChart.getDataToDrawLine(value)
        }
        if(DataToDrawChart.getDataToDrawBar(value) != []) {
            dataBar = DataToDrawChart.getDataToDrawBar(value)
        }
        if(DataToDrawChart.getDataToDrawPie(value) != []) {
            dataPie = DataToDrawChart.getDataToDrawPie(value)
        }
        if(DataToDrawChart.getDataToDrawArea(value) != []) {
            dataArea = DataToDrawChart.getDataToDrawArea(value)
        }

        def chartColumnsLine
        def chartColumnsBar 
        def chartColumnsArea 
        def lstName
        if(dataLine.size() &amp;gt; 0 ){
            chartColumnsLine = dataLine[0].chart_columns
        }
        if(dataBar.size() &amp;gt; 0){
            chartColumnsBar = dataBar[0].chart_columns
        }
        if(dataArea.size() &amp;gt; 0 ){
            chartColumnsArea = dataArea[0].chart_columns
        }
        if(dataPie.size() &amp;gt; 0 ){
            lstName = dataPie['name']
        }

        def tmpListNameContainer = []
	for(def nameContainer in lstName){
	   nameContainer = nameContainer.replaceAll("\\.", "_")
	   tmpListNameContainer.add(nameContainer)
	}
        def jsonPie
        def jsonLine
	def jsonBar
        def jsonArea
        if(dataPie != []) {
	    jsonPie = com.mongodb.util.JSON.serialize(dataPie)
        }
        if(dataLine != []) {
	    jsonLine = com.mongodb.util.JSON.serialize(dataLine)
        }
        if(dataBar != []) {
            jsonBar = com.mongodb.util.JSON.serialize(dataBar)
        }
        if(dataArea != []) {
	    jsonArea = com.mongodb.util.JSON.serialize(dataArea)
        }

	def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
	def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
	def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
	def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

	println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
        if(jsonLine != null) {
	    println "&amp;lt;textarea id=\"jsonline_$key\" &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;" 
        }
	if(jsonBar != null) {
            println "&amp;lt;textarea id=\"jsonbar_$key\"&amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
 	    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
        }
        if(jsonPie != null) {
	    println "&amp;lt;textarea id=\"jsonpie_$key\" &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
        }
        if(jsonArea != null) {
	    println "&amp;lt;textarea id=\"jsonarea_$key\" &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"
	    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
        }

	println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
	println "&amp;lt;input style=\"display:none\" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;"
	println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
	println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'
	println "&amp;lt;/div&amp;gt;"
	  
	def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
	def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
	  
	println "&amp;lt;div style='clear:both'&amp;gt;"
        if(jsonPie != null) {
	  println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
	  lstName.each{
	    def tmp = it.replaceAll("\\.", "_")
	    println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
        if(jsonLine != null) {
	  def chartLineComment = false
	  chartColumnsLine.each{
	    if(!chartLineComment){
	       println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	       chartLineComment = true  
	    }

	      println " &amp;lt;div class=\"displayblock\" id=\"containerline${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
        println "&amp;amp;nbsp;"

        if(jsonBar != null) {
	  def chartBarComment = false
	  chartColumnsBar.each{
	     if(!chartBarComment){
	        println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	        chartBarComment = true
	      }  

	     println " &amp;lt;div class=\"displayblock\" id=\"containerbar${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
	println "&amp;amp;nbsp;"

        if(jsonArea != null) {
	  def chartAreaComment = false
	  chartColumnsArea.each{
	  if(!chartAreaComment){
	    println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	    chartAreaComment = true
	  }
	    println " &amp;lt;div class=\"displayblock\" id=\"containerarea${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
	println "&amp;lt;/div&amp;gt;"
        
    }
    println '&amp;lt;/body&amp;gt;'
    println '{{/html}}'
} else if(result[0].type == "Store") {
    // data store
    def dataLine = DataToDrawChart.getDataToDrawLine(result)
    def dataBar = DataToDrawChart.getDataToDrawBar(result)
    def dataPie = DataToDrawChart.getDataToDrawPie(result)
    def dataArea = DataToDrawChart.getDataToDrawArea(result)
    def chartColumnsLine 
    def chartColumnsBar 
    def chartColumnsArea 
    def lstName 

    if(dataLine.size() &amp;gt; 0 ){
        chartColumnsLine = dataLine[0].chart_columns
    }
    if(dataBar.size() &amp;gt; 0){
        chartColumnsBar = dataBar[0].chart_columns
    }
    if(dataArea.size() &amp;gt; 0 ){
        chartColumnsArea = dataArea[0].chart_columns
    }
    if(dataPie.size() &amp;gt; 0 ){
        lstName = dataPie['name']
    }

    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
  
    def tmpListNameContainer = []
    for(def nameContainer in lstName){
       nameContainer = nameContainer.replaceAll("\\.", "_")
       tmpListNameContainer.add(nameContainer)
    }
  
    def jsonPie = com.mongodb.util.JSON.serialize(dataPie)
    def jsonLine = com.mongodb.util.JSON.serialize(dataLine)
    def jsonBar = com.mongodb.util.JSON.serialize(dataBar)
    def jsonArea = com.mongodb.util.JSON.serialize(dataArea)

    def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
    def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
    def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
    def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

    def listEmpty = com.mongodb.util.JSON.serialize([])
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$listEmpty&amp;lt;/textarea&amp;gt;" 

    println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'

    println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
    println "&amp;lt;textarea class='jsonline' &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonbar' &amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonpie' &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonarea' &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"

    println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
  
    def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
    def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
  
    println "&amp;lt;div style='clear:both'&amp;gt;"
  
    def chartPieComment = false
    lstName.each{
        if(!chartPieComment) {
            println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
            chartPieComment = true
        }
        def tmp = it.replaceAll("\\.", "_")
        println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    def chartLineComment = false
    chartColumnsLine.each{
    if(!chartLineComment){
        println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
        chartLineComment = true  
    }

    println " &amp;lt;div class=\"displayblock\" id=\"containerline$it\"&amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    println "&amp;amp;nbsp;"
    def chartBarComment = false
    chartColumnsBar.each{
        if(!chartBarComment){
            println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
            chartBarComment = true
        }  

    println " &amp;lt;div class=\"displayblock\" id=\"containerbar$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
  println "&amp;lt;/div&amp;gt;"
  println "&amp;amp;nbsp;"
  def chartAreaComment = false
  chartColumnsArea.each{
  if(!chartAreaComment){
    println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
    chartAreaComment = true
  }
    println " &amp;lt;div class=\"displayblock\" id=\"containerarea$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
  println "&amp;lt;/div&amp;gt;"
println "&amp;lt;/div&amp;gt;"

println '&amp;lt;/body&amp;gt;'
println '{{/html}}'
}
}else{
    println 'There is no data for this job with criterias'
}
{{/groovy}}&lt;/content&gt;&lt;/xwikidoc&gt;
@


38.2
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376376418000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;38.2&lt;/version&gt;
d21 1
a21 1
&lt;minorEdit&gt;true&lt;/minorEdit&gt;
d2425 3
a2427 3
                 alert('job = ' + $("#jobname").text() + ',   istIid  = '+ selectedIstIid)
                 var dataModelUrl = '/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job='+$("#jobname").val()+'&amp;amp;limit='
                     +$("#limit").val()+'&amp;amp;fromDate='
@


38.1
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376376358000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;38.1&lt;/version&gt;
d21 1
a21 1
&lt;minorEdit&gt;false&lt;/minorEdit&gt;
d2425 1
a2425 1
                 alert('job = ' + $("#jobname").val() + ',   istIid  = '+ selectedIstIid)
@


37.2
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376376280000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;37.2&lt;/version&gt;
d21 1
a21 1
&lt;minorEdit&gt;true&lt;/minorEdit&gt;
d2534 5
a2538 5
	$(function () {
		function drawLineChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail
d2792 1
a2792 1
						// draw bar chart
d2797 1
a2797 1
							drawBarChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
d2843 1
a2843 1
							drawAreaChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
d2866 18
a2883 22
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonpie_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerpie");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						// draw Pie Chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							var finalData = []
							finalData[0] = data_all[0][i]
							drawPieChart(finalData, finalKey + "_" + lstContainer[0][i])
						}
					}
a2884 18
			} else {
				var array = $("#jsons&amp;gt;.jsonpie");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerpie");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					// draw Pie Chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						var finalData = []
						finalData[0] = data_all[0][i]
						drawPieChart(finalData, lstContainer[0][i])
					}
				}
@


37.1
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376375853000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;37.1&lt;/version&gt;
d21 1
a21 1
&lt;minorEdit&gt;false&lt;/minorEdit&gt;
d2534 5
a2538 5
$(function () {
    function drawLineChart(xAxis, series, container, data_detail){
        var dataXAxis = xAxis
        var dataSeries = series
        var detail = data_detail
d2792 1
a2792 1
						// draw Line chart
d2797 1
a2797 1
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
d2843 1
a2843 1
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
d2866 22
a2887 18
		$("#piechart").ready(function(){

			var array = $("#jsons&amp;gt;.jsonpie");
			var arrayContainer = $("#jsons&amp;gt;.lstcontainerpie");
			var lstContainer = [];
			var data_all = [];
			for(var i=0;i&amp;lt;array.length;i++){
				data_all[i] = jQuery.parseJSON(array[i].value)
				lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)

			}
			if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
				// data to display on tooltip
				// draw Pie Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					var finalData = []
					finalData[0] = data_all[0][i]
					drawPieChart(finalData, lstContainer[0][i])
d2889 18
@


36.3
log
@@
text
@&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xwikidoc&gt;
&lt;web&gt;WiperDog&lt;/web&gt;
&lt;name&gt;WebHome&lt;/name&gt;
&lt;language&gt;&lt;/language&gt;
&lt;defaultLanguage&gt;en&lt;/defaultLanguage&gt;
&lt;translation&gt;0&lt;/translation&gt;
&lt;parent&gt;&lt;/parent&gt;
&lt;creator&gt;XWiki.Admin&lt;/creator&gt;
&lt;author&gt;XWiki.Admin&lt;/author&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;contentAuthor&gt;XWiki.Admin&lt;/contentAuthor&gt;
&lt;creationDate&gt;1376364375000&lt;/creationDate&gt;
&lt;date&gt;1376375835000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376375518000&lt;/contentUpdateDate&gt;
&lt;version&gt;36.3&lt;/version&gt;
&lt;title&gt;WiperDog&lt;/title&gt;
&lt;defaultTemplate&gt;&lt;/defaultTemplate&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;comment&gt;&lt;/comment&gt;
&lt;minorEdit&gt;true&lt;/minorEdit&gt;
&lt;syntaxId&gt;xwiki/2.1&lt;/syntaxId&gt;
&lt;hidden&gt;false&lt;/hidden&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;047293a8-524d-45e4-af52-cd944523d5d0&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
/*
 * jQuery timepicker addon
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 1.3.1
 * Last Modified: 07/07/2013
 *
 * Copyright 2013 Trent Richardson
 * You may use this project under MIT or GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 */

/*jslint evil: true, white: false, undef: false, nomen: false */

(function($) {

	/*
	* Lets not redefine timepicker, Prevent "Uncaught RangeError: Maximum call stack size exceeded"
	*/
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return;
	}

	/*
	* Extend jQueryUI, get it started with our version number
	*/
	$.extend($.ui, {
		timepicker: {
			version: "1.3.1"
		}
	});

	/* 
	* Timepicker manager.
	* Use the singleton instance of this class, $.timepicker, to interact with the time picker.
	* Settings for (groups of) time pickers are maintained in an instance object,
	* allowing multiple different settings on the same page.
	*/
	var Timepicker = function() {
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[''] = { // Default regional settings
			currentText: 'Now',
			closeText: 'Done',
			amNames: ['AM', 'A'],
			pmNames: ['PM', 'P'],
			timeFormat: 'HH:mm',
			timeSuffix: '',
			timeOnlyTitle: 'Choose Time',
			timeText: 'Time',
			hourText: 'Hour',
			minuteText: 'Minute',
			secondText: 'Second',
			millisecText: 'Millisecond',
			microsecText: 'Microsecond',
			timezoneText: 'Time Zone',
			isRTL: false
		};
		this._defaults = { // Global defaults for all the datetime picker instances
			showButtonPanel: true,
			timeOnly: false,
			showHour: null,
			showMinute: null,
			showSecond: null,
			showMillisec: null,
			showMicrosec: null,
			showTimezone: null,
			showTime: true,
			stepHour: 1,
			stepMinute: 1,
			stepSecond: 1,
			stepMillisec: 1,
			stepMicrosec: 1,
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null,
			hourMin: 0,
			minuteMin: 0,
			secondMin: 0,
			millisecMin: 0,
			microsecMin: 0,
			hourMax: 23,
			minuteMax: 59,
			secondMax: 59,
			millisecMax: 999,
			microsecMax: 999,
			minDateTime: null,
			maxDateTime: null,
			onSelect: null,
			hourGrid: 0,
			minuteGrid: 0,
			secondGrid: 0,
			millisecGrid: 0,
			microsecGrid: 0,
			alwaysSetTime: true,
			separator: ' ',
			altFieldTimeOnly: true,
			altTimeFormat: null,
			altSeparator: null,
			altTimeSuffix: null,
			pickerTimeFormat: null,
			pickerTimeSuffix: null,
			showTimepicker: true,
			timezoneList: null,
			addSliderAccess: false,
			sliderAccessArgs: null,
			controlType: 'slider',
			defaultValue: null,
			parse: 'strict'
		};
		$.extend(this._defaults, this.regional['']);
	};

	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: '',
		formattedDate: '',
		formattedTime: '',
		formattedDateTime: '',
		timezoneList: null,
		units: ['hour','minute','second','millisec', 'microsec'],
		support: {},
		control: null,

		/* 
		* Override the default settings for all instances of the time picker.
		* @@param  settings  object - the new settings to use as defaults (anonymous object)
		* @@return the manager object
		*/
		setDefaults: function(settings) {
			extendRemove(this._defaults, settings || {});
			return this;
		},

		/*
		* Create a new Timepicker instance
		*/
		_newInst: function($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
            	fns = {},
		    	overrides, i;

			for (var attrName in this._defaults) {
				if(this._defaults.hasOwnProperty(attrName)){
					var attrValue = $input.attr('time:' + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue);
						} catch (err) {
							inlineSettings[attrName] = attrValue;
						}
					}
				}
			}

		    overrides = {
		        beforeShow: function (input, dp_inst) {
		            if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
		                return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst);
		            }
		        },
		        onChangeMonthYear: function (year, month, dp_inst) {
		            // Update the time as well : this prevents the time from disappearing from the $input field.
		            tp_inst._updateDateTime(dp_inst);
		            if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
		                tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst);
		            }
		        },
		        onClose: function (dateText, dp_inst) {
		            if (tp_inst.timeDefined === true &amp;amp;&amp;amp; $input.val() !== '') {
		                tp_inst._updateDateTime(dp_inst);
		            }
		            if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
		                tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst);
		            }
		        }
		    };
		    for (i in overrides) {
		        if (overrides.hasOwnProperty(i)) {
		            fns[i] = opts[i] || null;
		        }
		    }

		    tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
		        evnts:fns,
		        timepicker: tp_inst // add timepicker as a property of datepicker: $.datepicker._get(dp_inst, 'timepicker');
		    });
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function(val) {
				return val.toUpperCase();
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function(val) {
				return val.toUpperCase();
			});

			// detect which units are supported
			tp_inst.support = detectSupport(
					tp_inst._defaults.timeFormat + 
					(tp_inst._defaults.pickerTimeFormat? tp_inst._defaults.pickerTimeFormat:'') + 
					(tp_inst._defaults.altTimeFormat? tp_inst._defaults.altTimeFormat:''));

			// controlType is string - key to our this._controls
			if(typeof(tp_inst._defaults.controlType) === 'string'){
				if(tp_inst._defaults.controlType == 'slider' &amp;amp;&amp;amp; typeof(jQuery.ui.slider) === 'undefined'){
					tp_inst._defaults.controlType = 'select';
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType];
			}
			// controlType is an object and must implement create, options, value methods
			else{ 
				tp_inst.control = tp_inst._defaults.controlType;
			}

			// prep the timezone options
			var timezoneList = [-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,
					0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList;
			}
			var tzl=timezoneList.length,tzi=0,tzv=null;
			if (tzl &amp;gt; 0 &amp;amp;&amp;amp; typeof timezoneList[0] !== 'object') {
				for(; tzi&amp;lt;tzl; tzi++){
					tzv = timezoneList[tzi];
					timezoneList[tzi] = { value: tzv, label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601) };
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;

			// set the default units
			tp_inst.timezone = tp_inst._defaults.timezone !== null? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) : 
							((new Date()).getTimezoneOffset()*-1);
			tp_inst.hour = tp_inst._defaults.hour &amp;lt; tp_inst._defaults.hourMin? tp_inst._defaults.hourMin : 
							tp_inst._defaults.hour &amp;gt; tp_inst._defaults.hourMax? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute &amp;lt; tp_inst._defaults.minuteMin? tp_inst._defaults.minuteMin : 
							tp_inst._defaults.minute &amp;gt; tp_inst._defaults.minuteMax? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second &amp;lt; tp_inst._defaults.secondMin? tp_inst._defaults.secondMin : 
							tp_inst._defaults.second &amp;gt; tp_inst._defaults.secondMax? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec &amp;lt; tp_inst._defaults.millisecMin? tp_inst._defaults.millisecMin : 
							tp_inst._defaults.millisec &amp;gt; tp_inst._defaults.millisecMax? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec &amp;lt; tp_inst._defaults.microsecMin? tp_inst._defaults.microsecMin : 
							tp_inst._defaults.microsec &amp;gt; tp_inst._defaults.microsecMax? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = '';
			tp_inst.$input = $input;

			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField).css({
					cursor: 'pointer'
				}).focus(function() {
					$input.trigger("focus");
				});
			}

			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date();
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date();
			}

			// datepicker needs minDate/maxDate, timepicker needs minDateTime/maxDateTime..
			if (tp_inst._defaults.minDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime());
			}
			if (tp_inst._defaults.minDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime());
			}
			if (tp_inst._defaults.maxDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime());
			}
			if (tp_inst._defaults.maxDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime());
			}
			tp_inst.$input.bind('focus', function() {
				tp_inst._onFocus();
			});

			return tp_inst;
		},

		/*
		* add our sliders to the calendar
		*/
		_addTimePicker: function(dp_inst) {
			var currDT = (this.$altInput &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly) ? this.$input.val() + ' ' + this.$altInput.val() : this.$input.val();

			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
		},

		/*
		* parse the time string from input value or _setTime
		*/
		_parseTime: function(timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0]);
			}

			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, 'dateFormat');
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false;
					}
					$.extend(this, parseRes.timeObj);
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err +
									"\ndate/time string = " + timeString +
									"\ntimeFormat = " + this._defaults.timeFormat +
									"\ndateFormat = " + dp_dateFormat);
					return false;
				}
				return true;
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false;
				}
				$.extend(this, timeObj);
				return true;
			}
		},

		/*
		* generate and inject html for timepicker into ui datepicker
		*/
		_injectTimePicker: function() {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = '',
				uitem = '',
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i=0,
				l=0;

			// Prevent displaying twice
			if ($dp.find("div.ui-timepicker-div").length === 0 &amp;amp;&amp;amp; o.showTimepicker) {
				var noDisplay = ' style="display:none;"',
					html = '&amp;lt;div class="ui-timepicker-div'+ (o.isRTL? ' ui-timepicker-rtl' : '') +'"&amp;gt;&amp;lt;dl&amp;gt;' + '&amp;lt;dt class="ui_tpicker_time_label"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;' + o.timeText + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_time"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the markup
				for(i=0,l=this.units.length; i&amp;lt;l; i++){
					litem = this.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// Added by Peter Medeiros:
					// - Figure out what the hour/minute/second max should be based on the step values.
					// - Example: if stepMinute is 15, then minMax is 45.
					max[litem] = parseInt((o[litem+'Max'] - ((o[litem+'Max'] - o[litem+'Min']) % o['step'+uitem])), 10);
					gridSize[litem] = 0;

					html += '&amp;lt;dt class="ui_tpicker_'+ litem +'_label"' + (show ? '' : noDisplay) + '&amp;gt;' + o[litem +'Text'] + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_'+ litem +'"&amp;gt;&amp;lt;div class="ui_tpicker_'+ litem +'_slider"' + (show ? '' : noDisplay) + '&amp;gt;&amp;lt;/div&amp;gt;';

					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						html += '&amp;lt;div style="padding-left: 1px"&amp;gt;&amp;lt;table class="ui-tpicker-grid-label"&amp;gt;&amp;lt;tr&amp;gt;';

						if(litem == 'hour'){
							for (var h = o[litem+'Min']; h &amp;lt;= max[litem]; h += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm? 'hht':'HH', {hour:h}, o);									
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + tmph + '&amp;lt;/td&amp;gt;';
							}
						}
						else{
							for (var m = o[litem+'Min']; m &amp;lt;= max[litem]; m += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + ((m &amp;lt; 10) ? '0' : '') + m + '&amp;lt;/td&amp;gt;';
							}
						}

						html += '&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;&amp;lt;/div&amp;gt;';
					}
					html += '&amp;lt;/dd&amp;gt;';
				}
				
				// Timezone
				var showTz = o.showTimezone !== null? o.showTimezone : this.support.timezone;
				html += '&amp;lt;dt class="ui_tpicker_timezone_label"' + (showTz ? '' : noDisplay) + '&amp;gt;' + o.timezoneText + '&amp;lt;/dt&amp;gt;';
				html += '&amp;lt;dd class="ui_tpicker_timezone" ' + (showTz ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the elements from string
				html += '&amp;lt;/dl&amp;gt;&amp;lt;/div&amp;gt;';
				var $tp = $(html);

				// if we only want time picker...
				if (o.timeOnly === true) {
					$tp.prepend('&amp;lt;div class="ui-widget-header ui-helper-clearfix ui-corner-all"&amp;gt;' + '&amp;lt;div class="ui-datepicker-title"&amp;gt;' + o.timeOnlyTitle + '&amp;lt;/div&amp;gt;' + '&amp;lt;/div&amp;gt;');
					$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();
				}
				
				// add sliders, adjust grids, add events
				for(i=0,l=tp_inst.units.length; i&amp;lt;l; i++){
					litem = tp_inst.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// add the slider
					tp_inst[litem+'_slider'] = tp_inst.control.create(tp_inst, $tp.find('.ui_tpicker_'+litem+'_slider'), litem, tp_inst[litem], o[litem+'Min'], max[litem], o['step'+uitem]);

					// adjust the grid and add click event
					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						size = 100 * gridSize[litem] * o[litem+'Grid'] / (max[litem] - o[litem+'Min']);
						$tp.find('.ui_tpicker_'+litem+' table').css({
							width: size + "%",
							marginLeft: o.isRTL? '0' : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL? ((size / (-2 * gridSize[litem])) + "%") : '0',
							borderCollapse: 'collapse'
						}).find("td").click(function(e){
								var $t = $(this),
									h = $t.html(),
									n = parseInt(h.replace(/[^0-9]/g),10),
									ap = h.replace(/[^apm]/ig),
									f = $t.data('for'); // loses scope, so we use data-for

								if(f == 'hour'){
									if(ap.indexOf('p') !== -1 &amp;amp;&amp;amp; n &amp;lt; 12){
										n += 12;
									}
									else{
										if(ap.indexOf('a') !== -1 &amp;amp;&amp;amp; n === 12){
											n = 0;
										}
									}
								}
								
								tp_inst.control.value(tp_inst, tp_inst[f+'_slider'], litem, n);

								tp_inst._onTimeChange();
								tp_inst._onSelectHandler();
							}).css({
								cursor: 'pointer',
								width: (100 / gridSize[litem]) + '%',
								textAlign: 'center',
								overflow: 'hidden'
							});
					} // end if grid &amp;gt; 0
				} // end for loop

				// Add timezone options
				this.timezone_select = $tp.find('.ui_tpicker_timezone').append('&amp;lt;select&amp;gt;&amp;lt;/select&amp;gt;').find("select");
				$.fn.append.apply(this.timezone_select,
				$.map(o.timezoneList, function(val, idx) {
					return $("&amp;lt;option /&amp;gt;").val(typeof val == "object" ? val.value : val).text(typeof val == "object" ? val.label : val);
				}));
				if (typeof(this.timezone) != "undefined" &amp;amp;&amp;amp; this.timezone !== null &amp;amp;&amp;amp; this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset()*-1;
					if (local_timezone == this.timezone) {
						selectLocalTimezone(tp_inst);
					} else {
						this.timezone_select.val(this.timezone);
					}
				} else {
					if (typeof(this.hour) != "undefined" &amp;amp;&amp;amp; this.hour !== null &amp;amp;&amp;amp; this.hour !== "") {
						this.timezone_select.val(o.timezone);
					} else {
						selectLocalTimezone(tp_inst);
					}
				}
				this.timezone_select.change(function() {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
				});
				// End timezone options
				
				// inject timepicker into datepicker
				var $buttonPanel = $dp.find('.ui-datepicker-buttonpane');
				if ($buttonPanel.length) {
					$buttonPanel.before($tp);
				} else {
					$dp.append($tp);
				}

				this.$timeObj = $tp.find('.ui_tpicker_time');

				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined;
				}

				// slideAccess integration: http://trentrichardson.com/2011/11/11/jquery-ui-sliders-and-touch-accessibility/
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
						
					setTimeout(function() { // fix for inline mode
						if ($tp.find('.ui-slider-access').length === 0) {
							$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);

							// fix any grids since sliders are shorter
							var sliderAccessWidth = $tp.find('.ui-slider-access:eq(0)').outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find('table:visible').each(function() {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl? 'marginRight':'marginLeft').toString().replace('%', ''),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + '%',
										css = { width: newWidth, marginRight: 0, marginLeft: 0 };
									css[rtl? 'marginRight':'marginLeft'] = newMarginLeft;
									$g.css(css);
								});
							}
						}
					}, 10);
				}
				// end slideAccess integration

				tp_inst._limitMinMaxDateTime(this.inst, true);
			}
		},

		/*
		* This function tries to limit the ability to go outside the
		* min/max date range
		*/
		_limitMinMaxDateTime: function(dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);

			if (!this._defaults.showTimepicker) {
				return;
			} // No time so nothing to check here

			if ($.datepicker._get(dp_inst, 'minDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'minDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, 'minDateTime'),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin;
				}

				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour &amp;lt;= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute &amp;lt;= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second &amp;lt;= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if(this.millisec &amp;lt;= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;lt; this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin;
									}
									this._defaults.microsecMin = this.microsecMinOriginal;
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal;
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal;
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal;
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal;
				}
			}

			if ($.datepicker._get(dp_inst, 'maxDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'maxDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, 'maxDateTime'),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax;
				}

				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour &amp;gt;= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute &amp;gt;= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second &amp;gt;= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec &amp;gt;= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;gt; this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax;
									}
									this._defaults.microsecMax = this.microsecMaxOriginal;
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal;
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal;
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal;
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal;
				}
			}

			if (adjustSliders !== undefined &amp;amp;&amp;amp; adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10);
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);

				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, 'hour', { min: this._defaults.hourMin, max: hourMax });
					this.control.value(this, this.hour_slider, 'hour', this.hour - (this.hour % this._defaults.stepHour));
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, 'minute', { min: this._defaults.minuteMin, max: minMax });
					this.control.value(this, this.minute_slider, 'minute', this.minute - (this.minute % this._defaults.stepMinute));
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, 'second', { min: this._defaults.secondMin, max: secMax });
					this.control.value(this, this.second_slider, 'second', this.second - (this.second % this._defaults.stepSecond));
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, 'millisec', { min: this._defaults.millisecMin, max: millisecMax });
					this.control.value(this, this.millisec_slider, 'millisec', this.millisec - (this.millisec % this._defaults.stepMillisec));
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, 'microsec', { min: this._defaults.microsecMin, max: microsecMax });
					this.control.value(this, this.microsec_slider, 'microsec', this.microsec - (this.microsec % this._defaults.stepMicrosec));
				}
			}

		},

		/*
		* when a slider moves, set the internal time...
		* on time change is also called when the time is updated in the text field
		*/
		_onTimeChange: function() {
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, 'hour') : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, 'minute') : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, 'second') : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, 'millisec') : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, 'microsec') : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;

			if (typeof(hour) == 'object') {
				hour = false;
			}
			if (typeof(minute) == 'object') {
				minute = false;
			}
			if (typeof(second) == 'object') {
				second = false;
			}
			if (typeof(millisec) == 'object') {
				millisec = false;
			}
			if (typeof(microsec) == 'object') {
				microsec = false;
			}
			if (typeof(timezone) == 'object') {
				timezone = false;
			}

			if (hour !== false) {
				hour = parseInt(hour, 10);
			}
			if (minute !== false) {
				minute = parseInt(minute, 10);
			}
			if (second !== false) {
				second = parseInt(second, 10);
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10);
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10);
			}

			var ampm = o[hour &amp;lt; 12 ? 'amNames' : 'pmNames'][0];

			// If the update was done in the input field, the input field should not be updated.
			// If the update was done using the sliders, update the input field.
			var hasChanged = (hour != this.hour || minute != this.minute || second != this.second || millisec != this.millisec || microsec != this.microsec 
								|| (this.ampm.length &amp;gt; 0 &amp;amp;&amp;amp; (hour &amp;lt; 12) != ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) 
								|| (this.timezone !== null &amp;amp;&amp;amp; timezone != this.timezone));

			if (hasChanged) {

				if (hour !== false) {
					this.hour = hour;
				}
				if (minute !== false) {
					this.minute = minute;
				}
				if (second !== false) {
					this.second = second;
				}
				if (millisec !== false) {
					this.millisec = millisec;
				}
				if (microsec !== false) {
					this.microsec = microsec;
				}
				if (timezone !== false) {
					this.timezone = timezone;
				}

				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0]);
				}

				this._limitMinMaxDateTime(this.inst, true);
			}
			if (this.support.ampm) {
				this.ampm = ampm;
			}

			// Updates the time within the timepicker
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if(pickerTimeFormat === o.timeFormat){
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix);
				}
				else{
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix);
				}
			}

			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime();
			}
		},

		/*
		* call custom onSelect.
		* bind to sliders slidestop, and grid click.
		*/
		_onSelectHandler: function() {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect &amp;amp;&amp;amp; inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this]);
			}
		},

		/*
		* update our input with the new date time..
		*/
		_updateDateTime: function(dp_inst) {
			dp_inst = this.inst || dp_inst;
			//var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
			var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay)),
				dateFmt = $.datepicker._get(dp_inst, 'dateFormat'),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null &amp;amp;&amp;amp; this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			
			// if a slider was changed but datepicker doesn't have a value yet, set it
			if(dp_inst.lastVal===""){
                dp_inst.currentYear=dp_inst.selectedYear;
                dp_inst.currentMonth=dp_inst.selectedMonth;
                dp_inst.currentDay=dp_inst.selectedDay;
            }

			/*
			* remove following lines to force every changes in date picker to change the input value
			* Bug descriptions: when an input field has a default value, and click on the field to pop up the date picker. 
			* If the user manually empty the value in the input field, the date picker will never change selected value.
			*/
			//if (dp_inst.lastVal !== undefined &amp;amp;&amp;amp; (dp_inst.lastVal.length &amp;gt; 0 &amp;amp;&amp;amp; this.$input.val().length === 0)) {
			//	return;
			//}

			if (this._defaults.timeOnly === true) {
				formattedDateTime = this.formattedTime;
			} else if (this._defaults.timeOnly !== true &amp;amp;&amp;amp; (this._defaults.alwaysSetTime || timeAvailable)) {
				formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix;
			}

			this.formattedDateTime = formattedDateTime;

			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate);
			} else if (this.$altInput &amp;amp;&amp;amp; this._defaults.timeOnly === false &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly === true) {
				this.$altInput.val(this.formattedTime);
				this.$input.val(this.formattedDate);
			} else if (this.$altInput) {
				this.$input.val(formattedDateTime);
				var altFormattedDateTime = '',
					altSeparator = this._defaults.altSeparator ? this._defaults.altSeparator : this._defaults.separator,
					altTimeSuffix = this._defaults.altTimeSuffix ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
				
				if(!this._defaults.timeOnly){
					if (this._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg);
					}
					else{
						altFormattedDateTime = this.formattedDate;
					}

					if (altFormattedDateTime){
						altFormattedDateTime += altSeparator;
					}
				}

				if(this._defaults.altTimeFormat){
					altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix;
				}
				else{
					altFormattedDateTime += this.formattedTime + altTimeSuffix;
				}
				this.$altInput.val(altFormattedDateTime);
			} else {
				this.$input.val(formattedDateTime);
			}

			this.$input.trigger("change");
		},

		_onFocus: function() {
			if (!this.$input.val() &amp;amp;&amp;amp; this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, 'timepicker');
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst);
						} catch (err) {
							$.timepicker.log(err);
						}
					}
				}
			}
		},

		/*
		* Small abstraction to control types
		* We can add more, just be sure to follow the pattern: create, options, value
		*/
		_controls: {
			// slider methods
			slider: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var rtl = tp_inst._defaults.isRTL; // if rtl go -60-&amp;gt;0 instead of 0-&amp;gt;60
					return obj.prop('slide', null).slider({
						orientation: "horizontal",
						value: rtl? val*-1 : val,
						min: rtl? max*-1 : min,
						max: rtl? min*-1 : max,
						step: step,
						slide: function(event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl? ui.value*-1:ui.value);
							tp_inst._onTimeChange();
						},
						stop: function(event, ui) {
							tp_inst._onSelectHandler();
						}
					});	
				},
				options: function(tp_inst, obj, unit, opts, val){
					if(tp_inst._defaults.isRTL){
						if(typeof(opts) == 'string'){
							if(opts == 'min' || opts == 'max'){
								if(val !== undefined){
									return obj.slider(opts, val*-1);
								}
								return Math.abs(obj.slider(opts));
							}
							return obj.slider(opts);
						}
						var min = opts.min, 
							max = opts.max;
						opts.min = opts.max = null;
						if(min !== undefined){
							opts.max = min * -1;
						}
						if(max !== undefined){
							opts.min = max * -1;
						}
						return obj.slider(opts);
					}
					if(typeof(opts) == 'string' &amp;amp;&amp;amp; val !== undefined){
							return obj.slider(opts, val);
					}
					return obj.slider(opts);
				},
				value: function(tp_inst, obj, unit, val){
					if(tp_inst._defaults.isRTL){
						if(val !== undefined){
							return obj.slider('value', val*-1);
						}
						return Math.abs(obj.slider('value'));
					}
					if(val !== undefined){
						return obj.slider('value', val);
					}
					return obj.slider('value');
				}
			},
			// select methods
			select: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var sel = '&amp;lt;select class="ui-timepicker-select" data-unit="'+ unit +'" data-min="'+ min +'" data-max="'+ max +'" data-step="'+ step +'"&amp;gt;',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;

					for(var i=min; i&amp;lt;=max; i+=step){						
						sel += '&amp;lt;option value="'+ i +'"'+ (i==val? ' selected':'') +'&amp;gt;';
						if(unit == 'hour'){
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig,'')), {hour:i}, tp_inst._defaults);
						}
						else if(unit == 'millisec' || unit == 'microsec' || i &amp;gt;= 10){ sel += i; }
						else {sel += '0'+ i.toString(); }
						sel += '&amp;lt;/option&amp;gt;';
					}
					sel += '&amp;lt;/select&amp;gt;';

					obj.children('select').remove();

					$(sel).appendTo(obj).change(function(e){
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
					});

					return obj;
				},
				options: function(tp_inst, obj, unit, opts, val){
					var o = {},
						$t = obj.children('select');
					if(typeof(opts) == 'string'){
						if(val === undefined){
							return $t.data(opts);
						}
						o[opts] = val;	
					}
					else{ o = opts; }
					return tp_inst.control.create(tp_inst, obj, $t.data('unit'), $t.val(), o.min || $t.data('min'), o.max || $t.data('max'), o.step || $t.data('step'));
				},
				value: function(tp_inst, obj, unit, val){
					var $t = obj.children('select');
					if(val !== undefined){
						return $t.val(val);
					}
					return $t.val();
				}
			}
		} // end _controls

	});

	$.fn.extend({
		/*
		* shorthand just to use timepicker..
		*/
		timepicker: function(o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);

			if (typeof o == 'object') {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				});
			}

			return $(this).each(function() {
				$.fn.datetimepicker.apply($(this), tmp_args);
			});
		},

		/*
		* extend timepicker to datepicker
		*/
		datetimepicker: function(o) {
			o = o || {};
			var tmp_args = arguments;

			if (typeof(o) == 'string') {
				if (o == 'getDate') {
					return $.fn.datepicker.apply($(this[0]), tmp_args);
				} else {
					return this.each(function() {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args);
					});
				}
			} else {
				return this.each(function() {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults);
				});
			}
		}
	});

	/*
	* Public Utility to parse date and time
	*/
	$.datepicker.parseDateTime = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec);
		}

		return parseRes.date;
	};

	/*
	* Public utility to parse time
	*/
	$.datepicker.parseTime = function(timeFormat, timeString, options) {		
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g,'').indexOf('Z') !== -1);

		// Strict parse requires the timeString to match the timeFormat exactly
		var strictParse = function(f, s, o){

			// pattern for standard and localized AM/PM markers
			var getPatternAmpm = function(amNames, pmNames) {
				var markers = [];
				if (amNames) {
					$.merge(markers, amNames);
				}
				if (pmNames) {
					$.merge(markers, pmNames);
				}
				markers = $.map(markers, function(val) {
					return val.replace(/[.*+?|()\[\]{}\\]/g, '\\$&amp;amp;');
				});
				return '(' + markers.join('|') + ')?';
			};

			// figure out position of time elements.. cause js cant do named captures
			var getFormatPositions = function(timeFormat) {
				var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
					orders = {
						h: -1,
						m: -1,
						s: -1,
						l: -1,
						c: -1,
						t: -1,
						z: -1
					};

				if (finds) {
					for (var i = 0; i &amp;lt; finds.length; i++) {
						if (orders[finds[i].toString().charAt(0)] == -1) {
							orders[finds[i].toString().charAt(0)] = i + 1;
						}
					}
				}
				return orders;
			};

			var regstr = '^' + f.toString()
					.replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
							var ml = match.length;
							switch (match.charAt(0).toLowerCase()) {
								case 'h': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'm': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 's': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'l': return '(\\d?\\d?\\d)';
								case 'c': return '(\\d?\\d?\\d)';
								case 'z': return '(z|[-+]\\d\\d:?\\d\\d|\\S+)?';
								case 't': return getPatternAmpm(o.amNames, o.pmNames);
								default:    // literal escaped in quotes
									return '(' + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function (m) { return "\\" + m; }) + ')?';
							}
						})
					.replace(/\s/g, '\\s?') +
					o.timeSuffix + '$',
				order = getFormatPositions(f),
				ampm = '',
				treg;

			treg = s.match(new RegExp(regstr, 'i'));

			var resTime = {
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0
			};

			if (treg) {
				if (order.t !== -1) {
					if (treg[order.t] === undefined || treg[order.t].length === 0) {
						ampm = '';
						resTime.ampm = '';
					} else {
						ampm = $.inArray(treg[order.t].toUpperCase(), o.amNames) !== -1 ? 'AM' : 'PM';
						resTime.ampm = o[ampm == 'AM' ? 'amNames' : 'pmNames'][0];
					}
				}

				if (order.h !== -1) {
					if (ampm == 'AM' &amp;amp;&amp;amp; treg[order.h] == '12') {
						resTime.hour = 0; // 12am = 0 hour
					} else {
						if (ampm == 'PM' &amp;amp;&amp;amp; treg[order.h] != '12') {
							resTime.hour = parseInt(treg[order.h], 10) + 12; // 12pm = 12 hour, any other pm = hour + 12
						} else {
							resTime.hour = Number(treg[order.h]);
						}
					}
				}

				if (order.m !== -1) {
					resTime.minute = Number(treg[order.m]);
				}
				if (order.s !== -1) {
					resTime.second = Number(treg[order.s]);
				}
				if (order.l !== -1) {
					resTime.millisec = Number(treg[order.l]);
				}
				if (order.c !== -1) {
					resTime.microsec = Number(treg[order.c]);
				}
				if (order.z !== -1 &amp;amp;&amp;amp; treg[order.z] !== undefined) {
					resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z]);
				}


				return resTime;
			}
			return false;
		};// end strictParse

		// First try JS Date, if that fails, use strictParse
		var looseParse = function(f,s,o){
			try{
				var d = new Date('2012-01-01 '+ s);
				if(isNaN(d.getTime())){
					d = new Date('2012-01-01T'+ s);
					if(isNaN(d.getTime())){
						d = new Date('01/01/2012 '+ s);
						if(isNaN(d.getTime())){
							throw "Unable to parse time with native Date: "+ s;
						}
					}
				}

				return {
					hour: d.getHours(),
					minute: d.getMinutes(),
					second: d.getSeconds(),
					millisec: d.getMilliseconds(),
					microsec: d.getMicroseconds(),
					timezone: d.getTimezoneOffset()*-1
				};
			}
			catch(err){
				try{
					return strictParse(f,s,o);
				}
				catch(err2){
					$.timepicker.log("Unable to parse \ntimeString: "+ s +"\ntimeFormat: "+ f);
				}				
			}
			return false;
		}; // end looseParse
		
		if(typeof o.parse === "function"){
			return o.parse(timeFormat, timeString, o);
		}
		if(o.parse === 'loose'){
			return looseParse(timeFormat, timeString, o);
		}
		return strictParse(timeFormat, timeString, o);
	};

	/*
	* Public utility to format the time
	* format = string format of the time
	* time = a {}, not a Date() for timezones
	* options = essentially the regional[].. amNames, pmNames, ampm
	*/
	$.datepicker.formatTime = function(format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			timezone: 0
		}, time);

		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);

		if (hour &amp;gt; 11) {
			ampmName = options.pmNames[0];
		}

		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|('.*?'|".*?"))/g, function(match) {
		switch (match) {
			case 'HH':
				return ('0' + hour).slice(-2);
			case 'H':
				return hour;
			case 'hh':
				return ('0' + convert24to12(hour)).slice(-2);
			case 'h':
				return convert24to12(hour);
			case 'mm':
				return ('0' + time.minute).slice(-2);
			case 'm':
				return time.minute;
			case 'ss':
				return ('0' + time.second).slice(-2);
			case 's':
				return time.second;
			case 'l':
				return ('00' + time.millisec).slice(-3);
			case 'c':
				return ('00' + time.microsec).slice(-3);
			case 'z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, false);
			case 'Z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, true);
			case 'T': 
				return ampmName.charAt(0).toUpperCase();
			case 'TT': 
				return ampmName.toUpperCase();
			case 't':
				return ampmName.charAt(0).toLowerCase();
			case 'tt':
				return ampmName.toLowerCase();
			default:
				return match.replace(/\'/g, "") || "'";
			}
		});

		tmptime = $.trim(tmptime);
		return tmptime;
	};

	/*
	* the bad hack :/ override datepicker so it doesnt close on select
	// inspired: http://stackoverflow.com/questions/1252512/jquery-datepicker-prevent-closing-picker-when-clicking-a-date/1762378#1762378
	*/
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function(id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			tp_inst._limitMinMaxDateTime(inst, true);
			inst.inline = inst.stay_open = true;
			//This way the onSelect handler called from calendarpicker get the full dateTime
			this._base_selectDate(id, dateStr);
			inst.inline = inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst);
		} else {
			this._base_selectDate(id, dateStr);
		}
	};

	/*
	* second bad hack :/ override datepicker so it triggers an event when changing the input field
	* and does not redraw the datepicker on every selectDate event
	*/
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function(inst) {

		// don't popup the datepicker if there is another instance already opened
		var input = inst.input[0];
		if ($.datepicker._curInst &amp;amp;&amp;amp; $.datepicker._curInst != inst &amp;amp;&amp;amp; $.datepicker._datepickerShowing &amp;amp;&amp;amp; $.datepicker._lastInput != input) {
			return;
		}

		if (typeof(inst.stay_open) !== 'boolean' || inst.stay_open === false) {

			this._base_updateDatepicker(inst);

			// Reload the time control when changing something in the input text field.
			var tp_inst = this._get(inst, 'timepicker');
			if (tp_inst) {
				tp_inst._addTimePicker(inst);
			}
		}
	};

	/*
	* third bad hack :/ override datepicker so it allows spaces and colon in the input field
	*/
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if ($.datepicker._get(inst, 'constrainInput')) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null? tp_inst._defaults.showTimezone : tp_inst.support.timezone,					
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat')),
					datetimeChars = tp_inst._defaults.timeFormat.toString()
											.replace(/[hms]/g, '')
											.replace(/TT/g, ampm ? 'APM' : '')
											.replace(/Tt/g, ampm ? 'AaPpMm' : '')
											.replace(/tT/g, ampm ? 'AaPpMm' : '')
											.replace(/T/g, ampm ? 'AP' : '')
											.replace(/tt/g, ampm ? 'apm' : '')
											.replace(/t/g, ampm ? 'ap' : '') + 
											" " + tp_inst._defaults.separator + 
											tp_inst._defaults.timeSuffix + 
											(tz ? tp_inst._defaults.timezoneList.join('') : '') + 
											(tp_inst._defaults.amNames.join('')) + (tp_inst._defaults.pmNames.join('')) + 
											dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr &amp;lt; ' ' || !dateChars || datetimeChars.indexOf(chr) &amp;gt; -1);
			}
		}

		return $.datepicker._base_doKeyPress(event);
	};

	/*
	* Fourth bad hack :/ override _updateAlternate function used in inline mode to init altField
	*/
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	/* Update any alternate field to synchronise with the main field. */
	$.datepicker._updateAlternate = function(inst) {
		var tp_inst = this._get(inst, 'timepicker');
		if(tp_inst){
			var altField = tp_inst._defaults.altField;
			if (altField) { // update alternate field too
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = '', 
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator, 
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if(!tp_inst._defaults.timeOnly &amp;amp;&amp;amp; !tp_inst._defaults.altFieldTimeOnly &amp;amp;&amp;amp; date !== null){
					if(tp_inst._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime;
					}
					else{
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime;
					}
				}
				$(altField).val(altFormattedDateTime);
			}
		}
		else{
			$.datepicker._base_updateAlternate(inst);
		}
	};

	/*
	* Override key up event to sync manual input changes.
	*/
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst);
				} catch (err) {
					$.timepicker.log(err);
				}
			}
		}

		return $.datepicker._base_doKeyUp(event);
	};

	/*
	* override "Today" button to also grab the time.
	*/
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function(id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		this._base_gotoToday(id);
		var tp_inst = this._get(inst, 'timepicker');
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		$('.ui-datepicker-today', $dp).click();
	};

	/*
	* Disable &amp;amp; enable the Time in the datetimepicker
	*/
	$.datepicker._disableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst);
		}
	};

	$.datepicker._enableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst); // Could be disabled on page load
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create our own set time function
	*/
	$.datepicker._setTime = function(inst, date) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var defaults = tp_inst._defaults;

			// calling _setTime with no date sets time to defaults
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;

			//check if within min/max times.. 
			tp_inst._limitMinMaxDateTime(inst, true);

			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create new public method to set only time, callable as $().datepicker('setTime', date)
	*/
	$.datepicker._setTimeDatepicker = function(target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date == "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec);
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds());
				}
				if (tp_date.toString() == 'Invalid Date') {
					tp_date = undefined;
				}
				this._setTime(inst, tp_date);
			}
		}

	};

	/*
	* override setDate() to allow setting time too within Date object
	*/
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function(target, date) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		if(typeof(date) === 'string'){
			date = new Date(date);
			if(!date.getTime()){
				$.timepicker.log("Error creating Date object from string.");
			}
		}

		var tp_inst = this._get(inst, 'timepicker');
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds());
		} else {
			tp_date = date;
		}
		
		// This is important if you are using the timezone option, javascript's Date 
		// object will only return the timezone offset for the current locale, so we 
		// adjust it accordingly.  If not using timezone option this won't matter..
		// If a timezone is different in tp, keep the timezone as is
		if(tp_inst){
			// look out for DST if tz wasn't specified
			if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
				tp_inst.timezone = tp_date.getTimezoneOffset()*-1;
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone);
		}

		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true);
	};

	/*
	* override getDate() to allow getting time too within Date object
	*/
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function(target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			// if it hasn't yet been defined, grab from field
			if(inst.lastVal === undefined){
				this._setDateFromField(inst, noDefault);
			}

			var date = this._getDate(inst);
			if (date &amp;amp;&amp;amp; tp_inst._parseTime($(target).val(), tp_inst.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);

				// This is important if you are using the timezone option, javascript's Date 
				// object will only return the timezone offset for the current locale, so we 
				// adjust it accordingly.  If not using timezone option this won't matter..
				if(tp_inst.timezone != null){
					// look out for DST if tz wasn't specified
					if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
						tp_inst.timezone = date.getTimezoneOffset()*-1;
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
				}
			}
			return date;
		}
		return this._base_getDateDatepicker(target, noDefault);
	};

	/*
	* override parseDate() because UI 1.8.14 throws an error about "Extra characters"
	* An option in datapicker to ignore extra format characters would be nicer.
	*/
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function(format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings);
		} catch (err) {
			// Hack!  The error message ends with a colon, a space, and
			// the "extra" characters.  We rely on that instead of
			// attempting to perfectly reproduce the parsing algorithm.
			if (err.indexOf(":") &amp;gt;= 0) {
				date = this._base_parseDate(format, value.substring(0,value.length-(err.length-err.indexOf(':')-2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format);
			} else {
				throw err;
			}
		}
		return date;
	};

	/*
	* override formatDate to set date with time to the input
	*/
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function(inst, day, month, year) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val();
		}
		return this._base_formatDate(inst);
	};

	/*
	* override options setter to add time to maxDate(Time) and minDate(Time). MaxDate
	*/
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function(target, name, value) {
		var inst = this._getInst(target),
	        name_clone;
		if (!inst) {
			return null;
		}

		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop;
		    if (typeof name == 'string') { // if min/max was set with the string
		        if (name === 'minDate' || name === 'minDateTime') {
		            min = value;
		        } else if (name === 'maxDate' || name === 'maxDateTime') {
		            max = value;
		        } else if (name === 'onSelect') {
		            onselect = value;
		        } else if (overrides.hasOwnProperty(name)) {
		            if (typeof (value) === 'undefined') {
		                return overrides[name];
		            }
		            fns[name] = value;
		            name_clone = {}; //empty results in exiting function after overrides updated
		        }
		    } else if (typeof name == 'object') { //if min/max was set with the JSON
		        if (name.minDate) {
		            min = name.minDate;
		        } else if (name.minDateTime) {
		            min = name.minDateTime;
		        } else if (name.maxDate) {
		            max = name.maxDate;
		        } else if (name.maxDateTime) {
		            max = name.maxDateTime;
		        }
		        for (prop in overrides) {
		            if (overrides.hasOwnProperty(prop) &amp;amp;&amp;amp; name[prop]) {
		                fns[prop] = name[prop];
		            }
		        }
		    }
		    for (prop in fns) {
		        if (fns.hasOwnProperty(prop)) {
		            overrides[prop] = fns[prop];
		            if (!name_clone) { name_clone = $.extend({}, name);}
		            delete name_clone[prop];
		        }
		    }
		    if (name_clone &amp;amp;&amp;amp; isEmptyObject(name_clone)) { return; }
		    if (min) { //if min was set
		        if (min === 0) {
		            min = new Date();
		        } else {
		            min = new Date(min);
		        }
		        tp_inst._defaults.minDate = min;
		        tp_inst._defaults.minDateTime = min;
		    } else if (max) { //if max was set
		        if (max === 0) {
		            max = new Date();
		        } else {
		            max = new Date(max);
		        }
		        tp_inst._defaults.maxDate = max;
		        tp_inst._defaults.maxDateTime = max;
		    } else if (onselect) {
		        tp_inst._defaults.onSelect = onselect;
		    }
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name);
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
	};
	
	/*
	* jQuery isEmptyObject does not check hasOwnProperty - if someone has added to the object prototype,
	* it will return false for all objects
	*/
	var isEmptyObject = function(obj) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(obj)) {
				return false;
			}
		}
		return true;
	};

	/*
	* jQuery extend now ignores nulls!
	*/
	var extendRemove = function(target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] === null || props[name] === undefined) {
				target[name] = props[name];
			}
		}
		return target;
	};

	/*
	* Determine by the time format which units are supported
	* Returns an object of booleans for each unit
	*/
	var detectSupport = function(timeFormat){
		var tf = timeFormat.replace(/\'.*?\'/g,'').toLowerCase(), // removes literals
			isIn = function(f, t){ // does the format contain the token?
					return f.indexOf(t) !== -1? true:false; 
				};
		return {
				hour: isIn(tf,'h'),
				minute: isIn(tf,'m'),
				second: isIn(tf,'s'),
				millisec: isIn(tf,'l'),
				microsec: isIn(tf,'c'),
				timezone: isIn(tf,'z'),
				ampm: isIn(tf,'t') &amp;amp;&amp;amp; isIn(timeFormat,'h'),
				iso8601: isIn(timeFormat, 'Z')
			};
	};

	/*
	* Converts 24 hour format into 12 hour
	* Returns 12 hour without leading 0
	*/
	var convert24to12 = function(hour) {
		if (hour &amp;gt; 12) {
			hour = hour - 12;
		}

		if (hour === 0) {
			hour = 12;
		}

		return String(hour);
	};

	/*
	* Splits datetime string into date ans time substrings.
	* Throws exception when date can't be parsed
	* Returns [dateString, timeString]
	*/
	var splitDateTime = function(dateFormat, dateTimeString, dateSettings, timeSettings) {
		try {
			// The idea is to get the number separator occurances in datetime and the time format requested (since time has 
			// fewer unknowns, mostly numbers and am/pm). We will use the time pattern to split.
			var separator = timeSettings &amp;amp;&amp;amp; timeSettings.separator ? timeSettings.separator : $.timepicker._defaults.separator,
				format = timeSettings &amp;amp;&amp;amp; timeSettings.timeFormat ? timeSettings.timeFormat : $.timepicker._defaults.timeFormat,
				timeParts = format.split(separator), // how many occurances of separator may be in our format?
				timePartsLen = timeParts.length,
				allParts = dateTimeString.split(separator),
				allPartsLen = allParts.length;

			if (allPartsLen &amp;gt; 1) {
				return [
						allParts.splice(0,allPartsLen-timePartsLen).join(separator),
						allParts.splice(0,timePartsLen).join(separator)
					];
			}

		} catch (err) {
			$.timepicker.log('Could not split the date from the time. Please check the following datetimepicker options' +
					"\nthrown error: " + err +
					"\ndateTimeString" + dateTimeString +
					"\ndateFormat = " + dateFormat +
					"\nseparator = " + timeSettings.separator +
					"\ntimeFormat = " + timeSettings.timeFormat);

			if (err.indexOf(":") &amp;gt;= 0) {
				// Hack!  The error message ends with a colon, a space, and
				// the "extra" characters.  We rely on that instead of
				// attempting to perfectly reproduce the parsing algorithm.
				var dateStringLength = dateTimeString.length - (err.length - err.indexOf(':') - 2),
					timeString = dateTimeString.substring(dateStringLength);

				return [$.trim(dateTimeString.substring(0, dateStringLength)), $.trim(dateTimeString.substring(dateStringLength))];

			} else {
				throw err;
			}
		}
		return [dateTimeString, ''];
	};

	/*
	* Internal function to parse datetime interval
	* Returns: {date: Date, timeObj: Object}, where
	*   date - parsed date without time (type Date)
	*   timeObj = {hour: , minute: , second: , millisec: , microsec: } - parsed time. Optional
	*/
	var parseDateTimeInternal = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var date;
		var splitRes = splitDateTime(dateFormat, dateTimeString, dateSettings, timeSettings);
		date = $.datepicker._base_parseDate(dateFormat, splitRes[0], dateSettings);
		if (splitRes[1] !== '') {
			var timeString = splitRes[1],
				parsedTime = $.datepicker.parseTime(timeFormat, timeString, timeSettings);

			if (parsedTime === null) {
				throw 'Wrong time format';
			}
			return {
				date: date,
				timeObj: parsedTime
			};
		} else {
			return {
				date: date
			};
		}
	};

	/*
	* Internal function to set timezone_select to the local timezone
	*/
	var selectLocalTimezone = function(tp_inst, date) {
		if (tp_inst &amp;amp;&amp;amp; tp_inst.timezone_select) {
			var now = typeof date !== 'undefined' ? date : new Date();
			tp_inst.timezone_select.val(now.getTimezoneOffset()*-1);
		}
	};

	/*
	* Create a Singleton Insance
	*/
	$.timepicker = new Timepicker();

	/**
	 * Get the timezone offset as string from a date object (eg '+0530' for UTC+5.5)
	 * @@param  number if not a number this value is returned
	 * @@param boolean if true formats in accordance to iso8601 "+12:45"
	 * @@return string
	 */
	$.timepicker.timezoneOffsetString = function(tzMinutes, iso8601) {
		if(isNaN(tzMinutes) || tzMinutes &amp;gt; 840){
			return tzMinutes;
		}

		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601? ':':'',
			tz = (off &amp;gt;= 0 ? '+' : '-') + ('0' + (hours * 101).toString()).slice(-2) + iso + ('0' + (minutes * 101).toString()).slice(-2);
		
		if(tz == '+00:00'){
			return 'Z';
		}
		return tz;
	};

	/**
	 * Get the number in minutes that represents a timezone string
	 * @@param  string formated like "+0500", "-1245"
	 * @@return number
	 */
	$.timepicker.timezoneOffsetNumber = function(tzString) {
		tzString = tzString.toString().replace(':',''); // excuse any iso8601, end up with "+1245"

		if(tzString.toUpperCase() === 'Z'){ // if iso8601 with Z, its 0 minute offset
			return 0;
		}

		if(!/^(\-|\+)\d{4}$/.test(tzString)){ // possibly a user defined tz, so just give it back
			return tzString;
		}

		return ((tzString.substr(0,1) =='-'? -1 : 1) * // plus or minus
					((parseInt(tzString.substr(1,2),10)*60) + // hours (converted to minutes)
					parseInt(tzString.substr(3,2),10))); // minutes
	};

	/**
	 * No way to set timezone in js Date, so we must adjust the minutes to compensate. (think setDate, getDate)
	 * @@param  date
	 * @@param  string formated like "+0500", "-1245"
	 * @@return date
	 */
	$.timepicker.timezoneAdjust = function(date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if(!isNaN(toTz)){
			date.setMinutes(date.getMinutes()*1 + (date.getTimezoneOffset()*-1 - toTz*1) );
		}
		return date;
	};

	/**
	 * Calls `timepicker()` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * n.b. The input value must be correctly formatted (reformatting is not supported)
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the timepicker() call
	 * @@return jQuery
	 */
	$.timepicker.timeRange = function(startTime, endTime, options) {
		return $.timepicker.handleRange('timepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datetimepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@return jQuery
	 */
	$.timepicker.datetimeRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datetimepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.dateRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.handleRange = function(method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0, // min allowed interval in milliseconds
			maxInterval: 0, // max allowed interval in milliseconds
			start: {},      // options for start picker
			end: {}         // options for end picker
		}, options);

		$.fn[method].call(startTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), endTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), endTime, 'minDate');
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), startTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), startTime, 'maxDate');
			}
		}, options, options.end));

		checkDates(startTime, endTime);
		selected(startTime, endTime, 'minDate');
		selected(endTime, startTime, 'maxDate');

		function checkDates(changed, other) {
			var startdt = startTime[method]('getDate'),
				enddt = endTime[method]('getDate'),
				changeddt = changed[method]('getDate');

			if(startdt !== null){
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());

				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);

				if(options.minInterval &amp;gt; 0 &amp;amp;&amp;amp; minDate &amp;gt; enddt){ // minInterval check
					endTime[method]('setDate',minDate);
				}
				else if(options.maxInterval &amp;gt; 0 &amp;amp;&amp;amp; maxDate &amp;lt; enddt){ // max interval check
					endTime[method]('setDate',maxDate);
				}
				else if (startdt &amp;gt; enddt) {
					other[method]('setDate',changeddt);
				}
			}
		}

		function selected(changed, other, option) {
			if (!changed.val()) {
				return;
			}
			var date = changed[method].call(changed, 'getDate');
			if(date !== null &amp;amp;&amp;amp; options.minInterval &amp;gt; 0){
				if(option == 'minDate'){
					date.setMilliseconds(date.getMilliseconds() + options.minInterval); 
				}
				if(option == 'maxDate'){
					date.setMilliseconds(date.getMilliseconds() - options.minInterval);
				}
			}
			if (date.getTime) {
				other[method].call(other, 'option', option, date);
			}
		}
		return $([startTime.get(0), endTime.get(0)]);
	};

	/**
	 * Log error or data to the console during error or debugging
	 * @@param  Object err pass any type object to log to the console during error or debugging
	 * @@return void
	 */
	$.timepicker.log = function(err){
		if(window.console){
			console.log(err);
		}
	};

	/*
	* Microsecond support
	*/
	if(!Date.prototype.getMicroseconds){
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function(){ return this.microseconds; };
		Date.prototype.setMicroseconds = function(m){ 
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m/1000));
			this.microseconds = m%1000;
			return this;
		};
	}

	/*
	* Keep up with the version
	*/
	$.timepicker.version = "1.3.1";

})(jQuery);
jQuery.noConflict();
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;datetimepicker-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;e73a652e-09fc-4c71-8e7a-e2525a2d2a99&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
function replaceAllString(oriStr, strTarget, strSubString ){
   var strText = oriStr;
   var intIndexOfMatch = strText.indexOf( strTarget );
   while (intIndexOfMatch != -1){
      strText = strText.replace( strTarget, strSubString )
      intIndexOfMatch = strText.indexOf( strTarget );
   }
   return( strText );
}
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&amp;amp;]" + name + "=([^&amp;amp;#]*)"),
    results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
};


   var jobName= getParameterByName('job')
   var fromDate= getParameterByName('fromDate')
   var toDate= getParameterByName('toDate')
   var limit= getParameterByName('limit')
   var selectedIstIid = getParameterByName('IstIid')

  $("#jobname").ready(function(){
   $("#jobname").text(jobName)
   var convertedJobName = replaceAllString(jobName, ".", "_")
   $("#IstIid" + convertedJobName).ready(function(){
     $("#IstIid" + convertedJobName).css("display","block")
     $("#select_" + convertedJobName).ready(function(){
        $("#select_" + convertedJobName).val(selectedIstIid)
     });
   });
 });

  $("#fromDate").ready(function(){
   $("#from-date").val(fromDate)
 });

  $("#toDate").ready(function(){
   $("#to-date").val(toDate)
 });

  $("#limit").ready(function(){
   if(limit!=""){
    $("#limit").val(limit)
   }
 });
 // Get data with ajax
 function ajax_getData(jobName,fromDate,toDate,limit ){
       var convertedJobName = replaceAllString(jobName, ".", "_")
       var istIid = $("#select_" + convertedJobName).val()
       window.location="/xwiki/bin/view/WiperDog/WebHome?job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid="+istIid;
 			/*$.ajax({
			 type: "GET",
			 url:"/xwiki/bin/get/Sandbox/DescriptionForJob?outputSyntax=plain&amp;amp;job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid"+selectedIstIid,
			 success : function(result){
				$("#jobname").html(jobName)
				$("#display").text('[[]]' + result)
			 }
		   });*/
 }
	$("#treemenu2 a").click(function(){
		 var limit = 10
		 var fromDate=""
		 var toDate = ""
		 jobName= $(this).text()
                 $("#jobname").html(jobName)
                 var convertedJobName = replaceAllString(jobName, ".", "_")
                 $("#listIstIid &amp;gt; div").css("display","none")
                 $("#IstIid" + convertedJobName).css("display","block")
		 //ajax_getData(jobName,fromDate,toDate,limit )

	});

	$("#from-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
		dateFormat: 'yy-mm-dd',
	});
	$("#to-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
			dateFormat: 'yy-mm-dd',

	});
	 $("#get-data").on("click",function(){
		var fromDate = $("#from-date").val()
		var toDate =  $("#to-date").val()
		 if( toDate!= "" ){
			  if(fromDate != ""){
				  if($("#from-date").datepicker( "getDate" ) &amp;gt; $("#to-date").datepicker( "getDate" )){
				  alert("'From date' cannot start later than 'To date'")
				  return false
				  }
			  }
		 }
		 limit = $("#limit").val()
		 ajax_getData(jobName,fromDate,toDate,limit )
                 
                 /** Get livetable data */
                 alert('job = ' + $("#jobname").val() + ',   istIid  = '+ selectedIstIid)
                 var dataModelUrl = '/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job='+$("#jobname").val()+'&amp;amp;limit='
                     +$("#limit").val()+'&amp;amp;fromDate='
	             +fromDate + '&amp;amp;toDate=' + toDate +   '&amp;amp;pager=pager2&amp;amp;genp=1&amp;amp;istIid='+selectedIstIid
		 var jqxhr = $.getJSON(dataModelUrl, function(data) {
				$("#livetableList").jqGrid(data);
				$("#livetableList").jqGrid('navGrid', "#livetablePager", {
				    edit : false,
				    add : false,
				    del : false
				});
			})
	});
        
jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;process&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;881686cc-1bfc-456e-b8ab-71334c4a45e5&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){

$(function () {
    function drawLineChart(xAxis, series, container, data_detail){
        var dataXAxis = xAxis
        var dataSeries = series
        var detail = data_detail

			$('#containerline' + container).highcharts({

				chart: {
					type:'line'
				},
				title: {
					text: container
				},
				tooltip :{
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				xAxis: dataXAxis ,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				series: dataSeries
			});
		};

		function drawBarChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerbar' + container).highcharts({
				chart: {
					type: 'column'
				},
				title: {
					text: container
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {

					column: {
						pointPadding: 0.2,
						borderWidth: 0
					}
				},
				series: dataSeries
			});
		}

		function drawAreaChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail
			$('#containerarea' + container).highcharts({
				chart: {
					type: 'area'
				},
				title: {
					text: container
				},
				subtitle: {
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					},
					labels: {
						formatter: function() {
							return this.value / 1000;
						}
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {
					area: {
						stacking: 'normal',
						lineColor: '#666666',
						lineWidth: 1,
						marker: {
							lineWidth: 1,
							lineColor: '#666666'
						}
					}
				},
				series: dataSeries
			});
		};

		function drawPieChart(data, container){
			var dataPie = data
			$(document).ready(function () {
				// Build the chart
				$('#container' + container).highcharts({
					chart: {
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: dataPie[0].name
					},
					tooltip: {
						pointFormat: '{series.name}: &amp;lt;b&amp;gt;{point.percentage:.1f}%&amp;lt;/b&amp;gt;'
					},
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							dataLabels: {
								enabled: false
							},
							showInLegend: true
						}
					},
					series: dataPie
				});
			});
		}

		// LINE
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonline_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonline");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Line chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						if(data_all[0][i].series[0].name == null){
							data_all[0][i].series[0].name = lstContainer[0][i]
						}
						drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
					}
				}
			}
		});

		// BAR
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonbar_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonbar");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Bar chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						drawBarChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
					}
				}
			}
		});

		// AREA
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonarea_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonarea");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				// data to display on tooltip
				var data_detail = data_all[0]
				// draw Area Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					drawAreaChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
				}
			}
		});

		// PIE
		$("#piechart").ready(function(){

			var array = $("#jsons&amp;gt;.jsonpie");
			var arrayContainer = $("#jsons&amp;gt;.lstcontainerpie");
			var lstContainer = [];
			var data_all = [];
			for(var i=0;i&amp;lt;array.length;i++){
				data_all[i] = jQuery.parseJSON(array[i].value)
				lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)

			}
			if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
				// data to display on tooltip
				// draw Pie Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					var finalData = []
					finalData[0] = data_all[0][i]
					drawPieChart(finalData, lstContainer[0][i])
				}
			}
		});
	});
	jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;d5873d92-b78b-42fc-9407-46d166204b88&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;/* css for timepicker */
.ui-timepicker-div .ui-widget-header { 
margin-bottom: 8px;
 }

.ui-timepicker-div dl { text-align: left; }
.ui-timepicker-div dl dt { height: 25px; margin-bottom: -25px; }
.ui-timepicker-div dl dd { margin: 0 10px 10px 65px; }
.ui-timepicker-div td { font-size: 90%; }
.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }

.ui-timepicker-rtl{ direction: rtl; }
.ui-timepicker-rtl dl { text-align: right; }
.ui-timepicker-rtl dl dd { margin: 0 65px 10px 10px; }
#ui-datepicker-div{
 position:relative;
 width:auto;
 height:auto
}
&lt;/code&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;datetimepicker -css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;1201fb1a-e9c1-4731-8c74-2ea8c0071959&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;.displayblock {
  border:2px solid;
  -webkit-border-radius:6px;
  background:gray;
  float: left;
  width:100%;
}

.displaypie {
  border:1px solid;
  -webkit-border-radius:6px;
  background:gray;
  width: 48%;
  float: left; 
  height: 300px;
}

.subtype {
  margin-top: 50px;
  font-size: 2em;
  color: red;
}&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;content&gt;{{include document="Lib.DataToDrawChart"/}}
{{include document="Lib.MongoDBConnection"/}}
{{velocity}}
$xwiki.jsx.use('Lib.JQueryUILib')
$xwiki.ssx.use('Lib.MenuGenerator')
$xwiki.jsx.use('Lib.MenuGenerator')
$xwiki.ssx.use('Lib.JQueryUILib')
{{/velocity}}
{{include document="Lib.MenuGenerator"/}}
{{html wiki="true" clean="false"}}
&amp;lt;div id="viewer"&amp;gt;
&amp;lt;table style="text-align:left"  &amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th &amp;gt;Job name&amp;lt;/th&amp;gt;
  &amp;lt;td colspan=3&amp;gt;&amp;lt;div id="jobname"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
{{groovy}}
import org.xwiki.context.*

def ec = services.component.getInstance(Execution.class).getContext()
def mapJobIstIid = ec.getProperty("mapJobIstIid")

println '{{html clean="false" wiki="false"}}'
println '&amp;lt;tr&amp;gt;'
println '&amp;lt;th&amp;gt;IstIid&amp;lt;/th&amp;gt;'
println '&amp;lt;td colspan=3&amp;gt;'
mapJobIstIid.each{jobEntry-&amp;gt;
  def convertedJobKey = jobEntry.key.replaceAll("\\.","_")
  println "&amp;lt;div id='listIstIid'&amp;gt;"
  println "&amp;lt;div id=IstIid${convertedJobKey} style='display:none'&amp;gt;"
  println "&amp;lt;select id=select_${convertedJobKey}&amp;gt;"
  jobEntry.value.each{
     println "&amp;lt;option value=\"$it\"&amp;gt;$it&amp;lt;/option&amp;gt;"
  }
  println "&amp;lt;/select&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
}
println '&amp;lt;/td&amp;gt;'
println '&amp;lt;/tr&amp;gt;'
println '{{/html}}'
{{/groovy}}
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data monitor from&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="from-date" id="from-date"/&amp;gt;&amp;lt;/td&amp;gt;
  &amp;lt;th&amp;gt;Data monitor to&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="to-date" id="to-date"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data records limit &amp;lt;/th&amp;gt;
  &amp;lt;td &amp;gt;
     &amp;lt;select id="limit"&amp;gt;
       &amp;lt;option value=5&amp;gt;5&amp;lt;/option&amp;gt;
       &amp;lt;option value=10&amp;gt;10&amp;lt;/option&amp;gt;
       &amp;lt;option value=15&amp;gt;15&amp;lt;/option&amp;gt;
       &amp;lt;option value=20&amp;gt;20&amp;lt;/option&amp;gt;
     &amp;lt;/select&amp;gt;
  &amp;lt;/td&amp;gt;
  &amp;lt;td colspan=3 &amp;gt;&amp;lt;input type="button" value="View Data" id="get-data" class="button"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt; 
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;&amp;lt;div id="display"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
&amp;lt;/table&amp;gt;

&amp;lt;/div&amp;gt; 
 &amp;lt;table style="text-align:left"  &amp;gt;
	&amp;lt;tr&amp;gt;
		&amp;lt;td&amp;gt;
 			Begin livetable
 		&amp;lt;/td&amp;gt;
 		&amp;lt;td&amp;gt;
 			&amp;lt;table id="livetableList"&amp;gt;&amp;lt;/table&amp;gt;
 			&amp;lt;div id="livetablePager"&amp;gt;Begin livetable&amp;lt;/div&amp;gt;
 		&amp;lt;/td&amp;gt; 	
 	&amp;lt;/tr&amp;gt;
 &amp;lt;/table&amp;gt;
 &amp;lt;/body&amp;gt;
{{/html}}
{{groovy}}
import groovy.json.*
xwiki.jsx.use("Lib.Highcharts")

if(request.xpage == "plain") {
	response.setContentType('text/plain')
}

def listData = []
def job = request.get("job")
def fromDate = request.get("fromDate")
def toDate = request.get("toDate")
def limit= (request.get("limit")!=null)?request.get("limit").toInteger():10
def istIid = request.get("IstIid")

def str= "No data to retrieved !"
def result = null
if(job != "" &amp;amp;&amp;amp; job != null &amp;amp;&amp;amp; istIid != null &amp;amp;&amp;amp; istIid != ""){
	MongoDBConnection.getConnection()
	if(fromDate != "" || toDate != ""){
		result = MongoDBConnection.getDataInPeriod(job,fromDate,toDate,limit,istIid)
	} else {
		result = MongoDBConnection.getDataAllFields(job,limit,istIid)
        }
MongoDBConnection.closeConnection()
} else {
   println "{{warning}}There are no selected job or IstIid{{/warning}}"
}

if( (result != null) &amp;amp;&amp;amp; (result.size() &amp;gt; 0) &amp;amp;&amp;amp; (result[0].KEYEXPR != null)&amp;amp;&amp;amp;!(result[0].KEYEXPR instanceof List )){
if(result[0].type == "Subtyped") {
    println '{{html clean="false" wiki="true"}}'
    //println '&amp;lt;body&amp;gt;'
    def dataSubtype = DataToDrawChart.getDataToDrawSubtype(result)
    def listKey = []
    dataSubtype.each {key,value -&amp;gt;
        listKey.add(key)
    }
    def jsonkey = com.mongodb.util.JSON.serialize(listKey)
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$jsonkey&amp;lt;/textarea&amp;gt;"

    dataSubtype.each {key,value -&amp;gt;
        println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +'&amp;lt;/div&amp;gt;'
        println "-----"
        def dataLine = []
        def dataBar = []
        def dataPie = []
        def dataArea = []
        if(DataToDrawChart.getDataToDrawLine(value) != []) {
            dataLine = DataToDrawChart.getDataToDrawLine(value)
        }
        if(DataToDrawChart.getDataToDrawBar(value) != []) {
            dataBar = DataToDrawChart.getDataToDrawBar(value)
        }
        if(DataToDrawChart.getDataToDrawPie(value) != []) {
            dataPie = DataToDrawChart.getDataToDrawPie(value)
        }
        if(DataToDrawChart.getDataToDrawArea(value) != []) {
            dataArea = DataToDrawChart.getDataToDrawArea(value)
        }

        def chartColumnsLine
        def chartColumnsBar 
        def chartColumnsArea 
        def lstName
        if(dataLine.size() &amp;gt; 0 ){
            chartColumnsLine = dataLine[0].chart_columns
        }
        if(dataBar.size() &amp;gt; 0){
            chartColumnsBar = dataBar[0].chart_columns
        }
        if(dataArea.size() &amp;gt; 0 ){
            chartColumnsArea = dataArea[0].chart_columns
        }
        if(dataPie.size() &amp;gt; 0 ){
            lstName = dataPie['name']
        }

        def tmpListNameContainer = []
	for(def nameContainer in lstName){
	   nameContainer = nameContainer.replaceAll("\\.", "_")
	   tmpListNameContainer.add(nameContainer)
	}
        def jsonPie
        def jsonLine
	def jsonBar
        def jsonArea
        if(dataPie != []) {
	    jsonPie = com.mongodb.util.JSON.serialize(dataPie)
        }
        if(dataLine != []) {
	    jsonLine = com.mongodb.util.JSON.serialize(dataLine)
        }
        if(dataBar != []) {
            jsonBar = com.mongodb.util.JSON.serialize(dataBar)
        }
        if(dataArea != []) {
	    jsonArea = com.mongodb.util.JSON.serialize(dataArea)
        }

	def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
	def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
	def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
	def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

	println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
        if(jsonLine != null) {
	    println "&amp;lt;textarea id=\"jsonline_$key\" &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;" 
        }
	if(jsonBar != null) {
            println "&amp;lt;textarea id=\"jsonbar_$key\"&amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
 	    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
        }
        if(jsonPie != null) {
	    println "&amp;lt;textarea id=\"jsonpie_$key\" &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
        }
        if(jsonArea != null) {
	    println "&amp;lt;textarea id=\"jsonarea_$key\" &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"
	    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
        }

	println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
	println "&amp;lt;input style=\"display:none\" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;"
	println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
	println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'
	println "&amp;lt;/div&amp;gt;"
	  
	def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
	def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
	  
	println "&amp;lt;div style='clear:both'&amp;gt;"
        if(jsonPie != null) {
	  println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
	  lstName.each{
	    def tmp = it.replaceAll("\\.", "_")
	    println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
        if(jsonLine != null) {
	  def chartLineComment = false
	  chartColumnsLine.each{
	    if(!chartLineComment){
	       println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	       chartLineComment = true  
	    }

	      println " &amp;lt;div class=\"displayblock\" id=\"containerline${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
        println "&amp;amp;nbsp;"

        if(jsonBar != null) {
	  def chartBarComment = false
	  chartColumnsBar.each{
	     if(!chartBarComment){
	        println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	        chartBarComment = true
	      }  

	     println " &amp;lt;div class=\"displayblock\" id=\"containerbar${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
	println "&amp;amp;nbsp;"

        if(jsonArea != null) {
	  def chartAreaComment = false
	  chartColumnsArea.each{
	  if(!chartAreaComment){
	    println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	    chartAreaComment = true
	  }
	    println " &amp;lt;div class=\"displayblock\" id=\"containerarea${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
	println "&amp;lt;/div&amp;gt;"
        
    }
    println '&amp;lt;/body&amp;gt;'
    println '{{/html}}'
} else if(result[0].type == "Store") {
    // data store
    def dataLine = DataToDrawChart.getDataToDrawLine(result)
    def dataBar = DataToDrawChart.getDataToDrawBar(result)
    def dataPie = DataToDrawChart.getDataToDrawPie(result)
    def dataArea = DataToDrawChart.getDataToDrawArea(result)
    def chartColumnsLine 
    def chartColumnsBar 
    def chartColumnsArea 
    def lstName 

    if(dataLine.size() &amp;gt; 0 ){
        chartColumnsLine = dataLine[0].chart_columns
    }
    if(dataBar.size() &amp;gt; 0){
        chartColumnsBar = dataBar[0].chart_columns
    }
    if(dataArea.size() &amp;gt; 0 ){
        chartColumnsArea = dataArea[0].chart_columns
    }
    if(dataPie.size() &amp;gt; 0 ){
        lstName = dataPie['name']
    }

    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
  
    def tmpListNameContainer = []
    for(def nameContainer in lstName){
       nameContainer = nameContainer.replaceAll("\\.", "_")
       tmpListNameContainer.add(nameContainer)
    }
  
    def jsonPie = com.mongodb.util.JSON.serialize(dataPie)
    def jsonLine = com.mongodb.util.JSON.serialize(dataLine)
    def jsonBar = com.mongodb.util.JSON.serialize(dataBar)
    def jsonArea = com.mongodb.util.JSON.serialize(dataArea)

    def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
    def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
    def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
    def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

    def listEmpty = com.mongodb.util.JSON.serialize([])
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$listEmpty&amp;lt;/textarea&amp;gt;" 

    println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'

    println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
    println "&amp;lt;textarea class='jsonline' &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonbar' &amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonpie' &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonarea' &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"

    println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
  
    def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
    def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
  
    println "&amp;lt;div style='clear:both'&amp;gt;"
  
    def chartPieComment = false
    lstName.each{
        if(!chartPieComment) {
            println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
            chartPieComment = true
        }
        def tmp = it.replaceAll("\\.", "_")
        println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    def chartLineComment = false
    chartColumnsLine.each{
    if(!chartLineComment){
        println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
        chartLineComment = true  
    }

    println " &amp;lt;div class=\"displayblock\" id=\"containerline$it\"&amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    println "&amp;amp;nbsp;"
    def chartBarComment = false
    chartColumnsBar.each{
        if(!chartBarComment){
            println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
            chartBarComment = true
        }  

    println " &amp;lt;div class=\"displayblock\" id=\"containerbar$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
  println "&amp;lt;/div&amp;gt;"
  println "&amp;amp;nbsp;"
  def chartAreaComment = false
  chartColumnsArea.each{
  if(!chartAreaComment){
    println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
    chartAreaComment = true
  }
    println " &amp;lt;div class=\"displayblock\" id=\"containerarea$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
  println "&amp;lt;/div&amp;gt;"
println "&amp;lt;/div&amp;gt;"

println '&amp;lt;/body&amp;gt;'
println '{{/html}}'
}
}else{
    println 'There is no data for this job with criterias'
}
{{/groovy}}&lt;/content&gt;&lt;/xwikidoc&gt;
@


36.2
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376375748000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;36.2&lt;/version&gt;
a2428 1

@


36.1
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376375628000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;36.1&lt;/version&gt;
d21 1
a21 1
&lt;minorEdit&gt;false&lt;/minorEdit&gt;
@


35.2
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376375612000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;35.2&lt;/version&gt;
d21 1
a21 1
&lt;minorEdit&gt;true&lt;/minorEdit&gt;
@


35.1
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376375535000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;35.1&lt;/version&gt;
d21 1
a21 1
&lt;minorEdit&gt;false&lt;/minorEdit&gt;
d2425 1
d2535 5
a2539 5
	$(function () {
		function drawLineChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail
d2793 1
a2793 1
						// draw bar chart
d2798 1
a2798 1
							drawBarChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
d2844 1
a2844 1
							drawAreaChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
d2867 18
a2884 22
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonpie_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerpie");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						// draw Pie Chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							var finalData = []
							finalData[0] = data_all[0][i]
							drawPieChart(finalData, finalKey + "_" + lstContainer[0][i])
						}
					}
a2885 18
			} else {
				var array = $("#jsons&amp;gt;.jsonpie");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerpie");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					// draw Pie Chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						var finalData = []
						finalData[0] = data_all[0][i]
						drawPieChart(finalData, lstContainer[0][i])
					}
				}
@


34.5
log
@@
text
@&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xwikidoc&gt;
&lt;web&gt;WiperDog&lt;/web&gt;
&lt;name&gt;WebHome&lt;/name&gt;
&lt;language&gt;&lt;/language&gt;
&lt;defaultLanguage&gt;en&lt;/defaultLanguage&gt;
&lt;translation&gt;0&lt;/translation&gt;
&lt;parent&gt;&lt;/parent&gt;
&lt;creator&gt;XWiki.Admin&lt;/creator&gt;
&lt;author&gt;XWiki.Admin&lt;/author&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;contentAuthor&gt;XWiki.Admin&lt;/contentAuthor&gt;
&lt;creationDate&gt;1376364375000&lt;/creationDate&gt;
&lt;date&gt;1376375518000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376375518000&lt;/contentUpdateDate&gt;
&lt;version&gt;34.5&lt;/version&gt;
&lt;title&gt;WiperDog&lt;/title&gt;
&lt;defaultTemplate&gt;&lt;/defaultTemplate&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;comment&gt;&lt;/comment&gt;
&lt;minorEdit&gt;true&lt;/minorEdit&gt;
&lt;syntaxId&gt;xwiki/2.1&lt;/syntaxId&gt;
&lt;hidden&gt;false&lt;/hidden&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;047293a8-524d-45e4-af52-cd944523d5d0&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
/*
 * jQuery timepicker addon
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 1.3.1
 * Last Modified: 07/07/2013
 *
 * Copyright 2013 Trent Richardson
 * You may use this project under MIT or GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 */

/*jslint evil: true, white: false, undef: false, nomen: false */

(function($) {

	/*
	* Lets not redefine timepicker, Prevent "Uncaught RangeError: Maximum call stack size exceeded"
	*/
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return;
	}

	/*
	* Extend jQueryUI, get it started with our version number
	*/
	$.extend($.ui, {
		timepicker: {
			version: "1.3.1"
		}
	});

	/* 
	* Timepicker manager.
	* Use the singleton instance of this class, $.timepicker, to interact with the time picker.
	* Settings for (groups of) time pickers are maintained in an instance object,
	* allowing multiple different settings on the same page.
	*/
	var Timepicker = function() {
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[''] = { // Default regional settings
			currentText: 'Now',
			closeText: 'Done',
			amNames: ['AM', 'A'],
			pmNames: ['PM', 'P'],
			timeFormat: 'HH:mm',
			timeSuffix: '',
			timeOnlyTitle: 'Choose Time',
			timeText: 'Time',
			hourText: 'Hour',
			minuteText: 'Minute',
			secondText: 'Second',
			millisecText: 'Millisecond',
			microsecText: 'Microsecond',
			timezoneText: 'Time Zone',
			isRTL: false
		};
		this._defaults = { // Global defaults for all the datetime picker instances
			showButtonPanel: true,
			timeOnly: false,
			showHour: null,
			showMinute: null,
			showSecond: null,
			showMillisec: null,
			showMicrosec: null,
			showTimezone: null,
			showTime: true,
			stepHour: 1,
			stepMinute: 1,
			stepSecond: 1,
			stepMillisec: 1,
			stepMicrosec: 1,
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null,
			hourMin: 0,
			minuteMin: 0,
			secondMin: 0,
			millisecMin: 0,
			microsecMin: 0,
			hourMax: 23,
			minuteMax: 59,
			secondMax: 59,
			millisecMax: 999,
			microsecMax: 999,
			minDateTime: null,
			maxDateTime: null,
			onSelect: null,
			hourGrid: 0,
			minuteGrid: 0,
			secondGrid: 0,
			millisecGrid: 0,
			microsecGrid: 0,
			alwaysSetTime: true,
			separator: ' ',
			altFieldTimeOnly: true,
			altTimeFormat: null,
			altSeparator: null,
			altTimeSuffix: null,
			pickerTimeFormat: null,
			pickerTimeSuffix: null,
			showTimepicker: true,
			timezoneList: null,
			addSliderAccess: false,
			sliderAccessArgs: null,
			controlType: 'slider',
			defaultValue: null,
			parse: 'strict'
		};
		$.extend(this._defaults, this.regional['']);
	};

	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: '',
		formattedDate: '',
		formattedTime: '',
		formattedDateTime: '',
		timezoneList: null,
		units: ['hour','minute','second','millisec', 'microsec'],
		support: {},
		control: null,

		/* 
		* Override the default settings for all instances of the time picker.
		* @@param  settings  object - the new settings to use as defaults (anonymous object)
		* @@return the manager object
		*/
		setDefaults: function(settings) {
			extendRemove(this._defaults, settings || {});
			return this;
		},

		/*
		* Create a new Timepicker instance
		*/
		_newInst: function($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
            	fns = {},
		    	overrides, i;

			for (var attrName in this._defaults) {
				if(this._defaults.hasOwnProperty(attrName)){
					var attrValue = $input.attr('time:' + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue);
						} catch (err) {
							inlineSettings[attrName] = attrValue;
						}
					}
				}
			}

		    overrides = {
		        beforeShow: function (input, dp_inst) {
		            if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
		                return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst);
		            }
		        },
		        onChangeMonthYear: function (year, month, dp_inst) {
		            // Update the time as well : this prevents the time from disappearing from the $input field.
		            tp_inst._updateDateTime(dp_inst);
		            if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
		                tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst);
		            }
		        },
		        onClose: function (dateText, dp_inst) {
		            if (tp_inst.timeDefined === true &amp;amp;&amp;amp; $input.val() !== '') {
		                tp_inst._updateDateTime(dp_inst);
		            }
		            if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
		                tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst);
		            }
		        }
		    };
		    for (i in overrides) {
		        if (overrides.hasOwnProperty(i)) {
		            fns[i] = opts[i] || null;
		        }
		    }

		    tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
		        evnts:fns,
		        timepicker: tp_inst // add timepicker as a property of datepicker: $.datepicker._get(dp_inst, 'timepicker');
		    });
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function(val) {
				return val.toUpperCase();
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function(val) {
				return val.toUpperCase();
			});

			// detect which units are supported
			tp_inst.support = detectSupport(
					tp_inst._defaults.timeFormat + 
					(tp_inst._defaults.pickerTimeFormat? tp_inst._defaults.pickerTimeFormat:'') + 
					(tp_inst._defaults.altTimeFormat? tp_inst._defaults.altTimeFormat:''));

			// controlType is string - key to our this._controls
			if(typeof(tp_inst._defaults.controlType) === 'string'){
				if(tp_inst._defaults.controlType == 'slider' &amp;amp;&amp;amp; typeof(jQuery.ui.slider) === 'undefined'){
					tp_inst._defaults.controlType = 'select';
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType];
			}
			// controlType is an object and must implement create, options, value methods
			else{ 
				tp_inst.control = tp_inst._defaults.controlType;
			}

			// prep the timezone options
			var timezoneList = [-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,
					0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList;
			}
			var tzl=timezoneList.length,tzi=0,tzv=null;
			if (tzl &amp;gt; 0 &amp;amp;&amp;amp; typeof timezoneList[0] !== 'object') {
				for(; tzi&amp;lt;tzl; tzi++){
					tzv = timezoneList[tzi];
					timezoneList[tzi] = { value: tzv, label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601) };
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;

			// set the default units
			tp_inst.timezone = tp_inst._defaults.timezone !== null? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) : 
							((new Date()).getTimezoneOffset()*-1);
			tp_inst.hour = tp_inst._defaults.hour &amp;lt; tp_inst._defaults.hourMin? tp_inst._defaults.hourMin : 
							tp_inst._defaults.hour &amp;gt; tp_inst._defaults.hourMax? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute &amp;lt; tp_inst._defaults.minuteMin? tp_inst._defaults.minuteMin : 
							tp_inst._defaults.minute &amp;gt; tp_inst._defaults.minuteMax? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second &amp;lt; tp_inst._defaults.secondMin? tp_inst._defaults.secondMin : 
							tp_inst._defaults.second &amp;gt; tp_inst._defaults.secondMax? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec &amp;lt; tp_inst._defaults.millisecMin? tp_inst._defaults.millisecMin : 
							tp_inst._defaults.millisec &amp;gt; tp_inst._defaults.millisecMax? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec &amp;lt; tp_inst._defaults.microsecMin? tp_inst._defaults.microsecMin : 
							tp_inst._defaults.microsec &amp;gt; tp_inst._defaults.microsecMax? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = '';
			tp_inst.$input = $input;

			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField).css({
					cursor: 'pointer'
				}).focus(function() {
					$input.trigger("focus");
				});
			}

			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date();
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date();
			}

			// datepicker needs minDate/maxDate, timepicker needs minDateTime/maxDateTime..
			if (tp_inst._defaults.minDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime());
			}
			if (tp_inst._defaults.minDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime());
			}
			if (tp_inst._defaults.maxDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime());
			}
			if (tp_inst._defaults.maxDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime());
			}
			tp_inst.$input.bind('focus', function() {
				tp_inst._onFocus();
			});

			return tp_inst;
		},

		/*
		* add our sliders to the calendar
		*/
		_addTimePicker: function(dp_inst) {
			var currDT = (this.$altInput &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly) ? this.$input.val() + ' ' + this.$altInput.val() : this.$input.val();

			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
		},

		/*
		* parse the time string from input value or _setTime
		*/
		_parseTime: function(timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0]);
			}

			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, 'dateFormat');
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false;
					}
					$.extend(this, parseRes.timeObj);
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err +
									"\ndate/time string = " + timeString +
									"\ntimeFormat = " + this._defaults.timeFormat +
									"\ndateFormat = " + dp_dateFormat);
					return false;
				}
				return true;
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false;
				}
				$.extend(this, timeObj);
				return true;
			}
		},

		/*
		* generate and inject html for timepicker into ui datepicker
		*/
		_injectTimePicker: function() {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = '',
				uitem = '',
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i=0,
				l=0;

			// Prevent displaying twice
			if ($dp.find("div.ui-timepicker-div").length === 0 &amp;amp;&amp;amp; o.showTimepicker) {
				var noDisplay = ' style="display:none;"',
					html = '&amp;lt;div class="ui-timepicker-div'+ (o.isRTL? ' ui-timepicker-rtl' : '') +'"&amp;gt;&amp;lt;dl&amp;gt;' + '&amp;lt;dt class="ui_tpicker_time_label"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;' + o.timeText + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_time"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the markup
				for(i=0,l=this.units.length; i&amp;lt;l; i++){
					litem = this.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// Added by Peter Medeiros:
					// - Figure out what the hour/minute/second max should be based on the step values.
					// - Example: if stepMinute is 15, then minMax is 45.
					max[litem] = parseInt((o[litem+'Max'] - ((o[litem+'Max'] - o[litem+'Min']) % o['step'+uitem])), 10);
					gridSize[litem] = 0;

					html += '&amp;lt;dt class="ui_tpicker_'+ litem +'_label"' + (show ? '' : noDisplay) + '&amp;gt;' + o[litem +'Text'] + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_'+ litem +'"&amp;gt;&amp;lt;div class="ui_tpicker_'+ litem +'_slider"' + (show ? '' : noDisplay) + '&amp;gt;&amp;lt;/div&amp;gt;';

					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						html += '&amp;lt;div style="padding-left: 1px"&amp;gt;&amp;lt;table class="ui-tpicker-grid-label"&amp;gt;&amp;lt;tr&amp;gt;';

						if(litem == 'hour'){
							for (var h = o[litem+'Min']; h &amp;lt;= max[litem]; h += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm? 'hht':'HH', {hour:h}, o);									
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + tmph + '&amp;lt;/td&amp;gt;';
							}
						}
						else{
							for (var m = o[litem+'Min']; m &amp;lt;= max[litem]; m += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + ((m &amp;lt; 10) ? '0' : '') + m + '&amp;lt;/td&amp;gt;';
							}
						}

						html += '&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;&amp;lt;/div&amp;gt;';
					}
					html += '&amp;lt;/dd&amp;gt;';
				}
				
				// Timezone
				var showTz = o.showTimezone !== null? o.showTimezone : this.support.timezone;
				html += '&amp;lt;dt class="ui_tpicker_timezone_label"' + (showTz ? '' : noDisplay) + '&amp;gt;' + o.timezoneText + '&amp;lt;/dt&amp;gt;';
				html += '&amp;lt;dd class="ui_tpicker_timezone" ' + (showTz ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the elements from string
				html += '&amp;lt;/dl&amp;gt;&amp;lt;/div&amp;gt;';
				var $tp = $(html);

				// if we only want time picker...
				if (o.timeOnly === true) {
					$tp.prepend('&amp;lt;div class="ui-widget-header ui-helper-clearfix ui-corner-all"&amp;gt;' + '&amp;lt;div class="ui-datepicker-title"&amp;gt;' + o.timeOnlyTitle + '&amp;lt;/div&amp;gt;' + '&amp;lt;/div&amp;gt;');
					$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();
				}
				
				// add sliders, adjust grids, add events
				for(i=0,l=tp_inst.units.length; i&amp;lt;l; i++){
					litem = tp_inst.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// add the slider
					tp_inst[litem+'_slider'] = tp_inst.control.create(tp_inst, $tp.find('.ui_tpicker_'+litem+'_slider'), litem, tp_inst[litem], o[litem+'Min'], max[litem], o['step'+uitem]);

					// adjust the grid and add click event
					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						size = 100 * gridSize[litem] * o[litem+'Grid'] / (max[litem] - o[litem+'Min']);
						$tp.find('.ui_tpicker_'+litem+' table').css({
							width: size + "%",
							marginLeft: o.isRTL? '0' : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL? ((size / (-2 * gridSize[litem])) + "%") : '0',
							borderCollapse: 'collapse'
						}).find("td").click(function(e){
								var $t = $(this),
									h = $t.html(),
									n = parseInt(h.replace(/[^0-9]/g),10),
									ap = h.replace(/[^apm]/ig),
									f = $t.data('for'); // loses scope, so we use data-for

								if(f == 'hour'){
									if(ap.indexOf('p') !== -1 &amp;amp;&amp;amp; n &amp;lt; 12){
										n += 12;
									}
									else{
										if(ap.indexOf('a') !== -1 &amp;amp;&amp;amp; n === 12){
											n = 0;
										}
									}
								}
								
								tp_inst.control.value(tp_inst, tp_inst[f+'_slider'], litem, n);

								tp_inst._onTimeChange();
								tp_inst._onSelectHandler();
							}).css({
								cursor: 'pointer',
								width: (100 / gridSize[litem]) + '%',
								textAlign: 'center',
								overflow: 'hidden'
							});
					} // end if grid &amp;gt; 0
				} // end for loop

				// Add timezone options
				this.timezone_select = $tp.find('.ui_tpicker_timezone').append('&amp;lt;select&amp;gt;&amp;lt;/select&amp;gt;').find("select");
				$.fn.append.apply(this.timezone_select,
				$.map(o.timezoneList, function(val, idx) {
					return $("&amp;lt;option /&amp;gt;").val(typeof val == "object" ? val.value : val).text(typeof val == "object" ? val.label : val);
				}));
				if (typeof(this.timezone) != "undefined" &amp;amp;&amp;amp; this.timezone !== null &amp;amp;&amp;amp; this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset()*-1;
					if (local_timezone == this.timezone) {
						selectLocalTimezone(tp_inst);
					} else {
						this.timezone_select.val(this.timezone);
					}
				} else {
					if (typeof(this.hour) != "undefined" &amp;amp;&amp;amp; this.hour !== null &amp;amp;&amp;amp; this.hour !== "") {
						this.timezone_select.val(o.timezone);
					} else {
						selectLocalTimezone(tp_inst);
					}
				}
				this.timezone_select.change(function() {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
				});
				// End timezone options
				
				// inject timepicker into datepicker
				var $buttonPanel = $dp.find('.ui-datepicker-buttonpane');
				if ($buttonPanel.length) {
					$buttonPanel.before($tp);
				} else {
					$dp.append($tp);
				}

				this.$timeObj = $tp.find('.ui_tpicker_time');

				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined;
				}

				// slideAccess integration: http://trentrichardson.com/2011/11/11/jquery-ui-sliders-and-touch-accessibility/
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
						
					setTimeout(function() { // fix for inline mode
						if ($tp.find('.ui-slider-access').length === 0) {
							$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);

							// fix any grids since sliders are shorter
							var sliderAccessWidth = $tp.find('.ui-slider-access:eq(0)').outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find('table:visible').each(function() {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl? 'marginRight':'marginLeft').toString().replace('%', ''),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + '%',
										css = { width: newWidth, marginRight: 0, marginLeft: 0 };
									css[rtl? 'marginRight':'marginLeft'] = newMarginLeft;
									$g.css(css);
								});
							}
						}
					}, 10);
				}
				// end slideAccess integration

				tp_inst._limitMinMaxDateTime(this.inst, true);
			}
		},

		/*
		* This function tries to limit the ability to go outside the
		* min/max date range
		*/
		_limitMinMaxDateTime: function(dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);

			if (!this._defaults.showTimepicker) {
				return;
			} // No time so nothing to check here

			if ($.datepicker._get(dp_inst, 'minDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'minDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, 'minDateTime'),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin;
				}

				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour &amp;lt;= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute &amp;lt;= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second &amp;lt;= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if(this.millisec &amp;lt;= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;lt; this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin;
									}
									this._defaults.microsecMin = this.microsecMinOriginal;
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal;
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal;
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal;
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal;
				}
			}

			if ($.datepicker._get(dp_inst, 'maxDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'maxDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, 'maxDateTime'),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax;
				}

				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour &amp;gt;= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute &amp;gt;= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second &amp;gt;= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec &amp;gt;= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;gt; this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax;
									}
									this._defaults.microsecMax = this.microsecMaxOriginal;
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal;
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal;
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal;
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal;
				}
			}

			if (adjustSliders !== undefined &amp;amp;&amp;amp; adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10);
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);

				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, 'hour', { min: this._defaults.hourMin, max: hourMax });
					this.control.value(this, this.hour_slider, 'hour', this.hour - (this.hour % this._defaults.stepHour));
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, 'minute', { min: this._defaults.minuteMin, max: minMax });
					this.control.value(this, this.minute_slider, 'minute', this.minute - (this.minute % this._defaults.stepMinute));
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, 'second', { min: this._defaults.secondMin, max: secMax });
					this.control.value(this, this.second_slider, 'second', this.second - (this.second % this._defaults.stepSecond));
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, 'millisec', { min: this._defaults.millisecMin, max: millisecMax });
					this.control.value(this, this.millisec_slider, 'millisec', this.millisec - (this.millisec % this._defaults.stepMillisec));
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, 'microsec', { min: this._defaults.microsecMin, max: microsecMax });
					this.control.value(this, this.microsec_slider, 'microsec', this.microsec - (this.microsec % this._defaults.stepMicrosec));
				}
			}

		},

		/*
		* when a slider moves, set the internal time...
		* on time change is also called when the time is updated in the text field
		*/
		_onTimeChange: function() {
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, 'hour') : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, 'minute') : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, 'second') : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, 'millisec') : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, 'microsec') : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;

			if (typeof(hour) == 'object') {
				hour = false;
			}
			if (typeof(minute) == 'object') {
				minute = false;
			}
			if (typeof(second) == 'object') {
				second = false;
			}
			if (typeof(millisec) == 'object') {
				millisec = false;
			}
			if (typeof(microsec) == 'object') {
				microsec = false;
			}
			if (typeof(timezone) == 'object') {
				timezone = false;
			}

			if (hour !== false) {
				hour = parseInt(hour, 10);
			}
			if (minute !== false) {
				minute = parseInt(minute, 10);
			}
			if (second !== false) {
				second = parseInt(second, 10);
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10);
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10);
			}

			var ampm = o[hour &amp;lt; 12 ? 'amNames' : 'pmNames'][0];

			// If the update was done in the input field, the input field should not be updated.
			// If the update was done using the sliders, update the input field.
			var hasChanged = (hour != this.hour || minute != this.minute || second != this.second || millisec != this.millisec || microsec != this.microsec 
								|| (this.ampm.length &amp;gt; 0 &amp;amp;&amp;amp; (hour &amp;lt; 12) != ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) 
								|| (this.timezone !== null &amp;amp;&amp;amp; timezone != this.timezone));

			if (hasChanged) {

				if (hour !== false) {
					this.hour = hour;
				}
				if (minute !== false) {
					this.minute = minute;
				}
				if (second !== false) {
					this.second = second;
				}
				if (millisec !== false) {
					this.millisec = millisec;
				}
				if (microsec !== false) {
					this.microsec = microsec;
				}
				if (timezone !== false) {
					this.timezone = timezone;
				}

				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0]);
				}

				this._limitMinMaxDateTime(this.inst, true);
			}
			if (this.support.ampm) {
				this.ampm = ampm;
			}

			// Updates the time within the timepicker
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if(pickerTimeFormat === o.timeFormat){
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix);
				}
				else{
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix);
				}
			}

			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime();
			}
		},

		/*
		* call custom onSelect.
		* bind to sliders slidestop, and grid click.
		*/
		_onSelectHandler: function() {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect &amp;amp;&amp;amp; inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this]);
			}
		},

		/*
		* update our input with the new date time..
		*/
		_updateDateTime: function(dp_inst) {
			dp_inst = this.inst || dp_inst;
			//var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
			var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay)),
				dateFmt = $.datepicker._get(dp_inst, 'dateFormat'),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null &amp;amp;&amp;amp; this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			
			// if a slider was changed but datepicker doesn't have a value yet, set it
			if(dp_inst.lastVal===""){
                dp_inst.currentYear=dp_inst.selectedYear;
                dp_inst.currentMonth=dp_inst.selectedMonth;
                dp_inst.currentDay=dp_inst.selectedDay;
            }

			/*
			* remove following lines to force every changes in date picker to change the input value
			* Bug descriptions: when an input field has a default value, and click on the field to pop up the date picker. 
			* If the user manually empty the value in the input field, the date picker will never change selected value.
			*/
			//if (dp_inst.lastVal !== undefined &amp;amp;&amp;amp; (dp_inst.lastVal.length &amp;gt; 0 &amp;amp;&amp;amp; this.$input.val().length === 0)) {
			//	return;
			//}

			if (this._defaults.timeOnly === true) {
				formattedDateTime = this.formattedTime;
			} else if (this._defaults.timeOnly !== true &amp;amp;&amp;amp; (this._defaults.alwaysSetTime || timeAvailable)) {
				formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix;
			}

			this.formattedDateTime = formattedDateTime;

			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate);
			} else if (this.$altInput &amp;amp;&amp;amp; this._defaults.timeOnly === false &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly === true) {
				this.$altInput.val(this.formattedTime);
				this.$input.val(this.formattedDate);
			} else if (this.$altInput) {
				this.$input.val(formattedDateTime);
				var altFormattedDateTime = '',
					altSeparator = this._defaults.altSeparator ? this._defaults.altSeparator : this._defaults.separator,
					altTimeSuffix = this._defaults.altTimeSuffix ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
				
				if(!this._defaults.timeOnly){
					if (this._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg);
					}
					else{
						altFormattedDateTime = this.formattedDate;
					}

					if (altFormattedDateTime){
						altFormattedDateTime += altSeparator;
					}
				}

				if(this._defaults.altTimeFormat){
					altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix;
				}
				else{
					altFormattedDateTime += this.formattedTime + altTimeSuffix;
				}
				this.$altInput.val(altFormattedDateTime);
			} else {
				this.$input.val(formattedDateTime);
			}

			this.$input.trigger("change");
		},

		_onFocus: function() {
			if (!this.$input.val() &amp;amp;&amp;amp; this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, 'timepicker');
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst);
						} catch (err) {
							$.timepicker.log(err);
						}
					}
				}
			}
		},

		/*
		* Small abstraction to control types
		* We can add more, just be sure to follow the pattern: create, options, value
		*/
		_controls: {
			// slider methods
			slider: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var rtl = tp_inst._defaults.isRTL; // if rtl go -60-&amp;gt;0 instead of 0-&amp;gt;60
					return obj.prop('slide', null).slider({
						orientation: "horizontal",
						value: rtl? val*-1 : val,
						min: rtl? max*-1 : min,
						max: rtl? min*-1 : max,
						step: step,
						slide: function(event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl? ui.value*-1:ui.value);
							tp_inst._onTimeChange();
						},
						stop: function(event, ui) {
							tp_inst._onSelectHandler();
						}
					});	
				},
				options: function(tp_inst, obj, unit, opts, val){
					if(tp_inst._defaults.isRTL){
						if(typeof(opts) == 'string'){
							if(opts == 'min' || opts == 'max'){
								if(val !== undefined){
									return obj.slider(opts, val*-1);
								}
								return Math.abs(obj.slider(opts));
							}
							return obj.slider(opts);
						}
						var min = opts.min, 
							max = opts.max;
						opts.min = opts.max = null;
						if(min !== undefined){
							opts.max = min * -1;
						}
						if(max !== undefined){
							opts.min = max * -1;
						}
						return obj.slider(opts);
					}
					if(typeof(opts) == 'string' &amp;amp;&amp;amp; val !== undefined){
							return obj.slider(opts, val);
					}
					return obj.slider(opts);
				},
				value: function(tp_inst, obj, unit, val){
					if(tp_inst._defaults.isRTL){
						if(val !== undefined){
							return obj.slider('value', val*-1);
						}
						return Math.abs(obj.slider('value'));
					}
					if(val !== undefined){
						return obj.slider('value', val);
					}
					return obj.slider('value');
				}
			},
			// select methods
			select: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var sel = '&amp;lt;select class="ui-timepicker-select" data-unit="'+ unit +'" data-min="'+ min +'" data-max="'+ max +'" data-step="'+ step +'"&amp;gt;',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;

					for(var i=min; i&amp;lt;=max; i+=step){						
						sel += '&amp;lt;option value="'+ i +'"'+ (i==val? ' selected':'') +'&amp;gt;';
						if(unit == 'hour'){
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig,'')), {hour:i}, tp_inst._defaults);
						}
						else if(unit == 'millisec' || unit == 'microsec' || i &amp;gt;= 10){ sel += i; }
						else {sel += '0'+ i.toString(); }
						sel += '&amp;lt;/option&amp;gt;';
					}
					sel += '&amp;lt;/select&amp;gt;';

					obj.children('select').remove();

					$(sel).appendTo(obj).change(function(e){
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
					});

					return obj;
				},
				options: function(tp_inst, obj, unit, opts, val){
					var o = {},
						$t = obj.children('select');
					if(typeof(opts) == 'string'){
						if(val === undefined){
							return $t.data(opts);
						}
						o[opts] = val;	
					}
					else{ o = opts; }
					return tp_inst.control.create(tp_inst, obj, $t.data('unit'), $t.val(), o.min || $t.data('min'), o.max || $t.data('max'), o.step || $t.data('step'));
				},
				value: function(tp_inst, obj, unit, val){
					var $t = obj.children('select');
					if(val !== undefined){
						return $t.val(val);
					}
					return $t.val();
				}
			}
		} // end _controls

	});

	$.fn.extend({
		/*
		* shorthand just to use timepicker..
		*/
		timepicker: function(o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);

			if (typeof o == 'object') {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				});
			}

			return $(this).each(function() {
				$.fn.datetimepicker.apply($(this), tmp_args);
			});
		},

		/*
		* extend timepicker to datepicker
		*/
		datetimepicker: function(o) {
			o = o || {};
			var tmp_args = arguments;

			if (typeof(o) == 'string') {
				if (o == 'getDate') {
					return $.fn.datepicker.apply($(this[0]), tmp_args);
				} else {
					return this.each(function() {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args);
					});
				}
			} else {
				return this.each(function() {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults);
				});
			}
		}
	});

	/*
	* Public Utility to parse date and time
	*/
	$.datepicker.parseDateTime = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec);
		}

		return parseRes.date;
	};

	/*
	* Public utility to parse time
	*/
	$.datepicker.parseTime = function(timeFormat, timeString, options) {		
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g,'').indexOf('Z') !== -1);

		// Strict parse requires the timeString to match the timeFormat exactly
		var strictParse = function(f, s, o){

			// pattern for standard and localized AM/PM markers
			var getPatternAmpm = function(amNames, pmNames) {
				var markers = [];
				if (amNames) {
					$.merge(markers, amNames);
				}
				if (pmNames) {
					$.merge(markers, pmNames);
				}
				markers = $.map(markers, function(val) {
					return val.replace(/[.*+?|()\[\]{}\\]/g, '\\$&amp;amp;');
				});
				return '(' + markers.join('|') + ')?';
			};

			// figure out position of time elements.. cause js cant do named captures
			var getFormatPositions = function(timeFormat) {
				var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
					orders = {
						h: -1,
						m: -1,
						s: -1,
						l: -1,
						c: -1,
						t: -1,
						z: -1
					};

				if (finds) {
					for (var i = 0; i &amp;lt; finds.length; i++) {
						if (orders[finds[i].toString().charAt(0)] == -1) {
							orders[finds[i].toString().charAt(0)] = i + 1;
						}
					}
				}
				return orders;
			};

			var regstr = '^' + f.toString()
					.replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
							var ml = match.length;
							switch (match.charAt(0).toLowerCase()) {
								case 'h': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'm': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 's': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'l': return '(\\d?\\d?\\d)';
								case 'c': return '(\\d?\\d?\\d)';
								case 'z': return '(z|[-+]\\d\\d:?\\d\\d|\\S+)?';
								case 't': return getPatternAmpm(o.amNames, o.pmNames);
								default:    // literal escaped in quotes
									return '(' + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function (m) { return "\\" + m; }) + ')?';
							}
						})
					.replace(/\s/g, '\\s?') +
					o.timeSuffix + '$',
				order = getFormatPositions(f),
				ampm = '',
				treg;

			treg = s.match(new RegExp(regstr, 'i'));

			var resTime = {
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0
			};

			if (treg) {
				if (order.t !== -1) {
					if (treg[order.t] === undefined || treg[order.t].length === 0) {
						ampm = '';
						resTime.ampm = '';
					} else {
						ampm = $.inArray(treg[order.t].toUpperCase(), o.amNames) !== -1 ? 'AM' : 'PM';
						resTime.ampm = o[ampm == 'AM' ? 'amNames' : 'pmNames'][0];
					}
				}

				if (order.h !== -1) {
					if (ampm == 'AM' &amp;amp;&amp;amp; treg[order.h] == '12') {
						resTime.hour = 0; // 12am = 0 hour
					} else {
						if (ampm == 'PM' &amp;amp;&amp;amp; treg[order.h] != '12') {
							resTime.hour = parseInt(treg[order.h], 10) + 12; // 12pm = 12 hour, any other pm = hour + 12
						} else {
							resTime.hour = Number(treg[order.h]);
						}
					}
				}

				if (order.m !== -1) {
					resTime.minute = Number(treg[order.m]);
				}
				if (order.s !== -1) {
					resTime.second = Number(treg[order.s]);
				}
				if (order.l !== -1) {
					resTime.millisec = Number(treg[order.l]);
				}
				if (order.c !== -1) {
					resTime.microsec = Number(treg[order.c]);
				}
				if (order.z !== -1 &amp;amp;&amp;amp; treg[order.z] !== undefined) {
					resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z]);
				}


				return resTime;
			}
			return false;
		};// end strictParse

		// First try JS Date, if that fails, use strictParse
		var looseParse = function(f,s,o){
			try{
				var d = new Date('2012-01-01 '+ s);
				if(isNaN(d.getTime())){
					d = new Date('2012-01-01T'+ s);
					if(isNaN(d.getTime())){
						d = new Date('01/01/2012 '+ s);
						if(isNaN(d.getTime())){
							throw "Unable to parse time with native Date: "+ s;
						}
					}
				}

				return {
					hour: d.getHours(),
					minute: d.getMinutes(),
					second: d.getSeconds(),
					millisec: d.getMilliseconds(),
					microsec: d.getMicroseconds(),
					timezone: d.getTimezoneOffset()*-1
				};
			}
			catch(err){
				try{
					return strictParse(f,s,o);
				}
				catch(err2){
					$.timepicker.log("Unable to parse \ntimeString: "+ s +"\ntimeFormat: "+ f);
				}				
			}
			return false;
		}; // end looseParse
		
		if(typeof o.parse === "function"){
			return o.parse(timeFormat, timeString, o);
		}
		if(o.parse === 'loose'){
			return looseParse(timeFormat, timeString, o);
		}
		return strictParse(timeFormat, timeString, o);
	};

	/*
	* Public utility to format the time
	* format = string format of the time
	* time = a {}, not a Date() for timezones
	* options = essentially the regional[].. amNames, pmNames, ampm
	*/
	$.datepicker.formatTime = function(format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			timezone: 0
		}, time);

		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);

		if (hour &amp;gt; 11) {
			ampmName = options.pmNames[0];
		}

		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|('.*?'|".*?"))/g, function(match) {
		switch (match) {
			case 'HH':
				return ('0' + hour).slice(-2);
			case 'H':
				return hour;
			case 'hh':
				return ('0' + convert24to12(hour)).slice(-2);
			case 'h':
				return convert24to12(hour);
			case 'mm':
				return ('0' + time.minute).slice(-2);
			case 'm':
				return time.minute;
			case 'ss':
				return ('0' + time.second).slice(-2);
			case 's':
				return time.second;
			case 'l':
				return ('00' + time.millisec).slice(-3);
			case 'c':
				return ('00' + time.microsec).slice(-3);
			case 'z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, false);
			case 'Z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, true);
			case 'T': 
				return ampmName.charAt(0).toUpperCase();
			case 'TT': 
				return ampmName.toUpperCase();
			case 't':
				return ampmName.charAt(0).toLowerCase();
			case 'tt':
				return ampmName.toLowerCase();
			default:
				return match.replace(/\'/g, "") || "'";
			}
		});

		tmptime = $.trim(tmptime);
		return tmptime;
	};

	/*
	* the bad hack :/ override datepicker so it doesnt close on select
	// inspired: http://stackoverflow.com/questions/1252512/jquery-datepicker-prevent-closing-picker-when-clicking-a-date/1762378#1762378
	*/
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function(id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			tp_inst._limitMinMaxDateTime(inst, true);
			inst.inline = inst.stay_open = true;
			//This way the onSelect handler called from calendarpicker get the full dateTime
			this._base_selectDate(id, dateStr);
			inst.inline = inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst);
		} else {
			this._base_selectDate(id, dateStr);
		}
	};

	/*
	* second bad hack :/ override datepicker so it triggers an event when changing the input field
	* and does not redraw the datepicker on every selectDate event
	*/
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function(inst) {

		// don't popup the datepicker if there is another instance already opened
		var input = inst.input[0];
		if ($.datepicker._curInst &amp;amp;&amp;amp; $.datepicker._curInst != inst &amp;amp;&amp;amp; $.datepicker._datepickerShowing &amp;amp;&amp;amp; $.datepicker._lastInput != input) {
			return;
		}

		if (typeof(inst.stay_open) !== 'boolean' || inst.stay_open === false) {

			this._base_updateDatepicker(inst);

			// Reload the time control when changing something in the input text field.
			var tp_inst = this._get(inst, 'timepicker');
			if (tp_inst) {
				tp_inst._addTimePicker(inst);
			}
		}
	};

	/*
	* third bad hack :/ override datepicker so it allows spaces and colon in the input field
	*/
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if ($.datepicker._get(inst, 'constrainInput')) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null? tp_inst._defaults.showTimezone : tp_inst.support.timezone,					
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat')),
					datetimeChars = tp_inst._defaults.timeFormat.toString()
											.replace(/[hms]/g, '')
											.replace(/TT/g, ampm ? 'APM' : '')
											.replace(/Tt/g, ampm ? 'AaPpMm' : '')
											.replace(/tT/g, ampm ? 'AaPpMm' : '')
											.replace(/T/g, ampm ? 'AP' : '')
											.replace(/tt/g, ampm ? 'apm' : '')
											.replace(/t/g, ampm ? 'ap' : '') + 
											" " + tp_inst._defaults.separator + 
											tp_inst._defaults.timeSuffix + 
											(tz ? tp_inst._defaults.timezoneList.join('') : '') + 
											(tp_inst._defaults.amNames.join('')) + (tp_inst._defaults.pmNames.join('')) + 
											dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr &amp;lt; ' ' || !dateChars || datetimeChars.indexOf(chr) &amp;gt; -1);
			}
		}

		return $.datepicker._base_doKeyPress(event);
	};

	/*
	* Fourth bad hack :/ override _updateAlternate function used in inline mode to init altField
	*/
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	/* Update any alternate field to synchronise with the main field. */
	$.datepicker._updateAlternate = function(inst) {
		var tp_inst = this._get(inst, 'timepicker');
		if(tp_inst){
			var altField = tp_inst._defaults.altField;
			if (altField) { // update alternate field too
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = '', 
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator, 
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if(!tp_inst._defaults.timeOnly &amp;amp;&amp;amp; !tp_inst._defaults.altFieldTimeOnly &amp;amp;&amp;amp; date !== null){
					if(tp_inst._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime;
					}
					else{
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime;
					}
				}
				$(altField).val(altFormattedDateTime);
			}
		}
		else{
			$.datepicker._base_updateAlternate(inst);
		}
	};

	/*
	* Override key up event to sync manual input changes.
	*/
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst);
				} catch (err) {
					$.timepicker.log(err);
				}
			}
		}

		return $.datepicker._base_doKeyUp(event);
	};

	/*
	* override "Today" button to also grab the time.
	*/
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function(id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		this._base_gotoToday(id);
		var tp_inst = this._get(inst, 'timepicker');
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		$('.ui-datepicker-today', $dp).click();
	};

	/*
	* Disable &amp;amp; enable the Time in the datetimepicker
	*/
	$.datepicker._disableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst);
		}
	};

	$.datepicker._enableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst); // Could be disabled on page load
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create our own set time function
	*/
	$.datepicker._setTime = function(inst, date) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var defaults = tp_inst._defaults;

			// calling _setTime with no date sets time to defaults
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;

			//check if within min/max times.. 
			tp_inst._limitMinMaxDateTime(inst, true);

			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create new public method to set only time, callable as $().datepicker('setTime', date)
	*/
	$.datepicker._setTimeDatepicker = function(target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date == "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec);
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds());
				}
				if (tp_date.toString() == 'Invalid Date') {
					tp_date = undefined;
				}
				this._setTime(inst, tp_date);
			}
		}

	};

	/*
	* override setDate() to allow setting time too within Date object
	*/
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function(target, date) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		if(typeof(date) === 'string'){
			date = new Date(date);
			if(!date.getTime()){
				$.timepicker.log("Error creating Date object from string.");
			}
		}

		var tp_inst = this._get(inst, 'timepicker');
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds());
		} else {
			tp_date = date;
		}
		
		// This is important if you are using the timezone option, javascript's Date 
		// object will only return the timezone offset for the current locale, so we 
		// adjust it accordingly.  If not using timezone option this won't matter..
		// If a timezone is different in tp, keep the timezone as is
		if(tp_inst){
			// look out for DST if tz wasn't specified
			if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
				tp_inst.timezone = tp_date.getTimezoneOffset()*-1;
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone);
		}

		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true);
	};

	/*
	* override getDate() to allow getting time too within Date object
	*/
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function(target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			// if it hasn't yet been defined, grab from field
			if(inst.lastVal === undefined){
				this._setDateFromField(inst, noDefault);
			}

			var date = this._getDate(inst);
			if (date &amp;amp;&amp;amp; tp_inst._parseTime($(target).val(), tp_inst.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);

				// This is important if you are using the timezone option, javascript's Date 
				// object will only return the timezone offset for the current locale, so we 
				// adjust it accordingly.  If not using timezone option this won't matter..
				if(tp_inst.timezone != null){
					// look out for DST if tz wasn't specified
					if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
						tp_inst.timezone = date.getTimezoneOffset()*-1;
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
				}
			}
			return date;
		}
		return this._base_getDateDatepicker(target, noDefault);
	};

	/*
	* override parseDate() because UI 1.8.14 throws an error about "Extra characters"
	* An option in datapicker to ignore extra format characters would be nicer.
	*/
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function(format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings);
		} catch (err) {
			// Hack!  The error message ends with a colon, a space, and
			// the "extra" characters.  We rely on that instead of
			// attempting to perfectly reproduce the parsing algorithm.
			if (err.indexOf(":") &amp;gt;= 0) {
				date = this._base_parseDate(format, value.substring(0,value.length-(err.length-err.indexOf(':')-2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format);
			} else {
				throw err;
			}
		}
		return date;
	};

	/*
	* override formatDate to set date with time to the input
	*/
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function(inst, day, month, year) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val();
		}
		return this._base_formatDate(inst);
	};

	/*
	* override options setter to add time to maxDate(Time) and minDate(Time). MaxDate
	*/
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function(target, name, value) {
		var inst = this._getInst(target),
	        name_clone;
		if (!inst) {
			return null;
		}

		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop;
		    if (typeof name == 'string') { // if min/max was set with the string
		        if (name === 'minDate' || name === 'minDateTime') {
		            min = value;
		        } else if (name === 'maxDate' || name === 'maxDateTime') {
		            max = value;
		        } else if (name === 'onSelect') {
		            onselect = value;
		        } else if (overrides.hasOwnProperty(name)) {
		            if (typeof (value) === 'undefined') {
		                return overrides[name];
		            }
		            fns[name] = value;
		            name_clone = {}; //empty results in exiting function after overrides updated
		        }
		    } else if (typeof name == 'object') { //if min/max was set with the JSON
		        if (name.minDate) {
		            min = name.minDate;
		        } else if (name.minDateTime) {
		            min = name.minDateTime;
		        } else if (name.maxDate) {
		            max = name.maxDate;
		        } else if (name.maxDateTime) {
		            max = name.maxDateTime;
		        }
		        for (prop in overrides) {
		            if (overrides.hasOwnProperty(prop) &amp;amp;&amp;amp; name[prop]) {
		                fns[prop] = name[prop];
		            }
		        }
		    }
		    for (prop in fns) {
		        if (fns.hasOwnProperty(prop)) {
		            overrides[prop] = fns[prop];
		            if (!name_clone) { name_clone = $.extend({}, name);}
		            delete name_clone[prop];
		        }
		    }
		    if (name_clone &amp;amp;&amp;amp; isEmptyObject(name_clone)) { return; }
		    if (min) { //if min was set
		        if (min === 0) {
		            min = new Date();
		        } else {
		            min = new Date(min);
		        }
		        tp_inst._defaults.minDate = min;
		        tp_inst._defaults.minDateTime = min;
		    } else if (max) { //if max was set
		        if (max === 0) {
		            max = new Date();
		        } else {
		            max = new Date(max);
		        }
		        tp_inst._defaults.maxDate = max;
		        tp_inst._defaults.maxDateTime = max;
		    } else if (onselect) {
		        tp_inst._defaults.onSelect = onselect;
		    }
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name);
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
	};
	
	/*
	* jQuery isEmptyObject does not check hasOwnProperty - if someone has added to the object prototype,
	* it will return false for all objects
	*/
	var isEmptyObject = function(obj) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(obj)) {
				return false;
			}
		}
		return true;
	};

	/*
	* jQuery extend now ignores nulls!
	*/
	var extendRemove = function(target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] === null || props[name] === undefined) {
				target[name] = props[name];
			}
		}
		return target;
	};

	/*
	* Determine by the time format which units are supported
	* Returns an object of booleans for each unit
	*/
	var detectSupport = function(timeFormat){
		var tf = timeFormat.replace(/\'.*?\'/g,'').toLowerCase(), // removes literals
			isIn = function(f, t){ // does the format contain the token?
					return f.indexOf(t) !== -1? true:false; 
				};
		return {
				hour: isIn(tf,'h'),
				minute: isIn(tf,'m'),
				second: isIn(tf,'s'),
				millisec: isIn(tf,'l'),
				microsec: isIn(tf,'c'),
				timezone: isIn(tf,'z'),
				ampm: isIn(tf,'t') &amp;amp;&amp;amp; isIn(timeFormat,'h'),
				iso8601: isIn(timeFormat, 'Z')
			};
	};

	/*
	* Converts 24 hour format into 12 hour
	* Returns 12 hour without leading 0
	*/
	var convert24to12 = function(hour) {
		if (hour &amp;gt; 12) {
			hour = hour - 12;
		}

		if (hour === 0) {
			hour = 12;
		}

		return String(hour);
	};

	/*
	* Splits datetime string into date ans time substrings.
	* Throws exception when date can't be parsed
	* Returns [dateString, timeString]
	*/
	var splitDateTime = function(dateFormat, dateTimeString, dateSettings, timeSettings) {
		try {
			// The idea is to get the number separator occurances in datetime and the time format requested (since time has 
			// fewer unknowns, mostly numbers and am/pm). We will use the time pattern to split.
			var separator = timeSettings &amp;amp;&amp;amp; timeSettings.separator ? timeSettings.separator : $.timepicker._defaults.separator,
				format = timeSettings &amp;amp;&amp;amp; timeSettings.timeFormat ? timeSettings.timeFormat : $.timepicker._defaults.timeFormat,
				timeParts = format.split(separator), // how many occurances of separator may be in our format?
				timePartsLen = timeParts.length,
				allParts = dateTimeString.split(separator),
				allPartsLen = allParts.length;

			if (allPartsLen &amp;gt; 1) {
				return [
						allParts.splice(0,allPartsLen-timePartsLen).join(separator),
						allParts.splice(0,timePartsLen).join(separator)
					];
			}

		} catch (err) {
			$.timepicker.log('Could not split the date from the time. Please check the following datetimepicker options' +
					"\nthrown error: " + err +
					"\ndateTimeString" + dateTimeString +
					"\ndateFormat = " + dateFormat +
					"\nseparator = " + timeSettings.separator +
					"\ntimeFormat = " + timeSettings.timeFormat);

			if (err.indexOf(":") &amp;gt;= 0) {
				// Hack!  The error message ends with a colon, a space, and
				// the "extra" characters.  We rely on that instead of
				// attempting to perfectly reproduce the parsing algorithm.
				var dateStringLength = dateTimeString.length - (err.length - err.indexOf(':') - 2),
					timeString = dateTimeString.substring(dateStringLength);

				return [$.trim(dateTimeString.substring(0, dateStringLength)), $.trim(dateTimeString.substring(dateStringLength))];

			} else {
				throw err;
			}
		}
		return [dateTimeString, ''];
	};

	/*
	* Internal function to parse datetime interval
	* Returns: {date: Date, timeObj: Object}, where
	*   date - parsed date without time (type Date)
	*   timeObj = {hour: , minute: , second: , millisec: , microsec: } - parsed time. Optional
	*/
	var parseDateTimeInternal = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var date;
		var splitRes = splitDateTime(dateFormat, dateTimeString, dateSettings, timeSettings);
		date = $.datepicker._base_parseDate(dateFormat, splitRes[0], dateSettings);
		if (splitRes[1] !== '') {
			var timeString = splitRes[1],
				parsedTime = $.datepicker.parseTime(timeFormat, timeString, timeSettings);

			if (parsedTime === null) {
				throw 'Wrong time format';
			}
			return {
				date: date,
				timeObj: parsedTime
			};
		} else {
			return {
				date: date
			};
		}
	};

	/*
	* Internal function to set timezone_select to the local timezone
	*/
	var selectLocalTimezone = function(tp_inst, date) {
		if (tp_inst &amp;amp;&amp;amp; tp_inst.timezone_select) {
			var now = typeof date !== 'undefined' ? date : new Date();
			tp_inst.timezone_select.val(now.getTimezoneOffset()*-1);
		}
	};

	/*
	* Create a Singleton Insance
	*/
	$.timepicker = new Timepicker();

	/**
	 * Get the timezone offset as string from a date object (eg '+0530' for UTC+5.5)
	 * @@param  number if not a number this value is returned
	 * @@param boolean if true formats in accordance to iso8601 "+12:45"
	 * @@return string
	 */
	$.timepicker.timezoneOffsetString = function(tzMinutes, iso8601) {
		if(isNaN(tzMinutes) || tzMinutes &amp;gt; 840){
			return tzMinutes;
		}

		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601? ':':'',
			tz = (off &amp;gt;= 0 ? '+' : '-') + ('0' + (hours * 101).toString()).slice(-2) + iso + ('0' + (minutes * 101).toString()).slice(-2);
		
		if(tz == '+00:00'){
			return 'Z';
		}
		return tz;
	};

	/**
	 * Get the number in minutes that represents a timezone string
	 * @@param  string formated like "+0500", "-1245"
	 * @@return number
	 */
	$.timepicker.timezoneOffsetNumber = function(tzString) {
		tzString = tzString.toString().replace(':',''); // excuse any iso8601, end up with "+1245"

		if(tzString.toUpperCase() === 'Z'){ // if iso8601 with Z, its 0 minute offset
			return 0;
		}

		if(!/^(\-|\+)\d{4}$/.test(tzString)){ // possibly a user defined tz, so just give it back
			return tzString;
		}

		return ((tzString.substr(0,1) =='-'? -1 : 1) * // plus or minus
					((parseInt(tzString.substr(1,2),10)*60) + // hours (converted to minutes)
					parseInt(tzString.substr(3,2),10))); // minutes
	};

	/**
	 * No way to set timezone in js Date, so we must adjust the minutes to compensate. (think setDate, getDate)
	 * @@param  date
	 * @@param  string formated like "+0500", "-1245"
	 * @@return date
	 */
	$.timepicker.timezoneAdjust = function(date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if(!isNaN(toTz)){
			date.setMinutes(date.getMinutes()*1 + (date.getTimezoneOffset()*-1 - toTz*1) );
		}
		return date;
	};

	/**
	 * Calls `timepicker()` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * n.b. The input value must be correctly formatted (reformatting is not supported)
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the timepicker() call
	 * @@return jQuery
	 */
	$.timepicker.timeRange = function(startTime, endTime, options) {
		return $.timepicker.handleRange('timepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datetimepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@return jQuery
	 */
	$.timepicker.datetimeRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datetimepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.dateRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.handleRange = function(method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0, // min allowed interval in milliseconds
			maxInterval: 0, // max allowed interval in milliseconds
			start: {},      // options for start picker
			end: {}         // options for end picker
		}, options);

		$.fn[method].call(startTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), endTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), endTime, 'minDate');
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), startTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), startTime, 'maxDate');
			}
		}, options, options.end));

		checkDates(startTime, endTime);
		selected(startTime, endTime, 'minDate');
		selected(endTime, startTime, 'maxDate');

		function checkDates(changed, other) {
			var startdt = startTime[method]('getDate'),
				enddt = endTime[method]('getDate'),
				changeddt = changed[method]('getDate');

			if(startdt !== null){
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());

				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);

				if(options.minInterval &amp;gt; 0 &amp;amp;&amp;amp; minDate &amp;gt; enddt){ // minInterval check
					endTime[method]('setDate',minDate);
				}
				else if(options.maxInterval &amp;gt; 0 &amp;amp;&amp;amp; maxDate &amp;lt; enddt){ // max interval check
					endTime[method]('setDate',maxDate);
				}
				else if (startdt &amp;gt; enddt) {
					other[method]('setDate',changeddt);
				}
			}
		}

		function selected(changed, other, option) {
			if (!changed.val()) {
				return;
			}
			var date = changed[method].call(changed, 'getDate');
			if(date !== null &amp;amp;&amp;amp; options.minInterval &amp;gt; 0){
				if(option == 'minDate'){
					date.setMilliseconds(date.getMilliseconds() + options.minInterval); 
				}
				if(option == 'maxDate'){
					date.setMilliseconds(date.getMilliseconds() - options.minInterval);
				}
			}
			if (date.getTime) {
				other[method].call(other, 'option', option, date);
			}
		}
		return $([startTime.get(0), endTime.get(0)]);
	};

	/**
	 * Log error or data to the console during error or debugging
	 * @@param  Object err pass any type object to log to the console during error or debugging
	 * @@return void
	 */
	$.timepicker.log = function(err){
		if(window.console){
			console.log(err);
		}
	};

	/*
	* Microsecond support
	*/
	if(!Date.prototype.getMicroseconds){
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function(){ return this.microseconds; };
		Date.prototype.setMicroseconds = function(m){ 
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m/1000));
			this.microseconds = m%1000;
			return this;
		};
	}

	/*
	* Keep up with the version
	*/
	$.timepicker.version = "1.3.1";

})(jQuery);
jQuery.noConflict();
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;datetimepicker-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;e73a652e-09fc-4c71-8e7a-e2525a2d2a99&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
function replaceAllString(oriStr, strTarget, strSubString ){
   var strText = oriStr;
   var intIndexOfMatch = strText.indexOf( strTarget );
   while (intIndexOfMatch != -1){
      strText = strText.replace( strTarget, strSubString )
      intIndexOfMatch = strText.indexOf( strTarget );
   }
   return( strText );
}
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&amp;amp;]" + name + "=([^&amp;amp;#]*)"),
    results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
};


   var jobName= getParameterByName('job')
   var fromDate= getParameterByName('fromDate')
   var toDate= getParameterByName('toDate')
   var limit= getParameterByName('limit')
   var selectedIstIid = getParameterByName('IstIid')

  $("#jobname").ready(function(){
   $("#jobname").text(jobName)
   var convertedJobName = replaceAllString(jobName, ".", "_")
   $("#IstIid" + convertedJobName).ready(function(){
     $("#IstIid" + convertedJobName).css("display","block")
     $("#select_" + convertedJobName).ready(function(){
        $("#select_" + convertedJobName).val(selectedIstIid)
     });
   });
 });

  $("#fromDate").ready(function(){
   $("#from-date").val(fromDate)
 });

  $("#toDate").ready(function(){
   $("#to-date").val(toDate)
 });

  $("#limit").ready(function(){
   if(limit!=""){
    $("#limit").val(limit)
   }
 });
 // Get data with ajax
 function ajax_getData(jobName,fromDate,toDate,limit ){
       var convertedJobName = replaceAllString(jobName, ".", "_")
       var istIid = $("#select_" + convertedJobName).val()
       window.location="/xwiki/bin/view/WiperDog/WebHome?job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid="+istIid;
 			/*$.ajax({
			 type: "GET",
			 url:"/xwiki/bin/get/Sandbox/DescriptionForJob?outputSyntax=plain&amp;amp;job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid"+selectedIstIid,
			 success : function(result){
				$("#jobname").html(jobName)
				$("#display").text('[[]]' + result)
			 }
		   });*/
 }
	$("#treemenu2 a").click(function(){
		 var limit = 10
		 var fromDate=""
		 var toDate = ""
		 jobName= $(this).text()
                 $("#jobname").html(jobName)
                 var convertedJobName = replaceAllString(jobName, ".", "_")
                 $("#listIstIid &amp;gt; div").css("display","none")
                 $("#IstIid" + convertedJobName).css("display","block")
		 //ajax_getData(jobName,fromDate,toDate,limit )

	});

	$("#from-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
		dateFormat: 'yy-mm-dd',
	});
	$("#to-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
			dateFormat: 'yy-mm-dd',

	});
	 $("#get-data").on("click",function(){
		var fromDate = $("#from-date").val()
		var toDate =  $("#to-date").val()
		 if( toDate!= "" ){
			  if(fromDate != ""){
				  if($("#from-date").datepicker( "getDate" ) &amp;gt; $("#to-date").datepicker( "getDate" )){
				  alert("'From date' cannot start later than 'To date'")
				  return false
				  }
			  }
		 }
		 limit = $("#limit").val()
		 ajax_getData(jobName,fromDate,toDate,limit )
                 
                 /** Get livetable data */
                 var dataModelUrl = '/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job='+$("#jobname").val()+'&amp;amp;limit='
                     +$("#limit").val()+'&amp;amp;fromDate='
	             +fromDate + '&amp;amp;toDate=' + toDate +   '&amp;amp;pager=pager2&amp;amp;genp=1&amp;amp;istIid='+selectedIstIid

		 var jqxhr = $.getJSON(dataModelUrl, function(data) {
				$("#livetableList").jqGrid(data);
				$("#livetableList").jqGrid('navGrid', "#livetablePager", {
				    edit : false,
				    add : false,
				    del : false
				});
			})
	});
        
jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;process&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;881686cc-1bfc-456e-b8ab-71334c4a45e5&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){

	$(function () {
		function drawLineChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerline' + container).highcharts({

				chart: {
					type:'line'
				},
				title: {
					text: container
				},
				tooltip :{
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				xAxis: dataXAxis ,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				series: dataSeries
			});
		};

		function drawBarChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerbar' + container).highcharts({
				chart: {
					type: 'column'
				},
				title: {
					text: container
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {

					column: {
						pointPadding: 0.2,
						borderWidth: 0
					}
				},
				series: dataSeries
			});
		}

		function drawAreaChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail
			$('#containerarea' + container).highcharts({
				chart: {
					type: 'area'
				},
				title: {
					text: container
				},
				subtitle: {
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					},
					labels: {
						formatter: function() {
							return this.value / 1000;
						}
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {
					area: {
						stacking: 'normal',
						lineColor: '#666666',
						lineWidth: 1,
						marker: {
							lineWidth: 1,
							lineColor: '#666666'
						}
					}
				},
				series: dataSeries
			});
		};

		function drawPieChart(data, container){
			var dataPie = data
			$(document).ready(function () {
				// Build the chart
				$('#container' + container).highcharts({
					chart: {
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: dataPie[0].name
					},
					tooltip: {
						pointFormat: '{series.name}: &amp;lt;b&amp;gt;{point.percentage:.1f}%&amp;lt;/b&amp;gt;'
					},
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							dataLabels: {
								enabled: false
							},
							showInLegend: true
						}
					},
					series: dataPie
				});
			});
		}

		// LINE
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonline_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonline");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Line chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						if(data_all[0][i].series[0].name == null){
							data_all[0][i].series[0].name = lstContainer[0][i]
						}
						drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
					}
				}
			}
		});

		// BAR
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonbar_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw bar chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawBarChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonbar");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Bar chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						drawBarChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
					}
				}
			}
		});

		// AREA
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonarea_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawAreaChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonarea");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				// data to display on tooltip
				var data_detail = data_all[0]
				// draw Area Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					drawAreaChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
				}
			}
		});

		// PIE
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonpie_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerpie");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						// draw Pie Chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							var finalData = []
							finalData[0] = data_all[0][i]
							drawPieChart(finalData, finalKey + "_" + lstContainer[0][i])
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonpie");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerpie");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					// draw Pie Chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						var finalData = []
						finalData[0] = data_all[0][i]
						drawPieChart(finalData, lstContainer[0][i])
					}
				}
			}
		});
	});
	jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;d5873d92-b78b-42fc-9407-46d166204b88&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;/* css for timepicker */
.ui-timepicker-div .ui-widget-header { 
margin-bottom: 8px;
 }

.ui-timepicker-div dl { text-align: left; }
.ui-timepicker-div dl dt { height: 25px; margin-bottom: -25px; }
.ui-timepicker-div dl dd { margin: 0 10px 10px 65px; }
.ui-timepicker-div td { font-size: 90%; }
.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }

.ui-timepicker-rtl{ direction: rtl; }
.ui-timepicker-rtl dl { text-align: right; }
.ui-timepicker-rtl dl dd { margin: 0 65px 10px 10px; }
#ui-datepicker-div{
 position:relative;
 width:auto;
 height:auto
}
&lt;/code&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;datetimepicker -css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;1201fb1a-e9c1-4731-8c74-2ea8c0071959&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;.displayblock {
  border:2px solid;
  -webkit-border-radius:6px;
  background:gray;
  float: left;
  width:100%;
}

.displaypie {
  border:1px solid;
  -webkit-border-radius:6px;
  background:gray;
  width: 48%;
  float: left; 
  height: 300px;
}

.subtype {
  margin-top: 50px;
  font-size: 2em;
  color: red;
}&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;content&gt;{{include document="Lib.DataToDrawChart"/}}
{{include document="Lib.MongoDBConnection"/}}
{{velocity}}
$xwiki.jsx.use('Lib.JQueryUILib')
$xwiki.ssx.use('Lib.MenuGenerator')
$xwiki.jsx.use('Lib.MenuGenerator')
$xwiki.ssx.use('Lib.JQueryUILib')
{{/velocity}}
{{include document="Lib.MenuGenerator"/}}
{{html wiki="true" clean="false"}}
&amp;lt;div id="viewer"&amp;gt;
&amp;lt;table style="text-align:left"  &amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th &amp;gt;Job name&amp;lt;/th&amp;gt;
  &amp;lt;td colspan=3&amp;gt;&amp;lt;div id="jobname"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
{{groovy}}
import org.xwiki.context.*

def ec = services.component.getInstance(Execution.class).getContext()
def mapJobIstIid = ec.getProperty("mapJobIstIid")

println '{{html clean="false" wiki="false"}}'
println '&amp;lt;tr&amp;gt;'
println '&amp;lt;th&amp;gt;IstIid&amp;lt;/th&amp;gt;'
println '&amp;lt;td colspan=3&amp;gt;'
mapJobIstIid.each{jobEntry-&amp;gt;
  def convertedJobKey = jobEntry.key.replaceAll("\\.","_")
  println "&amp;lt;div id='listIstIid'&amp;gt;"
  println "&amp;lt;div id=IstIid${convertedJobKey} style='display:none'&amp;gt;"
  println "&amp;lt;select id=select_${convertedJobKey}&amp;gt;"
  jobEntry.value.each{
     println "&amp;lt;option value=\"$it\"&amp;gt;$it&amp;lt;/option&amp;gt;"
  }
  println "&amp;lt;/select&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
}
println '&amp;lt;/td&amp;gt;'
println '&amp;lt;/tr&amp;gt;'
println '{{/html}}'
{{/groovy}}
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data monitor from&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="from-date" id="from-date"/&amp;gt;&amp;lt;/td&amp;gt;
  &amp;lt;th&amp;gt;Data monitor to&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="to-date" id="to-date"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data records limit &amp;lt;/th&amp;gt;
  &amp;lt;td &amp;gt;
     &amp;lt;select id="limit"&amp;gt;
       &amp;lt;option value=5&amp;gt;5&amp;lt;/option&amp;gt;
       &amp;lt;option value=10&amp;gt;10&amp;lt;/option&amp;gt;
       &amp;lt;option value=15&amp;gt;15&amp;lt;/option&amp;gt;
       &amp;lt;option value=20&amp;gt;20&amp;lt;/option&amp;gt;
     &amp;lt;/select&amp;gt;
  &amp;lt;/td&amp;gt;
  &amp;lt;td colspan=3 &amp;gt;&amp;lt;input type="button" value="View Data" id="get-data" class="button"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt; 
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;&amp;lt;div id="display"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
&amp;lt;/table&amp;gt;

&amp;lt;/div&amp;gt; 
 &amp;lt;table style="text-align:left"  &amp;gt;
	&amp;lt;tr&amp;gt;
		&amp;lt;td&amp;gt;
 			Begin livetable
 		&amp;lt;/td&amp;gt;
 		&amp;lt;td&amp;gt;
 			&amp;lt;table id="livetableList"&amp;gt;&amp;lt;/table&amp;gt;
 			&amp;lt;div id="livetablePager"&amp;gt;Begin livetable&amp;lt;/div&amp;gt;
 		&amp;lt;/td&amp;gt; 	
 	&amp;lt;/tr&amp;gt;
 &amp;lt;/table&amp;gt;
 &amp;lt;/body&amp;gt;
{{/html}}
{{groovy}}
import groovy.json.*
xwiki.jsx.use("Lib.Highcharts")

if(request.xpage == "plain") {
	response.setContentType('text/plain')
}

def listData = []
def job = request.get("job")
def fromDate = request.get("fromDate")
def toDate = request.get("toDate")
def limit= (request.get("limit")!=null)?request.get("limit").toInteger():10
def istIid = request.get("IstIid")

def str= "No data to retrieved !"
def result = null
if(job != "" &amp;amp;&amp;amp; job != null &amp;amp;&amp;amp; istIid != null &amp;amp;&amp;amp; istIid != ""){
	MongoDBConnection.getConnection()
	if(fromDate != "" || toDate != ""){
		result = MongoDBConnection.getDataInPeriod(job,fromDate,toDate,limit,istIid)
	} else {
		result = MongoDBConnection.getDataAllFields(job,limit,istIid)
        }
MongoDBConnection.closeConnection()
} else {
   println "{{warning}}There are no selected job or IstIid{{/warning}}"
}

if( (result != null) &amp;amp;&amp;amp; (result.size() &amp;gt; 0) &amp;amp;&amp;amp; (result[0].KEYEXPR != null)&amp;amp;&amp;amp;!(result[0].KEYEXPR instanceof List )){
if(result[0].type == "Subtyped") {
    println '{{html clean="false" wiki="true"}}'
    //println '&amp;lt;body&amp;gt;'
    def dataSubtype = DataToDrawChart.getDataToDrawSubtype(result)
    def listKey = []
    dataSubtype.each {key,value -&amp;gt;
        listKey.add(key)
    }
    def jsonkey = com.mongodb.util.JSON.serialize(listKey)
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$jsonkey&amp;lt;/textarea&amp;gt;"

    dataSubtype.each {key,value -&amp;gt;
        println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +'&amp;lt;/div&amp;gt;'
        println "-----"
        def dataLine = []
        def dataBar = []
        def dataPie = []
        def dataArea = []
        if(DataToDrawChart.getDataToDrawLine(value) != []) {
            dataLine = DataToDrawChart.getDataToDrawLine(value)
        }
        if(DataToDrawChart.getDataToDrawBar(value) != []) {
            dataBar = DataToDrawChart.getDataToDrawBar(value)
        }
        if(DataToDrawChart.getDataToDrawPie(value) != []) {
            dataPie = DataToDrawChart.getDataToDrawPie(value)
        }
        if(DataToDrawChart.getDataToDrawArea(value) != []) {
            dataArea = DataToDrawChart.getDataToDrawArea(value)
        }

        def chartColumnsLine
        def chartColumnsBar 
        def chartColumnsArea 
        def lstName
        if(dataLine.size() &amp;gt; 0 ){
            chartColumnsLine = dataLine[0].chart_columns
        }
        if(dataBar.size() &amp;gt; 0){
            chartColumnsBar = dataBar[0].chart_columns
        }
        if(dataArea.size() &amp;gt; 0 ){
            chartColumnsArea = dataArea[0].chart_columns
        }
        if(dataPie.size() &amp;gt; 0 ){
            lstName = dataPie['name']
        }

        def tmpListNameContainer = []
	for(def nameContainer in lstName){
	   nameContainer = nameContainer.replaceAll("\\.", "_")
	   tmpListNameContainer.add(nameContainer)
	}
        def jsonPie
        def jsonLine
	def jsonBar
        def jsonArea
        if(dataPie != []) {
	    jsonPie = com.mongodb.util.JSON.serialize(dataPie)
        }
        if(dataLine != []) {
	    jsonLine = com.mongodb.util.JSON.serialize(dataLine)
        }
        if(dataBar != []) {
            jsonBar = com.mongodb.util.JSON.serialize(dataBar)
        }
        if(dataArea != []) {
	    jsonArea = com.mongodb.util.JSON.serialize(dataArea)
        }

	def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
	def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
	def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
	def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

	println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
        if(jsonLine != null) {
	    println "&amp;lt;textarea id=\"jsonline_$key\" &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;" 
        }
	if(jsonBar != null) {
            println "&amp;lt;textarea id=\"jsonbar_$key\"&amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
 	    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
        }
        if(jsonPie != null) {
	    println "&amp;lt;textarea id=\"jsonpie_$key\" &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
        }
        if(jsonArea != null) {
	    println "&amp;lt;textarea id=\"jsonarea_$key\" &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"
	    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
        }

	println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
	println "&amp;lt;input style=\"display:none\" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;"
	println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
	println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'
	println "&amp;lt;/div&amp;gt;"
	  
	def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
	def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
	  
	println "&amp;lt;div style='clear:both'&amp;gt;"
        if(jsonPie != null) {
	  println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
	  lstName.each{
	    def tmp = it.replaceAll("\\.", "_")
	    println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
        if(jsonLine != null) {
	  def chartLineComment = false
	  chartColumnsLine.each{
	    if(!chartLineComment){
	       println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	       chartLineComment = true  
	    }

	      println " &amp;lt;div class=\"displayblock\" id=\"containerline${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
        println "&amp;amp;nbsp;"

        if(jsonBar != null) {
	  def chartBarComment = false
	  chartColumnsBar.each{
	     if(!chartBarComment){
	        println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	        chartBarComment = true
	      }  

	     println " &amp;lt;div class=\"displayblock\" id=\"containerbar${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
	println "&amp;amp;nbsp;"

        if(jsonArea != null) {
	  def chartAreaComment = false
	  chartColumnsArea.each{
	  if(!chartAreaComment){
	    println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	    chartAreaComment = true
	  }
	    println " &amp;lt;div class=\"displayblock\" id=\"containerarea${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
	println "&amp;lt;/div&amp;gt;"
        
    }
    println '&amp;lt;/body&amp;gt;'
    println '{{/html}}'
} else if(result[0].type == "Store") {
    // data store
    def dataLine = DataToDrawChart.getDataToDrawLine(result)
    def dataBar = DataToDrawChart.getDataToDrawBar(result)
    def dataPie = DataToDrawChart.getDataToDrawPie(result)
    def dataArea = DataToDrawChart.getDataToDrawArea(result)
    def chartColumnsLine 
    def chartColumnsBar 
    def chartColumnsArea 
    def lstName 

    if(dataLine.size() &amp;gt; 0 ){
        chartColumnsLine = dataLine[0].chart_columns
    }
    if(dataBar.size() &amp;gt; 0){
        chartColumnsBar = dataBar[0].chart_columns
    }
    if(dataArea.size() &amp;gt; 0 ){
        chartColumnsArea = dataArea[0].chart_columns
    }
    if(dataPie.size() &amp;gt; 0 ){
        lstName = dataPie['name']
    }

    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
  
    def tmpListNameContainer = []
    for(def nameContainer in lstName){
       nameContainer = nameContainer.replaceAll("\\.", "_")
       tmpListNameContainer.add(nameContainer)
    }
  
    def jsonPie = com.mongodb.util.JSON.serialize(dataPie)
    def jsonLine = com.mongodb.util.JSON.serialize(dataLine)
    def jsonBar = com.mongodb.util.JSON.serialize(dataBar)
    def jsonArea = com.mongodb.util.JSON.serialize(dataArea)

    def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
    def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
    def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
    def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

    def listEmpty = com.mongodb.util.JSON.serialize([])
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$listEmpty&amp;lt;/textarea&amp;gt;" 

    println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'

    println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
    println "&amp;lt;textarea class='jsonline' &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonbar' &amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonpie' &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonarea' &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"

    println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
  
    def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
    def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
  
    println "&amp;lt;div style='clear:both'&amp;gt;"
  
    def chartPieComment = false
    lstName.each{
        if(!chartPieComment) {
            println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
            chartPieComment = true
        }
        def tmp = it.replaceAll("\\.", "_")
        println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    def chartLineComment = false
    chartColumnsLine.each{
    if(!chartLineComment){
        println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
        chartLineComment = true  
    }

    println " &amp;lt;div class=\"displayblock\" id=\"containerline$it\"&amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    println "&amp;amp;nbsp;"
    def chartBarComment = false
    chartColumnsBar.each{
        if(!chartBarComment){
            println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
            chartBarComment = true
        }  

    println " &amp;lt;div class=\"displayblock\" id=\"containerbar$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
  println "&amp;lt;/div&amp;gt;"
  println "&amp;amp;nbsp;"
  def chartAreaComment = false
  chartColumnsArea.each{
  if(!chartAreaComment){
    println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
    chartAreaComment = true
  }
    println " &amp;lt;div class=\"displayblock\" id=\"containerarea$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
  println "&amp;lt;/div&amp;gt;"
println "&amp;lt;/div&amp;gt;"

println '&amp;lt;/body&amp;gt;'
println '{{/html}}'
}
}else{
    println 'There is no data for this job with criterias'
}
{{/groovy}}&lt;/content&gt;&lt;/xwikidoc&gt;
@


34.4
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376375480000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376374959000&lt;/contentUpdateDate&gt;
&lt;version&gt;34.4&lt;/version&gt;
d3215 1
a3215 1
 			&amp;lt;div id="livetablePager"&amp;gt;&amp;lt;/div&amp;gt;
@


34.3
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376375385000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;34.3&lt;/version&gt;
d2534 5
a2538 5
$(function () {
    function drawLineChart(xAxis, series, container, data_detail){
        var dataXAxis = xAxis
        var dataSeries = series
        var detail = data_detail
d2792 1
a2792 1
						// draw Line chart
d2797 1
a2797 1
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
d2843 1
a2843 1
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
d2866 22
a2887 18
		$("#piechart").ready(function(){

			var array = $("#jsons&amp;gt;.jsonpie");
			var arrayContainer = $("#jsons&amp;gt;.lstcontainerpie");
			var lstContainer = [];
			var data_all = [];
			for(var i=0;i&amp;lt;array.length;i++){
				data_all[i] = jQuery.parseJSON(array[i].value)
				lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)

			}
			if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
				// data to display on tooltip
				// draw Pie Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					var finalData = []
					finalData[0] = data_all[0][i]
					drawPieChart(finalData, lstContainer[0][i])
d2889 18
@


34.2
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376375030000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;34.2&lt;/version&gt;
d2425 3
a2427 2
                 alert('selectedIstIid '+selectedIstIid)
                 buildLivetable($("#jobname").val(),$("#limit").val(),fromDate ,toDate, selectedIstIid);
d2429 8
d2438 1
a2438 14
        function buildLivetable(jobName, limit, fromDate, toDate, istIid){      		
		var dataModelUrl = '/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job='+jobName +'&amp;amp;limit='+limit+'&amp;amp;fromDate='
                +fromDate + '&amp;amp;toDate=' + toDate +   '&amp;amp;pager=pager2&amp;amp;genp=1&amp;amp;istIid=localhost-information_schema'

		var jqxhr = $.getJSON(dataModelUrl, function(data) {
			$("#livetableList").jqGrid(data);
			$("#livetableList").jqGrid('navGrid', "#livetablePager", {
			    edit : false,
			    add : false,
			    del : false
			});
		})
        }//end function

@


34.1
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376374965000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;34.1&lt;/version&gt;
d21 1
a21 1
&lt;minorEdit&gt;false&lt;/minorEdit&gt;
d2425 1
@


33.5
log
@@
text
@&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xwikidoc&gt;
&lt;web&gt;WiperDog&lt;/web&gt;
&lt;name&gt;WebHome&lt;/name&gt;
&lt;language&gt;&lt;/language&gt;
&lt;defaultLanguage&gt;en&lt;/defaultLanguage&gt;
&lt;translation&gt;0&lt;/translation&gt;
&lt;parent&gt;&lt;/parent&gt;
&lt;creator&gt;XWiki.Admin&lt;/creator&gt;
&lt;author&gt;XWiki.Admin&lt;/author&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;contentAuthor&gt;XWiki.Admin&lt;/contentAuthor&gt;
&lt;creationDate&gt;1376364375000&lt;/creationDate&gt;
&lt;date&gt;1376374959000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376374959000&lt;/contentUpdateDate&gt;
&lt;version&gt;33.5&lt;/version&gt;
&lt;title&gt;WiperDog&lt;/title&gt;
&lt;defaultTemplate&gt;&lt;/defaultTemplate&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;comment&gt;&lt;/comment&gt;
&lt;minorEdit&gt;true&lt;/minorEdit&gt;
&lt;syntaxId&gt;xwiki/2.1&lt;/syntaxId&gt;
&lt;hidden&gt;false&lt;/hidden&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;047293a8-524d-45e4-af52-cd944523d5d0&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
/*
 * jQuery timepicker addon
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 1.3.1
 * Last Modified: 07/07/2013
 *
 * Copyright 2013 Trent Richardson
 * You may use this project under MIT or GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 */

/*jslint evil: true, white: false, undef: false, nomen: false */

(function($) {

	/*
	* Lets not redefine timepicker, Prevent "Uncaught RangeError: Maximum call stack size exceeded"
	*/
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return;
	}

	/*
	* Extend jQueryUI, get it started with our version number
	*/
	$.extend($.ui, {
		timepicker: {
			version: "1.3.1"
		}
	});

	/* 
	* Timepicker manager.
	* Use the singleton instance of this class, $.timepicker, to interact with the time picker.
	* Settings for (groups of) time pickers are maintained in an instance object,
	* allowing multiple different settings on the same page.
	*/
	var Timepicker = function() {
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[''] = { // Default regional settings
			currentText: 'Now',
			closeText: 'Done',
			amNames: ['AM', 'A'],
			pmNames: ['PM', 'P'],
			timeFormat: 'HH:mm',
			timeSuffix: '',
			timeOnlyTitle: 'Choose Time',
			timeText: 'Time',
			hourText: 'Hour',
			minuteText: 'Minute',
			secondText: 'Second',
			millisecText: 'Millisecond',
			microsecText: 'Microsecond',
			timezoneText: 'Time Zone',
			isRTL: false
		};
		this._defaults = { // Global defaults for all the datetime picker instances
			showButtonPanel: true,
			timeOnly: false,
			showHour: null,
			showMinute: null,
			showSecond: null,
			showMillisec: null,
			showMicrosec: null,
			showTimezone: null,
			showTime: true,
			stepHour: 1,
			stepMinute: 1,
			stepSecond: 1,
			stepMillisec: 1,
			stepMicrosec: 1,
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null,
			hourMin: 0,
			minuteMin: 0,
			secondMin: 0,
			millisecMin: 0,
			microsecMin: 0,
			hourMax: 23,
			minuteMax: 59,
			secondMax: 59,
			millisecMax: 999,
			microsecMax: 999,
			minDateTime: null,
			maxDateTime: null,
			onSelect: null,
			hourGrid: 0,
			minuteGrid: 0,
			secondGrid: 0,
			millisecGrid: 0,
			microsecGrid: 0,
			alwaysSetTime: true,
			separator: ' ',
			altFieldTimeOnly: true,
			altTimeFormat: null,
			altSeparator: null,
			altTimeSuffix: null,
			pickerTimeFormat: null,
			pickerTimeSuffix: null,
			showTimepicker: true,
			timezoneList: null,
			addSliderAccess: false,
			sliderAccessArgs: null,
			controlType: 'slider',
			defaultValue: null,
			parse: 'strict'
		};
		$.extend(this._defaults, this.regional['']);
	};

	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: '',
		formattedDate: '',
		formattedTime: '',
		formattedDateTime: '',
		timezoneList: null,
		units: ['hour','minute','second','millisec', 'microsec'],
		support: {},
		control: null,

		/* 
		* Override the default settings for all instances of the time picker.
		* @@param  settings  object - the new settings to use as defaults (anonymous object)
		* @@return the manager object
		*/
		setDefaults: function(settings) {
			extendRemove(this._defaults, settings || {});
			return this;
		},

		/*
		* Create a new Timepicker instance
		*/
		_newInst: function($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
            	fns = {},
		    	overrides, i;

			for (var attrName in this._defaults) {
				if(this._defaults.hasOwnProperty(attrName)){
					var attrValue = $input.attr('time:' + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue);
						} catch (err) {
							inlineSettings[attrName] = attrValue;
						}
					}
				}
			}

		    overrides = {
		        beforeShow: function (input, dp_inst) {
		            if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
		                return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst);
		            }
		        },
		        onChangeMonthYear: function (year, month, dp_inst) {
		            // Update the time as well : this prevents the time from disappearing from the $input field.
		            tp_inst._updateDateTime(dp_inst);
		            if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
		                tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst);
		            }
		        },
		        onClose: function (dateText, dp_inst) {
		            if (tp_inst.timeDefined === true &amp;amp;&amp;amp; $input.val() !== '') {
		                tp_inst._updateDateTime(dp_inst);
		            }
		            if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
		                tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst);
		            }
		        }
		    };
		    for (i in overrides) {
		        if (overrides.hasOwnProperty(i)) {
		            fns[i] = opts[i] || null;
		        }
		    }

		    tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
		        evnts:fns,
		        timepicker: tp_inst // add timepicker as a property of datepicker: $.datepicker._get(dp_inst, 'timepicker');
		    });
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function(val) {
				return val.toUpperCase();
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function(val) {
				return val.toUpperCase();
			});

			// detect which units are supported
			tp_inst.support = detectSupport(
					tp_inst._defaults.timeFormat + 
					(tp_inst._defaults.pickerTimeFormat? tp_inst._defaults.pickerTimeFormat:'') + 
					(tp_inst._defaults.altTimeFormat? tp_inst._defaults.altTimeFormat:''));

			// controlType is string - key to our this._controls
			if(typeof(tp_inst._defaults.controlType) === 'string'){
				if(tp_inst._defaults.controlType == 'slider' &amp;amp;&amp;amp; typeof(jQuery.ui.slider) === 'undefined'){
					tp_inst._defaults.controlType = 'select';
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType];
			}
			// controlType is an object and must implement create, options, value methods
			else{ 
				tp_inst.control = tp_inst._defaults.controlType;
			}

			// prep the timezone options
			var timezoneList = [-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,
					0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList;
			}
			var tzl=timezoneList.length,tzi=0,tzv=null;
			if (tzl &amp;gt; 0 &amp;amp;&amp;amp; typeof timezoneList[0] !== 'object') {
				for(; tzi&amp;lt;tzl; tzi++){
					tzv = timezoneList[tzi];
					timezoneList[tzi] = { value: tzv, label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601) };
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;

			// set the default units
			tp_inst.timezone = tp_inst._defaults.timezone !== null? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) : 
							((new Date()).getTimezoneOffset()*-1);
			tp_inst.hour = tp_inst._defaults.hour &amp;lt; tp_inst._defaults.hourMin? tp_inst._defaults.hourMin : 
							tp_inst._defaults.hour &amp;gt; tp_inst._defaults.hourMax? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute &amp;lt; tp_inst._defaults.minuteMin? tp_inst._defaults.minuteMin : 
							tp_inst._defaults.minute &amp;gt; tp_inst._defaults.minuteMax? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second &amp;lt; tp_inst._defaults.secondMin? tp_inst._defaults.secondMin : 
							tp_inst._defaults.second &amp;gt; tp_inst._defaults.secondMax? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec &amp;lt; tp_inst._defaults.millisecMin? tp_inst._defaults.millisecMin : 
							tp_inst._defaults.millisec &amp;gt; tp_inst._defaults.millisecMax? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec &amp;lt; tp_inst._defaults.microsecMin? tp_inst._defaults.microsecMin : 
							tp_inst._defaults.microsec &amp;gt; tp_inst._defaults.microsecMax? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = '';
			tp_inst.$input = $input;

			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField).css({
					cursor: 'pointer'
				}).focus(function() {
					$input.trigger("focus");
				});
			}

			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date();
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date();
			}

			// datepicker needs minDate/maxDate, timepicker needs minDateTime/maxDateTime..
			if (tp_inst._defaults.minDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime());
			}
			if (tp_inst._defaults.minDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime());
			}
			if (tp_inst._defaults.maxDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime());
			}
			if (tp_inst._defaults.maxDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime());
			}
			tp_inst.$input.bind('focus', function() {
				tp_inst._onFocus();
			});

			return tp_inst;
		},

		/*
		* add our sliders to the calendar
		*/
		_addTimePicker: function(dp_inst) {
			var currDT = (this.$altInput &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly) ? this.$input.val() + ' ' + this.$altInput.val() : this.$input.val();

			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
		},

		/*
		* parse the time string from input value or _setTime
		*/
		_parseTime: function(timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0]);
			}

			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, 'dateFormat');
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false;
					}
					$.extend(this, parseRes.timeObj);
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err +
									"\ndate/time string = " + timeString +
									"\ntimeFormat = " + this._defaults.timeFormat +
									"\ndateFormat = " + dp_dateFormat);
					return false;
				}
				return true;
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false;
				}
				$.extend(this, timeObj);
				return true;
			}
		},

		/*
		* generate and inject html for timepicker into ui datepicker
		*/
		_injectTimePicker: function() {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = '',
				uitem = '',
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i=0,
				l=0;

			// Prevent displaying twice
			if ($dp.find("div.ui-timepicker-div").length === 0 &amp;amp;&amp;amp; o.showTimepicker) {
				var noDisplay = ' style="display:none;"',
					html = '&amp;lt;div class="ui-timepicker-div'+ (o.isRTL? ' ui-timepicker-rtl' : '') +'"&amp;gt;&amp;lt;dl&amp;gt;' + '&amp;lt;dt class="ui_tpicker_time_label"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;' + o.timeText + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_time"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the markup
				for(i=0,l=this.units.length; i&amp;lt;l; i++){
					litem = this.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// Added by Peter Medeiros:
					// - Figure out what the hour/minute/second max should be based on the step values.
					// - Example: if stepMinute is 15, then minMax is 45.
					max[litem] = parseInt((o[litem+'Max'] - ((o[litem+'Max'] - o[litem+'Min']) % o['step'+uitem])), 10);
					gridSize[litem] = 0;

					html += '&amp;lt;dt class="ui_tpicker_'+ litem +'_label"' + (show ? '' : noDisplay) + '&amp;gt;' + o[litem +'Text'] + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_'+ litem +'"&amp;gt;&amp;lt;div class="ui_tpicker_'+ litem +'_slider"' + (show ? '' : noDisplay) + '&amp;gt;&amp;lt;/div&amp;gt;';

					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						html += '&amp;lt;div style="padding-left: 1px"&amp;gt;&amp;lt;table class="ui-tpicker-grid-label"&amp;gt;&amp;lt;tr&amp;gt;';

						if(litem == 'hour'){
							for (var h = o[litem+'Min']; h &amp;lt;= max[litem]; h += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm? 'hht':'HH', {hour:h}, o);									
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + tmph + '&amp;lt;/td&amp;gt;';
							}
						}
						else{
							for (var m = o[litem+'Min']; m &amp;lt;= max[litem]; m += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + ((m &amp;lt; 10) ? '0' : '') + m + '&amp;lt;/td&amp;gt;';
							}
						}

						html += '&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;&amp;lt;/div&amp;gt;';
					}
					html += '&amp;lt;/dd&amp;gt;';
				}
				
				// Timezone
				var showTz = o.showTimezone !== null? o.showTimezone : this.support.timezone;
				html += '&amp;lt;dt class="ui_tpicker_timezone_label"' + (showTz ? '' : noDisplay) + '&amp;gt;' + o.timezoneText + '&amp;lt;/dt&amp;gt;';
				html += '&amp;lt;dd class="ui_tpicker_timezone" ' + (showTz ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the elements from string
				html += '&amp;lt;/dl&amp;gt;&amp;lt;/div&amp;gt;';
				var $tp = $(html);

				// if we only want time picker...
				if (o.timeOnly === true) {
					$tp.prepend('&amp;lt;div class="ui-widget-header ui-helper-clearfix ui-corner-all"&amp;gt;' + '&amp;lt;div class="ui-datepicker-title"&amp;gt;' + o.timeOnlyTitle + '&amp;lt;/div&amp;gt;' + '&amp;lt;/div&amp;gt;');
					$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();
				}
				
				// add sliders, adjust grids, add events
				for(i=0,l=tp_inst.units.length; i&amp;lt;l; i++){
					litem = tp_inst.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// add the slider
					tp_inst[litem+'_slider'] = tp_inst.control.create(tp_inst, $tp.find('.ui_tpicker_'+litem+'_slider'), litem, tp_inst[litem], o[litem+'Min'], max[litem], o['step'+uitem]);

					// adjust the grid and add click event
					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						size = 100 * gridSize[litem] * o[litem+'Grid'] / (max[litem] - o[litem+'Min']);
						$tp.find('.ui_tpicker_'+litem+' table').css({
							width: size + "%",
							marginLeft: o.isRTL? '0' : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL? ((size / (-2 * gridSize[litem])) + "%") : '0',
							borderCollapse: 'collapse'
						}).find("td").click(function(e){
								var $t = $(this),
									h = $t.html(),
									n = parseInt(h.replace(/[^0-9]/g),10),
									ap = h.replace(/[^apm]/ig),
									f = $t.data('for'); // loses scope, so we use data-for

								if(f == 'hour'){
									if(ap.indexOf('p') !== -1 &amp;amp;&amp;amp; n &amp;lt; 12){
										n += 12;
									}
									else{
										if(ap.indexOf('a') !== -1 &amp;amp;&amp;amp; n === 12){
											n = 0;
										}
									}
								}
								
								tp_inst.control.value(tp_inst, tp_inst[f+'_slider'], litem, n);

								tp_inst._onTimeChange();
								tp_inst._onSelectHandler();
							}).css({
								cursor: 'pointer',
								width: (100 / gridSize[litem]) + '%',
								textAlign: 'center',
								overflow: 'hidden'
							});
					} // end if grid &amp;gt; 0
				} // end for loop

				// Add timezone options
				this.timezone_select = $tp.find('.ui_tpicker_timezone').append('&amp;lt;select&amp;gt;&amp;lt;/select&amp;gt;').find("select");
				$.fn.append.apply(this.timezone_select,
				$.map(o.timezoneList, function(val, idx) {
					return $("&amp;lt;option /&amp;gt;").val(typeof val == "object" ? val.value : val).text(typeof val == "object" ? val.label : val);
				}));
				if (typeof(this.timezone) != "undefined" &amp;amp;&amp;amp; this.timezone !== null &amp;amp;&amp;amp; this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset()*-1;
					if (local_timezone == this.timezone) {
						selectLocalTimezone(tp_inst);
					} else {
						this.timezone_select.val(this.timezone);
					}
				} else {
					if (typeof(this.hour) != "undefined" &amp;amp;&amp;amp; this.hour !== null &amp;amp;&amp;amp; this.hour !== "") {
						this.timezone_select.val(o.timezone);
					} else {
						selectLocalTimezone(tp_inst);
					}
				}
				this.timezone_select.change(function() {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
				});
				// End timezone options
				
				// inject timepicker into datepicker
				var $buttonPanel = $dp.find('.ui-datepicker-buttonpane');
				if ($buttonPanel.length) {
					$buttonPanel.before($tp);
				} else {
					$dp.append($tp);
				}

				this.$timeObj = $tp.find('.ui_tpicker_time');

				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined;
				}

				// slideAccess integration: http://trentrichardson.com/2011/11/11/jquery-ui-sliders-and-touch-accessibility/
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
						
					setTimeout(function() { // fix for inline mode
						if ($tp.find('.ui-slider-access').length === 0) {
							$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);

							// fix any grids since sliders are shorter
							var sliderAccessWidth = $tp.find('.ui-slider-access:eq(0)').outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find('table:visible').each(function() {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl? 'marginRight':'marginLeft').toString().replace('%', ''),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + '%',
										css = { width: newWidth, marginRight: 0, marginLeft: 0 };
									css[rtl? 'marginRight':'marginLeft'] = newMarginLeft;
									$g.css(css);
								});
							}
						}
					}, 10);
				}
				// end slideAccess integration

				tp_inst._limitMinMaxDateTime(this.inst, true);
			}
		},

		/*
		* This function tries to limit the ability to go outside the
		* min/max date range
		*/
		_limitMinMaxDateTime: function(dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);

			if (!this._defaults.showTimepicker) {
				return;
			} // No time so nothing to check here

			if ($.datepicker._get(dp_inst, 'minDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'minDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, 'minDateTime'),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin;
				}

				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour &amp;lt;= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute &amp;lt;= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second &amp;lt;= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if(this.millisec &amp;lt;= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;lt; this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin;
									}
									this._defaults.microsecMin = this.microsecMinOriginal;
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal;
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal;
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal;
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal;
				}
			}

			if ($.datepicker._get(dp_inst, 'maxDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'maxDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, 'maxDateTime'),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax;
				}

				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour &amp;gt;= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute &amp;gt;= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second &amp;gt;= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec &amp;gt;= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;gt; this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax;
									}
									this._defaults.microsecMax = this.microsecMaxOriginal;
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal;
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal;
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal;
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal;
				}
			}

			if (adjustSliders !== undefined &amp;amp;&amp;amp; adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10);
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);

				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, 'hour', { min: this._defaults.hourMin, max: hourMax });
					this.control.value(this, this.hour_slider, 'hour', this.hour - (this.hour % this._defaults.stepHour));
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, 'minute', { min: this._defaults.minuteMin, max: minMax });
					this.control.value(this, this.minute_slider, 'minute', this.minute - (this.minute % this._defaults.stepMinute));
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, 'second', { min: this._defaults.secondMin, max: secMax });
					this.control.value(this, this.second_slider, 'second', this.second - (this.second % this._defaults.stepSecond));
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, 'millisec', { min: this._defaults.millisecMin, max: millisecMax });
					this.control.value(this, this.millisec_slider, 'millisec', this.millisec - (this.millisec % this._defaults.stepMillisec));
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, 'microsec', { min: this._defaults.microsecMin, max: microsecMax });
					this.control.value(this, this.microsec_slider, 'microsec', this.microsec - (this.microsec % this._defaults.stepMicrosec));
				}
			}

		},

		/*
		* when a slider moves, set the internal time...
		* on time change is also called when the time is updated in the text field
		*/
		_onTimeChange: function() {
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, 'hour') : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, 'minute') : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, 'second') : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, 'millisec') : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, 'microsec') : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;

			if (typeof(hour) == 'object') {
				hour = false;
			}
			if (typeof(minute) == 'object') {
				minute = false;
			}
			if (typeof(second) == 'object') {
				second = false;
			}
			if (typeof(millisec) == 'object') {
				millisec = false;
			}
			if (typeof(microsec) == 'object') {
				microsec = false;
			}
			if (typeof(timezone) == 'object') {
				timezone = false;
			}

			if (hour !== false) {
				hour = parseInt(hour, 10);
			}
			if (minute !== false) {
				minute = parseInt(minute, 10);
			}
			if (second !== false) {
				second = parseInt(second, 10);
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10);
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10);
			}

			var ampm = o[hour &amp;lt; 12 ? 'amNames' : 'pmNames'][0];

			// If the update was done in the input field, the input field should not be updated.
			// If the update was done using the sliders, update the input field.
			var hasChanged = (hour != this.hour || minute != this.minute || second != this.second || millisec != this.millisec || microsec != this.microsec 
								|| (this.ampm.length &amp;gt; 0 &amp;amp;&amp;amp; (hour &amp;lt; 12) != ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) 
								|| (this.timezone !== null &amp;amp;&amp;amp; timezone != this.timezone));

			if (hasChanged) {

				if (hour !== false) {
					this.hour = hour;
				}
				if (minute !== false) {
					this.minute = minute;
				}
				if (second !== false) {
					this.second = second;
				}
				if (millisec !== false) {
					this.millisec = millisec;
				}
				if (microsec !== false) {
					this.microsec = microsec;
				}
				if (timezone !== false) {
					this.timezone = timezone;
				}

				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0]);
				}

				this._limitMinMaxDateTime(this.inst, true);
			}
			if (this.support.ampm) {
				this.ampm = ampm;
			}

			// Updates the time within the timepicker
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if(pickerTimeFormat === o.timeFormat){
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix);
				}
				else{
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix);
				}
			}

			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime();
			}
		},

		/*
		* call custom onSelect.
		* bind to sliders slidestop, and grid click.
		*/
		_onSelectHandler: function() {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect &amp;amp;&amp;amp; inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this]);
			}
		},

		/*
		* update our input with the new date time..
		*/
		_updateDateTime: function(dp_inst) {
			dp_inst = this.inst || dp_inst;
			//var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
			var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay)),
				dateFmt = $.datepicker._get(dp_inst, 'dateFormat'),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null &amp;amp;&amp;amp; this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			
			// if a slider was changed but datepicker doesn't have a value yet, set it
			if(dp_inst.lastVal===""){
                dp_inst.currentYear=dp_inst.selectedYear;
                dp_inst.currentMonth=dp_inst.selectedMonth;
                dp_inst.currentDay=dp_inst.selectedDay;
            }

			/*
			* remove following lines to force every changes in date picker to change the input value
			* Bug descriptions: when an input field has a default value, and click on the field to pop up the date picker. 
			* If the user manually empty the value in the input field, the date picker will never change selected value.
			*/
			//if (dp_inst.lastVal !== undefined &amp;amp;&amp;amp; (dp_inst.lastVal.length &amp;gt; 0 &amp;amp;&amp;amp; this.$input.val().length === 0)) {
			//	return;
			//}

			if (this._defaults.timeOnly === true) {
				formattedDateTime = this.formattedTime;
			} else if (this._defaults.timeOnly !== true &amp;amp;&amp;amp; (this._defaults.alwaysSetTime || timeAvailable)) {
				formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix;
			}

			this.formattedDateTime = formattedDateTime;

			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate);
			} else if (this.$altInput &amp;amp;&amp;amp; this._defaults.timeOnly === false &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly === true) {
				this.$altInput.val(this.formattedTime);
				this.$input.val(this.formattedDate);
			} else if (this.$altInput) {
				this.$input.val(formattedDateTime);
				var altFormattedDateTime = '',
					altSeparator = this._defaults.altSeparator ? this._defaults.altSeparator : this._defaults.separator,
					altTimeSuffix = this._defaults.altTimeSuffix ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
				
				if(!this._defaults.timeOnly){
					if (this._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg);
					}
					else{
						altFormattedDateTime = this.formattedDate;
					}

					if (altFormattedDateTime){
						altFormattedDateTime += altSeparator;
					}
				}

				if(this._defaults.altTimeFormat){
					altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix;
				}
				else{
					altFormattedDateTime += this.formattedTime + altTimeSuffix;
				}
				this.$altInput.val(altFormattedDateTime);
			} else {
				this.$input.val(formattedDateTime);
			}

			this.$input.trigger("change");
		},

		_onFocus: function() {
			if (!this.$input.val() &amp;amp;&amp;amp; this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, 'timepicker');
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst);
						} catch (err) {
							$.timepicker.log(err);
						}
					}
				}
			}
		},

		/*
		* Small abstraction to control types
		* We can add more, just be sure to follow the pattern: create, options, value
		*/
		_controls: {
			// slider methods
			slider: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var rtl = tp_inst._defaults.isRTL; // if rtl go -60-&amp;gt;0 instead of 0-&amp;gt;60
					return obj.prop('slide', null).slider({
						orientation: "horizontal",
						value: rtl? val*-1 : val,
						min: rtl? max*-1 : min,
						max: rtl? min*-1 : max,
						step: step,
						slide: function(event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl? ui.value*-1:ui.value);
							tp_inst._onTimeChange();
						},
						stop: function(event, ui) {
							tp_inst._onSelectHandler();
						}
					});	
				},
				options: function(tp_inst, obj, unit, opts, val){
					if(tp_inst._defaults.isRTL){
						if(typeof(opts) == 'string'){
							if(opts == 'min' || opts == 'max'){
								if(val !== undefined){
									return obj.slider(opts, val*-1);
								}
								return Math.abs(obj.slider(opts));
							}
							return obj.slider(opts);
						}
						var min = opts.min, 
							max = opts.max;
						opts.min = opts.max = null;
						if(min !== undefined){
							opts.max = min * -1;
						}
						if(max !== undefined){
							opts.min = max * -1;
						}
						return obj.slider(opts);
					}
					if(typeof(opts) == 'string' &amp;amp;&amp;amp; val !== undefined){
							return obj.slider(opts, val);
					}
					return obj.slider(opts);
				},
				value: function(tp_inst, obj, unit, val){
					if(tp_inst._defaults.isRTL){
						if(val !== undefined){
							return obj.slider('value', val*-1);
						}
						return Math.abs(obj.slider('value'));
					}
					if(val !== undefined){
						return obj.slider('value', val);
					}
					return obj.slider('value');
				}
			},
			// select methods
			select: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var sel = '&amp;lt;select class="ui-timepicker-select" data-unit="'+ unit +'" data-min="'+ min +'" data-max="'+ max +'" data-step="'+ step +'"&amp;gt;',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;

					for(var i=min; i&amp;lt;=max; i+=step){						
						sel += '&amp;lt;option value="'+ i +'"'+ (i==val? ' selected':'') +'&amp;gt;';
						if(unit == 'hour'){
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig,'')), {hour:i}, tp_inst._defaults);
						}
						else if(unit == 'millisec' || unit == 'microsec' || i &amp;gt;= 10){ sel += i; }
						else {sel += '0'+ i.toString(); }
						sel += '&amp;lt;/option&amp;gt;';
					}
					sel += '&amp;lt;/select&amp;gt;';

					obj.children('select').remove();

					$(sel).appendTo(obj).change(function(e){
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
					});

					return obj;
				},
				options: function(tp_inst, obj, unit, opts, val){
					var o = {},
						$t = obj.children('select');
					if(typeof(opts) == 'string'){
						if(val === undefined){
							return $t.data(opts);
						}
						o[opts] = val;	
					}
					else{ o = opts; }
					return tp_inst.control.create(tp_inst, obj, $t.data('unit'), $t.val(), o.min || $t.data('min'), o.max || $t.data('max'), o.step || $t.data('step'));
				},
				value: function(tp_inst, obj, unit, val){
					var $t = obj.children('select');
					if(val !== undefined){
						return $t.val(val);
					}
					return $t.val();
				}
			}
		} // end _controls

	});

	$.fn.extend({
		/*
		* shorthand just to use timepicker..
		*/
		timepicker: function(o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);

			if (typeof o == 'object') {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				});
			}

			return $(this).each(function() {
				$.fn.datetimepicker.apply($(this), tmp_args);
			});
		},

		/*
		* extend timepicker to datepicker
		*/
		datetimepicker: function(o) {
			o = o || {};
			var tmp_args = arguments;

			if (typeof(o) == 'string') {
				if (o == 'getDate') {
					return $.fn.datepicker.apply($(this[0]), tmp_args);
				} else {
					return this.each(function() {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args);
					});
				}
			} else {
				return this.each(function() {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults);
				});
			}
		}
	});

	/*
	* Public Utility to parse date and time
	*/
	$.datepicker.parseDateTime = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec);
		}

		return parseRes.date;
	};

	/*
	* Public utility to parse time
	*/
	$.datepicker.parseTime = function(timeFormat, timeString, options) {		
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g,'').indexOf('Z') !== -1);

		// Strict parse requires the timeString to match the timeFormat exactly
		var strictParse = function(f, s, o){

			// pattern for standard and localized AM/PM markers
			var getPatternAmpm = function(amNames, pmNames) {
				var markers = [];
				if (amNames) {
					$.merge(markers, amNames);
				}
				if (pmNames) {
					$.merge(markers, pmNames);
				}
				markers = $.map(markers, function(val) {
					return val.replace(/[.*+?|()\[\]{}\\]/g, '\\$&amp;amp;');
				});
				return '(' + markers.join('|') + ')?';
			};

			// figure out position of time elements.. cause js cant do named captures
			var getFormatPositions = function(timeFormat) {
				var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
					orders = {
						h: -1,
						m: -1,
						s: -1,
						l: -1,
						c: -1,
						t: -1,
						z: -1
					};

				if (finds) {
					for (var i = 0; i &amp;lt; finds.length; i++) {
						if (orders[finds[i].toString().charAt(0)] == -1) {
							orders[finds[i].toString().charAt(0)] = i + 1;
						}
					}
				}
				return orders;
			};

			var regstr = '^' + f.toString()
					.replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
							var ml = match.length;
							switch (match.charAt(0).toLowerCase()) {
								case 'h': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'm': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 's': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'l': return '(\\d?\\d?\\d)';
								case 'c': return '(\\d?\\d?\\d)';
								case 'z': return '(z|[-+]\\d\\d:?\\d\\d|\\S+)?';
								case 't': return getPatternAmpm(o.amNames, o.pmNames);
								default:    // literal escaped in quotes
									return '(' + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function (m) { return "\\" + m; }) + ')?';
							}
						})
					.replace(/\s/g, '\\s?') +
					o.timeSuffix + '$',
				order = getFormatPositions(f),
				ampm = '',
				treg;

			treg = s.match(new RegExp(regstr, 'i'));

			var resTime = {
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0
			};

			if (treg) {
				if (order.t !== -1) {
					if (treg[order.t] === undefined || treg[order.t].length === 0) {
						ampm = '';
						resTime.ampm = '';
					} else {
						ampm = $.inArray(treg[order.t].toUpperCase(), o.amNames) !== -1 ? 'AM' : 'PM';
						resTime.ampm = o[ampm == 'AM' ? 'amNames' : 'pmNames'][0];
					}
				}

				if (order.h !== -1) {
					if (ampm == 'AM' &amp;amp;&amp;amp; treg[order.h] == '12') {
						resTime.hour = 0; // 12am = 0 hour
					} else {
						if (ampm == 'PM' &amp;amp;&amp;amp; treg[order.h] != '12') {
							resTime.hour = parseInt(treg[order.h], 10) + 12; // 12pm = 12 hour, any other pm = hour + 12
						} else {
							resTime.hour = Number(treg[order.h]);
						}
					}
				}

				if (order.m !== -1) {
					resTime.minute = Number(treg[order.m]);
				}
				if (order.s !== -1) {
					resTime.second = Number(treg[order.s]);
				}
				if (order.l !== -1) {
					resTime.millisec = Number(treg[order.l]);
				}
				if (order.c !== -1) {
					resTime.microsec = Number(treg[order.c]);
				}
				if (order.z !== -1 &amp;amp;&amp;amp; treg[order.z] !== undefined) {
					resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z]);
				}


				return resTime;
			}
			return false;
		};// end strictParse

		// First try JS Date, if that fails, use strictParse
		var looseParse = function(f,s,o){
			try{
				var d = new Date('2012-01-01 '+ s);
				if(isNaN(d.getTime())){
					d = new Date('2012-01-01T'+ s);
					if(isNaN(d.getTime())){
						d = new Date('01/01/2012 '+ s);
						if(isNaN(d.getTime())){
							throw "Unable to parse time with native Date: "+ s;
						}
					}
				}

				return {
					hour: d.getHours(),
					minute: d.getMinutes(),
					second: d.getSeconds(),
					millisec: d.getMilliseconds(),
					microsec: d.getMicroseconds(),
					timezone: d.getTimezoneOffset()*-1
				};
			}
			catch(err){
				try{
					return strictParse(f,s,o);
				}
				catch(err2){
					$.timepicker.log("Unable to parse \ntimeString: "+ s +"\ntimeFormat: "+ f);
				}				
			}
			return false;
		}; // end looseParse
		
		if(typeof o.parse === "function"){
			return o.parse(timeFormat, timeString, o);
		}
		if(o.parse === 'loose'){
			return looseParse(timeFormat, timeString, o);
		}
		return strictParse(timeFormat, timeString, o);
	};

	/*
	* Public utility to format the time
	* format = string format of the time
	* time = a {}, not a Date() for timezones
	* options = essentially the regional[].. amNames, pmNames, ampm
	*/
	$.datepicker.formatTime = function(format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			timezone: 0
		}, time);

		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);

		if (hour &amp;gt; 11) {
			ampmName = options.pmNames[0];
		}

		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|('.*?'|".*?"))/g, function(match) {
		switch (match) {
			case 'HH':
				return ('0' + hour).slice(-2);
			case 'H':
				return hour;
			case 'hh':
				return ('0' + convert24to12(hour)).slice(-2);
			case 'h':
				return convert24to12(hour);
			case 'mm':
				return ('0' + time.minute).slice(-2);
			case 'm':
				return time.minute;
			case 'ss':
				return ('0' + time.second).slice(-2);
			case 's':
				return time.second;
			case 'l':
				return ('00' + time.millisec).slice(-3);
			case 'c':
				return ('00' + time.microsec).slice(-3);
			case 'z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, false);
			case 'Z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, true);
			case 'T': 
				return ampmName.charAt(0).toUpperCase();
			case 'TT': 
				return ampmName.toUpperCase();
			case 't':
				return ampmName.charAt(0).toLowerCase();
			case 'tt':
				return ampmName.toLowerCase();
			default:
				return match.replace(/\'/g, "") || "'";
			}
		});

		tmptime = $.trim(tmptime);
		return tmptime;
	};

	/*
	* the bad hack :/ override datepicker so it doesnt close on select
	// inspired: http://stackoverflow.com/questions/1252512/jquery-datepicker-prevent-closing-picker-when-clicking-a-date/1762378#1762378
	*/
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function(id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			tp_inst._limitMinMaxDateTime(inst, true);
			inst.inline = inst.stay_open = true;
			//This way the onSelect handler called from calendarpicker get the full dateTime
			this._base_selectDate(id, dateStr);
			inst.inline = inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst);
		} else {
			this._base_selectDate(id, dateStr);
		}
	};

	/*
	* second bad hack :/ override datepicker so it triggers an event when changing the input field
	* and does not redraw the datepicker on every selectDate event
	*/
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function(inst) {

		// don't popup the datepicker if there is another instance already opened
		var input = inst.input[0];
		if ($.datepicker._curInst &amp;amp;&amp;amp; $.datepicker._curInst != inst &amp;amp;&amp;amp; $.datepicker._datepickerShowing &amp;amp;&amp;amp; $.datepicker._lastInput != input) {
			return;
		}

		if (typeof(inst.stay_open) !== 'boolean' || inst.stay_open === false) {

			this._base_updateDatepicker(inst);

			// Reload the time control when changing something in the input text field.
			var tp_inst = this._get(inst, 'timepicker');
			if (tp_inst) {
				tp_inst._addTimePicker(inst);
			}
		}
	};

	/*
	* third bad hack :/ override datepicker so it allows spaces and colon in the input field
	*/
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if ($.datepicker._get(inst, 'constrainInput')) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null? tp_inst._defaults.showTimezone : tp_inst.support.timezone,					
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat')),
					datetimeChars = tp_inst._defaults.timeFormat.toString()
											.replace(/[hms]/g, '')
											.replace(/TT/g, ampm ? 'APM' : '')
											.replace(/Tt/g, ampm ? 'AaPpMm' : '')
											.replace(/tT/g, ampm ? 'AaPpMm' : '')
											.replace(/T/g, ampm ? 'AP' : '')
											.replace(/tt/g, ampm ? 'apm' : '')
											.replace(/t/g, ampm ? 'ap' : '') + 
											" " + tp_inst._defaults.separator + 
											tp_inst._defaults.timeSuffix + 
											(tz ? tp_inst._defaults.timezoneList.join('') : '') + 
											(tp_inst._defaults.amNames.join('')) + (tp_inst._defaults.pmNames.join('')) + 
											dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr &amp;lt; ' ' || !dateChars || datetimeChars.indexOf(chr) &amp;gt; -1);
			}
		}

		return $.datepicker._base_doKeyPress(event);
	};

	/*
	* Fourth bad hack :/ override _updateAlternate function used in inline mode to init altField
	*/
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	/* Update any alternate field to synchronise with the main field. */
	$.datepicker._updateAlternate = function(inst) {
		var tp_inst = this._get(inst, 'timepicker');
		if(tp_inst){
			var altField = tp_inst._defaults.altField;
			if (altField) { // update alternate field too
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = '', 
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator, 
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if(!tp_inst._defaults.timeOnly &amp;amp;&amp;amp; !tp_inst._defaults.altFieldTimeOnly &amp;amp;&amp;amp; date !== null){
					if(tp_inst._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime;
					}
					else{
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime;
					}
				}
				$(altField).val(altFormattedDateTime);
			}
		}
		else{
			$.datepicker._base_updateAlternate(inst);
		}
	};

	/*
	* Override key up event to sync manual input changes.
	*/
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst);
				} catch (err) {
					$.timepicker.log(err);
				}
			}
		}

		return $.datepicker._base_doKeyUp(event);
	};

	/*
	* override "Today" button to also grab the time.
	*/
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function(id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		this._base_gotoToday(id);
		var tp_inst = this._get(inst, 'timepicker');
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		$('.ui-datepicker-today', $dp).click();
	};

	/*
	* Disable &amp;amp; enable the Time in the datetimepicker
	*/
	$.datepicker._disableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst);
		}
	};

	$.datepicker._enableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst); // Could be disabled on page load
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create our own set time function
	*/
	$.datepicker._setTime = function(inst, date) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var defaults = tp_inst._defaults;

			// calling _setTime with no date sets time to defaults
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;

			//check if within min/max times.. 
			tp_inst._limitMinMaxDateTime(inst, true);

			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create new public method to set only time, callable as $().datepicker('setTime', date)
	*/
	$.datepicker._setTimeDatepicker = function(target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date == "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec);
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds());
				}
				if (tp_date.toString() == 'Invalid Date') {
					tp_date = undefined;
				}
				this._setTime(inst, tp_date);
			}
		}

	};

	/*
	* override setDate() to allow setting time too within Date object
	*/
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function(target, date) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		if(typeof(date) === 'string'){
			date = new Date(date);
			if(!date.getTime()){
				$.timepicker.log("Error creating Date object from string.");
			}
		}

		var tp_inst = this._get(inst, 'timepicker');
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds());
		} else {
			tp_date = date;
		}
		
		// This is important if you are using the timezone option, javascript's Date 
		// object will only return the timezone offset for the current locale, so we 
		// adjust it accordingly.  If not using timezone option this won't matter..
		// If a timezone is different in tp, keep the timezone as is
		if(tp_inst){
			// look out for DST if tz wasn't specified
			if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
				tp_inst.timezone = tp_date.getTimezoneOffset()*-1;
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone);
		}

		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true);
	};

	/*
	* override getDate() to allow getting time too within Date object
	*/
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function(target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			// if it hasn't yet been defined, grab from field
			if(inst.lastVal === undefined){
				this._setDateFromField(inst, noDefault);
			}

			var date = this._getDate(inst);
			if (date &amp;amp;&amp;amp; tp_inst._parseTime($(target).val(), tp_inst.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);

				// This is important if you are using the timezone option, javascript's Date 
				// object will only return the timezone offset for the current locale, so we 
				// adjust it accordingly.  If not using timezone option this won't matter..
				if(tp_inst.timezone != null){
					// look out for DST if tz wasn't specified
					if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
						tp_inst.timezone = date.getTimezoneOffset()*-1;
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
				}
			}
			return date;
		}
		return this._base_getDateDatepicker(target, noDefault);
	};

	/*
	* override parseDate() because UI 1.8.14 throws an error about "Extra characters"
	* An option in datapicker to ignore extra format characters would be nicer.
	*/
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function(format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings);
		} catch (err) {
			// Hack!  The error message ends with a colon, a space, and
			// the "extra" characters.  We rely on that instead of
			// attempting to perfectly reproduce the parsing algorithm.
			if (err.indexOf(":") &amp;gt;= 0) {
				date = this._base_parseDate(format, value.substring(0,value.length-(err.length-err.indexOf(':')-2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format);
			} else {
				throw err;
			}
		}
		return date;
	};

	/*
	* override formatDate to set date with time to the input
	*/
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function(inst, day, month, year) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val();
		}
		return this._base_formatDate(inst);
	};

	/*
	* override options setter to add time to maxDate(Time) and minDate(Time). MaxDate
	*/
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function(target, name, value) {
		var inst = this._getInst(target),
	        name_clone;
		if (!inst) {
			return null;
		}

		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop;
		    if (typeof name == 'string') { // if min/max was set with the string
		        if (name === 'minDate' || name === 'minDateTime') {
		            min = value;
		        } else if (name === 'maxDate' || name === 'maxDateTime') {
		            max = value;
		        } else if (name === 'onSelect') {
		            onselect = value;
		        } else if (overrides.hasOwnProperty(name)) {
		            if (typeof (value) === 'undefined') {
		                return overrides[name];
		            }
		            fns[name] = value;
		            name_clone = {}; //empty results in exiting function after overrides updated
		        }
		    } else if (typeof name == 'object') { //if min/max was set with the JSON
		        if (name.minDate) {
		            min = name.minDate;
		        } else if (name.minDateTime) {
		            min = name.minDateTime;
		        } else if (name.maxDate) {
		            max = name.maxDate;
		        } else if (name.maxDateTime) {
		            max = name.maxDateTime;
		        }
		        for (prop in overrides) {
		            if (overrides.hasOwnProperty(prop) &amp;amp;&amp;amp; name[prop]) {
		                fns[prop] = name[prop];
		            }
		        }
		    }
		    for (prop in fns) {
		        if (fns.hasOwnProperty(prop)) {
		            overrides[prop] = fns[prop];
		            if (!name_clone) { name_clone = $.extend({}, name);}
		            delete name_clone[prop];
		        }
		    }
		    if (name_clone &amp;amp;&amp;amp; isEmptyObject(name_clone)) { return; }
		    if (min) { //if min was set
		        if (min === 0) {
		            min = new Date();
		        } else {
		            min = new Date(min);
		        }
		        tp_inst._defaults.minDate = min;
		        tp_inst._defaults.minDateTime = min;
		    } else if (max) { //if max was set
		        if (max === 0) {
		            max = new Date();
		        } else {
		            max = new Date(max);
		        }
		        tp_inst._defaults.maxDate = max;
		        tp_inst._defaults.maxDateTime = max;
		    } else if (onselect) {
		        tp_inst._defaults.onSelect = onselect;
		    }
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name);
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
	};
	
	/*
	* jQuery isEmptyObject does not check hasOwnProperty - if someone has added to the object prototype,
	* it will return false for all objects
	*/
	var isEmptyObject = function(obj) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(obj)) {
				return false;
			}
		}
		return true;
	};

	/*
	* jQuery extend now ignores nulls!
	*/
	var extendRemove = function(target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] === null || props[name] === undefined) {
				target[name] = props[name];
			}
		}
		return target;
	};

	/*
	* Determine by the time format which units are supported
	* Returns an object of booleans for each unit
	*/
	var detectSupport = function(timeFormat){
		var tf = timeFormat.replace(/\'.*?\'/g,'').toLowerCase(), // removes literals
			isIn = function(f, t){ // does the format contain the token?
					return f.indexOf(t) !== -1? true:false; 
				};
		return {
				hour: isIn(tf,'h'),
				minute: isIn(tf,'m'),
				second: isIn(tf,'s'),
				millisec: isIn(tf,'l'),
				microsec: isIn(tf,'c'),
				timezone: isIn(tf,'z'),
				ampm: isIn(tf,'t') &amp;amp;&amp;amp; isIn(timeFormat,'h'),
				iso8601: isIn(timeFormat, 'Z')
			};
	};

	/*
	* Converts 24 hour format into 12 hour
	* Returns 12 hour without leading 0
	*/
	var convert24to12 = function(hour) {
		if (hour &amp;gt; 12) {
			hour = hour - 12;
		}

		if (hour === 0) {
			hour = 12;
		}

		return String(hour);
	};

	/*
	* Splits datetime string into date ans time substrings.
	* Throws exception when date can't be parsed
	* Returns [dateString, timeString]
	*/
	var splitDateTime = function(dateFormat, dateTimeString, dateSettings, timeSettings) {
		try {
			// The idea is to get the number separator occurances in datetime and the time format requested (since time has 
			// fewer unknowns, mostly numbers and am/pm). We will use the time pattern to split.
			var separator = timeSettings &amp;amp;&amp;amp; timeSettings.separator ? timeSettings.separator : $.timepicker._defaults.separator,
				format = timeSettings &amp;amp;&amp;amp; timeSettings.timeFormat ? timeSettings.timeFormat : $.timepicker._defaults.timeFormat,
				timeParts = format.split(separator), // how many occurances of separator may be in our format?
				timePartsLen = timeParts.length,
				allParts = dateTimeString.split(separator),
				allPartsLen = allParts.length;

			if (allPartsLen &amp;gt; 1) {
				return [
						allParts.splice(0,allPartsLen-timePartsLen).join(separator),
						allParts.splice(0,timePartsLen).join(separator)
					];
			}

		} catch (err) {
			$.timepicker.log('Could not split the date from the time. Please check the following datetimepicker options' +
					"\nthrown error: " + err +
					"\ndateTimeString" + dateTimeString +
					"\ndateFormat = " + dateFormat +
					"\nseparator = " + timeSettings.separator +
					"\ntimeFormat = " + timeSettings.timeFormat);

			if (err.indexOf(":") &amp;gt;= 0) {
				// Hack!  The error message ends with a colon, a space, and
				// the "extra" characters.  We rely on that instead of
				// attempting to perfectly reproduce the parsing algorithm.
				var dateStringLength = dateTimeString.length - (err.length - err.indexOf(':') - 2),
					timeString = dateTimeString.substring(dateStringLength);

				return [$.trim(dateTimeString.substring(0, dateStringLength)), $.trim(dateTimeString.substring(dateStringLength))];

			} else {
				throw err;
			}
		}
		return [dateTimeString, ''];
	};

	/*
	* Internal function to parse datetime interval
	* Returns: {date: Date, timeObj: Object}, where
	*   date - parsed date without time (type Date)
	*   timeObj = {hour: , minute: , second: , millisec: , microsec: } - parsed time. Optional
	*/
	var parseDateTimeInternal = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var date;
		var splitRes = splitDateTime(dateFormat, dateTimeString, dateSettings, timeSettings);
		date = $.datepicker._base_parseDate(dateFormat, splitRes[0], dateSettings);
		if (splitRes[1] !== '') {
			var timeString = splitRes[1],
				parsedTime = $.datepicker.parseTime(timeFormat, timeString, timeSettings);

			if (parsedTime === null) {
				throw 'Wrong time format';
			}
			return {
				date: date,
				timeObj: parsedTime
			};
		} else {
			return {
				date: date
			};
		}
	};

	/*
	* Internal function to set timezone_select to the local timezone
	*/
	var selectLocalTimezone = function(tp_inst, date) {
		if (tp_inst &amp;amp;&amp;amp; tp_inst.timezone_select) {
			var now = typeof date !== 'undefined' ? date : new Date();
			tp_inst.timezone_select.val(now.getTimezoneOffset()*-1);
		}
	};

	/*
	* Create a Singleton Insance
	*/
	$.timepicker = new Timepicker();

	/**
	 * Get the timezone offset as string from a date object (eg '+0530' for UTC+5.5)
	 * @@param  number if not a number this value is returned
	 * @@param boolean if true formats in accordance to iso8601 "+12:45"
	 * @@return string
	 */
	$.timepicker.timezoneOffsetString = function(tzMinutes, iso8601) {
		if(isNaN(tzMinutes) || tzMinutes &amp;gt; 840){
			return tzMinutes;
		}

		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601? ':':'',
			tz = (off &amp;gt;= 0 ? '+' : '-') + ('0' + (hours * 101).toString()).slice(-2) + iso + ('0' + (minutes * 101).toString()).slice(-2);
		
		if(tz == '+00:00'){
			return 'Z';
		}
		return tz;
	};

	/**
	 * Get the number in minutes that represents a timezone string
	 * @@param  string formated like "+0500", "-1245"
	 * @@return number
	 */
	$.timepicker.timezoneOffsetNumber = function(tzString) {
		tzString = tzString.toString().replace(':',''); // excuse any iso8601, end up with "+1245"

		if(tzString.toUpperCase() === 'Z'){ // if iso8601 with Z, its 0 minute offset
			return 0;
		}

		if(!/^(\-|\+)\d{4}$/.test(tzString)){ // possibly a user defined tz, so just give it back
			return tzString;
		}

		return ((tzString.substr(0,1) =='-'? -1 : 1) * // plus or minus
					((parseInt(tzString.substr(1,2),10)*60) + // hours (converted to minutes)
					parseInt(tzString.substr(3,2),10))); // minutes
	};

	/**
	 * No way to set timezone in js Date, so we must adjust the minutes to compensate. (think setDate, getDate)
	 * @@param  date
	 * @@param  string formated like "+0500", "-1245"
	 * @@return date
	 */
	$.timepicker.timezoneAdjust = function(date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if(!isNaN(toTz)){
			date.setMinutes(date.getMinutes()*1 + (date.getTimezoneOffset()*-1 - toTz*1) );
		}
		return date;
	};

	/**
	 * Calls `timepicker()` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * n.b. The input value must be correctly formatted (reformatting is not supported)
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the timepicker() call
	 * @@return jQuery
	 */
	$.timepicker.timeRange = function(startTime, endTime, options) {
		return $.timepicker.handleRange('timepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datetimepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@return jQuery
	 */
	$.timepicker.datetimeRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datetimepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.dateRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.handleRange = function(method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0, // min allowed interval in milliseconds
			maxInterval: 0, // max allowed interval in milliseconds
			start: {},      // options for start picker
			end: {}         // options for end picker
		}, options);

		$.fn[method].call(startTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), endTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), endTime, 'minDate');
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), startTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), startTime, 'maxDate');
			}
		}, options, options.end));

		checkDates(startTime, endTime);
		selected(startTime, endTime, 'minDate');
		selected(endTime, startTime, 'maxDate');

		function checkDates(changed, other) {
			var startdt = startTime[method]('getDate'),
				enddt = endTime[method]('getDate'),
				changeddt = changed[method]('getDate');

			if(startdt !== null){
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());

				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);

				if(options.minInterval &amp;gt; 0 &amp;amp;&amp;amp; minDate &amp;gt; enddt){ // minInterval check
					endTime[method]('setDate',minDate);
				}
				else if(options.maxInterval &amp;gt; 0 &amp;amp;&amp;amp; maxDate &amp;lt; enddt){ // max interval check
					endTime[method]('setDate',maxDate);
				}
				else if (startdt &amp;gt; enddt) {
					other[method]('setDate',changeddt);
				}
			}
		}

		function selected(changed, other, option) {
			if (!changed.val()) {
				return;
			}
			var date = changed[method].call(changed, 'getDate');
			if(date !== null &amp;amp;&amp;amp; options.minInterval &amp;gt; 0){
				if(option == 'minDate'){
					date.setMilliseconds(date.getMilliseconds() + options.minInterval); 
				}
				if(option == 'maxDate'){
					date.setMilliseconds(date.getMilliseconds() - options.minInterval);
				}
			}
			if (date.getTime) {
				other[method].call(other, 'option', option, date);
			}
		}
		return $([startTime.get(0), endTime.get(0)]);
	};

	/**
	 * Log error or data to the console during error or debugging
	 * @@param  Object err pass any type object to log to the console during error or debugging
	 * @@return void
	 */
	$.timepicker.log = function(err){
		if(window.console){
			console.log(err);
		}
	};

	/*
	* Microsecond support
	*/
	if(!Date.prototype.getMicroseconds){
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function(){ return this.microseconds; };
		Date.prototype.setMicroseconds = function(m){ 
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m/1000));
			this.microseconds = m%1000;
			return this;
		};
	}

	/*
	* Keep up with the version
	*/
	$.timepicker.version = "1.3.1";

})(jQuery);
jQuery.noConflict();
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;datetimepicker-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;e73a652e-09fc-4c71-8e7a-e2525a2d2a99&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
function replaceAllString(oriStr, strTarget, strSubString ){
   var strText = oriStr;
   var intIndexOfMatch = strText.indexOf( strTarget );
   while (intIndexOfMatch != -1){
      strText = strText.replace( strTarget, strSubString )
      intIndexOfMatch = strText.indexOf( strTarget );
   }
   return( strText );
}
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&amp;amp;]" + name + "=([^&amp;amp;#]*)"),
    results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
};


   var jobName= getParameterByName('job')
   var fromDate= getParameterByName('fromDate')
   var toDate= getParameterByName('toDate')
   var limit= getParameterByName('limit')
   var selectedIstIid = getParameterByName('IstIid')

  $("#jobname").ready(function(){
   $("#jobname").text(jobName)
   var convertedJobName = replaceAllString(jobName, ".", "_")
   $("#IstIid" + convertedJobName).ready(function(){
     $("#IstIid" + convertedJobName).css("display","block")
     $("#select_" + convertedJobName).ready(function(){
        $("#select_" + convertedJobName).val(selectedIstIid)
     });
   });
 });

  $("#fromDate").ready(function(){
   $("#from-date").val(fromDate)
 });

  $("#toDate").ready(function(){
   $("#to-date").val(toDate)
 });

  $("#limit").ready(function(){
   if(limit!=""){
    $("#limit").val(limit)
   }
 });
 // Get data with ajax
 function ajax_getData(jobName,fromDate,toDate,limit ){
       var convertedJobName = replaceAllString(jobName, ".", "_")
       var istIid = $("#select_" + convertedJobName).val()
       window.location="/xwiki/bin/view/WiperDog/WebHome?job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid="+istIid;
 			/*$.ajax({
			 type: "GET",
			 url:"/xwiki/bin/get/Sandbox/DescriptionForJob?outputSyntax=plain&amp;amp;job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid"+selectedIstIid,
			 success : function(result){
				$("#jobname").html(jobName)
				$("#display").text('[[]]' + result)
			 }
		   });*/
 }
	$("#treemenu2 a").click(function(){
		 var limit = 10
		 var fromDate=""
		 var toDate = ""
		 jobName= $(this).text()
                 $("#jobname").html(jobName)
                 var convertedJobName = replaceAllString(jobName, ".", "_")
                 $("#listIstIid &amp;gt; div").css("display","none")
                 $("#IstIid" + convertedJobName).css("display","block")
		 //ajax_getData(jobName,fromDate,toDate,limit )

	});

	$("#from-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
		dateFormat: 'yy-mm-dd',
	});
	$("#to-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
			dateFormat: 'yy-mm-dd',

	});
	 $("#get-data").on("click",function(){
		var fromDate = $("#from-date").val()
		var toDate =  $("#to-date").val()
		 if( toDate!= "" ){
			  if(fromDate != ""){
				  if($("#from-date").datepicker( "getDate" ) &amp;gt; $("#to-date").datepicker( "getDate" )){
				  alert("'From date' cannot start later than 'To date'")
				  return false
				  }
			  }
		 }
		 limit = $("#limit").val()
		 ajax_getData(jobName,fromDate,toDate,limit )
                 
                 /** Get livetable data */
                 buildLivetable($("#jobname").val(),$("#limit").val(),fromDate ,toDate, selectedIstIid);

	});
        function buildLivetable(jobName, limit, fromDate, toDate, istIid){      		
		var dataModelUrl = '/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job='+jobName +'&amp;amp;limit='+limit+'&amp;amp;fromDate='
                +fromDate + '&amp;amp;toDate=' + toDate +   '&amp;amp;pager=pager2&amp;amp;genp=1&amp;amp;istIid=localhost-information_schema'

		var jqxhr = $.getJSON(dataModelUrl, function(data) {
			$("#livetableList").jqGrid(data);
			$("#livetableList").jqGrid('navGrid', "#livetablePager", {
			    edit : false,
			    add : false,
			    del : false
			});
		})
        }//end function

jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;process&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;881686cc-1bfc-456e-b8ab-71334c4a45e5&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){

$(function () {
    function drawLineChart(xAxis, series, container, data_detail){
        var dataXAxis = xAxis
        var dataSeries = series
        var detail = data_detail

			$('#containerline' + container).highcharts({

				chart: {
					type:'line'
				},
				title: {
					text: container
				},
				tooltip :{
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				xAxis: dataXAxis ,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				series: dataSeries
			});
		};

		function drawBarChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerbar' + container).highcharts({
				chart: {
					type: 'column'
				},
				title: {
					text: container
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {

					column: {
						pointPadding: 0.2,
						borderWidth: 0
					}
				},
				series: dataSeries
			});
		}

		function drawAreaChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail
			$('#containerarea' + container).highcharts({
				chart: {
					type: 'area'
				},
				title: {
					text: container
				},
				subtitle: {
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					},
					labels: {
						formatter: function() {
							return this.value / 1000;
						}
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {
					area: {
						stacking: 'normal',
						lineColor: '#666666',
						lineWidth: 1,
						marker: {
							lineWidth: 1,
							lineColor: '#666666'
						}
					}
				},
				series: dataSeries
			});
		};

		function drawPieChart(data, container){
			var dataPie = data
			$(document).ready(function () {
				// Build the chart
				$('#container' + container).highcharts({
					chart: {
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: dataPie[0].name
					},
					tooltip: {
						pointFormat: '{series.name}: &amp;lt;b&amp;gt;{point.percentage:.1f}%&amp;lt;/b&amp;gt;'
					},
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							dataLabels: {
								enabled: false
							},
							showInLegend: true
						}
					},
					series: dataPie
				});
			});
		}

		// LINE
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonline_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonline");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Line chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						if(data_all[0][i].series[0].name == null){
							data_all[0][i].series[0].name = lstContainer[0][i]
						}
						drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
					}
				}
			}
		});

		// BAR
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonbar_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonbar");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Bar chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						drawBarChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
					}
				}
			}
		});

		// AREA
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonarea_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonarea");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				// data to display on tooltip
				var data_detail = data_all[0]
				// draw Area Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					drawAreaChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
				}
			}
		});

		// PIE
		$("#piechart").ready(function(){

			var array = $("#jsons&amp;gt;.jsonpie");
			var arrayContainer = $("#jsons&amp;gt;.lstcontainerpie");
			var lstContainer = [];
			var data_all = [];
			for(var i=0;i&amp;lt;array.length;i++){
				data_all[i] = jQuery.parseJSON(array[i].value)
				lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)

			}
			if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
				// data to display on tooltip
				// draw Pie Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					var finalData = []
					finalData[0] = data_all[0][i]
					drawPieChart(finalData, lstContainer[0][i])
				}
			}
		});
	});
	jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;d5873d92-b78b-42fc-9407-46d166204b88&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;/* css for timepicker */
.ui-timepicker-div .ui-widget-header { 
margin-bottom: 8px;
 }

.ui-timepicker-div dl { text-align: left; }
.ui-timepicker-div dl dt { height: 25px; margin-bottom: -25px; }
.ui-timepicker-div dl dd { margin: 0 10px 10px 65px; }
.ui-timepicker-div td { font-size: 90%; }
.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }

.ui-timepicker-rtl{ direction: rtl; }
.ui-timepicker-rtl dl { text-align: right; }
.ui-timepicker-rtl dl dd { margin: 0 65px 10px 10px; }
#ui-datepicker-div{
 position:relative;
 width:auto;
 height:auto
}
&lt;/code&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;datetimepicker -css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;1201fb1a-e9c1-4731-8c74-2ea8c0071959&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;.displayblock {
  border:2px solid;
  -webkit-border-radius:6px;
  background:gray;
  float: left;
  width:100%;
}

.displaypie {
  border:1px solid;
  -webkit-border-radius:6px;
  background:gray;
  width: 48%;
  float: left; 
  height: 300px;
}

.subtype {
  margin-top: 50px;
  font-size: 2em;
  color: red;
}&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;content&gt;{{include document="Lib.DataToDrawChart"/}}
{{include document="Lib.MongoDBConnection"/}}
{{velocity}}
$xwiki.jsx.use('Lib.JQueryUILib')
$xwiki.ssx.use('Lib.MenuGenerator')
$xwiki.jsx.use('Lib.MenuGenerator')
$xwiki.ssx.use('Lib.JQueryUILib')
{{/velocity}}
{{include document="Lib.MenuGenerator"/}}
{{html wiki="true" clean="false"}}
&amp;lt;div id="viewer"&amp;gt;
&amp;lt;table style="text-align:left"  &amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th &amp;gt;Job name&amp;lt;/th&amp;gt;
  &amp;lt;td colspan=3&amp;gt;&amp;lt;div id="jobname"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
{{groovy}}
import org.xwiki.context.*

def ec = services.component.getInstance(Execution.class).getContext()
def mapJobIstIid = ec.getProperty("mapJobIstIid")

println '{{html clean="false" wiki="false"}}'
println '&amp;lt;tr&amp;gt;'
println '&amp;lt;th&amp;gt;IstIid&amp;lt;/th&amp;gt;'
println '&amp;lt;td colspan=3&amp;gt;'
mapJobIstIid.each{jobEntry-&amp;gt;
  def convertedJobKey = jobEntry.key.replaceAll("\\.","_")
  println "&amp;lt;div id='listIstIid'&amp;gt;"
  println "&amp;lt;div id=IstIid${convertedJobKey} style='display:none'&amp;gt;"
  println "&amp;lt;select id=select_${convertedJobKey}&amp;gt;"
  jobEntry.value.each{
     println "&amp;lt;option value=\"$it\"&amp;gt;$it&amp;lt;/option&amp;gt;"
  }
  println "&amp;lt;/select&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
}
println '&amp;lt;/td&amp;gt;'
println '&amp;lt;/tr&amp;gt;'
println '{{/html}}'
{{/groovy}}
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data monitor from&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="from-date" id="from-date"/&amp;gt;&amp;lt;/td&amp;gt;
  &amp;lt;th&amp;gt;Data monitor to&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="to-date" id="to-date"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data records limit &amp;lt;/th&amp;gt;
  &amp;lt;td &amp;gt;
     &amp;lt;select id="limit"&amp;gt;
       &amp;lt;option value=5&amp;gt;5&amp;lt;/option&amp;gt;
       &amp;lt;option value=10&amp;gt;10&amp;lt;/option&amp;gt;
       &amp;lt;option value=15&amp;gt;15&amp;lt;/option&amp;gt;
       &amp;lt;option value=20&amp;gt;20&amp;lt;/option&amp;gt;
     &amp;lt;/select&amp;gt;
  &amp;lt;/td&amp;gt;
  &amp;lt;td colspan=3 &amp;gt;&amp;lt;input type="button" value="View Data" id="get-data" class="button"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt; 
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;&amp;lt;div id="display"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
&amp;lt;/table&amp;gt;

&amp;lt;/div&amp;gt; 
 &amp;lt;table style="text-align:left"  &amp;gt;
	&amp;lt;tr&amp;gt;
		&amp;lt;td&amp;gt;
 			Begin livetable
 		&amp;lt;/td&amp;gt;
 		&amp;lt;td&amp;gt;
 			&amp;lt;table id="livetableList"&amp;gt;&amp;lt;/table&amp;gt;
 			&amp;lt;div id="livetablePager"&amp;gt;&amp;lt;/div&amp;gt;
 		&amp;lt;/td&amp;gt; 	
 	&amp;lt;/tr&amp;gt;
 &amp;lt;/table&amp;gt;
 &amp;lt;/body&amp;gt;
{{/html}}
{{groovy}}
import groovy.json.*
xwiki.jsx.use("Lib.Highcharts")

if(request.xpage == "plain") {
	response.setContentType('text/plain')
}

def listData = []
def job = request.get("job")
def fromDate = request.get("fromDate")
def toDate = request.get("toDate")
def limit= (request.get("limit")!=null)?request.get("limit").toInteger():10
def istIid = request.get("IstIid")

def str= "No data to retrieved !"
def result = null
if(job != "" &amp;amp;&amp;amp; job != null &amp;amp;&amp;amp; istIid != null &amp;amp;&amp;amp; istIid != ""){
	MongoDBConnection.getConnection()
	if(fromDate != "" || toDate != ""){
		result = MongoDBConnection.getDataInPeriod(job,fromDate,toDate,limit,istIid)
	} else {
		result = MongoDBConnection.getDataAllFields(job,limit,istIid)
        }
MongoDBConnection.closeConnection()
} else {
   println "{{warning}}There are no selected job or IstIid{{/warning}}"
}

if( (result != null) &amp;amp;&amp;amp; (result.size() &amp;gt; 0) &amp;amp;&amp;amp; (result[0].KEYEXPR != null)&amp;amp;&amp;amp;!(result[0].KEYEXPR instanceof List )){
if(result[0].type == "Subtyped") {
    println '{{html clean="false" wiki="true"}}'
    //println '&amp;lt;body&amp;gt;'
    def dataSubtype = DataToDrawChart.getDataToDrawSubtype(result)
    def listKey = []
    dataSubtype.each {key,value -&amp;gt;
        listKey.add(key)
    }
    def jsonkey = com.mongodb.util.JSON.serialize(listKey)
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$jsonkey&amp;lt;/textarea&amp;gt;"

    dataSubtype.each {key,value -&amp;gt;
        println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +'&amp;lt;/div&amp;gt;'
        println "-----"
        def dataLine = []
        def dataBar = []
        def dataPie = []
        def dataArea = []
        if(DataToDrawChart.getDataToDrawLine(value) != []) {
            dataLine = DataToDrawChart.getDataToDrawLine(value)
        }
        if(DataToDrawChart.getDataToDrawBar(value) != []) {
            dataBar = DataToDrawChart.getDataToDrawBar(value)
        }
        if(DataToDrawChart.getDataToDrawPie(value) != []) {
            dataPie = DataToDrawChart.getDataToDrawPie(value)
        }
        if(DataToDrawChart.getDataToDrawArea(value) != []) {
            dataArea = DataToDrawChart.getDataToDrawArea(value)
        }

        def chartColumnsLine
        def chartColumnsBar 
        def chartColumnsArea 
        def lstName
        if(dataLine.size() &amp;gt; 0 ){
            chartColumnsLine = dataLine[0].chart_columns
        }
        if(dataBar.size() &amp;gt; 0){
            chartColumnsBar = dataBar[0].chart_columns
        }
        if(dataArea.size() &amp;gt; 0 ){
            chartColumnsArea = dataArea[0].chart_columns
        }
        if(dataPie.size() &amp;gt; 0 ){
            lstName = dataPie['name']
        }

        def tmpListNameContainer = []
	for(def nameContainer in lstName){
	   nameContainer = nameContainer.replaceAll("\\.", "_")
	   tmpListNameContainer.add(nameContainer)
	}
        def jsonPie
        def jsonLine
	def jsonBar
        def jsonArea
        if(dataPie != []) {
	    jsonPie = com.mongodb.util.JSON.serialize(dataPie)
        }
        if(dataLine != []) {
	    jsonLine = com.mongodb.util.JSON.serialize(dataLine)
        }
        if(dataBar != []) {
            jsonBar = com.mongodb.util.JSON.serialize(dataBar)
        }
        if(dataArea != []) {
	    jsonArea = com.mongodb.util.JSON.serialize(dataArea)
        }

	def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
	def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
	def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
	def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

	println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
        if(jsonLine != null) {
	    println "&amp;lt;textarea id=\"jsonline_$key\" &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;" 
        }
	if(jsonBar != null) {
            println "&amp;lt;textarea id=\"jsonbar_$key\"&amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
 	    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
        }
        if(jsonPie != null) {
	    println "&amp;lt;textarea id=\"jsonpie_$key\" &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
        }
        if(jsonArea != null) {
	    println "&amp;lt;textarea id=\"jsonarea_$key\" &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"
	    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
        }

	println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
	println "&amp;lt;input style=\"display:none\" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;"
	println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
	println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'
	println "&amp;lt;/div&amp;gt;"
	  
	def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
	def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
	  
	println "&amp;lt;div style='clear:both'&amp;gt;"
        if(jsonPie != null) {
	  println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
	  lstName.each{
	    def tmp = it.replaceAll("\\.", "_")
	    println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
        if(jsonLine != null) {
	  def chartLineComment = false
	  chartColumnsLine.each{
	    if(!chartLineComment){
	       println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	       chartLineComment = true  
	    }

	      println " &amp;lt;div class=\"displayblock\" id=\"containerline${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
        println "&amp;amp;nbsp;"

        if(jsonBar != null) {
	  def chartBarComment = false
	  chartColumnsBar.each{
	     if(!chartBarComment){
	        println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	        chartBarComment = true
	      }  

	     println " &amp;lt;div class=\"displayblock\" id=\"containerbar${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
	println "&amp;amp;nbsp;"

        if(jsonArea != null) {
	  def chartAreaComment = false
	  chartColumnsArea.each{
	  if(!chartAreaComment){
	    println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	    chartAreaComment = true
	  }
	    println " &amp;lt;div class=\"displayblock\" id=\"containerarea${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
	println "&amp;lt;/div&amp;gt;"
        
    }
    println '&amp;lt;/body&amp;gt;'
    println '{{/html}}'
} else if(result[0].type == "Store") {
    // data store
    def dataLine = DataToDrawChart.getDataToDrawLine(result)
    def dataBar = DataToDrawChart.getDataToDrawBar(result)
    def dataPie = DataToDrawChart.getDataToDrawPie(result)
    def dataArea = DataToDrawChart.getDataToDrawArea(result)
    def chartColumnsLine 
    def chartColumnsBar 
    def chartColumnsArea 
    def lstName 

    if(dataLine.size() &amp;gt; 0 ){
        chartColumnsLine = dataLine[0].chart_columns
    }
    if(dataBar.size() &amp;gt; 0){
        chartColumnsBar = dataBar[0].chart_columns
    }
    if(dataArea.size() &amp;gt; 0 ){
        chartColumnsArea = dataArea[0].chart_columns
    }
    if(dataPie.size() &amp;gt; 0 ){
        lstName = dataPie['name']
    }

    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
  
    def tmpListNameContainer = []
    for(def nameContainer in lstName){
       nameContainer = nameContainer.replaceAll("\\.", "_")
       tmpListNameContainer.add(nameContainer)
    }
  
    def jsonPie = com.mongodb.util.JSON.serialize(dataPie)
    def jsonLine = com.mongodb.util.JSON.serialize(dataLine)
    def jsonBar = com.mongodb.util.JSON.serialize(dataBar)
    def jsonArea = com.mongodb.util.JSON.serialize(dataArea)

    def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
    def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
    def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
    def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

    def listEmpty = com.mongodb.util.JSON.serialize([])
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$listEmpty&amp;lt;/textarea&amp;gt;" 

    println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'

    println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
    println "&amp;lt;textarea class='jsonline' &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonbar' &amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonpie' &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonarea' &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"

    println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
  
    def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
    def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
  
    println "&amp;lt;div style='clear:both'&amp;gt;"
  
    def chartPieComment = false
    lstName.each{
        if(!chartPieComment) {
            println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
            chartPieComment = true
        }
        def tmp = it.replaceAll("\\.", "_")
        println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    def chartLineComment = false
    chartColumnsLine.each{
    if(!chartLineComment){
        println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
        chartLineComment = true  
    }

    println " &amp;lt;div class=\"displayblock\" id=\"containerline$it\"&amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    println "&amp;amp;nbsp;"
    def chartBarComment = false
    chartColumnsBar.each{
        if(!chartBarComment){
            println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
            chartBarComment = true
        }  

    println " &amp;lt;div class=\"displayblock\" id=\"containerbar$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
  println "&amp;lt;/div&amp;gt;"
  println "&amp;amp;nbsp;"
  def chartAreaComment = false
  chartColumnsArea.each{
  if(!chartAreaComment){
    println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
    chartAreaComment = true
  }
    println " &amp;lt;div class=\"displayblock\" id=\"containerarea$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
  println "&amp;lt;/div&amp;gt;"
println "&amp;lt;/div&amp;gt;"

println '&amp;lt;/body&amp;gt;'
println '{{/html}}'
}
}else{
    println 'There is no data for this job with criterias'
}
{{/groovy}}&lt;/content&gt;&lt;/xwikidoc&gt;
@


33.4
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376374879000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376374879000&lt;/contentUpdateDate&gt;
&lt;version&gt;33.4&lt;/version&gt;
d3195 1
a3195 3
 			&amp;lt;table id="livetableList"&amp;gt;&amp;lt;/table&amp;gt; 
 		&amp;lt;/td&amp;gt;
 		&amp;lt;td&amp;gt;
@


33.3
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376374549000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376374549000&lt;/contentUpdateDate&gt;
&lt;version&gt;33.3&lt;/version&gt;
d3189 13
a3201 3
 &amp;lt;div id="test"&amp;gt;begin livetable&amp;lt;/div&amp;gt;
 &amp;lt;table id="livetableList"&amp;gt;&amp;lt;/table&amp;gt; 
 &amp;lt;div id="livetablePager"&amp;gt;&amp;lt;/div&amp;gt;
d3236 1
a3236 1
    println '&amp;lt;body&amp;gt;'
@


33.2
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376374467000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376374467000&lt;/contentUpdateDate&gt;
&lt;version&gt;33.2&lt;/version&gt;
d3189 1
@


33.1
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376370904000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376370904000&lt;/contentUpdateDate&gt;
&lt;version&gt;33.1&lt;/version&gt;
d21 1
a21 1
&lt;minorEdit&gt;false&lt;/minorEdit&gt;
d3184 1
a3184 6
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr style="display:none"&amp;gt;
    &amp;lt;td colspan=3&amp;gt;
       
    &amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
a3188 1
 &amp;lt;/body&amp;gt;
d3191 1
@


32.1
log
@@
text
@&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xwikidoc&gt;
&lt;web&gt;WiperDog&lt;/web&gt;
&lt;name&gt;WebHome&lt;/name&gt;
&lt;language&gt;&lt;/language&gt;
&lt;defaultLanguage&gt;en&lt;/defaultLanguage&gt;
&lt;translation&gt;0&lt;/translation&gt;
&lt;parent&gt;&lt;/parent&gt;
&lt;creator&gt;XWiki.Admin&lt;/creator&gt;
&lt;author&gt;XWiki.Admin&lt;/author&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;contentAuthor&gt;XWiki.Admin&lt;/contentAuthor&gt;
&lt;creationDate&gt;1376364375000&lt;/creationDate&gt;
&lt;date&gt;1376370806000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376370064000&lt;/contentUpdateDate&gt;
&lt;version&gt;32.1&lt;/version&gt;
&lt;title&gt;WiperDog&lt;/title&gt;
&lt;defaultTemplate&gt;&lt;/defaultTemplate&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;comment&gt;&lt;/comment&gt;
&lt;minorEdit&gt;false&lt;/minorEdit&gt;
&lt;syntaxId&gt;xwiki/2.1&lt;/syntaxId&gt;
&lt;hidden&gt;false&lt;/hidden&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;047293a8-524d-45e4-af52-cd944523d5d0&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
/*
 * jQuery timepicker addon
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 1.3.1
 * Last Modified: 07/07/2013
 *
 * Copyright 2013 Trent Richardson
 * You may use this project under MIT or GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 */

/*jslint evil: true, white: false, undef: false, nomen: false */

(function($) {

	/*
	* Lets not redefine timepicker, Prevent "Uncaught RangeError: Maximum call stack size exceeded"
	*/
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return;
	}

	/*
	* Extend jQueryUI, get it started with our version number
	*/
	$.extend($.ui, {
		timepicker: {
			version: "1.3.1"
		}
	});

	/* 
	* Timepicker manager.
	* Use the singleton instance of this class, $.timepicker, to interact with the time picker.
	* Settings for (groups of) time pickers are maintained in an instance object,
	* allowing multiple different settings on the same page.
	*/
	var Timepicker = function() {
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[''] = { // Default regional settings
			currentText: 'Now',
			closeText: 'Done',
			amNames: ['AM', 'A'],
			pmNames: ['PM', 'P'],
			timeFormat: 'HH:mm',
			timeSuffix: '',
			timeOnlyTitle: 'Choose Time',
			timeText: 'Time',
			hourText: 'Hour',
			minuteText: 'Minute',
			secondText: 'Second',
			millisecText: 'Millisecond',
			microsecText: 'Microsecond',
			timezoneText: 'Time Zone',
			isRTL: false
		};
		this._defaults = { // Global defaults for all the datetime picker instances
			showButtonPanel: true,
			timeOnly: false,
			showHour: null,
			showMinute: null,
			showSecond: null,
			showMillisec: null,
			showMicrosec: null,
			showTimezone: null,
			showTime: true,
			stepHour: 1,
			stepMinute: 1,
			stepSecond: 1,
			stepMillisec: 1,
			stepMicrosec: 1,
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null,
			hourMin: 0,
			minuteMin: 0,
			secondMin: 0,
			millisecMin: 0,
			microsecMin: 0,
			hourMax: 23,
			minuteMax: 59,
			secondMax: 59,
			millisecMax: 999,
			microsecMax: 999,
			minDateTime: null,
			maxDateTime: null,
			onSelect: null,
			hourGrid: 0,
			minuteGrid: 0,
			secondGrid: 0,
			millisecGrid: 0,
			microsecGrid: 0,
			alwaysSetTime: true,
			separator: ' ',
			altFieldTimeOnly: true,
			altTimeFormat: null,
			altSeparator: null,
			altTimeSuffix: null,
			pickerTimeFormat: null,
			pickerTimeSuffix: null,
			showTimepicker: true,
			timezoneList: null,
			addSliderAccess: false,
			sliderAccessArgs: null,
			controlType: 'slider',
			defaultValue: null,
			parse: 'strict'
		};
		$.extend(this._defaults, this.regional['']);
	};

	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: '',
		formattedDate: '',
		formattedTime: '',
		formattedDateTime: '',
		timezoneList: null,
		units: ['hour','minute','second','millisec', 'microsec'],
		support: {},
		control: null,

		/* 
		* Override the default settings for all instances of the time picker.
		* @@param  settings  object - the new settings to use as defaults (anonymous object)
		* @@return the manager object
		*/
		setDefaults: function(settings) {
			extendRemove(this._defaults, settings || {});
			return this;
		},

		/*
		* Create a new Timepicker instance
		*/
		_newInst: function($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
            	fns = {},
		    	overrides, i;

			for (var attrName in this._defaults) {
				if(this._defaults.hasOwnProperty(attrName)){
					var attrValue = $input.attr('time:' + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue);
						} catch (err) {
							inlineSettings[attrName] = attrValue;
						}
					}
				}
			}

		    overrides = {
		        beforeShow: function (input, dp_inst) {
		            if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
		                return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst);
		            }
		        },
		        onChangeMonthYear: function (year, month, dp_inst) {
		            // Update the time as well : this prevents the time from disappearing from the $input field.
		            tp_inst._updateDateTime(dp_inst);
		            if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
		                tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst);
		            }
		        },
		        onClose: function (dateText, dp_inst) {
		            if (tp_inst.timeDefined === true &amp;amp;&amp;amp; $input.val() !== '') {
		                tp_inst._updateDateTime(dp_inst);
		            }
		            if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
		                tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst);
		            }
		        }
		    };
		    for (i in overrides) {
		        if (overrides.hasOwnProperty(i)) {
		            fns[i] = opts[i] || null;
		        }
		    }

		    tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
		        evnts:fns,
		        timepicker: tp_inst // add timepicker as a property of datepicker: $.datepicker._get(dp_inst, 'timepicker');
		    });
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function(val) {
				return val.toUpperCase();
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function(val) {
				return val.toUpperCase();
			});

			// detect which units are supported
			tp_inst.support = detectSupport(
					tp_inst._defaults.timeFormat + 
					(tp_inst._defaults.pickerTimeFormat? tp_inst._defaults.pickerTimeFormat:'') + 
					(tp_inst._defaults.altTimeFormat? tp_inst._defaults.altTimeFormat:''));

			// controlType is string - key to our this._controls
			if(typeof(tp_inst._defaults.controlType) === 'string'){
				if(tp_inst._defaults.controlType == 'slider' &amp;amp;&amp;amp; typeof(jQuery.ui.slider) === 'undefined'){
					tp_inst._defaults.controlType = 'select';
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType];
			}
			// controlType is an object and must implement create, options, value methods
			else{ 
				tp_inst.control = tp_inst._defaults.controlType;
			}

			// prep the timezone options
			var timezoneList = [-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,
					0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList;
			}
			var tzl=timezoneList.length,tzi=0,tzv=null;
			if (tzl &amp;gt; 0 &amp;amp;&amp;amp; typeof timezoneList[0] !== 'object') {
				for(; tzi&amp;lt;tzl; tzi++){
					tzv = timezoneList[tzi];
					timezoneList[tzi] = { value: tzv, label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601) };
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;

			// set the default units
			tp_inst.timezone = tp_inst._defaults.timezone !== null? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) : 
							((new Date()).getTimezoneOffset()*-1);
			tp_inst.hour = tp_inst._defaults.hour &amp;lt; tp_inst._defaults.hourMin? tp_inst._defaults.hourMin : 
							tp_inst._defaults.hour &amp;gt; tp_inst._defaults.hourMax? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute &amp;lt; tp_inst._defaults.minuteMin? tp_inst._defaults.minuteMin : 
							tp_inst._defaults.minute &amp;gt; tp_inst._defaults.minuteMax? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second &amp;lt; tp_inst._defaults.secondMin? tp_inst._defaults.secondMin : 
							tp_inst._defaults.second &amp;gt; tp_inst._defaults.secondMax? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec &amp;lt; tp_inst._defaults.millisecMin? tp_inst._defaults.millisecMin : 
							tp_inst._defaults.millisec &amp;gt; tp_inst._defaults.millisecMax? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec &amp;lt; tp_inst._defaults.microsecMin? tp_inst._defaults.microsecMin : 
							tp_inst._defaults.microsec &amp;gt; tp_inst._defaults.microsecMax? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = '';
			tp_inst.$input = $input;

			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField).css({
					cursor: 'pointer'
				}).focus(function() {
					$input.trigger("focus");
				});
			}

			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date();
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date();
			}

			// datepicker needs minDate/maxDate, timepicker needs minDateTime/maxDateTime..
			if (tp_inst._defaults.minDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime());
			}
			if (tp_inst._defaults.minDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime());
			}
			if (tp_inst._defaults.maxDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime());
			}
			if (tp_inst._defaults.maxDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime());
			}
			tp_inst.$input.bind('focus', function() {
				tp_inst._onFocus();
			});

			return tp_inst;
		},

		/*
		* add our sliders to the calendar
		*/
		_addTimePicker: function(dp_inst) {
			var currDT = (this.$altInput &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly) ? this.$input.val() + ' ' + this.$altInput.val() : this.$input.val();

			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
		},

		/*
		* parse the time string from input value or _setTime
		*/
		_parseTime: function(timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0]);
			}

			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, 'dateFormat');
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false;
					}
					$.extend(this, parseRes.timeObj);
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err +
									"\ndate/time string = " + timeString +
									"\ntimeFormat = " + this._defaults.timeFormat +
									"\ndateFormat = " + dp_dateFormat);
					return false;
				}
				return true;
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false;
				}
				$.extend(this, timeObj);
				return true;
			}
		},

		/*
		* generate and inject html for timepicker into ui datepicker
		*/
		_injectTimePicker: function() {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = '',
				uitem = '',
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i=0,
				l=0;

			// Prevent displaying twice
			if ($dp.find("div.ui-timepicker-div").length === 0 &amp;amp;&amp;amp; o.showTimepicker) {
				var noDisplay = ' style="display:none;"',
					html = '&amp;lt;div class="ui-timepicker-div'+ (o.isRTL? ' ui-timepicker-rtl' : '') +'"&amp;gt;&amp;lt;dl&amp;gt;' + '&amp;lt;dt class="ui_tpicker_time_label"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;' + o.timeText + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_time"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the markup
				for(i=0,l=this.units.length; i&amp;lt;l; i++){
					litem = this.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// Added by Peter Medeiros:
					// - Figure out what the hour/minute/second max should be based on the step values.
					// - Example: if stepMinute is 15, then minMax is 45.
					max[litem] = parseInt((o[litem+'Max'] - ((o[litem+'Max'] - o[litem+'Min']) % o['step'+uitem])), 10);
					gridSize[litem] = 0;

					html += '&amp;lt;dt class="ui_tpicker_'+ litem +'_label"' + (show ? '' : noDisplay) + '&amp;gt;' + o[litem +'Text'] + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_'+ litem +'"&amp;gt;&amp;lt;div class="ui_tpicker_'+ litem +'_slider"' + (show ? '' : noDisplay) + '&amp;gt;&amp;lt;/div&amp;gt;';

					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						html += '&amp;lt;div style="padding-left: 1px"&amp;gt;&amp;lt;table class="ui-tpicker-grid-label"&amp;gt;&amp;lt;tr&amp;gt;';

						if(litem == 'hour'){
							for (var h = o[litem+'Min']; h &amp;lt;= max[litem]; h += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm? 'hht':'HH', {hour:h}, o);									
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + tmph + '&amp;lt;/td&amp;gt;';
							}
						}
						else{
							for (var m = o[litem+'Min']; m &amp;lt;= max[litem]; m += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + ((m &amp;lt; 10) ? '0' : '') + m + '&amp;lt;/td&amp;gt;';
							}
						}

						html += '&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;&amp;lt;/div&amp;gt;';
					}
					html += '&amp;lt;/dd&amp;gt;';
				}
				
				// Timezone
				var showTz = o.showTimezone !== null? o.showTimezone : this.support.timezone;
				html += '&amp;lt;dt class="ui_tpicker_timezone_label"' + (showTz ? '' : noDisplay) + '&amp;gt;' + o.timezoneText + '&amp;lt;/dt&amp;gt;';
				html += '&amp;lt;dd class="ui_tpicker_timezone" ' + (showTz ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the elements from string
				html += '&amp;lt;/dl&amp;gt;&amp;lt;/div&amp;gt;';
				var $tp = $(html);

				// if we only want time picker...
				if (o.timeOnly === true) {
					$tp.prepend('&amp;lt;div class="ui-widget-header ui-helper-clearfix ui-corner-all"&amp;gt;' + '&amp;lt;div class="ui-datepicker-title"&amp;gt;' + o.timeOnlyTitle + '&amp;lt;/div&amp;gt;' + '&amp;lt;/div&amp;gt;');
					$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();
				}
				
				// add sliders, adjust grids, add events
				for(i=0,l=tp_inst.units.length; i&amp;lt;l; i++){
					litem = tp_inst.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// add the slider
					tp_inst[litem+'_slider'] = tp_inst.control.create(tp_inst, $tp.find('.ui_tpicker_'+litem+'_slider'), litem, tp_inst[litem], o[litem+'Min'], max[litem], o['step'+uitem]);

					// adjust the grid and add click event
					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						size = 100 * gridSize[litem] * o[litem+'Grid'] / (max[litem] - o[litem+'Min']);
						$tp.find('.ui_tpicker_'+litem+' table').css({
							width: size + "%",
							marginLeft: o.isRTL? '0' : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL? ((size / (-2 * gridSize[litem])) + "%") : '0',
							borderCollapse: 'collapse'
						}).find("td").click(function(e){
								var $t = $(this),
									h = $t.html(),
									n = parseInt(h.replace(/[^0-9]/g),10),
									ap = h.replace(/[^apm]/ig),
									f = $t.data('for'); // loses scope, so we use data-for

								if(f == 'hour'){
									if(ap.indexOf('p') !== -1 &amp;amp;&amp;amp; n &amp;lt; 12){
										n += 12;
									}
									else{
										if(ap.indexOf('a') !== -1 &amp;amp;&amp;amp; n === 12){
											n = 0;
										}
									}
								}
								
								tp_inst.control.value(tp_inst, tp_inst[f+'_slider'], litem, n);

								tp_inst._onTimeChange();
								tp_inst._onSelectHandler();
							}).css({
								cursor: 'pointer',
								width: (100 / gridSize[litem]) + '%',
								textAlign: 'center',
								overflow: 'hidden'
							});
					} // end if grid &amp;gt; 0
				} // end for loop

				// Add timezone options
				this.timezone_select = $tp.find('.ui_tpicker_timezone').append('&amp;lt;select&amp;gt;&amp;lt;/select&amp;gt;').find("select");
				$.fn.append.apply(this.timezone_select,
				$.map(o.timezoneList, function(val, idx) {
					return $("&amp;lt;option /&amp;gt;").val(typeof val == "object" ? val.value : val).text(typeof val == "object" ? val.label : val);
				}));
				if (typeof(this.timezone) != "undefined" &amp;amp;&amp;amp; this.timezone !== null &amp;amp;&amp;amp; this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset()*-1;
					if (local_timezone == this.timezone) {
						selectLocalTimezone(tp_inst);
					} else {
						this.timezone_select.val(this.timezone);
					}
				} else {
					if (typeof(this.hour) != "undefined" &amp;amp;&amp;amp; this.hour !== null &amp;amp;&amp;amp; this.hour !== "") {
						this.timezone_select.val(o.timezone);
					} else {
						selectLocalTimezone(tp_inst);
					}
				}
				this.timezone_select.change(function() {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
				});
				// End timezone options
				
				// inject timepicker into datepicker
				var $buttonPanel = $dp.find('.ui-datepicker-buttonpane');
				if ($buttonPanel.length) {
					$buttonPanel.before($tp);
				} else {
					$dp.append($tp);
				}

				this.$timeObj = $tp.find('.ui_tpicker_time');

				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined;
				}

				// slideAccess integration: http://trentrichardson.com/2011/11/11/jquery-ui-sliders-and-touch-accessibility/
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
						
					setTimeout(function() { // fix for inline mode
						if ($tp.find('.ui-slider-access').length === 0) {
							$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);

							// fix any grids since sliders are shorter
							var sliderAccessWidth = $tp.find('.ui-slider-access:eq(0)').outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find('table:visible').each(function() {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl? 'marginRight':'marginLeft').toString().replace('%', ''),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + '%',
										css = { width: newWidth, marginRight: 0, marginLeft: 0 };
									css[rtl? 'marginRight':'marginLeft'] = newMarginLeft;
									$g.css(css);
								});
							}
						}
					}, 10);
				}
				// end slideAccess integration

				tp_inst._limitMinMaxDateTime(this.inst, true);
			}
		},

		/*
		* This function tries to limit the ability to go outside the
		* min/max date range
		*/
		_limitMinMaxDateTime: function(dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);

			if (!this._defaults.showTimepicker) {
				return;
			} // No time so nothing to check here

			if ($.datepicker._get(dp_inst, 'minDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'minDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, 'minDateTime'),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin;
				}

				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour &amp;lt;= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute &amp;lt;= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second &amp;lt;= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if(this.millisec &amp;lt;= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;lt; this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin;
									}
									this._defaults.microsecMin = this.microsecMinOriginal;
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal;
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal;
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal;
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal;
				}
			}

			if ($.datepicker._get(dp_inst, 'maxDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'maxDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, 'maxDateTime'),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax;
				}

				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour &amp;gt;= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute &amp;gt;= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second &amp;gt;= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec &amp;gt;= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;gt; this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax;
									}
									this._defaults.microsecMax = this.microsecMaxOriginal;
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal;
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal;
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal;
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal;
				}
			}

			if (adjustSliders !== undefined &amp;amp;&amp;amp; adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10);
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);

				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, 'hour', { min: this._defaults.hourMin, max: hourMax });
					this.control.value(this, this.hour_slider, 'hour', this.hour - (this.hour % this._defaults.stepHour));
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, 'minute', { min: this._defaults.minuteMin, max: minMax });
					this.control.value(this, this.minute_slider, 'minute', this.minute - (this.minute % this._defaults.stepMinute));
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, 'second', { min: this._defaults.secondMin, max: secMax });
					this.control.value(this, this.second_slider, 'second', this.second - (this.second % this._defaults.stepSecond));
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, 'millisec', { min: this._defaults.millisecMin, max: millisecMax });
					this.control.value(this, this.millisec_slider, 'millisec', this.millisec - (this.millisec % this._defaults.stepMillisec));
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, 'microsec', { min: this._defaults.microsecMin, max: microsecMax });
					this.control.value(this, this.microsec_slider, 'microsec', this.microsec - (this.microsec % this._defaults.stepMicrosec));
				}
			}

		},

		/*
		* when a slider moves, set the internal time...
		* on time change is also called when the time is updated in the text field
		*/
		_onTimeChange: function() {
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, 'hour') : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, 'minute') : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, 'second') : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, 'millisec') : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, 'microsec') : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;

			if (typeof(hour) == 'object') {
				hour = false;
			}
			if (typeof(minute) == 'object') {
				minute = false;
			}
			if (typeof(second) == 'object') {
				second = false;
			}
			if (typeof(millisec) == 'object') {
				millisec = false;
			}
			if (typeof(microsec) == 'object') {
				microsec = false;
			}
			if (typeof(timezone) == 'object') {
				timezone = false;
			}

			if (hour !== false) {
				hour = parseInt(hour, 10);
			}
			if (minute !== false) {
				minute = parseInt(minute, 10);
			}
			if (second !== false) {
				second = parseInt(second, 10);
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10);
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10);
			}

			var ampm = o[hour &amp;lt; 12 ? 'amNames' : 'pmNames'][0];

			// If the update was done in the input field, the input field should not be updated.
			// If the update was done using the sliders, update the input field.
			var hasChanged = (hour != this.hour || minute != this.minute || second != this.second || millisec != this.millisec || microsec != this.microsec 
								|| (this.ampm.length &amp;gt; 0 &amp;amp;&amp;amp; (hour &amp;lt; 12) != ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) 
								|| (this.timezone !== null &amp;amp;&amp;amp; timezone != this.timezone));

			if (hasChanged) {

				if (hour !== false) {
					this.hour = hour;
				}
				if (minute !== false) {
					this.minute = minute;
				}
				if (second !== false) {
					this.second = second;
				}
				if (millisec !== false) {
					this.millisec = millisec;
				}
				if (microsec !== false) {
					this.microsec = microsec;
				}
				if (timezone !== false) {
					this.timezone = timezone;
				}

				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0]);
				}

				this._limitMinMaxDateTime(this.inst, true);
			}
			if (this.support.ampm) {
				this.ampm = ampm;
			}

			// Updates the time within the timepicker
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if(pickerTimeFormat === o.timeFormat){
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix);
				}
				else{
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix);
				}
			}

			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime();
			}
		},

		/*
		* call custom onSelect.
		* bind to sliders slidestop, and grid click.
		*/
		_onSelectHandler: function() {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect &amp;amp;&amp;amp; inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this]);
			}
		},

		/*
		* update our input with the new date time..
		*/
		_updateDateTime: function(dp_inst) {
			dp_inst = this.inst || dp_inst;
			//var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
			var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay)),
				dateFmt = $.datepicker._get(dp_inst, 'dateFormat'),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null &amp;amp;&amp;amp; this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			
			// if a slider was changed but datepicker doesn't have a value yet, set it
			if(dp_inst.lastVal===""){
                dp_inst.currentYear=dp_inst.selectedYear;
                dp_inst.currentMonth=dp_inst.selectedMonth;
                dp_inst.currentDay=dp_inst.selectedDay;
            }

			/*
			* remove following lines to force every changes in date picker to change the input value
			* Bug descriptions: when an input field has a default value, and click on the field to pop up the date picker. 
			* If the user manually empty the value in the input field, the date picker will never change selected value.
			*/
			//if (dp_inst.lastVal !== undefined &amp;amp;&amp;amp; (dp_inst.lastVal.length &amp;gt; 0 &amp;amp;&amp;amp; this.$input.val().length === 0)) {
			//	return;
			//}

			if (this._defaults.timeOnly === true) {
				formattedDateTime = this.formattedTime;
			} else if (this._defaults.timeOnly !== true &amp;amp;&amp;amp; (this._defaults.alwaysSetTime || timeAvailable)) {
				formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix;
			}

			this.formattedDateTime = formattedDateTime;

			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate);
			} else if (this.$altInput &amp;amp;&amp;amp; this._defaults.timeOnly === false &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly === true) {
				this.$altInput.val(this.formattedTime);
				this.$input.val(this.formattedDate);
			} else if (this.$altInput) {
				this.$input.val(formattedDateTime);
				var altFormattedDateTime = '',
					altSeparator = this._defaults.altSeparator ? this._defaults.altSeparator : this._defaults.separator,
					altTimeSuffix = this._defaults.altTimeSuffix ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
				
				if(!this._defaults.timeOnly){
					if (this._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg);
					}
					else{
						altFormattedDateTime = this.formattedDate;
					}

					if (altFormattedDateTime){
						altFormattedDateTime += altSeparator;
					}
				}

				if(this._defaults.altTimeFormat){
					altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix;
				}
				else{
					altFormattedDateTime += this.formattedTime + altTimeSuffix;
				}
				this.$altInput.val(altFormattedDateTime);
			} else {
				this.$input.val(formattedDateTime);
			}

			this.$input.trigger("change");
		},

		_onFocus: function() {
			if (!this.$input.val() &amp;amp;&amp;amp; this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, 'timepicker');
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst);
						} catch (err) {
							$.timepicker.log(err);
						}
					}
				}
			}
		},

		/*
		* Small abstraction to control types
		* We can add more, just be sure to follow the pattern: create, options, value
		*/
		_controls: {
			// slider methods
			slider: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var rtl = tp_inst._defaults.isRTL; // if rtl go -60-&amp;gt;0 instead of 0-&amp;gt;60
					return obj.prop('slide', null).slider({
						orientation: "horizontal",
						value: rtl? val*-1 : val,
						min: rtl? max*-1 : min,
						max: rtl? min*-1 : max,
						step: step,
						slide: function(event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl? ui.value*-1:ui.value);
							tp_inst._onTimeChange();
						},
						stop: function(event, ui) {
							tp_inst._onSelectHandler();
						}
					});	
				},
				options: function(tp_inst, obj, unit, opts, val){
					if(tp_inst._defaults.isRTL){
						if(typeof(opts) == 'string'){
							if(opts == 'min' || opts == 'max'){
								if(val !== undefined){
									return obj.slider(opts, val*-1);
								}
								return Math.abs(obj.slider(opts));
							}
							return obj.slider(opts);
						}
						var min = opts.min, 
							max = opts.max;
						opts.min = opts.max = null;
						if(min !== undefined){
							opts.max = min * -1;
						}
						if(max !== undefined){
							opts.min = max * -1;
						}
						return obj.slider(opts);
					}
					if(typeof(opts) == 'string' &amp;amp;&amp;amp; val !== undefined){
							return obj.slider(opts, val);
					}
					return obj.slider(opts);
				},
				value: function(tp_inst, obj, unit, val){
					if(tp_inst._defaults.isRTL){
						if(val !== undefined){
							return obj.slider('value', val*-1);
						}
						return Math.abs(obj.slider('value'));
					}
					if(val !== undefined){
						return obj.slider('value', val);
					}
					return obj.slider('value');
				}
			},
			// select methods
			select: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var sel = '&amp;lt;select class="ui-timepicker-select" data-unit="'+ unit +'" data-min="'+ min +'" data-max="'+ max +'" data-step="'+ step +'"&amp;gt;',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;

					for(var i=min; i&amp;lt;=max; i+=step){						
						sel += '&amp;lt;option value="'+ i +'"'+ (i==val? ' selected':'') +'&amp;gt;';
						if(unit == 'hour'){
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig,'')), {hour:i}, tp_inst._defaults);
						}
						else if(unit == 'millisec' || unit == 'microsec' || i &amp;gt;= 10){ sel += i; }
						else {sel += '0'+ i.toString(); }
						sel += '&amp;lt;/option&amp;gt;';
					}
					sel += '&amp;lt;/select&amp;gt;';

					obj.children('select').remove();

					$(sel).appendTo(obj).change(function(e){
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
					});

					return obj;
				},
				options: function(tp_inst, obj, unit, opts, val){
					var o = {},
						$t = obj.children('select');
					if(typeof(opts) == 'string'){
						if(val === undefined){
							return $t.data(opts);
						}
						o[opts] = val;	
					}
					else{ o = opts; }
					return tp_inst.control.create(tp_inst, obj, $t.data('unit'), $t.val(), o.min || $t.data('min'), o.max || $t.data('max'), o.step || $t.data('step'));
				},
				value: function(tp_inst, obj, unit, val){
					var $t = obj.children('select');
					if(val !== undefined){
						return $t.val(val);
					}
					return $t.val();
				}
			}
		} // end _controls

	});

	$.fn.extend({
		/*
		* shorthand just to use timepicker..
		*/
		timepicker: function(o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);

			if (typeof o == 'object') {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				});
			}

			return $(this).each(function() {
				$.fn.datetimepicker.apply($(this), tmp_args);
			});
		},

		/*
		* extend timepicker to datepicker
		*/
		datetimepicker: function(o) {
			o = o || {};
			var tmp_args = arguments;

			if (typeof(o) == 'string') {
				if (o == 'getDate') {
					return $.fn.datepicker.apply($(this[0]), tmp_args);
				} else {
					return this.each(function() {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args);
					});
				}
			} else {
				return this.each(function() {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults);
				});
			}
		}
	});

	/*
	* Public Utility to parse date and time
	*/
	$.datepicker.parseDateTime = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec);
		}

		return parseRes.date;
	};

	/*
	* Public utility to parse time
	*/
	$.datepicker.parseTime = function(timeFormat, timeString, options) {		
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g,'').indexOf('Z') !== -1);

		// Strict parse requires the timeString to match the timeFormat exactly
		var strictParse = function(f, s, o){

			// pattern for standard and localized AM/PM markers
			var getPatternAmpm = function(amNames, pmNames) {
				var markers = [];
				if (amNames) {
					$.merge(markers, amNames);
				}
				if (pmNames) {
					$.merge(markers, pmNames);
				}
				markers = $.map(markers, function(val) {
					return val.replace(/[.*+?|()\[\]{}\\]/g, '\\$&amp;amp;');
				});
				return '(' + markers.join('|') + ')?';
			};

			// figure out position of time elements.. cause js cant do named captures
			var getFormatPositions = function(timeFormat) {
				var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
					orders = {
						h: -1,
						m: -1,
						s: -1,
						l: -1,
						c: -1,
						t: -1,
						z: -1
					};

				if (finds) {
					for (var i = 0; i &amp;lt; finds.length; i++) {
						if (orders[finds[i].toString().charAt(0)] == -1) {
							orders[finds[i].toString().charAt(0)] = i + 1;
						}
					}
				}
				return orders;
			};

			var regstr = '^' + f.toString()
					.replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
							var ml = match.length;
							switch (match.charAt(0).toLowerCase()) {
								case 'h': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'm': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 's': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'l': return '(\\d?\\d?\\d)';
								case 'c': return '(\\d?\\d?\\d)';
								case 'z': return '(z|[-+]\\d\\d:?\\d\\d|\\S+)?';
								case 't': return getPatternAmpm(o.amNames, o.pmNames);
								default:    // literal escaped in quotes
									return '(' + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function (m) { return "\\" + m; }) + ')?';
							}
						})
					.replace(/\s/g, '\\s?') +
					o.timeSuffix + '$',
				order = getFormatPositions(f),
				ampm = '',
				treg;

			treg = s.match(new RegExp(regstr, 'i'));

			var resTime = {
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0
			};

			if (treg) {
				if (order.t !== -1) {
					if (treg[order.t] === undefined || treg[order.t].length === 0) {
						ampm = '';
						resTime.ampm = '';
					} else {
						ampm = $.inArray(treg[order.t].toUpperCase(), o.amNames) !== -1 ? 'AM' : 'PM';
						resTime.ampm = o[ampm == 'AM' ? 'amNames' : 'pmNames'][0];
					}
				}

				if (order.h !== -1) {
					if (ampm == 'AM' &amp;amp;&amp;amp; treg[order.h] == '12') {
						resTime.hour = 0; // 12am = 0 hour
					} else {
						if (ampm == 'PM' &amp;amp;&amp;amp; treg[order.h] != '12') {
							resTime.hour = parseInt(treg[order.h], 10) + 12; // 12pm = 12 hour, any other pm = hour + 12
						} else {
							resTime.hour = Number(treg[order.h]);
						}
					}
				}

				if (order.m !== -1) {
					resTime.minute = Number(treg[order.m]);
				}
				if (order.s !== -1) {
					resTime.second = Number(treg[order.s]);
				}
				if (order.l !== -1) {
					resTime.millisec = Number(treg[order.l]);
				}
				if (order.c !== -1) {
					resTime.microsec = Number(treg[order.c]);
				}
				if (order.z !== -1 &amp;amp;&amp;amp; treg[order.z] !== undefined) {
					resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z]);
				}


				return resTime;
			}
			return false;
		};// end strictParse

		// First try JS Date, if that fails, use strictParse
		var looseParse = function(f,s,o){
			try{
				var d = new Date('2012-01-01 '+ s);
				if(isNaN(d.getTime())){
					d = new Date('2012-01-01T'+ s);
					if(isNaN(d.getTime())){
						d = new Date('01/01/2012 '+ s);
						if(isNaN(d.getTime())){
							throw "Unable to parse time with native Date: "+ s;
						}
					}
				}

				return {
					hour: d.getHours(),
					minute: d.getMinutes(),
					second: d.getSeconds(),
					millisec: d.getMilliseconds(),
					microsec: d.getMicroseconds(),
					timezone: d.getTimezoneOffset()*-1
				};
			}
			catch(err){
				try{
					return strictParse(f,s,o);
				}
				catch(err2){
					$.timepicker.log("Unable to parse \ntimeString: "+ s +"\ntimeFormat: "+ f);
				}				
			}
			return false;
		}; // end looseParse
		
		if(typeof o.parse === "function"){
			return o.parse(timeFormat, timeString, o);
		}
		if(o.parse === 'loose'){
			return looseParse(timeFormat, timeString, o);
		}
		return strictParse(timeFormat, timeString, o);
	};

	/*
	* Public utility to format the time
	* format = string format of the time
	* time = a {}, not a Date() for timezones
	* options = essentially the regional[].. amNames, pmNames, ampm
	*/
	$.datepicker.formatTime = function(format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			timezone: 0
		}, time);

		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);

		if (hour &amp;gt; 11) {
			ampmName = options.pmNames[0];
		}

		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|('.*?'|".*?"))/g, function(match) {
		switch (match) {
			case 'HH':
				return ('0' + hour).slice(-2);
			case 'H':
				return hour;
			case 'hh':
				return ('0' + convert24to12(hour)).slice(-2);
			case 'h':
				return convert24to12(hour);
			case 'mm':
				return ('0' + time.minute).slice(-2);
			case 'm':
				return time.minute;
			case 'ss':
				return ('0' + time.second).slice(-2);
			case 's':
				return time.second;
			case 'l':
				return ('00' + time.millisec).slice(-3);
			case 'c':
				return ('00' + time.microsec).slice(-3);
			case 'z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, false);
			case 'Z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, true);
			case 'T': 
				return ampmName.charAt(0).toUpperCase();
			case 'TT': 
				return ampmName.toUpperCase();
			case 't':
				return ampmName.charAt(0).toLowerCase();
			case 'tt':
				return ampmName.toLowerCase();
			default:
				return match.replace(/\'/g, "") || "'";
			}
		});

		tmptime = $.trim(tmptime);
		return tmptime;
	};

	/*
	* the bad hack :/ override datepicker so it doesnt close on select
	// inspired: http://stackoverflow.com/questions/1252512/jquery-datepicker-prevent-closing-picker-when-clicking-a-date/1762378#1762378
	*/
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function(id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			tp_inst._limitMinMaxDateTime(inst, true);
			inst.inline = inst.stay_open = true;
			//This way the onSelect handler called from calendarpicker get the full dateTime
			this._base_selectDate(id, dateStr);
			inst.inline = inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst);
		} else {
			this._base_selectDate(id, dateStr);
		}
	};

	/*
	* second bad hack :/ override datepicker so it triggers an event when changing the input field
	* and does not redraw the datepicker on every selectDate event
	*/
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function(inst) {

		// don't popup the datepicker if there is another instance already opened
		var input = inst.input[0];
		if ($.datepicker._curInst &amp;amp;&amp;amp; $.datepicker._curInst != inst &amp;amp;&amp;amp; $.datepicker._datepickerShowing &amp;amp;&amp;amp; $.datepicker._lastInput != input) {
			return;
		}

		if (typeof(inst.stay_open) !== 'boolean' || inst.stay_open === false) {

			this._base_updateDatepicker(inst);

			// Reload the time control when changing something in the input text field.
			var tp_inst = this._get(inst, 'timepicker');
			if (tp_inst) {
				tp_inst._addTimePicker(inst);
			}
		}
	};

	/*
	* third bad hack :/ override datepicker so it allows spaces and colon in the input field
	*/
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if ($.datepicker._get(inst, 'constrainInput')) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null? tp_inst._defaults.showTimezone : tp_inst.support.timezone,					
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat')),
					datetimeChars = tp_inst._defaults.timeFormat.toString()
											.replace(/[hms]/g, '')
											.replace(/TT/g, ampm ? 'APM' : '')
											.replace(/Tt/g, ampm ? 'AaPpMm' : '')
											.replace(/tT/g, ampm ? 'AaPpMm' : '')
											.replace(/T/g, ampm ? 'AP' : '')
											.replace(/tt/g, ampm ? 'apm' : '')
											.replace(/t/g, ampm ? 'ap' : '') + 
											" " + tp_inst._defaults.separator + 
											tp_inst._defaults.timeSuffix + 
											(tz ? tp_inst._defaults.timezoneList.join('') : '') + 
											(tp_inst._defaults.amNames.join('')) + (tp_inst._defaults.pmNames.join('')) + 
											dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr &amp;lt; ' ' || !dateChars || datetimeChars.indexOf(chr) &amp;gt; -1);
			}
		}

		return $.datepicker._base_doKeyPress(event);
	};

	/*
	* Fourth bad hack :/ override _updateAlternate function used in inline mode to init altField
	*/
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	/* Update any alternate field to synchronise with the main field. */
	$.datepicker._updateAlternate = function(inst) {
		var tp_inst = this._get(inst, 'timepicker');
		if(tp_inst){
			var altField = tp_inst._defaults.altField;
			if (altField) { // update alternate field too
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = '', 
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator, 
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if(!tp_inst._defaults.timeOnly &amp;amp;&amp;amp; !tp_inst._defaults.altFieldTimeOnly &amp;amp;&amp;amp; date !== null){
					if(tp_inst._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime;
					}
					else{
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime;
					}
				}
				$(altField).val(altFormattedDateTime);
			}
		}
		else{
			$.datepicker._base_updateAlternate(inst);
		}
	};

	/*
	* Override key up event to sync manual input changes.
	*/
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst);
				} catch (err) {
					$.timepicker.log(err);
				}
			}
		}

		return $.datepicker._base_doKeyUp(event);
	};

	/*
	* override "Today" button to also grab the time.
	*/
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function(id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		this._base_gotoToday(id);
		var tp_inst = this._get(inst, 'timepicker');
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		$('.ui-datepicker-today', $dp).click();
	};

	/*
	* Disable &amp;amp; enable the Time in the datetimepicker
	*/
	$.datepicker._disableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst);
		}
	};

	$.datepicker._enableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst); // Could be disabled on page load
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create our own set time function
	*/
	$.datepicker._setTime = function(inst, date) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var defaults = tp_inst._defaults;

			// calling _setTime with no date sets time to defaults
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;

			//check if within min/max times.. 
			tp_inst._limitMinMaxDateTime(inst, true);

			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create new public method to set only time, callable as $().datepicker('setTime', date)
	*/
	$.datepicker._setTimeDatepicker = function(target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date == "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec);
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds());
				}
				if (tp_date.toString() == 'Invalid Date') {
					tp_date = undefined;
				}
				this._setTime(inst, tp_date);
			}
		}

	};

	/*
	* override setDate() to allow setting time too within Date object
	*/
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function(target, date) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		if(typeof(date) === 'string'){
			date = new Date(date);
			if(!date.getTime()){
				$.timepicker.log("Error creating Date object from string.");
			}
		}

		var tp_inst = this._get(inst, 'timepicker');
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds());
		} else {
			tp_date = date;
		}
		
		// This is important if you are using the timezone option, javascript's Date 
		// object will only return the timezone offset for the current locale, so we 
		// adjust it accordingly.  If not using timezone option this won't matter..
		// If a timezone is different in tp, keep the timezone as is
		if(tp_inst){
			// look out for DST if tz wasn't specified
			if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
				tp_inst.timezone = tp_date.getTimezoneOffset()*-1;
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone);
		}

		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true);
	};

	/*
	* override getDate() to allow getting time too within Date object
	*/
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function(target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			// if it hasn't yet been defined, grab from field
			if(inst.lastVal === undefined){
				this._setDateFromField(inst, noDefault);
			}

			var date = this._getDate(inst);
			if (date &amp;amp;&amp;amp; tp_inst._parseTime($(target).val(), tp_inst.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);

				// This is important if you are using the timezone option, javascript's Date 
				// object will only return the timezone offset for the current locale, so we 
				// adjust it accordingly.  If not using timezone option this won't matter..
				if(tp_inst.timezone != null){
					// look out for DST if tz wasn't specified
					if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
						tp_inst.timezone = date.getTimezoneOffset()*-1;
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
				}
			}
			return date;
		}
		return this._base_getDateDatepicker(target, noDefault);
	};

	/*
	* override parseDate() because UI 1.8.14 throws an error about "Extra characters"
	* An option in datapicker to ignore extra format characters would be nicer.
	*/
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function(format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings);
		} catch (err) {
			// Hack!  The error message ends with a colon, a space, and
			// the "extra" characters.  We rely on that instead of
			// attempting to perfectly reproduce the parsing algorithm.
			if (err.indexOf(":") &amp;gt;= 0) {
				date = this._base_parseDate(format, value.substring(0,value.length-(err.length-err.indexOf(':')-2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format);
			} else {
				throw err;
			}
		}
		return date;
	};

	/*
	* override formatDate to set date with time to the input
	*/
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function(inst, day, month, year) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val();
		}
		return this._base_formatDate(inst);
	};

	/*
	* override options setter to add time to maxDate(Time) and minDate(Time). MaxDate
	*/
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function(target, name, value) {
		var inst = this._getInst(target),
	        name_clone;
		if (!inst) {
			return null;
		}

		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop;
		    if (typeof name == 'string') { // if min/max was set with the string
		        if (name === 'minDate' || name === 'minDateTime') {
		            min = value;
		        } else if (name === 'maxDate' || name === 'maxDateTime') {
		            max = value;
		        } else if (name === 'onSelect') {
		            onselect = value;
		        } else if (overrides.hasOwnProperty(name)) {
		            if (typeof (value) === 'undefined') {
		                return overrides[name];
		            }
		            fns[name] = value;
		            name_clone = {}; //empty results in exiting function after overrides updated
		        }
		    } else if (typeof name == 'object') { //if min/max was set with the JSON
		        if (name.minDate) {
		            min = name.minDate;
		        } else if (name.minDateTime) {
		            min = name.minDateTime;
		        } else if (name.maxDate) {
		            max = name.maxDate;
		        } else if (name.maxDateTime) {
		            max = name.maxDateTime;
		        }
		        for (prop in overrides) {
		            if (overrides.hasOwnProperty(prop) &amp;amp;&amp;amp; name[prop]) {
		                fns[prop] = name[prop];
		            }
		        }
		    }
		    for (prop in fns) {
		        if (fns.hasOwnProperty(prop)) {
		            overrides[prop] = fns[prop];
		            if (!name_clone) { name_clone = $.extend({}, name);}
		            delete name_clone[prop];
		        }
		    }
		    if (name_clone &amp;amp;&amp;amp; isEmptyObject(name_clone)) { return; }
		    if (min) { //if min was set
		        if (min === 0) {
		            min = new Date();
		        } else {
		            min = new Date(min);
		        }
		        tp_inst._defaults.minDate = min;
		        tp_inst._defaults.minDateTime = min;
		    } else if (max) { //if max was set
		        if (max === 0) {
		            max = new Date();
		        } else {
		            max = new Date(max);
		        }
		        tp_inst._defaults.maxDate = max;
		        tp_inst._defaults.maxDateTime = max;
		    } else if (onselect) {
		        tp_inst._defaults.onSelect = onselect;
		    }
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name);
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
	};
	
	/*
	* jQuery isEmptyObject does not check hasOwnProperty - if someone has added to the object prototype,
	* it will return false for all objects
	*/
	var isEmptyObject = function(obj) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(obj)) {
				return false;
			}
		}
		return true;
	};

	/*
	* jQuery extend now ignores nulls!
	*/
	var extendRemove = function(target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] === null || props[name] === undefined) {
				target[name] = props[name];
			}
		}
		return target;
	};

	/*
	* Determine by the time format which units are supported
	* Returns an object of booleans for each unit
	*/
	var detectSupport = function(timeFormat){
		var tf = timeFormat.replace(/\'.*?\'/g,'').toLowerCase(), // removes literals
			isIn = function(f, t){ // does the format contain the token?
					return f.indexOf(t) !== -1? true:false; 
				};
		return {
				hour: isIn(tf,'h'),
				minute: isIn(tf,'m'),
				second: isIn(tf,'s'),
				millisec: isIn(tf,'l'),
				microsec: isIn(tf,'c'),
				timezone: isIn(tf,'z'),
				ampm: isIn(tf,'t') &amp;amp;&amp;amp; isIn(timeFormat,'h'),
				iso8601: isIn(timeFormat, 'Z')
			};
	};

	/*
	* Converts 24 hour format into 12 hour
	* Returns 12 hour without leading 0
	*/
	var convert24to12 = function(hour) {
		if (hour &amp;gt; 12) {
			hour = hour - 12;
		}

		if (hour === 0) {
			hour = 12;
		}

		return String(hour);
	};

	/*
	* Splits datetime string into date ans time substrings.
	* Throws exception when date can't be parsed
	* Returns [dateString, timeString]
	*/
	var splitDateTime = function(dateFormat, dateTimeString, dateSettings, timeSettings) {
		try {
			// The idea is to get the number separator occurances in datetime and the time format requested (since time has 
			// fewer unknowns, mostly numbers and am/pm). We will use the time pattern to split.
			var separator = timeSettings &amp;amp;&amp;amp; timeSettings.separator ? timeSettings.separator : $.timepicker._defaults.separator,
				format = timeSettings &amp;amp;&amp;amp; timeSettings.timeFormat ? timeSettings.timeFormat : $.timepicker._defaults.timeFormat,
				timeParts = format.split(separator), // how many occurances of separator may be in our format?
				timePartsLen = timeParts.length,
				allParts = dateTimeString.split(separator),
				allPartsLen = allParts.length;

			if (allPartsLen &amp;gt; 1) {
				return [
						allParts.splice(0,allPartsLen-timePartsLen).join(separator),
						allParts.splice(0,timePartsLen).join(separator)
					];
			}

		} catch (err) {
			$.timepicker.log('Could not split the date from the time. Please check the following datetimepicker options' +
					"\nthrown error: " + err +
					"\ndateTimeString" + dateTimeString +
					"\ndateFormat = " + dateFormat +
					"\nseparator = " + timeSettings.separator +
					"\ntimeFormat = " + timeSettings.timeFormat);

			if (err.indexOf(":") &amp;gt;= 0) {
				// Hack!  The error message ends with a colon, a space, and
				// the "extra" characters.  We rely on that instead of
				// attempting to perfectly reproduce the parsing algorithm.
				var dateStringLength = dateTimeString.length - (err.length - err.indexOf(':') - 2),
					timeString = dateTimeString.substring(dateStringLength);

				return [$.trim(dateTimeString.substring(0, dateStringLength)), $.trim(dateTimeString.substring(dateStringLength))];

			} else {
				throw err;
			}
		}
		return [dateTimeString, ''];
	};

	/*
	* Internal function to parse datetime interval
	* Returns: {date: Date, timeObj: Object}, where
	*   date - parsed date without time (type Date)
	*   timeObj = {hour: , minute: , second: , millisec: , microsec: } - parsed time. Optional
	*/
	var parseDateTimeInternal = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var date;
		var splitRes = splitDateTime(dateFormat, dateTimeString, dateSettings, timeSettings);
		date = $.datepicker._base_parseDate(dateFormat, splitRes[0], dateSettings);
		if (splitRes[1] !== '') {
			var timeString = splitRes[1],
				parsedTime = $.datepicker.parseTime(timeFormat, timeString, timeSettings);

			if (parsedTime === null) {
				throw 'Wrong time format';
			}
			return {
				date: date,
				timeObj: parsedTime
			};
		} else {
			return {
				date: date
			};
		}
	};

	/*
	* Internal function to set timezone_select to the local timezone
	*/
	var selectLocalTimezone = function(tp_inst, date) {
		if (tp_inst &amp;amp;&amp;amp; tp_inst.timezone_select) {
			var now = typeof date !== 'undefined' ? date : new Date();
			tp_inst.timezone_select.val(now.getTimezoneOffset()*-1);
		}
	};

	/*
	* Create a Singleton Insance
	*/
	$.timepicker = new Timepicker();

	/**
	 * Get the timezone offset as string from a date object (eg '+0530' for UTC+5.5)
	 * @@param  number if not a number this value is returned
	 * @@param boolean if true formats in accordance to iso8601 "+12:45"
	 * @@return string
	 */
	$.timepicker.timezoneOffsetString = function(tzMinutes, iso8601) {
		if(isNaN(tzMinutes) || tzMinutes &amp;gt; 840){
			return tzMinutes;
		}

		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601? ':':'',
			tz = (off &amp;gt;= 0 ? '+' : '-') + ('0' + (hours * 101).toString()).slice(-2) + iso + ('0' + (minutes * 101).toString()).slice(-2);
		
		if(tz == '+00:00'){
			return 'Z';
		}
		return tz;
	};

	/**
	 * Get the number in minutes that represents a timezone string
	 * @@param  string formated like "+0500", "-1245"
	 * @@return number
	 */
	$.timepicker.timezoneOffsetNumber = function(tzString) {
		tzString = tzString.toString().replace(':',''); // excuse any iso8601, end up with "+1245"

		if(tzString.toUpperCase() === 'Z'){ // if iso8601 with Z, its 0 minute offset
			return 0;
		}

		if(!/^(\-|\+)\d{4}$/.test(tzString)){ // possibly a user defined tz, so just give it back
			return tzString;
		}

		return ((tzString.substr(0,1) =='-'? -1 : 1) * // plus or minus
					((parseInt(tzString.substr(1,2),10)*60) + // hours (converted to minutes)
					parseInt(tzString.substr(3,2),10))); // minutes
	};

	/**
	 * No way to set timezone in js Date, so we must adjust the minutes to compensate. (think setDate, getDate)
	 * @@param  date
	 * @@param  string formated like "+0500", "-1245"
	 * @@return date
	 */
	$.timepicker.timezoneAdjust = function(date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if(!isNaN(toTz)){
			date.setMinutes(date.getMinutes()*1 + (date.getTimezoneOffset()*-1 - toTz*1) );
		}
		return date;
	};

	/**
	 * Calls `timepicker()` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * n.b. The input value must be correctly formatted (reformatting is not supported)
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the timepicker() call
	 * @@return jQuery
	 */
	$.timepicker.timeRange = function(startTime, endTime, options) {
		return $.timepicker.handleRange('timepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datetimepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@return jQuery
	 */
	$.timepicker.datetimeRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datetimepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.dateRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.handleRange = function(method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0, // min allowed interval in milliseconds
			maxInterval: 0, // max allowed interval in milliseconds
			start: {},      // options for start picker
			end: {}         // options for end picker
		}, options);

		$.fn[method].call(startTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), endTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), endTime, 'minDate');
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), startTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), startTime, 'maxDate');
			}
		}, options, options.end));

		checkDates(startTime, endTime);
		selected(startTime, endTime, 'minDate');
		selected(endTime, startTime, 'maxDate');

		function checkDates(changed, other) {
			var startdt = startTime[method]('getDate'),
				enddt = endTime[method]('getDate'),
				changeddt = changed[method]('getDate');

			if(startdt !== null){
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());

				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);

				if(options.minInterval &amp;gt; 0 &amp;amp;&amp;amp; minDate &amp;gt; enddt){ // minInterval check
					endTime[method]('setDate',minDate);
				}
				else if(options.maxInterval &amp;gt; 0 &amp;amp;&amp;amp; maxDate &amp;lt; enddt){ // max interval check
					endTime[method]('setDate',maxDate);
				}
				else if (startdt &amp;gt; enddt) {
					other[method]('setDate',changeddt);
				}
			}
		}

		function selected(changed, other, option) {
			if (!changed.val()) {
				return;
			}
			var date = changed[method].call(changed, 'getDate');
			if(date !== null &amp;amp;&amp;amp; options.minInterval &amp;gt; 0){
				if(option == 'minDate'){
					date.setMilliseconds(date.getMilliseconds() + options.minInterval); 
				}
				if(option == 'maxDate'){
					date.setMilliseconds(date.getMilliseconds() - options.minInterval);
				}
			}
			if (date.getTime) {
				other[method].call(other, 'option', option, date);
			}
		}
		return $([startTime.get(0), endTime.get(0)]);
	};

	/**
	 * Log error or data to the console during error or debugging
	 * @@param  Object err pass any type object to log to the console during error or debugging
	 * @@return void
	 */
	$.timepicker.log = function(err){
		if(window.console){
			console.log(err);
		}
	};

	/*
	* Microsecond support
	*/
	if(!Date.prototype.getMicroseconds){
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function(){ return this.microseconds; };
		Date.prototype.setMicroseconds = function(m){ 
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m/1000));
			this.microseconds = m%1000;
			return this;
		};
	}

	/*
	* Keep up with the version
	*/
	$.timepicker.version = "1.3.1";

})(jQuery);
jQuery.noConflict();
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;datetimepicker-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;e73a652e-09fc-4c71-8e7a-e2525a2d2a99&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
function replaceAllString(oriStr, strTarget, strSubString ){
   var strText = oriStr;
   var intIndexOfMatch = strText.indexOf( strTarget );
   while (intIndexOfMatch != -1){
      strText = strText.replace( strTarget, strSubString )
      intIndexOfMatch = strText.indexOf( strTarget );
   }
   return( strText );
}
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&amp;amp;]" + name + "=([^&amp;amp;#]*)"),
    results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
};


   var jobName= getParameterByName('job')
   var fromDate= getParameterByName('fromDate')
   var toDate= getParameterByName('toDate')
   var limit= getParameterByName('limit')
   var selectedIstIid = getParameterByName('IstIid')

  $("#jobname").ready(function(){
   $("#jobname").text(jobName)
   var convertedJobName = replaceAllString(jobName, ".", "_")
   $("#IstIid" + convertedJobName).ready(function(){
     $("#IstIid" + convertedJobName).css("display","block")
     $("#select_" + convertedJobName).ready(function(){
        $("#select_" + convertedJobName).val(selectedIstIid)
     });
   });
 });

  $("#fromDate").ready(function(){
   $("#from-date").val(fromDate)
 });

  $("#toDate").ready(function(){
   $("#to-date").val(toDate)
 });

  $("#limit").ready(function(){
   if(limit!=""){
    $("#limit").val(limit)
   }
 });
 // Get data with ajax
 function ajax_getData(jobName,fromDate,toDate,limit ){
       var convertedJobName = replaceAllString(jobName, ".", "_")
       var istIid = $("#select_" + convertedJobName).val()
       window.location="/xwiki/bin/view/WiperDog/WebHome?job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid="+istIid;
 			/*$.ajax({
			 type: "GET",
			 url:"/xwiki/bin/get/Sandbox/DescriptionForJob?outputSyntax=plain&amp;amp;job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid"+selectedIstIid,
			 success : function(result){
				$("#jobname").html(jobName)
				$("#display").text('[[]]' + result)
			 }
		   });*/
 }
	$("#treemenu2 a").click(function(){
		 var limit = 10
		 var fromDate=""
		 var toDate = ""
		 jobName= $(this).text()
                 $("#jobname").html(jobName)
                 var convertedJobName = replaceAllString(jobName, ".", "_")
                 $("#listIstIid &amp;gt; div").css("display","none")
                 $("#IstIid" + convertedJobName).css("display","block")
		 //ajax_getData(jobName,fromDate,toDate,limit )

	});

	$("#from-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
		dateFormat: 'yy-mm-dd',
	});
	$("#to-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
			dateFormat: 'yy-mm-dd',

	});
	 $("#get-data").on("click",function(){
		var fromDate = $("#from-date").val()
		var toDate =  $("#to-date").val()
		 if( toDate!= "" ){
			  if(fromDate != ""){
				  if($("#from-date").datepicker( "getDate" ) &amp;gt; $("#to-date").datepicker( "getDate" )){
				  alert("'From date' cannot start later than 'To date'")
				  return false
				  }
			  }
		 }
		 limit = $("#limit").val()
		 ajax_getData(jobName,fromDate,toDate,limit )
                 
                 /** Get livetable data */
                 buildLivetable($("#jobname").val(),$("#limit").val(),fromDate ,toDate, selectedIstIid);

	});
        function buildLivetable(jobName, limit, fromDate, toDate, istIid){      		
		var dataModelUrl = '/xwiki/bin/get/Lib/LivetableDataAdapter?outputSyntax=plain&amp;amp;job='+jobName +'&amp;amp;limit='+limit+'&amp;amp;fromDate='
                +fromDate + '&amp;amp;toDate=' + toDate +   '&amp;amp;pager=pager2&amp;amp;genp=1&amp;amp;istIid=localhost-information_schema'

		var jqxhr = $.getJSON(dataModelUrl, function(data) {
			$("#livetableList").jqGrid(data);
			$("#livetableList").jqGrid('navGrid', "#livetablePager", {
			    edit : false,
			    add : false,
			    del : false
			});
		})
        }//end function

jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;process&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;881686cc-1bfc-456e-b8ab-71334c4a45e5&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){

$(function () {
    function drawLineChart(xAxis, series, container, data_detail){
        var dataXAxis = xAxis
        var dataSeries = series
        var detail = data_detail

			$('#containerline' + container).highcharts({

				chart: {
					type:'line'
				},
				title: {
					text: container
				},
				tooltip :{
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				xAxis: dataXAxis ,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				series: dataSeries
			});
		};

		function drawBarChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerbar' + container).highcharts({
				chart: {
					type: 'column'
				},
				title: {
					text: container
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {

					column: {
						pointPadding: 0.2,
						borderWidth: 0
					}
				},
				series: dataSeries
			});
		}

		function drawAreaChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail
			$('#containerarea' + container).highcharts({
				chart: {
					type: 'area'
				},
				title: {
					text: container
				},
				subtitle: {
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					},
					labels: {
						formatter: function() {
							return this.value / 1000;
						}
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {
					area: {
						stacking: 'normal',
						lineColor: '#666666',
						lineWidth: 1,
						marker: {
							lineWidth: 1,
							lineColor: '#666666'
						}
					}
				},
				series: dataSeries
			});
		};

		function drawPieChart(data, container){
			var dataPie = data
			$(document).ready(function () {
				// Build the chart
				$('#container' + container).highcharts({
					chart: {
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: dataPie[0].name
					},
					tooltip: {
						pointFormat: '{series.name}: &amp;lt;b&amp;gt;{point.percentage:.1f}%&amp;lt;/b&amp;gt;'
					},
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							dataLabels: {
								enabled: false
							},
							showInLegend: true
						}
					},
					series: dataPie
				});
			});
		}

		// LINE
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonline_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonline");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Line chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						if(data_all[0][i].series[0].name == null){
							data_all[0][i].series[0].name = lstContainer[0][i]
						}
						drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
					}
				}
			}
		});

		// BAR
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonbar_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonbar");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Bar chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						drawBarChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
					}
				}
			}
		});

		// AREA
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonarea_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonarea");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				// data to display on tooltip
				var data_detail = data_all[0]
				// draw Area Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					drawAreaChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
				}
			}
		});

		// PIE
		$("#piechart").ready(function(){

			var array = $("#jsons&amp;gt;.jsonpie");
			var arrayContainer = $("#jsons&amp;gt;.lstcontainerpie");
			var lstContainer = [];
			var data_all = [];
			for(var i=0;i&amp;lt;array.length;i++){
				data_all[i] = jQuery.parseJSON(array[i].value)
				lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)

			}
			if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
				// data to display on tooltip
				// draw Pie Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					var finalData = []
					finalData[0] = data_all[0][i]
					drawPieChart(finalData, lstContainer[0][i])
				}
			}
		});
	});
	jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;d5873d92-b78b-42fc-9407-46d166204b88&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;/* css for timepicker */
.ui-timepicker-div .ui-widget-header { 
margin-bottom: 8px;
 }

.ui-timepicker-div dl { text-align: left; }
.ui-timepicker-div dl dt { height: 25px; margin-bottom: -25px; }
.ui-timepicker-div dl dd { margin: 0 10px 10px 65px; }
.ui-timepicker-div td { font-size: 90%; }
.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }

.ui-timepicker-rtl{ direction: rtl; }
.ui-timepicker-rtl dl { text-align: right; }
.ui-timepicker-rtl dl dd { margin: 0 65px 10px 10px; }
#ui-datepicker-div{
 position:relative;
 width:auto;
 height:auto
}
&lt;/code&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;datetimepicker -css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;1201fb1a-e9c1-4731-8c74-2ea8c0071959&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;.displayblock {
  border:2px solid;
  -webkit-border-radius:6px;
  background:gray;
  float: left;
  width:100%;
}

.displaypie {
  border:1px solid;
  -webkit-border-radius:6px;
  background:gray;
  width: 48%;
  float: left; 
  height: 300px;
}

.subtype {
  margin-top: 50px;
  font-size: 2em;
  color: red;
}&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;content&gt;{{include document="Lib.DataToDrawChart"/}}
{{include document="Lib.MongoDBConnection"/}}
{{velocity}}
$xwiki.jsx.use('Lib.JQueryUILib')
$xwiki.ssx.use('Lib.MenuGenerator')
$xwiki.jsx.use('Lib.MenuGenerator')
$xwiki.ssx.use('Lib.JQueryUILib')
{{/velocity}}
{{include document="Lib.MenuGenerator"/}}
{{html wiki="true" clean="false"}}
&amp;lt;div id="viewer"&amp;gt;
&amp;lt;table style="text-align:left"  &amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th &amp;gt;Job name&amp;lt;/th&amp;gt;
  &amp;lt;td colspan=3&amp;gt;&amp;lt;div id="jobname"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
{{groovy}}
import org.xwiki.context.*

def ec = services.component.getInstance(Execution.class).getContext()
def mapJobIstIid = ec.getProperty("mapJobIstIid")

println '{{html clean="false" wiki="false"}}'
println '&amp;lt;tr&amp;gt;'
println '&amp;lt;th&amp;gt;IstIid&amp;lt;/th&amp;gt;'
println '&amp;lt;td colspan=3&amp;gt;'
mapJobIstIid.each{jobEntry-&amp;gt;
  def convertedJobKey = jobEntry.key.replaceAll("\\.","_")
  println "&amp;lt;div id='listIstIid'&amp;gt;"
  println "&amp;lt;div id=IstIid${convertedJobKey} style='display:none'&amp;gt;"
  println "&amp;lt;select id=select_${convertedJobKey}&amp;gt;"
  jobEntry.value.each{
     println "&amp;lt;option value=\"$it\"&amp;gt;$it&amp;lt;/option&amp;gt;"
  }
  println "&amp;lt;/select&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
}
println '&amp;lt;/td&amp;gt;'
println '&amp;lt;/tr&amp;gt;'
println '{{/html}}'
{{/groovy}}
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data monitor from&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="from-date" id="from-date"/&amp;gt;&amp;lt;/td&amp;gt;
  &amp;lt;th&amp;gt;Data monitor to&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="to-date" id="to-date"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data records limit &amp;lt;/th&amp;gt;
  &amp;lt;td &amp;gt;
     &amp;lt;select id="limit"&amp;gt;
       &amp;lt;option value=5&amp;gt;5&amp;lt;/option&amp;gt;
       &amp;lt;option value=10&amp;gt;10&amp;lt;/option&amp;gt;
       &amp;lt;option value=15&amp;gt;15&amp;lt;/option&amp;gt;
       &amp;lt;option value=20&amp;gt;20&amp;lt;/option&amp;gt;
     &amp;lt;/select&amp;gt;
  &amp;lt;/td&amp;gt;
  &amp;lt;td colspan=3 &amp;gt;&amp;lt;input type="button" value="View Data" id="get-data" class="button"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr style="display:none"&amp;gt;
    &amp;lt;td colspan=3&amp;gt;
        &amp;lt;table id="livetableList"&amp;gt;&amp;lt;/table&amp;gt; 
        &amp;lt;div id="livetablePager"&amp;gt;&amp;lt;/div&amp;gt;
    &amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;&amp;lt;div id="display"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
&amp;lt;/table&amp;gt;

&amp;lt;/div&amp;gt; 
 &amp;lt;/body&amp;gt;

{{/html}}
{{groovy}}
import groovy.json.*
xwiki.jsx.use("Lib.Highcharts")

if(request.xpage == "plain") {
	response.setContentType('text/plain')
}

def listData = []
def job = request.get("job")
def fromDate = request.get("fromDate")
def toDate = request.get("toDate")
def limit= (request.get("limit")!=null)?request.get("limit").toInteger():10
def istIid = request.get("IstIid")

def str= "No data to retrieved !"
def result = null
if(job != "" &amp;amp;&amp;amp; job != null &amp;amp;&amp;amp; istIid != null &amp;amp;&amp;amp; istIid != ""){
	MongoDBConnection.getConnection()
	if(fromDate != "" || toDate != ""){
		result = MongoDBConnection.getDataInPeriod(job,fromDate,toDate,limit,istIid)
	} else {
		result = MongoDBConnection.getDataAllFields(job,limit,istIid)
        }
MongoDBConnection.closeConnection()
} else {
   println "{{warning}}There are no selected job or IstIid{{/warning}}"
}

if( (result != null) &amp;amp;&amp;amp; (result.size() &amp;gt; 0) &amp;amp;&amp;amp; (result[0].KEYEXPR != null)&amp;amp;&amp;amp;!(result[0].KEYEXPR instanceof List )){
if(result[0].type == "Subtyped") {
    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
    def dataSubtype = DataToDrawChart.getDataToDrawSubtype(result)
    def listKey = []
    dataSubtype.each {key,value -&amp;gt;
        listKey.add(key)
    }
    def jsonkey = com.mongodb.util.JSON.serialize(listKey)
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$jsonkey&amp;lt;/textarea&amp;gt;"

    dataSubtype.each {key,value -&amp;gt;
        println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +'&amp;lt;/div&amp;gt;'
        println "-----"
        def dataLine = []
        def dataBar = []
        def dataPie = []
        def dataArea = []
        if(DataToDrawChart.getDataToDrawLine(value) != []) {
            dataLine = DataToDrawChart.getDataToDrawLine(value)
        }
        if(DataToDrawChart.getDataToDrawBar(value) != []) {
            dataBar = DataToDrawChart.getDataToDrawBar(value)
        }
        if(DataToDrawChart.getDataToDrawPie(value) != []) {
            dataPie = DataToDrawChart.getDataToDrawPie(value)
        }
        if(DataToDrawChart.getDataToDrawArea(value) != []) {
            dataArea = DataToDrawChart.getDataToDrawArea(value)
        }

        def chartColumnsLine
        def chartColumnsBar 
        def chartColumnsArea 
        def lstName
        if(dataLine.size() &amp;gt; 0 ){
            chartColumnsLine = dataLine[0].chart_columns
        }
        if(dataBar.size() &amp;gt; 0){
            chartColumnsBar = dataBar[0].chart_columns
        }
        if(dataArea.size() &amp;gt; 0 ){
            chartColumnsArea = dataArea[0].chart_columns
        }
        if(dataPie.size() &amp;gt; 0 ){
            lstName = dataPie['name']
        }

        def tmpListNameContainer = []
	for(def nameContainer in lstName){
	   nameContainer = nameContainer.replaceAll("\\.", "_")
	   tmpListNameContainer.add(nameContainer)
	}
        def jsonPie
        def jsonLine
	def jsonBar
        def jsonArea
        if(dataPie != []) {
	    jsonPie = com.mongodb.util.JSON.serialize(dataPie)
        }
        if(dataLine != []) {
	    jsonLine = com.mongodb.util.JSON.serialize(dataLine)
        }
        if(dataBar != []) {
            jsonBar = com.mongodb.util.JSON.serialize(dataBar)
        }
        if(dataArea != []) {
	    jsonArea = com.mongodb.util.JSON.serialize(dataArea)
        }

	def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
	def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
	def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
	def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

	println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
        if(jsonLine != null) {
	    println "&amp;lt;textarea id=\"jsonline_$key\" &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;" 
        }
	if(jsonBar != null) {
            println "&amp;lt;textarea id=\"jsonbar_$key\"&amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
 	    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
        }
        if(jsonPie != null) {
	    println "&amp;lt;textarea id=\"jsonpie_$key\" &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
        }
        if(jsonArea != null) {
	    println "&amp;lt;textarea id=\"jsonarea_$key\" &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"
	    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
        }

	println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
	println "&amp;lt;input style=\"display:none\" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;"
	println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
	println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'
	println "&amp;lt;/div&amp;gt;"
	  
	def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
	def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
	  
	println "&amp;lt;div style='clear:both'&amp;gt;"
        if(jsonPie != null) {
	  println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
	  lstName.each{
	    def tmp = it.replaceAll("\\.", "_")
	    println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
        if(jsonLine != null) {
	  def chartLineComment = false
	  chartColumnsLine.each{
	    if(!chartLineComment){
	       println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	       chartLineComment = true  
	    }

	      println " &amp;lt;div class=\"displayblock\" id=\"containerline${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
        println "&amp;amp;nbsp;"

        if(jsonBar != null) {
	  def chartBarComment = false
	  chartColumnsBar.each{
	     if(!chartBarComment){
	        println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	        chartBarComment = true
	      }  

	     println " &amp;lt;div class=\"displayblock\" id=\"containerbar${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
	println "&amp;amp;nbsp;"

        if(jsonArea != null) {
	  def chartAreaComment = false
	  chartColumnsArea.each{
	  if(!chartAreaComment){
	    println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	    chartAreaComment = true
	  }
	    println " &amp;lt;div class=\"displayblock\" id=\"containerarea${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
	println "&amp;lt;/div&amp;gt;"
        
    }
    println '&amp;lt;/body&amp;gt;'
    println '{{/html}}'
} else if(result[0].type == "Store") {
    // data store
    def dataLine = DataToDrawChart.getDataToDrawLine(result)
    def dataBar = DataToDrawChart.getDataToDrawBar(result)
    def dataPie = DataToDrawChart.getDataToDrawPie(result)
    def dataArea = DataToDrawChart.getDataToDrawArea(result)
    def chartColumnsLine 
    def chartColumnsBar 
    def chartColumnsArea 
    def lstName 

    if(dataLine.size() &amp;gt; 0 ){
        chartColumnsLine = dataLine[0].chart_columns
    }
    if(dataBar.size() &amp;gt; 0){
        chartColumnsBar = dataBar[0].chart_columns
    }
    if(dataArea.size() &amp;gt; 0 ){
        chartColumnsArea = dataArea[0].chart_columns
    }
    if(dataPie.size() &amp;gt; 0 ){
        lstName = dataPie['name']
    }

    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
  
    def tmpListNameContainer = []
    for(def nameContainer in lstName){
       nameContainer = nameContainer.replaceAll("\\.", "_")
       tmpListNameContainer.add(nameContainer)
    }
  
    def jsonPie = com.mongodb.util.JSON.serialize(dataPie)
    def jsonLine = com.mongodb.util.JSON.serialize(dataLine)
    def jsonBar = com.mongodb.util.JSON.serialize(dataBar)
    def jsonArea = com.mongodb.util.JSON.serialize(dataArea)

    def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
    def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
    def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
    def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

    def listEmpty = com.mongodb.util.JSON.serialize([])
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$listEmpty&amp;lt;/textarea&amp;gt;" 

    println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'

    println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
    println "&amp;lt;textarea class='jsonline' &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonbar' &amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonpie' &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonarea' &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"

    println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
  
    def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
    def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
  
    println "&amp;lt;div style='clear:both'&amp;gt;"
  
    def chartPieComment = false
    lstName.each{
        if(!chartPieComment) {
            println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
            chartPieComment = true
        }
        def tmp = it.replaceAll("\\.", "_")
        println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    def chartLineComment = false
    chartColumnsLine.each{
    if(!chartLineComment){
        println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
        chartLineComment = true  
    }

    println " &amp;lt;div class=\"displayblock\" id=\"containerline$it\"&amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    println "&amp;amp;nbsp;"
    def chartBarComment = false
    chartColumnsBar.each{
        if(!chartBarComment){
            println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
            chartBarComment = true
        }  

    println " &amp;lt;div class=\"displayblock\" id=\"containerbar$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
  println "&amp;lt;/div&amp;gt;"
  println "&amp;amp;nbsp;"
  def chartAreaComment = false
  chartColumnsArea.each{
  if(!chartAreaComment){
    println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
    chartAreaComment = true
  }
    println " &amp;lt;div class=\"displayblock\" id=\"containerarea$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
  println "&amp;lt;/div&amp;gt;"
println "&amp;lt;/div&amp;gt;"

println '&amp;lt;/body&amp;gt;'
println '{{/html}}'
}
}else{
    println 'There is no data for this job with criterias'
}
{{/groovy}}&lt;/content&gt;&lt;/xwikidoc&gt;
@


31.3
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376370801000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;31.3&lt;/version&gt;
d21 1
a21 1
&lt;minorEdit&gt;true&lt;/minorEdit&gt;
@


31.2
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376370711000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;31.2&lt;/version&gt;
d2433 2
a2434 2
			$("#list2").jqGrid(data);
			$("#list2").jqGrid('navGrid', "#pager2", {
@


31.1
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376370085000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;31.1&lt;/version&gt;
d21 1
a21 1
&lt;minorEdit&gt;false&lt;/minorEdit&gt;
d2423 3
d2428 3
d2432 10
@


30.19
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376370064000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;30.19&lt;/version&gt;
d21 1
a21 1
&lt;minorEdit&gt;true&lt;/minorEdit&gt;
@


30.18
log
@@
text
@&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xwikidoc&gt;
&lt;web&gt;WiperDog&lt;/web&gt;
&lt;name&gt;WebHome&lt;/name&gt;
&lt;language&gt;&lt;/language&gt;
&lt;defaultLanguage&gt;en&lt;/defaultLanguage&gt;
&lt;translation&gt;0&lt;/translation&gt;
&lt;parent&gt;&lt;/parent&gt;
&lt;creator&gt;XWiki.Admin&lt;/creator&gt;
&lt;author&gt;XWiki.Admin&lt;/author&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;contentAuthor&gt;XWiki.Admin&lt;/contentAuthor&gt;
&lt;creationDate&gt;1376364375000&lt;/creationDate&gt;
&lt;date&gt;1376369933000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376369933000&lt;/contentUpdateDate&gt;
&lt;version&gt;30.18&lt;/version&gt;
&lt;title&gt;WiperDog&lt;/title&gt;
&lt;defaultTemplate&gt;&lt;/defaultTemplate&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;comment&gt;&lt;/comment&gt;
&lt;minorEdit&gt;true&lt;/minorEdit&gt;
&lt;syntaxId&gt;xwiki/2.1&lt;/syntaxId&gt;
&lt;hidden&gt;false&lt;/hidden&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;047293a8-524d-45e4-af52-cd944523d5d0&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
/*
 * jQuery timepicker addon
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 1.3.1
 * Last Modified: 07/07/2013
 *
 * Copyright 2013 Trent Richardson
 * You may use this project under MIT or GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 */

/*jslint evil: true, white: false, undef: false, nomen: false */

(function($) {

	/*
	* Lets not redefine timepicker, Prevent "Uncaught RangeError: Maximum call stack size exceeded"
	*/
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return;
	}

	/*
	* Extend jQueryUI, get it started with our version number
	*/
	$.extend($.ui, {
		timepicker: {
			version: "1.3.1"
		}
	});

	/* 
	* Timepicker manager.
	* Use the singleton instance of this class, $.timepicker, to interact with the time picker.
	* Settings for (groups of) time pickers are maintained in an instance object,
	* allowing multiple different settings on the same page.
	*/
	var Timepicker = function() {
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[''] = { // Default regional settings
			currentText: 'Now',
			closeText: 'Done',
			amNames: ['AM', 'A'],
			pmNames: ['PM', 'P'],
			timeFormat: 'HH:mm',
			timeSuffix: '',
			timeOnlyTitle: 'Choose Time',
			timeText: 'Time',
			hourText: 'Hour',
			minuteText: 'Minute',
			secondText: 'Second',
			millisecText: 'Millisecond',
			microsecText: 'Microsecond',
			timezoneText: 'Time Zone',
			isRTL: false
		};
		this._defaults = { // Global defaults for all the datetime picker instances
			showButtonPanel: true,
			timeOnly: false,
			showHour: null,
			showMinute: null,
			showSecond: null,
			showMillisec: null,
			showMicrosec: null,
			showTimezone: null,
			showTime: true,
			stepHour: 1,
			stepMinute: 1,
			stepSecond: 1,
			stepMillisec: 1,
			stepMicrosec: 1,
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null,
			hourMin: 0,
			minuteMin: 0,
			secondMin: 0,
			millisecMin: 0,
			microsecMin: 0,
			hourMax: 23,
			minuteMax: 59,
			secondMax: 59,
			millisecMax: 999,
			microsecMax: 999,
			minDateTime: null,
			maxDateTime: null,
			onSelect: null,
			hourGrid: 0,
			minuteGrid: 0,
			secondGrid: 0,
			millisecGrid: 0,
			microsecGrid: 0,
			alwaysSetTime: true,
			separator: ' ',
			altFieldTimeOnly: true,
			altTimeFormat: null,
			altSeparator: null,
			altTimeSuffix: null,
			pickerTimeFormat: null,
			pickerTimeSuffix: null,
			showTimepicker: true,
			timezoneList: null,
			addSliderAccess: false,
			sliderAccessArgs: null,
			controlType: 'slider',
			defaultValue: null,
			parse: 'strict'
		};
		$.extend(this._defaults, this.regional['']);
	};

	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: '',
		formattedDate: '',
		formattedTime: '',
		formattedDateTime: '',
		timezoneList: null,
		units: ['hour','minute','second','millisec', 'microsec'],
		support: {},
		control: null,

		/* 
		* Override the default settings for all instances of the time picker.
		* @@param  settings  object - the new settings to use as defaults (anonymous object)
		* @@return the manager object
		*/
		setDefaults: function(settings) {
			extendRemove(this._defaults, settings || {});
			return this;
		},

		/*
		* Create a new Timepicker instance
		*/
		_newInst: function($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
            	fns = {},
		    	overrides, i;

			for (var attrName in this._defaults) {
				if(this._defaults.hasOwnProperty(attrName)){
					var attrValue = $input.attr('time:' + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue);
						} catch (err) {
							inlineSettings[attrName] = attrValue;
						}
					}
				}
			}

		    overrides = {
		        beforeShow: function (input, dp_inst) {
		            if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
		                return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst);
		            }
		        },
		        onChangeMonthYear: function (year, month, dp_inst) {
		            // Update the time as well : this prevents the time from disappearing from the $input field.
		            tp_inst._updateDateTime(dp_inst);
		            if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
		                tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst);
		            }
		        },
		        onClose: function (dateText, dp_inst) {
		            if (tp_inst.timeDefined === true &amp;amp;&amp;amp; $input.val() !== '') {
		                tp_inst._updateDateTime(dp_inst);
		            }
		            if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
		                tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst);
		            }
		        }
		    };
		    for (i in overrides) {
		        if (overrides.hasOwnProperty(i)) {
		            fns[i] = opts[i] || null;
		        }
		    }

		    tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
		        evnts:fns,
		        timepicker: tp_inst // add timepicker as a property of datepicker: $.datepicker._get(dp_inst, 'timepicker');
		    });
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function(val) {
				return val.toUpperCase();
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function(val) {
				return val.toUpperCase();
			});

			// detect which units are supported
			tp_inst.support = detectSupport(
					tp_inst._defaults.timeFormat + 
					(tp_inst._defaults.pickerTimeFormat? tp_inst._defaults.pickerTimeFormat:'') + 
					(tp_inst._defaults.altTimeFormat? tp_inst._defaults.altTimeFormat:''));

			// controlType is string - key to our this._controls
			if(typeof(tp_inst._defaults.controlType) === 'string'){
				if(tp_inst._defaults.controlType == 'slider' &amp;amp;&amp;amp; typeof(jQuery.ui.slider) === 'undefined'){
					tp_inst._defaults.controlType = 'select';
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType];
			}
			// controlType is an object and must implement create, options, value methods
			else{ 
				tp_inst.control = tp_inst._defaults.controlType;
			}

			// prep the timezone options
			var timezoneList = [-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,
					0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList;
			}
			var tzl=timezoneList.length,tzi=0,tzv=null;
			if (tzl &amp;gt; 0 &amp;amp;&amp;amp; typeof timezoneList[0] !== 'object') {
				for(; tzi&amp;lt;tzl; tzi++){
					tzv = timezoneList[tzi];
					timezoneList[tzi] = { value: tzv, label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601) };
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;

			// set the default units
			tp_inst.timezone = tp_inst._defaults.timezone !== null? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) : 
							((new Date()).getTimezoneOffset()*-1);
			tp_inst.hour = tp_inst._defaults.hour &amp;lt; tp_inst._defaults.hourMin? tp_inst._defaults.hourMin : 
							tp_inst._defaults.hour &amp;gt; tp_inst._defaults.hourMax? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute &amp;lt; tp_inst._defaults.minuteMin? tp_inst._defaults.minuteMin : 
							tp_inst._defaults.minute &amp;gt; tp_inst._defaults.minuteMax? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second &amp;lt; tp_inst._defaults.secondMin? tp_inst._defaults.secondMin : 
							tp_inst._defaults.second &amp;gt; tp_inst._defaults.secondMax? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec &amp;lt; tp_inst._defaults.millisecMin? tp_inst._defaults.millisecMin : 
							tp_inst._defaults.millisec &amp;gt; tp_inst._defaults.millisecMax? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec &amp;lt; tp_inst._defaults.microsecMin? tp_inst._defaults.microsecMin : 
							tp_inst._defaults.microsec &amp;gt; tp_inst._defaults.microsecMax? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = '';
			tp_inst.$input = $input;

			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField).css({
					cursor: 'pointer'
				}).focus(function() {
					$input.trigger("focus");
				});
			}

			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date();
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date();
			}

			// datepicker needs minDate/maxDate, timepicker needs minDateTime/maxDateTime..
			if (tp_inst._defaults.minDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime());
			}
			if (tp_inst._defaults.minDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime());
			}
			if (tp_inst._defaults.maxDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime());
			}
			if (tp_inst._defaults.maxDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime());
			}
			tp_inst.$input.bind('focus', function() {
				tp_inst._onFocus();
			});

			return tp_inst;
		},

		/*
		* add our sliders to the calendar
		*/
		_addTimePicker: function(dp_inst) {
			var currDT = (this.$altInput &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly) ? this.$input.val() + ' ' + this.$altInput.val() : this.$input.val();

			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
		},

		/*
		* parse the time string from input value or _setTime
		*/
		_parseTime: function(timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0]);
			}

			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, 'dateFormat');
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false;
					}
					$.extend(this, parseRes.timeObj);
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err +
									"\ndate/time string = " + timeString +
									"\ntimeFormat = " + this._defaults.timeFormat +
									"\ndateFormat = " + dp_dateFormat);
					return false;
				}
				return true;
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false;
				}
				$.extend(this, timeObj);
				return true;
			}
		},

		/*
		* generate and inject html for timepicker into ui datepicker
		*/
		_injectTimePicker: function() {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = '',
				uitem = '',
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i=0,
				l=0;

			// Prevent displaying twice
			if ($dp.find("div.ui-timepicker-div").length === 0 &amp;amp;&amp;amp; o.showTimepicker) {
				var noDisplay = ' style="display:none;"',
					html = '&amp;lt;div class="ui-timepicker-div'+ (o.isRTL? ' ui-timepicker-rtl' : '') +'"&amp;gt;&amp;lt;dl&amp;gt;' + '&amp;lt;dt class="ui_tpicker_time_label"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;' + o.timeText + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_time"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the markup
				for(i=0,l=this.units.length; i&amp;lt;l; i++){
					litem = this.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// Added by Peter Medeiros:
					// - Figure out what the hour/minute/second max should be based on the step values.
					// - Example: if stepMinute is 15, then minMax is 45.
					max[litem] = parseInt((o[litem+'Max'] - ((o[litem+'Max'] - o[litem+'Min']) % o['step'+uitem])), 10);
					gridSize[litem] = 0;

					html += '&amp;lt;dt class="ui_tpicker_'+ litem +'_label"' + (show ? '' : noDisplay) + '&amp;gt;' + o[litem +'Text'] + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_'+ litem +'"&amp;gt;&amp;lt;div class="ui_tpicker_'+ litem +'_slider"' + (show ? '' : noDisplay) + '&amp;gt;&amp;lt;/div&amp;gt;';

					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						html += '&amp;lt;div style="padding-left: 1px"&amp;gt;&amp;lt;table class="ui-tpicker-grid-label"&amp;gt;&amp;lt;tr&amp;gt;';

						if(litem == 'hour'){
							for (var h = o[litem+'Min']; h &amp;lt;= max[litem]; h += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm? 'hht':'HH', {hour:h}, o);									
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + tmph + '&amp;lt;/td&amp;gt;';
							}
						}
						else{
							for (var m = o[litem+'Min']; m &amp;lt;= max[litem]; m += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + ((m &amp;lt; 10) ? '0' : '') + m + '&amp;lt;/td&amp;gt;';
							}
						}

						html += '&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;&amp;lt;/div&amp;gt;';
					}
					html += '&amp;lt;/dd&amp;gt;';
				}
				
				// Timezone
				var showTz = o.showTimezone !== null? o.showTimezone : this.support.timezone;
				html += '&amp;lt;dt class="ui_tpicker_timezone_label"' + (showTz ? '' : noDisplay) + '&amp;gt;' + o.timezoneText + '&amp;lt;/dt&amp;gt;';
				html += '&amp;lt;dd class="ui_tpicker_timezone" ' + (showTz ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the elements from string
				html += '&amp;lt;/dl&amp;gt;&amp;lt;/div&amp;gt;';
				var $tp = $(html);

				// if we only want time picker...
				if (o.timeOnly === true) {
					$tp.prepend('&amp;lt;div class="ui-widget-header ui-helper-clearfix ui-corner-all"&amp;gt;' + '&amp;lt;div class="ui-datepicker-title"&amp;gt;' + o.timeOnlyTitle + '&amp;lt;/div&amp;gt;' + '&amp;lt;/div&amp;gt;');
					$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();
				}
				
				// add sliders, adjust grids, add events
				for(i=0,l=tp_inst.units.length; i&amp;lt;l; i++){
					litem = tp_inst.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// add the slider
					tp_inst[litem+'_slider'] = tp_inst.control.create(tp_inst, $tp.find('.ui_tpicker_'+litem+'_slider'), litem, tp_inst[litem], o[litem+'Min'], max[litem], o['step'+uitem]);

					// adjust the grid and add click event
					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						size = 100 * gridSize[litem] * o[litem+'Grid'] / (max[litem] - o[litem+'Min']);
						$tp.find('.ui_tpicker_'+litem+' table').css({
							width: size + "%",
							marginLeft: o.isRTL? '0' : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL? ((size / (-2 * gridSize[litem])) + "%") : '0',
							borderCollapse: 'collapse'
						}).find("td").click(function(e){
								var $t = $(this),
									h = $t.html(),
									n = parseInt(h.replace(/[^0-9]/g),10),
									ap = h.replace(/[^apm]/ig),
									f = $t.data('for'); // loses scope, so we use data-for

								if(f == 'hour'){
									if(ap.indexOf('p') !== -1 &amp;amp;&amp;amp; n &amp;lt; 12){
										n += 12;
									}
									else{
										if(ap.indexOf('a') !== -1 &amp;amp;&amp;amp; n === 12){
											n = 0;
										}
									}
								}
								
								tp_inst.control.value(tp_inst, tp_inst[f+'_slider'], litem, n);

								tp_inst._onTimeChange();
								tp_inst._onSelectHandler();
							}).css({
								cursor: 'pointer',
								width: (100 / gridSize[litem]) + '%',
								textAlign: 'center',
								overflow: 'hidden'
							});
					} // end if grid &amp;gt; 0
				} // end for loop

				// Add timezone options
				this.timezone_select = $tp.find('.ui_tpicker_timezone').append('&amp;lt;select&amp;gt;&amp;lt;/select&amp;gt;').find("select");
				$.fn.append.apply(this.timezone_select,
				$.map(o.timezoneList, function(val, idx) {
					return $("&amp;lt;option /&amp;gt;").val(typeof val == "object" ? val.value : val).text(typeof val == "object" ? val.label : val);
				}));
				if (typeof(this.timezone) != "undefined" &amp;amp;&amp;amp; this.timezone !== null &amp;amp;&amp;amp; this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset()*-1;
					if (local_timezone == this.timezone) {
						selectLocalTimezone(tp_inst);
					} else {
						this.timezone_select.val(this.timezone);
					}
				} else {
					if (typeof(this.hour) != "undefined" &amp;amp;&amp;amp; this.hour !== null &amp;amp;&amp;amp; this.hour !== "") {
						this.timezone_select.val(o.timezone);
					} else {
						selectLocalTimezone(tp_inst);
					}
				}
				this.timezone_select.change(function() {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
				});
				// End timezone options
				
				// inject timepicker into datepicker
				var $buttonPanel = $dp.find('.ui-datepicker-buttonpane');
				if ($buttonPanel.length) {
					$buttonPanel.before($tp);
				} else {
					$dp.append($tp);
				}

				this.$timeObj = $tp.find('.ui_tpicker_time');

				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined;
				}

				// slideAccess integration: http://trentrichardson.com/2011/11/11/jquery-ui-sliders-and-touch-accessibility/
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
						
					setTimeout(function() { // fix for inline mode
						if ($tp.find('.ui-slider-access').length === 0) {
							$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);

							// fix any grids since sliders are shorter
							var sliderAccessWidth = $tp.find('.ui-slider-access:eq(0)').outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find('table:visible').each(function() {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl? 'marginRight':'marginLeft').toString().replace('%', ''),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + '%',
										css = { width: newWidth, marginRight: 0, marginLeft: 0 };
									css[rtl? 'marginRight':'marginLeft'] = newMarginLeft;
									$g.css(css);
								});
							}
						}
					}, 10);
				}
				// end slideAccess integration

				tp_inst._limitMinMaxDateTime(this.inst, true);
			}
		},

		/*
		* This function tries to limit the ability to go outside the
		* min/max date range
		*/
		_limitMinMaxDateTime: function(dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);

			if (!this._defaults.showTimepicker) {
				return;
			} // No time so nothing to check here

			if ($.datepicker._get(dp_inst, 'minDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'minDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, 'minDateTime'),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin;
				}

				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour &amp;lt;= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute &amp;lt;= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second &amp;lt;= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if(this.millisec &amp;lt;= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;lt; this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin;
									}
									this._defaults.microsecMin = this.microsecMinOriginal;
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal;
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal;
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal;
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal;
				}
			}

			if ($.datepicker._get(dp_inst, 'maxDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'maxDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, 'maxDateTime'),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax;
				}

				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour &amp;gt;= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute &amp;gt;= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second &amp;gt;= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec &amp;gt;= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;gt; this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax;
									}
									this._defaults.microsecMax = this.microsecMaxOriginal;
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal;
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal;
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal;
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal;
				}
			}

			if (adjustSliders !== undefined &amp;amp;&amp;amp; adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10);
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);

				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, 'hour', { min: this._defaults.hourMin, max: hourMax });
					this.control.value(this, this.hour_slider, 'hour', this.hour - (this.hour % this._defaults.stepHour));
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, 'minute', { min: this._defaults.minuteMin, max: minMax });
					this.control.value(this, this.minute_slider, 'minute', this.minute - (this.minute % this._defaults.stepMinute));
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, 'second', { min: this._defaults.secondMin, max: secMax });
					this.control.value(this, this.second_slider, 'second', this.second - (this.second % this._defaults.stepSecond));
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, 'millisec', { min: this._defaults.millisecMin, max: millisecMax });
					this.control.value(this, this.millisec_slider, 'millisec', this.millisec - (this.millisec % this._defaults.stepMillisec));
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, 'microsec', { min: this._defaults.microsecMin, max: microsecMax });
					this.control.value(this, this.microsec_slider, 'microsec', this.microsec - (this.microsec % this._defaults.stepMicrosec));
				}
			}

		},

		/*
		* when a slider moves, set the internal time...
		* on time change is also called when the time is updated in the text field
		*/
		_onTimeChange: function() {
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, 'hour') : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, 'minute') : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, 'second') : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, 'millisec') : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, 'microsec') : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;

			if (typeof(hour) == 'object') {
				hour = false;
			}
			if (typeof(minute) == 'object') {
				minute = false;
			}
			if (typeof(second) == 'object') {
				second = false;
			}
			if (typeof(millisec) == 'object') {
				millisec = false;
			}
			if (typeof(microsec) == 'object') {
				microsec = false;
			}
			if (typeof(timezone) == 'object') {
				timezone = false;
			}

			if (hour !== false) {
				hour = parseInt(hour, 10);
			}
			if (minute !== false) {
				minute = parseInt(minute, 10);
			}
			if (second !== false) {
				second = parseInt(second, 10);
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10);
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10);
			}

			var ampm = o[hour &amp;lt; 12 ? 'amNames' : 'pmNames'][0];

			// If the update was done in the input field, the input field should not be updated.
			// If the update was done using the sliders, update the input field.
			var hasChanged = (hour != this.hour || minute != this.minute || second != this.second || millisec != this.millisec || microsec != this.microsec 
								|| (this.ampm.length &amp;gt; 0 &amp;amp;&amp;amp; (hour &amp;lt; 12) != ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) 
								|| (this.timezone !== null &amp;amp;&amp;amp; timezone != this.timezone));

			if (hasChanged) {

				if (hour !== false) {
					this.hour = hour;
				}
				if (minute !== false) {
					this.minute = minute;
				}
				if (second !== false) {
					this.second = second;
				}
				if (millisec !== false) {
					this.millisec = millisec;
				}
				if (microsec !== false) {
					this.microsec = microsec;
				}
				if (timezone !== false) {
					this.timezone = timezone;
				}

				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0]);
				}

				this._limitMinMaxDateTime(this.inst, true);
			}
			if (this.support.ampm) {
				this.ampm = ampm;
			}

			// Updates the time within the timepicker
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if(pickerTimeFormat === o.timeFormat){
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix);
				}
				else{
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix);
				}
			}

			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime();
			}
		},

		/*
		* call custom onSelect.
		* bind to sliders slidestop, and grid click.
		*/
		_onSelectHandler: function() {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect &amp;amp;&amp;amp; inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this]);
			}
		},

		/*
		* update our input with the new date time..
		*/
		_updateDateTime: function(dp_inst) {
			dp_inst = this.inst || dp_inst;
			//var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
			var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay)),
				dateFmt = $.datepicker._get(dp_inst, 'dateFormat'),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null &amp;amp;&amp;amp; this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			
			// if a slider was changed but datepicker doesn't have a value yet, set it
			if(dp_inst.lastVal===""){
                dp_inst.currentYear=dp_inst.selectedYear;
                dp_inst.currentMonth=dp_inst.selectedMonth;
                dp_inst.currentDay=dp_inst.selectedDay;
            }

			/*
			* remove following lines to force every changes in date picker to change the input value
			* Bug descriptions: when an input field has a default value, and click on the field to pop up the date picker. 
			* If the user manually empty the value in the input field, the date picker will never change selected value.
			*/
			//if (dp_inst.lastVal !== undefined &amp;amp;&amp;amp; (dp_inst.lastVal.length &amp;gt; 0 &amp;amp;&amp;amp; this.$input.val().length === 0)) {
			//	return;
			//}

			if (this._defaults.timeOnly === true) {
				formattedDateTime = this.formattedTime;
			} else if (this._defaults.timeOnly !== true &amp;amp;&amp;amp; (this._defaults.alwaysSetTime || timeAvailable)) {
				formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix;
			}

			this.formattedDateTime = formattedDateTime;

			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate);
			} else if (this.$altInput &amp;amp;&amp;amp; this._defaults.timeOnly === false &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly === true) {
				this.$altInput.val(this.formattedTime);
				this.$input.val(this.formattedDate);
			} else if (this.$altInput) {
				this.$input.val(formattedDateTime);
				var altFormattedDateTime = '',
					altSeparator = this._defaults.altSeparator ? this._defaults.altSeparator : this._defaults.separator,
					altTimeSuffix = this._defaults.altTimeSuffix ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
				
				if(!this._defaults.timeOnly){
					if (this._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg);
					}
					else{
						altFormattedDateTime = this.formattedDate;
					}

					if (altFormattedDateTime){
						altFormattedDateTime += altSeparator;
					}
				}

				if(this._defaults.altTimeFormat){
					altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix;
				}
				else{
					altFormattedDateTime += this.formattedTime + altTimeSuffix;
				}
				this.$altInput.val(altFormattedDateTime);
			} else {
				this.$input.val(formattedDateTime);
			}

			this.$input.trigger("change");
		},

		_onFocus: function() {
			if (!this.$input.val() &amp;amp;&amp;amp; this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, 'timepicker');
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst);
						} catch (err) {
							$.timepicker.log(err);
						}
					}
				}
			}
		},

		/*
		* Small abstraction to control types
		* We can add more, just be sure to follow the pattern: create, options, value
		*/
		_controls: {
			// slider methods
			slider: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var rtl = tp_inst._defaults.isRTL; // if rtl go -60-&amp;gt;0 instead of 0-&amp;gt;60
					return obj.prop('slide', null).slider({
						orientation: "horizontal",
						value: rtl? val*-1 : val,
						min: rtl? max*-1 : min,
						max: rtl? min*-1 : max,
						step: step,
						slide: function(event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl? ui.value*-1:ui.value);
							tp_inst._onTimeChange();
						},
						stop: function(event, ui) {
							tp_inst._onSelectHandler();
						}
					});	
				},
				options: function(tp_inst, obj, unit, opts, val){
					if(tp_inst._defaults.isRTL){
						if(typeof(opts) == 'string'){
							if(opts == 'min' || opts == 'max'){
								if(val !== undefined){
									return obj.slider(opts, val*-1);
								}
								return Math.abs(obj.slider(opts));
							}
							return obj.slider(opts);
						}
						var min = opts.min, 
							max = opts.max;
						opts.min = opts.max = null;
						if(min !== undefined){
							opts.max = min * -1;
						}
						if(max !== undefined){
							opts.min = max * -1;
						}
						return obj.slider(opts);
					}
					if(typeof(opts) == 'string' &amp;amp;&amp;amp; val !== undefined){
							return obj.slider(opts, val);
					}
					return obj.slider(opts);
				},
				value: function(tp_inst, obj, unit, val){
					if(tp_inst._defaults.isRTL){
						if(val !== undefined){
							return obj.slider('value', val*-1);
						}
						return Math.abs(obj.slider('value'));
					}
					if(val !== undefined){
						return obj.slider('value', val);
					}
					return obj.slider('value');
				}
			},
			// select methods
			select: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var sel = '&amp;lt;select class="ui-timepicker-select" data-unit="'+ unit +'" data-min="'+ min +'" data-max="'+ max +'" data-step="'+ step +'"&amp;gt;',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;

					for(var i=min; i&amp;lt;=max; i+=step){						
						sel += '&amp;lt;option value="'+ i +'"'+ (i==val? ' selected':'') +'&amp;gt;';
						if(unit == 'hour'){
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig,'')), {hour:i}, tp_inst._defaults);
						}
						else if(unit == 'millisec' || unit == 'microsec' || i &amp;gt;= 10){ sel += i; }
						else {sel += '0'+ i.toString(); }
						sel += '&amp;lt;/option&amp;gt;';
					}
					sel += '&amp;lt;/select&amp;gt;';

					obj.children('select').remove();

					$(sel).appendTo(obj).change(function(e){
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
					});

					return obj;
				},
				options: function(tp_inst, obj, unit, opts, val){
					var o = {},
						$t = obj.children('select');
					if(typeof(opts) == 'string'){
						if(val === undefined){
							return $t.data(opts);
						}
						o[opts] = val;	
					}
					else{ o = opts; }
					return tp_inst.control.create(tp_inst, obj, $t.data('unit'), $t.val(), o.min || $t.data('min'), o.max || $t.data('max'), o.step || $t.data('step'));
				},
				value: function(tp_inst, obj, unit, val){
					var $t = obj.children('select');
					if(val !== undefined){
						return $t.val(val);
					}
					return $t.val();
				}
			}
		} // end _controls

	});

	$.fn.extend({
		/*
		* shorthand just to use timepicker..
		*/
		timepicker: function(o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);

			if (typeof o == 'object') {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				});
			}

			return $(this).each(function() {
				$.fn.datetimepicker.apply($(this), tmp_args);
			});
		},

		/*
		* extend timepicker to datepicker
		*/
		datetimepicker: function(o) {
			o = o || {};
			var tmp_args = arguments;

			if (typeof(o) == 'string') {
				if (o == 'getDate') {
					return $.fn.datepicker.apply($(this[0]), tmp_args);
				} else {
					return this.each(function() {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args);
					});
				}
			} else {
				return this.each(function() {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults);
				});
			}
		}
	});

	/*
	* Public Utility to parse date and time
	*/
	$.datepicker.parseDateTime = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec);
		}

		return parseRes.date;
	};

	/*
	* Public utility to parse time
	*/
	$.datepicker.parseTime = function(timeFormat, timeString, options) {		
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g,'').indexOf('Z') !== -1);

		// Strict parse requires the timeString to match the timeFormat exactly
		var strictParse = function(f, s, o){

			// pattern for standard and localized AM/PM markers
			var getPatternAmpm = function(amNames, pmNames) {
				var markers = [];
				if (amNames) {
					$.merge(markers, amNames);
				}
				if (pmNames) {
					$.merge(markers, pmNames);
				}
				markers = $.map(markers, function(val) {
					return val.replace(/[.*+?|()\[\]{}\\]/g, '\\$&amp;amp;');
				});
				return '(' + markers.join('|') + ')?';
			};

			// figure out position of time elements.. cause js cant do named captures
			var getFormatPositions = function(timeFormat) {
				var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
					orders = {
						h: -1,
						m: -1,
						s: -1,
						l: -1,
						c: -1,
						t: -1,
						z: -1
					};

				if (finds) {
					for (var i = 0; i &amp;lt; finds.length; i++) {
						if (orders[finds[i].toString().charAt(0)] == -1) {
							orders[finds[i].toString().charAt(0)] = i + 1;
						}
					}
				}
				return orders;
			};

			var regstr = '^' + f.toString()
					.replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
							var ml = match.length;
							switch (match.charAt(0).toLowerCase()) {
								case 'h': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'm': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 's': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'l': return '(\\d?\\d?\\d)';
								case 'c': return '(\\d?\\d?\\d)';
								case 'z': return '(z|[-+]\\d\\d:?\\d\\d|\\S+)?';
								case 't': return getPatternAmpm(o.amNames, o.pmNames);
								default:    // literal escaped in quotes
									return '(' + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function (m) { return "\\" + m; }) + ')?';
							}
						})
					.replace(/\s/g, '\\s?') +
					o.timeSuffix + '$',
				order = getFormatPositions(f),
				ampm = '',
				treg;

			treg = s.match(new RegExp(regstr, 'i'));

			var resTime = {
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0
			};

			if (treg) {
				if (order.t !== -1) {
					if (treg[order.t] === undefined || treg[order.t].length === 0) {
						ampm = '';
						resTime.ampm = '';
					} else {
						ampm = $.inArray(treg[order.t].toUpperCase(), o.amNames) !== -1 ? 'AM' : 'PM';
						resTime.ampm = o[ampm == 'AM' ? 'amNames' : 'pmNames'][0];
					}
				}

				if (order.h !== -1) {
					if (ampm == 'AM' &amp;amp;&amp;amp; treg[order.h] == '12') {
						resTime.hour = 0; // 12am = 0 hour
					} else {
						if (ampm == 'PM' &amp;amp;&amp;amp; treg[order.h] != '12') {
							resTime.hour = parseInt(treg[order.h], 10) + 12; // 12pm = 12 hour, any other pm = hour + 12
						} else {
							resTime.hour = Number(treg[order.h]);
						}
					}
				}

				if (order.m !== -1) {
					resTime.minute = Number(treg[order.m]);
				}
				if (order.s !== -1) {
					resTime.second = Number(treg[order.s]);
				}
				if (order.l !== -1) {
					resTime.millisec = Number(treg[order.l]);
				}
				if (order.c !== -1) {
					resTime.microsec = Number(treg[order.c]);
				}
				if (order.z !== -1 &amp;amp;&amp;amp; treg[order.z] !== undefined) {
					resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z]);
				}


				return resTime;
			}
			return false;
		};// end strictParse

		// First try JS Date, if that fails, use strictParse
		var looseParse = function(f,s,o){
			try{
				var d = new Date('2012-01-01 '+ s);
				if(isNaN(d.getTime())){
					d = new Date('2012-01-01T'+ s);
					if(isNaN(d.getTime())){
						d = new Date('01/01/2012 '+ s);
						if(isNaN(d.getTime())){
							throw "Unable to parse time with native Date: "+ s;
						}
					}
				}

				return {
					hour: d.getHours(),
					minute: d.getMinutes(),
					second: d.getSeconds(),
					millisec: d.getMilliseconds(),
					microsec: d.getMicroseconds(),
					timezone: d.getTimezoneOffset()*-1
				};
			}
			catch(err){
				try{
					return strictParse(f,s,o);
				}
				catch(err2){
					$.timepicker.log("Unable to parse \ntimeString: "+ s +"\ntimeFormat: "+ f);
				}				
			}
			return false;
		}; // end looseParse
		
		if(typeof o.parse === "function"){
			return o.parse(timeFormat, timeString, o);
		}
		if(o.parse === 'loose'){
			return looseParse(timeFormat, timeString, o);
		}
		return strictParse(timeFormat, timeString, o);
	};

	/*
	* Public utility to format the time
	* format = string format of the time
	* time = a {}, not a Date() for timezones
	* options = essentially the regional[].. amNames, pmNames, ampm
	*/
	$.datepicker.formatTime = function(format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			timezone: 0
		}, time);

		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);

		if (hour &amp;gt; 11) {
			ampmName = options.pmNames[0];
		}

		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|('.*?'|".*?"))/g, function(match) {
		switch (match) {
			case 'HH':
				return ('0' + hour).slice(-2);
			case 'H':
				return hour;
			case 'hh':
				return ('0' + convert24to12(hour)).slice(-2);
			case 'h':
				return convert24to12(hour);
			case 'mm':
				return ('0' + time.minute).slice(-2);
			case 'm':
				return time.minute;
			case 'ss':
				return ('0' + time.second).slice(-2);
			case 's':
				return time.second;
			case 'l':
				return ('00' + time.millisec).slice(-3);
			case 'c':
				return ('00' + time.microsec).slice(-3);
			case 'z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, false);
			case 'Z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, true);
			case 'T': 
				return ampmName.charAt(0).toUpperCase();
			case 'TT': 
				return ampmName.toUpperCase();
			case 't':
				return ampmName.charAt(0).toLowerCase();
			case 'tt':
				return ampmName.toLowerCase();
			default:
				return match.replace(/\'/g, "") || "'";
			}
		});

		tmptime = $.trim(tmptime);
		return tmptime;
	};

	/*
	* the bad hack :/ override datepicker so it doesnt close on select
	// inspired: http://stackoverflow.com/questions/1252512/jquery-datepicker-prevent-closing-picker-when-clicking-a-date/1762378#1762378
	*/
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function(id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			tp_inst._limitMinMaxDateTime(inst, true);
			inst.inline = inst.stay_open = true;
			//This way the onSelect handler called from calendarpicker get the full dateTime
			this._base_selectDate(id, dateStr);
			inst.inline = inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst);
		} else {
			this._base_selectDate(id, dateStr);
		}
	};

	/*
	* second bad hack :/ override datepicker so it triggers an event when changing the input field
	* and does not redraw the datepicker on every selectDate event
	*/
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function(inst) {

		// don't popup the datepicker if there is another instance already opened
		var input = inst.input[0];
		if ($.datepicker._curInst &amp;amp;&amp;amp; $.datepicker._curInst != inst &amp;amp;&amp;amp; $.datepicker._datepickerShowing &amp;amp;&amp;amp; $.datepicker._lastInput != input) {
			return;
		}

		if (typeof(inst.stay_open) !== 'boolean' || inst.stay_open === false) {

			this._base_updateDatepicker(inst);

			// Reload the time control when changing something in the input text field.
			var tp_inst = this._get(inst, 'timepicker');
			if (tp_inst) {
				tp_inst._addTimePicker(inst);
			}
		}
	};

	/*
	* third bad hack :/ override datepicker so it allows spaces and colon in the input field
	*/
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if ($.datepicker._get(inst, 'constrainInput')) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null? tp_inst._defaults.showTimezone : tp_inst.support.timezone,					
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat')),
					datetimeChars = tp_inst._defaults.timeFormat.toString()
											.replace(/[hms]/g, '')
											.replace(/TT/g, ampm ? 'APM' : '')
											.replace(/Tt/g, ampm ? 'AaPpMm' : '')
											.replace(/tT/g, ampm ? 'AaPpMm' : '')
											.replace(/T/g, ampm ? 'AP' : '')
											.replace(/tt/g, ampm ? 'apm' : '')
											.replace(/t/g, ampm ? 'ap' : '') + 
											" " + tp_inst._defaults.separator + 
											tp_inst._defaults.timeSuffix + 
											(tz ? tp_inst._defaults.timezoneList.join('') : '') + 
											(tp_inst._defaults.amNames.join('')) + (tp_inst._defaults.pmNames.join('')) + 
											dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr &amp;lt; ' ' || !dateChars || datetimeChars.indexOf(chr) &amp;gt; -1);
			}
		}

		return $.datepicker._base_doKeyPress(event);
	};

	/*
	* Fourth bad hack :/ override _updateAlternate function used in inline mode to init altField
	*/
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	/* Update any alternate field to synchronise with the main field. */
	$.datepicker._updateAlternate = function(inst) {
		var tp_inst = this._get(inst, 'timepicker');
		if(tp_inst){
			var altField = tp_inst._defaults.altField;
			if (altField) { // update alternate field too
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = '', 
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator, 
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if(!tp_inst._defaults.timeOnly &amp;amp;&amp;amp; !tp_inst._defaults.altFieldTimeOnly &amp;amp;&amp;amp; date !== null){
					if(tp_inst._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime;
					}
					else{
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime;
					}
				}
				$(altField).val(altFormattedDateTime);
			}
		}
		else{
			$.datepicker._base_updateAlternate(inst);
		}
	};

	/*
	* Override key up event to sync manual input changes.
	*/
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst);
				} catch (err) {
					$.timepicker.log(err);
				}
			}
		}

		return $.datepicker._base_doKeyUp(event);
	};

	/*
	* override "Today" button to also grab the time.
	*/
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function(id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		this._base_gotoToday(id);
		var tp_inst = this._get(inst, 'timepicker');
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		$('.ui-datepicker-today', $dp).click();
	};

	/*
	* Disable &amp;amp; enable the Time in the datetimepicker
	*/
	$.datepicker._disableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst);
		}
	};

	$.datepicker._enableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst); // Could be disabled on page load
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create our own set time function
	*/
	$.datepicker._setTime = function(inst, date) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var defaults = tp_inst._defaults;

			// calling _setTime with no date sets time to defaults
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;

			//check if within min/max times.. 
			tp_inst._limitMinMaxDateTime(inst, true);

			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create new public method to set only time, callable as $().datepicker('setTime', date)
	*/
	$.datepicker._setTimeDatepicker = function(target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date == "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec);
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds());
				}
				if (tp_date.toString() == 'Invalid Date') {
					tp_date = undefined;
				}
				this._setTime(inst, tp_date);
			}
		}

	};

	/*
	* override setDate() to allow setting time too within Date object
	*/
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function(target, date) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		if(typeof(date) === 'string'){
			date = new Date(date);
			if(!date.getTime()){
				$.timepicker.log("Error creating Date object from string.");
			}
		}

		var tp_inst = this._get(inst, 'timepicker');
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds());
		} else {
			tp_date = date;
		}
		
		// This is important if you are using the timezone option, javascript's Date 
		// object will only return the timezone offset for the current locale, so we 
		// adjust it accordingly.  If not using timezone option this won't matter..
		// If a timezone is different in tp, keep the timezone as is
		if(tp_inst){
			// look out for DST if tz wasn't specified
			if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
				tp_inst.timezone = tp_date.getTimezoneOffset()*-1;
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone);
		}

		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true);
	};

	/*
	* override getDate() to allow getting time too within Date object
	*/
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function(target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			// if it hasn't yet been defined, grab from field
			if(inst.lastVal === undefined){
				this._setDateFromField(inst, noDefault);
			}

			var date = this._getDate(inst);
			if (date &amp;amp;&amp;amp; tp_inst._parseTime($(target).val(), tp_inst.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);

				// This is important if you are using the timezone option, javascript's Date 
				// object will only return the timezone offset for the current locale, so we 
				// adjust it accordingly.  If not using timezone option this won't matter..
				if(tp_inst.timezone != null){
					// look out for DST if tz wasn't specified
					if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
						tp_inst.timezone = date.getTimezoneOffset()*-1;
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
				}
			}
			return date;
		}
		return this._base_getDateDatepicker(target, noDefault);
	};

	/*
	* override parseDate() because UI 1.8.14 throws an error about "Extra characters"
	* An option in datapicker to ignore extra format characters would be nicer.
	*/
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function(format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings);
		} catch (err) {
			// Hack!  The error message ends with a colon, a space, and
			// the "extra" characters.  We rely on that instead of
			// attempting to perfectly reproduce the parsing algorithm.
			if (err.indexOf(":") &amp;gt;= 0) {
				date = this._base_parseDate(format, value.substring(0,value.length-(err.length-err.indexOf(':')-2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format);
			} else {
				throw err;
			}
		}
		return date;
	};

	/*
	* override formatDate to set date with time to the input
	*/
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function(inst, day, month, year) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val();
		}
		return this._base_formatDate(inst);
	};

	/*
	* override options setter to add time to maxDate(Time) and minDate(Time). MaxDate
	*/
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function(target, name, value) {
		var inst = this._getInst(target),
	        name_clone;
		if (!inst) {
			return null;
		}

		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop;
		    if (typeof name == 'string') { // if min/max was set with the string
		        if (name === 'minDate' || name === 'minDateTime') {
		            min = value;
		        } else if (name === 'maxDate' || name === 'maxDateTime') {
		            max = value;
		        } else if (name === 'onSelect') {
		            onselect = value;
		        } else if (overrides.hasOwnProperty(name)) {
		            if (typeof (value) === 'undefined') {
		                return overrides[name];
		            }
		            fns[name] = value;
		            name_clone = {}; //empty results in exiting function after overrides updated
		        }
		    } else if (typeof name == 'object') { //if min/max was set with the JSON
		        if (name.minDate) {
		            min = name.minDate;
		        } else if (name.minDateTime) {
		            min = name.minDateTime;
		        } else if (name.maxDate) {
		            max = name.maxDate;
		        } else if (name.maxDateTime) {
		            max = name.maxDateTime;
		        }
		        for (prop in overrides) {
		            if (overrides.hasOwnProperty(prop) &amp;amp;&amp;amp; name[prop]) {
		                fns[prop] = name[prop];
		            }
		        }
		    }
		    for (prop in fns) {
		        if (fns.hasOwnProperty(prop)) {
		            overrides[prop] = fns[prop];
		            if (!name_clone) { name_clone = $.extend({}, name);}
		            delete name_clone[prop];
		        }
		    }
		    if (name_clone &amp;amp;&amp;amp; isEmptyObject(name_clone)) { return; }
		    if (min) { //if min was set
		        if (min === 0) {
		            min = new Date();
		        } else {
		            min = new Date(min);
		        }
		        tp_inst._defaults.minDate = min;
		        tp_inst._defaults.minDateTime = min;
		    } else if (max) { //if max was set
		        if (max === 0) {
		            max = new Date();
		        } else {
		            max = new Date(max);
		        }
		        tp_inst._defaults.maxDate = max;
		        tp_inst._defaults.maxDateTime = max;
		    } else if (onselect) {
		        tp_inst._defaults.onSelect = onselect;
		    }
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name);
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
	};
	
	/*
	* jQuery isEmptyObject does not check hasOwnProperty - if someone has added to the object prototype,
	* it will return false for all objects
	*/
	var isEmptyObject = function(obj) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(obj)) {
				return false;
			}
		}
		return true;
	};

	/*
	* jQuery extend now ignores nulls!
	*/
	var extendRemove = function(target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] === null || props[name] === undefined) {
				target[name] = props[name];
			}
		}
		return target;
	};

	/*
	* Determine by the time format which units are supported
	* Returns an object of booleans for each unit
	*/
	var detectSupport = function(timeFormat){
		var tf = timeFormat.replace(/\'.*?\'/g,'').toLowerCase(), // removes literals
			isIn = function(f, t){ // does the format contain the token?
					return f.indexOf(t) !== -1? true:false; 
				};
		return {
				hour: isIn(tf,'h'),
				minute: isIn(tf,'m'),
				second: isIn(tf,'s'),
				millisec: isIn(tf,'l'),
				microsec: isIn(tf,'c'),
				timezone: isIn(tf,'z'),
				ampm: isIn(tf,'t') &amp;amp;&amp;amp; isIn(timeFormat,'h'),
				iso8601: isIn(timeFormat, 'Z')
			};
	};

	/*
	* Converts 24 hour format into 12 hour
	* Returns 12 hour without leading 0
	*/
	var convert24to12 = function(hour) {
		if (hour &amp;gt; 12) {
			hour = hour - 12;
		}

		if (hour === 0) {
			hour = 12;
		}

		return String(hour);
	};

	/*
	* Splits datetime string into date ans time substrings.
	* Throws exception when date can't be parsed
	* Returns [dateString, timeString]
	*/
	var splitDateTime = function(dateFormat, dateTimeString, dateSettings, timeSettings) {
		try {
			// The idea is to get the number separator occurances in datetime and the time format requested (since time has 
			// fewer unknowns, mostly numbers and am/pm). We will use the time pattern to split.
			var separator = timeSettings &amp;amp;&amp;amp; timeSettings.separator ? timeSettings.separator : $.timepicker._defaults.separator,
				format = timeSettings &amp;amp;&amp;amp; timeSettings.timeFormat ? timeSettings.timeFormat : $.timepicker._defaults.timeFormat,
				timeParts = format.split(separator), // how many occurances of separator may be in our format?
				timePartsLen = timeParts.length,
				allParts = dateTimeString.split(separator),
				allPartsLen = allParts.length;

			if (allPartsLen &amp;gt; 1) {
				return [
						allParts.splice(0,allPartsLen-timePartsLen).join(separator),
						allParts.splice(0,timePartsLen).join(separator)
					];
			}

		} catch (err) {
			$.timepicker.log('Could not split the date from the time. Please check the following datetimepicker options' +
					"\nthrown error: " + err +
					"\ndateTimeString" + dateTimeString +
					"\ndateFormat = " + dateFormat +
					"\nseparator = " + timeSettings.separator +
					"\ntimeFormat = " + timeSettings.timeFormat);

			if (err.indexOf(":") &amp;gt;= 0) {
				// Hack!  The error message ends with a colon, a space, and
				// the "extra" characters.  We rely on that instead of
				// attempting to perfectly reproduce the parsing algorithm.
				var dateStringLength = dateTimeString.length - (err.length - err.indexOf(':') - 2),
					timeString = dateTimeString.substring(dateStringLength);

				return [$.trim(dateTimeString.substring(0, dateStringLength)), $.trim(dateTimeString.substring(dateStringLength))];

			} else {
				throw err;
			}
		}
		return [dateTimeString, ''];
	};

	/*
	* Internal function to parse datetime interval
	* Returns: {date: Date, timeObj: Object}, where
	*   date - parsed date without time (type Date)
	*   timeObj = {hour: , minute: , second: , millisec: , microsec: } - parsed time. Optional
	*/
	var parseDateTimeInternal = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var date;
		var splitRes = splitDateTime(dateFormat, dateTimeString, dateSettings, timeSettings);
		date = $.datepicker._base_parseDate(dateFormat, splitRes[0], dateSettings);
		if (splitRes[1] !== '') {
			var timeString = splitRes[1],
				parsedTime = $.datepicker.parseTime(timeFormat, timeString, timeSettings);

			if (parsedTime === null) {
				throw 'Wrong time format';
			}
			return {
				date: date,
				timeObj: parsedTime
			};
		} else {
			return {
				date: date
			};
		}
	};

	/*
	* Internal function to set timezone_select to the local timezone
	*/
	var selectLocalTimezone = function(tp_inst, date) {
		if (tp_inst &amp;amp;&amp;amp; tp_inst.timezone_select) {
			var now = typeof date !== 'undefined' ? date : new Date();
			tp_inst.timezone_select.val(now.getTimezoneOffset()*-1);
		}
	};

	/*
	* Create a Singleton Insance
	*/
	$.timepicker = new Timepicker();

	/**
	 * Get the timezone offset as string from a date object (eg '+0530' for UTC+5.5)
	 * @@param  number if not a number this value is returned
	 * @@param boolean if true formats in accordance to iso8601 "+12:45"
	 * @@return string
	 */
	$.timepicker.timezoneOffsetString = function(tzMinutes, iso8601) {
		if(isNaN(tzMinutes) || tzMinutes &amp;gt; 840){
			return tzMinutes;
		}

		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601? ':':'',
			tz = (off &amp;gt;= 0 ? '+' : '-') + ('0' + (hours * 101).toString()).slice(-2) + iso + ('0' + (minutes * 101).toString()).slice(-2);
		
		if(tz == '+00:00'){
			return 'Z';
		}
		return tz;
	};

	/**
	 * Get the number in minutes that represents a timezone string
	 * @@param  string formated like "+0500", "-1245"
	 * @@return number
	 */
	$.timepicker.timezoneOffsetNumber = function(tzString) {
		tzString = tzString.toString().replace(':',''); // excuse any iso8601, end up with "+1245"

		if(tzString.toUpperCase() === 'Z'){ // if iso8601 with Z, its 0 minute offset
			return 0;
		}

		if(!/^(\-|\+)\d{4}$/.test(tzString)){ // possibly a user defined tz, so just give it back
			return tzString;
		}

		return ((tzString.substr(0,1) =='-'? -1 : 1) * // plus or minus
					((parseInt(tzString.substr(1,2),10)*60) + // hours (converted to minutes)
					parseInt(tzString.substr(3,2),10))); // minutes
	};

	/**
	 * No way to set timezone in js Date, so we must adjust the minutes to compensate. (think setDate, getDate)
	 * @@param  date
	 * @@param  string formated like "+0500", "-1245"
	 * @@return date
	 */
	$.timepicker.timezoneAdjust = function(date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if(!isNaN(toTz)){
			date.setMinutes(date.getMinutes()*1 + (date.getTimezoneOffset()*-1 - toTz*1) );
		}
		return date;
	};

	/**
	 * Calls `timepicker()` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * n.b. The input value must be correctly formatted (reformatting is not supported)
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the timepicker() call
	 * @@return jQuery
	 */
	$.timepicker.timeRange = function(startTime, endTime, options) {
		return $.timepicker.handleRange('timepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datetimepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@return jQuery
	 */
	$.timepicker.datetimeRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datetimepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.dateRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.handleRange = function(method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0, // min allowed interval in milliseconds
			maxInterval: 0, // max allowed interval in milliseconds
			start: {},      // options for start picker
			end: {}         // options for end picker
		}, options);

		$.fn[method].call(startTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), endTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), endTime, 'minDate');
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), startTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), startTime, 'maxDate');
			}
		}, options, options.end));

		checkDates(startTime, endTime);
		selected(startTime, endTime, 'minDate');
		selected(endTime, startTime, 'maxDate');

		function checkDates(changed, other) {
			var startdt = startTime[method]('getDate'),
				enddt = endTime[method]('getDate'),
				changeddt = changed[method]('getDate');

			if(startdt !== null){
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());

				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);

				if(options.minInterval &amp;gt; 0 &amp;amp;&amp;amp; minDate &amp;gt; enddt){ // minInterval check
					endTime[method]('setDate',minDate);
				}
				else if(options.maxInterval &amp;gt; 0 &amp;amp;&amp;amp; maxDate &amp;lt; enddt){ // max interval check
					endTime[method]('setDate',maxDate);
				}
				else if (startdt &amp;gt; enddt) {
					other[method]('setDate',changeddt);
				}
			}
		}

		function selected(changed, other, option) {
			if (!changed.val()) {
				return;
			}
			var date = changed[method].call(changed, 'getDate');
			if(date !== null &amp;amp;&amp;amp; options.minInterval &amp;gt; 0){
				if(option == 'minDate'){
					date.setMilliseconds(date.getMilliseconds() + options.minInterval); 
				}
				if(option == 'maxDate'){
					date.setMilliseconds(date.getMilliseconds() - options.minInterval);
				}
			}
			if (date.getTime) {
				other[method].call(other, 'option', option, date);
			}
		}
		return $([startTime.get(0), endTime.get(0)]);
	};

	/**
	 * Log error or data to the console during error or debugging
	 * @@param  Object err pass any type object to log to the console during error or debugging
	 * @@return void
	 */
	$.timepicker.log = function(err){
		if(window.console){
			console.log(err);
		}
	};

	/*
	* Microsecond support
	*/
	if(!Date.prototype.getMicroseconds){
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function(){ return this.microseconds; };
		Date.prototype.setMicroseconds = function(m){ 
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m/1000));
			this.microseconds = m%1000;
			return this;
		};
	}

	/*
	* Keep up with the version
	*/
	$.timepicker.version = "1.3.1";

})(jQuery);
jQuery.noConflict();
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;datetimepicker-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;e73a652e-09fc-4c71-8e7a-e2525a2d2a99&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
function replaceAllString(oriStr, strTarget, strSubString ){
   var strText = oriStr;
   var intIndexOfMatch = strText.indexOf( strTarget );
   while (intIndexOfMatch != -1){
      strText = strText.replace( strTarget, strSubString )
      intIndexOfMatch = strText.indexOf( strTarget );
   }
   return( strText );
}
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&amp;amp;]" + name + "=([^&amp;amp;#]*)"),
    results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
};


   var jobName= getParameterByName('job')
   var fromDate= getParameterByName('fromDate')
   var toDate= getParameterByName('toDate')
   var limit= getParameterByName('limit')
   var selectedIstIid = getParameterByName('IstIid')

  $("#jobname").ready(function(){
   $("#jobname").text(jobName)
   var convertedJobName = replaceAllString(jobName, ".", "_")
   $("#IstIid" + convertedJobName).ready(function(){
     $("#IstIid" + convertedJobName).css("display","block")
     $("#select_" + convertedJobName).ready(function(){
        $("#select_" + convertedJobName).val(selectedIstIid)
     });
   });
 });

  $("#fromDate").ready(function(){
   $("#from-date").val(fromDate)
 });

  $("#toDate").ready(function(){
   $("#to-date").val(toDate)
 });

  $("#limit").ready(function(){
   if(limit!=""){
    $("#limit").val(limit)
   }
 });
 // Get data with ajax
 function ajax_getData(jobName,fromDate,toDate,limit ){
       var convertedJobName = replaceAllString(jobName, ".", "_")
       var istIid = $("#select_" + convertedJobName).val()
       window.location="/xwiki/bin/view/WiperDog/WebHome?job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid="+istIid;
 			/*$.ajax({
			 type: "GET",
			 url:"/xwiki/bin/get/Sandbox/DescriptionForJob?outputSyntax=plain&amp;amp;job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid"+selectedIstIid,
			 success : function(result){
				$("#jobname").html(jobName)
				$("#display").text('[[]]' + result)
			 }
		   });*/
 }
	$("#treemenu2 a").click(function(){
		 var limit = 10
		 var fromDate=""
		 var toDate = ""
		 jobName= $(this).text()
                 $("#jobname").html(jobName)
                 var convertedJobName = replaceAllString(jobName, ".", "_")
                 $("#listIstIid &amp;gt; div").css("display","none")
                 $("#IstIid" + convertedJobName).css("display","block")
		 //ajax_getData(jobName,fromDate,toDate,limit )

	});

	$("#from-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
		dateFormat: 'yy-mm-dd',
	});
	$("#to-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
			dateFormat: 'yy-mm-dd',

	});
	 $("#get-data").on("click",function(){
		var fromDate = $("#from-date").val()
		var toDate =  $("#to-date").val()
		 if( toDate!= "" ){
			  if(fromDate != ""){
				  if($("#from-date").datepicker( "getDate" ) &amp;gt; $("#to-date").datepicker( "getDate" )){
				  alert("'From date' cannot start later than 'To date'")
				  return false
				  }
			  }
		 }
		 limit = $("#limit").val()
		 ajax_getData(jobName,fromDate,toDate,limit )

	});

jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;process&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;881686cc-1bfc-456e-b8ab-71334c4a45e5&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){

$(function () {
    function drawLineChart(xAxis, series, container, data_detail){
        var dataXAxis = xAxis
        var dataSeries = series
        var detail = data_detail

			$('#containerline' + container).highcharts({

				chart: {
					type:'line'
				},
				title: {
					text: container
				},
				tooltip :{
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				xAxis: dataXAxis ,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				series: dataSeries
			});
		};

		function drawBarChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerbar' + container).highcharts({
				chart: {
					type: 'column'
				},
				title: {
					text: container
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {

					column: {
						pointPadding: 0.2,
						borderWidth: 0
					}
				},
				series: dataSeries
			});
		}

		function drawAreaChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail
			$('#containerarea' + container).highcharts({
				chart: {
					type: 'area'
				},
				title: {
					text: container
				},
				subtitle: {
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					},
					labels: {
						formatter: function() {
							return this.value / 1000;
						}
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {
					area: {
						stacking: 'normal',
						lineColor: '#666666',
						lineWidth: 1,
						marker: {
							lineWidth: 1,
							lineColor: '#666666'
						}
					}
				},
				series: dataSeries
			});
		};

		function drawPieChart(data, container){
			var dataPie = data
			$(document).ready(function () {
				// Build the chart
				$('#container' + container).highcharts({
					chart: {
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: dataPie[0].name
					},
					tooltip: {
						pointFormat: '{series.name}: &amp;lt;b&amp;gt;{point.percentage:.1f}%&amp;lt;/b&amp;gt;'
					},
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							dataLabels: {
								enabled: false
							},
							showInLegend: true
						}
					},
					series: dataPie
				});
			});
		}

		// LINE
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonline_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonline");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Line chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						if(data_all[0][i].series[0].name == null){
							data_all[0][i].series[0].name = lstContainer[0][i]
						}
						drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
					}
				}
			}
		});

		// BAR
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonbar_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonbar");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Bar chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						drawBarChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
					}
				}
			}
		});

		// AREA
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonarea_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonarea");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				// data to display on tooltip
				var data_detail = data_all[0]
				// draw Area Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					drawAreaChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
				}
			}
		});

		// PIE
		$("#piechart").ready(function(){

			var array = $("#jsons&amp;gt;.jsonpie");
			var arrayContainer = $("#jsons&amp;gt;.lstcontainerpie");
			var lstContainer = [];
			var data_all = [];
			for(var i=0;i&amp;lt;array.length;i++){
				data_all[i] = jQuery.parseJSON(array[i].value)
				lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)

			}
			if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
				// data to display on tooltip
				// draw Pie Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					var finalData = []
					finalData[0] = data_all[0][i]
					drawPieChart(finalData, lstContainer[0][i])
				}
			}
		});
	});
	jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;d5873d92-b78b-42fc-9407-46d166204b88&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;/* css for timepicker */
.ui-timepicker-div .ui-widget-header { 
margin-bottom: 8px;
 }

.ui-timepicker-div dl { text-align: left; }
.ui-timepicker-div dl dt { height: 25px; margin-bottom: -25px; }
.ui-timepicker-div dl dd { margin: 0 10px 10px 65px; }
.ui-timepicker-div td { font-size: 90%; }
.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }

.ui-timepicker-rtl{ direction: rtl; }
.ui-timepicker-rtl dl { text-align: right; }
.ui-timepicker-rtl dl dd { margin: 0 65px 10px 10px; }
#ui-datepicker-div{
 position:relative;
 width:auto;
 height:auto
}
&lt;/code&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;datetimepicker -css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;1201fb1a-e9c1-4731-8c74-2ea8c0071959&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;.displayblock {
  border:2px solid;
  -webkit-border-radius:6px;
  background:gray;
  float: left;
  width:100%;
}

.displaypie {
  border:1px solid;
  -webkit-border-radius:6px;
  background:gray;
  width: 48%;
  float: left; 
  height: 300px;
}

.subtype {
  margin-top: 50px;
  font-size: 2em;
  color: red;
}&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;content&gt;{{include document="Lib.DataToDrawChart"/}}
{{include document="Lib.MongoDBConnection"/}}
{{velocity}}
$xwiki.jsx.use('Lib.JQueryUILib')
$xwiki.ssx.use('Lib.MenuGenerator')
$xwiki.jsx.use('Lib.MenuGenerator')
$xwiki.ssx.use('Lib.JQueryUILib')
{{/velocity}}
{{include document="Lib.MenuGenerator"/}}
{{html wiki="true" clean="false"}}
&amp;lt;div id="viewer"&amp;gt;
&amp;lt;table style="text-align:left"  &amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th &amp;gt;Job name&amp;lt;/th&amp;gt;
  &amp;lt;td colspan=3&amp;gt;&amp;lt;div id="jobname"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
{{groovy}}
import org.xwiki.context.*

def ec = services.component.getInstance(Execution.class).getContext()
def mapJobIstIid = ec.getProperty("mapJobIstIid")

println '{{html clean="false" wiki="false"}}'
println '&amp;lt;tr&amp;gt;'
println '&amp;lt;th&amp;gt;IstIid&amp;lt;/th&amp;gt;'
println '&amp;lt;td colspan=3&amp;gt;'
mapJobIstIid.each{jobEntry-&amp;gt;
  def convertedJobKey = jobEntry.key.replaceAll("\\.","_")
  println "&amp;lt;div id='listIstIid'&amp;gt;"
  println "&amp;lt;div id=IstIid${convertedJobKey} style='display:none'&amp;gt;"
  println "&amp;lt;select id=select_${convertedJobKey}&amp;gt;"
  jobEntry.value.each{
     println "&amp;lt;option value=\"$it\"&amp;gt;$it&amp;lt;/option&amp;gt;"
  }
  println "&amp;lt;/select&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
}
println '&amp;lt;/td&amp;gt;'
println '&amp;lt;/tr&amp;gt;'
println '{{/html}}'
{{/groovy}}
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data monitor from&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="from-date" id="from-date"/&amp;gt;&amp;lt;/td&amp;gt;
  &amp;lt;th&amp;gt;Data monitor to&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="to-date" id="to-date"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data records limit &amp;lt;/th&amp;gt;
  &amp;lt;td &amp;gt;
     &amp;lt;select id="limit"&amp;gt;
       &amp;lt;option value=5&amp;gt;5&amp;lt;/option&amp;gt;
       &amp;lt;option value=10&amp;gt;10&amp;lt;/option&amp;gt;
       &amp;lt;option value=15&amp;gt;15&amp;lt;/option&amp;gt;
       &amp;lt;option value=20&amp;gt;20&amp;lt;/option&amp;gt;
     &amp;lt;/select&amp;gt;
  &amp;lt;/td&amp;gt;
  &amp;lt;td colspan=3 &amp;gt;&amp;lt;input type="button" value="View Data" id="get-data" class="button"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr style="display:none"&amp;gt;
    &amp;lt;td colspan=3&amp;gt;
        &amp;lt;div id="livetableData"&amp;gt;&amp;lt;/div&amp;gt;
    &amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;&amp;lt;div id="display"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
&amp;lt;/table&amp;gt;

&amp;lt;/div&amp;gt; 
 &amp;lt;/body&amp;gt;

{{/html}}
{{groovy}}
import groovy.json.*
xwiki.jsx.use("Lib.Highcharts")

if(request.xpage == "plain") {
	response.setContentType('text/plain')
}

def listData = []
def job = request.get("job")
def fromDate = request.get("fromDate")
def toDate = request.get("toDate")
def limit= (request.get("limit")!=null)?request.get("limit").toInteger():10
def istIid = request.get("IstIid")

def str= "No data to retrieved !"
def result = null
if(job != "" &amp;amp;&amp;amp; job != null &amp;amp;&amp;amp; istIid != null &amp;amp;&amp;amp; istIid != ""){
	MongoDBConnection.getConnection()
	if(fromDate != "" || toDate != ""){
		result = MongoDBConnection.getDataInPeriod(job,fromDate,toDate,limit,istIid)
	} else {
		result = MongoDBConnection.getDataAllFields(job,limit,istIid)
        }
MongoDBConnection.closeConnection()
} else {
   println "{{warning}}There are no selected job or IstIid{{/warning}}"
}

if( (result != null) &amp;amp;&amp;amp; (result.size() &amp;gt; 0) &amp;amp;&amp;amp; (result[0].KEYEXPR != null)&amp;amp;&amp;amp;!(result[0].KEYEXPR instanceof List )){
if(result[0].type == "Subtyped") {
    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
    def dataSubtype = DataToDrawChart.getDataToDrawSubtype(result)
    def listKey = []
    dataSubtype.each {key,value -&amp;gt;
        listKey.add(key)
    }
    def jsonkey = com.mongodb.util.JSON.serialize(listKey)
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$jsonkey&amp;lt;/textarea&amp;gt;"

    dataSubtype.each {key,value -&amp;gt;
        println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +'&amp;lt;/div&amp;gt;'
        println "-----"
        def dataLine = []
        def dataBar = []
        def dataPie = []
        def dataArea = []
        if(DataToDrawChart.getDataToDrawLine(value) != []) {
            dataLine = DataToDrawChart.getDataToDrawLine(value)
        }
        if(DataToDrawChart.getDataToDrawBar(value) != []) {
            dataBar = DataToDrawChart.getDataToDrawBar(value)
        }
        if(DataToDrawChart.getDataToDrawPie(value) != []) {
            dataPie = DataToDrawChart.getDataToDrawPie(value)
        }
        if(DataToDrawChart.getDataToDrawArea(value) != []) {
            dataArea = DataToDrawChart.getDataToDrawArea(value)
        }

        def chartColumnsLine
        def chartColumnsBar 
        def chartColumnsArea 
        def lstName
        if(dataLine.size() &amp;gt; 0 ){
            chartColumnsLine = dataLine[0].chart_columns
        }
        if(dataBar.size() &amp;gt; 0){
            chartColumnsBar = dataBar[0].chart_columns
        }
        if(dataArea.size() &amp;gt; 0 ){
            chartColumnsArea = dataArea[0].chart_columns
        }
        if(dataPie.size() &amp;gt; 0 ){
            lstName = dataPie['name']
        }

        def tmpListNameContainer = []
	for(def nameContainer in lstName){
	   nameContainer = nameContainer.replaceAll("\\.", "_")
	   tmpListNameContainer.add(nameContainer)
	}
        def jsonPie
        def jsonLine
	def jsonBar
        def jsonArea
        if(dataPie != []) {
	    jsonPie = com.mongodb.util.JSON.serialize(dataPie)
        }
        if(dataLine != []) {
	    jsonLine = com.mongodb.util.JSON.serialize(dataLine)
        }
        if(dataBar != []) {
            jsonBar = com.mongodb.util.JSON.serialize(dataBar)
        }
        if(dataArea != []) {
	    jsonArea = com.mongodb.util.JSON.serialize(dataArea)
        }

	def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
	def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
	def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
	def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

	println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
        if(jsonLine != null) {
	    println "&amp;lt;textarea id=\"jsonline_$key\" &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;" 
        }
	if(jsonBar != null) {
            println "&amp;lt;textarea id=\"jsonbar_$key\"&amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
 	    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
        }
        if(jsonPie != null) {
	    println "&amp;lt;textarea id=\"jsonpie_$key\" &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
        }
        if(jsonArea != null) {
	    println "&amp;lt;textarea id=\"jsonarea_$key\" &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"
	    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
        }

	println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
	println "&amp;lt;input style=\"display:none\" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;"
	println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
	println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'
	println "&amp;lt;/div&amp;gt;"
	  
	def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
	def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
	  
	println "&amp;lt;div style='clear:both'&amp;gt;"
        if(jsonPie != null) {
	  println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
	  lstName.each{
	    def tmp = it.replaceAll("\\.", "_")
	    println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
        if(jsonLine != null) {
	  def chartLineComment = false
	  chartColumnsLine.each{
	    if(!chartLineComment){
	       println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	       chartLineComment = true  
	    }

	      println " &amp;lt;div class=\"displayblock\" id=\"containerline${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
        println "&amp;amp;nbsp;"

        if(jsonBar != null) {
	  def chartBarComment = false
	  chartColumnsBar.each{
	     if(!chartBarComment){
	        println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	        chartBarComment = true
	      }  

	     println " &amp;lt;div class=\"displayblock\" id=\"containerbar${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
	println "&amp;amp;nbsp;"

        if(jsonArea != null) {
	  def chartAreaComment = false
	  chartColumnsArea.each{
	  if(!chartAreaComment){
	    println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	    chartAreaComment = true
	  }
	    println " &amp;lt;div class=\"displayblock\" id=\"containerarea${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
	println "&amp;lt;/div&amp;gt;"
        
    }
    println '&amp;lt;/body&amp;gt;'
    println '{{/html}}'
} else if(result[0].type == "Store") {
    // data store
    def dataLine = DataToDrawChart.getDataToDrawLine(result)
    def dataBar = DataToDrawChart.getDataToDrawBar(result)
    def dataPie = DataToDrawChart.getDataToDrawPie(result)
    def dataArea = DataToDrawChart.getDataToDrawArea(result)
    def chartColumnsLine 
    def chartColumnsBar 
    def chartColumnsArea 
    def lstName 

    if(dataLine.size() &amp;gt; 0 ){
        chartColumnsLine = dataLine[0].chart_columns
    }
    if(dataBar.size() &amp;gt; 0){
        chartColumnsBar = dataBar[0].chart_columns
    }
    if(dataArea.size() &amp;gt; 0 ){
        chartColumnsArea = dataArea[0].chart_columns
    }
    if(dataPie.size() &amp;gt; 0 ){
        lstName = dataPie['name']
    }

    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
  
    def tmpListNameContainer = []
    for(def nameContainer in lstName){
       nameContainer = nameContainer.replaceAll("\\.", "_")
       tmpListNameContainer.add(nameContainer)
    }
  
    def jsonPie = com.mongodb.util.JSON.serialize(dataPie)
    def jsonLine = com.mongodb.util.JSON.serialize(dataLine)
    def jsonBar = com.mongodb.util.JSON.serialize(dataBar)
    def jsonArea = com.mongodb.util.JSON.serialize(dataArea)

    def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
    def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
    def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
    def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

    def listEmpty = com.mongodb.util.JSON.serialize([])
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$listEmpty&amp;lt;/textarea&amp;gt;" 

    println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'

    println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
    println "&amp;lt;textarea class='jsonline' &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonbar' &amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonpie' &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonarea' &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"

    println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
  
    def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
    def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
  
    println "&amp;lt;div style='clear:both'&amp;gt;"
  
    def chartPieComment = false
    lstName.each{
        if(!chartPieComment) {
            println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
            chartPieComment = true
        }
        def tmp = it.replaceAll("\\.", "_")
        println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    def chartLineComment = false
    chartColumnsLine.each{
    if(!chartLineComment){
        println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
        chartLineComment = true  
    }

    println " &amp;lt;div class=\"displayblock\" id=\"containerline$it\"&amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    println "&amp;amp;nbsp;"
    def chartBarComment = false
    chartColumnsBar.each{
        if(!chartBarComment){
            println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
            chartBarComment = true
        }  

    println " &amp;lt;div class=\"displayblock\" id=\"containerbar$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
  println "&amp;lt;/div&amp;gt;"
  println "&amp;amp;nbsp;"
  def chartAreaComment = false
  chartColumnsArea.each{
  if(!chartAreaComment){
    println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
    chartAreaComment = true
  }
    println " &amp;lt;div class=\"displayblock\" id=\"containerarea$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
  println "&amp;lt;/div&amp;gt;"
println "&amp;lt;/div&amp;gt;"

println '&amp;lt;/body&amp;gt;'
println '{{/html}}'
}
}else{
    println 'There is no data for this job with criterias'
}
{{/groovy}}&lt;/content&gt;&lt;/xwikidoc&gt;
@


30.17
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376369681000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376369681000&lt;/contentUpdateDate&gt;
&lt;version&gt;30.17&lt;/version&gt;
d3169 5
@


30.16
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376368620000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376368256000&lt;/contentUpdateDate&gt;
&lt;version&gt;30.16&lt;/version&gt;
d3215 1
@


30.15
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376368523000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;30.15&lt;/version&gt;
@


30.14
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376368463000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;30.14&lt;/version&gt;
a2522 1
console.log("vao day")
@


30.13
log
@@
text
@&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xwikidoc&gt;
&lt;web&gt;WiperDog&lt;/web&gt;
&lt;name&gt;WebHome&lt;/name&gt;
&lt;language&gt;&lt;/language&gt;
&lt;defaultLanguage&gt;en&lt;/defaultLanguage&gt;
&lt;translation&gt;0&lt;/translation&gt;
&lt;parent&gt;&lt;/parent&gt;
&lt;creator&gt;XWiki.Admin&lt;/creator&gt;
&lt;author&gt;XWiki.Admin&lt;/author&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;contentAuthor&gt;XWiki.Admin&lt;/contentAuthor&gt;
&lt;creationDate&gt;1376364375000&lt;/creationDate&gt;
&lt;date&gt;1376368351000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376368256000&lt;/contentUpdateDate&gt;
&lt;version&gt;30.13&lt;/version&gt;
&lt;title&gt;WiperDog&lt;/title&gt;
&lt;defaultTemplate&gt;&lt;/defaultTemplate&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;comment&gt;&lt;/comment&gt;
&lt;minorEdit&gt;true&lt;/minorEdit&gt;
&lt;syntaxId&gt;xwiki/2.1&lt;/syntaxId&gt;
&lt;hidden&gt;false&lt;/hidden&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;047293a8-524d-45e4-af52-cd944523d5d0&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
/*
 * jQuery timepicker addon
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 1.3.1
 * Last Modified: 07/07/2013
 *
 * Copyright 2013 Trent Richardson
 * You may use this project under MIT or GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 */

/*jslint evil: true, white: false, undef: false, nomen: false */

(function($) {

	/*
	* Lets not redefine timepicker, Prevent "Uncaught RangeError: Maximum call stack size exceeded"
	*/
	$.ui.timepicker = $.ui.timepicker || {};
	if ($.ui.timepicker.version) {
		return;
	}

	/*
	* Extend jQueryUI, get it started with our version number
	*/
	$.extend($.ui, {
		timepicker: {
			version: "1.3.1"
		}
	});

	/* 
	* Timepicker manager.
	* Use the singleton instance of this class, $.timepicker, to interact with the time picker.
	* Settings for (groups of) time pickers are maintained in an instance object,
	* allowing multiple different settings on the same page.
	*/
	var Timepicker = function() {
		this.regional = []; // Available regional settings, indexed by language code
		this.regional[''] = { // Default regional settings
			currentText: 'Now',
			closeText: 'Done',
			amNames: ['AM', 'A'],
			pmNames: ['PM', 'P'],
			timeFormat: 'HH:mm',
			timeSuffix: '',
			timeOnlyTitle: 'Choose Time',
			timeText: 'Time',
			hourText: 'Hour',
			minuteText: 'Minute',
			secondText: 'Second',
			millisecText: 'Millisecond',
			microsecText: 'Microsecond',
			timezoneText: 'Time Zone',
			isRTL: false
		};
		this._defaults = { // Global defaults for all the datetime picker instances
			showButtonPanel: true,
			timeOnly: false,
			showHour: null,
			showMinute: null,
			showSecond: null,
			showMillisec: null,
			showMicrosec: null,
			showTimezone: null,
			showTime: true,
			stepHour: 1,
			stepMinute: 1,
			stepSecond: 1,
			stepMillisec: 1,
			stepMicrosec: 1,
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			microsec: 0,
			timezone: null,
			hourMin: 0,
			minuteMin: 0,
			secondMin: 0,
			millisecMin: 0,
			microsecMin: 0,
			hourMax: 23,
			minuteMax: 59,
			secondMax: 59,
			millisecMax: 999,
			microsecMax: 999,
			minDateTime: null,
			maxDateTime: null,
			onSelect: null,
			hourGrid: 0,
			minuteGrid: 0,
			secondGrid: 0,
			millisecGrid: 0,
			microsecGrid: 0,
			alwaysSetTime: true,
			separator: ' ',
			altFieldTimeOnly: true,
			altTimeFormat: null,
			altSeparator: null,
			altTimeSuffix: null,
			pickerTimeFormat: null,
			pickerTimeSuffix: null,
			showTimepicker: true,
			timezoneList: null,
			addSliderAccess: false,
			sliderAccessArgs: null,
			controlType: 'slider',
			defaultValue: null,
			parse: 'strict'
		};
		$.extend(this._defaults, this.regional['']);
	};

	$.extend(Timepicker.prototype, {
		$input: null,
		$altInput: null,
		$timeObj: null,
		inst: null,
		hour_slider: null,
		minute_slider: null,
		second_slider: null,
		millisec_slider: null,
		microsec_slider: null,
		timezone_select: null,
		hour: 0,
		minute: 0,
		second: 0,
		millisec: 0,
		microsec: 0,
		timezone: null,
		hourMinOriginal: null,
		minuteMinOriginal: null,
		secondMinOriginal: null,
		millisecMinOriginal: null,
		microsecMinOriginal: null,
		hourMaxOriginal: null,
		minuteMaxOriginal: null,
		secondMaxOriginal: null,
		millisecMaxOriginal: null,
		microsecMaxOriginal: null,
		ampm: '',
		formattedDate: '',
		formattedTime: '',
		formattedDateTime: '',
		timezoneList: null,
		units: ['hour','minute','second','millisec', 'microsec'],
		support: {},
		control: null,

		/* 
		* Override the default settings for all instances of the time picker.
		* @@param  settings  object - the new settings to use as defaults (anonymous object)
		* @@return the manager object
		*/
		setDefaults: function(settings) {
			extendRemove(this._defaults, settings || {});
			return this;
		},

		/*
		* Create a new Timepicker instance
		*/
		_newInst: function($input, opts) {
			var tp_inst = new Timepicker(),
				inlineSettings = {},
            	fns = {},
		    	overrides, i;

			for (var attrName in this._defaults) {
				if(this._defaults.hasOwnProperty(attrName)){
					var attrValue = $input.attr('time:' + attrName);
					if (attrValue) {
						try {
							inlineSettings[attrName] = eval(attrValue);
						} catch (err) {
							inlineSettings[attrName] = attrValue;
						}
					}
				}
			}

		    overrides = {
		        beforeShow: function (input, dp_inst) {
		            if ($.isFunction(tp_inst._defaults.evnts.beforeShow)) {
		                return tp_inst._defaults.evnts.beforeShow.call($input[0], input, dp_inst, tp_inst);
		            }
		        },
		        onChangeMonthYear: function (year, month, dp_inst) {
		            // Update the time as well : this prevents the time from disappearing from the $input field.
		            tp_inst._updateDateTime(dp_inst);
		            if ($.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)) {
		                tp_inst._defaults.evnts.onChangeMonthYear.call($input[0], year, month, dp_inst, tp_inst);
		            }
		        },
		        onClose: function (dateText, dp_inst) {
		            if (tp_inst.timeDefined === true &amp;amp;&amp;amp; $input.val() !== '') {
		                tp_inst._updateDateTime(dp_inst);
		            }
		            if ($.isFunction(tp_inst._defaults.evnts.onClose)) {
		                tp_inst._defaults.evnts.onClose.call($input[0], dateText, dp_inst, tp_inst);
		            }
		        }
		    };
		    for (i in overrides) {
		        if (overrides.hasOwnProperty(i)) {
		            fns[i] = opts[i] || null;
		        }
		    }

		    tp_inst._defaults = $.extend({}, this._defaults, inlineSettings, opts, overrides, {
		        evnts:fns,
		        timepicker: tp_inst // add timepicker as a property of datepicker: $.datepicker._get(dp_inst, 'timepicker');
		    });
			tp_inst.amNames = $.map(tp_inst._defaults.amNames, function(val) {
				return val.toUpperCase();
			});
			tp_inst.pmNames = $.map(tp_inst._defaults.pmNames, function(val) {
				return val.toUpperCase();
			});

			// detect which units are supported
			tp_inst.support = detectSupport(
					tp_inst._defaults.timeFormat + 
					(tp_inst._defaults.pickerTimeFormat? tp_inst._defaults.pickerTimeFormat:'') + 
					(tp_inst._defaults.altTimeFormat? tp_inst._defaults.altTimeFormat:''));

			// controlType is string - key to our this._controls
			if(typeof(tp_inst._defaults.controlType) === 'string'){
				if(tp_inst._defaults.controlType == 'slider' &amp;amp;&amp;amp; typeof(jQuery.ui.slider) === 'undefined'){
					tp_inst._defaults.controlType = 'select';
				}
				tp_inst.control = tp_inst._controls[tp_inst._defaults.controlType];
			}
			// controlType is an object and must implement create, options, value methods
			else{ 
				tp_inst.control = tp_inst._defaults.controlType;
			}

			// prep the timezone options
			var timezoneList = [-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,
					0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];
			if (tp_inst._defaults.timezoneList !== null) {
				timezoneList = tp_inst._defaults.timezoneList;
			}
			var tzl=timezoneList.length,tzi=0,tzv=null;
			if (tzl &amp;gt; 0 &amp;amp;&amp;amp; typeof timezoneList[0] !== 'object') {
				for(; tzi&amp;lt;tzl; tzi++){
					tzv = timezoneList[tzi];
					timezoneList[tzi] = { value: tzv, label: $.timepicker.timezoneOffsetString(tzv, tp_inst.support.iso8601) };
				}
			}
			tp_inst._defaults.timezoneList = timezoneList;

			// set the default units
			tp_inst.timezone = tp_inst._defaults.timezone !== null? $.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone) : 
							((new Date()).getTimezoneOffset()*-1);
			tp_inst.hour = tp_inst._defaults.hour &amp;lt; tp_inst._defaults.hourMin? tp_inst._defaults.hourMin : 
							tp_inst._defaults.hour &amp;gt; tp_inst._defaults.hourMax? tp_inst._defaults.hourMax : tp_inst._defaults.hour;
			tp_inst.minute = tp_inst._defaults.minute &amp;lt; tp_inst._defaults.minuteMin? tp_inst._defaults.minuteMin : 
							tp_inst._defaults.minute &amp;gt; tp_inst._defaults.minuteMax? tp_inst._defaults.minuteMax : tp_inst._defaults.minute;
			tp_inst.second = tp_inst._defaults.second &amp;lt; tp_inst._defaults.secondMin? tp_inst._defaults.secondMin : 
							tp_inst._defaults.second &amp;gt; tp_inst._defaults.secondMax? tp_inst._defaults.secondMax : tp_inst._defaults.second;
			tp_inst.millisec = tp_inst._defaults.millisec &amp;lt; tp_inst._defaults.millisecMin? tp_inst._defaults.millisecMin : 
							tp_inst._defaults.millisec &amp;gt; tp_inst._defaults.millisecMax? tp_inst._defaults.millisecMax : tp_inst._defaults.millisec;
			tp_inst.microsec = tp_inst._defaults.microsec &amp;lt; tp_inst._defaults.microsecMin? tp_inst._defaults.microsecMin : 
							tp_inst._defaults.microsec &amp;gt; tp_inst._defaults.microsecMax? tp_inst._defaults.microsecMax : tp_inst._defaults.microsec;
			tp_inst.ampm = '';
			tp_inst.$input = $input;

			if (tp_inst._defaults.altField) {
				tp_inst.$altInput = $(tp_inst._defaults.altField).css({
					cursor: 'pointer'
				}).focus(function() {
					$input.trigger("focus");
				});
			}

			if (tp_inst._defaults.minDate === 0 || tp_inst._defaults.minDateTime === 0) {
				tp_inst._defaults.minDate = new Date();
			}
			if (tp_inst._defaults.maxDate === 0 || tp_inst._defaults.maxDateTime === 0) {
				tp_inst._defaults.maxDate = new Date();
			}

			// datepicker needs minDate/maxDate, timepicker needs minDateTime/maxDateTime..
			if (tp_inst._defaults.minDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDate instanceof Date) {
				tp_inst._defaults.minDateTime = new Date(tp_inst._defaults.minDate.getTime());
			}
			if (tp_inst._defaults.minDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.minDateTime instanceof Date) {
				tp_inst._defaults.minDate = new Date(tp_inst._defaults.minDateTime.getTime());
			}
			if (tp_inst._defaults.maxDate !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDate instanceof Date) {
				tp_inst._defaults.maxDateTime = new Date(tp_inst._defaults.maxDate.getTime());
			}
			if (tp_inst._defaults.maxDateTime !== undefined &amp;amp;&amp;amp; tp_inst._defaults.maxDateTime instanceof Date) {
				tp_inst._defaults.maxDate = new Date(tp_inst._defaults.maxDateTime.getTime());
			}
			tp_inst.$input.bind('focus', function() {
				tp_inst._onFocus();
			});

			return tp_inst;
		},

		/*
		* add our sliders to the calendar
		*/
		_addTimePicker: function(dp_inst) {
			var currDT = (this.$altInput &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly) ? this.$input.val() + ' ' + this.$altInput.val() : this.$input.val();

			this.timeDefined = this._parseTime(currDT);
			this._limitMinMaxDateTime(dp_inst, false);
			this._injectTimePicker();
		},

		/*
		* parse the time string from input value or _setTime
		*/
		_parseTime: function(timeString, withDate) {
			if (!this.inst) {
				this.inst = $.datepicker._getInst(this.$input[0]);
			}

			if (withDate || !this._defaults.timeOnly) {
				var dp_dateFormat = $.datepicker._get(this.inst, 'dateFormat');
				try {
					var parseRes = parseDateTimeInternal(dp_dateFormat, this._defaults.timeFormat, timeString, $.datepicker._getFormatConfig(this.inst), this._defaults);
					if (!parseRes.timeObj) {
						return false;
					}
					$.extend(this, parseRes.timeObj);
				} catch (err) {
					$.timepicker.log("Error parsing the date/time string: " + err +
									"\ndate/time string = " + timeString +
									"\ntimeFormat = " + this._defaults.timeFormat +
									"\ndateFormat = " + dp_dateFormat);
					return false;
				}
				return true;
			} else {
				var timeObj = $.datepicker.parseTime(this._defaults.timeFormat, timeString, this._defaults);
				if (!timeObj) {
					return false;
				}
				$.extend(this, timeObj);
				return true;
			}
		},

		/*
		* generate and inject html for timepicker into ui datepicker
		*/
		_injectTimePicker: function() {
			var $dp = this.inst.dpDiv,
				o = this.inst.settings,
				tp_inst = this,
				litem = '',
				uitem = '',
				show = null,
				max = {},
				gridSize = {},
				size = null,
				i=0,
				l=0;

			// Prevent displaying twice
			if ($dp.find("div.ui-timepicker-div").length === 0 &amp;amp;&amp;amp; o.showTimepicker) {
				var noDisplay = ' style="display:none;"',
					html = '&amp;lt;div class="ui-timepicker-div'+ (o.isRTL? ' ui-timepicker-rtl' : '') +'"&amp;gt;&amp;lt;dl&amp;gt;' + '&amp;lt;dt class="ui_tpicker_time_label"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;' + o.timeText + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_time"' + ((o.showTime) ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the markup
				for(i=0,l=this.units.length; i&amp;lt;l; i++){
					litem = this.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// Added by Peter Medeiros:
					// - Figure out what the hour/minute/second max should be based on the step values.
					// - Example: if stepMinute is 15, then minMax is 45.
					max[litem] = parseInt((o[litem+'Max'] - ((o[litem+'Max'] - o[litem+'Min']) % o['step'+uitem])), 10);
					gridSize[litem] = 0;

					html += '&amp;lt;dt class="ui_tpicker_'+ litem +'_label"' + (show ? '' : noDisplay) + '&amp;gt;' + o[litem +'Text'] + '&amp;lt;/dt&amp;gt;' + 
								'&amp;lt;dd class="ui_tpicker_'+ litem +'"&amp;gt;&amp;lt;div class="ui_tpicker_'+ litem +'_slider"' + (show ? '' : noDisplay) + '&amp;gt;&amp;lt;/div&amp;gt;';

					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						html += '&amp;lt;div style="padding-left: 1px"&amp;gt;&amp;lt;table class="ui-tpicker-grid-label"&amp;gt;&amp;lt;tr&amp;gt;';

						if(litem == 'hour'){
							for (var h = o[litem+'Min']; h &amp;lt;= max[litem]; h += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								var tmph = $.datepicker.formatTime(this.support.ampm? 'hht':'HH', {hour:h}, o);									
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + tmph + '&amp;lt;/td&amp;gt;';
							}
						}
						else{
							for (var m = o[litem+'Min']; m &amp;lt;= max[litem]; m += parseInt(o[litem+'Grid'], 10)) {
								gridSize[litem]++;
								html += '&amp;lt;td data-for="'+litem+'"&amp;gt;' + ((m &amp;lt; 10) ? '0' : '') + m + '&amp;lt;/td&amp;gt;';
							}
						}

						html += '&amp;lt;/tr&amp;gt;&amp;lt;/table&amp;gt;&amp;lt;/div&amp;gt;';
					}
					html += '&amp;lt;/dd&amp;gt;';
				}
				
				// Timezone
				var showTz = o.showTimezone !== null? o.showTimezone : this.support.timezone;
				html += '&amp;lt;dt class="ui_tpicker_timezone_label"' + (showTz ? '' : noDisplay) + '&amp;gt;' + o.timezoneText + '&amp;lt;/dt&amp;gt;';
				html += '&amp;lt;dd class="ui_tpicker_timezone" ' + (showTz ? '' : noDisplay) + '&amp;gt;&amp;lt;/dd&amp;gt;';

				// Create the elements from string
				html += '&amp;lt;/dl&amp;gt;&amp;lt;/div&amp;gt;';
				var $tp = $(html);

				// if we only want time picker...
				if (o.timeOnly === true) {
					$tp.prepend('&amp;lt;div class="ui-widget-header ui-helper-clearfix ui-corner-all"&amp;gt;' + '&amp;lt;div class="ui-datepicker-title"&amp;gt;' + o.timeOnlyTitle + '&amp;lt;/div&amp;gt;' + '&amp;lt;/div&amp;gt;');
					$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();
				}
				
				// add sliders, adjust grids, add events
				for(i=0,l=tp_inst.units.length; i&amp;lt;l; i++){
					litem = tp_inst.units[i];
					uitem = litem.substr(0,1).toUpperCase() + litem.substr(1);
					show = o['show'+uitem] !== null? o['show'+uitem] : this.support[litem];

					// add the slider
					tp_inst[litem+'_slider'] = tp_inst.control.create(tp_inst, $tp.find('.ui_tpicker_'+litem+'_slider'), litem, tp_inst[litem], o[litem+'Min'], max[litem], o['step'+uitem]);

					// adjust the grid and add click event
					if (show &amp;amp;&amp;amp; o[litem+'Grid'] &amp;gt; 0) {
						size = 100 * gridSize[litem] * o[litem+'Grid'] / (max[litem] - o[litem+'Min']);
						$tp.find('.ui_tpicker_'+litem+' table').css({
							width: size + "%",
							marginLeft: o.isRTL? '0' : ((size / (-2 * gridSize[litem])) + "%"),
							marginRight: o.isRTL? ((size / (-2 * gridSize[litem])) + "%") : '0',
							borderCollapse: 'collapse'
						}).find("td").click(function(e){
								var $t = $(this),
									h = $t.html(),
									n = parseInt(h.replace(/[^0-9]/g),10),
									ap = h.replace(/[^apm]/ig),
									f = $t.data('for'); // loses scope, so we use data-for

								if(f == 'hour'){
									if(ap.indexOf('p') !== -1 &amp;amp;&amp;amp; n &amp;lt; 12){
										n += 12;
									}
									else{
										if(ap.indexOf('a') !== -1 &amp;amp;&amp;amp; n === 12){
											n = 0;
										}
									}
								}
								
								tp_inst.control.value(tp_inst, tp_inst[f+'_slider'], litem, n);

								tp_inst._onTimeChange();
								tp_inst._onSelectHandler();
							}).css({
								cursor: 'pointer',
								width: (100 / gridSize[litem]) + '%',
								textAlign: 'center',
								overflow: 'hidden'
							});
					} // end if grid &amp;gt; 0
				} // end for loop

				// Add timezone options
				this.timezone_select = $tp.find('.ui_tpicker_timezone').append('&amp;lt;select&amp;gt;&amp;lt;/select&amp;gt;').find("select");
				$.fn.append.apply(this.timezone_select,
				$.map(o.timezoneList, function(val, idx) {
					return $("&amp;lt;option /&amp;gt;").val(typeof val == "object" ? val.value : val).text(typeof val == "object" ? val.label : val);
				}));
				if (typeof(this.timezone) != "undefined" &amp;amp;&amp;amp; this.timezone !== null &amp;amp;&amp;amp; this.timezone !== "") {
					var local_timezone = (new Date(this.inst.selectedYear, this.inst.selectedMonth, this.inst.selectedDay, 12)).getTimezoneOffset()*-1;
					if (local_timezone == this.timezone) {
						selectLocalTimezone(tp_inst);
					} else {
						this.timezone_select.val(this.timezone);
					}
				} else {
					if (typeof(this.hour) != "undefined" &amp;amp;&amp;amp; this.hour !== null &amp;amp;&amp;amp; this.hour !== "") {
						this.timezone_select.val(o.timezone);
					} else {
						selectLocalTimezone(tp_inst);
					}
				}
				this.timezone_select.change(function() {
					tp_inst._onTimeChange();
					tp_inst._onSelectHandler();
				});
				// End timezone options
				
				// inject timepicker into datepicker
				var $buttonPanel = $dp.find('.ui-datepicker-buttonpane');
				if ($buttonPanel.length) {
					$buttonPanel.before($tp);
				} else {
					$dp.append($tp);
				}

				this.$timeObj = $tp.find('.ui_tpicker_time');

				if (this.inst !== null) {
					var timeDefined = this.timeDefined;
					this._onTimeChange();
					this.timeDefined = timeDefined;
				}

				// slideAccess integration: http://trentrichardson.com/2011/11/11/jquery-ui-sliders-and-touch-accessibility/
				if (this._defaults.addSliderAccess) {
					var sliderAccessArgs = this._defaults.sliderAccessArgs,
						rtl = this._defaults.isRTL;
					sliderAccessArgs.isRTL = rtl;
						
					setTimeout(function() { // fix for inline mode
						if ($tp.find('.ui-slider-access').length === 0) {
							$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);

							// fix any grids since sliders are shorter
							var sliderAccessWidth = $tp.find('.ui-slider-access:eq(0)').outerWidth(true);
							if (sliderAccessWidth) {
								$tp.find('table:visible').each(function() {
									var $g = $(this),
										oldWidth = $g.outerWidth(),
										oldMarginLeft = $g.css(rtl? 'marginRight':'marginLeft').toString().replace('%', ''),
										newWidth = oldWidth - sliderAccessWidth,
										newMarginLeft = ((oldMarginLeft * newWidth) / oldWidth) + '%',
										css = { width: newWidth, marginRight: 0, marginLeft: 0 };
									css[rtl? 'marginRight':'marginLeft'] = newMarginLeft;
									$g.css(css);
								});
							}
						}
					}, 10);
				}
				// end slideAccess integration

				tp_inst._limitMinMaxDateTime(this.inst, true);
			}
		},

		/*
		* This function tries to limit the ability to go outside the
		* min/max date range
		*/
		_limitMinMaxDateTime: function(dp_inst, adjustSliders) {
			var o = this._defaults,
				dp_date = new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay);

			if (!this._defaults.showTimepicker) {
				return;
			} // No time so nothing to check here

			if ($.datepicker._get(dp_inst, 'minDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'minDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var minDateTime = $.datepicker._get(dp_inst, 'minDateTime'),
					minDateTimeDate = new Date(minDateTime.getFullYear(), minDateTime.getMonth(), minDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMinOriginal === null || this.minuteMinOriginal === null || this.secondMinOriginal === null || this.millisecMinOriginal === null || this.microsecMinOriginal === null) {
					this.hourMinOriginal = o.hourMin;
					this.minuteMinOriginal = o.minuteMin;
					this.secondMinOriginal = o.secondMin;
					this.millisecMinOriginal = o.millisecMin;
					this.microsecMinOriginal = o.microsecMin;
				}

				if (dp_inst.settings.timeOnly || minDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMin = minDateTime.getHours();
					if (this.hour &amp;lt;= this._defaults.hourMin) {
						this.hour = this._defaults.hourMin;
						this._defaults.minuteMin = minDateTime.getMinutes();
						if (this.minute &amp;lt;= this._defaults.minuteMin) {
							this.minute = this._defaults.minuteMin;
							this._defaults.secondMin = minDateTime.getSeconds();
							if (this.second &amp;lt;= this._defaults.secondMin) {
								this.second = this._defaults.secondMin;
								this._defaults.millisecMin = minDateTime.getMilliseconds();
								if(this.millisec &amp;lt;= this._defaults.millisecMin) {
									this.millisec = this._defaults.millisecMin;
									this._defaults.microsecMin = minDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;lt; this._defaults.microsecMin) {
										this.microsec = this._defaults.microsecMin;
									}
									this._defaults.microsecMin = this.microsecMinOriginal;
								}
							} else {
								this._defaults.millisecMin = this.millisecMinOriginal;
								this._defaults.microsecMin = this.microsecMinOriginal;
							}
						} else {
							this._defaults.secondMin = this.secondMinOriginal;
							this._defaults.millisecMin = this.millisecMinOriginal;
							this._defaults.microsecMin = this.microsecMinOriginal;
						}
					} else {
						this._defaults.minuteMin = this.minuteMinOriginal;
						this._defaults.secondMin = this.secondMinOriginal;
						this._defaults.millisecMin = this.millisecMinOriginal;
						this._defaults.microsecMin = this.microsecMinOriginal;
					}
				} else {
					this._defaults.hourMin = this.hourMinOriginal;
					this._defaults.minuteMin = this.minuteMinOriginal;
					this._defaults.secondMin = this.secondMinOriginal;
					this._defaults.millisecMin = this.millisecMinOriginal;
					this._defaults.microsecMin = this.microsecMinOriginal;
				}
			}

			if ($.datepicker._get(dp_inst, 'maxDateTime') !== null &amp;amp;&amp;amp; $.datepicker._get(dp_inst, 'maxDateTime') !== undefined &amp;amp;&amp;amp; dp_date) {
				var maxDateTime = $.datepicker._get(dp_inst, 'maxDateTime'),
					maxDateTimeDate = new Date(maxDateTime.getFullYear(), maxDateTime.getMonth(), maxDateTime.getDate(), 0, 0, 0, 0);

				if (this.hourMaxOriginal === null || this.minuteMaxOriginal === null || this.secondMaxOriginal === null || this.millisecMaxOriginal === null) {
					this.hourMaxOriginal = o.hourMax;
					this.minuteMaxOriginal = o.minuteMax;
					this.secondMaxOriginal = o.secondMax;
					this.millisecMaxOriginal = o.millisecMax;
					this.microsecMaxOriginal = o.microsecMax;
				}

				if (dp_inst.settings.timeOnly || maxDateTimeDate.getTime() == dp_date.getTime()) {
					this._defaults.hourMax = maxDateTime.getHours();
					if (this.hour &amp;gt;= this._defaults.hourMax) {
						this.hour = this._defaults.hourMax;
						this._defaults.minuteMax = maxDateTime.getMinutes();
						if (this.minute &amp;gt;= this._defaults.minuteMax) {
							this.minute = this._defaults.minuteMax;
							this._defaults.secondMax = maxDateTime.getSeconds();
							if (this.second &amp;gt;= this._defaults.secondMax) {
								this.second = this._defaults.secondMax;
								this._defaults.millisecMax = maxDateTime.getMilliseconds();
								if (this.millisec &amp;gt;= this._defaults.millisecMax) {
									this.millisec = this._defaults.millisecMax;
									this._defaults.microsecMax = maxDateTime.getMicroseconds();
								} else {
									if (this.microsec &amp;gt; this._defaults.microsecMax) {
										this.microsec = this._defaults.microsecMax;
									}
									this._defaults.microsecMax = this.microsecMaxOriginal;
								}
							} else {
								this._defaults.millisecMax = this.millisecMaxOriginal;
								this._defaults.microsecMax = this.microsecMaxOriginal;
							}
						} else {
							this._defaults.secondMax = this.secondMaxOriginal;
							this._defaults.millisecMax = this.millisecMaxOriginal;
							this._defaults.microsecMax = this.microsecMaxOriginal;
						}
					} else {
						this._defaults.minuteMax = this.minuteMaxOriginal;
						this._defaults.secondMax = this.secondMaxOriginal;
						this._defaults.millisecMax = this.millisecMaxOriginal;
						this._defaults.microsecMax = this.microsecMaxOriginal;
					}
				} else {
					this._defaults.hourMax = this.hourMaxOriginal;
					this._defaults.minuteMax = this.minuteMaxOriginal;
					this._defaults.secondMax = this.secondMaxOriginal;
					this._defaults.millisecMax = this.millisecMaxOriginal;
					this._defaults.microsecMax = this.microsecMaxOriginal;
				}
			}

			if (adjustSliders !== undefined &amp;amp;&amp;amp; adjustSliders === true) {
				var hourMax = parseInt((this._defaults.hourMax - ((this._defaults.hourMax - this._defaults.hourMin) % this._defaults.stepHour)), 10),
					minMax = parseInt((this._defaults.minuteMax - ((this._defaults.minuteMax - this._defaults.minuteMin) % this._defaults.stepMinute)), 10),
					secMax = parseInt((this._defaults.secondMax - ((this._defaults.secondMax - this._defaults.secondMin) % this._defaults.stepSecond)), 10),
					millisecMax = parseInt((this._defaults.millisecMax - ((this._defaults.millisecMax - this._defaults.millisecMin) % this._defaults.stepMillisec)), 10);
					microsecMax = parseInt((this._defaults.microsecMax - ((this._defaults.microsecMax - this._defaults.microsecMin) % this._defaults.stepMicrosec)), 10);

				if (this.hour_slider) {
					this.control.options(this, this.hour_slider, 'hour', { min: this._defaults.hourMin, max: hourMax });
					this.control.value(this, this.hour_slider, 'hour', this.hour - (this.hour % this._defaults.stepHour));
				}
				if (this.minute_slider) {
					this.control.options(this, this.minute_slider, 'minute', { min: this._defaults.minuteMin, max: minMax });
					this.control.value(this, this.minute_slider, 'minute', this.minute - (this.minute % this._defaults.stepMinute));
				}
				if (this.second_slider) {
					this.control.options(this, this.second_slider, 'second', { min: this._defaults.secondMin, max: secMax });
					this.control.value(this, this.second_slider, 'second', this.second - (this.second % this._defaults.stepSecond));
				}
				if (this.millisec_slider) {
					this.control.options(this, this.millisec_slider, 'millisec', { min: this._defaults.millisecMin, max: millisecMax });
					this.control.value(this, this.millisec_slider, 'millisec', this.millisec - (this.millisec % this._defaults.stepMillisec));
				}
				if (this.microsec_slider) {
					this.control.options(this, this.microsec_slider, 'microsec', { min: this._defaults.microsecMin, max: microsecMax });
					this.control.value(this, this.microsec_slider, 'microsec', this.microsec - (this.microsec % this._defaults.stepMicrosec));
				}
			}

		},

		/*
		* when a slider moves, set the internal time...
		* on time change is also called when the time is updated in the text field
		*/
		_onTimeChange: function() {
			var hour = (this.hour_slider) ? this.control.value(this, this.hour_slider, 'hour') : false,
				minute = (this.minute_slider) ? this.control.value(this, this.minute_slider, 'minute') : false,
				second = (this.second_slider) ? this.control.value(this, this.second_slider, 'second') : false,
				millisec = (this.millisec_slider) ? this.control.value(this, this.millisec_slider, 'millisec') : false,
				microsec = (this.microsec_slider) ? this.control.value(this, this.microsec_slider, 'microsec') : false,
				timezone = (this.timezone_select) ? this.timezone_select.val() : false,
				o = this._defaults,
				pickerTimeFormat = o.pickerTimeFormat || o.timeFormat,
				pickerTimeSuffix = o.pickerTimeSuffix || o.timeSuffix;

			if (typeof(hour) == 'object') {
				hour = false;
			}
			if (typeof(minute) == 'object') {
				minute = false;
			}
			if (typeof(second) == 'object') {
				second = false;
			}
			if (typeof(millisec) == 'object') {
				millisec = false;
			}
			if (typeof(microsec) == 'object') {
				microsec = false;
			}
			if (typeof(timezone) == 'object') {
				timezone = false;
			}

			if (hour !== false) {
				hour = parseInt(hour, 10);
			}
			if (minute !== false) {
				minute = parseInt(minute, 10);
			}
			if (second !== false) {
				second = parseInt(second, 10);
			}
			if (millisec !== false) {
				millisec = parseInt(millisec, 10);
			}
			if (microsec !== false) {
				microsec = parseInt(microsec, 10);
			}

			var ampm = o[hour &amp;lt; 12 ? 'amNames' : 'pmNames'][0];

			// If the update was done in the input field, the input field should not be updated.
			// If the update was done using the sliders, update the input field.
			var hasChanged = (hour != this.hour || minute != this.minute || second != this.second || millisec != this.millisec || microsec != this.microsec 
								|| (this.ampm.length &amp;gt; 0 &amp;amp;&amp;amp; (hour &amp;lt; 12) != ($.inArray(this.ampm.toUpperCase(), this.amNames) !== -1)) 
								|| (this.timezone !== null &amp;amp;&amp;amp; timezone != this.timezone));

			if (hasChanged) {

				if (hour !== false) {
					this.hour = hour;
				}
				if (minute !== false) {
					this.minute = minute;
				}
				if (second !== false) {
					this.second = second;
				}
				if (millisec !== false) {
					this.millisec = millisec;
				}
				if (microsec !== false) {
					this.microsec = microsec;
				}
				if (timezone !== false) {
					this.timezone = timezone;
				}

				if (!this.inst) {
					this.inst = $.datepicker._getInst(this.$input[0]);
				}

				this._limitMinMaxDateTime(this.inst, true);
			}
			if (this.support.ampm) {
				this.ampm = ampm;
			}

			// Updates the time within the timepicker
			this.formattedTime = $.datepicker.formatTime(o.timeFormat, this, o);
			if (this.$timeObj) {
				if(pickerTimeFormat === o.timeFormat){
					this.$timeObj.text(this.formattedTime + pickerTimeSuffix);
				}
				else{
					this.$timeObj.text($.datepicker.formatTime(pickerTimeFormat, this, o) + pickerTimeSuffix);
				}
			}

			this.timeDefined = true;
			if (hasChanged) {
				this._updateDateTime();
			}
		},

		/*
		* call custom onSelect.
		* bind to sliders slidestop, and grid click.
		*/
		_onSelectHandler: function() {
			var onSelect = this._defaults.onSelect || this.inst.settings.onSelect;
			var inputEl = this.$input ? this.$input[0] : null;
			if (onSelect &amp;amp;&amp;amp; inputEl) {
				onSelect.apply(inputEl, [this.formattedDateTime, this]);
			}
		},

		/*
		* update our input with the new date time..
		*/
		_updateDateTime: function(dp_inst) {
			dp_inst = this.inst || dp_inst;
			//var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear, dp_inst.selectedMonth, dp_inst.selectedDay)),
			var dt = $.datepicker._daylightSavingAdjust(new Date(dp_inst.currentYear, dp_inst.currentMonth, dp_inst.currentDay)),
				dateFmt = $.datepicker._get(dp_inst, 'dateFormat'),
				formatCfg = $.datepicker._getFormatConfig(dp_inst),
				timeAvailable = dt !== null &amp;amp;&amp;amp; this.timeDefined;
			this.formattedDate = $.datepicker.formatDate(dateFmt, (dt === null ? new Date() : dt), formatCfg);
			var formattedDateTime = this.formattedDate;
			
			// if a slider was changed but datepicker doesn't have a value yet, set it
			if(dp_inst.lastVal===""){
                dp_inst.currentYear=dp_inst.selectedYear;
                dp_inst.currentMonth=dp_inst.selectedMonth;
                dp_inst.currentDay=dp_inst.selectedDay;
            }

			/*
			* remove following lines to force every changes in date picker to change the input value
			* Bug descriptions: when an input field has a default value, and click on the field to pop up the date picker. 
			* If the user manually empty the value in the input field, the date picker will never change selected value.
			*/
			//if (dp_inst.lastVal !== undefined &amp;amp;&amp;amp; (dp_inst.lastVal.length &amp;gt; 0 &amp;amp;&amp;amp; this.$input.val().length === 0)) {
			//	return;
			//}

			if (this._defaults.timeOnly === true) {
				formattedDateTime = this.formattedTime;
			} else if (this._defaults.timeOnly !== true &amp;amp;&amp;amp; (this._defaults.alwaysSetTime || timeAvailable)) {
				formattedDateTime += this._defaults.separator + this.formattedTime + this._defaults.timeSuffix;
			}

			this.formattedDateTime = formattedDateTime;

			if (!this._defaults.showTimepicker) {
				this.$input.val(this.formattedDate);
			} else if (this.$altInput &amp;amp;&amp;amp; this._defaults.timeOnly === false &amp;amp;&amp;amp; this._defaults.altFieldTimeOnly === true) {
				this.$altInput.val(this.formattedTime);
				this.$input.val(this.formattedDate);
			} else if (this.$altInput) {
				this.$input.val(formattedDateTime);
				var altFormattedDateTime = '',
					altSeparator = this._defaults.altSeparator ? this._defaults.altSeparator : this._defaults.separator,
					altTimeSuffix = this._defaults.altTimeSuffix ? this._defaults.altTimeSuffix : this._defaults.timeSuffix;
				
				if(!this._defaults.timeOnly){
					if (this._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(this._defaults.altFormat, (dt === null ? new Date() : dt), formatCfg);
					}
					else{
						altFormattedDateTime = this.formattedDate;
					}

					if (altFormattedDateTime){
						altFormattedDateTime += altSeparator;
					}
				}

				if(this._defaults.altTimeFormat){
					altFormattedDateTime += $.datepicker.formatTime(this._defaults.altTimeFormat, this, this._defaults) + altTimeSuffix;
				}
				else{
					altFormattedDateTime += this.formattedTime + altTimeSuffix;
				}
				this.$altInput.val(altFormattedDateTime);
			} else {
				this.$input.val(formattedDateTime);
			}

			this.$input.trigger("change");
		},

		_onFocus: function() {
			if (!this.$input.val() &amp;amp;&amp;amp; this._defaults.defaultValue) {
				this.$input.val(this._defaults.defaultValue);
				var inst = $.datepicker._getInst(this.$input.get(0)),
					tp_inst = $.datepicker._get(inst, 'timepicker');
				if (tp_inst) {
					if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
						try {
							$.datepicker._updateDatepicker(inst);
						} catch (err) {
							$.timepicker.log(err);
						}
					}
				}
			}
		},

		/*
		* Small abstraction to control types
		* We can add more, just be sure to follow the pattern: create, options, value
		*/
		_controls: {
			// slider methods
			slider: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var rtl = tp_inst._defaults.isRTL; // if rtl go -60-&amp;gt;0 instead of 0-&amp;gt;60
					return obj.prop('slide', null).slider({
						orientation: "horizontal",
						value: rtl? val*-1 : val,
						min: rtl? max*-1 : min,
						max: rtl? min*-1 : max,
						step: step,
						slide: function(event, ui) {
							tp_inst.control.value(tp_inst, $(this), unit, rtl? ui.value*-1:ui.value);
							tp_inst._onTimeChange();
						},
						stop: function(event, ui) {
							tp_inst._onSelectHandler();
						}
					});	
				},
				options: function(tp_inst, obj, unit, opts, val){
					if(tp_inst._defaults.isRTL){
						if(typeof(opts) == 'string'){
							if(opts == 'min' || opts == 'max'){
								if(val !== undefined){
									return obj.slider(opts, val*-1);
								}
								return Math.abs(obj.slider(opts));
							}
							return obj.slider(opts);
						}
						var min = opts.min, 
							max = opts.max;
						opts.min = opts.max = null;
						if(min !== undefined){
							opts.max = min * -1;
						}
						if(max !== undefined){
							opts.min = max * -1;
						}
						return obj.slider(opts);
					}
					if(typeof(opts) == 'string' &amp;amp;&amp;amp; val !== undefined){
							return obj.slider(opts, val);
					}
					return obj.slider(opts);
				},
				value: function(tp_inst, obj, unit, val){
					if(tp_inst._defaults.isRTL){
						if(val !== undefined){
							return obj.slider('value', val*-1);
						}
						return Math.abs(obj.slider('value'));
					}
					if(val !== undefined){
						return obj.slider('value', val);
					}
					return obj.slider('value');
				}
			},
			// select methods
			select: {
				create: function(tp_inst, obj, unit, val, min, max, step){
					var sel = '&amp;lt;select class="ui-timepicker-select" data-unit="'+ unit +'" data-min="'+ min +'" data-max="'+ max +'" data-step="'+ step +'"&amp;gt;',
						format = tp_inst._defaults.pickerTimeFormat || tp_inst._defaults.timeFormat;

					for(var i=min; i&amp;lt;=max; i+=step){						
						sel += '&amp;lt;option value="'+ i +'"'+ (i==val? ' selected':'') +'&amp;gt;';
						if(unit == 'hour'){
							sel += $.datepicker.formatTime($.trim(format.replace(/[^ht ]/ig,'')), {hour:i}, tp_inst._defaults);
						}
						else if(unit == 'millisec' || unit == 'microsec' || i &amp;gt;= 10){ sel += i; }
						else {sel += '0'+ i.toString(); }
						sel += '&amp;lt;/option&amp;gt;';
					}
					sel += '&amp;lt;/select&amp;gt;';

					obj.children('select').remove();

					$(sel).appendTo(obj).change(function(e){
						tp_inst._onTimeChange();
						tp_inst._onSelectHandler();
					});

					return obj;
				},
				options: function(tp_inst, obj, unit, opts, val){
					var o = {},
						$t = obj.children('select');
					if(typeof(opts) == 'string'){
						if(val === undefined){
							return $t.data(opts);
						}
						o[opts] = val;	
					}
					else{ o = opts; }
					return tp_inst.control.create(tp_inst, obj, $t.data('unit'), $t.val(), o.min || $t.data('min'), o.max || $t.data('max'), o.step || $t.data('step'));
				},
				value: function(tp_inst, obj, unit, val){
					var $t = obj.children('select');
					if(val !== undefined){
						return $t.val(val);
					}
					return $t.val();
				}
			}
		} // end _controls

	});

	$.fn.extend({
		/*
		* shorthand just to use timepicker..
		*/
		timepicker: function(o) {
			o = o || {};
			var tmp_args = Array.prototype.slice.call(arguments);

			if (typeof o == 'object') {
				tmp_args[0] = $.extend(o, {
					timeOnly: true
				});
			}

			return $(this).each(function() {
				$.fn.datetimepicker.apply($(this), tmp_args);
			});
		},

		/*
		* extend timepicker to datepicker
		*/
		datetimepicker: function(o) {
			o = o || {};
			var tmp_args = arguments;

			if (typeof(o) == 'string') {
				if (o == 'getDate') {
					return $.fn.datepicker.apply($(this[0]), tmp_args);
				} else {
					return this.each(function() {
						var $t = $(this);
						$t.datepicker.apply($t, tmp_args);
					});
				}
			} else {
				return this.each(function() {
					var $t = $(this);
					$t.datepicker($.timepicker._newInst($t, o)._defaults);
				});
			}
		}
	});

	/*
	* Public Utility to parse date and time
	*/
	$.datepicker.parseDateTime = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var parseRes = parseDateTimeInternal(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings);
		if (parseRes.timeObj) {
			var t = parseRes.timeObj;
			parseRes.date.setHours(t.hour, t.minute, t.second, t.millisec);
			parseRes.date.setMicroseconds(t.microsec);
		}

		return parseRes.date;
	};

	/*
	* Public utility to parse time
	*/
	$.datepicker.parseTime = function(timeFormat, timeString, options) {		
		var o = extendRemove(extendRemove({}, $.timepicker._defaults), options || {}),
			iso8601 = (timeFormat.replace(/\'.*?\'/g,'').indexOf('Z') !== -1);

		// Strict parse requires the timeString to match the timeFormat exactly
		var strictParse = function(f, s, o){

			// pattern for standard and localized AM/PM markers
			var getPatternAmpm = function(amNames, pmNames) {
				var markers = [];
				if (amNames) {
					$.merge(markers, amNames);
				}
				if (pmNames) {
					$.merge(markers, pmNames);
				}
				markers = $.map(markers, function(val) {
					return val.replace(/[.*+?|()\[\]{}\\]/g, '\\$&amp;amp;');
				});
				return '(' + markers.join('|') + ')?';
			};

			// figure out position of time elements.. cause js cant do named captures
			var getFormatPositions = function(timeFormat) {
				var finds = timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),
					orders = {
						h: -1,
						m: -1,
						s: -1,
						l: -1,
						c: -1,
						t: -1,
						z: -1
					};

				if (finds) {
					for (var i = 0; i &amp;lt; finds.length; i++) {
						if (orders[finds[i].toString().charAt(0)] == -1) {
							orders[finds[i].toString().charAt(0)] = i + 1;
						}
					}
				}
				return orders;
			};

			var regstr = '^' + f.toString()
					.replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g, function (match) {
							var ml = match.length;
							switch (match.charAt(0).toLowerCase()) {
								case 'h': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'm': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 's': return ml === 1? '(\\d?\\d)':'(\\d{'+ml+'})';
								case 'l': return '(\\d?\\d?\\d)';
								case 'c': return '(\\d?\\d?\\d)';
								case 'z': return '(z|[-+]\\d\\d:?\\d\\d|\\S+)?';
								case 't': return getPatternAmpm(o.amNames, o.pmNames);
								default:    // literal escaped in quotes
									return '(' + match.replace(/\'/g, "").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g, function (m) { return "\\" + m; }) + ')?';
							}
						})
					.replace(/\s/g, '\\s?') +
					o.timeSuffix + '$',
				order = getFormatPositions(f),
				ampm = '',
				treg;

			treg = s.match(new RegExp(regstr, 'i'));

			var resTime = {
				hour: 0,
				minute: 0,
				second: 0,
				millisec: 0,
				microsec: 0
			};

			if (treg) {
				if (order.t !== -1) {
					if (treg[order.t] === undefined || treg[order.t].length === 0) {
						ampm = '';
						resTime.ampm = '';
					} else {
						ampm = $.inArray(treg[order.t].toUpperCase(), o.amNames) !== -1 ? 'AM' : 'PM';
						resTime.ampm = o[ampm == 'AM' ? 'amNames' : 'pmNames'][0];
					}
				}

				if (order.h !== -1) {
					if (ampm == 'AM' &amp;amp;&amp;amp; treg[order.h] == '12') {
						resTime.hour = 0; // 12am = 0 hour
					} else {
						if (ampm == 'PM' &amp;amp;&amp;amp; treg[order.h] != '12') {
							resTime.hour = parseInt(treg[order.h], 10) + 12; // 12pm = 12 hour, any other pm = hour + 12
						} else {
							resTime.hour = Number(treg[order.h]);
						}
					}
				}

				if (order.m !== -1) {
					resTime.minute = Number(treg[order.m]);
				}
				if (order.s !== -1) {
					resTime.second = Number(treg[order.s]);
				}
				if (order.l !== -1) {
					resTime.millisec = Number(treg[order.l]);
				}
				if (order.c !== -1) {
					resTime.microsec = Number(treg[order.c]);
				}
				if (order.z !== -1 &amp;amp;&amp;amp; treg[order.z] !== undefined) {
					resTime.timezone = $.timepicker.timezoneOffsetNumber(treg[order.z]);
				}


				return resTime;
			}
			return false;
		};// end strictParse

		// First try JS Date, if that fails, use strictParse
		var looseParse = function(f,s,o){
			try{
				var d = new Date('2012-01-01 '+ s);
				if(isNaN(d.getTime())){
					d = new Date('2012-01-01T'+ s);
					if(isNaN(d.getTime())){
						d = new Date('01/01/2012 '+ s);
						if(isNaN(d.getTime())){
							throw "Unable to parse time with native Date: "+ s;
						}
					}
				}

				return {
					hour: d.getHours(),
					minute: d.getMinutes(),
					second: d.getSeconds(),
					millisec: d.getMilliseconds(),
					microsec: d.getMicroseconds(),
					timezone: d.getTimezoneOffset()*-1
				};
			}
			catch(err){
				try{
					return strictParse(f,s,o);
				}
				catch(err2){
					$.timepicker.log("Unable to parse \ntimeString: "+ s +"\ntimeFormat: "+ f);
				}				
			}
			return false;
		}; // end looseParse
		
		if(typeof o.parse === "function"){
			return o.parse(timeFormat, timeString, o);
		}
		if(o.parse === 'loose'){
			return looseParse(timeFormat, timeString, o);
		}
		return strictParse(timeFormat, timeString, o);
	};

	/*
	* Public utility to format the time
	* format = string format of the time
	* time = a {}, not a Date() for timezones
	* options = essentially the regional[].. amNames, pmNames, ampm
	*/
	$.datepicker.formatTime = function(format, time, options) {
		options = options || {};
		options = $.extend({}, $.timepicker._defaults, options);
		time = $.extend({
			hour: 0,
			minute: 0,
			second: 0,
			millisec: 0,
			timezone: 0
		}, time);

		var tmptime = format,
			ampmName = options.amNames[0],
			hour = parseInt(time.hour, 10);

		if (hour &amp;gt; 11) {
			ampmName = options.pmNames[0];
		}

		tmptime = tmptime.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|('.*?'|".*?"))/g, function(match) {
		switch (match) {
			case 'HH':
				return ('0' + hour).slice(-2);
			case 'H':
				return hour;
			case 'hh':
				return ('0' + convert24to12(hour)).slice(-2);
			case 'h':
				return convert24to12(hour);
			case 'mm':
				return ('0' + time.minute).slice(-2);
			case 'm':
				return time.minute;
			case 'ss':
				return ('0' + time.second).slice(-2);
			case 's':
				return time.second;
			case 'l':
				return ('00' + time.millisec).slice(-3);
			case 'c':
				return ('00' + time.microsec).slice(-3);
			case 'z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, false);
			case 'Z':
				return $.timepicker.timezoneOffsetString(time.timezone === null? options.timezone : time.timezone, true);
			case 'T': 
				return ampmName.charAt(0).toUpperCase();
			case 'TT': 
				return ampmName.toUpperCase();
			case 't':
				return ampmName.charAt(0).toLowerCase();
			case 'tt':
				return ampmName.toLowerCase();
			default:
				return match.replace(/\'/g, "") || "'";
			}
		});

		tmptime = $.trim(tmptime);
		return tmptime;
	};

	/*
	* the bad hack :/ override datepicker so it doesnt close on select
	// inspired: http://stackoverflow.com/questions/1252512/jquery-datepicker-prevent-closing-picker-when-clicking-a-date/1762378#1762378
	*/
	$.datepicker._base_selectDate = $.datepicker._selectDate;
	$.datepicker._selectDate = function(id, dateStr) {
		var inst = this._getInst($(id)[0]),
			tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			tp_inst._limitMinMaxDateTime(inst, true);
			inst.inline = inst.stay_open = true;
			//This way the onSelect handler called from calendarpicker get the full dateTime
			this._base_selectDate(id, dateStr);
			inst.inline = inst.stay_open = false;
			this._notifyChange(inst);
			this._updateDatepicker(inst);
		} else {
			this._base_selectDate(id, dateStr);
		}
	};

	/*
	* second bad hack :/ override datepicker so it triggers an event when changing the input field
	* and does not redraw the datepicker on every selectDate event
	*/
	$.datepicker._base_updateDatepicker = $.datepicker._updateDatepicker;
	$.datepicker._updateDatepicker = function(inst) {

		// don't popup the datepicker if there is another instance already opened
		var input = inst.input[0];
		if ($.datepicker._curInst &amp;amp;&amp;amp; $.datepicker._curInst != inst &amp;amp;&amp;amp; $.datepicker._datepickerShowing &amp;amp;&amp;amp; $.datepicker._lastInput != input) {
			return;
		}

		if (typeof(inst.stay_open) !== 'boolean' || inst.stay_open === false) {

			this._base_updateDatepicker(inst);

			// Reload the time control when changing something in the input text field.
			var tp_inst = this._get(inst, 'timepicker');
			if (tp_inst) {
				tp_inst._addTimePicker(inst);
			}
		}
	};

	/*
	* third bad hack :/ override datepicker so it allows spaces and colon in the input field
	*/
	$.datepicker._base_doKeyPress = $.datepicker._doKeyPress;
	$.datepicker._doKeyPress = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if ($.datepicker._get(inst, 'constrainInput')) {
				var ampm = tp_inst.support.ampm,
					tz = tp_inst._defaults.showTimezone !== null? tp_inst._defaults.showTimezone : tp_inst.support.timezone,					
					dateChars = $.datepicker._possibleChars($.datepicker._get(inst, 'dateFormat')),
					datetimeChars = tp_inst._defaults.timeFormat.toString()
											.replace(/[hms]/g, '')
											.replace(/TT/g, ampm ? 'APM' : '')
											.replace(/Tt/g, ampm ? 'AaPpMm' : '')
											.replace(/tT/g, ampm ? 'AaPpMm' : '')
											.replace(/T/g, ampm ? 'AP' : '')
											.replace(/tt/g, ampm ? 'apm' : '')
											.replace(/t/g, ampm ? 'ap' : '') + 
											" " + tp_inst._defaults.separator + 
											tp_inst._defaults.timeSuffix + 
											(tz ? tp_inst._defaults.timezoneList.join('') : '') + 
											(tp_inst._defaults.amNames.join('')) + (tp_inst._defaults.pmNames.join('')) + 
											dateChars,
					chr = String.fromCharCode(event.charCode === undefined ? event.keyCode : event.charCode);
				return event.ctrlKey || (chr &amp;lt; ' ' || !dateChars || datetimeChars.indexOf(chr) &amp;gt; -1);
			}
		}

		return $.datepicker._base_doKeyPress(event);
	};

	/*
	* Fourth bad hack :/ override _updateAlternate function used in inline mode to init altField
	*/
	$.datepicker._base_updateAlternate = $.datepicker._updateAlternate;
	/* Update any alternate field to synchronise with the main field. */
	$.datepicker._updateAlternate = function(inst) {
		var tp_inst = this._get(inst, 'timepicker');
		if(tp_inst){
			var altField = tp_inst._defaults.altField;
			if (altField) { // update alternate field too
				var altFormat = tp_inst._defaults.altFormat || tp_inst._defaults.dateFormat,
					date = this._getDate(inst),
					formatCfg = $.datepicker._getFormatConfig(inst),
					altFormattedDateTime = '', 
					altSeparator = tp_inst._defaults.altSeparator ? tp_inst._defaults.altSeparator : tp_inst._defaults.separator, 
					altTimeSuffix = tp_inst._defaults.altTimeSuffix ? tp_inst._defaults.altTimeSuffix : tp_inst._defaults.timeSuffix,
					altTimeFormat = tp_inst._defaults.altTimeFormat !== null ? tp_inst._defaults.altTimeFormat : tp_inst._defaults.timeFormat;
				
				altFormattedDateTime += $.datepicker.formatTime(altTimeFormat, tp_inst, tp_inst._defaults) + altTimeSuffix;
				if(!tp_inst._defaults.timeOnly &amp;amp;&amp;amp; !tp_inst._defaults.altFieldTimeOnly &amp;amp;&amp;amp; date !== null){
					if(tp_inst._defaults.altFormat){
						altFormattedDateTime = $.datepicker.formatDate(tp_inst._defaults.altFormat, date, formatCfg) + altSeparator + altFormattedDateTime;
					}
					else{
						altFormattedDateTime = tp_inst.formattedDate + altSeparator + altFormattedDateTime;
					}
				}
				$(altField).val(altFormattedDateTime);
			}
		}
		else{
			$.datepicker._base_updateAlternate(inst);
		}
	};

	/*
	* Override key up event to sync manual input changes.
	*/
	$.datepicker._base_doKeyUp = $.datepicker._doKeyUp;
	$.datepicker._doKeyUp = function(event) {
		var inst = $.datepicker._getInst(event.target),
			tp_inst = $.datepicker._get(inst, 'timepicker');

		if (tp_inst) {
			if (tp_inst._defaults.timeOnly &amp;amp;&amp;amp; (inst.input.val() != inst.lastVal)) {
				try {
					$.datepicker._updateDatepicker(inst);
				} catch (err) {
					$.timepicker.log(err);
				}
			}
		}

		return $.datepicker._base_doKeyUp(event);
	};

	/*
	* override "Today" button to also grab the time.
	*/
	$.datepicker._base_gotoToday = $.datepicker._gotoToday;
	$.datepicker._gotoToday = function(id) {
		var inst = this._getInst($(id)[0]),
			$dp = inst.dpDiv;
		this._base_gotoToday(id);
		var tp_inst = this._get(inst, 'timepicker');
		selectLocalTimezone(tp_inst);
		var now = new Date();
		this._setTime(inst, now);
		$('.ui-datepicker-today', $dp).click();
	};

	/*
	* Disable &amp;amp; enable the Time in the datetimepicker
	*/
	$.datepicker._disableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = false;
			tp_inst._updateDateTime(inst);
		}
	};

	$.datepicker._enableTimepickerDatepicker = function(target) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');
		$(target).datepicker('getDate'); // Init selected[Year|Month|Day]
		if (tp_inst) {
			tp_inst._defaults.showTimepicker = true;
			tp_inst._addTimePicker(inst); // Could be disabled on page load
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create our own set time function
	*/
	$.datepicker._setTime = function(inst, date) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var defaults = tp_inst._defaults;

			// calling _setTime with no date sets time to defaults
			tp_inst.hour = date ? date.getHours() : defaults.hour;
			tp_inst.minute = date ? date.getMinutes() : defaults.minute;
			tp_inst.second = date ? date.getSeconds() : defaults.second;
			tp_inst.millisec = date ? date.getMilliseconds() : defaults.millisec;
			tp_inst.microsec = date ? date.getMicroseconds() : defaults.microsec;

			//check if within min/max times.. 
			tp_inst._limitMinMaxDateTime(inst, true);

			tp_inst._onTimeChange();
			tp_inst._updateDateTime(inst);
		}
	};

	/*
	* Create new public method to set only time, callable as $().datepicker('setTime', date)
	*/
	$.datepicker._setTimeDatepicker = function(target, date, withDate) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			this._setDateFromField(inst);
			var tp_date;
			if (date) {
				if (typeof date == "string") {
					tp_inst._parseTime(date, withDate);
					tp_date = new Date();
					tp_date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
					tp_date.setMicroseconds(tp_inst.microsec);
				} else {
					tp_date = new Date(date.getTime());
					tp_date.setMicroseconds(date.getMicroseconds());
				}
				if (tp_date.toString() == 'Invalid Date') {
					tp_date = undefined;
				}
				this._setTime(inst, tp_date);
			}
		}

	};

	/*
	* override setDate() to allow setting time too within Date object
	*/
	$.datepicker._base_setDateDatepicker = $.datepicker._setDateDatepicker;
	$.datepicker._setDateDatepicker = function(target, date) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		if(typeof(date) === 'string'){
			date = new Date(date);
			if(!date.getTime()){
				$.timepicker.log("Error creating Date object from string.");
			}
		}

		var tp_inst = this._get(inst, 'timepicker');
		var tp_date;
		if (date instanceof Date) {
			tp_date = new Date(date.getTime());
			tp_date.setMicroseconds(date.getMicroseconds());
		} else {
			tp_date = date;
		}
		
		// This is important if you are using the timezone option, javascript's Date 
		// object will only return the timezone offset for the current locale, so we 
		// adjust it accordingly.  If not using timezone option this won't matter..
		// If a timezone is different in tp, keep the timezone as is
		if(tp_inst){
			// look out for DST if tz wasn't specified
			if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
				tp_inst.timezone = tp_date.getTimezoneOffset()*-1;
			}
			date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
			tp_date = $.timepicker.timezoneAdjust(tp_date, tp_inst.timezone);
		}

		this._updateDatepicker(inst);
		this._base_setDateDatepicker.apply(this, arguments);
		this._setTimeDatepicker(target, tp_date, true);
	};

	/*
	* override getDate() to allow getting time too within Date object
	*/
	$.datepicker._base_getDateDatepicker = $.datepicker._getDateDatepicker;
	$.datepicker._getDateDatepicker = function(target, noDefault) {
		var inst = this._getInst(target);
		if (!inst) {
			return;
		}

		var tp_inst = this._get(inst, 'timepicker');

		if (tp_inst) {
			// if it hasn't yet been defined, grab from field
			if(inst.lastVal === undefined){
				this._setDateFromField(inst, noDefault);
			}

			var date = this._getDate(inst);
			if (date &amp;amp;&amp;amp; tp_inst._parseTime($(target).val(), tp_inst.timeOnly)) {
				date.setHours(tp_inst.hour, tp_inst.minute, tp_inst.second, tp_inst.millisec);
				date.setMicroseconds(tp_inst.microsec);

				// This is important if you are using the timezone option, javascript's Date 
				// object will only return the timezone offset for the current locale, so we 
				// adjust it accordingly.  If not using timezone option this won't matter..
				if(tp_inst.timezone != null){
					// look out for DST if tz wasn't specified
					if(!tp_inst.support.timezone &amp;amp;&amp;amp; tp_inst._defaults.timezone === null){
						tp_inst.timezone = date.getTimezoneOffset()*-1;
					}
					date = $.timepicker.timezoneAdjust(date, tp_inst.timezone);
				}
			}
			return date;
		}
		return this._base_getDateDatepicker(target, noDefault);
	};

	/*
	* override parseDate() because UI 1.8.14 throws an error about "Extra characters"
	* An option in datapicker to ignore extra format characters would be nicer.
	*/
	$.datepicker._base_parseDate = $.datepicker.parseDate;
	$.datepicker.parseDate = function(format, value, settings) {
		var date;
		try {
			date = this._base_parseDate(format, value, settings);
		} catch (err) {
			// Hack!  The error message ends with a colon, a space, and
			// the "extra" characters.  We rely on that instead of
			// attempting to perfectly reproduce the parsing algorithm.
			if (err.indexOf(":") &amp;gt;= 0) {
				date = this._base_parseDate(format, value.substring(0,value.length-(err.length-err.indexOf(':')-2)), settings);
				$.timepicker.log("Error parsing the date string: " + err + "\ndate string = " + value + "\ndate format = " + format);
			} else {
				throw err;
			}
		}
		return date;
	};

	/*
	* override formatDate to set date with time to the input
	*/
	$.datepicker._base_formatDate = $.datepicker._formatDate;
	$.datepicker._formatDate = function(inst, day, month, year) {
		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			tp_inst._updateDateTime(inst);
			return tp_inst.$input.val();
		}
		return this._base_formatDate(inst);
	};

	/*
	* override options setter to add time to maxDate(Time) and minDate(Time). MaxDate
	*/
	$.datepicker._base_optionDatepicker = $.datepicker._optionDatepicker;
	$.datepicker._optionDatepicker = function(target, name, value) {
		var inst = this._getInst(target),
	        name_clone;
		if (!inst) {
			return null;
		}

		var tp_inst = this._get(inst, 'timepicker');
		if (tp_inst) {
			var min = null,
				max = null,
				onselect = null,
				overrides = tp_inst._defaults.evnts,
				fns = {},
				prop;
		    if (typeof name == 'string') { // if min/max was set with the string
		        if (name === 'minDate' || name === 'minDateTime') {
		            min = value;
		        } else if (name === 'maxDate' || name === 'maxDateTime') {
		            max = value;
		        } else if (name === 'onSelect') {
		            onselect = value;
		        } else if (overrides.hasOwnProperty(name)) {
		            if (typeof (value) === 'undefined') {
		                return overrides[name];
		            }
		            fns[name] = value;
		            name_clone = {}; //empty results in exiting function after overrides updated
		        }
		    } else if (typeof name == 'object') { //if min/max was set with the JSON
		        if (name.minDate) {
		            min = name.minDate;
		        } else if (name.minDateTime) {
		            min = name.minDateTime;
		        } else if (name.maxDate) {
		            max = name.maxDate;
		        } else if (name.maxDateTime) {
		            max = name.maxDateTime;
		        }
		        for (prop in overrides) {
		            if (overrides.hasOwnProperty(prop) &amp;amp;&amp;amp; name[prop]) {
		                fns[prop] = name[prop];
		            }
		        }
		    }
		    for (prop in fns) {
		        if (fns.hasOwnProperty(prop)) {
		            overrides[prop] = fns[prop];
		            if (!name_clone) { name_clone = $.extend({}, name);}
		            delete name_clone[prop];
		        }
		    }
		    if (name_clone &amp;amp;&amp;amp; isEmptyObject(name_clone)) { return; }
		    if (min) { //if min was set
		        if (min === 0) {
		            min = new Date();
		        } else {
		            min = new Date(min);
		        }
		        tp_inst._defaults.minDate = min;
		        tp_inst._defaults.minDateTime = min;
		    } else if (max) { //if max was set
		        if (max === 0) {
		            max = new Date();
		        } else {
		            max = new Date(max);
		        }
		        tp_inst._defaults.maxDate = max;
		        tp_inst._defaults.maxDateTime = max;
		    } else if (onselect) {
		        tp_inst._defaults.onSelect = onselect;
		    }
		}
		if (value === undefined) {
			return this._base_optionDatepicker.call($.datepicker, target, name);
		}
		return this._base_optionDatepicker.call($.datepicker, target, name_clone || name, value);
	};
	
	/*
	* jQuery isEmptyObject does not check hasOwnProperty - if someone has added to the object prototype,
	* it will return false for all objects
	*/
	var isEmptyObject = function(obj) {
		var prop;
		for (prop in obj) {
			if (obj.hasOwnProperty(obj)) {
				return false;
			}
		}
		return true;
	};

	/*
	* jQuery extend now ignores nulls!
	*/
	var extendRemove = function(target, props) {
		$.extend(target, props);
		for (var name in props) {
			if (props[name] === null || props[name] === undefined) {
				target[name] = props[name];
			}
		}
		return target;
	};

	/*
	* Determine by the time format which units are supported
	* Returns an object of booleans for each unit
	*/
	var detectSupport = function(timeFormat){
		var tf = timeFormat.replace(/\'.*?\'/g,'').toLowerCase(), // removes literals
			isIn = function(f, t){ // does the format contain the token?
					return f.indexOf(t) !== -1? true:false; 
				};
		return {
				hour: isIn(tf,'h'),
				minute: isIn(tf,'m'),
				second: isIn(tf,'s'),
				millisec: isIn(tf,'l'),
				microsec: isIn(tf,'c'),
				timezone: isIn(tf,'z'),
				ampm: isIn(tf,'t') &amp;amp;&amp;amp; isIn(timeFormat,'h'),
				iso8601: isIn(timeFormat, 'Z')
			};
	};

	/*
	* Converts 24 hour format into 12 hour
	* Returns 12 hour without leading 0
	*/
	var convert24to12 = function(hour) {
		if (hour &amp;gt; 12) {
			hour = hour - 12;
		}

		if (hour === 0) {
			hour = 12;
		}

		return String(hour);
	};

	/*
	* Splits datetime string into date ans time substrings.
	* Throws exception when date can't be parsed
	* Returns [dateString, timeString]
	*/
	var splitDateTime = function(dateFormat, dateTimeString, dateSettings, timeSettings) {
		try {
			// The idea is to get the number separator occurances in datetime and the time format requested (since time has 
			// fewer unknowns, mostly numbers and am/pm). We will use the time pattern to split.
			var separator = timeSettings &amp;amp;&amp;amp; timeSettings.separator ? timeSettings.separator : $.timepicker._defaults.separator,
				format = timeSettings &amp;amp;&amp;amp; timeSettings.timeFormat ? timeSettings.timeFormat : $.timepicker._defaults.timeFormat,
				timeParts = format.split(separator), // how many occurances of separator may be in our format?
				timePartsLen = timeParts.length,
				allParts = dateTimeString.split(separator),
				allPartsLen = allParts.length;

			if (allPartsLen &amp;gt; 1) {
				return [
						allParts.splice(0,allPartsLen-timePartsLen).join(separator),
						allParts.splice(0,timePartsLen).join(separator)
					];
			}

		} catch (err) {
			$.timepicker.log('Could not split the date from the time. Please check the following datetimepicker options' +
					"\nthrown error: " + err +
					"\ndateTimeString" + dateTimeString +
					"\ndateFormat = " + dateFormat +
					"\nseparator = " + timeSettings.separator +
					"\ntimeFormat = " + timeSettings.timeFormat);

			if (err.indexOf(":") &amp;gt;= 0) {
				// Hack!  The error message ends with a colon, a space, and
				// the "extra" characters.  We rely on that instead of
				// attempting to perfectly reproduce the parsing algorithm.
				var dateStringLength = dateTimeString.length - (err.length - err.indexOf(':') - 2),
					timeString = dateTimeString.substring(dateStringLength);

				return [$.trim(dateTimeString.substring(0, dateStringLength)), $.trim(dateTimeString.substring(dateStringLength))];

			} else {
				throw err;
			}
		}
		return [dateTimeString, ''];
	};

	/*
	* Internal function to parse datetime interval
	* Returns: {date: Date, timeObj: Object}, where
	*   date - parsed date without time (type Date)
	*   timeObj = {hour: , minute: , second: , millisec: , microsec: } - parsed time. Optional
	*/
	var parseDateTimeInternal = function(dateFormat, timeFormat, dateTimeString, dateSettings, timeSettings) {
		var date;
		var splitRes = splitDateTime(dateFormat, dateTimeString, dateSettings, timeSettings);
		date = $.datepicker._base_parseDate(dateFormat, splitRes[0], dateSettings);
		if (splitRes[1] !== '') {
			var timeString = splitRes[1],
				parsedTime = $.datepicker.parseTime(timeFormat, timeString, timeSettings);

			if (parsedTime === null) {
				throw 'Wrong time format';
			}
			return {
				date: date,
				timeObj: parsedTime
			};
		} else {
			return {
				date: date
			};
		}
	};

	/*
	* Internal function to set timezone_select to the local timezone
	*/
	var selectLocalTimezone = function(tp_inst, date) {
		if (tp_inst &amp;amp;&amp;amp; tp_inst.timezone_select) {
			var now = typeof date !== 'undefined' ? date : new Date();
			tp_inst.timezone_select.val(now.getTimezoneOffset()*-1);
		}
	};

	/*
	* Create a Singleton Insance
	*/
	$.timepicker = new Timepicker();

	/**
	 * Get the timezone offset as string from a date object (eg '+0530' for UTC+5.5)
	 * @@param  number if not a number this value is returned
	 * @@param boolean if true formats in accordance to iso8601 "+12:45"
	 * @@return string
	 */
	$.timepicker.timezoneOffsetString = function(tzMinutes, iso8601) {
		if(isNaN(tzMinutes) || tzMinutes &amp;gt; 840){
			return tzMinutes;
		}

		var off = tzMinutes,
			minutes = off % 60,
			hours = (off - minutes) / 60,
			iso = iso8601? ':':'',
			tz = (off &amp;gt;= 0 ? '+' : '-') + ('0' + (hours * 101).toString()).slice(-2) + iso + ('0' + (minutes * 101).toString()).slice(-2);
		
		if(tz == '+00:00'){
			return 'Z';
		}
		return tz;
	};

	/**
	 * Get the number in minutes that represents a timezone string
	 * @@param  string formated like "+0500", "-1245"
	 * @@return number
	 */
	$.timepicker.timezoneOffsetNumber = function(tzString) {
		tzString = tzString.toString().replace(':',''); // excuse any iso8601, end up with "+1245"

		if(tzString.toUpperCase() === 'Z'){ // if iso8601 with Z, its 0 minute offset
			return 0;
		}

		if(!/^(\-|\+)\d{4}$/.test(tzString)){ // possibly a user defined tz, so just give it back
			return tzString;
		}

		return ((tzString.substr(0,1) =='-'? -1 : 1) * // plus or minus
					((parseInt(tzString.substr(1,2),10)*60) + // hours (converted to minutes)
					parseInt(tzString.substr(3,2),10))); // minutes
	};

	/**
	 * No way to set timezone in js Date, so we must adjust the minutes to compensate. (think setDate, getDate)
	 * @@param  date
	 * @@param  string formated like "+0500", "-1245"
	 * @@return date
	 */
	$.timepicker.timezoneAdjust = function(date, toTimezone) {
		var toTz = $.timepicker.timezoneOffsetNumber(toTimezone);
		if(!isNaN(toTz)){
			date.setMinutes(date.getMinutes()*1 + (date.getTimezoneOffset()*-1 - toTz*1) );
		}
		return date;
	};

	/**
	 * Calls `timepicker()` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * n.b. The input value must be correctly formatted (reformatting is not supported)
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the timepicker() call
	 * @@return jQuery
	 */
	$.timepicker.timeRange = function(startTime, endTime, options) {
		return $.timepicker.handleRange('timepicker', startTime, endTime, options);
	};

	/**
	 * Calls `datetimepicker` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@return jQuery
	 */
	$.timepicker.datetimeRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datetimepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.dateRange = function(startTime, endTime, options) {
		$.timepicker.handleRange('datepicker', startTime, endTime, options);
	};

	/**
	 * Calls `method` on the `startTime` and `endTime` elements, and configures them to
	 * enforce date range limits.
	 * @@param  string method Can be used to specify the type of picker to be added
	 * @@param  Element startTime
	 * @@param  Element endTime
	 * @@param  obj options Options for the `timepicker()` call. Also supports `reformat`,
	 *   a boolean value that can be used to reformat the input values to the `dateFormat`.
	 * @@return jQuery
	 */
	$.timepicker.handleRange = function(method, startTime, endTime, options) {
		options = $.extend({}, {
			minInterval: 0, // min allowed interval in milliseconds
			maxInterval: 0, // max allowed interval in milliseconds
			start: {},      // options for start picker
			end: {}         // options for end picker
		}, options);

		$.fn[method].call(startTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), endTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), endTime, 'minDate');
			}
		}, options, options.start));
		$.fn[method].call(endTime, $.extend({
			onClose: function(dateText, inst) {
				checkDates($(this), startTime);
			},
			onSelect: function(selectedDateTime) {
				selected($(this), startTime, 'maxDate');
			}
		}, options, options.end));

		checkDates(startTime, endTime);
		selected(startTime, endTime, 'minDate');
		selected(endTime, startTime, 'maxDate');

		function checkDates(changed, other) {
			var startdt = startTime[method]('getDate'),
				enddt = endTime[method]('getDate'),
				changeddt = changed[method]('getDate');

			if(startdt !== null){
				var minDate = new Date(startdt.getTime()),
					maxDate = new Date(startdt.getTime());

				minDate.setMilliseconds(minDate.getMilliseconds() + options.minInterval);
				maxDate.setMilliseconds(maxDate.getMilliseconds() + options.maxInterval);

				if(options.minInterval &amp;gt; 0 &amp;amp;&amp;amp; minDate &amp;gt; enddt){ // minInterval check
					endTime[method]('setDate',minDate);
				}
				else if(options.maxInterval &amp;gt; 0 &amp;amp;&amp;amp; maxDate &amp;lt; enddt){ // max interval check
					endTime[method]('setDate',maxDate);
				}
				else if (startdt &amp;gt; enddt) {
					other[method]('setDate',changeddt);
				}
			}
		}

		function selected(changed, other, option) {
			if (!changed.val()) {
				return;
			}
			var date = changed[method].call(changed, 'getDate');
			if(date !== null &amp;amp;&amp;amp; options.minInterval &amp;gt; 0){
				if(option == 'minDate'){
					date.setMilliseconds(date.getMilliseconds() + options.minInterval); 
				}
				if(option == 'maxDate'){
					date.setMilliseconds(date.getMilliseconds() - options.minInterval);
				}
			}
			if (date.getTime) {
				other[method].call(other, 'option', option, date);
			}
		}
		return $([startTime.get(0), endTime.get(0)]);
	};

	/**
	 * Log error or data to the console during error or debugging
	 * @@param  Object err pass any type object to log to the console during error or debugging
	 * @@return void
	 */
	$.timepicker.log = function(err){
		if(window.console){
			console.log(err);
		}
	};

	/*
	* Microsecond support
	*/
	if(!Date.prototype.getMicroseconds){
		Date.prototype.microseconds = 0;
		Date.prototype.getMicroseconds = function(){ return this.microseconds; };
		Date.prototype.setMicroseconds = function(m){ 
			this.setMilliseconds(this.getMilliseconds() + Math.floor(m/1000));
			this.microseconds = m%1000;
			return this;
		};
	}

	/*
	* Keep up with the version
	*/
	$.timepicker.version = "1.3.1";

})(jQuery);
jQuery.noConflict();
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;datetimepicker-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;e73a652e-09fc-4c71-8e7a-e2525a2d2a99&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){
function replaceAllString(oriStr, strTarget, strSubString ){
   var strText = oriStr;
   var intIndexOfMatch = strText.indexOf( strTarget );
   while (intIndexOfMatch != -1){
      strText = strText.replace( strTarget, strSubString )
      intIndexOfMatch = strText.indexOf( strTarget );
   }
   return( strText );
}
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&amp;amp;]" + name + "=([^&amp;amp;#]*)"),
    results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
};


   var jobName= getParameterByName('job')
   var fromDate= getParameterByName('fromDate')
   var toDate= getParameterByName('toDate')
   var limit= getParameterByName('limit')
   var selectedIstIid = getParameterByName('IstIid')

  $("#jobname").ready(function(){
   $("#jobname").text(jobName)
   var convertedJobName = replaceAllString(jobName, ".", "_")
   $("#IstIid" + convertedJobName).ready(function(){
     $("#IstIid" + convertedJobName).css("display","block")
     $("#select_" + convertedJobName).ready(function(){
        $("#select_" + convertedJobName).val(selectedIstIid)
     });
   });
 });

  $("#fromDate").ready(function(){
   $("#from-date").val(fromDate)
 });

  $("#toDate").ready(function(){
   $("#to-date").val(toDate)
 });

  $("#limit").ready(function(){
   if(limit!=""){
    $("#limit").val(limit)
   }
 });
 // Get data with ajax
 function ajax_getData(jobName,fromDate,toDate,limit ){
       var convertedJobName = replaceAllString(jobName, ".", "_")
       var istIid = $("#select_" + convertedJobName).val()
       window.location="/xwiki/bin/view/WiperDog/WebHome?job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid="+istIid;
 			/*$.ajax({
			 type: "GET",
			 url:"/xwiki/bin/get/Sandbox/DescriptionForJob?outputSyntax=plain&amp;amp;job="+jobName+"&amp;amp;limit="+limit+"&amp;amp;fromDate="+fromDate+"&amp;amp;toDate="+toDate+"&amp;amp;IstIid"+selectedIstIid,
			 success : function(result){
				$("#jobname").html(jobName)
				$("#display").text('[[]]' + result)
			 }
		   });*/
 }
	$("#treemenu2 a").click(function(){
		 var limit = 10
		 var fromDate=""
		 var toDate = ""
		 jobName= $(this).text()
                 $("#jobname").html(jobName)
                 var convertedJobName = replaceAllString(jobName, ".", "_")
                 $("#listIstIid &amp;gt; div").css("display","none")
                 $("#IstIid" + convertedJobName).css("display","block")
		 //ajax_getData(jobName,fromDate,toDate,limit )

	});

	$("#from-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
		dateFormat: 'yy-mm-dd',
	});
	$("#to-date").datetimepicker({
		timeFormat: 'HH:mm:ss',
			dateFormat: 'yy-mm-dd',

	});
	 $("#get-data").on("click",function(){
		var fromDate = $("#from-date").val()
		var toDate =  $("#to-date").val()
		 if( toDate!= "" ){
			  if(fromDate != ""){
				  if($("#from-date").datepicker( "getDate" ) &amp;gt; $("#to-date").datepicker( "getDate" )){
				  alert("'From date' cannot start later than 'To date'")
				  return false
				  }
			  }
		 }
		 limit = $("#limit").val()
		 ajax_getData(jobName,fromDate,toDate,limit )

	});

jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;process&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.JavaScriptExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;className&gt;XWiki.JavaScriptExtension&lt;/className&gt;
&lt;guid&gt;881686cc-1bfc-456e-b8ab-71334c4a45e5&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;require(['jquery'],function($){

$(function () {
    function drawLineChart(xAxis, series, container, data_detail){
console.log("vao day")
        var dataXAxis = xAxis
        var dataSeries = series
        var detail = data_detail

			$('#containerline' + container).highcharts({

				chart: {
					type:'line'
				},
				title: {
					text: container
				},
				tooltip :{
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				xAxis: dataXAxis ,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				series: dataSeries
			});
		};

		function drawBarChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail

			$('#containerbar' + container).highcharts({
				chart: {
					type: 'column'
				},
				title: {
					text: container
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {

					column: {
						pointPadding: 0.2,
						borderWidth: 0
					}
				},
				series: dataSeries
			});
		}

		function drawAreaChart(xAxis, series, container, data_detail){
			var dataXAxis = xAxis
			var dataSeries = series
			var detail = data_detail
			$('#containerarea' + container).highcharts({
				chart: {
					type: 'area'
				},
				title: {
					text: container
				},
				subtitle: {
				},
				xAxis: dataXAxis,
				yAxis: {
					title: {
						text: 'Monitoring'
					},
					labels: {
						formatter: function() {
							return this.value / 1000;
						}
					}
				},
				tooltip: {
					formatter: function() {
						var index = 0
						var tooltip_str = ""
						var name = this.series.name
						var fetchAt = this.x
						for(var i=0;i&amp;lt;detail.length;i++){
							if(detail[i].name == null || detail[i].name == name){
								for(var j=0;j&amp;lt;detail[i].data.length;j++){
									var detail_data = detail[i].data
									if(fetchAt == detail_data[j].fetchAt){
										for(var k in detail_data[j]){
											if(k != "fetchAt") {
												tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
											}
										}
									}
								}
							}
						}
						return tooltip_str
					}
				},
				plotOptions: {
					area: {
						stacking: 'normal',
						lineColor: '#666666',
						lineWidth: 1,
						marker: {
							lineWidth: 1,
							lineColor: '#666666'
						}
					}
				},
				series: dataSeries
			});
		};

		function drawPieChart(data, container){
			var dataPie = data
			$(document).ready(function () {
				// Build the chart
				$('#container' + container).highcharts({
					chart: {
						plotBackgroundColor: null,
						plotBorderWidth: null,
						plotShadow: false
					},
					title: {
						text: dataPie[0].name
					},
					tooltip: {
						pointFormat: '{series.name}: &amp;lt;b&amp;gt;{point.percentage:.1f}%&amp;lt;/b&amp;gt;'
					},
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							dataLabels: {
								enabled: false
							},
							showInLegend: true
						}
					},
					series: dataPie
				});
			});
		}

		// LINE
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonline_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonline");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Line chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						if(data_all[0][i].series[0].name == null){
							data_all[0][i].series[0].name = lstContainer[0][i]
						}
						drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
					}
				}
			}
		});

		// BAR
		$(document).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonbar_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonbar");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
					// data to display on tooltip
					var data_detail = data_all[0]
					// draw Bar chart
					for(var i=0;i&amp;lt;data_all[0].length;i++){
						drawBarChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
					}
				}
			}
		});

		// AREA
		$(document ).ready(function(){
			var lstKey = jQuery.parseJSON($("#lstkey").val())
			if(lstKey.length &amp;gt; 0) {
				for(var eKey=0;eKey&amp;lt;lstKey.length;eKey++){
					var finalKey = lstKey[eKey]
					var array = $("#jsons&amp;gt;#jsonarea_" + finalKey);
					var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
					var lstContainer = [];
					var data_all = [];
					for(var i=0;i&amp;lt;array.length;i++){
						data_all[i] = jQuery.parseJSON(array[i].value)
						lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
					}
					if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
						// data to display on tooltip
						var data_detail = data_all[0]
						// draw Line chart
						for(var i=0;i&amp;lt;data_all[0].length;i++){
							if(data_all[0][i].series[0].name == null){
								data_all[0][i].series[0].name = lstContainer[0][i]
							}
							drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, finalKey + "_" + lstContainer[0][i], data_detail[i].detail_data)
						}
					}
				}
			} else {
				var array = $("#jsons&amp;gt;.jsonarea");
				var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
				var lstContainer = [];
				var data_all = [];
				for(var i=0;i&amp;lt;array.length;i++){
					data_all[i] = jQuery.parseJSON(array[i].value)
					lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
				}
				// data to display on tooltip
				var data_detail = data_all[0]
				// draw Area Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					drawAreaChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
				}
			}
		});

		// PIE
		$("#piechart").ready(function(){

			var array = $("#jsons&amp;gt;.jsonpie");
			var arrayContainer = $("#jsons&amp;gt;.lstcontainerpie");
			var lstContainer = [];
			var data_all = [];
			for(var i=0;i&amp;lt;array.length;i++){
				data_all[i] = jQuery.parseJSON(array[i].value)
				lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)

			}
			if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
				// data to display on tooltip
				// draw Pie Chart
				for(var i=0;i&amp;lt;data_all[0].length;i++){
					var finalData = []
					finalData[0] = data_all[0][i]
					drawPieChart(finalData, lstContainer[0][i])
				}
			}
		});
	});
	jQuery.noConflict()
});&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-js&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;d5873d92-b78b-42fc-9407-46d166204b88&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;/* css for timepicker */
.ui-timepicker-div .ui-widget-header { 
margin-bottom: 8px;
 }

.ui-timepicker-div dl { text-align: left; }
.ui-timepicker-div dl dt { height: 25px; margin-bottom: -25px; }
.ui-timepicker-div dl dd { margin: 0 10px 10px 65px; }
.ui-timepicker-div td { font-size: 90%; }
.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }

.ui-timepicker-rtl{ direction: rtl; }
.ui-timepicker-rtl dl { text-align: right; }
.ui-timepicker-rtl dl dd { margin: 0 65px 10px 10px; }
#ui-datepicker-div{
 position:relative;
 width:auto;
 height:auto
}
&lt;/code&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;datetimepicker -css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;object&gt;
&lt;class&gt;
&lt;name&gt;XWiki.StyleSheetExtension&lt;/name&gt;
&lt;customClass&gt;&lt;/customClass&gt;
&lt;customMapping&gt;&lt;/customMapping&gt;
&lt;defaultViewSheet&gt;&lt;/defaultViewSheet&gt;
&lt;defaultEditSheet&gt;&lt;/defaultEditSheet&gt;
&lt;defaultWeb&gt;&lt;/defaultWeb&gt;
&lt;nameField&gt;&lt;/nameField&gt;
&lt;validationScript&gt;&lt;/validationScript&gt;
&lt;cache&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;cache&lt;/name&gt;
&lt;number&gt;5&lt;/number&gt;
&lt;prettyName&gt;Caching policy&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;long|short|default|forbid&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/cache&gt;
&lt;code&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;code&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;prettyName&gt;Code&lt;/prettyName&gt;
&lt;rows&gt;20&lt;/rows&gt;
&lt;size&gt;50&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.TextAreaClass&lt;/classType&gt;
&lt;/code&gt;
&lt;name&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;number&gt;1&lt;/number&gt;
&lt;prettyName&gt;Name&lt;/prettyName&gt;
&lt;size&gt;30&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StringClass&lt;/classType&gt;
&lt;/name&gt;
&lt;parse&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayFormType&gt;select&lt;/displayFormType&gt;
&lt;displayType&gt;yesno&lt;/displayType&gt;
&lt;name&gt;parse&lt;/name&gt;
&lt;number&gt;4&lt;/number&gt;
&lt;prettyName&gt;Parse content&lt;/prettyName&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.BooleanClass&lt;/classType&gt;
&lt;/parse&gt;
&lt;use&gt;
&lt;cache&gt;0&lt;/cache&gt;
&lt;disabled&gt;0&lt;/disabled&gt;
&lt;displayType&gt;select&lt;/displayType&gt;
&lt;multiSelect&gt;0&lt;/multiSelect&gt;
&lt;name&gt;use&lt;/name&gt;
&lt;number&gt;3&lt;/number&gt;
&lt;prettyName&gt;Use this extension&lt;/prettyName&gt;
&lt;relationalStorage&gt;0&lt;/relationalStorage&gt;
&lt;separator&gt; &lt;/separator&gt;
&lt;separators&gt; ,|&lt;/separators&gt;
&lt;size&gt;1&lt;/size&gt;
&lt;unmodifiable&gt;0&lt;/unmodifiable&gt;
&lt;values&gt;currentPage=Always on this page|onDemand=On demand|always=Always on this wiki&lt;/values&gt;
&lt;classType&gt;com.xpn.xwiki.objects.classes.StaticListClass&lt;/classType&gt;
&lt;/use&gt;
&lt;/class&gt;
&lt;name&gt;WiperDog.WebHome&lt;/name&gt;
&lt;number&gt;2&lt;/number&gt;
&lt;className&gt;XWiki.StyleSheetExtension&lt;/className&gt;
&lt;guid&gt;1201fb1a-e9c1-4731-8c74-2ea8c0071959&lt;/guid&gt;
&lt;property&gt;
&lt;cache&gt;default&lt;/cache&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;code&gt;.displayblock {
  border:2px solid;
  -webkit-border-radius:6px;
  background:gray;
  float: left;
  width:100%;
}

.displaypie {
  border:1px solid;
  -webkit-border-radius:6px;
  background:gray;
  width: 48%;
  float: left; 
  height: 300px;
}

.subtype {
  margin-top: 50px;
  font-size: 2em;
  color: red;
}&lt;/code&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;drawChart-css&lt;/name&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;parse&gt;0&lt;/parse&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;use&gt;currentPage&lt;/use&gt;
&lt;/property&gt;
&lt;/object&gt;
&lt;content&gt;{{include document="Lib.DataToDrawChart"/}}
{{include document="Lib.MongoDBConnection"/}}
{{velocity}}
$xwiki.jsx.use('Lib.JQueryUILib')
$xwiki.ssx.use('Lib.MenuGenerator')
$xwiki.jsx.use('Lib.MenuGenerator')
$xwiki.ssx.use('Lib.JQueryUILib')
{{/velocity}}
{{include document="Lib.MenuGenerator"/}}
{{html wiki="true" clean="false"}}
&amp;lt;div id="viewer"&amp;gt;
&amp;lt;table style="text-align:left"  &amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th &amp;gt;Job name&amp;lt;/th&amp;gt;
  &amp;lt;td colspan=3&amp;gt;&amp;lt;div id="jobname"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
{{groovy}}
import org.xwiki.context.*

def ec = services.component.getInstance(Execution.class).getContext()
def mapJobIstIid = ec.getProperty("mapJobIstIid")

println '{{html clean="false" wiki="false"}}'
println '&amp;lt;tr&amp;gt;'
println '&amp;lt;th&amp;gt;IstIid&amp;lt;/th&amp;gt;'
println '&amp;lt;td colspan=3&amp;gt;'
mapJobIstIid.each{jobEntry-&amp;gt;
  def convertedJobKey = jobEntry.key.replaceAll("\\.","_")
  println "&amp;lt;div id='listIstIid'&amp;gt;"
  println "&amp;lt;div id=IstIid${convertedJobKey} style='display:none'&amp;gt;"
  println "&amp;lt;select id=select_${convertedJobKey}&amp;gt;"
  jobEntry.value.each{
     println "&amp;lt;option value=\"$it\"&amp;gt;$it&amp;lt;/option&amp;gt;"
  }
  println "&amp;lt;/select&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
  println "&amp;lt;/div&amp;gt;"
}
println '&amp;lt;/td&amp;gt;'
println '&amp;lt;/tr&amp;gt;'
println '{{/html}}'
{{/groovy}}
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data monitor from&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="from-date" id="from-date"/&amp;gt;&amp;lt;/td&amp;gt;
  &amp;lt;th&amp;gt;Data monitor to&amp;lt;/th&amp;gt;
  &amp;lt;td&amp;gt;&amp;lt;input type="text" name="to-date" id="to-date"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr&amp;gt;
  &amp;lt;th&amp;gt;Data records limit &amp;lt;/th&amp;gt;
  &amp;lt;td &amp;gt;
     &amp;lt;select id="limit"&amp;gt;
       &amp;lt;option value=5&amp;gt;5&amp;lt;/option&amp;gt;
       &amp;lt;option value=10&amp;gt;10&amp;lt;/option&amp;gt;
       &amp;lt;option value=15&amp;gt;15&amp;lt;/option&amp;gt;
       &amp;lt;option value=20&amp;gt;20&amp;lt;/option&amp;gt;
     &amp;lt;/select&amp;gt;
  &amp;lt;/td&amp;gt;
  &amp;lt;td colspan=3 &amp;gt;&amp;lt;input type="button" value="View Data" id="get-data" class="button"/&amp;gt;&amp;lt;/td&amp;gt;
 &amp;lt;/tr&amp;gt;
 &amp;lt;tr style="display:none"&amp;gt;&amp;lt;td colspan=3&amp;gt;&amp;lt;div id="display"&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
&amp;lt;/table&amp;gt;

&amp;lt;/div&amp;gt; 
 &amp;lt;/body&amp;gt;

{{/html}}
{{groovy}}
import groovy.json.*
xwiki.jsx.use("Lib.Highcharts")

if(request.xpage == "plain") {
	response.setContentType('text/plain')
}

def listData = []
def job = request.get("job")
def fromDate = request.get("fromDate")
def toDate = request.get("toDate")
def limit= (request.get("limit")!=null)?request.get("limit").toInteger():10
def istIid = request.get("IstIid")

def str= "No data to retrieved !"
def result = null
if(job != "" &amp;amp;&amp;amp; job != null &amp;amp;&amp;amp; istIid != null &amp;amp;&amp;amp; istIid != ""){
	MongoDBConnection.getConnection()
	if(fromDate != "" || toDate != ""){
		result = MongoDBConnection.getDataInPeriod(job,fromDate,toDate,limit,istIid)
	} else {
		result = MongoDBConnection.getDataAllFields(job,limit,istIid)
        }
MongoDBConnection.closeConnection()
} else {
   println "{{warning}}There are no selected job or IstIid{{/warning}}"
}

if( (result != null) &amp;amp;&amp;amp; (result.size() &amp;gt; 0) &amp;amp;&amp;amp; (result[0].KEYEXPR != null)&amp;amp;&amp;amp;!(result[0].KEYEXPR instanceof List )){
if(result[0].type == "Subtyped") {
    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
    def dataSubtype = DataToDrawChart.getDataToDrawSubtype(result)
    def listKey = []
    dataSubtype.each {key,value -&amp;gt;
        listKey.add(key)
    }
    def jsonkey = com.mongodb.util.JSON.serialize(listKey)

    dataSubtype.each {key,value -&amp;gt;
        println '&amp;lt;div class=\"subtype\"&amp;gt;Chart Of '+ key +'&amp;lt;/div&amp;gt;'
        println "-----"
        def dataLine = []
        def dataBar = []
        def dataPie = []
        def dataArea = []
        if(DataToDrawChart.getDataToDrawLine(value) != []) {
            dataLine = DataToDrawChart.getDataToDrawLine(value)
        }
        if(DataToDrawChart.getDataToDrawBar(value) != []) {
            dataBar = DataToDrawChart.getDataToDrawBar(value)
        }
        if(DataToDrawChart.getDataToDrawPie(value) != []) {
            dataPie = DataToDrawChart.getDataToDrawPie(value)
        }
        if(DataToDrawChart.getDataToDrawArea(value) != []) {
            dataArea = DataToDrawChart.getDataToDrawArea(value)
        }

        def chartColumnsLine
        def chartColumnsBar 
        def chartColumnsArea 
        def lstName
        if(dataLine.size() &amp;gt; 0 ){
            chartColumnsLine = dataLine[0].chart_columns
        }
        if(dataBar.size() &amp;gt; 0){
            chartColumnsBar = dataBar[0].chart_columns
        }
        if(dataArea.size() &amp;gt; 0 ){
            chartColumnsArea = dataArea[0].chart_columns
        }
        if(dataPie.size() &amp;gt; 0 ){
            lstName = dataPie['name']
        }

        def tmpListNameContainer = []
	for(def nameContainer in lstName){
	   nameContainer = nameContainer.replaceAll("\\.", "_")
	   tmpListNameContainer.add(nameContainer)
	}
        def jsonPie
        def jsonLine
	def jsonBar
        def jsonArea
        if(dataPie != []) {
	    jsonPie = com.mongodb.util.JSON.serialize(dataPie)
        }
        if(dataLine != []) {
	    jsonLine = com.mongodb.util.JSON.serialize(dataLine)
        }
        if(dataBar != []) {
            jsonBar = com.mongodb.util.JSON.serialize(dataBar)
        }
        if(dataArea != []) {
	    jsonArea = com.mongodb.util.JSON.serialize(dataArea)
        }

	def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
	def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
	def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
	def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

	println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
        if(jsonLine != null) {
	    println "&amp;lt;textarea id=\"jsonline_$key\" &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;" 
        }
	if(jsonBar != null) {
            println "&amp;lt;textarea id=\"jsonbar_$key\"&amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
 	    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
        }
        if(jsonPie != null) {
	    println "&amp;lt;textarea id=\"jsonpie_$key\" &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
            println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
        }
        if(jsonArea != null) {
	    println "&amp;lt;textarea id=\"jsonarea_$key\" &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"
	    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
        }

	println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
	println "&amp;lt;input style=\"display:none\" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;"
	println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
	println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'
	println "&amp;lt;/div&amp;gt;"
	  
	def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
	def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
	  
	println "&amp;lt;div style='clear:both'&amp;gt;"
        if(jsonPie != null) {
	  println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
	  lstName.each{
	    def tmp = it.replaceAll("\\.", "_")
	    println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
        if(jsonLine != null) {
	  def chartLineComment = false
	  chartColumnsLine.each{
	    if(!chartLineComment){
	       println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	       chartLineComment = true  
	    }

	      println " &amp;lt;div class=\"displayblock\" id=\"containerline${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
        println "&amp;amp;nbsp;"

        if(jsonBar != null) {
	  def chartBarComment = false
	  chartColumnsBar.each{
	     if(!chartBarComment){
	        println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	        chartBarComment = true
	      }  

	     println " &amp;lt;div class=\"displayblock\" id=\"containerbar${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
	println "&amp;amp;nbsp;"

        if(jsonArea != null) {
	  def chartAreaComment = false
	  chartColumnsArea.each{
	  if(!chartAreaComment){
	    println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
	    chartAreaComment = true
	  }
	    println " &amp;lt;div class=\"displayblock\" id=\"containerarea${key}_${it}\"&amp;gt;&amp;lt;/div&amp;gt;"
	  }
	  println "&amp;lt;/div&amp;gt;"
        }
	println "&amp;lt;/div&amp;gt;"
        
    }
    println '&amp;lt;/body&amp;gt;'
    println '{{/html}}'
} else if(result[0].type == "Store") {
    // data store
    def dataLine = DataToDrawChart.getDataToDrawLine(result)
    def dataBar = DataToDrawChart.getDataToDrawBar(result)
    def dataPie = DataToDrawChart.getDataToDrawPie(result)
    def dataArea = DataToDrawChart.getDataToDrawArea(result)
    def chartColumnsLine 
    def chartColumnsBar 
    def chartColumnsArea 
    def lstName 

    if(dataLine.size() &amp;gt; 0 ){
        chartColumnsLine = dataLine[0].chart_columns
    }
    if(dataBar.size() &amp;gt; 0){
        chartColumnsBar = dataBar[0].chart_columns
    }
    if(dataArea.size() &amp;gt; 0 ){
        chartColumnsArea = dataArea[0].chart_columns
    }
    if(dataPie.size() &amp;gt; 0 ){
        lstName = dataPie['name']
    }

    println '{{html clean="false" wiki="true"}}'
    println '&amp;lt;body&amp;gt;'
  
    def tmpListNameContainer = []
    for(def nameContainer in lstName){
       nameContainer = nameContainer.replaceAll("\\.", "_")
       tmpListNameContainer.add(nameContainer)
    }
  
    def jsonPie = com.mongodb.util.JSON.serialize(dataPie)
    def jsonLine = com.mongodb.util.JSON.serialize(dataLine)
    def jsonBar = com.mongodb.util.JSON.serialize(dataBar)
    def jsonArea = com.mongodb.util.JSON.serialize(dataArea)

    def jsonContainerPie = com.mongodb.util.JSON.serialize(tmpListNameContainer)
    def jsonContainerLine = com.mongodb.util.JSON.serialize(chartColumnsLine)
    def jsonContainerBar = com.mongodb.util.JSON.serialize(chartColumnsBar)
    def jsonContainerArea = com.mongodb.util.JSON.serialize(chartColumnsArea)

    def listEmpty = com.mongodb.util.JSON.serialize([])
    println "&amp;lt;textarea style=\"display:none\" id='lstkey' &amp;gt;$listEmpty&amp;lt;/textarea&amp;gt;" 

    println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
    println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'

    println "&amp;lt;div id='jsons' style = \"display:none\"&amp;gt;"
    println "&amp;lt;textarea class='jsonline' &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonbar' &amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonpie' &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='jsonarea' &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"

    println "&amp;lt;textarea class='lstcontainerpie' &amp;gt;$jsonContainerPie &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerline' &amp;gt;$jsonContainerLine &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerbar' &amp;gt;$jsonContainerBar &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;textarea class='lstcontainerarea' &amp;gt;$jsonContainerArea &amp;lt;/textarea&amp;gt;"
    println "&amp;lt;/div&amp;gt;"
  
    def fromDateFinal = (!"".equals(fromDate))? ("from: " + fromDate) : ""
    def toDateFinal = (!"".equals(toDate))? (" to: " + toDate) : " to system time."
  
    println "&amp;lt;div style='clear:both'&amp;gt;"
  
    def chartPieComment = false
    lstName.each{
        if(!chartPieComment) {
            println "&amp;lt;div id=\"wrapperPieChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is lastest monitoring data&amp;lt;/h1&amp;gt;"
            chartPieComment = true
        }
        def tmp = it.replaceAll("\\.", "_")
        println " &amp;lt;div class=\"displaypie\" id=\"container$tmp\" &amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    def chartLineComment = false
    chartColumnsLine.each{
    if(!chartLineComment){
        println "&amp;lt;div id=\"wrapperLineChart\" style=\" clear:both\"&amp;gt;&amp;amp;nbsp;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
        chartLineComment = true  
    }

    println " &amp;lt;div class=\"displayblock\" id=\"containerline$it\"&amp;gt;&amp;lt;/div&amp;gt;"
    }
    println "&amp;lt;/div&amp;gt;"
    println "&amp;amp;nbsp;"
    def chartBarComment = false
    chartColumnsBar.each{
        if(!chartBarComment){
            println "&amp;lt;div id=\"wrapperBarChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
            chartBarComment = true
        }  

    println " &amp;lt;div class=\"displayblock\" id=\"containerbar$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
  println "&amp;lt;/div&amp;gt;"
  println "&amp;amp;nbsp;"
  def chartAreaComment = false
  chartColumnsArea.each{
  if(!chartAreaComment){
    println "&amp;lt;div id=\"wrapperAreaChart\" style=\"clear:both\"&amp;gt;&amp;lt;h1&amp;gt;This chart is monitoring data " + fromDateFinal + toDateFinal + "&amp;lt;/h1&amp;gt;"
    chartAreaComment = true
  }
    println " &amp;lt;div class=\"displayblock\" id=\"containerarea$it\"&amp;gt;&amp;lt;/div&amp;gt;"
  }
  println "&amp;lt;/div&amp;gt;"
println "&amp;lt;/div&amp;gt;"

println '&amp;lt;/body&amp;gt;'
println '{{/html}}'
}
}else{
    println 'There is no data for this job with criterias'
}
{{/groovy}}&lt;/content&gt;&lt;/xwikidoc&gt;
@


30.12
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376368256000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;30.12&lt;/version&gt;
d2523 1
@


30.11
log
@@
text
@d14 3
a16 3
&lt;date&gt;1376367193000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376367059000&lt;/contentUpdateDate&gt;
&lt;version&gt;30.11&lt;/version&gt;
a3214 1
    println "&amp;lt;textarea id='lstkey' &amp;gt;$jsonkey&amp;lt;/textarea&amp;gt;" 
@


30.10
log
@@
text
@d14 1
a14 1
&lt;date&gt;1376367059000&lt;/date&gt;
d16 1
a16 1
&lt;version&gt;30.10&lt;/version&gt;
d2527 1
a2527 44
        $('#containerline' + container).highcharts({
            
            chart: {
                type:'line'
            },
            title: {
                text: container
            },
            tooltip :{
                    formatter: function() {                    
                       var index = 0
                       var tooltip_str = ""
                       var name = this.series.name
                       var fetchAt = this.x
                       for(var i=0;i&amp;lt;detail.length;i++){
                          if(detail[i].name == null || detail[i].name == name){
                             for(var j=0;j&amp;lt;detail[i].data.length;j++){
                                var detail_data = detail[i].data
                                if(fetchAt == detail_data[j].fetchAt){
                                   for(var k in detail_data[j]){
                                      if(k != "fetchAt") {
                                         tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
                                      }
                                   }
                                }
                             }
                          }
                       }
                       return tooltip_str
            }},
            xAxis: dataXAxis ,
            yAxis: {
               title: {
		  text: 'Monitoring'
	       }
            },
            series: dataSeries 
        });
    };
    
    function drawBarChart(xAxis, series, container, data_detail){
        var dataXAxis = xAxis
        var dataSeries = series
        var detail = data_detail
a2528 1
		$('#containerbar' + container).highcharts({
d2530 45
d2589 18
a2606 18
                                                var tooltip_str = ""
                                                var name = this.series.name
                                                var fetchAt = this.x
                                                for(var i=0;i&amp;lt;detail.length;i++){
                                                   if(detail[i].name == null || detail[i].name == name){
                                                     for(var j=0;j&amp;lt;detail[i].data.length;j++){
                                                        var detail_data = detail[i].data
                                                        if(fetchAt == detail_data[j].fetchAt){
                                                           for(var k in detail_data[j]){
                                                              if(k != "fetchAt") {
                                                                tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
                                                              }
                                                           }
                                                        }
                                                     }
                                                   }
                                                }
                                                return tooltip_str
d2610 59
a2668 1
					/*column: {
d2670 5
a2674 3
						dataLabels: {
							enabled: true,
							color: (Highcharts.theme &amp;amp;&amp;amp; Highcharts.theme.dataLabelsColor) || 'white'
d2676 1
a2676 5
					}*/
                                    column: {
                                    pointPadding: 0.2,
                                    borderWidth: 0
                                    }
d2680 1
a2680 1
		}
d2682 29
a2710 46
    function drawAreaChart(xAxis, series, container, data_detail){
        var dataXAxis = xAxis
        var dataSeries = series
        var detail = data_detail
        $('#containerarea' + container).highcharts({
            chart: {
                type: 'area'
            },
            title: {
                text: container
            },
            subtitle: {
                
            },
            xAxis: dataXAxis,
            yAxis: {
                title: {
                    text: 'Monitoring'
                },
                labels: {
                    formatter: function() {
                        return this.value / 1000;
                    }
                }
            },
            tooltip: {
		formatter: function() {
			var index = 0
                        var tooltip_str = ""
                        var name = this.series.name
                        var fetchAt = this.x
                        for(var i=0;i&amp;lt;detail.length;i++){
                            if(detail[i].name == null || detail[i].name == name){
                               for(var j=0;j&amp;lt;detail[i].data.length;j++){
                                  var detail_data = detail[i].data
                                     if(fetchAt == detail_data[j].fetchAt){
                                        for(var k in detail_data[j]){
                                          if(k != "fetchAt") {
                                            tooltip_str += "&amp;lt;p&amp;gt;" + k + " : " + detail_data[j][k] + "&amp;lt;/p&amp;gt;&amp;lt;br&amp;gt;"
                                          }
                                        }
                                     }
                                  }
                               }
                            }
                         return tooltip_str
a2711 15
	    },
            plotOptions: {
                area: {
                    stacking: 'normal',
                    lineColor: '#666666',
                    lineWidth: 1,
                    marker: {
                        lineWidth: 1,
                        lineColor: '#666666'
                    }
                }
            },
            series: dataSeries
        });
    };
d2713 48
a2760 30
    function drawPieChart(data, container){
        var dataPie = data
        $(document).ready(function () {
    	   // Build the chart
           $('#container' + container).highcharts({
               chart: {
                   plotBackgroundColor: null,
                   plotBorderWidth: null,
                   plotShadow: false
               },
               title: {
                   text: dataPie[0].name
               },
               tooltip: {
               	   pointFormat: '{series.name}: &amp;lt;b&amp;gt;{point.percentage:.1f}%&amp;lt;/b&amp;gt;'
               },
               plotOptions: {
                   pie: {
                       allowPointSelect: true,
                       cursor: 'pointer',
                       dataLabels: {
                          enabled: false
                       },
                       showInLegend: true
                   }
               },
               series: dataPie
           });
       });
      }
d2762 45
a2806 16
        $("#areachart").ready(function(){
           var array = $("#jsons&amp;gt;.jsonarea");
           var arrayContainer = $("#jsons&amp;gt;.lstcontainerarea");
           var lstContainer = [];
           var data_all = [];
           for(var i=0;i&amp;lt;array.length;i++){
              data_all[i] = jQuery.parseJSON(array[i].value)
              lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
           }
           // data to display on tooltip
           var data_detail = data_all[0]
           // draw Area Chart
           for(var i=0;i&amp;lt;data_all[0].length;i++){
               drawAreaChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
           }
        });
d2808 66
a2873 20
   	$("#piechart").ready(function(){
           
           var array = $("#jsons&amp;gt;.jsonpie");
           var arrayContainer = $("#jsons&amp;gt;.lstcontainerpie");
           var lstContainer = [];
           var data_all = [];
           for(var i=0;i&amp;lt;array.length;i++){
              data_all[i] = jQuery.parseJSON(array[i].value)
              lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
 
           }
           if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
           // data to display on tooltip
           // draw Pie Chart
           for(var i=0;i&amp;lt;data_all[0].length;i++){
               var finalData = []
               finalData[0] = data_all[0][i]
               drawPieChart(finalData, lstContainer[0][i])
           }
          }
d2875 1
a2875 44
	   
   	$("#barchart").ready(function(){
           
           var array = $("#jsons&amp;gt;.jsonbar");
           var arrayContainer = $("#jsons&amp;gt;.lstcontainerbar");
           var lstContainer = [];
           var data_all = [];
           for(var i=0;i&amp;lt;array.length;i++){
              data_all[i] = jQuery.parseJSON(array[i].value)
              lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
           }
           if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
           // data to display on tooltip
           var data_detail = data_all[0]
           // draw Bar chart
           for(var i=0;i&amp;lt;data_all[0].length;i++){
               drawBarChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
           }
          }
       });
       
        $("#linechart").ready(function(){
           var array = $("#jsons&amp;gt;.jsonline");
           var arrayContainer = $("#jsons&amp;gt;.lstcontainerline");
           var lstContainer = [];
           var data_all = [];
           for(var i=0;i&amp;lt;array.length;i++){
               data_all[i] = jQuery.parseJSON(array[i].value)
               lstContainer[i] = jQuery.parseJSON(arrayContainer[i].value)
           }
           if(data_all.length &amp;gt;0 &amp;amp;&amp;amp; lstContainer.length &amp;gt;0){
           // data to display on tooltip
           var data_detail = data_all[0]
           // draw Line chart
           for(var i=0;i&amp;lt;data_all[0].length;i++){
               if(data_all[0][i].series[0].name == null){
                   data_all[0][i].series[0].name = lstContainer[0][i]
               }
               drawLineChart(data_all[0][i].xAxis, data_all[0][i].series, lstContainer[0][i], data_detail[i].detail_data)
           }
          }
       });
});
jQuery.noConflict()
@


30.9
log
@Imported from XAR
@
text
@d14 3
a16 3
&lt;date&gt;1376364375000&lt;/date&gt;
&lt;contentUpdateDate&gt;1376364375000&lt;/contentUpdateDate&gt;
&lt;version&gt;30.9&lt;/version&gt;
d20 2
a21 2
&lt;comment&gt;Imported from XAR&lt;/comment&gt;
&lt;minorEdit&gt;false&lt;/minorEdit&gt;
d3135 1
d3137 6
a3205 5
	println '&amp;lt;input style="display:none" type=\"button\" id=\"piechart\" value=\"Click here to draw Pie Chart\"/&amp;gt;'
	println '&amp;lt;input style="display:none" type=\"button\" id=\"linechart\" value=\"Click here to draw Line Chart\"/&amp;gt;'
	println '&amp;lt;input style="display:none" type=\"button\" id=\"barchart\" value=\"Click here to draw Bar Chart\"/&amp;gt;'
	println '&amp;lt;input style="display:none" type=\"button\" id=\"areachart\" value=\"Click here to draw Area Chart\"/&amp;gt;'

d3208 1
a3208 1
	    println "&amp;lt;textarea class='jsonline' &amp;gt;$jsonLine &amp;lt;/textarea&amp;gt;"
d3212 1
a3212 1
            println "&amp;lt;textarea class='jsonbar' &amp;gt;$jsonBar &amp;lt;/textarea&amp;gt;"
d3216 1
a3216 1
	    println "&amp;lt;textarea class='jsonpie' &amp;gt;$jsonPie &amp;lt;/textarea&amp;gt;"
d3220 1
a3220 1
	    println "&amp;lt;textarea class='jsonarea' &amp;gt;$jsonArea &amp;lt;/textarea&amp;gt;"
d3223 5
d3242 1
d3250 1
a3250 1
	      println " &amp;lt;div class=\"displayblock\" id=\"containerline$it\"&amp;gt;&amp;lt;/div&amp;gt;"
d3253 2
a3254 1
	  println "&amp;amp;nbsp;"
d3256 1
d3264 1
a3264 1
	     println " &amp;lt;div class=\"displayblock\" id=\"containerbar$it\"&amp;gt;&amp;lt;/div&amp;gt;"
d3267 2
a3268 1
	  println "&amp;amp;nbsp;"
d3270 1
d3277 1
a3277 1
	    println " &amp;lt;div class=\"displayblock\" id=\"containerarea$it\"&amp;gt;&amp;lt;/div&amp;gt;"
d3280 1
d3329 3
d3400 2
@
</versions></xwikidoc>